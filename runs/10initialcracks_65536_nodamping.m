function MainHandler2()
%{
%switchable1
	%main calculation mechanism MATLAB for NOT ready
	fprintf('%s','switchable1 NOT c ready!');
%}
%switchable1
%[
%switchable1
	%main calculation mechanism MATLAB for NOT ready
	fprintf('%s','switchable1 minimalistic with c ready!');
%]
%switchable1
%{
%switchable2
	%print mechanism on for NOT ready
	fprintf('%s','switchable2 NOT c ready!');
%}
%switchable2

%[
%switchable2
	parfor i=1:20
		fprintf('%s',['i=' int2txt(i) char(10)]);
	end
%]
%switchable2

%{
%switchable3
	%load txt MATLAB error handling for not ready
	fprintf('%s','switchable3 NOT c ready!');
%}
%switchable3
	
	%INPUTS HERE:
	CasetoRun=192;
	%'Refinement factor? (for CasetoRun==26 || CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124 || CasetoRun==117)'
	if CasetoRun==118 || CasetoRun==173 || CasetoRun==192
		refinementfactor=64;
	elseif CasetoRun==125 || CasetoRun==126 || CasetoRun==127
		refinementfactor=30;
	elseif CasetoRun==128 || CasetoRun==130 || CasetoRun==132 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==129 || CasetoRun==136 || CasetoRun==140 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142
		refinementfactor=4;
	elseif CasetoRun==134
		refinementfactor=20;
	elseif CasetoRun==131
		refinementfactor=36;
	elseif CasetoRun==137
		refinementfactor=4;
	elseif CasetoRun==138
		refinementfactor=4.5;
	elseif CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==147 || CasetoRun==145
		refinementfactor=1;
	elseif CasetoRun==150 || CasetoRun==152
		refinementfactor=2;
	elseif CasetoRun==155 || CasetoRun==158 || CasetoRun==156 || CasetoRun==159
		refinementfactor=4;
	elseif CasetoRun==162
		refinementfactor=8;
	elseif CasetoRun==164 || CasetoRun==172 || CasetoRun==174
		refinementfactor=8;
	elseif CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180
		%refinement adjust
		refinementfactor=4;
	elseif CasetoRun==153
		refinementfactor=2;
	elseif CasetoRun==161
		refinementfactor=zeros(1,1);
	elseif CasetoRun==154
		refinementfactor=8;
	elseif CasetoRun==123 || CasetoRun==151
		refinementfactor=1;
	elseif CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==177 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166
		refinementfactor=10;
	elseif CasetoRun==187 || CasetoRun==190
		refinementfactor=10;
	elseif CasetoRun==188
		refinementfactor=8;
	elseif CasetoRun==191
		refinementfactor=10;
	elseif CasetoRun==189
		refinementfactor=10;
	elseif CasetoRun==181
		refinementfactor=16;
	elseif CasetoRun==186
		refinementfactor=9;
	elseif CasetoRun==185
		refinementfactor=4;
	elseif CasetoRun==184 || CasetoRun==193
		refinementfactor=4;
	elseif CasetoRun==183
		refinementfactor=4;
	elseif CasetoRun==182
		refinementfactor=16;
	elseif CasetoRun==179
		refinementfactor=2;
	elseif CasetoRun==165
		refinementfactor=10.5;
	elseif CasetoRun==124
		refinementfactor=3;
	else
		refinementfactor=1;
	end
	
	%for plotting purposes only, but harmless for coder
	frameskip=0; %stopping potential coder whine
	if CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==182 || CasetoRun==177 || CasetoRun==178 || CasetoRun==169
		frameskip=9;
    elseif CasetoRun==179
        frameskip=9;
	elseif CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==165 || CasetoRun==164
		frameskip=9;
	elseif CasetoRun==184 || CasetoRun==185 || CasetoRun==193
		frameskip=4;
	elseif CasetoRun==192
		frameskip=4;
	elseif CasetoRun==186 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==189
		frameskip=4;
	elseif CasetoRun==183
		frameskip=9;
	elseif CasetoRun==172 || CasetoRun==174
		frameskip=0;
	elseif CasetoRun==166
		frameskip=9;
	else
		frameskip=9;
	end
	if CasetoRun==153 || CasetoRun==154
		dumpresult=1; %no cracking on the ring, need to dump result anyway
	elseif CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==161
		dumpresult=0;
	elseif CasetoRun==165
		dumpresult=0;
	elseif CasetoRun==179
		dumpresult=1;
	elseif CasetoRun==183
		dumpresult=1;
	elseif CasetoRun==184 || CasetoRun==193
		dumpresult=1;
	elseif CasetoRun==192
		dumpresult=0;
	elseif CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==189
		dumpresult=0;
	elseif CasetoRun==185 || CasetoRun==186
		dumpresult=0;
	elseif CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==182 || CasetoRun==177 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166
		dumpresult=0; %just test
	else
		dumpresult=1; %the initial state of whether data is dumped, for case 136 and 139 dumpresult=1 starts if about to crack
	end
	
	%'Run (0) or just plot (1) or just plot last (2)? '
%[
%switchable2
	runorjustplot=0;
%]
%switchable2
%{
%switchable2
	runorjustplot=1;
%}
%switchable2
	%'Number of Cores? ' (for CasetoRun==14)
	numberofcores=4;
	VersionNum=mfilename;
    %{
	fprintf('%s',['start of parfor test' char(10)]);
	parfor i=1:100
		fprintf('%s',['i=' int2txt(i) char(10)]);
	end
	%}
	if CasetoRun==161
		for refinementfactorpower=0:9
			refinementfactor=2^(refinementfactorpower);
			anerror=Main(refinementfactor, 2, CasetoRun, runorjustplot, numberofcores, VersionNum, frameskip, dumpresult);
			savesinglefloat(anerror.t_deviation,['anerror.t_deviation' '-' int2txt(refinementfactor) '.txt']);
			savesinglefloat(anerror.u_err_relative,['anerror.u_err_relative' '-' int2txt(refinementfactor) '.txt']);
			savesinglefloat(anerror.gridsize,['anerror.gridsize' '-' int2txt(refinementfactor) '.txt']);
			
			savesinglefloat(anerror.u_srsserror,['anerror.u_srsserror' '-' int2txt(refinementfactor) '.txt']);
			savesinglefloat(anerror.u_srssan,['anerror.u_srssan' '-' int2txt(refinementfactor) '.txt']);
			savematrixfloat(anerror.u_sp_an,['anerror.u_sp_an' '-' int2txt(refinementfactor) '.txt']);
			savematrixfloat(anerror.u_sp,['anerror.u_sp' '-' int2txt(refinementfactor) '.txt']);
		end
	else
		DUMMY=Main(refinementfactor, 2, CasetoRun, runorjustplot, numberofcores, VersionNum, frameskip, dumpresult);
	end
end


%{
function ParticlePull()
	dESP=[0.001 0;0 0.00];
	sigma_global_big=[ 0, 0, 0, 0, 0, 0];
	e_t_global_big=[ 0, 0, 0, 0, 0, 0];
	e_pl_global_big=[ 0, 0, 0, 0, 0, 0];
	alpha_in=[ 0, 0, 0, 0, 0, 0, 0];
	xdirletter='t';
	ydirletter='r';
	zdirletter='l';
	xydirletter='tr';
	yzdirletter='rl';
	xzdirletter='tl';
    dudx_rtl=dESP;
	
	%input override from the real one
    %{
	dESP=[                0.0000092273517047498537947810767767542, -0.000000000000000000029876886326961723138418417955969; -0.000000000000000000029876886326961723138418417955969,                0.0000022292111761709296263646740837716];
	sigma_global_big=[ 2.627556919609589591857456980506, 0.92505782873414932332423177285818, 1.5986766367546838552016197354533, -0.00000000000000015427464434694612636524586431389, 0, 0];
	e_t_global_big=[ 0.0055397858013045749719927002274744, -0.00039292443354643563028366637368549, 0, -0.0000000000000000038568661086736565487678487293823, 0, 0];
	e_pl_global_big=[ 0, -0.0000000000000000011384122811097796557078254409134, -0.000000000000000000099083023677830163349792639533181, -3.0814879110195773648895647081359e-33, 0, 0];
	alpha_in=[ 0, 0, 0, 0, 0, 0, 0];
	dudx_rtl=[                0.0036774742874255972324704089260194, 0.000000000000000020968140727901620878357464091193; -0.000000000000000028536079657031517936656558982959,              -0.0022579939820457362031902448507026];
	xdirletter =    't'
	ydirletter =    'r'
	zdirletter =    'l'
	xydirletter =    'tr'
	yzdirletter =    'rl'
	xzdirletter =    'tl'
    %}
	%end of input override from the real one
	
	ftl=65.5;
	ftr=3.75;
	ftt=2.79;
	fcl=-50.3;
	fcr=-2.75;
	fct=-5;
	fvrt=1.83;
	fvrl=6.34;m euro
	fvtl=5.34;
	Er=820;
	Et=430;
	El=13200;
	Grt=40;
	Gtl=730;
	Grl=660;
	nurt=0.24;
	nutl=0.45;
	nurl=0.45;
	kappa1=0.00001;
	kappa2=1.2;
	kappa3=0.00001;
	kappa4=1.2;
	kappa5=0.00001;
	kappa6=0.7;
	kappa7=1.0;
	Gftl=1.65;
	Gfcl=50.0;
	Gftr=0.3;
	Gftt=0.3;
	Gfcr=9.0909090909090909090909090909091;
	Gfct=9.0909090909090909090909090909091;
	GII=0.3;
	Hld=15.0;
	Hrd=2.0;
	Htd=2.0;
	lc=8.3333333333333333333333333333333;
	alpha2dnounit=0.1;
	alpha2maxnounit=0.75;
	alpha4dnounit=0.1;
	alpha4maxnounit=0.75;
	alpha6dnounit=0.5;
	alpha6maxnounit=0.75;
	alpha7dnounit=1.0;
	alpha7maxnounit=1.5;
	CasetoRun=-99;
	t_time=0;
	dt=0.00019462473604038075625059789341975;
	spid=1;
	Debugging.Active= 0;
	Debugging.Case= 25;
	Debugging.FileName= 'A201810121045-GerhardMultiManualEllipse-ms=100-Dump.mat';
	Debugging.Time= 5.2234;
	Debugging.Particle= 2649;
	Debugging.DesignatedStopRepeater= 158;
    
    for i=1:inf
        [s_sp,e_pl,sigma_global_big,e_t_global_big,e_pl_global_big,alpha_out,f_final_vect,surfacewithfmax,sigma_local_big,evaltimes,thetacrackrtl,Ktangent_global,Ktangent_global_2D,Ktangent_global_tens,Ktangent_global_tens_2D,activesurfacelist,AbeforeQ_rtl,lambdamin,thetamin]= ...
            Wood_Schmidt17(dESP,sigma_global_big,e_t_global_big,e_pl_global_big,alpha_in,xdirletter,ydirletter,zdirletter,xydirletter,yzdirletter,xzdirletter,ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,Grt,Gtl,Grl,nurt,nutl,nurl,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit,CasetoRun,t_time,dt,spid,Debugging,NaN,dudx_rtl);
        alpha_in=alpha_out;
		%{
		if i==5
			dESP=dESP/10;
		end
		if i==10
			dESP=dESP/10;
		end
		if i==14
			dESP=dESP/10;
		end
		%}
        disp(['s_sp=' num2str(s_sp)]);
		disp(['i=' num2str(i)]);
        Ktangent_global_2D;
        lambdamin;
        thetamin;
        disp(['lambdamin=' num2str(lambdamin) ', thetacrackrtl=' num2str(thetacrackrtl*180/pi) ' degrees']);
		%pause
        1;
		L=dESP/dt;
		dudx_rtl=dudx_rtl+L*dt;
    end
end
%}
%{
function MainHandler()
	% THE INPUTS here:
	CasetoRun=122;
	refinementfactorlist=[2:2:100];
	runorjustplot=0;
	%'Number of Cores? ' (for CasetoRun==14)
	numberofcores=4;
	
	
	spCount=[];
	lastindex=0;
	uiload;
	if exist('TimeStampedNameBasic');
		lastindex=newindex;
		if mfilename==TimeStampedNameBasic(1:length(mfilename));
		else
			for i=1:lastindex+1
				try
					copyfile([TimeStampedNameBasic '-ms=100-RefLvl=' num2str(refinementfactorlist(i)) '-Master.mat'],[mfilename TimeStampedNameBasic(length(mfilename)+1:length(TimeStampedNameBasic)) '-ms=100-RefLvl=' num2str(refinementfactorlist(i)) '-Master.mat']);
					copyfile([TimeStampedNameBasic '-ms=100-RefLvl=' num2str(refinementfactorlist(i))],[mfilename TimeStampedNameBasic(length(mfilename)+1:length(TimeStampedNameBasic)) '-ms=100-RefLvl=' num2str(refinementfactorlist(i))]);
				catch
					disp([TimeStampedNameBasic '-ms=100-RefLvl=' num2str(refinementfactorlist(i)) ' not found!']);
				end
			end
			TimeStampedNameBasic=[mfilename TimeStampedNameBasic(length(mfilename)+1:length(TimeStampedNameBasic))];
			save([TimeStampedNameBasic '-MainHandler.mat'],'-v7.3',...
			'spCount', ...
			'sigmainf', ...
			'pforce_sp', ...
			'stressnorm', ...
			'stressnormpersigmainf', ...
			'dispnorm', ...
			'gridsize', ...
			'G', ...
			'Ga', ...
			'Grelativeerror', ...
			'e_t_global_big', ...
			'e_sp', ...
			'Dmatrix', ...
			's_sp', ...
			'newindex', ...
			'TimeStampedNameBasic');
		end
	end
	for i=1:length(refinementfactorlist)
		if i<=lastindex
			continue;
		end
		newindex=length(spCount)+1;
		refinementfactor=refinementfactorlist(i);
		[spCount(newindex) sigmainf(newindex) TimeStampedNameBasic pforce_sp{newindex} stressnorm(newindex) dispnorm(newindex) gridsize(newindex) G(newindex) Ga(newindex) Grelativeerror(newindex) e_t_global_big{newindex} e_sp{newindex} Dmatrix s_sp{newindex}]=Main(refinementfactor,1,CasetoRun,runorjustplot,numberofcores);
		stressnormpersigmainf(newindex)=stressnorm(newindex)/sigmainf(newindex);
		save([TimeStampedNameBasic '-MainHandler.mat'],'-v7.3',...
		'spCount', ...
		'sigmainf', ...
		'pforce_sp', ...
		'stressnorm', ...
		'stressnormpersigmainf', ...
		'dispnorm', ...
		'gridsize', ...
		'G', ...
		'Ga', ...
		'Grelativeerror', ...
		'e_t_global_big', ...
		'e_sp', ...
		'Dmatrix', ...
		's_sp', ...
		'newindex', ...
		'TimeStampedNameBasic');
		1;
	end
end
%}

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [anerror spCount sigmainf TimeStampedNameBasic pforce_sp stressnorm dispnorm gridsize G Ga Grelativeerror, e_t_global_big e_sp Dmatrix s_sp]=Main(refinementfactor, HandlerNumber, CasetoRun, runorjustplot, numberofcores, VersionNum, frameskip, dumpresult)
	close all;
	Debugging.Active=0;
	Debugging.Case=111;
	Debugging.FileName='zz1904252320-111_CTSpecimen-ms=100-Dump.mat';
	Debugging.Time=0.32206501319960556539712115409202;
	Debugging.Particle=265;
	Debugging.DesignatedStopRepeater=1;
	
	ttstart=1;
	%clear all;
	%tic;
	%{
	addpath('SubFunctions/Cores');ressm
	addpath('SubFunctions/Constitutive_Models');
	addpath('SubFunctions/CPDI_solvers');
	addpath('SubFunctions/MPM_solvers');
	addpath('SubFunctions/TLS_MPM_solvers');
	addpath('SubFunctions/TLS_CPDI_solvers');
	addpath('SubFunctions/TLS');
	addpath('Particle_generation_input');
	%}
	
	%Remark='FlexiBeamLRTlocalstress';
	casenamelist=cell(1,194);
	casenamelist{1}='R_comp_MassScale';
	casenamelist{2}='T_comp_by_rotation_MassScale';
	casenamelist{3}='Radial_Fine';
	casenamelist{4}='Connection_TnSignored';
	casenamelist{5}='3-point_SEN';
	casenamelist{6}='3-point_SEN_touch';
	casenamelist{7}='Energy_Absorb';
	casenamelist{8}='3-point_SEN_lvar';
	casenamelist{9}='3-point_SEN_touch_lvar';
	casenamelist{10}='R_tension_dampnignore';
	casenamelist{11}='GerhardTensKnot';
	casenamelist{12}='StevenCompKnotCPDIFine';
	casenamelist{13}='GerhardMultiKnotFine';
	casenamelist{14}='GerhardCoreTest';
	casenamelist{15}='GerhardMultiKnotChopedOffFine';
	casenamelist{16}='StevenCompKnotOffsetFine';
	casenamelist{17}='RadialOldPerfectPlastic_EvalCounter';
	casenamelist{18}='StevenOffsetNoWeakening';
	casenamelist{19}='Radial_Elasticer';
	casenamelist{20}='GerhardMultiManualOrient';
	casenamelist{21}='Radial_Hover';
	casenamelist{22}='Radial_QuickHardening';
	casenamelist{23}='StevenOffNoWeakQuickHrdnig';
	casenamelist{24}='Radial_SlowHardening';
	casenamelist{25}='GerhardMultiManualEllipse';
	casenamelist{26}='Radial_RefineTest';
	casenamelist{27}='Radial_Scheduling_Test';
	casenamelist{28}='Radial_f_switcheroo';
	casenamelist{29}='Radial_f_switcheroo66';
	casenamelist{30}='Radial_f_noswitchRT36';
	casenamelist{31}='Radial_f_poissonedit';
	casenamelist{32}='GerhardTedManual';
	casenamelist{33}='Radial_CoarseTestBed';
	casenamelist{34}='Radial_fcMiksic';
	casenamelist{35}='GerhardTedManual_mfMiksic';
	casenamelist{36}='GerhardMoreOvalMiksic';
	casenamelist{37}='GerhardOvalSchmidt';
	casenamelist{38}='Steven_Birch';
	casenamelist{39}='Radial_Miksic_vreduced';
	casenamelist{40}='Radial_Miksic_widetop';
	casenamelist{41}='Steven_Birch_adjust';
	casenamelist{42}='Radial_MkcWide_ftrless';
	casenamelist{43}='Steven_Birch_AllowxMoveAtBot';
	casenamelist{44}='Steven_Birch_AllowxMoveAtTop';
	casenamelist{45}='Radial_MkcWide_fvHardeningIsBack';
	casenamelist{46}='Steven_Birch_normalshearhardening';
	casenamelist{47}='Steven_Birch_stronger_ftt';
	casenamelist{48}='Radial_MkcWide_ftrless_fttmore';
	casenamelist{49}='Steven_Birch_fclDown_ftlDownfcrUp';
	casenamelist{50}='Steven_Birch_ShearSoftening';
	casenamelist{51}='Steven_Birch_LinearScaling';
	casenamelist{52}='Radial_WideTop_Repositioned';
	casenamelist{53}='Steven_Birch_LinScale_xbotfree';
	casenamelist{54}='Radial_WideTop_Repositioned2_linearloading';
	casenamelist{55}='Gerhard_squishyball_2ndway_ortho2';
	casenamelist{56}='Gerhard_squishyball_3rdway_ortho2';
	casenamelist{57}='Gerhard_squishyball_1stway_ortho2';
	casenamelist{58}='Gerhard_squishyball_1stway_ortextreme';
	casenamelist{59}='Gerhard_squishyball_2ndway_ortextreme';
	casenamelist{60}='Gerhard_squishyball_3rdway_ortextreme';
	casenamelist{61}='Gerhard_squishyball_1stway_ortex2';
	casenamelist{62}='Gerhard_squishyball_2ndway_ortex2';
	casenamelist{63}='Gerhard_squishyball_3ndway_ortex2';
	casenamelist{64}='CRAMP Double Beam';
	casenamelist{65}='CRAMP_Double_Beam_Asymmetrical';
	casenamelist{66}='CRAMP_Double_Beam_Long';
	casenamelist{67}='ShrinkingBlob';
	casenamelist{68}='XYShrinkThickBlob';
	casenamelist{69}='CRAMP_Double_Beam_Force';
	casenamelist{70}='CRAMP_Double_Beam_Asymmetrical';
	casenamelist{71}='XYShrinkThinInitial';
	casenamelist{72}='XYShrinkThickInitiation';
	casenamelist{73}='XYShrinkAcousticInitiation';
	casenamelist{74}='XYShrinkDiscreteandQ';
	casenamelist{77}='Forceatcrackparticles';
	casenamelist{78}='XYShrinkDiscreteandQ_steel';
	casenamelist{79}='XYShrinkDiscreteandQ_steel_asym';
	casenamelist{80}='XYShrinkNairnQavg_steel_asym';
	casenamelist{81}='XYShrinkDiscreteandQ_steel'; %78 but refined
	casenamelist{82}='XYShrinkNairnQavg_steel_sym'; %80 but symmetrical initial crack
	casenamelist{83}='ShrinkNoSteelAvgQ_MultiCrackFail';
	casenamelist{84}='ShrinkNoSteelAvgQ_MultiCrackTestBed'; %2 crack cross split
	casenamelist{85}='SmallSpecimenDoubleCracks';
	casenamelist{86}='MediumSpecimenDoubleCracks';
	casenamelist{87}='MediumSpecimenDoubleCrackshalf';
	casenamelist{88}='ShrinkDoubleCrackSteel';
	casenamelist{89}='MediumSpecimenSingleCrackshalf';
	casenamelist{90}='MediumSpecimenDoubleCracksEdge';
	casenamelist{91}='MediumSpecimenDoubleCracksHalfnOut';
	casenamelist{92}='MediumSpecimenDoubleCracksHalfnOutCross';
	casenamelist{93}='MPMCheckupFrom92';
	casenamelist{94}='MediumSpecimenDoubleCracksHalfnEdge';
	casenamelist{95}='MediumSpecimenDoubleCracksHalfnHalf';
	casenamelist{96}='ShrinkBranchCrackSteel';
	casenamelist{97}='MediumSpecimenDoubleCracksCellCut';
	casenamelist{98}='DoubleCrackPropagate';
	casenamelist{99}='MediumSpecimenDoubleCracksEights';
	casenamelist{100}='XYShrinkNairnQavg_steel_sym_multi'; %80 but symmetrical initial crack
	casenamelist{101}='XYShrinkNairnQavg_singlecrack_multioptimized'; %100 but using quan's and optimized
	casenamelist{102}='XYShrinkNairnQavg_triplecrack_optimized';
	casenamelist{103}='DoubleCrackEdgeTest';
	casenamelist{104}='NoInitialCrack';
	casenamelist{105}='SingleInitialRefined'; %101 but refined
	casenamelist{106}='XYShrinkNairnQavg_doublecrack_optimized';
	casenamelist{107}='XYShrinkNairnQavg_doublecrackequal';
	casenamelist{108}='NoInitialCrack_randomtop';
	casenamelist{109}='SingleInitialFlippityFlop';
	casenamelist{110}='NoInitialRandomRefined';
	casenamelist{111}='CTSpecimen';
	casenamelist{112}='CantileverBeam';
	casenamelist{113}='CTSpecimen_slow';
	casenamelist{114}='NoInitialNoRandomNoSideroller';
	casenamelist{115}='InfinitePlate';
	casenamelist{116}='InfinitePlate2x2';
	casenamelist{117}='InfinitePlate2x2CrackParticleTest';
	casenamelist{118}='DanasPlate';
	casenamelist{119}='InfinitePlate2x2Norms';
	casenamelist{120}='InfinitePlate2x2Norms_pfconst'; %constant traction force
	casenamelist{121}='InfinitePlate2x2Norms_pgrid'; %traction on grid 
	casenamelist{122}='InfinitePlate2x2NormsAngled'; %angled crack infinite plane
	casenamelist{123}='CrackIntersectionTestBench';
	casenamelist{124}='NairnRadial';
	casenamelist{125}='AsymSingleLowDamp';
	casenamelist{126}='AsymSingleHighDamp';
	casenamelist{127}='SymNodeLeft';
	casenamelist{128}='SymNodeRight';
	casenamelist{129}='SymFloatLeft';
	casenamelist{130}='SymFloatRight';
	casenamelist{131}='SymFloatLeft_LongBeamPin';
	casenamelist{132}='SymFloatLeft_PullUpHorizontal';
	casenamelist{133}='SymFloatLeft_LongBeamPin_Directional';
	casenamelist{134}='SymFloatLeft_LongBeamShear';
	casenamelist{135}='SymLeft_LongBeamDir_Slow';
	casenamelist{136}='SymLeft_LongBeamShear_Slow';
	casenamelist{137}='InfinitePlate2x2Norms_revived';
	casenamelist{138}='InfinitePlate2x2Norms_revived2';
	casenamelist{139}='SymFloatLeft_LongBeamPin_FEM';
	casenamelist{140}='SymFloat_LongBeam_FEM_MixMode';
	casenamelist{141}='SymFloat_LongBeam_FEM_Mode1Only';
	casenamelist{142}='SymFloat_LongBeam_FEM_Mode2Only';
	casenamelist{143}='SymFloat_LongBeam_FEM_MixMode_revcomp';
	casenamelist{144}='PullColumnRegular';
	casenamelist{145}='PullColumnTwoSlices';
	casenamelist{146}='PullColumnNearDirichlet';
	casenamelist{147}='PullColumnNearPull';
	casenamelist{148}='PullColumnVeryNearDirichlet';
	casenamelist{149}='PullColumnNoCrack';
    casenamelist{150}='Cracked_Donut';
	casenamelist{151}='CrackMergePerpendicular';
    casenamelist{152}='Custom_Donut';
	casenamelist{153}='Donut_RingnoPetals';
	casenamelist{154}='Vortex';
	casenamelist{155}='DonutFixedLoad';
	casenamelist{156}='DonutPhasedPump';
	casenamelist{157}='DonutFixedLoadSoft';
	casenamelist{158}='DonutExploding';
	casenamelist{159}='DonutPhasedPumpRotate';
	casenamelist{160}='DonutSoftF=kDrcollective';
	casenamelist{161}='Vortex_Convergence';
	casenamelist{162}='DonutStableRotateActuator';
	casenamelist{163}='InitiationShow';
	casenamelist{164}='DonutCanRotateInitiation';
	casenamelist{165}='InitiationShow3';
	casenamelist{166}='InitiationShowPoint';
	casenamelist{167}='InitiationSquat';
	casenamelist{168}='Merging';
	casenamelist{169}='InitiationDouble';
	casenamelist{170}='InitiationOriginal163';
	casenamelist{171}='InitiationShearTract';
	casenamelist{172}='DonutRotateInitiatePerturbed';
	casenamelist{173}='DanasAsympLoading';
	casenamelist{174}='DonutRotateInitiateToughness';
	casenamelist{175}='DonutSoftF=kDrpropagate';
	casenamelist{176}='InitiationSquatPlasticCoder';
	casenamelist{177}='SimpleCrack';
	casenamelist{178}='SimpleMixedMode';
	casenamelist{179}='WoodStretchY';
	casenamelist{180}='DonutNoPropagation';
	casenamelist{181}='Merging_Convergence';
	casenamelist{182}='Merging_Convergence_Circle';
	casenamelist{183}='EnergyAbsorbingMovingTest';
	casenamelist{184}='CohesionTest1';
	casenamelist{185}='CohesionTest2_propagation';
	casenamelist{186}='CohesionTest2_propagation';
	casenamelist{187}='InitiationSquatCohesive';
	casenamelist{188}='MergingCohesive';
	casenamelist{189}='MergingCircleCohesive';
	casenamelist{190}='InitiationDouble';
	casenamelist{191}='MergingUpright';
	casenamelist{192}='DanasCohesive';
	casenamelist{193}='PizzaCheese';
	casenamelist{194}='DonutCohesive';
	
	fprintf('%s',['Case ' int2txt(CasetoRun) ': ' casenamelist{CasetoRun} ' selected' char(10)]);
	
	% Case 1: L Compression
	% Case 2: Connection
	casename=casenamelist{CasetoRun};
	
	if runorjustplot==0
		simulationbreaksignal=0;
	elseif runorjustplot==1 || runorjustplot==2
		simulationbreaksignal=1;
	end
	% Unit
	% Newton - seconds - metre
	% Unit Change In Progress: to N-mm-s
	
	%% Please select the versions of MPM!!!!!!!!!!!!!!!!!
	% Original MPM: 'MPM'
	% CPDI: 'CPDI'
	% Taylor least square MPM: 'TLS_MPM' 
	% Taylor least square CPDI: 'TLS_CPDI'
	
	% Please remember to change the output video file!!

	if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==21 || CasetoRun==17 || CasetoRun==4 || CasetoRun==5 || CasetoRun==6 || CasetoRun==7 || CasetoRun==8 || CasetoRun==9 || CasetoRun==10 || CasetoRun==11 || CasetoRun==12 || CasetoRun==16 || CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44 || CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==15 || CasetoRun==14 || CasetoRun==64 || CasetoRun==66 || CasetoRun==69 || CasetoRun==67 || CasetoRun==68 || CasetoRun==71 || CasetoRun==72 || CasetoRun==73 || CasetoRun==74 || CasetoRun==78 || CasetoRun==81 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==83 || CasetoRun==84 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124 || CasetoRun==117 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110 || CasetoRun==96 || CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89 || CasetoRun==85 || CasetoRun==77 || CasetoRun==65 || CasetoRun==70
		Version = 'CPDI';
	else
		Version = 'MPM';
	end
	
	%% Constutitive model
	% Linear_Elastic
	
	% Neo_Hookean_Elastic
	% Mises
	% Mises_Softening
	CModel = 'Wood_Schmidt17';
	%CModel = 'Linear_Elastic';
	%% Material porperties
	if CasetoRun==64 || CasetoRun==66 || CasetoRun==67 || CasetoRun==68 || CasetoRun==71 || CasetoRun==72 || CasetoRun==73 || CasetoRun==74 || CasetoRun==78 || CasetoRun==81 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==83 || CasetoRun==84 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==112 || CasetoRun==110 || CasetoRun==96 || CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89 || CasetoRun==85 || CasetoRun==77 || CasetoRun==65 || CasetoRun==70
		E                   = 400            ;
	elseif CasetoRun==111 || CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==117 || CasetoRun==113
		E                   = 8000      ;
	elseif CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153
		E=800;
	elseif CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180
		E=8;
	elseif CasetoRun==154 || CasetoRun==161
		E=1000          ;                  % Young modulus of solid
	elseif CasetoRun==127
		E=4000;
	elseif CasetoRun==124
		E=1200;
	elseif CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==4 || CasetoRun==5 || CasetoRun==6 || CasetoRun==7 || CasetoRun==8 || CasetoRun==9 || CasetoRun==10 || CasetoRun==11 || CasetoRun==12 || CasetoRun==13 || CasetoRun==14 || CasetoRun==15 || CasetoRun==16 || CasetoRun==17 || CasetoRun==18 || CasetoRun==19 || CasetoRun==20 || CasetoRun==21 || CasetoRun==22 || CasetoRun==23 || CasetoRun==24 || CasetoRun==25 || CasetoRun==26 || CasetoRun==27 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==32 || CasetoRun==33 || CasetoRun==34 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==38 || CasetoRun==39 || CasetoRun==40 || CasetoRun==41 || CasetoRun==42 || CasetoRun==43 || CasetoRun==44 || CasetoRun==45 || CasetoRun==46 || CasetoRun==47 || CasetoRun==48 || CasetoRun==49 || CasetoRun==50 || CasetoRun==51 || CasetoRun==52 || CasetoRun==53 || CasetoRun==54 || CasetoRun==55 || CasetoRun==56 || CasetoRun==57 || CasetoRun==58 || CasetoRun==59 || CasetoRun==60 || CasetoRun==61 || CasetoRun==62 || CasetoRun==63 || CasetoRun==69
		E                   = 200e3          ;                  % Young modulus of steel 200 GPa = 200e3 MPa = 200e3 N/mm2
	end
	%psp                     = 8e-7*1000            ;                  % solid density 800 kg/m3 = 800/1e9 kg/mm3 = 8e-7; scaled by the factor of 1000
	nu                      = 0.3           ;                  % Poison ratio
	g                       = 0            ;                  % gravity acceleration
	b_sp                    = [0 0];                                % body force
	
	if CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44
		ftl_spruce=65.5;
		fcl_spruce=-50.3;
		fcl=-47.6;
		ftl=ftl_spruce/fcl_spruce*fcl;
	else
		ftl=65.5;
		fcl=-50.3;
	end
	if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==21 || CasetoRun==17 || CasetoRun==37 || CasetoRun==23
		ftr=3.75;
		ftt=2.79;
		fvrt=1.83/1; %replacereplacereplace
		fvrl=6.34/1; %replacereplacereplace
		fvtl=5.34/1; %replacereplacereplace
		fcr=-6;
		fct=-6;
	elseif CasetoRun==28
		ftr=2.79;
		ftt=3.75;
		fvrt=1.83/1; %replacereplacereplace
		fvrl=6.34/1; %replacereplacereplace
		fvtl=5.34/1; %replacereplacereplace
		fcr=-3;
		fct=-6;
	elseif CasetoRun==29
		ftr=2.79;
		ftt=3.75;
		fvrt=1.83/1; %replacereplacereplace
		fvrl=6.34/1; %replacereplacereplace
		fvtl=5.34/1; %replacereplacereplace
		fcr=-6;
		fct=-6;
	elseif CasetoRun==30
		ftr=3.75;
		ftt=2.79;
		fvrt=1.83/1; %replacereplacereplace
		fvrl=6.34/1; %replacereplacereplace
		fvtl=5.34/1; %replacereplacereplace
		fcr=-3;
		fct=-6;
	elseif CasetoRun==31
		ftr=3.75;
		ftt=2.79;
		fvrt=1.83/1; %replacereplacereplace
		fvrl=6.34/1; %replacereplacereplace
		fvtl=5.34/1; %replacereplacereplace
		fcr=-6;
		fct=-6;
	elseif CasetoRun==33
		ftr=3.75;
		ftt=2.79;
		fvrt=1.83/1; %replacereplacereplace
		fvrl=6.34/1; %replacereplacereplace
		fvtl=5.34/1; %replacereplacereplace
		%fcr=-5.333333333333333333333333333333;
		%fct=-4;
		fcr=-3;
		fct=-6;
	elseif CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==39 || CasetoRun==35 || CasetoRun==36 || CasetoRun==45
		ftr=3.75;
		ftt=2.79;
		fvrt=1.83/1; %replacereplacereplace
		fvrl=6.34/1; %replacereplacereplace
		fvtl=5.34/1; %replacereplacereplace
		%fcr=-3;
		%fct=-6;
		fcr=-(1.5+4)/2;
		fct=-5;
	elseif CasetoRun==42
		ftr=3.75*0.7;
		ftt=2.79;
		fvrt=1.83/1; %replacereplacereplace
		fvrl=6.34/1; %replacereplacereplace
		fvtl=5.34/1; %replacereplacereplace
		%fcr=-3;
		%fct=-6;
		fcr=-(1.5+4)/2;
		fct=-5;
	elseif CasetoRun==4
		ftr=3.75;
		ftt=2.79;
		fvrt=1.83; %replacereplacereplace
		fvrl=6.34; %replacereplacereplace
		fvtl=5.34; %replacereplacereplace
		fcr=-6;
		fct=-6;
	elseif CasetoRun==5 || CasetoRun==6
		ftr=3.75;
		ftt=2.79;
		fvrt=1.83; %replacereplacereplace
		fvrl=6.34; %replacereplacereplace
		fvtl=5.34; %replacereplacereplace
		fcr=-6;
		fct=-6;
	elseif CasetoRun==7
		ftr=3.75;
		ftt=2.79;
		fvrt=1.83; %replacereplacereplace
		fvrl=6.34; %replacereplacereplace
		fvtl=5.34; %replacereplacereplace
		fcr=-6;
		fct=-6;
	elseif CasetoRun==8 || CasetoRun==9
		ftr=3.75;
		ftt=2.79;
		fvrt=1.83; %replacereplacereplace
		fvrl=6.34; %replacereplacereplace
		fvtl=5.34; %replacereplacereplace
		fcr=-6;
		fct=-6;
	elseif CasetoRun==10
		ftr=3.75;
		ftt=2.79;
		fvrt=1.83/1; %replacereplacereplace
		fvrl=6.34/1; %replacereplacereplace
		fvtl=5.34/1; %replacereplacereplace
		fcr=-6;
		fct=-3;
	elseif CasetoRun==11 || CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==15 || CasetoRun==14
		ftr=3.75;
		ftt=2.79;
		fvrt=1.83/1; %replacereplacereplace
		fvrl=6.34/1; %replacereplacereplace
		fvtl=5.34/1; %replacereplacereplace
		fcr=-6;
		fct=-3;
	elseif CasetoRun==12 || CasetoRun==16 || CasetoRun==18
		ftr=3.75;
		ftt=2.79;
		fvrt=1.83/1; %replacereplacereplace
		fvrl=6.34/1; %replacereplacereplace
		fvtl=5.34/1; %replacereplacereplace
		fcr=-6;
		fct=-3;
	elseif CasetoRun==38 || CasetoRun==50 || CasetoRun==46
		ftr_spruce=3.75;
		ftt_spruce=2.79;
		ftper_spruce=(ftr_spruce+ftt_spruce)/2;
		fvrt_spruce=1.83/1; %replacereplacereplace
		fvrl_spruce=6.34/1; %replacereplacereplace
		fvtl_spruce=5.34/1; %replacereplacereplace
		fcr_spruce=-(1.5+4)/2;
		fct_spruce=-5;
		fcper_spruce=(fcr_spruce+fct_spruce)/2;
		
		
		fcl_yellow=-144;
		fcper_yellow=-6.7;
		fcr_yellow=fcper_yellow/fcper_spruce*fcr_spruce;
		fct_yellow=fcper_yellow/fcper_spruce*fct_spruce;
		
		fcr=fcl/fcl_yellow*fcr_yellow;
		fct=fcl/fcl_yellow*fct_yellow;
		
		fvrt=fcl/fcl_spruce*fvrt_spruce;
		fvrl=fcl/fcl_spruce*fvrl_spruce;
		fvtl=fcl/fcl_spruce*fvtl_spruce;
		
		ftper_yellow=6.3;
		ftr_yellow=ftr_spruce/ftper_spruce*ftper_yellow;
		ftt_yellow=ftt_spruce/ftper_spruce*ftper_yellow;
		
		ftr=ftr_yellow/fcl_yellow*fcl;
		ftt=ftt_yellow/fcl_yellow*fcl;
	elseif CasetoRun==51 || CasetoRun==53
		ftr_spruce=3.75;
		ftt_spruce=2.79;
		fvrt_spruce=1.83/1; %replacereplacereplace
		fvrl_spruce=6.34/1; %replacereplacereplace
		fvtl_spruce=5.34/1; %replacereplacereplace
		fcr_spruce=-(1.5+4)/2;
		fct_spruce=-5;
		fcl=47.6;
		fcr=fcl/fcl_spruce*fcr_spruce;
		fct=fcl/fcl_spruce*fct_spruce;
		ftl=fcl/fcl_spruce*ftl_spruce;
		ftr=fcl/fcl_spruce*ftr_spruce;
		ftt=fcl/fcl_spruce*ftt_spruce;
		fvrt=fcl/fcl_spruce*fvrt_spruce;
		fvrl=fcl/fcl_spruce*fvrl_spruce;
		fvtl=fcl/fcl_spruce*fvtl_spruce;
	elseif CasetoRun==49
		ftr_spruce=3.75;
		ftt_spruce=2.79;
		ftper_spruce=(ftr_spruce+ftt_spruce)/2;
		fvrt_spruce=1.83/1; %replacereplacereplace
		fvrl_spruce=6.34/1; %replacereplacereplace
		fvtl_spruce=5.34/1; %replacereplacereplace
		fcr_spruce=-(1.5+4)/2;
		fct_spruce=-5;
		fcper_spruce=(fcr_spruce+fct_spruce)/2;
		
		
		fcl_yellow=-144;
		fcper_yellow=-6.7;
		fcr_yellow=fcper_yellow/fcper_spruce*fcr_spruce;
		fct_yellow=fcper_yellow/fcper_spruce*fct_spruce;
		
		fcr=fcl/fcl_yellow*fcr_yellow;
		fct=fcl/fcl_yellow*fct_yellow;
		
		fvrt=fcl/fcl_spruce*fvrt_spruce;
		fvrl=fcl/fcl_spruce*fvrl_spruce;
		fvtl=fcl/fcl_spruce*fvtl_spruce;
		
		ftper_yellow=6.3;
		ftr_yellow=ftr_spruce/ftper_spruce*ftper_yellow;
		ftt_yellow=ftt_spruce/ftper_spruce*ftper_yellow;
		
		ftr=ftr_yellow/fcl_yellow*fcl;
		ftt=ftt_yellow/fcl_yellow*fcl;
		fcr=fcr*1.3;
		ftl=ftl*0.7;

	elseif CasetoRun==41 || CasetoRun==43 || CasetoRun==44
		ftr_spruce=3.75;
		ftt_spruce=2.79;
		ftper_spruce=(ftr_spruce+ftt_spruce)/2;
		fvrt_spruce=1.83/1; %replacereplacereplace
		fvrl_spruce=6.34/1; %replacereplacereplace
		fvtl_spruce=5.34/1; %replacereplacereplace
		fvrltl_spruce=(fvrl_spruce+fvtl_spruce)/2;
		
		fcr_spruce=-(1.5+4)/2;
		fct_spruce=-5;
		fcper_spruce=(fcr_spruce+fct_spruce)/2;
		
		fvrltl_yellow=13;
		fvrl_yellow=fvrltl_yellow/fvrltl_spruce*fvrl_spruce;
		fvtl_yellow=fvrltl_yellow/fvrltl_spruce*fvtl_spruce;
		fvrt_yellow=fvrltl_yellow/fvrltl_spruce*fvrt_spruce;
		
		fcl_yellow=-144;
		fcper_yellow=-6.7;
		fcr_yellow=fcper_yellow/fcper_spruce*fcr_spruce;
		fct_yellow=fcper_yellow/fcper_spruce*fct_spruce;
		
		fcr=fcl/fcl_yellow*fcr_yellow;
		fct=fcl/fcl_yellow*fct_yellow;
		
		fvrt=fcl/fcl_yellow*fvrt_yellow;
		fvrl=fcl/fcl_yellow*fvrl_yellow;
		fvtl=fcl/fcl_yellow*fvtl_yellow;
		
		ftper_yellow=6.3;
		ftr_yellow=ftr_spruce/ftper_spruce*ftper_yellow;
		ftt_yellow=ftt_spruce/ftper_spruce*ftper_yellow;
		
		ftr=ftr_yellow/fcl_yellow*fcl;
		ftt=ftt_yellow/fcl_yellow*fcl;
	elseif CasetoRun==47
		ftr_spruce=3.75;
		ftt_spruce=2.79;
		ftper_spruce=(ftr_spruce+ftt_spruce)/2;
		fvrt_spruce=1.83/1; %replacereplacereplace
		fvrl_spruce=6.34/1; %replacereplacereplace
		fvtl_spruce=5.34/1; %replacereplacereplace
		fcr_spruce=-(1.5+4)/2;
		fct_spruce=-5;
		fcper_spruce=(fcr_spruce+fct_spruce)/2;
		
		
		fcl_yellow=-144;
		fcper_yellow=-6.7;
		fcr_yellow=fcper_yellow/fcper_spruce*fcr_spruce;
		fct_yellow=fcper_yellow/fcper_spruce*fct_spruce;
		
		fcr=fcl/fcl_yellow*fcr_yellow;
		fct=fcl/fcl_yellow*fct_yellow;
		
		fvrt=fcl/fcl_spruce*fvrt_spruce;
		fvrl=fcl/fcl_spruce*fvrl_spruce;
		fvtl=fcl/fcl_spruce*fvtl_spruce;
		
		ftper_yellow=6.3;
		ftr_yellow=ftr_spruce/ftper_spruce*ftper_yellow;
		ftt_yellow=ftt_spruce/ftper_spruce*ftper_yellow;
		
		ftr=ftr_yellow/fcl_yellow*fcl;
		ftt=ftt_yellow/fcl_yellow*fcl;
		ftt=ftt*1.5;
	elseif CasetoRun==48
		ftr=3.75;
		ftt=2.79*1.6;
		fvrt=1.83/1; %replacereplacereplace
		fvrl=6.34/1; %replacereplacereplace
		fvtl=5.34/1; %replacereplacereplace
		%fcr=-3;
		%fct=-6;
		fcr=-(1.5+4)/2;
		fct=-5;
	elseif CasetoRun==64 || CasetoRun==66 || CasetoRun==69 || CasetoRun==67 || CasetoRun==68 || CasetoRun==71 || CasetoRun==72 || CasetoRun==73 || CasetoRun==74 || CasetoRun==78 || CasetoRun==81 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==83 || CasetoRun==84 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124 || CasetoRun==117 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110 || CasetoRun==96 || CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89 || CasetoRun==85 || CasetoRun==77 || CasetoRun==65 || CasetoRun==70
		ftr=3.75;
		ftt=2.79;
		fvrt=1.83/1; %replacereplacereplace
		fvrl=6.34/1; %replacereplacereplace
		fvtl=5.34/1; %replacereplacereplace
		%fcr=-3;
		%fct=-6;
		fcr=-(1.5+4)/2;
		fct=-5;
	else
		ftr=3.75;
		ftt=2.79;
		fvrt=1.83/1; %replacereplacereplace
		fvrl=6.34/1; %replacereplacereplace
		fvtl=5.34/1; %replacereplacereplace
		%fcr=-3;
		%fct=-6;
		fcr=-(1.5+4)/2;
		fct=-5;
	end
	
	if CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44
		El=14804;
		Et=0.050*El;
		Er=0.078*El;
		Grt=0.074*El;
		Gtl=0.068*El;
		Grl=0.017*El;
	else
		Er=820/1; %replacereplacereplace
		Et=430/1; %replacereplacereplace
		El=13200/1; %replacereplacereplace
		Grt=40/1; %replacereplacereplace
		Gtl=730/1; %replacereplacereplace
		Grl=660/1; %replacereplacereplace
	end
	if CasetoRun==19 || CasetoRun==21
		ReductionFactor=1;
		Er=820/ReductionFactor; %replacereplacereplace
		Et=430/ReductionFactor; %replacereplacereplace
		El=13200/ReductionFactor; %replacereplacereplace
		Grt=40/ReductionFactor; %replacereplacereplace
		Gtl=730/ReductionFactor; %replacereplacereplace
		Grl=660/ReductionFactor; %replacereplacereplace
	end

	if CasetoRun==31 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37
		nurt=0.24;
		nutl=0.47;
		nurl=0.42;
	elseif CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44
		nurt=0.426;
		nutl=0.451;
		nurl=0.426;
	else
		nurt=0.24;
		nutl=0.45;
		nurl=0.45;
	end

	%Er=El;
	%Et=El;
	%Grt=Grl;
	%Gtl=Grl;
	%nurt=nurl;
	%nutl=nurl;

	kappa1=0.00001;
	kappa2=1.2;
	kappa3=0.00001;
	kappa4=1.2;
	kappa5=0.00001;
	kappa6=0.7;
	if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==21 || CasetoRun==12 || CasetoRun==16 || CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44 || CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==15 || CasetoRun==14
		kappa7=1.0;
	elseif CasetoRun==39 || CasetoRun==50
		kappa7=0.2;
	else
		kappa7=1.2;
	end

	Gftl=1650/1000;
	Gfcl=50000/1000;
	Gftr=300/1000;
	Gftt=Gftr;
	Gfcr=Gftr/Gftl*Gfcl;
	Gfct=Gfcr;
	GII=300/1000;

	Hld=15;
	Hrd=2;
	Htd=Hrd;

	lccrit=El*Gftl/abs(ftl);
	%lc=lccrit/100;
	%lc=10;
	
	
	
	if CasetoRun==22 || CasetoRun==23
		alpha2dnounit=0.1;
		alpha2maxnounit=0.2;
		alpha4dnounit=0.1;
		alpha4maxnounit=0.2;
		alpha6dnounit=0.1;
		alpha6maxnounit=0.2;
	elseif CasetoRun==24
		alpha2dnounit=0.5;
		alpha2maxnounit=0.75;
		alpha4dnounit=0.5;
		alpha4maxnounit=0.75;
		alpha6dnounit=0.5;
		alpha6maxnounit=0.75;
	else
		alpha2dnounit=0.1;
		alpha2maxnounit=0.75;
		alpha4dnounit=0.1;
		alpha4maxnounit=0.75;
		alpha6dnounit=0.5;
		alpha6maxnounit=0.75;
	end
	if CasetoRun==5 || CasetoRun==6 || CasetoRun==7 || CasetoRun==8 || CasetoRun==9 || CasetoRun==10 || CasetoRun==11 || CasetoRun==17 || CasetoRun==45 || CasetoRun==46
		%the default value
		alpha7dnounit=0.1;
		alpha7maxnounit=0.75;
	elseif CasetoRun==4
		alpha7dnounit=0.05;
		alpha7maxnounit=0.1;
	elseif CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==21 || CasetoRun==12 || CasetoRun==16 || CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==49 || CasetoRun==47 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44 || CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==15 || CasetoRun==14
		alpha7dnounit=1.0;
		alpha7maxnounit=1.5;
	elseif CasetoRun==39 || CasetoRun==50
		alpha7dnounit=inf;
		alpha7maxnounit=inf;
	elseif CasetoRun==64 || CasetoRun==66 || CasetoRun==69 || CasetoRun==67 || CasetoRun==68 || CasetoRun==71 || CasetoRun==72 || CasetoRun==73 || CasetoRun==74 || CasetoRun==78 || CasetoRun==81 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==83 || CasetoRun==84 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124 || CasetoRun==117 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110 || CasetoRun==96 || CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89 || CasetoRun==85 || CasetoRun==77 || CasetoRun==65 || CasetoRun==70
		alpha7dnounit=0.1;
		alpha7maxnounit=0.75;
	else
		alpha7dnounit=0.1;
		alpha7maxnounit=0.75;
	end
	

	
	%Intended specimen: L = 10 cm, t = 2 cm, delta_u = 1 cm
	NN=zeros(1,2);
	le=zeros(1,2);
	if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==21 || CasetoRun==17
		%% Structured Grid input
		if CasetoRun==26
		elseif CasetoRun==33 || CasetoRun==34 || CasetoRun==39
			refinementfactor      = 1;
		else
			refinementfactor      = 2;
		end
		NN(1)                 = (11-1)*refinementfactor+1;%33;                               % number of nodes in X direction
		NN(2)                 = (17-1)*refinementfactor+1;%13;                               % number of nodes in Y direction
		le_base               = 10;
		le(1)                 = le_base/refinementfactor;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);
	elseif CasetoRun==4
		%% Structured Grid input
		NN(1)                 = 15;%33;                               % number of nodes in X direction
		NN(2)                 = 22;%13;                               % number of nodes in Y direction
		le(1)                 = 10;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);
		le_base=10;
	elseif CasetoRun==5 || CasetoRun==6
		 NN(1)                = 24;
		 NN(2)                = 14;
		 le_base              = 6.25;
		 le(1)                = le_base;
		 le(2)                = le(1);
		 lc=le(1);
	elseif CasetoRun==7
		%% Structured Grid input
		NN(1)                 = 11;%33;                               % number of nodes in X direction
		NN(2)                 = 17;%13;                               % number of nodes in Y direction
		le_base               = 12;
		le(1)                 = le_base;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);
	elseif CasetoRun==8 || CasetoRun==9
		le_x=[];
		le_y=[];
		le_base              = 6.25;
		notchwidth=le_base/5;
		for i=1:11
			le_x=VectorInsertion(le_x,i,le_base);
			le_x=VectorInsertion(le_x,i+14,le_base);
		end
		le_x=VectorInsertion(le_x,12,(le_base-notchwidth)/2);
		le_x=VectorInsertion(le_x,13,notchwidth);
		le_x=VectorInsertion(le_x,14,le_x(12));
		for i=1:6
			le_y=VectorInsertion(le_y,i,le_base)
		end
		le_y=VectorInsertion(le_y,7,notchwidth);
		le_y=VectorInsertion(le_y,8,le_base-notchwidth);
		for j=9:14
			le_y=VectorInsertion(le_y,j,le_base);
		end
		NN(1)                = length(le_x)+1;
		NN(2)                = length(le_y)+1;
		le(1)                = le_base;
		le(2)                = le(1);
		lc=le(1);
	elseif CasetoRun==10
		%% Structured Grid input
		NN(1)                 = 11;%33;                               % number of nodes in X direction
		NN(2)                 = 19;%13;                               % number of nodes in Y direction
		le_base               = 12;
		le(1)                 = le_base;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);
	elseif CasetoRun==11
		%% Structured Grid input
		refinementfactor=1;
		NN(1)                 = (10-1)*refinementfactor+1;%33;                               % number of nodes in X direction
		NN(2)                 = (23-1)*refinementfactor+1;%13;                               % number of nodes in Y direction
		le_base               = 25;
		le(1)                 = le_base/refinementfactor;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);
	elseif CasetoRun==12 || CasetoRun==16 || CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44
		%% Structured Grid input
		refinementfactor=2;
		NN(1)                 = (11-1)*refinementfactor+1;%33;                               % number of nodes in X direction
		NN(2)                 = (23-1)*refinementfactor+1;%13;                               % number of nodes in Y direction
		le_base               = 15;
		le(1)                 = le_base/refinementfactor;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);
	elseif CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==15 || CasetoRun==14
		%% Structured Grid input
		refinementfactor=3;
		NN(1)                 = (10-1)*refinementfactor+1;%33;                               % number of nodes in X direction
		NN(2)                 = (23-1)*refinementfactor+1;%13;                               % number of nodes in Y direction
		le_base               = 25;
		le(1)                 = le_base/refinementfactor;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);
	elseif CasetoRun==64 || CasetoRun==65 || CasetoRun==70
		%% Structured Grid input
		refinementfactor=1;
		NN(1)                 = (11-1)*refinementfactor+1;%33;                               % number of nodes in X direction
		NN(2)                 = (12-1)*refinementfactor+1;%13;                               % number of nodes in Y direction
		le_base               = 10;
		le(1)                 = le_base/refinementfactor;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);
	elseif CasetoRun==66 || CasetoRun==69
		%% Structured Grid input
		refinementfactor=1;
		NN(1)                 = (16-1)*refinementfactor+1;%33;                               % number of nodes in X direction
		NN(2)                 = (12-1)*refinementfactor+1;%13;                               % number of nodes in Y direction
		le_base               = 10;
		le(1)                 = le_base/refinementfactor;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);
	elseif CasetoRun==67
		%% Structured Grid input
		refinementfactor=1;
		NN(1)                 = (25-1)*refinementfactor+1;%33;                               % number of nodes in X direction
		NN(2)                 = (9-1)*refinementfactor+1;%13;                               % number of nodes in Y direction
		le_base               = 5;
		le(1)                 = le_base/refinementfactor;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);
	elseif CasetoRun==68 || CasetoRun==71 || CasetoRun==74 || CasetoRun==78 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==83 || CasetoRun==77 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==110 || CasetoRun==96
		%% Structured Grid input
		if CasetoRun==105 || CasetoRun==110
			refinementfactor=2;
		else
			refinementfactor=1;
		end
		NN(1)                 = (25-1)*refinementfactor+1;%33;                               % number of nodes in X direction
		NN(2)                 = (13-1)*refinementfactor+1;%13;                               % number of nodes in Y direction
		le_base               = 5;
		le(1)                 = le_base/refinementfactor;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);
	elseif CasetoRun==111 || CasetoRun==113
		%% Structured Grid input
		refinementfactor=1;
		NN(1)                 = (20-1)*refinementfactor+1;%33;                               % number of nodes in X direction
		NN(2)                 = (21-1)*refinementfactor+1;%13;                               % number of nodes in Y direction
		le_base               = 3;
		le(1)                 = le_base/refinementfactor;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);
	elseif CasetoRun==115
		%% Structured Grid input
		%refinementfactor=1;
		NN(1)                 = (8-1)*refinementfactor+1;%33;                               % number of nodes in X direction
		NN(2)                 = (8-1)*refinementfactor+1;%13;                               % number of nodes in Y direction
		le_base               = 3;
		le(1)                 = le_base/refinementfactor;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);
	elseif CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==117
		%% Structured Grid input
		%refinementfactor=1;
		NN(1)                 = (7-1)*refinementfactor+1;%33;                               % number of nodes in X direction
		NN(2)                 = (7-1)*refinementfactor+1;%13;                               % number of nodes in Y direction
		le_base               = 5;
		le(1)                 = le_base/refinementfactor;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);
	elseif CasetoRun==138
		%% Structured Grid input
		%refinementfactor=1;
		NN(1)                 = (7-1)*refinementfactor+1;%33;                               % number of nodes in X direction
		NN(2)                 = (7-1)*refinementfactor+1;%13;                               % number of nodes in Y direction
		le_base               = 4.5;
		le(1)                 = le_base/refinementfactor;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);
	elseif CasetoRun==192
		NN(1)                 = (7-1)*refinementfactor+1;%33;                               % number of nodes in X direction
		NN(2)                 = (7-1)*refinementfactor+1;%13;                               % number of nodes in Y direction
		le_base               = 1000;
		le(1)                 = le_base/refinementfactor;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);
	elseif CasetoRun==118 || CasetoRun==173
		NN(1)                 = (7-1)*refinementfactor+1;%33;                               % number of nodes in X direction
		NN(2)                 = (7-1)*refinementfactor+1;%13;                               % number of nodes in Y direction
		le_base               = 1;
		le(1)                 = le_base/refinementfactor;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);
	elseif CasetoRun==179
		NN(1)                 = (8-1)*refinementfactor+1;%33;                               % number of nodes in X direction
		NN(2)                 = (8-1)*refinementfactor+1;%13;                               % number of nodes in Y direction
		le_base               = 200;
		le(1)                 = le_base/refinementfactor;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);
	elseif CasetoRun==177 || CasetoRun==178
		NN(1)                 = (8-1)*refinementfactor+1;%33;                               % number of nodes in X direction
		NN(2)                 = (8-1)*refinementfactor+1;%13;                               % number of nodes in Y direction
		le_base               = 1;
		le(1)                 = le_base/refinementfactor;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);
	elseif CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==169
		NN(1)                 = (8-1)*refinementfactor+1;%33;                               % number of nodes in X direction
		NN(2)                 = (8-1)*refinementfactor+1;%13;                               % number of nodes in Y direction
		le_base               = 100;
		le(1)                 = le_base/refinementfactor;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);
	elseif CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128
		NN(1)                 = (9-1)*refinementfactor+1;%33;                               % number of nodes in X direction
		NN(2)                 = (7-1)*refinementfactor+1;%13;                               % number of nodes in Y direction
		le_base               = 1;
		le(1)                 = le_base/refinementfactor;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);
	elseif CasetoRun==129 || CasetoRun==132 || CasetoRun==130
		NN(1)                 = (9-1)*refinementfactor+1;%33;                               % number of nodes in X direction
		NN(2)                 = (8-1)*refinementfactor+1;%13;                               % number of nodes in Y direction
		le_base               = 1;
		le(1)                 = le_base/refinementfactor;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);
	elseif CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==140 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142
		NN(1)                 = (13-1)*refinementfactor+1;%33;                               % number of nodes in X direction
		NN(2)                 = (8-1)*refinementfactor+1;%13;                               % number of nodes in Y direction
		le_base               = 1;
		le(1)                 = le_base/refinementfactor;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);
	elseif CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==147 || CasetoRun==145
		NN(1)                 = (16-1)*refinementfactor+1;%33;                               % number of nodes in X direction
		NN(2)                 = (8-1)*refinementfactor+1;%13;                               % number of nodes in Y direction
		le_base               = 1;
		le(1)                 = le_base/refinementfactor;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);
	elseif CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153
		NN(1)                 = (15-1)*refinementfactor+1;%33;                               % number of nodes in X direction
		NN(2)                 = (15-1)*refinementfactor+1;%13;                               % number of nodes in Y direction
		le_base               = 1;
		le(1)                 = le_base/refinementfactor;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);	
	elseif CasetoRun==154 || CasetoRun==161
		NN(1)                 = (33-1)*refinementfactor+1;%33;                               % number of nodes in X direction
		NN(2)                 = (33-1)*refinementfactor+1;%13;                               % number of nodes in Y direction
		le_base               = 0.25;
		le(1)                 = le_base/refinementfactor;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);	
	elseif CasetoRun==134 || CasetoRun==136
		NN(1)                 = (11-1)*refinementfactor+1;%33;                               % number of nodes in X direction
		NN(2)                 = (8-1)*refinementfactor+1;%13;                               % number of nodes in Y direction
		le_base               = 1;
		le(1)                 = le_base/refinementfactor;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);
	elseif CasetoRun==124
		NN(1)                 = (11-1)*refinementfactor+1;%33;                               % number of nodes in X direction
		NN(2)                 = (10-1)*refinementfactor+1;%13;                               % number of nodes in Y direction
		le_base               = 1.3;
		le(1)                 = le_base/refinementfactor;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);
	elseif CasetoRun==112
		%% Structured Grid input
		refinementfactor=1;
		NN(1)                 = (17-1)*refinementfactor+1;%33;                               % number of nodes in X direction
		NN(2)                 = (18-1)*refinementfactor+1;%13;                               % number of nodes in Y direction
		le_base               = 5;
		le(1)                 = le_base/refinementfactor;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);
	elseif CasetoRun==84
		%% Structured Grid input
		refinementfactor=1;
		NN(1)                 = (26-1)*refinementfactor+1;%33;                               % number of nodes in X direction
		NN(2)                 = (14-1)*refinementfactor+1;%13;                               % number of nodes in Y direction
		le_base               = 5;
		le(1)                 = le_base/refinementfactor;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);
	elseif CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==90 || CasetoRun==89
		%% Structured Grid input
		refinementfactor=1;
		NN(1)                 = (12-1)*refinementfactor+1;%33;                               % number of nodes in X direction
		NN(2)                 = (11-1)*refinementfactor+1;%13;                               % number of nodes in Y direction
		le_base               = 10;
		le(1)                 = le_base/refinementfactor;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);
	elseif CasetoRun==93
		%% Structured Grid input
		refinementfactor=1;
		NN(1)                 = (12-1)*refinementfactor+1;%33;                               % number of nodes in X direction
		NN(2)                 = (11-1)*refinementfactor+1;%13;                               % number of nodes in Y direction
		le_base               = 10;
		le(1)                 = le_base/refinementfactor;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);
	elseif CasetoRun==85
		%% Structured Grid input
		refinementfactor=1;
		NN(1)                 = (5-1)*refinementfactor+1;%33;                               % number of nodes in X direction
		NN(2)                 = (5-1)*refinementfactor+1;%13;                               % number of nodes in Y direction
		le_base               = 10;
		le(1)                 = le_base/refinementfactor;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);
	elseif CasetoRun==81
		%% Structured Grid input
		refinementfactor=2;
		NN(1)                 = (25-1)*refinementfactor+1;%33;                               % number of nodes in X direction
		NN(2)                 = (13-1)*refinementfactor+1;%13;                               % number of nodes in Y direction
		le_base               = 5;
		le(1)                 = le_base/refinementfactor;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);
	elseif CasetoRun==72 || CasetoRun==73
		%% Structured Grid input
		refinementfactor=1;
		NN(1)                 = (26-1)*refinementfactor+1;%33;                               % number of nodes in X direction
		NN(2)                 = (13-1)*refinementfactor+1;%13;                               % number of nodes in Y direction
		le_base               = 5;
		le(1)                 = le_base/refinementfactor;%0.5;                              % size of element in X direction
		le(2)                 = le(1);                          % size of element in Y direction
		lc=le(1);
	end
	niCount=NN(1)*NN(2);
	fbcx=zeros(1,niCount);
	coder.varsize('fbcx');
	fbcy=zeros(1,niCount);
	coder.varsize('fbcy');
	%% Grid generation
	le_c=[];
	LOCX=[];
	LOCY=[];
	
	
	%[] early definitions
	%start of predvel vectorized definitions
	PredVelVect.XNodes=zeros(1,niCount);
	PredVelVect.YNodes=zeros(1,niCount);
	PredVelVect.XDisp=zeros(1,niCount);
	PredVelVect.YDisp=zeros(1,niCount);
	PredVelVect.XVel=zeros(1,niCount);
	PredVelVect.YVel=zeros(1,niCount);
	PredVelVect.XAcc=zeros(1,niCount);
	PredVelVect.YAcc=zeros(1,niCount);
	PredVelVect.XPhase=zeros(1,niCount);
	PredVelVect.YPhase=zeros(1,niCount);
	PredVelVect.nX=zeros(1,1);
	PredVelVect.nY=zeros(1,1);
	
	PredXVelVect=[];
	PredYVelVect=[];
	PredXAccVect=[];
	PredYAccVect=[];
	NodeswithPredXVelVect=[];
	NodeswithPredYVelVect=[];
	PredXVelPhase=[];
	PredYVelPhase=[];
	%end of predvel vectorized definitions
	
	N0.CONNECTpn.values=zeros(niCount,100);
	N0.CONNECTpn.nrparticles=zeros(1,niCount);
	N0.Npn.values=zeros(niCount,100);
	N0.Npn.nrparticles=zeros(1,niCount);

	
	
	if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==21 || CasetoRun==17 || CasetoRun==4 || CasetoRun==5 || CasetoRun==6 || CasetoRun==7 || CasetoRun==11 || CasetoRun==12 || CasetoRun==16 || CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44 || CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==15 || CasetoRun==14
		[LOC,LOCC,cellCount,nodeCount] = Grid_Generation(NN,le);
	elseif CasetoRun==8 || CasetoRun==9
		[LOC,LOCC,cellCount,nodeCount,LOCX,LOCY,le_c] = Grid_Generation_var(NN,le_x,le_y);
		%x_p=le_base*11;
		%y_p=le_base*6;
		%[thecell, thenodes]= ...
		%    identifycellsandnodes([x_p y_p],LOCX,LOCY,[],[],[1 1 0 0]);
	elseif CasetoRun==10
		[LOC,LOCC,cellCount,nodeCount] = Grid_Generation(NN,le);
	else
		[LOC,LOCC,cellCount,nodeCount] = Grid_Generation(NN,le); %Case 64 goes here so far 190128
	end


	% nodeCount: total number of nodes
	% cellCount: total number of elements
	% LOC(n,1:2): localtion coordinate of node "n" in x(1) and y(2) direction
	% LOCC(e,1:2): localtion coordinate of element centroid "e" in x(1) and y(2) direction

	%% Nodes with predefined velocities (conveyer)
	NumberofNodeswithPredXVel=0;
	NodeswithPredXVel=[];

	NumberofNodeswithPredXVel2=0;
	NodeswithPredXVel2=[];

	NumberofNodeswithPredYVel=0;
	NodeswithPredYVel=[];

	NumberofNodeswithPredYVel2=0;
	NodeswithPredYVel2=[];


	if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==17
		for i=1:size(LOC,1)
			if LOC(i,2)>le_base*10-1e-3 & LOC(i,2)<le_base*10+1e-3
				NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
				NodeswithPredYVel=VectorInsertion(NodeswithPredYVel,NumberofNodeswithPredYVel,i);
			end
			%if ((LOC(i,1)-100)^2<1e-6 | (LOC(i,1)-40)^2<1e-6) & (LOC(i,2)-50)^2<1e-6
			%    NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
			%    NodeswithPredYVel(NumberofNodeswithPredYVel)=i;
			%end
		end
	elseif CasetoRun==21
		for i=1:size(LOC,1)
			if LOC(i,2)>le_base*10+2*le(2)-1e-3 & LOC(i,2)<le_base*10+2*le(2)+1e-3
				NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
				NodeswithPredYVel=VectorInsertion(NodeswithPredYVel,NumberofNodeswithPredYVel,i);
			end
			%if ((LOC(i,1)-100)^2<1e-6 | (LOC(i,1)-40)^2<1e-6) & (LOC(i,2)-50)^2<1e-6
			%    NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
			%    NodeswithPredYVel(NumberofNodeswithPredYVel)=i;
			%end
		end    
	elseif CasetoRun==4
		for i=1:size(LOC,1)
			%if (LOC(i,1)-90)^2<1e-6 | (LOC(i,1)-100)^2<1e-6 | (LOC(i,1)-110)^2<1e-6 | (LOC(i,1)-120)^2<1e-6 | (LOC(i,1)-130)^2<1e-6 | (LOC(i,1)-140)^2<1e-6
			%    NumberofNodeswithPredXVel=NumberofNodeswithPredXVel+1;
			%    NodeswithPredXVel(NumberofNodeswithPredXVel)=i;
			%end
			if (LOC(i,2)-170)^2<1e-6
				NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
				NodeswithPredYVel=VectorInsertion(NodeswithPredYVel,NumberofNodeswithPredYVel,i);
			end
		end
	elseif CasetoRun==5 || CasetoRun==6
		for i=1:size(LOC,1)
			if LOC(i,2)>le_base*10-1e-3 & LOC(i,2)<le_base*10+1e-3
				NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
				NodeswithPredYVel=VectorInsertion(NodeswithPredYVel,NumberofNodeswithPredYVel,i);
			end
			%if ((LOC(i,1)-100)^2<1e-6 | (LOC(i,1)-40)^2<1e-6) & (LOC(i,2)-50)^2<1e-6
			%    NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
			%    NodeswithPredYVel(NumberofNodeswithPredYVel)=i;
			%end
		end
	elseif CasetoRun==7
		for i=1:size(LOC,1)
			if LOC(i,2)>le_base*10-1e-3 & LOC(i,2)<le_base*10+1e-3
				NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
				NodeswithPredYVel=VectorInsertion(NodeswithPredYVel,NumberofNodeswithPredYVel,i);
			end
			%if ((LOC(i,1)-100)^2<1e-6 | (LOC(i,1)-40)^2<1e-6) & (LOC(i,2)-50)^2<1e-6
			%    NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
			%    NodeswithPredYVel(NumberofNodeswithPredYVel)=i;
			%end
		end
	elseif CasetoRun==8 || CasetoRun==9
		for i=1:size(LOC,1)
			if LOC(i,2)>le_base*10-1e-3 & LOC(i,2)<le_base*10+1e-3
				NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
				NodeswithPredYVel=VectorInsertion(NodeswithPredYVel,NumberofNodeswithPredYVel,i);
			end
			%if ((LOC(i,1)-100)^2<1e-6 | (LOC(i,1)-40)^2<1e-6) & (LOC(i,2)-50)^2<1e-6
			%    NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
			%    NodeswithPredYVel(NumberofNodeswithPredYVel)=i;
			%end
		end
	elseif CasetoRun==10
		for i=1:size(LOC,1)
			if LOC(i,2)>le_base*11-1e-3 & LOC(i,2)<le_base*11+1e-3
				NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
				NodeswithPredYVel=VectorInsertion(NodeswithPredYVel,NumberofNodeswithPredYVel,i);
			end
			%if ((LOC(i,1)-100)^2<1e-6 | (LOC(i,1)-40)^2<1e-6) & (LOC(i,2)-50)^2<1e-6
			%    NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
			%    NodeswithPredYVel(NumberofNodeswithPredYVel)=i;
			%end
		end
	elseif CasetoRun==11 || CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==15 || CasetoRun==14
		for i=1:size(LOC,1)
			if CasetoRun==15
				if LOC(i,2)>le_base*16-1e-3 & LOC(i,2)<le_base*16+1e-3
					NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
					NodeswithPredYVel=VectorInsertion(NodeswithPredYVel,NumberofNodeswithPredYVel,i);
				end            
			else
				if LOC(i,2)>le_base*19-1e-3 & LOC(i,2)<le_base*19+1e-3
					NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
					NodeswithPredYVel=VectorInsertion(NodeswithPredYVel,NumberofNodeswithPredYVel,i);
				end
				%if ((LOC(i,1)-100)^2<1e-6 | (LOC(i,1)-40)^2<1e-6) & (LOC(i,2)-50)^2<1e-6
				%    NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
				%    NodeswithPredYVel(NumberofNodeswithPredYVel)=i;
				%end
			end
		end
	elseif CasetoRun==12 || CasetoRun==16 || CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44
		for i=1:size(LOC,1)
			if LOC(i,2)>le_base*18-1e-3 & LOC(i,2)<le_base*18+1e-3
				NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
				NodeswithPredYVel=VectorInsertion(NodeswithPredYVel,NumberofNodeswithPredYVel,i);
			end
			%if ((LOC(i,1)-100)^2<1e-6 | (LOC(i,1)-40)^2<1e-6) & (LOC(i,2)-50)^2<1e-6
			%    NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
			%    NodeswithPredYVel(NumberofNodeswithPredYVel)=i;
			%end
		end
	elseif CasetoRun==64 || CasetoRun==66
		for i=1:size(LOC,1)
			if CloseEnough(LOC(i,2),9*le_base,1e-3,1) || CloseEnough(LOC(i,2),10*le_base,1e-3,1)
				NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
				NodeswithPredYVel=VectorInsertion(NodeswithPredYVel,NumberofNodeswithPredYVel,i);
			elseif CloseEnough(LOC(i,2),2*le_base,1e-3,1) || CloseEnough(LOC(i,2),1*le_base,1e-3,1)
				NumberofNodeswithPredYVel2=NumberofNodeswithPredYVel2+1;
				NodeswithPredYVel2=VectorInsertion(NodeswithPredYVel2,NumberofNodeswithPredYVel2,i);
			end
		end
	elseif CasetoRun==67 || CasetoRun==68 || CasetoRun==71 || CasetoRun==72 || CasetoRun==73 || CasetoRun==74 || CasetoRun==78 || CasetoRun==81 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==83 || CasetoRun==77 || CasetoRun==69 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==112 || CasetoRun==110 || CasetoRun==96 || CasetoRun==154 || CasetoRun==161
	elseif CasetoRun==111 || CasetoRun==113 
		for i=1:size(LOC,1)
			if CloseEnough(LOC(i,2),13*le_base,1e-3,1) && CloseEnough(LOC(i,1),6*le_base,1e-3,1)
				NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
				NodeswithPredYVel=VectorInsertion(NodeswithPredYVel,NumberofNodeswithPredYVel,i);
			elseif CloseEnough(LOC(i,2),7*le_base,1e-3,1) && CloseEnough(LOC(i,1),6*le_base,1e-3,1)
				NumberofNodeswithPredYVel2=NumberofNodeswithPredYVel2+1;
				NodeswithPredYVel2=VectorInsertion(NodeswithPredYVel2,NumberofNodeswithPredYVel2,i);
			end
		end
	elseif CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==117 || CasetoRun==138
	elseif CasetoRun==118 || CasetoRun==173 || CasetoRun==192
		NodeswithPredXVel=zeros(1,size(LOC,1));
		NodeswithPredXVel2=zeros(1,size(LOC,1));
		NodeswithPredYVel=zeros(1,size(LOC,1));
		NodeswithPredYVel2=zeros(1,size(LOC,1));
		for i=1:size(LOC,1)
			if CloseEnough(LOC(i,1),2*le_base,1e-3,1)
				NumberofNodeswithPredXVel=NumberofNodeswithPredXVel+1;
				NodeswithPredXVel(NumberofNodeswithPredXVel)=i;
			elseif CloseEnough(LOC(i,1),4*le_base,1e-3,1)
				NumberofNodeswithPredXVel2=NumberofNodeswithPredXVel2+1;
				NodeswithPredXVel2=VectorInsertion(NodeswithPredXVel2,NumberofNodeswithPredXVel2,i);
			end
			if CloseEnough(LOC(i,2),2*le_base,1e-3,1)
				NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
				NodeswithPredYVel=VectorInsertion(NodeswithPredYVel,NumberofNodeswithPredYVel,i);
			elseif CloseEnough(LOC(i,2),4*le_base,1e-3,1)
				NumberofNodeswithPredYVel2=NumberofNodeswithPredYVel2+1;
				NodeswithPredYVel2=VectorInsertion(NodeswithPredYVel2,NumberofNodeswithPredYVel2,i);
			end
		end
		NodeswithPredXVel=ResizeVector(NodeswithPredXVel,NumberofNodeswithPredXVel);
		NodeswithPredXVel2=ResizeVector(NodeswithPredXVel2,NumberofNodeswithPredXVel2);
		NodeswithPredYVel=ResizeVector(NodeswithPredYVel,NumberofNodeswithPredYVel);
		NodeswithPredYVel2=ResizeVector(NodeswithPredYVel2,NumberofNodeswithPredYVel2);
		
		nro=NumberofNodeswithPredYVel+NumberofNodeswithPredYVel2;
		PredVelVect.nY=nro;
		PredVelVect.YPhase(1:nro)=1;
		for iro=1:nro
			if iro<=NumberofNodeswithPredYVel
				PredVelVect.YNodes(iro)=NodeswithPredYVel(iro);
			else
				PredVelVect.YNodes(iro)=NodeswithPredYVel2(iro-NumberofNodeswithPredYVel);
			end
		end
		
		nro=NumberofNodeswithPredXVel+NumberofNodeswithPredXVel2;
		PredVelVect.nX=nro;
		PredVelVect.XPhase(1:nro)=1;
		for iro=1:nro
			if iro<=NumberofNodeswithPredXVel
				PredVelVect.XNodes(iro)=NodeswithPredXVel(iro);
			else
				PredVelVect.XNodes(iro)=NodeswithPredXVel2(iro-NumberofNodeswithPredXVel);
			end
		end
		
	elseif CasetoRun==123 || CasetoRun==151 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128
		NodeswithPredXVel=zeros(1,size(LOC,1));
		NodeswithPredXVel2=zeros(1,size(LOC,1));
		NodeswithPredYVel=zeros(1,size(LOC,1));
		NodeswithPredYVel2=zeros(1,size(LOC,1));
		for i=1:size(LOC,1)
			if LOC(i,1)>=5.5*le_base
				if CloseEnough(LOC(i,2),2*le_base,1e-3,1)
					NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
					NodeswithPredYVel=VectorInsertion(NodeswithPredYVel,NumberofNodeswithPredYVel,i);
				elseif CloseEnough(LOC(i,2),4*le_base,1e-3,1)
					NumberofNodeswithPredYVel2=NumberofNodeswithPredYVel2+1;
					NodeswithPredYVel2=VectorInsertion(NodeswithPredYVel2,NumberofNodeswithPredYVel2,i);
				end
			end
		end
		NodeswithPredXVel=ResizeVector(NodeswithPredXVel,NumberofNodeswithPredXVel);
		NodeswithPredXVel2=ResizeVector(NodeswithPredXVel2,NumberofNodeswithPredXVel2);
		NodeswithPredYVel=ResizeVector(NodeswithPredYVel,NumberofNodeswithPredYVel);
		NodeswithPredYVel2=ResizeVector(NodeswithPredYVel2,NumberofNodeswithPredYVel2);
	elseif CasetoRun==178
		NodeswithPredXVel=zeros(1,size(LOC,1));
		NodeswithPredXVel2=zeros(1,size(LOC,1));
		NodeswithPredYVel=zeros(1,size(LOC,1));
		NodeswithPredYVel2=zeros(1,size(LOC,1));
		for i=1:size(LOC,1)
			%if LOC(i,1)>=5.5*le_base
				if CloseEnough(LOC(i,2),2*le_base,1e-3,1)
					NumberofNodeswithPredXVel=NumberofNodeswithPredXVel+1;
					NodeswithPredXVel=VectorInsertion(NodeswithPredXVel,NumberofNodeswithPredXVel,i);
					
					NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
					NodeswithPredYVel=VectorInsertion(NodeswithPredYVel,NumberofNodeswithPredYVel,i);
				elseif CloseEnough(LOC(i,2),5*le_base,1e-3,1)
					NumberofNodeswithPredXVel2=NumberofNodeswithPredXVel2+1;
					NodeswithPredXVel2=VectorInsertion(NodeswithPredXVel2,NumberofNodeswithPredXVel2,i);
					
					NumberofNodeswithPredYVel2=NumberofNodeswithPredYVel2+1;
					NodeswithPredYVel2=VectorInsertion(NodeswithPredYVel2,NumberofNodeswithPredYVel2,i);
				end
			%end
		end
		NodeswithPredXVel=ResizeVector(NodeswithPredXVel,NumberofNodeswithPredXVel);
		NodeswithPredXVel2=ResizeVector(NodeswithPredXVel2,NumberofNodeswithPredXVel2);
		NodeswithPredYVel=ResizeVector(NodeswithPredYVel,NumberofNodeswithPredYVel);
		NodeswithPredYVel2=ResizeVector(NodeswithPredYVel2,NumberofNodeswithPredYVel2);
		
		nro=NumberofNodeswithPredXVel+NumberofNodeswithPredXVel2;
		PredVelVect.nX=nro;
		PredVelVect.XPhase(1:nro)=1;
		for iro=1:nro
			if iro<=NumberofNodeswithPredXVel
				PredVelVect.XNodes(iro)=NodeswithPredXVel(iro);
			else
				PredVelVect.XNodes(iro)=NodeswithPredXVel2(iro-NumberofNodeswithPredXVel);
			end
		end
		
		nro=NumberofNodeswithPredYVel+NumberofNodeswithPredYVel2;
		PredVelVect.nY=nro;
		PredVelVect.YPhase(1:nro)=1;
		for iro=1:nro
			if iro<=NumberofNodeswithPredYVel
				PredVelVect.YNodes(iro)=NodeswithPredYVel(iro);
			else
				PredVelVect.YNodes(iro)=NodeswithPredYVel2(iro-NumberofNodeswithPredYVel);
			end
		end
	elseif CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==169
		NodeswithPredXVel=zeros(1,size(LOC,1));
		NodeswithPredXVel2=zeros(1,size(LOC,1));
		NodeswithPredYVel=zeros(1,size(LOC,1));
		NodeswithPredYVel2=zeros(1,size(LOC,1));
		for i=1:size(LOC,1)
			%if LOC(i,1)>=5.5*le_base
				if CloseEnough(LOC(i,2),2*le_base,1e-3,1)
					NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
					NodeswithPredYVel=VectorInsertion(NodeswithPredYVel,NumberofNodeswithPredYVel,i);
				elseif CloseEnough(LOC(i,2),5*le_base,1e-3,1)
					NumberofNodeswithPredYVel2=NumberofNodeswithPredYVel2+1;
					NodeswithPredYVel2=VectorInsertion(NodeswithPredYVel2,NumberofNodeswithPredYVel2,i);
				end
			%end
		end
		NodeswithPredXVel=ResizeVector(NodeswithPredXVel,NumberofNodeswithPredXVel);
		NodeswithPredXVel2=ResizeVector(NodeswithPredXVel2,NumberofNodeswithPredXVel2);
		NodeswithPredYVel=ResizeVector(NodeswithPredYVel,NumberofNodeswithPredYVel);
		NodeswithPredYVel2=ResizeVector(NodeswithPredYVel2,NumberofNodeswithPredYVel2);
		
		nro=NumberofNodeswithPredYVel+NumberofNodeswithPredYVel2;
		PredVelVect.nY=nro;
		PredVelVect.YPhase(1:nro)=1;
		for iro=1:nro
			if iro<=NumberofNodeswithPredYVel
				PredVelVect.YNodes(iro)=NodeswithPredYVel(iro);
			else
				PredVelVect.YNodes(iro)=NodeswithPredYVel2(iro-NumberofNodeswithPredYVel);
			end
		end
	elseif CasetoRun==171
		NodeswithPredXVel=zeros(1,size(LOC,1));
		NodeswithPredXVel2=zeros(1,size(LOC,1));
		NodeswithPredYVel=zeros(1,size(LOC,1));
		NodeswithPredYVel2=zeros(1,size(LOC,1));
		for i=1:size(LOC,1)
			if CloseEnough(LOC(i,1),6*le_base,1e-3,1) %pulls up
				if LOC(i,2)>3*le_base+0.5*le(2)
					NumberofNodeswithPredYVel2=NumberofNodeswithPredYVel2+1;
					NodeswithPredYVel2=VectorInsertion(NodeswithPredYVel2,NumberofNodeswithPredYVel2,i);
				elseif LOC(i,2)<3*le_base-0.5*le(2) %pulls down
					NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
					NodeswithPredYVel=VectorInsertion(NodeswithPredYVel,NumberofNodeswithPredYVel,i);
				end
			end
		end
		NodeswithPredXVel=ResizeVector(NodeswithPredXVel,NumberofNodeswithPredXVel);
		NodeswithPredXVel2=ResizeVector(NodeswithPredXVel2,NumberofNodeswithPredXVel2);
		NodeswithPredYVel=ResizeVector(NodeswithPredYVel,NumberofNodeswithPredYVel);
		NodeswithPredYVel2=ResizeVector(NodeswithPredYVel2,NumberofNodeswithPredYVel2);
		
		nro=NumberofNodeswithPredYVel+NumberofNodeswithPredYVel2;
		PredVelVect.nY=nro;
		PredVelVect.YPhase(1:nro)=1;
		for iro=1:nro
			if iro<=NumberofNodeswithPredYVel
				PredVelVect.YNodes(iro)=NodeswithPredYVel(iro);
			else
				PredVelVect.YNodes(iro)=NodeswithPredYVel2(iro-NumberofNodeswithPredYVel);
			end
		end
	elseif CasetoRun==163 || CasetoRun==170 || CasetoRun==165
		NodeswithPredXVel=zeros(1,size(LOC,1));
		NodeswithPredXVel2=zeros(1,size(LOC,1));
		NodeswithPredYVel=zeros(1,size(LOC,1));
		NodeswithPredYVel2=zeros(1,size(LOC,1));
		for i=1:size(LOC,1)
			%if LOC(i,1)>=5.5*le_base
				if CloseEnough(LOC(i,2),2*le_base,1e-3,1)
					NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
					NodeswithPredYVel=VectorInsertion(NodeswithPredYVel,NumberofNodeswithPredYVel,i);
				elseif CloseEnough(LOC(i,2),4*le_base,1e-3,1)
					NumberofNodeswithPredYVel2=NumberofNodeswithPredYVel2+1;
					NodeswithPredYVel2=VectorInsertion(NodeswithPredYVel2,NumberofNodeswithPredYVel2,i);
				end
			%end
		end
		NodeswithPredXVel=ResizeVector(NodeswithPredXVel,NumberofNodeswithPredXVel);
		NodeswithPredXVel2=ResizeVector(NodeswithPredXVel2,NumberofNodeswithPredXVel2);
		NodeswithPredYVel=ResizeVector(NodeswithPredYVel,NumberofNodeswithPredYVel);
		NodeswithPredYVel2=ResizeVector(NodeswithPredYVel2,NumberofNodeswithPredYVel2);
		
		nro=NumberofNodeswithPredYVel+NumberofNodeswithPredYVel2;
		PredVelVect.nY=nro;
		PredVelVect.YPhase(1:nro)=1;
		for iro=1:nro
			if iro<=NumberofNodeswithPredYVel
				PredVelVect.YNodes(iro)=NodeswithPredYVel(iro);
			else
				PredVelVect.YNodes(iro)=NodeswithPredYVel2(iro-NumberofNodeswithPredYVel);
			end
		end
	elseif CasetoRun==166
		NodeswithPredXVel=zeros(1,size(LOC,1));
		NodeswithPredXVel2=zeros(1,size(LOC,1));
		NodeswithPredYVel=zeros(1,size(LOC,1));
		NodeswithPredYVel2=zeros(1,size(LOC,1));
		for i=1:size(LOC,1)
			%if LOC(i,1)>=5.5*le_base
				if CloseEnough(LOC(i,2),2.5*le_base,1e-3,1) && CloseEnough(LOC(i,1),5.8*le_base,1e-3,1)
					NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
					NodeswithPredYVel=VectorInsertion(NodeswithPredYVel,NumberofNodeswithPredYVel,i);
				elseif CloseEnough(LOC(i,2),3.5*le_base,1e-3,1) && CloseEnough(LOC(i,1),5.8*le_base,1e-3,1)
					NumberofNodeswithPredYVel2=NumberofNodeswithPredYVel2+1;
					NodeswithPredYVel2=VectorInsertion(NodeswithPredYVel2,NumberofNodeswithPredYVel2,i);
				end
			%end
		end
		NodeswithPredXVel=ResizeVector(NodeswithPredXVel,NumberofNodeswithPredXVel);
		NodeswithPredXVel2=ResizeVector(NodeswithPredXVel2,NumberofNodeswithPredXVel2);
		NodeswithPredYVel=ResizeVector(NodeswithPredYVel,NumberofNodeswithPredYVel);
		NodeswithPredYVel2=ResizeVector(NodeswithPredYVel2,NumberofNodeswithPredYVel2);
		
		nro=NumberofNodeswithPredYVel+NumberofNodeswithPredYVel2;
		PredVelVect.nY=nro;
		PredVelVect.YPhase(1:nro)=1;
		for iro=1:nro
			if iro<=NumberofNodeswithPredYVel
				PredVelVect.YNodes(iro)=NodeswithPredYVel(iro);
			else
				PredVelVect.YNodes(iro)=NodeswithPredYVel2(iro-NumberofNodeswithPredYVel);
			end
		end
	elseif CasetoRun==129 || CasetoRun==130
		NodeswithPredXVel=zeros(1,size(LOC,1));
		NodeswithPredXVel2=zeros(1,size(LOC,1));
		NodeswithPredYVel=zeros(1,size(LOC,1));
		NodeswithPredYVel2=zeros(1,size(LOC,1));
		for i=1:size(LOC,1)
			if LOC(i,1)>=5.5*le_base
				if CloseEnough(LOC(i,2),2*le_base,1e-3,1)
					NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
					NodeswithPredYVel=VectorInsertion(NodeswithPredYVel,NumberofNodeswithPredYVel,i);
				elseif CloseEnough(LOC(i,2),4.25*le_base,1e-3,1)
					NumberofNodeswithPredYVel2=NumberofNodeswithPredYVel2+1;
					NodeswithPredYVel2=VectorInsertion(NodeswithPredYVel2,NumberofNodeswithPredYVel2,i);
				end
			end
		end
		NodeswithPredXVel=ResizeVector(NodeswithPredXVel,NumberofNodeswithPredXVel);
		NodeswithPredXVel2=ResizeVector(NodeswithPredXVel2,NumberofNodeswithPredXVel2);
		NodeswithPredYVel=ResizeVector(NodeswithPredYVel,NumberofNodeswithPredYVel);
		NodeswithPredYVel2=ResizeVector(NodeswithPredYVel2,NumberofNodeswithPredYVel2);
        1;
	elseif CasetoRun==132
		NodeswithPredXVel=zeros(1,size(LOC,1));
		NodeswithPredXVel2=zeros(1,size(LOC,1));
		NodeswithPredYVel=zeros(1,size(LOC,1));
		NodeswithPredYVel2=zeros(1,size(LOC,1));
		for i=1:size(LOC,1)
			if CloseEnough(LOC(i,2),2*le_base,1e-3,1)
				NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
				NodeswithPredYVel=VectorInsertion(NodeswithPredYVel,NumberofNodeswithPredYVel,i);
			elseif CloseEnough(LOC(i,2),4.25*le_base,1e-3,1)
				NumberofNodeswithPredYVel2=NumberofNodeswithPredYVel2+1;
				NodeswithPredYVel2=VectorInsertion(NodeswithPredYVel2,NumberofNodeswithPredYVel2,i);
			end
		end
		NodeswithPredXVel=ResizeVector(NodeswithPredXVel,NumberofNodeswithPredXVel);
		NodeswithPredXVel2=ResizeVector(NodeswithPredXVel2,NumberofNodeswithPredXVel2);
		NodeswithPredYVel=ResizeVector(NodeswithPredYVel,NumberofNodeswithPredYVel);
		NodeswithPredYVel2=ResizeVector(NodeswithPredYVel2,NumberofNodeswithPredYVel2);
	elseif CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135
		NodeswithPredXVel=zeros(1,size(LOC,1));
		NodeswithPredXVel2=zeros(1,size(LOC,1));
		NodeswithPredYVel=zeros(1,size(LOC,1));
		NodeswithPredYVel2=zeros(1,size(LOC,1));
		for i=1:size(LOC,1)
			if CloseEnough(LOC(i,1),10*le_base,1e-3,1)
				if CloseEnough(LOC(i,2),2*le_base,1e-3,1)
					NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
					NodeswithPredYVel=VectorInsertion(NodeswithPredYVel,NumberofNodeswithPredYVel,i);
				elseif CloseEnough(LOC(i,2),4.25*le_base,1e-3,1)
					NumberofNodeswithPredYVel2=NumberofNodeswithPredYVel2+1;
					NodeswithPredYVel2=VectorInsertion(NodeswithPredYVel2,NumberofNodeswithPredYVel2,i);
				end
			end
		end
		NodeswithPredXVel=ResizeVector(NodeswithPredXVel,NumberofNodeswithPredXVel);
		NodeswithPredXVel2=ResizeVector(NodeswithPredXVel2,NumberofNodeswithPredXVel2);
		NodeswithPredYVel=ResizeVector(NodeswithPredYVel,NumberofNodeswithPredYVel);
		NodeswithPredYVel2=ResizeVector(NodeswithPredYVel2,NumberofNodeswithPredYVel2);
	elseif CasetoRun==134 || CasetoRun==136
		NodeswithPredXVel=zeros(1,size(LOC,1));
		NodeswithPredXVel2=zeros(1,size(LOC,1));
		NodeswithPredYVel=zeros(1,size(LOC,1));
		NodeswithPredYVel2=zeros(1,size(LOC,1));
		for i=1:size(LOC,1)
			if CloseEnough(LOC(i,1),7.5*le_base,1e-3,1)
				if LOC(i,2)>=3.5*le_base && LOC(i,2)<=4.25*le_base
					NumberofNodeswithPredXVel=NumberofNodeswithPredXVel+1;
					NodeswithPredXVel=VectorInsertion(NodeswithPredXVel,NumberofNodeswithPredXVel,i);
				elseif LOC(i,2)>=2.25*le_base && LOC(i,2)<=2.75*le_base
					NumberofNodeswithPredXVel2=NumberofNodeswithPredXVel2+1;
					NodeswithPredXVel2=VectorInsertion(NodeswithPredXVel2,NumberofNodeswithPredXVel2,i);
				end
			end
		end
		NodeswithPredXVel=ResizeVector(NodeswithPredXVel,NumberofNodeswithPredXVel);
		NodeswithPredXVel2=ResizeVector(NodeswithPredXVel2,NumberofNodeswithPredXVel2);
		NodeswithPredYVel=ResizeVector(NodeswithPredYVel,NumberofNodeswithPredYVel);
		NodeswithPredYVel2=ResizeVector(NodeswithPredYVel2,NumberofNodeswithPredYVel2);
	elseif CasetoRun==140 || CasetoRun==143
		NodeswithPredXVel=zeros(1,size(LOC,1));
		NodeswithPredXVel2=zeros(1,size(LOC,1));
		NodeswithPredYVel=zeros(1,size(LOC,1));
		NodeswithPredYVel2=zeros(1,size(LOC,1));
		for i=1:size(LOC,1)
			if CloseEnough(LOC(i,1),10*le_base,1e-3,1)
				if LOC(i,2)>=3.5*le_base && LOC(i,2)<=4.25*le_base
					NumberofNodeswithPredXVel=NumberofNodeswithPredXVel+1;
					NodeswithPredXVel=VectorInsertion(NodeswithPredXVel,NumberofNodeswithPredXVel,i);
				elseif LOC(i,2)>=2.25*le_base && LOC(i,2)<=2.75*le_base
					NumberofNodeswithPredXVel2=NumberofNodeswithPredXVel2+1;
					NodeswithPredXVel2=VectorInsertion(NodeswithPredXVel2,NumberofNodeswithPredXVel2,i);
				end
			end
		end
		for i=1:size(LOC,1)
			if CloseEnough(LOC(i,1),10*le_base,1e-3,1)
				if CloseEnough(LOC(i,2),2*le_base,1e-3,1)
					NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
					NodeswithPredYVel=VectorInsertion(NodeswithPredYVel,NumberofNodeswithPredYVel,i);
				elseif CloseEnough(LOC(i,2),4.25*le_base,1e-3,1)
					%NumberofNodeswithPredYVel2=NumberofNodeswithPredYVel2+1;
					%NodeswithPredYVel2=VectorInsertion(NodeswithPredYVel2,NumberofNodeswithPredYVel2,i);
					%only the bottom will be pulled down
				end
			end
		end
		NodeswithPredXVel=ResizeVector(NodeswithPredXVel,NumberofNodeswithPredXVel);
		NodeswithPredXVel2=ResizeVector(NodeswithPredXVel2,NumberofNodeswithPredXVel2);
		NodeswithPredYVel=ResizeVector(NodeswithPredYVel,NumberofNodeswithPredYVel);
		NodeswithPredYVel2=ResizeVector(NodeswithPredYVel2,NumberofNodeswithPredYVel2);
	elseif CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==147
		NodeswithPredXVel=zeros(1,size(LOC,1));
		NodeswithPredXVel2=zeros(1,size(LOC,1));
		NodeswithPredYVel=zeros(1,size(LOC,1));
		NodeswithPredYVel2=zeros(1,size(LOC,1));
		for i=1:size(LOC,1)
			if CloseEnough(LOC(i,1),10*le_base,1e-3,1)
				NumberofNodeswithPredXVel=NumberofNodeswithPredXVel+1;
				NodeswithPredXVel=VectorInsertion(NodeswithPredXVel,NumberofNodeswithPredXVel,i);
			end
		end
		NodeswithPredXVel=ResizeVector(NodeswithPredXVel,NumberofNodeswithPredXVel);
		NodeswithPredXVel2=ResizeVector(NodeswithPredXVel2,NumberofNodeswithPredXVel2);
		NodeswithPredYVel=ResizeVector(NodeswithPredYVel,NumberofNodeswithPredYVel);
		NodeswithPredYVel2=ResizeVector(NodeswithPredYVel2,NumberofNodeswithPredYVel2);
	elseif CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153
		NodeswithPredXVel=zeros(1,size(LOC,1));
		NodeswithPredXVel2=zeros(1,size(LOC,1));
		NodeswithPredYVel=zeros(1,size(LOC,1));
		NodeswithPredYVel2=zeros(1,size(LOC,1));

		NodeswithPredXVel=ResizeVector(NodeswithPredXVel,NumberofNodeswithPredXVel);
		NodeswithPredXVel2=ResizeVector(NodeswithPredXVel2,NumberofNodeswithPredXVel2);
		NodeswithPredYVel=ResizeVector(NodeswithPredYVel,NumberofNodeswithPredYVel);
		NodeswithPredYVel2=ResizeVector(NodeswithPredYVel2,NumberofNodeswithPredYVel2);
	elseif CasetoRun==145
		NodeswithPredXVel=zeros(1,size(LOC,1));
		NodeswithPredXVel2=zeros(1,size(LOC,1));
		NodeswithPredYVel=zeros(1,size(LOC,1));
		NodeswithPredYVel2=zeros(1,size(LOC,1));
		for i=1:size(LOC,1)
			if CloseEnough(LOC(i,1),10*le_base,1e-3,1)
				NumberofNodeswithPredXVel=NumberofNodeswithPredXVel+1;
				NodeswithPredXVel=VectorInsertion(NodeswithPredXVel,NumberofNodeswithPredXVel,i);
			end
		end
		for i=1:size(LOC,1)
			if CloseEnough(LOC(i,1),5*le_base,1e-3,1)
				NumberofNodeswithPredXVel2=NumberofNodeswithPredXVel2+1;
				NodeswithPredXVel2=VectorInsertion(NodeswithPredXVel2,NumberofNodeswithPredXVel2,i);
			end
		end
		NodeswithPredXVel=ResizeVector(NodeswithPredXVel,NumberofNodeswithPredXVel);
		NodeswithPredXVel2=ResizeVector(NodeswithPredXVel2,NumberofNodeswithPredXVel2);
		NodeswithPredYVel=ResizeVector(NodeswithPredYVel,NumberofNodeswithPredYVel);
		NodeswithPredYVel2=ResizeVector(NodeswithPredYVel2,NumberofNodeswithPredYVel2);
	elseif CasetoRun==141
		NodeswithPredXVel=zeros(1,size(LOC,1));
		NodeswithPredXVel2=zeros(1,size(LOC,1));
		NodeswithPredYVel=zeros(1,size(LOC,1));
		NodeswithPredYVel2=zeros(1,size(LOC,1));
		for i=1:size(LOC,1)
			if CloseEnough(LOC(i,1),10*le_base,1e-3,1)
				if CloseEnough(LOC(i,2),2*le_base,1e-3,1)
					NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
					NodeswithPredYVel=VectorInsertion(NodeswithPredYVel,NumberofNodeswithPredYVel,i);
				elseif CloseEnough(LOC(i,2),4.25*le_base,1e-3,1)
					%NumberofNodeswithPredYVel2=NumberofNodeswithPredYVel2+1;
					%NodeswithPredYVel2=VectorInsertion(NodeswithPredYVel2,NumberofNodeswithPredYVel2,i);
					%only the bottom will be pulled down
				end
			end
		end
		NodeswithPredXVel=ResizeVector(NodeswithPredXVel,NumberofNodeswithPredXVel);
		NodeswithPredXVel2=ResizeVector(NodeswithPredXVel2,NumberofNodeswithPredXVel2);
		NodeswithPredYVel=ResizeVector(NodeswithPredYVel,NumberofNodeswithPredYVel);
		NodeswithPredYVel2=ResizeVector(NodeswithPredYVel2,NumberofNodeswithPredYVel2);
	elseif CasetoRun==142
		NodeswithPredXVel=zeros(1,size(LOC,1));
		NodeswithPredXVel2=zeros(1,size(LOC,1));
		NodeswithPredYVel=zeros(1,size(LOC,1));
		NodeswithPredYVel2=zeros(1,size(LOC,1));
		for i=1:size(LOC,1)
			if CloseEnough(LOC(i,1),10*le_base,1e-3,1)
				if LOC(i,2)>=3.5*le_base && LOC(i,2)<=4.25*le_base
					NumberofNodeswithPredXVel=NumberofNodeswithPredXVel+1;
					NodeswithPredXVel=VectorInsertion(NodeswithPredXVel,NumberofNodeswithPredXVel,i);
				elseif LOC(i,2)>=2.25*le_base && LOC(i,2)<=2.75*le_base
					NumberofNodeswithPredXVel2=NumberofNodeswithPredXVel2+1;
					NodeswithPredXVel2=VectorInsertion(NodeswithPredXVel2,NumberofNodeswithPredXVel2,i);
				end
			end
		end
		NodeswithPredXVel=ResizeVector(NodeswithPredXVel,NumberofNodeswithPredXVel);
		NodeswithPredXVel2=ResizeVector(NodeswithPredXVel2,NumberofNodeswithPredXVel2);
		NodeswithPredYVel=ResizeVector(NodeswithPredYVel,NumberofNodeswithPredYVel);
		NodeswithPredYVel2=ResizeVector(NodeswithPredYVel2,NumberofNodeswithPredYVel2);
	elseif CasetoRun==124
		%124 predvelnodal
		NodeswithPredXVel=zeros(1,size(LOC,1));
		NodeswithPredXVel2=zeros(1,size(LOC,1));
		NodeswithPredYVel=zeros(1,size(LOC,1));
		NodeswithPredYVel2=zeros(1,size(LOC,1));
		for i=1:size(LOC,1)
			%if CloseEnough(LOC(i,1),2*le_base,1e-3,1)
				if CloseEnough(LOC(i,2),2*le_base,1e-3,1)
					NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
					NodeswithPredYVel=VectorInsertion(NodeswithPredYVel,NumberofNodeswithPredYVel,i);
				elseif CloseEnough(LOC(i,2),7*le_base,1e-3,1)
					NumberofNodeswithPredYVel2=NumberofNodeswithPredYVel2+1;
					NodeswithPredYVel2=VectorInsertion(NodeswithPredYVel2,NumberofNodeswithPredYVel2,i);
				end
			%end
		end
		NodeswithPredXVel=ResizeVector(NodeswithPredXVel,NumberofNodeswithPredXVel);
		NodeswithPredXVel2=ResizeVector(NodeswithPredXVel2,NumberofNodeswithPredXVel2);
		NodeswithPredYVel=ResizeVector(NodeswithPredYVel,NumberofNodeswithPredYVel);
		NodeswithPredYVel2=ResizeVector(NodeswithPredYVel2,NumberofNodeswithPredYVel2);
		
		nro=NumberofNodeswithPredYVel+NumberofNodeswithPredYVel2;
		PredVelVect.nY=nro;
		PredVelVect.YPhase(1:nro)=1;
		for iro=1:nro
			if iro<=NumberofNodeswithPredYVel
				PredVelVect.YNodes(iro)=NodeswithPredYVel(iro);
			else
				PredVelVect.YNodes(iro)=NodeswithPredYVel2(iro-NumberofNodeswithPredYVel);
			end
		end
		%NodeswithPredYVelVect=[NodeswithPredYVel NodeswithPredYVel2];
		
		%{
		for nio=1:NumberofNodeswithPredYVel
			NodeswithPredYVelVect=
		end
		for nio=NumberofNodesWithPredYVel+1:NumberofNodeswithPredYVel+NumberofNodeswithPredYVel2)
		end
		%}
	elseif CasetoRun==84
		for i=1:size(LOC,1)
			if CloseEnough(LOC(i,1),22*le_base,1e-5,2)
				NumberofNodeswithPredXVel=NumberofNodeswithPredXVel+1;
				NodeswithPredXVel=VectorInsertion(NodeswithPredXVel,NumberofNodeswithPredXVel,i);
			end
			if CloseEnough(LOC(i,2),10*le_base,1e-5,2)
				NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
				NodeswithPredYVel=VectorInsertion(NodeswithPredYVel,NumberofNodeswithPredYVel,i);
			end
		end
	elseif CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89
		for i=1:size(LOC,1)
			if CloseEnough(LOC(i,1),7*le_base,1e-5,2)
				NumberofNodeswithPredXVel=NumberofNodeswithPredXVel+1;
				NodeswithPredXVel=VectorInsertion(NodeswithPredXVel,NumberofNodeswithPredXVel,i);
			end
			if CloseEnough(LOC(i,2),7*le_base,1e-5,2)
				NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
				NodeswithPredYVel=VectorInsertion(NodeswithPredYVel,NumberofNodeswithPredYVel,i);
			end
		end
	elseif CasetoRun==94
		for i=1:size(LOC,1)
			if CloseEnough(LOC(i,1),8*le_base,1e-5,2)
				NumberofNodeswithPredXVel=NumberofNodeswithPredXVel+1;
				NodeswithPredXVel=VectorInsertion(NodeswithPredXVel,NumberofNodeswithPredXVel,i);
			end
			if CloseEnough(LOC(i,2),7*le_base,1e-5,2)
				NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
				NodeswithPredYVel=VectorInsertion(NodeswithPredYVel,NumberofNodeswithPredYVel,i);
			end
		end
	elseif CasetoRun==85

	elseif CasetoRun==65 || CasetoRun==70
		for i=1:size(LOC,1)
			if CloseEnough(LOC(i,2),8*le_base,1e-3,1) || CloseEnough(LOC(i,2),9*le_base,1e-3,1) || CloseEnough(LOC(i,2),10*le_base,1e-3,1)
				NumberofNodeswithPredYVel=NumberofNodeswithPredYVel+1;
				NodeswithPredYVel=VectorInsertion(NodeswithPredYVel,NumberofNodeswithPredYVel,i);
			end
		end
	end

	%%Defining Location of Nodes with Forces from SigmaInf
	tractionedcorner_si=[];
	normalcorner_si=cell(1,1);
	normalcorner_si{1}=0;
	tractionededge_si=[];
	normaledge_si=[];
	ntforce_si=zeros(size(LOC,1),2);

	if CasetoRun==121
		for i=1:size(LOC,1)
			if CloseEnough(LOC(i,1),4*le_base,1e-5,2)
				if CloseEnough(LOC(i,2),4*le_base,1e-5,2)
					tractionedcorner_si=VectorInsertion(tractionedcorner_si,length(tractionedcorner_si)+1,i);
					%tractionedcorner_si=[tractionedcorner_si i];
					normalcorner_si=CellInsertion(normalcorner_si,length(tractionedcorner_si),[1 0;0 -1]);
					%normalcorner_si{length(tractionedcorner_si)}=[1 0;
					%										0 1];
				elseif CloseEnough(LOC(i,2),2*le_base,1e-5,2)
					tractionedcorner_si=VectorInsertion(tractionedcorner_si,length(tractionedcorner_si)+1,i);
					%tractionedcorner_si=[tractionedcorner_si i];
					normalcorner_si=CellInsertion(normalcorner_si,length(tractionedcorner_si),[1 0;0 -1]);
					%normalcorner_si{length(tractionedcorner_si)}=[1 0;
					%										0 -1];
				elseif LOC(i,2)<=4*le_base && LOC(i,2)>=2*le_base
					tractionededge_si=VectorInsertion(tractionededge_si,length(tractionededge_si)+1,i);
					%tractionededge_si=[tractionededge_si i];
					normaledge_si=MatrixInsertion(normaledge_si,length(tractionededge_si),1,1);
					normaledge_si=MatrixInsertion(normaledge_si,length(tractionededge_si),2,0);
					%normaledge_si(length(tractionededge_si),:)=[1 0];
				end
			elseif CloseEnough(LOC(i,1),2*le_base,1e-5,2)
				if CloseEnough(LOC(i,2),4*le_base,1e-5,2)
					tractionedcorner_si=VectorInsertion(tractionedcorner_si,length(tractionedcorner_si)+1,i);
					%tractionedcorner_si=[tractionedcorner_si i];
					normalcorner_si=CellInsertion(normalcorner_si,length(tractionedcorner_si),[-1 0;0 1]);
					%normalcorner_si{length(tractionedcorner_si)}=[-1 0;
					%										0 1];
				elseif CloseEnough(LOC(i,2),2*le_base,1e-5,2)
					tractionedcorner_si=VectorInsertion(tractionedcorner_si,length(tractionedcorner_si)+1,i);
					%tractionedcorner_si=[tractionedcorner_si i];
					normalcorner_si=CellInsertion(normalcorner_si,length(tractionedcorner_si),[-1 0;0 -1]);
					%normalcorner_si{length(tractionedcorner_si)}=[-1 0;
					%										0 -1];
				elseif LOC(i,2)<=4*le_base && LOC(i,2)>=2*le_base
					tractionededge_si=VectorInsertion(tractionededge_si,length(tractionededge_si)+1,i);
					%tractionededge_si=[tractionededge_si i];
					normaledge_si=MatrixInsertion(normaledge_si,length(tractionededge_si),1,-1);
					normaledge_si=MatrixInsertion(normaledge_si,length(tractionededge_si),2,0);
					%normaledge_si(length(tractionededge_si),:)=[-1 0];
				end			
			elseif CloseEnough(LOC(i,2),4*le_base,1e-5,2) && (LOC(i,1)<=4*le_base && LOC(i,1)>=2*le_base)
				tractionededge_si=VectorInsertion(tractionededge_si,length(tractionededge_si)+1,i);
				%tractionededge_si=[tractionededge_si i];
				normaledge_si=MatrixInsertion(normaledge_si,length(tractionededge_si),1,0);
				normaledge_si=MatrixInsertion(normaledge_si,length(tractionededge_si),2,1);			
				%normaledge_si(length(tractionededge_si),:)=[0 1];
			elseif CloseEnough(LOC(i,2),2*le_base,1e-5,2) && (LOC(i,1)<=4*le_base && LOC(i,1)>=2*le_base)
				tractionededge_si=VectorInsertion(tractionededge_si,length(tractionededge_si)+1,i);
				%tractionededge_si=[tractionededge_si i];
				normaledge_si=MatrixInsertion(normaledge_si,length(tractionededge_si),1,0);
				normaledge_si=MatrixInsertion(normaledge_si,length(tractionededge_si),2,-1);			
				%normaledge_si(length(tractionededge_si),:)=[0 -1];
			end
		end
	end

	%%Defining Double-Velocity Nodes
	%definingprocessgoeshere

	%% Time
	%c                       = sqrt(E/psp);
	if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==17
		%ftime                   = 20*2+25;
		loadtime                = 15;
		pausetime               = 2;
		repetition              = 1;
		dispload                = -1.25*le_base;
		ftime                   = (loadtime+pausetime)*repetition;
	elseif CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 
		%ftime                   = 20*2+25;
		loadtime                = 20;
		pausetime               = 2;
		repetition              = 1;
		dispload                = -20;
		ftime                   = (loadtime+pausetime)*repetition;
	elseif CasetoRun==21
		loadtime                = 15;
		pausetime               = 2;
		repetition              = 1;
		dispload                = -1*le_base;
		ftime                   = (loadtime+pausetime)*repetition;
	elseif CasetoRun==4
		ftime                   = 12;
	elseif CasetoRun==5 || CasetoRun==6
		loadtime                = 20;
		pausetime               = 1;
		repetition              = 2;
		dispload                = -1.25*le_base;
		ftime                   = (loadtime+pausetime)*repetition;
	elseif CasetoRun==7
		loadtime                = 1;
		pausetime               = 15;
		repetition              = 1;
		dispload                = -1*le_base;
		ftime                   = (loadtime+pausetime)*repetition;
	elseif CasetoRun==8 || CasetoRun==9
		loadtime                = 4;
		pausetime               = 1;
		repetition              = 10;
		dispload                = -0.25*le_base;
		ftime                   = (loadtime+pausetime)*repetition;
	elseif CasetoRun==10
		%ftime                   = 20*2+25;
		loadtime                = 10;
		pausetime               = 1;
		repetition              = 1;
		dispload                = 0.2*le_base;
		ftime                   = (loadtime+pausetime)*repetition;
	elseif CasetoRun==11
		%ftime                   = 20*2+25;
		loadtime                = 5;
		pausetime               = 2;
		repetition              = 1;
		dispload                = 1*le_base;
		ftime                   = (loadtime+pausetime)*repetition;
	elseif CasetoRun==12 || CasetoRun==16 || CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44
		%ftime                   = 20*2+25;
		loadtime                = 5;
		pausetime               = 2;
		repetition              = 1;
		dispload                = -1.5*le_base;
		ftime                   = (loadtime+pausetime)*repetition;
	elseif CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==15 || CasetoRun==14
		%ftime                   = 20*2+25;
		loadtime                = 5;
		pausetime               = 2;
		repetition              = 1;
		dispload                = 1*le_base;
		ftime                   = (loadtime+pausetime)*repetition;
	elseif CasetoRun==64 || CasetoRun==66 || CasetoRun==65 || CasetoRun==70
		%ftime                   = 20*2+25;
		loadtime                = 3;
		pausetime               = 2;
		repetition              = 1;
		if CasetoRun==65 || CasetoRun==70
			dispload                = 2*le_base;
		elseif CasetoRun==64 || CasetoRun==66
			dispload                = le_base;
		end
		ftime                   = (loadtime+pausetime)*repetition;
	elseif CasetoRun==69
		%ftime                   = 20*2+25;
		loadtime                = 1;
		pausetime               = 999999;
		repetition              = 1;
		dispload                = 0;
		ftime                   = (loadtime+pausetime)*repetition;
	elseif CasetoRun==67 || CasetoRun==68 || CasetoRun==71 || CasetoRun==72 || CasetoRun==73 || CasetoRun==74 || CasetoRun==78 || CasetoRun==81 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==83 || CasetoRun==77 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==110 || CasetoRun==96
		loadtime                = 9999;
		pausetime               = 0;
		repetition              = 1;
		dispload                = 0*le_base;
		ftime                   = (loadtime+pausetime)*repetition;
	elseif CasetoRun==111
		loadtime                = 1;
		pausetime               = 5;
		repetition              = 1;
		dispload                = 1*le_base;
		ftime                   = (loadtime+pausetime)*repetition;
	elseif CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==117
		loadtime                = 1;
		pausetime               = 5; %not used for CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124 || CasetoRun==117
		repetition              = 1;
		sigmainfmax             = 5; %MPa
		%dispload                = 1*le_base;
		ftime                   = (loadtime+pausetime)*repetition;
	elseif CasetoRun==118 || CasetoRun==173 || CasetoRun==192
		endcostime              = 0.1*le_base;
		endcosramp              = 0.25;
		dispload                = 0.05*le_base;
		ftime                   = 1024*le_base;
	elseif CasetoRun==123 || CasetoRun==151 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==132 || CasetoRun==130
		endcostime              = 0.5;
		endcosramp              = 0.5;
		dispload                = 0.1*le_base;
		ftime                   = 1024;
	elseif CasetoRun==171
		endcostime              = 2;
		endcosramp              = 0.5;
		dispload                = 0.1/2*le_base;
		ftime                   = 1024;
	elseif CasetoRun==170
		endcostime              = 0.5;
		endcosramp              = 0.5;
		dispload                = 0.1/2*le_base;
		ftime                   = 1024;
	elseif CasetoRun==182
		endcostime              = 0.5;
		endcosramp              = 0.5;
		dispload                = 0.1/16*le_base;
		ftime                   = 1024;	
	elseif CasetoRun==184
		endcostime              = 0.5;
		endcosramp              = 0.5;
		dispload                = 0.2*le_base*200;
		ftime                   = 1024;
	elseif CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==189
		endcostime              = 0.009*le_base;
		endcosramp              = 0.006;
		dispload                = le_base;
		ftime                   = 1024*le_base;
	elseif CasetoRun==186 || CasetoRun==193
		endcostime              = 0.009*le_base;
		endcosramp              = 0.003;
		dispload                = le_base;
		ftime                   = 1024*le_base;
	elseif CasetoRun==185
		endcostime              = 0.5;
		endcosramp              = 0.5;
		dispload                = 0.1/16*le_base;
		ftime                   = 1024;
	elseif CasetoRun==181 || CasetoRun==183
		endcostime              = 0.5;
		endcosramp              = 0.5;
		dispload                = 0.1/16*le_base;
		ftime                   = 1024;
	elseif CasetoRun==163 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==177 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165
		endcostime              = 0.5;
		endcosramp              = 0.5;
		%dispload                = 0.1/2*le_base;
		dispload                = 0.1/16*le_base;
		ftime                   = 1024;
	elseif CasetoRun==179
		endcostime              = 0.5;
		endcosramp              = 0.5;
		%dispload                = 0.1/2*le_base;
		dispload                = 0.2*le_base/200;
		ftime                   = 1024;	
	elseif CasetoRun==138
		endcostime              = 0.5;
		endcosramp              = 0.5;
		dispload                = 0.1*le_base;
		ftime                   = 1024;
		sigmainfmax             = 5; %MPa
	elseif CasetoRun==131 || CasetoRun==133 || CasetoRun==134 || CasetoRun==137
		endcostime              = 0.5;
		endcosramp              = 0.5;
		dispload                = 0.2*le_base;
		ftime                   = 1024;
	elseif CasetoRun==139 || CasetoRun==140 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142
		endcostime              = 10;
		endcosramp              = 0.5;
		dispload                = 0.2*le_base;
		ftime                   = 1024;	
	elseif CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==147 || CasetoRun==145
		endcostime              = 0.25;
		endcosramp              = 0.125;
		dispload                = 1*le_base;
		ftime                   = 2.5;	
	elseif CasetoRun==152
		endcostime              = 0.1;
		endcosramp              = 0.2;
		dispload                = 1*le_base;
		ftime                   = 100;	
	elseif CasetoRun==150 || CasetoRun==153
		endcostime              = 0.75;
		endcosramp              = 0.2;
		dispload                = 1*le_base; % this is irrelevant now
		ftime                   = 100;
	elseif CasetoRun==155 || CasetoRun==158 || CasetoRun==157
		endcostime              = 0.75;
		endcosramp              = 0.2;
		dispload                = 1.5*le_base; % this is irrelevant now
		ftime                   = 100;
	elseif CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180
		endcostime              = 0.75;
		endcosramp              = 0.5;
		dispload                = 0.5*le_base;
		ftime                   = 100;
	elseif CasetoRun==156 || CasetoRun==159
		endcostime              = 0.75;
		endcosramp              = 0.2;
		%dispload                = 0.1*le_base;
		dispload                = 0.001*le_base;
		ftime                   = 100;
	elseif CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174
		endcostime              = 0.75;
		endcosramp              = 0.2;
		dispload                = 0.1*le_base;
		ftime                   = 100;
	elseif CasetoRun==154 || CasetoRun==161 %these inputs don't go anywhere, just make sure ftime is large enough to not stop out of nowhere
		endcostime              = 0.75;
		endcosramp              = 0.2;
		dispload                = 1*le_base; % this is irrelevant now
		ftime                   = 100;	
	elseif CasetoRun==135
		endcostime              = 10;
		endcosramp              = 1;
		dispload                = 0.002*le_base;
		ftime                   = 1024;
	elseif CasetoRun==136
		endcostime              = 1;
		endcosramp              = 1;
		dispload                = 0.002*le_base;
		ftime                   = 1024;
	elseif CasetoRun==124
		endcostime              = 0.5;
		endcosramp              = 0.125/40;
		dispload                = 0.02*le_base;
		ftime                   = 1024;	
	elseif CasetoRun==113
		loadtime                = 20;
		pausetime               = 5;
		repetition              = 1;
		dispload                = 1*le_base;
		ftime                   = (loadtime+pausetime)*repetition;
	elseif CasetoRun==112
		loadtime                = 1;
		pausetime               = 10;
		repetition              = 1;
		dispload                = -4*le_base;
		ftime                   = (loadtime+pausetime)*repetition;
	elseif CasetoRun==84 || CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89 || CasetoRun==85
		loadtime=1;
		pausetime=1;
		repetition=1;
		dispload=1*le_base;
		ftime=(loadtime+pausetime)*repetition;
	end
	
	if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==21 || CasetoRun==17 || CasetoRun==12 || CasetoRun==16 || CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44 || CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==15 || CasetoRun==14 || CasetoRun==64 || CasetoRun==66 || CasetoRun==69 || CasetoRun==67 || CasetoRun==68 || CasetoRun==71 || CasetoRun==72 || CasetoRun==73 || CasetoRun==74 || CasetoRun==78 || CasetoRun==81 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==83 || CasetoRun==84 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==112 || CasetoRun==110 || CasetoRun==96 || CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89 || CasetoRun==85 || CasetoRun==77 || CasetoRun==65 || CasetoRun==70
		dtoverride              = 1;
		if CasetoRun==33 || CasetoRun==34 || CasetoRun==39
			massscalingfactor       = 1000;
		else
			massscalingfactor       = 100;
		end
	elseif CasetoRun==111 || CasetoRun==113
		dtoverride              = 0.5;
		massscalingfactor        = 100;
	elseif CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==117
		dtoverride              = 0.25;
		massscalingfactor        = 100;
	elseif CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130
		dtoverride              = 0.25;
		massscalingfactor        = 100;
	elseif CasetoRun==154 || CasetoRun==161
		dtoverride              = 0;
		massscalingfactor        = 1;		
	elseif CasetoRun==124
		dtoverride              = 0.25;
		massscalingfactor        = 100;		
	elseif CasetoRun==4 || CasetoRun==5 || CasetoRun==6 || CasetoRun==7 || CasetoRun==8 || CasetoRun==9 || CasetoRun==10 || CasetoRun==11
		dtoverride              = 0;
		%dtoverride: 0=target time step size; 1=target mass scaling factor, take the more critical; 0.5: calc time step based on mass scaled wood, calc steel mass scaling based on time step; 0.25: mass-scale steel by 100, calc time step, then use time step to calc wood mass scaling.
	end

	dt                      = 0.001;
	ndt                     = round(ftime/dt) +1;
	t_time                       = 0;
	if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==21 || CasetoRun==17
		t0_plane                = 40;
	elseif CasetoRun==4
		t0_plane=100;
	elseif CasetoRun==5 || CasetoRun==6
		t0_plane=25;
	elseif CasetoRun==7
		t0_plane=50;
	elseif CasetoRun==8 || CasetoRun==9
		t0_plane=25;
	elseif CasetoRun==10
		t0_plane=10;
	elseif CasetoRun==11 || CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==15 || CasetoRun==14
		t0_plane                = 44;
	elseif CasetoRun==12 || CasetoRun==16 || CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44
		t0_plane                = 40;
	elseif CasetoRun==64 || CasetoRun==66 || CasetoRun==69 || CasetoRun==67 || CasetoRun==68 || CasetoRun==71 || CasetoRun==72 || CasetoRun==73 || CasetoRun==74 || CasetoRun==78 || CasetoRun==81 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==83 || CasetoRun==84 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==152 || CasetoRun==153 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==117 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110 || CasetoRun==96 || CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89 || CasetoRun==85 || CasetoRun==77 || CasetoRun==65 || CasetoRun==70
		t0_plane=10;
	elseif CasetoRun==154 || CasetoRun==161 || CasetoRun==124 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174
		t0_plane=1;
	end
	
	Emax1=max([Er El Et]);
	Emax2=E;
	if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==21 || CasetoRun==17
		k=0.1;
	elseif CasetoRun==4
		k=0.5;
	elseif CasetoRun==5 || CasetoRun==6
		k=0.25;
	elseif CasetoRun==7
		k=0.25;
	elseif CasetoRun==8 || CasetoRun==9
		k=0.25;
	elseif CasetoRun==10
		k=0.25;
	elseif CasetoRun==11
		k=0.5;
	elseif CasetoRun==12 || CasetoRun==16 || CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44
		k=0.5;
	elseif CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==15 || CasetoRun==14
		k=0.5;
	elseif CasetoRun==183
		k=0.25;
	elseif CasetoRun==64 || CasetoRun==66 || CasetoRun==69 || CasetoRun==67 || CasetoRun==68 || CasetoRun==71 || CasetoRun==72 || CasetoRun==73 || CasetoRun==74 || CasetoRun==78 || CasetoRun==81 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==83 || CasetoRun==84 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==158 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124 || CasetoRun==117 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110 || CasetoRun==96 || CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89 || CasetoRun==85 || CasetoRun==77 || CasetoRun==65 || CasetoRun==70
		k=0.5;
	elseif CasetoRun==155
		k=0.5;
	elseif CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180
		%curan adjust
		k=0.01;
	elseif CasetoRun==125 %new k right here
		k=0.1;
	end
	psp=0;
	C=0;
	Mu=0;
	A=0;
	
	%start of dt determination (automatic)
	%please put dtoverride value meanings!
	if CasetoRun==154 || CasetoRun==161
		psp=1000;
		psp1=psp;
		C=sqrt(E/psp);
		dt=0.04*le(1)/C;
		Mu=E/2/(1+nu);
		A=1;
	else
		if dtoverride==0 || dtoverride==1
			psp_min1=dt^2*Emax1/(k^2*lc^2);
			psp_min2=dt^2*Emax2/(k^2*lc^2);

			if dtoverride
				psp_min1=0;
				psp_min2=0;
			end
			psp1=max([psp_min1 8e-7]);
			psp2=max([psp_min2 7e-6]);
			if dtoverride
				psp1=psp1*massscalingfactor; %wood
				psp2=psp2*massscalingfactor; %steel
				dt=k*lc*sqrt(min([psp1/Emax1 psp2/Emax2]));
			end
		elseif dtoverride==0.5
			psp1=(8e-7)*massscalingfactor;;
			dt=k*lc*sqrt(psp1/Emax1);
			psp_min2=dt^2*Emax2/(k^2*lc^2);
			psp2=max([psp_min2 7e-6]);
			fprintf('%s',['dtoverride=0.5 implemented' char(10)]);
			1;
		elseif dtoverride==0.25
			psp2=(7e-6)*massscalingfactor; %steel
			dt=k*lc*sqrt(psp2/Emax2);
			psp_min1=dt^2*Emax1/(k^2*lc^2);
			psp1=max([psp_min1 8e-7]); %wood
			fprintf('%s',['dtoverride=0.25 implemented' char(10)]);
			1;
		end
	end
	%end of dt determination (automatic)
	
	if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==17
		%% Boundary nodes
		% Boundary coordination
		x_min = 0;
		x_max = 10*le_base;
		y_min = 2*le_base;
		y_max = 16*le_base;
	elseif CasetoRun==21
		%% Boundary nodes
		% Boundary coordination
		x_min = 0;
		x_max = 10*le_base;
		y_min = 2*le_base-le(2);
		y_max = 16*le_base;
	elseif CasetoRun==4
		%% Boundary nodes
		% Boundary coordination
		x_min = 20;
		x_max = 140;
		y_min = 20;
		y_max = 210;
	elseif CasetoRun==5 || CasetoRun==6
		x_min=-1*le_base;
		x_max=(23+1)*le_base;
		if CasetoRun==5
			y_min=-le_base;
		elseif CasetoRun==6
			y_min=-2*le_base;
		end
		y_max=(13+1)*le_base;
	elseif CasetoRun==7
		x_min = 0;
		x_max = 10*le_base;
		y_min = 0;
		y_max = 16*le_base;
	elseif CasetoRun==8 || CasetoRun==9
		x_min=0;
		x_max=23*le_base;
		if CasetoRun==8
			y_min=le_base;
		elseif CasetoRun==9
			y_min=2*le_base;
		end
		y_max=13*le_base;
	elseif CasetoRun==10
		%% Boundary nodes
		% Boundary coordination
		x_min = 0;
		x_max = 10*le_base;
		y_min = 0*le_base;
		y_max = 18*le_base;
	elseif CasetoRun==11
		%% Boundary nodes
		% Boundary coordination
		x_min = 0;
		x_max = 9*le_base;
		y_min = 2*le_base;
		y_max = 22*le_base;
	elseif CasetoRun==12 || CasetoRun==16 || CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44
		%% Boundary nodes
		% Boundary coordination
		x_min = 0;
		x_max = 10*le_base;
		y_min = 0*le_base;
		y_max = 22*le_base;
	elseif CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==15 || CasetoRun==14
		%% Boundary nodes
		% Boundary coordination
		x_min = 0*le_base;
		x_max = 9*le_base;
		y_min = 0*le_base;
		y_max = 22*le_base;
	elseif CasetoRun==64
		x_min=0*le_base;
		x_max=8*le_base;
		y_min=0*le_base;
		y_max=11*le_base;
	elseif CasetoRun==66 || CasetoRun==69
		x_min=0*le_base;
		x_max=13*le_base;
		y_min=0*le_base;
		y_max=11*le_base;
	elseif CasetoRun==67
		x_min=2*le_base;
		x_max=22*le_base;
		y_min=0*le_base; % energy absorbing will be deployed instead
		y_max=8*le_base;
	elseif CasetoRun==68 || CasetoRun==71 || CasetoRun==74 || CasetoRun==78 || CasetoRun==81 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==83 || CasetoRun==77 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==110 || CasetoRun==96
		x_min=2*le_base;
		x_max=22*le_base;
		y_min=2*le_base; % energy absorbing will not be deployed
		y_max=12*le_base;
	elseif CasetoRun==114
		x_min=0*le_base;
		x_max=24*le_base;
		y_min=2*le_base; % energy absorbing will not be deployed
		y_max=12*le_base;
	elseif CasetoRun==111 || CasetoRun==113
		x_min=0*le_base;
		x_max=19*le_base;
		y_min=0*le_base; % energy absorbing will not be deployed
		y_max=20*le_base;
	elseif CasetoRun==115
		x_min=2*le_base;
		x_max=7*le_base;
		y_min=0*le_base; % energy absorbing will not be deployed
		y_max=7*le_base;
	elseif CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==117 || CasetoRun==138
		x_min=2*le_base;
		x_max=6*le_base;
		y_min=0*le_base; % energy absorbing will not be deployed
		y_max=6*le_base;
	elseif CasetoRun==118 || CasetoRun==173 || CasetoRun==192
		x_min=0*le_base;
		x_max=6*le_base;
		y_min=0*le_base; % energy absorbing will not be deployed
		y_max=6*le_base;
	elseif CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169
		x_min=0*le_base;
		x_max=7*le_base;
		y_min=0*le_base; % energy absorbing will not be deployed
		y_max=7*le_base;
	elseif CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==132 || CasetoRun==130
		x_min=2*le_base;
		x_max=8*le_base;
		y_min=0*le_base; % energy absorbing will not be deployed
		y_max=6*le_base;
    elseif CasetoRun==129
		x_min=2*le_base;
		x_max=8*le_base;
		y_min=0*le_base; % energy absorbing will not be deployed
		y_max=6.25*le_base;        
	elseif CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135
		x_min=0*le_base;
		x_max=12*le_base;
		y_min=0*le_base; % energy absorbing will not be deployed
		y_max=6.25*le_base;
	elseif CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142
		x_min=0*le_base;
		x_max=12*le_base;
		y_min=0*le_base; % energy absorbing will not be deployed
		y_max=4.25*le_base;		
	elseif CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==147 || CasetoRun==145
		x_min=0*le_base;
		x_max=15*le_base;
		y_min=0*le_base; % energy absorbing will not be deployed
		y_max=7*le_base;		
	elseif CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153
		x_min=0*le_base;
		x_max=14*le_base;
		y_min=0*le_base; % energy absorbing will not be deployed
		y_max=14*le_base;
	elseif CasetoRun==154 || CasetoRun==161
		x_min=0*le_base;
		x_max=32*le_base;
		y_min=0*le_base; % energy absorbing will not be deployed
		y_max=32*le_base;
	elseif CasetoRun==124
		x_min=0*le_base;
		x_max=10*le_base;
		y_min=0*le_base; % energy absorbing will not be deployed
		y_max=9*le_base;
	elseif CasetoRun==112
		x_min=0*le_base;
		x_max=16*le_base;
		y_min=0*le_base; % energy absorbing will not be deployed
		y_max=17*le_base;
	elseif CasetoRun==84
		x_min=2*le_base;
		x_max=25*le_base;
		y_min=2*le_base; % energy absorbing will not be deployed
		y_max=13*le_base;
	elseif CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89
		x_min=2*le_base;
		x_max=10*le_base;
		y_min=2*le_base; % energy absorbing will not be deployed
		y_max=10*le_base;
	elseif CasetoRun==94
		x_min=2*le_base;
		x_max=11*le_base;
		y_min=2*le_base; % energy absorbing will not be deployed
		y_max=10*le_base;
	elseif CasetoRun==85
		x_min=0*le_base;
		x_max=4*le_base;
		y_min=0*le_base;
		y_max=4*le_base;
	elseif CasetoRun==72 || CasetoRun==73
		x_min=2*le_base;
		x_max=23*le_base;
		y_min=2*le_base; % energy absorbing will not be deployed
		y_max=12*le_base;
	elseif CasetoRun==65 || CasetoRun==70
		x_min=0*le_base;
		x_max=8*le_base;
		y_min=1*le_base;
		y_max=11*le_base;
	end

	[nfbcx,nfbcy,fbcx,fbcy]=Compute_Boundary_Nodes(nodeCount,LOC,x_max,x_min,y_max,y_min);
	% nfbcx: number of boundary nodes in X direction
	% nfbcy: number of boundary nodes in Y direction
	% fbcx: index of all boundary nodes in X direction
	% fbcy: index of all boundary nodes in Y direction

	% Specimen's Extra restraint
	ynodedamped=[];
	if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==17
		for n=1:nodeCount
			if ((LOC(n,2)<=2*le_base+1e-3 & LOC(n,2)>=2*le_base-1e-3)) || ((LOC(n,2)<=10*le_base+1e-3 & LOC(n,2)>=10*le_base-1e-3))
				nfbcx = nfbcx+1;
				fbcx = [fbcx n];
			end
		end
	elseif CasetoRun==21
		for n=1:nodeCount
			if ((LOC(n,2)<=2*le_base-le(2)+1e-3 & LOC(n,2)>=2*le_base-le(2)-1e-3)) || ((LOC(n,2)<=10*le_base+2*le(2)+1e-3 & LOC(n,2)>=10*le_base+2*le(2)-1e-3))
				nfbcx = nfbcx+1;
				fbcx = [fbcx n];
			end
		end
	elseif CasetoRun==4
		for n=1:nodeCount
			%if (LOC(n,1)<=140+1e-3 & LOC(n,1)>=40-1e-3) & (LOC(n,2)<=50+1e-3 & LOC(n,2)>=50-1e-3)
			%    nfbcy = nfbcy+1;
			%    fbcy = [fbcy n];
			%end
			%if (LOC(n,1)<=40+1e-3 & LOC(n,1)>=40-1e-3) & (LOC(n,2)<=150+1e-3 & LOC(n,2)>=140-1e-3)
			%    nfbcy = nfbcy+1;
			%    fbcy = [fbcy n];
			%end
		end
	elseif CasetoRun==5 || CasetoRun==6
		for n=1:nodeCount
			if CasetoRun==5
				if ((LOC(n,2)<=10*le_base+1e-3 && LOC(n,2)>=10*le_base-1e-3)) && ((LOC(n,1)<=13*le_base+1e-3 && LOC(n,1)>=10*le_base-1e-3))
					nfbcx = nfbcx+1;
					fbcx = [fbcx n];
				end
				if ((LOC(n,2)<=1*le_base+1e-3 & LOC(n,2)>=1*le_base-1e-3)) && ((LOC(n,1)<=5*le_base+1e-3 & LOC(n,1)>=2*le_base-1e-3) || (LOC(n,1)<=21*le_base+1e-3 & LOC(n,1)>=18*le_base-1e-3))
					ynodedamped=[ynodedamped n];
				end
			elseif CasetoRun==6
				if ((LOC(n,2)<=10*le_base+1e-3 && LOC(n,2)>=10*le_base-1e-3)) && ((LOC(n,1)<=13*le_base+1e-3 && LOC(n,1)>=10*le_base-1e-3))
					nfbcx = nfbcx+1;
					fbcx = [fbcx n];
				end
				if ((LOC(n,2)<=2*le_base+1e-3 & LOC(n,2)>=2*le_base-1e-3)) && ((LOC(n,1)<=5*le_base+1e-3 & LOC(n,1)>=2*le_base-1e-3) || (LOC(n,1)<=21*le_base+1e-3 & LOC(n,1)>=18*le_base-1e-3))
					ynodedamped=[ynodedamped n];
				end
			end
		end
	elseif CasetoRun==7
		for n=1:nodeCount
			if ((LOC(n,2)<=2*le_base+1e-3 & LOC(n,2)>=2*le_base-1e-3)) || ((LOC(n,2)<=10*le_base+1e-3 & LOC(n,2)>=10*le_base-1e-3))
				nfbcx = nfbcx+1;
				fbcx = [fbcx n];
			end
			if ((LOC(n,2)<=2*le_base+1e-3 & LOC(n,2)>=2*le_base-1e-3)) && ((LOC(n,1)<=7*le_base+1e-3 & LOC(n,1)>=3*le_base-1e-3))
				ynodedamped=[ynodedamped n];
			end
		end
	elseif CasetoRun==8 || CasetoRun==9
		for n=1:nodeCount
			if CasetoRun==8
				if ((LOC(n,2)<=10*le_base+1e-3 && LOC(n,2)>=10*le_base-1e-3)) && ((LOC(n,1)<=13*le_base+1e-3 && LOC(n,1)>=10*le_base-1e-3))
					nfbcx = nfbcx+1;
					fbcx = [fbcx n];
				end        
			elseif CasetoRun==9
				if ((LOC(n,2)<=10*le_base+1e-3 && LOC(n,2)>=10*le_base-1e-3)) && ((LOC(n,1)<=13*le_base+1e-3 && LOC(n,1)>=10*le_base-1e-3))
					nfbcx = nfbcx+1;
					fbcx = [fbcx n];
				end        
			end
		end
	elseif CasetoRun==10
		for n=1:nodeCount
			%wheres it holding?
			if ((LOC(n,2)<=14*le_base+1e-3 && LOC(n,2)>=14*le_base-1e-3)) || ((LOC(n,2)<=2*le_base+1e-3 && LOC(n,2)>=2*le_base-1e-3))
				nfbcx = nfbcx+1;
				fbcx = [fbcx n];
			end
			if ((LOC(n,2)<=2*le_base+1e-3 & LOC(n,2)>=2*le_base-1e-3)) && ((LOC(n,1)<=7*le_base+1e-3 & LOC(n,1)>=3*le_base-1e-3))
				ynodedamped=[ynodedamped n];
			end

		end
	elseif CasetoRun==11
		for n=1:nodeCount
			if ((LOC(n,2)<=19*le_base+1e-3 & LOC(n,2)>=19*le_base-1e-3)) && ((LOC(n,2)<=4*le_base+1e-3 & LOC(n,2)>=4*le_base-1e-3))
				nfbcx = nfbcx+1;
				fbcx = [fbcx n];
			end
			%if ((LOC(n,2)<=2*le_base+1e-3 & LOC(n,2)>=2*le_base-1e-3)) && ((LOC(n,1)<=7*le_base+1e-3 & LOC(n,1)>=3*le_base-1e-3))
			%    ynodedamped=[ynodedamped n];
			%end
		end
	elseif CasetoRun==12 || CasetoRun==16 || CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41
		for n=1:nodeCount
			if ((LOC(n,2)<=18*le_base+1e-3 & LOC(n,2)>=18*le_base-1e-3) || (LOC(n,2)<=2*le_base+1e-3 & LOC(n,2)>=2*le_base-1e-3)) && ((LOC(n,1)<=8*le_base+1e-3 & LOC(n,1)>=2*le_base-1e-3))
				nfbcx = nfbcx+1;
				fbcx = [fbcx n];
			end
			if ((LOC(n,2)<=2*le_base+1e-3 & LOC(n,2)>=2*le_base-1e-3)) && ((LOC(n,1)<=8*le_base+1e-3 & LOC(n,1)>=2*le_base-1e-3))
				ynodedamped=[ynodedamped n];
			end
		end
	elseif CasetoRun==53
		for n=1:nodeCount
			if ((LOC(n,2)<=18*le_base+1e-3 & LOC(n,2)>=18*le_base-1e-3)) && ((LOC(n,1)<=8*le_base+1e-3 & LOC(n,1)>=2*le_base-1e-3))
				nfbcx = nfbcx+1;
				fbcx = [fbcx n];
			end
			if ((LOC(n,2)<=2*le_base+1e-3 & LOC(n,2)>=2*le_base-1e-3)) && ((LOC(n,1)<=8*le_base+1e-3 & LOC(n,1)>=2*le_base-1e-3))
				ynodedamped=[ynodedamped n];
			end
		end    
	elseif CasetoRun==43
		for n=1:nodeCount
			if ((LOC(n,2)<=2*le_base+1e-3 & LOC(n,2)>=2*le_base-1e-3)) && ((LOC(n,1)<=8*le_base+1e-3 & LOC(n,1)>=2*le_base-1e-3))
				nfbcx = nfbcx+1;
				fbcx = [fbcx n];
			end
			if ((LOC(n,2)<=2*le_base+1e-3 & LOC(n,2)>=2*le_base-1e-3)) && ((LOC(n,1)<=8*le_base+1e-3 & LOC(n,1)>=2*le_base-1e-3))
				ynodedamped=[ynodedamped n];
			end
		end
	elseif CasetoRun==44
		for n=1:nodeCount
			if ((LOC(n,2)<=18*le_base+1e-3 & LOC(n,2)>=18*le_base-1e-3)) && ((LOC(n,1)<=8*le_base+1e-3 & LOC(n,1)>=2*le_base-1e-3))
				nfbcx = nfbcx+1;
				fbcx = [fbcx n];
			end
			if ((LOC(n,2)<=2*le_base+1e-3 & LOC(n,2)>=2*le_base-1e-3)) && ((LOC(n,1)<=8*le_base+1e-3 & LOC(n,1)>=2*le_base-1e-3))
				ynodedamped=[ynodedamped n];
			end
		end
	elseif CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==15 || CasetoRun==14
		for n=1:nodeCount
			if CasetoRun==15
				if ((LOC(n,2)<=16*le_base+1e-3 & LOC(n,2)>=16*le_base-1e-3)) && ((LOC(n,1)<=4*le_base+1e-3 & LOC(n,1)>=4*le_base-1e-3))
					nfbcx = nfbcx+1;
					fbcx = [fbcx n];
				end
				if ((LOC(n,2)<=5*le_base+1e-3 & LOC(n,2)>=5*le_base-1e-3)) && ((LOC(n,1)<=7*le_base+1e-3 & LOC(n,1)>=2*le_base-1e-3))
					ynodedamped=[ynodedamped n];
				end
			else
				if ((LOC(n,2)<=19*le_base+1e-3 & LOC(n,2)>=19*le_base-1e-3)) && ((LOC(n,1)<=4*le_base+1e-3 & LOC(n,1)>=4*le_base-1e-3))
					nfbcx = nfbcx+1;
					fbcx = [fbcx n];
				end
				if ((LOC(n,2)<=2*le_base+1e-3 & LOC(n,2)>=2*le_base-1e-3)) && ((LOC(n,1)<=7*le_base+1e-3 & LOC(n,1)>=2*le_base-1e-3))
					ynodedamped=[ynodedamped n];
				end
			end
		end
	elseif CasetoRun==64
		for n=1:nodeCount
			if ((LOC(n,2)<=7*le_base+1e-3 & LOC(n,2)>=4*le_base-1e-3)) && ((LOC(n,1)<=8*le_base+1e-3 & LOC(n,1)>=8*le_base-1e-3))
				ynodedamped=[ynodedamped n];
			end
		end
	elseif CasetoRun==66 || CasetoRun==68
		%{
		for n=1:nodeCount
			if ((LOC(n,2)<=7*le_base+1e-3 & LOC(n,2)>=4*le_base-1e-3)) && ((LOC(n,1)<=13*le_base+1e-3 & LOC(n,1)>=13*le_base-1e-3))
				ynodedamped=[ynodedamped n];
			end
		end
		%}
	elseif CasetoRun==71
		for n=1:nodeCount
			if ((LOC(n,2)<=2*le_base+1e-3 & LOC(n,2)>=2*le_base-1e-3)) && ((LOC(n,1)<=22*le_base+1e-3 & LOC(n,1)>=2*le_base-1e-3))
				nfbcx = nfbcx+1;
				fbcx = [fbcx n];
			end
		end
	elseif CasetoRun==72 || CasetoRun==73 || CasetoRun==74 || CasetoRun==78 || CasetoRun==81 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==83 || CasetoRun==84 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==110 || CasetoRun==96 || CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89 || CasetoRun==85 || CasetoRun==77
	%{
		for n=1:nodeCount
			if ((LOC(n,2)<=2*le_base+1e-3 & LOC(n,2)>=2*le_base-1e-3)) && ((LOC(n,1)<=23*le_base+1e-3 & LOC(n,1)>=2*le_base-1e-3))
				nfbcx = nfbcx+1;
				fbcx = [fbcx n];
			end
		end
		%}
	elseif CasetoRun==111 || CasetoRun==113
		for n=1:nodeCount
			if ((LOC(n,2)<=7*le_base+1e-3 & LOC(n,2)>=7*le_base-1e-3) || (LOC(n,2)<=13*le_base+1e-3 & LOC(n,2)>=13*le_base-1e-3)) && ((LOC(n,1)<=6*le_base+1e-3 & LOC(n,1)>=6*le_base-1e-3))
				nfbcx = nfbcx+1;
				fbcx = [fbcx n];
			end
		end
	elseif CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==189
		for n=1:size(LOC,1)
			if CloseEnough(LOC(n,2),2*le_base,1e-3,1) %pulls down
				nfbcx=nfbcx+1;
				fbcx = [fbcx n];
			elseif CloseEnough(LOC(n,2),5*le_base,1e-3,1) %pulls up
				nfbcx=nfbcx+1;
				fbcx = [fbcx n];
			end
		end			
	elseif CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==130 || CasetoRun==117 || CasetoRun==192
	elseif CasetoRun==171
		for n=1:size(LOC,1)
			if CloseEnough(LOC(i,1),6*le_base,1e-3,1) %pulls up
				if LOC(i,2)>3*le_base+0.5*le(2)
					nfbcx=nfbcx+1;
					fbcx = [fbcx n];
				elseif LOC(i,2)<3*le_base-0.5*le(2) %pulls down
					nfbcx=nfbcx+1;
					fbcx = [fbcx n];
				end
			end
		end		
	elseif CasetoRun==166
		for n=1:size(LOC,1)
			if CloseEnough(LOC(i,2),2.5*le_base,1e-3,1) && CloseEnough(LOC(i,1),5.8*le_base,1e-3,1)
				nfbcx=nfbcx+1;
				fbcx = [fbcx n];
			elseif CloseEnough(LOC(i,2),3.5*le_base,1e-3,1) && CloseEnough(LOC(i,1),5.8*le_base,1e-3,1)
				nfbcx=nfbcx+1;
				fbcx = [fbcx n];
			end
		end		
	elseif CasetoRun==124
		%124 lock
		for n=1:size(LOC,1)
			if CloseEnough(LOC(n,2),2*le_base,1e-3,1)
				nfbcx=nfbcx+1;
				fbcx = [fbcx n];
			elseif CloseEnough(LOC(n,2),7*le_base,1e-3,1)
				nfbcx=nfbcx+1;
				fbcx = [fbcx n];
			end
		end		
	elseif CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135
		for n=1:size(LOC,1)
			if CloseEnough(LOC(n,1),10*le_base,1e-3,1)
				if CloseEnough(LOC(n,2),2*le_base,1e-3,1)
					nfbcx=nfbcx+1;
					fbcx = [fbcx n];
				elseif CloseEnough(LOC(n,2),4.25*le_base,1e-3,1)
					nfbcx=nfbcx+1;
					fbcx = [fbcx n];
				end
			end
		end
	elseif CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==154 || CasetoRun==161 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174
	elseif CasetoRun==175 || CasetoRun==194 || CasetoRun==180
		%for n=1:nodeCount
		%	if CloseEnough(LOC(n,1),7*le_base,1e-3,1)
		%		nfbcx = nfbcx+1;
		%		fbcx = [fbcx n];
		%	end
		%end
	elseif CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==147
		for n=1:nodeCount
			if CloseEnough(LOC(n,1),5*le_base,1e-3,1)
				nfbcx = nfbcx+1;
				fbcx = [fbcx n];
			end
		end
	elseif CasetoRun==150 || CasetoRun==152 || CasetoRun==153
		for n=1:nodeCount
			if CloseEnough(LOC(n,1),7*le_base,1e-3,1)
				nfbcx = nfbcx+1;
				fbcx = [fbcx n];
			end
			if CloseEnough(LOC(n,2),7*le_base,1e-3,1)
				nfbcy = nfbcy+1;
				fbcy = [fbcy n];
			end
		end	
	elseif CasetoRun==145
		%all defined in predxvel
	elseif CasetoRun==112
		for n=1:nodeCount
			if ((LOC(n,2)<=16*le_base+1e-3 & LOC(n,2)>=12*le_base-1e-3)) && ((LOC(n,1)<=2*le_base+1e-3 & LOC(n,1)>=2*le_base-1e-3))
				nfbcy = nfbcy+1;
				fbcy = [fbcy n];
				nfbcx = nfbcx+1;
				fbcx = [fbcx n];
			end
		end
	elseif CasetoRun==69
		for n=1:nodeCount
			if ((LOC(n,2)<=8*le_base+1e-3 & LOC(n,2)>=4*le_base-1e-3)) && ((LOC(n,1)<=13*le_base+1e-3 & LOC(n,1)>=13*le_base-1e-3))
				nfbcy = nfbcy+1;
				fbcy = [fbcy n];
			end
		end
	elseif CasetoRun==65 || CasetoRun==70
		for n=1:nodeCount
			if ((LOC(n,2)<=5*le_base+1e-3 & LOC(n,2)>=2*le_base-1e-3)) && ((LOC(n,1)<=8*le_base+1e-3 & LOC(n,1)>=8*le_base-1e-3))
				ynodedamped=[ynodedamped n];
			end
		end
	elseif CasetoRun==67
		for n=1:nodeCount
			if ((LOC(n,2)>=2*le_base-1e-3) && (LOC(n,2)<=2*le_base+1e-3)) && ((LOC(n,1)>=8*le_base-1e-3) && (LOC(n,1)<=8*le_base+1e-3))
				ynodedamped=[ynodedamped n];
			end
		end
	end
	
	troubleshotparticles=[];
	
	xdirletter=cell(1,1);
	ydirletter=cell(1,1);
	zdirletter=cell(1,1);
	xydirletter=cell(1,1);
	yzdirletter=cell(1,1);
	xzdirletter=cell(1,1);
	
	xdirletter{1,1}='';
	ydirletter{1,1}='';
	zdirletter{1,1}='';
	xydirletter{1,1}='';
	yzdirletter{1,1}='';
	xzdirletter{1,1}='';
	
	thetacrackrtl=[];
	
	support_center_x=[];
	support_center_y=[];
	support_radius=[];
	
	yparticledamped=[];
	ignoremomentum=[];
	Rdisplayedparticles=[];
	
	%start rotational protocol for 159
	rotate.angle_deg=zeros(1,1); %in degrees
	rotate.angle=zeros(1,1); %in rad
	rotate.center=zeros(1,2); %rotation axis
	rotate.R=zeros(2,2);
	
	%end rotational protocol for 159
	
	x_center=0;
	y_center=0;
	
	%{
	x_crack.center=zeros(100,2,100);
	x_crack.top=zeros(100,2,100);
	x_crack.bot=zeros(100,2,100);
	x_crack.npaths=0;
	x_crack.nparticles=zeros(1,100);
	%}
	
	energy.kinetic.value=zeros(1,1);
	energy.strain.value=zeros(1,1);
	energy.strain.ddt=zeros(1,1); %ddt: dstrain/dt
	energy.work.value=zeros(1,1);
	energy.work.ddt=zeros(1,1);
	
	x_crack.center=zeros(200,2,200); %icrackparticle,dimension,icrackpath
	x_crack.top=zeros(200,2,200);
	x_crack.bot=zeros(200,2,200);
	x_crack.npaths=0;
	x_crack.spacing=zeros(1,1); %crack particle spacing
	x_crack.cohesivepath=zeros(1,200); %0=noncohesve, 1=cohesive
	x_crack.cohesivepoint=zeros(200,200); %icrackparticle,icrackpath
	x_crack.nparticles=zeros(1,200);
	x_crack.gauss.locs=zeros(200,2,200,2); %igausspoint, dimension, ipath, which tip
	x_crack.gauss.weights=zeros(200,200,2); %igausspoint, ipath, which tip
	x_crack.gauss.npoints=zeros(1,1);
	x_crack.terminatedprop=zeros(200,2); %ipath, which tip, determines if propagation is terminated
	x_crack.openedgetip=zeros(200,2); %ipath, which tip, determines whether the terminated end is outside an open edge
	x_crack.tipcrackratio=zeros(200,2);
	x_crack.mEfactor=zeros(200,2);
	x_crack.Efactor=zeros(200,2);
	x_crack.mass=zeros(200,2);
	x_crack.force.top=zeros(200,2,200); %icrackparticle,dimension,icrackpath
	x_crack.force.bot=zeros(200,2,200); %icrackparticle,dimension,icrackpath
	x_crack.bridge.base.deltax=zeros(200,2,200); %icrackparticle, dimension, icrackpath (deltax vector)
	x_crack.bridge.base.absdeltax=zeros(200,200); %icrackparticle, icrackpath (deltax magnitude)
	x_crack.bridge.base.absdeltaxmax=zeros(200,200); %icrackparticle, icrackpath (historical maximum displacement)
	x_crack.bridge.adjusted.deltax=zeros(200,2,200); %icrackparticle, dimension, icrackpath (deltax vector corrected)
	x_crack.bridge.adjusted.absdeltax=zeros(200,200); %icrackparticle, icrackpath (deltax magnitude)
	x_crack.bridge.adjusted.absdeltaxmax=zeros(200,200); %icrackparticle, icrackpath (historical maximum displacement)
	x_crack.bridge.adjusted.absdeltaxmaxi=zeros(200,200); %icrackparticle, icrackpath (historical maximum inelastic displacement)
	x_crack.bridge.kbase1=zeros(1,1); %(base stiffness globally)
	x_crack.bridge.kbase2=zeros(200,200); %icrackparticle, icrackpath (base stiffness for specific crack particle)
	x_crack.bridge.yieldforce1=zeros(1,1); %global
	x_crack.bridge.yieldforce2=zeros(200,200); %icrackparticle, icrackpath (maximum force at yield (not traction, must be calibrated from traction), for specific crack particle
	x_crack.bridge.absforce=zeros(200,200); %icrackparticle, icrackpath (magnitude of cohesive force)
	x_crack.bridge.normal.top=zeros(200,2,200); %icrackparticle, dimension, icrackpath (direction of normal surface for top surface)
	x_crack.bridge.normal.bot=zeros(200,2,200); %icrackparticle, dimension, icrackpath (direction of normal surface for bottom surface)
	x_crack.bridge.deltai1=zeros(1,1); % a single universal value
	x_crack.bridge.deltai2=zeros(200,200); %icrackparticle, icrackpath (unique for each 
	x_crack.bridge.deltae=zeros(1,1); % elastic delta, only used as intermediary for calculating stiffness
	x_crack.bridge.isactive=zeros(200,200); %icrackparticle, icrackpath (indicates whether cohesive force is active);
	x_crack.bridge.firsttimeactive=zeros(200,200); %icrackparticle, icrackpath (indicates first time activation to calculate first time displacement base);
	x_crack.bridge.absfirsttimedeltax=zeros(200,200); %icrackparticle, icrackpath (magnitude of deltax for adjustment during first time activation);
	x_crack.bridge.firsttimedeltax=zeros(200,2,200); %icrackparticle, dimension, icrackpath (deltax for adjustment during first time activation);
	x_crack.bridge.tt_first.value=zeros(1,1); %first tt when cohesion starts
	x_crack.bridge.tt_first.savetoken=zeros(1,1); %determines whether to save or not
	x_crack.bridge.tt_last.value=zeros(1,1); %first tt when cohesion is no more
	x_crack.bridge.tt_last.savetoken=zeros(1,1);
	x_crack.bridge.allsevered=zeros(1,1); %1=all bridging zones are completely severed
	x_crack.bridge.pathcompletemonitor.values=zeros(200,1);
	x_crack.bridge.pathcompletemonitor.size=zeros(1,1);
	x_crack.bridge.pathcompletemonitor.check=zeros(1,1);
	x_crack.bridge.storedanddissed.value=zeros(1,1);
	x_crack.bridge.storedanddissed.d=zeros(1,1);
	x_crack.bridge.dissipated1=zeros(1,1);
	x_crack.bridge.dissipated2=zeros(1,1);
	x_crack.bridge.absforcebefore=zeros(200,200);
	x_crack.bridge.adjusted.absdeltaxbefore=zeros(200,200);
	x_crack.bridge.mostsevered=zeros(1,1); %1=most bridging zone (immediate viscinity of crack tip) severed
	x_crack.sequence.tipreg=zeros(200,2); %which path, which tip
	x_crack.sequence.merge=zeros(200,2); %which path, which tip
	
	x_crack.gauss.npoints=0;
	s_tip_dump=zeros(200,3);
	coder.varsize('s_tip_dump');
	s_tip_dump=zeros(2,3);
	s_tip_K1_dump=zeros(200,3);
	coder.varsize('s_tip_K1_dump');
	s_tip_K1_dump=zeros(2,3);
	r_propdirweighted_dump=zeros(200,2);
	coder.varsize('r_propdirweighted_dump');
	r_propdirweighted_dump=zeros(0,2);
	d_tip_dump=zeros(200,8);
	coder.varsize('d_tip_dump');
	d_tip_dump=zeros(0,8);
	d_LOC_tip_dump=zeros(200,8);
	coder.varsize('d_LOC_tip_dump');
	d_LOC_tip_dump=zeros(0,8);
	
	x_tip_dump=zeros(200,2);
	coder.varsize('x_tip_dump');
	x_tip_dump=zeros(2,2);

	s_gauss_dump=zeros(5000,3);
	coder.varsize('s_gauss_dump');
	s_gauss_dump=zeros(2,3);

	x_gauss_dump=zeros(5000,2);
	coder.varsize('x_gauss_dump');
	x_gauss_dump=zeros(2,2);

	%coder.varsize('x_crack.center',[200 2 200]);
	%coder.varsize('x_crack.top',[200 2 200]);
	%coder.varsize('x_crack.bot',[200 2 200]);
	%coder.varsize('x_crack.nparticles',[1 200]);
	
	%[] definitions
	
	E_sp=[];
	exploding_sp=[];
	layer=[];
	x_sp=[];
	matmodel=[];
	orientationoffset=[];
	plotignore=[];
	p_sp=[];
	weakeningfactor_sp=[];
	uncrackable_sp=[];
	donut_pushed_sp=[];
	LWStatus=[];
	EWStatus=[];
	deltarideal_sp=[];
	r1_sp=[];
	r2_sp=[];
	v_ssp_0=[];
	pforce_sp_base=[];
	
	Efactor_sp=zeros(1,4*niCount);
	coder.varsize('Efactor_sp');
	s_si=zeros(niCount,3,200);
	coder.varsize('s_si');
	s_si=zeros(niCount,3,2);
	u_si=zeros(niCount,2,200);
	coder.varsize('u_si');
	u_si=zeros(niCount,2,2);
	v_si=zeros(niCount,2,200);
	coder.varsize('v_si');
	v_si=zeros(niCount,2,2);
	
	s_si_comb=zeros(niCount,3);
	s_si_K1=zeros(niCount,3);
	u_si_comb=zeros(niCount,2);
	m_si_comb=zeros(1,niCount);
	
	
	
	rampedyforceparticle1=[];
	rampedyforceparticle2=[];
	pforcemax=0;
	
	ncforce_cracktop=[];
	ncforce_crackbot=[];
	ParticleswithPredYVel=[];
	ParticlePredYVel=[];
	
	tractionededge=[];
	tractionedcorner=[];
	x_defaultcracktip=[];
	lp=zeros(1,2);
	
	normaledge=[];
	normalcorner=cell(1,1);
	normalcorner{1}=0;
	
	F_rollerX=[];
	coder.varsize('F_rollerX');
	F_rollerY=[];
	coder.varsize('F_rollerY');
	
	
	
	
	if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==17
		if CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==17
			woodcentral_x=3*le_base-5;
			woodcentral_y=2*le_base+40/12*10;
		elseif CasetoRun==52
			woodcentral_x=3*le_base+48.6600;
			woodcentral_y=2*le_base+80-34.5920;
		elseif CasetoRun==54
			woodcentral_x=3*le_base+47.09408825978351;
			woodcentral_y=2*le_base+41.43213988343047;
		end
		%% Particle generation
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		pforce_sp=[];
		r1_sp=[];
		r2_sp=[];
		r_adjustor=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];
		A_sp=[]; %to stop coder whining
		nPar1=0;
		nPar2=0;
		
		x_start=3*le_base;
		x_end=7*le_base;
		y_start=2*le_base;
		y_end=10*le_base;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				if y_trial<2*le_base
					continue;
				elseif y_trial<10*le_base
					if x_trial<3*le_base
						continue;
					elseif x_trial>7*le_base
						continue;
					end
				elseif ((y_trial<11.5*le_base && (CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==17)) ...
						|| (y_trial<12*le_base && (CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39))) %related to steel head height
					if ~(x_trial>3*le_base || (x_trial>2*le_base && (CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45)))
						continue;
					elseif ~(x_trial<7*le_base || (x_trial<8*le_base && (CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45)))
						continue;
					end
				else
					continue;
				end
				sp=sp+1;
				if x_trial>=x_start && x_trial<=x_end && y_trial>=y_start && y_trial<=y_end
					x_number=round((x_trial-x_start-lp(1)/2)/lp(1)+1);
					y_number=round((y_trial-y_start-lp(2)/2)/lp(2)+1);
					layer=MatrixInsertion(layer,x_number,y_number,sp);
					%layer(x_number,y_number)=sp;
				end
				%if sp>spCount
				%    disp('spCount wrong!');
				%    pause;
				%end
				xdirletter{sp}=[];
				ydirletter{sp}=[];
				zdirletter{sp}=[];
				xydirletter{sp}=[];
				yzdirletter{sp}=[];
				xzdirletter{sp}=[];
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				%x_sp(sp,1:2)=[x_trial y_trial];
				if y_trial<10*le_base
					matmodel=VectorInsertion(matmodel,sp,1); % wood schmidt
					%matmodel(sp)=1; % wood schmidt
					p_sp=MatrixInsertion(p_sp,sp,1,psp1);% Density
					%p_sp(sp,1)             = psp1;                % Density
					xdirletter=CellInsertion(xdirletter,sp,'r'); 
					ydirletter=CellInsertion(ydirletter,sp,'t'); 
					zdirletter=CellInsertion(zdirletter,sp,'l'); 
					xydirletter=CellInsertion(xydirletter,sp,'rt'); 
					yzdirletter=CellInsertion(yzdirletter,sp,'tl'); 
					xzdirletter=CellInsertion(xzdirletter,sp,'rl'); 
				elseif ((y_trial<11.5*le_base && (CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==17)) ...
						|| (y_trial<12*le_base && (CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39))) %related to steel head height
					matmodel=VectorInsertion(matmodel,sp,2) %steel
					%matmodel(sp)=2; %steel
					p_sp=MatrixInsertion(p_sp,sp,1,psp2); %Density
					%p_sp(sp,1)             = psp2;                % Density
				end
				if matmodel(sp)==1 || matmodel(sp)==3
					plotignore=VectorInsertion(plotignore,sp,0);
				elseif matmodel(sp)==2
					plotignore=VectorInsertion(plotignore,sp,1);
				end
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				if CasetoRun==1
					orientationoffset=VectorInsertion(orientationoffset,sp,0); %counterclockwise in xy plane
				elseif CasetoRun==2
					orientationoffset=VectorInsertion(orientationoffset,sp,pi/2); %counterclockwise in xy plane
				elseif CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==21 || CasetoRun==17
					deltax=x_trial-woodcentral_x;
					deltay=y_trial-woodcentral_y;
					orientationoffset=VectorInsertion(orientationoffset,sp,reliableatan(deltax,deltay));
					%orientationoffset(sp)=reliableatan(deltax,deltay);
					%if x_trial<woodcentral_x && x_trial>woodcentral_x-le(1) && y_trial>40 && y_trial<40+le(2)
					%    1;
					%end
				end
				if y_trial<10*le_base & y_trial>(10*le_base-lp(1))
					sp_predvelnum=sp_predvelnum+1;
					displacementmonitoredparticles=VectorInsertion(displacementmonitoredparticles,sp_predvelnum,sp);
				end
				%if ((x_trial>60 & x_trial<(60+lp(1))) & (y_trial<50 & x_trial>(50-lp(2)))) | ((x_trial<90 & x_trial>(90-lp(1))) & (y_trial<50 & x_trial>(50-lp(2))))
				%    troubleshotparticles=[troubleshotparticles sp];
				%end
			end
		end
		
	elseif CasetoRun==21
		woodcentral_x=3*le_base-5;
		woodcentral_y=2*le_base+40/12*10+le(2);        

		%% Particle generation
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction
		
		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];
		
		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
	  
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				if y_trial<2*le_base-le(2)
					continue;
				elseif y_trial<2*le_base
					if x_trial<2*le_base
						continue;
					elseif x_trial>8*le_base
						continue;
					end
				elseif y_trial<2*le_base+le(2)
					continue;
				elseif y_trial<10*le_base+le(2)
					if x_trial<3*le_base
						continue;
					elseif x_trial>7*le_base
						continue;
					end
				elseif y_trial<10*le_base+2*le(2)
					continue;
				elseif y_trial<10*le_base+2*le(2)+le_base
					if x_trial<2*le_base
						continue;
					elseif x_trial>8*le_base
						continue;
					end
				else
					continue;
				end
				sp=sp+1;
				%if sp>spCount
				%    disp('spCount wrong!');
				%    pause;
				%end
				xdirletter=CellInsertion(xdirletter,sp,[]);
				ydirletter=CellInsertion(ydirletter,sp,[]);
				zdirletter=CellInsertion(zdirletter,sp,[]);
				xydirletter=CellInsertion(xydirletter,sp,[]);
				yzdirletter=CellInsertion(yzdirletter,sp,[]);
				xzdirletter=CellInsertion(xzdirletter,sp,[]);
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				if y_trial>2*le_base+le(2)/2 && y_trial<10*le_base+le(2)+le(2)/2
					matmodel=VectorInsertion(matmodel,sp,1); % wood schmidt
					p_sp=MatrixInsertion(p_sp,sp,1,psp1); %Density
					xdirletter=CellInsertion(xdirletter,sp,'r');
					ydirletter=CellInsertion(ydirletter,sp,'t');
					zdirletter=CellInsertion(zdirletter,sp,'l');
					xydirletter=CellInsertion(xydirletter,sp,'rt');
					yzdirletter=CellInsertion(yzdirletter,sp,'tl');
					xzdirletter=CellInsertion(xzdirletter,sp,'rl');
				else
					matmodel=VectorInsertion(matmodel,sp,2); %steel
					p_sp=MatrixInsertion(p_sp,sp,1, psp2); % Density
				end
				if matmodel(sp)==1 || matmodel(sp)==3
					plotignore=VectorInsertion(plotignore,sp,0);
				elseif matmodel(sp)==2
					plotignore=VectorInsertion(plotignore,sp,1);
				end
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				if CasetoRun==1
					orientationoffset=VectorInsertion(orientationoffset,sp,0); %counterclockwise in xy plane
				elseif CasetoRun==2
					orientationoffset=VectorInsertion(orientationoffset,sp,pi/2); %counterclockwise in xy plane
				elseif CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==21 || CasetoRun==17
					deltax=x_trial-woodcentral_x;
					deltay=y_trial-woodcentral_y;
					orientationoffset=VectorInsertion(orientationoffset,sp,reliableatan(deltax,deltay));
					%if x_trial<woodcentral_x && x_trial>woodcentral_x-le(1) && y_trial>40 && y_trial<40+le(2)
					%    1;
					%end
				end
				if y_trial<10*le_base+le(2) & y_trial>(10*le_base+le(2)-lp(1))
					sp_predvelnum=sp_predvelnum+1;
					displacementmonitoredparticles=VectorInsertion(displacementmonitoredparticles,sp_predvelnum,sp);
				end
				%if ((x_trial>60 & x_trial<(60+lp(1))) & (y_trial<50 & x_trial>(50-lp(2)))) | ((x_trial<90 & x_trial>(90-lp(1))) & (y_trial<50 & x_trial>(50-lp(2))))
				%    troubleshotparticles=[troubleshotparticles sp];
				%end
			end
		end
		
		
		
	
	elseif CasetoRun==4
		%% Particle generation
		particle_per_cell       = 4;
		%spCount                 = 10*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction
		%x_sp                    = zeros(spCount,1);
		%d_sp                    = zeros(spCount,2);
		%E_acc                   = zeros(spCount,1);
		%epsilonshrinkdot_sp     = zeros(spCount,1);
		%pforce_sp               = zeros(spCount,2);

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			if y_trial<20
				continue;
			elseif y_trial>190
				continue;
			end
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				if x_trial<20
					continue;
				end
				if y_trial<70
					if x_trial>120
						continue;
					end
				elseif y_trial<190
					if x_trial>70
						continue;
					end
				end
				sp=sp+1;
				%if sp>spCount
				%    disp('spCount wrong!');
				%    pause;
				%end
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				matmodel=VectorInsertion(matmodel,sp,1);
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				orientationoffset=VectorInsertion(orientationoffset,sp,0); %counterclockwise in xy plane
				if y_trial<70
					xdirletter=CellInsertion(xdirletter,sp,'l');
					ydirletter=CellInsertion(ydirletter,sp,'r');
					zdirletter=CellInsertion(zdirletter,sp,'t');
					xydirletter=CellInsertion(xydirletter,sp,'lr');
					yzdirletter=CellInsertion(yzdirletter,sp,'rt');
					xzdirletter=CellInsertion(xzdirletter,sp,'lt');
				elseif y_trial<190
					xdirletter=CellInsertion(xdirletter,sp,'r');
					ydirletter=CellInsertion(ydirletter,sp,'l');
					zdirletter=CellInsertion(zdirletter,sp,'t');
					xydirletter=CellInsertion(xydirletter,sp,'rl');
					yzdirletter=CellInsertion(yzdirletter,sp,'lt');
					xzdirletter=CellInsertion(xzdirletter,sp,'rt');
				end
				plotignore=VectorInsertion(plotignore,sp,0);
				if x_trial>20 & x_trial<70 & y_trial<70 & y_trial>(70-lp(2))
					sp_predvelnum=sp_predvelnum+1;
					displacementmonitoredparticles=VectorInsertion(displacementmonitoredparticles,sp_predvelnum,sp);
				end
				p_sp=MatrixInsertion(p_sp,sp,1, psp1); % Density
			end
		end
	elseif CasetoRun==5 || CasetoRun==6
		%% Particle generation
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		x_end=21*le_base;
		y_start=4*le_base;
		y_end=8*le_base;
		
		if CasetoRun==5
			support_center_x=VectorInsertion(support_center_x,1,3.5*le_base);
			support_center_y=VectorInsertion(support_center_y,1,1.5*le_base);
			support_radius=VectorInsertion(support_radius,1,1.5*le_base);
	 
			support_center_x=VectorInsertion(support_center_x,2,19.5*le_base);
			support_center_y=VectorInsertion(support_center_y,2,1.5*le_base);
			support_radius=VectorInsertion(support_radius,2,1.5*le_base);
	 
			support_center_x=VectorInsertion(support_center_x,3,11.5*le_base);
			support_center_y=VectorInsertion(support_center_y,3,10.5*le_base);
			support_radius=VectorInsertion(support_radius,3,1.5*le_base);
		elseif CasetoRun==6
			support_center_x=VectorInsertion(support_center_x,1,3.5*le_base);
			support_center_y=VectorInsertion(support_center_y,1,2.5*le_base);
			support_radius=VectorInsertion(support_radius,1,1.5*le_base);
	 
			support_center_x=VectorInsertion(support_center_x,2,19.5*le_base);
			support_center_y=VectorInsertion(support_center_y,2,2.5*le_base);
			support_radius=VectorInsertion(support_radius,2,1.5*le_base);
	 
			support_center_x=VectorInsertion(support_center_x,3,11.5*le_base);
			support_center_y=VectorInsertion(support_center_y,3,9.5*le_base);
			support_radius=VectorInsertion(support_radius,3,1.5*le_base);
		end
		woodcentral_x=11.5*le_base;
		woodcentral_y=-4*le_base;
			
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				if CasetoRun==5
					if y_trial<le_base
						continue;
					elseif y_trial<4*le_base
						if ((x_trial-support_center_x(1))^2+(y_trial-support_center_y(1))^2)<(support_radius(1))^2
							% dont continue
						elseif ((x_trial-support_center_x(2))^2+(y_trial-support_center_y(2))^2)<(support_radius(2))^2
							% dont continue
						else
							continue;
						end

					elseif y_trial<6*le_base
						if x_trial<2*le_base
							continue;
						elseif x_trial>21*le_base
							continue;
						elseif x_trial>11*le_base && x_trial<12*le_base
							continue;
						%else
							%dont continue
						end                
					elseif y_trial<8*le_base
						if x_trial<2*le_base
							continue;
						elseif x_trial>21*le_base
							continue;
						%else
							%dont continue
						end
					elseif y_trial<9*le_base+support_radius(3)
						if ((x_trial-support_center_x(3))^2+(y_trial-support_center_y(3))^2)<(support_radius(3))^2
							%dont continue
						else
							continue;
						end
					elseif y_trial<12.5*le_base
						if ((x_trial-support_center_x(3))^2)<(support_radius(3))^2
							%dont continue
						else
							continue;
						end
					else
						continue;
					end
				elseif CasetoRun==6
					if y_trial<2*le_base
						continue;
					elseif y_trial<4*le_base
						if ((x_trial-support_center_x(1))^2+(y_trial-support_center_y(1))^2)<(support_radius(1))^2
							% dont continue
						elseif ((x_trial-support_center_x(2))^2+(y_trial-support_center_y(2))^2)<(support_radius(2))^2
							% dont continue
						else
							continue;
						end

					elseif y_trial<6*le_base
						if x_trial<2*le_base
							continue;
						elseif x_trial>21*le_base
							continue;
						elseif x_trial>11*le_base && x_trial<12*le_base
							continue;
						%else
							%dont continue
						end                
					elseif y_trial<8*le_base
						if x_trial<2*le_base
							continue;
						elseif x_trial>21*le_base
							continue;
						%else
							%dont continue
						end
					elseif y_trial<8*le_base+support_radius(3)
						if ((x_trial-support_center_x(3))^2+(y_trial-support_center_y(3))^2)<(support_radius(3))^2
							%dont continue
						else
							continue;
						end
					elseif y_trial<12.5*le_base
						if ((x_trial-support_center_x(3))^2)<(support_radius(3))^2
							%dont continue
						else
							continue;
						end
					else
						continue;
					end
				end
				sp=sp+1;
				%if (x_trial>6*le_base && x_trial<6*le_base+lp(1)) && (y_trial>6*le_base && y_trial<6*le_base+lp(1))
				%    Rdisplayedparticles=[Rdisplayedparticles sp];
				%end
				xdirletter=CellInsertion(xdirletter,sp,[]);
				ydirletter=CellInsertion(ydirletter,sp,[]);
				zdirletter=CellInsertion(zdirletter,sp,[]);
				xydirletter=CellInsertion(xydirletter,sp,[]);
				yzdirletter=CellInsertion(yzdirletter,sp,[]);
				xzdirletter=CellInsertion(xzdirletter,sp,[]);
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				if y_trial>8*le_base
					ignoremomentum=MatrixInsertion(ignoremomentum,sp,1,1);
				else
					ignoremomentum=MatrixInsertion(ignoremomentum,sp,1,0);
				end
				if y_trial<4*le_base || y_trial>8*le_base
					matmodel=VectorInsertion(matmodel,sp,2);
					p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				else
					matmodel=VectorInsertion(matmodel,sp,1); % wood schmidt
					p_sp=MatrixInsertion(p_sp,sp,1, psp1); % Density
					xdirletter=CellInsertion(xdirletter,sp,'l');
					ydirletter=CellInsertion(ydirletter,sp,'r');
					zdirletter=CellInsertion(zdirletter,sp,'t');
					xydirletter=CellInsertion(xydirletter,sp,'lr');
					yzdirletter=CellInsertion(yzdirletter,sp,'rt');
					xzdirletter=CellInsertion(xzdirletter,sp,'lt');
				end
				if matmodel(sp)==1 || matmodel(sp)==3
					plotignore=VectorInsertion(plotignore,sp,0);
				elseif matmodel(sp)==2
					plotignore=VectorInsertion(plotignore,sp,1);
				end
				orientationoffset=VectorInsertion(orientationoffset,sp,(x_trial-((21-2)/2+2)*le_base)/((21-2)*le_base)*2*(pi/3));
				deltax=x_trial-woodcentral_x;
				deltay=y_trial-woodcentral_y;
				orientationoffset=VectorInsertion(orientationoffset,sp,reliableatan(deltax,deltay)-pi/2);
				orientationoffset=VectorInsertion(orientationoffset,sp,0);
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				if x_trial>11*le_base && x_trial<12*le_base && y_trial>6*le_base && y_trial<7*le_base
					sp_predvelnum=sp_predvelnum+1;
					displacementmonitoredparticles=VectorInsertion(displacementmonitoredparticles,sp_predvelnum,sp);
				end
				if CasetoRun==5
					if y_trial<1*le_base+lp(2) && y_trial>1*le_base && ((x_trial>2*le_base && x_trial<5*le_base) || (x_trial>18*le_base && x_trial<21*le_base))
						yparticledamped=VectorInsertion(yparticledamped,length(yparticledamped)+1,sp);
					end
				elseif CasetoRun==6
					if y_trial<2*le_base+lp(2) && y_trial>2*le_base && ((x_trial>2*le_base && x_trial<5*le_base) || (x_trial>18*le_base && x_trial<21*le_base))
						yparticledamped=VectorInsertion(yparticledamped,length(yparticledamped)+1,sp);
					end
				end
			end
		end
	elseif CasetoRun==7
		%% Particle generation
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=3*le_base;
		x_end=7*le_base;
		y_start=2*le_base;
		y_end=10*le_base;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				if y_trial<2*le_base
					continue;
				elseif y_trial<10*le_base
					if x_trial<3*le_base
						continue;
					elseif x_trial >7*le_base
						continue;
					end
				elseif y_trial<14*le_base
					if x_trial<2*le_base
						continue;
					elseif x_trial>8*le_base
						continue;
					end
				else
					continue;
				end
				sp=sp+1;
				ignoremomentum=MatrixInsertion(ignoremomentum,sp,1,0);
				if x_trial>=x_start && x_trial<=x_end && y_trial>=y_start && y_trial<=y_end
					x_number=round((x_trial-x_start-lp(1)/2)/lp(1)+1);
					y_number=round((y_trial-y_start-lp(2)/2)/lp(2)+1);
					layer=MatrixInsertion(layer,x_number,y_number,sp);
				end
				%if sp>spCount
				%    disp('spCount wrong!');
				%    pause;
				%end
				xdirletter=CellInsertion(xdirletter,sp,[]);
				ydirletter=CellInsertion(ydirletter,sp,[]);
				zdirletter=CellInsertion(zdirletter,sp,[]);
				xydirletter=CellInsertion(xydirletter,sp,[]);
				yzdirletter=CellInsertion(yzdirletter,sp,[]);
				xzdirletter=CellInsertion(xzdirletter,sp,[]);
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				if y_trial<10*le_base
					matmodel=VectorInsertion(matmodel,sp,1); % wood schmidt
					p_sp=MatrixInsertion(p_sp,sp,1, psp1); % Density
					xdirletter=CellInsertion(xdirletter,sp,'r');
					ydirletter=CellInsertion(ydirletter,sp,'t');
					zdirletter=CellInsertion(zdirletter,sp,'l');
					xydirletter=CellInsertion(xydirletter,sp,'rt');
					yzdirletter=CellInsertion(yzdirletter,sp,'tl');
					xzdirletter=CellInsertion(xzdirletter,sp,'rl');
				elseif y_trial<14*le_base
					matmodel=VectorInsertion(matmodel,sp,2); %steel
					ignoremomentum=MatrixInsertion(ignoremomentum,sp,1,1);
					p_sp=MatrixInsertion(p_sp,sp,1, psp2); % Density
				end
				if matmodel(sp)==1 || matmodel(sp)==3
					plotignore=VectorInsertion(plotignore,sp,0);
				elseif matmodel(sp)==2
					plotignore=VectorInsertion(plotignore,sp,1);
				end
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				orientationoffset=VectorInsertion(orientationoffset,sp,0); %counterclockwise in xy plane
				if y_trial<14*le_base & y_trial>(14*le_base-lp(1))
					sp_predvelnum=sp_predvelnum+1;
					displacementmonitoredparticles=VectorInsertion(displacementmonitoredparticles,sp_predvelnum,sp);
				end
				if y_trial<2*le_base+lp(2) && y_trial>2*le_base && x_trial>3*le_base && x_trial<7*le_base
					yparticledamped=VectorInsertion(yparticledamped,length(yparticledamped)+1,sp);
				end
				%if ((x_trial>60 & x_trial<(60+lp(1))) & (y_trial<50 & x_trial>(50-lp(2)))) | ((x_trial<90 & x_trial>(90-lp(1))) & (y_trial<50 & x_trial>(50-lp(2))))
				%    troubleshotparticles=[troubleshotparticles sp];
				%end
			end
		end
	elseif CasetoRun==8 || CasetoRun==9
		%% Particle generation
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		%lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		%lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		x_end=21*le_base;
		y_start=4*le_base;
		y_end=8*le_base;
		
		if CasetoRun==8
			support_center_x=VectorInsertion(support_center_x,1,3.5*le_base);
			support_center_y=VectorInsertion(support_center_y,1,1.5*le_base);
			support_radius=VectorInsertion(support_radius,1,1.5*le_base);

			support_center_x=VectorInsertion(support_center_x,2,19.5*le_base);
			support_center_y=VectorInsertion(support_center_y,2,1.5*le_base);
			support_radius=VectorInsertion(support_radius,2,1.5*le_base);

			support_center_x=VectorInsertion(support_center_x,3,11.5*le_base);
			support_center_y=VectorInsertion(support_center_y,3,10.5*le_base);
			support_radius=VectorInsertion(support_radius,3,1.5*le_base);
		elseif CasetoRun==9
			support_center_x=VectorInsertion(support_center_x,1,3.5*le_base);
			support_center_y=VectorInsertion(support_center_y,1,2.5*le_base);
			support_radius=VectorInsertion(support_radius,1,1.5*le_base);

			support_center_x=VectorInsertion(support_center_x,2,19.5*le_base);
			support_center_y=VectorInsertion(support_center_y,2,2.5*le_base);
			support_radius=VectorInsertion(support_radius,2,1.5*le_base);

			support_center_x=VectorInsertion(support_center_x,3,11.5*le_base);
			support_center_y=VectorInsertion(support_center_y,3,9.5*le_base);
			support_radius=VectorInsertion(support_radius,3,1.5*le_base);
		end
		
		for i=1:length(le_x)
			lp_trial_x=le_x(i)/sqrt(particle_per_cell);
			for j=1:length(le_y)
				lp_trial_y=le_y(j)/sqrt(particle_per_cell);
				for k=1:sqrt(particle_per_cell)
					x_trial=sum(le_x(1:i-1))+0.5*lp_trial_x+(k-1)*lp_trial_x;
					for l=1:sqrt(particle_per_cell)
						y_trial=sum(le_y(1:j-1))+0.5*lp_trial_y+(l-1)*lp_trial_y;
						if CasetoRun==8
							if y_trial<le_base
								continue;
							elseif y_trial<4*le_base
								if ((x_trial-support_center_x(1))^2+(y_trial-support_center_y(1))^2)<(support_radius(1))^2
									% dont continue
								elseif ((x_trial-support_center_x(2))^2+(y_trial-support_center_y(2))^2)<(support_radius(2))^2
									% dont continue
								else
									continue;
								end

							elseif y_trial<6*le_base
								if x_trial<2*le_base
									continue;
								elseif x_trial>21*le_base
									continue;
								elseif (x_trial-11.5*le_base)^2 < notchwidth^2
									continue;
								%else
									%dont continue
								end                
							elseif y_trial<8*le_base
								if x_trial<2*le_base
									continue;
								elseif x_trial>21*le_base
									continue;
								%else
									%dont continue
								end
							elseif y_trial<9*le_base+support_radius(3)
								if ((x_trial-support_center_x(3))^2+(y_trial-support_center_y(3))^2)<(support_radius(3))^2
									%dont continue
								else
									continue;
								end
							elseif y_trial<12*le_base
								if ((x_trial-support_center_x(3))^2)<(support_radius(3))^2
									%dont continue
								else
									continue;
								end
							else
								continue;
							end
						elseif CasetoRun==9
							if y_trial<2*le_base
								continue;
							elseif y_trial<4*le_base
								if ((x_trial-support_center_x(1))^2+(y_trial-support_center_y(1))^2)<(support_radius(1))^2
									% dont continue
								elseif ((x_trial-support_center_x(2))^2+(y_trial-support_center_y(2))^2)<(support_radius(2))^2
									% dont continue
								else
									continue;
								end

							elseif y_trial<6*le_base
								if x_trial<2*le_base
									continue;
								elseif x_trial>21*le_base
									continue;
								elseif (x_trial-11.5*le_base)^2 < notchwidth^2
									continue;
								%else
									%dont continue
								end                
							elseif y_trial<8*le_base
								if x_trial<2*le_base
									continue;
								elseif x_trial>21*le_base
									continue;
								%else
									%dont continue
								end
							elseif y_trial<8*le_base+support_radius(3)
								if ((x_trial-support_center_x(3))^2+(y_trial-support_center_y(3))^2)<(support_radius(3))^2
									%dont continue
								else
									continue;
								end
							elseif y_trial<12*le_base
								if ((x_trial-support_center_x(3))^2)<(support_radius(3))^2
									%dont continue
								else
									continue;
								end
							else
								continue;
							end
						end
						sp=sp+1;
						xdirletter=CellInsertion(xdirletter,sp,[]);
						ydirletter=CellInsertion(ydirletter,sp,[]);
						zdirletter=CellInsertion(zdirletter,sp,[]);
						xydirletter=CellInsertion(xydirletter,sp,[]);
						yzdirletter=CellInsertion(yzdirletter,sp,[]);
						xzdirletter=CellInsertion(xzdirletter,sp,[]);
						x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
						x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
						lp=MatrixInsertion(lp,sp,1,lp_trial_x);
						lp=MatrixInsertion(lp,sp,2,lp_trial_y);
						if y_trial<4*le_base || y_trial>8*le_base
							matmodel=VectorInsertion(matmodel,sp,2);
							p_sp=MatrixInsertion(p_sp,sp,1,psp2);
						else
							matmodel=VectorInsertion(matmodel,sp,1); % wood schmidt
							p_sp=MatrixInsertion(p_sp,sp,1, psp1); % Density
							xdirletter=CellInsertion(xdirletter,sp,'l');
							ydirletter=CellInsertion(ydirletter,sp,'r');
							zdirletter=CellInsertion(zdirletter,sp,'t');
							xydirletter=CellInsertion(xydirletter,sp,'lr');
							yzdirletter=CellInsertion(yzdirletter,sp,'rt');
							xzdirletter=CellInsertion(xzdirletter,sp,'lt');
						end
						if matmodel(sp)==1 || matmodel(sp)==3
							plotignore=VectorInsertion(plotignore,sp,0);
						elseif matmodel(sp)==2
							plotignore=VectorInsertion(plotignore,sp,1);
						end
						orientationoffset=VectorInsertion(orientationoffset,sp,0);
						weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
						if x_trial>11*le_base && x_trial<12*le_base && y_trial>6*le_base && y_trial<7*le_base
							sp_predvelnum=sp_predvelnum+1;
							displacementmonitoredparticles=VectorInsertion(displacementmonitoredparticles,sp_predvelnum,sp);
						end
					end
				end
			end
		end
	elseif CasetoRun==10
		%% Particle generation
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=3*le_base;
		x_end=7*le_base;
		y_start=2*le_base;
		y_end=10*le_base;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				if y_trial<2*le_base
					continue;
				elseif y_trial<10*le_base
					if x_trial<3*le_base
						continue;
					elseif x_trial >7*le_base
						continue;
					end
				elseif y_trial<11*le_base
					if x_trial<3*le_base
						continue;
					elseif x_trial>7*le_base
						continue;
					end
				else
					continue;
				end
				sp=sp+1;
				if x_trial>=x_start && x_trial<=x_end && y_trial>=y_start && y_trial<=y_end
					x_number=round((x_trial-x_start-lp(1)/2)/lp(1)+1);
					y_number=round((y_trial-y_start-lp(2)/2)/lp(2)+1);
					layer=MatrixInsertion(layer,x_number,y_number,sp);
				end
				if y_trial>10*le_base
					ignoremomentum=MatrixInsertion(ignoremomentum,sp,1,1);
				else
					ignoremomentum=MatrixInsertion(ignoremomentum,sp,1,0);
				end
				%if sp>spCount
				%    disp('spCount wrong!');
				%    pause;
				%end
				xdirletter=CellInsertion(xdirletter,sp,[]);
				ydirletter=CellInsertion(ydirletter,sp,[]);
				zdirletter=CellInsertion(zdirletter,sp,[]);
				xydirletter=CellInsertion(xydirletter,sp,[]);
				yzdirletter=CellInsertion(yzdirletter,sp,[]);
				xzdirletter=CellInsertion(xzdirletter,sp,[]);
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				if y_trial<10*le_base
					matmodel=VectorInsertion(matmodel,sp,1); % wood schmidt
					p_sp=MatrixInsertion(p_sp,sp,1, psp1); % Density
					xdirletter=CellInsertion(xdirletter,sp,'t');
					ydirletter=CellInsertion(ydirletter,sp,'r');
					zdirletter=CellInsertion(zdirletter,sp,'l');
					xydirletter=CellInsertion(xydirletter,sp,'tr');
					yzdirletter=CellInsertion(yzdirletter,sp,'rl');
					xzdirletter=CellInsertion(xzdirletter,sp,'tl');
				elseif y_trial<14*le_base
					matmodel=VectorInsertion(matmodel,sp,2); %steel
					p_sp=MatrixInsertion(p_sp,sp,1, psp2); % Density
				end
				if y_trial<2*le_base+lp(2) && y_trial>2*le_base && ((x_trial>3*le_base && x_trial<7*le_base))
					yparticledamped=VectorInsertion(yparticledamped,length(yparticledamped)+1,sp);
				end

				if matmodel(sp)==1 || matmodel(sp)==3
					plotignore=VectorInsertion(plotignore,sp,0);
				elseif matmodel(sp)==2
					plotignore=VectorInsertion(plotignore,sp,1);
				end
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				orientationoffset=VectorInsertion(orientationoffset,sp,0); %counterclockwise in xy plane
				if y_trial<10*le_base & y_trial>(10*le_base-lp(1))
					sp_predvelnum=sp_predvelnum+1;
					displacementmonitoredparticles=VectorInsertion(displacementmonitoredparticles,sp_predvelnum,sp);
				end
				%if ((x_trial>60 & x_trial<(60+lp(1))) & (y_trial<50 & x_trial>(50-lp(2)))) | ((x_trial<90 & x_trial>(90-lp(1))) & (y_trial<50 & x_trial>(50-lp(2))))
				%    troubleshotparticles=[troubleshotparticles sp];
				%end
			end
		end
		
	elseif CasetoRun==11
		knot_x=4.5*le_base;
		knot_y=10*le_base;
		knot_r=0.5*le_base;
		knot_xaffect=2*le_base;
		knot_yaffect=3*le_base;
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		x_end=7*le_base;
		y_start=2*le_base;
		y_end=19*le_base;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				if y_trial<2*le_base
					continue;
				elseif y_trial<18*le_base
					if x_trial<2*le_base
						continue;
					elseif x_trial >7*le_base
						continue;
					end
				elseif y_trial<19*le_base %related to steel head height
					if x_trial<2*le_base
						continue;
					elseif x_trial>7*le_base
						continue;
					end
				else
					continue;
				end
				knot_deltaxtocenter=x_trial-knot_x;
				knot_deltaytocenter=y_trial-knot_y;
				if (knot_deltaxtocenter^2+knot_deltaytocenter^2)<knot_r^2
					continue;
				end
				sp=sp+1;
				if x_trial>=x_start && x_trial<=x_end && y_trial>=y_start && y_trial<=y_end
					x_number=round((x_trial-x_start-lp(1)/2)/lp(1)+1);
					y_number=round((y_trial-y_start-lp(2)/2)/lp(2)+1);
					layer=MatrixInsertion(layer,x_number,y_number,sp);
				end
				if y_trial>18*le_base
					ignoremomentum=MatrixInsertion(ignoremomentum,sp,1,1);
				else
					ignoremomentum=MatrixInsertion(ignoremomentum,sp,1,0);
				end
				%if sp>spCount
				%    disp('spCount wrong!');
				%    pause;
				%end
				xdirletter=CellInsertion(xdirletter,sp,[]);
				ydirletter=CellInsertion(ydirletter,sp,[]);
				zdirletter=CellInsertion(zdirletter,sp,[]);
				xydirletter=CellInsertion(xydirletter,sp,[]);
				yzdirletter=CellInsertion(yzdirletter,sp,[]);
				xzdirletter=CellInsertion(xzdirletter,sp,[]);
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				if y_trial<18*le_base
					matmodel=VectorInsertion(matmodel,sp,1); % wood schmidt
					p_sp=MatrixInsertion(p_sp,sp,1, psp1); % Density
					xdirletter=CellInsertion(xdirletter,sp,'t');
					ydirletter=CellInsertion(ydirletter,sp,'l');
					zdirletter=CellInsertion(zdirletter,sp,'r');
					xydirletter=CellInsertion(xydirletter,sp,'tl');
					yzdirletter=CellInsertion(yzdirletter,sp,'lr');
					xzdirletter=CellInsertion(xzdirletter,sp,'tr');
				elseif y_trial<19*le_base %related to steel head height
					matmodel=VectorInsertion(matmodel,sp,2); %steel
					p_sp=MatrixInsertion(p_sp,sp,1, psp2); % Density
				end
				if matmodel(sp)==1 || matmodel(sp)==3
					plotignore=VectorInsertion(plotignore,sp,0);
				elseif matmodel(sp)==2
					plotignore=VectorInsertion(plotignore,sp,1);
				end
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				orientationoffset=VectorInsertion(orientationoffset,sp,0);
				xside=0;
				yside=0;
				if x_trial>knot_x-knot_xaffect && x_trial<knot_x+knot_xaffect
					if x_trial<knot_x
						xside=1;
					else
						xside=2;
					end
				end
				if y_trial>knot_y-knot_yaffect && y_trial<knot_y+knot_yaffect
					if y_trial<knot_y
						yside=1;
					else
						yside=2;
					end
				end
				
				if xside==1
					knot_x_trial_relative=x_trial-(knot_x-knot_xaffect);
				elseif xside==2
					knot_x_trial_relative=(knot_x+knot_xaffect)-x_trial;
				end
				if yside==1
					knot_y_trial_relative=y_trial-(knot_y-knot_yaffect);
				elseif yside==2
					knot_y_trial_relative=(knot_y+knot_yaffect)-y_trial;
				end
				L0=knot_xaffect;
				L1=knot_xaffect-knot_x;
				A=2*L1/L0-1;
				h=knot_yaffect;
				if xside==1 && yside==1 || xside==2 && yside==2
					orientationoffset=VectorInsertion(orientationoffset,sp,-atan(-0.5*knot_x_trial_relative^2*(1-A)/L0*(0.5*pi/h)*sin(pi*knot_y_trial_relative/h)));
				elseif xside==1 && yside==2 || xside==2 && yside==1
					orientationoffset=VectorInsertion(orientationoffset,sp,atan(-0.5*knot_x_trial_relative^2*(1-A)/L0*(0.5*pi/h)*sin(pi*knot_y_trial_relative/h)));
				end                    
				if y_trial<10*le_base & y_trial>(10*le_base-lp(1))
					sp_predvelnum=sp_predvelnum+1;
					displacementmonitoredparticles=VectorInsertion(displacementmonitoredparticles,sp_predvelnum,sp);
				end
				%if ((x_trial>60 & x_trial<(60+lp(1))) & (y_trial<50 & x_trial>(50-lp(2)))) | ((x_trial<90 & x_trial>(90-lp(1))) & (y_trial<50 & x_trial>(50-lp(2))))
				%    troubleshotparticles=[troubleshotparticles sp];
				%end
				%if y_trial<2*le_base+lp(2) && y_trial>2*le_base && (x_trial>2*le_base && x_trial<7*le_base)
				%    yparticledamped=[yparticledamped sp];
				%end
			end
		end
			
	elseif CasetoRun==12 || CasetoRun==16 || CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44
		if CasetoRun==12
			knot_x=5*le_base;
		elseif CasetoRun==16 || CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44
			knot_x=2*le_base+(1/4*90);
		end
		knot_y=7*le_base;
		knot_r=0.5*le_base;
		knot_xaffect=2*le_base;
		knot_yaffect=3*le_base;
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		x_end=8*le_base;
		y_start=2*le_base;
		y_end=19.5*le_base;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				if y_trial<2*le_base
					continue;
				elseif y_trial<18*le_base
					if x_trial<2*le_base
						continue;
					elseif x_trial >8*le_base
						continue;
					end
				elseif y_trial<19.5*le_base %related to steel head height
					if x_trial<2*le_base
						continue;
					elseif x_trial>8*le_base
						continue;
					end
				else
					continue;
				end
				knot_deltaxtocenter=x_trial-knot_x;
				knot_deltaytocenter=y_trial-knot_y;
				if (knot_deltaxtocenter^2+knot_deltaytocenter^2)<knot_r^2
					thisisknot=1;
				else
					thisisknot=0;
				end
				sp=sp+1;
				if x_trial>=x_start && x_trial<=x_end && y_trial>=y_start && y_trial<=y_end
					x_number=round((x_trial-x_start-lp(1)/2)/lp(1)+1);
					y_number=round((y_trial-y_start-lp(2)/2)/lp(2)+1);
					layer=MatrixInsertion(layer,x_number,y_number,sp);
				end
				if y_trial>18*le_base
					ignoremomentum=MatrixInsertion(ignoremomentum,sp,1,1);
				else
					ignoremomentum=MatrixInsertion(ignoremomentum,sp,1,0);
				end
				%if sp>spCount
				%    disp('spCount wrong!');
				%    pause;
				%end
				xdirletter{sp}=[];
				ydirletter{sp}=[];
				zdirletter{sp}=[];
				xydirletter{sp}=[];
				yzdirletter{sp}=[];
				xzdirletter{sp}=[];
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				if y_trial<18*le_base
					matmodel=VectorInsertion(matmodel,sp,1); % wood schmidt
					p_sp=MatrixInsertion(p_sp,sp,1, psp1); % Density
					xdirletter{sp}='t';
					ydirletter{sp}='l';
					zdirletter{sp}='r';
					xydirletter{sp}='tl';
					yzdirletter{sp}='lr';
					xzdirletter{sp}='tr';
				elseif y_trial<19.5*le_base %related to steel head height
					matmodel=VectorInsertion(matmodel,sp,2); %steel
					p_sp=MatrixInsertion(p_sp,sp,1, psp2); % Density
				end
				if matmodel(sp)==1 || matmodel(sp)==3
					plotignore=VectorInsertion(plotignore,sp,0);
				elseif matmodel(sp)==2
					plotignore=VectorInsertion(plotignore,sp,1);
				end
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				orientationoffset=VectorInsertion(orientationoffset,sp,0);
				if thisisknot
					if CasetoRun==12
						weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0.7);
						if x_trial>75 && x_trial<75+lp(1) && y_trial>112.5-lp(2) && y_trial<112.5
							weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0.95);
						elseif x_trial>67.5 && x_trial<67.5+lp(1) && y_trial>105-lp(2) && y_trial<105
							weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0.95);
						end
					elseif CasetoRun==16
						weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0.7);
						if x_trial>52.5 && x_trial<52.5+lp(1) && y_trial>112.5-lp(2) && y_trial<112.5
							weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0.95);
						elseif x_trial>45 && x_trial<45+lp(1) && y_trial>105-lp(2) && y_trial<105
							weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0.95);
						end
					elseif CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44
						weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0.7);
					end
					xdirletter=CellInsertion(xdirletter,sp,'r');
					ydirletter=CellInsertion(ydirletter,sp,'t');
					zdirletter=CellInsertion(zdirletter,sp,'l');
					xydirletter=CellInsertion(xydirletter,sp,'rt');
					yzdirletter=CellInsertion(yzdirletter,sp,'tl');
					xzdirletter=CellInsertion(xzdirletter,sp,'rl');
					orientationoffset=VectorInsertion(orientationoffset,sp,reliableatan(knot_deltaxtocenter,knot_deltaytocenter));
				else
					xside=0;
					yside=0;
					if x_trial>knot_x-knot_xaffect && x_trial<knot_x+knot_xaffect
						if x_trial<knot_x
							xside=1;
						else
							xside=2;
						end
					end
					if y_trial>knot_y-knot_yaffect && y_trial<knot_y+knot_yaffect
						if y_trial<knot_y
							yside=1;
						else
							yside=2;
						end
					end

					if xside==1
						knot_x_trial_relative=x_trial-(knot_x-knot_xaffect);
					elseif xside==2
						knot_x_trial_relative=(knot_x+knot_xaffect)-x_trial;
					end
					if yside==1
						knot_y_trial_relative=y_trial-(knot_y-knot_yaffect);
					elseif yside==2
						knot_y_trial_relative=(knot_y+knot_yaffect)-y_trial;
					end
					L0=knot_xaffect;
					L1=knot_xaffect-knot_r;
					A=2*L1/L0-1;
					h=knot_yaffect;
					%if xside==1 && yside==1 || xside==2 && yside==2
					%    orientationoffset(sp)=-atan(-0.5*knot_x_trial_relative^2*(1-A)/L0*(0.5*pi/h)*sin(pi*knot_y_trial_relative/h));
					%elseif xside==1 && yside==2 || xside==2 && yside==1
					%    orientationoffset(sp)=atan(-0.5*knot_x_trial_relative^2*(1-A)/L0*(0.5*pi/h)*sin(pi*knot_y_trial_relative/h));
					%end                    
					if y_trial<18*le_base & y_trial>(18*le_base-lp(1))
						sp_predvelnum=sp_predvelnum+1;
						displacementmonitoredparticles=VectorInsertion(displacementmonitoredparticles,sp_predvelnum,sp);
					end
					if xside>0 && yside>0
						knot_deltax=x_trial-knot_x;
						knot_deltay=y_trial-knot_y;
						if knot_deltax>0 && knot_deltay>0
							1;
						end
						%dxdy=1/(-1/(-sign(x_trial-knot_x)*((pi*sin((knot_deltay*pi)/h)*((knot_deltax-L0) - knot_r + ((knot_deltax-L0)^2*((L0 - 2*knot_r)/L0 - 1))/(2*L0) - ((knot_deltax-L0)*(L0 - 2*knot_r))/L0))/(2*h))));
						dxdy=(sign(knot_deltax)*((pi*sin((knot_deltay*pi)/h)*((abs(knot_deltax)-L0) - knot_r + ((abs(knot_deltax)-L0)^2*((L0 - 2*knot_r)/L0 - 1))/(2*L0) - ((abs(knot_deltax)-L0)*(L0 - 2*knot_r))/L0))/(2*h)));
						dydx=1/dxdy;
						tantheta=-1/dydx;
						%knot_deltax=knot_deltax-L0;
						%orientationoffset(sp)=-atan((pi*sin((knot_deltay*pi)/h)*(knot_deltax - knot_r + (knot_deltax^2*((L0 - 2*knot_r)/L0 - 1))/(2*L0) - (knot_deltax*(L0 - 2*knot_r))/L0))/(2*h));
						%orientationoffset(sp)=atan(-sign(x_trial-knot_x)*((pi*sin((knot_deltay*pi)/h)*((knot_deltax-L0) - knot_r + ((knot_deltax-L0)^2*((L0 - 2*knot_r)/L0 - 1))/(2*L0) - ((knot_deltax-L0)*(L0 - 2*knot_r))/L0))/(2*h)));
						orientationoffset=VectorInsertion(orientationoffset,sp,atan(tantheta));                    
					end
					%if ((x_trial>60 & x_trial<(60+lp(1))) & (y_trial<50 & x_trial>(50-lp(2)))) | ((x_trial<90 & x_trial>(90-lp(1))) & (y_trial<50 & x_trial>(50-lp(2))))
					%    troubleshotparticles=[troubleshotparticles sp];
					%end
					if y_trial<2*le_base+lp(2) && y_trial>2*le_base && (x_trial>2*le_base && x_trial<8*le_base)
						yparticledamped=VectorInsertion(yparticledamped,length(yparticledamped)+1,sp);
					end
				end
			end
		end
			
	elseif CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==15 || CasetoRun==14
		
		knot_x=[];
		knot_y=[];
		knot_rx=[];
		knot_ry=[];
		knot_theta=[];
		knot_xaffect=[];
		knot_yaffect=[];
		knot_x=[];
		knot_y=[];
		knot_r=[];
		knot_rx=[];
		knot_ry=[];
		knot_theta=[];
		knot_xaffect=[];
		knot_yaffect=[];
		
		if CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37
			knot_x=VectorInsertion(knot_x,1,72+2*le_base);
			knot_y=VectorInsertion(knot_y,1,10*le_base-20);
			knot_rx=VectorInsertion(knot_rx,1,7.625);
			knot_ry=VectorInsertion(knot_ry,1,7.625);
			knot_theta=VectorInsertion(knot_theta,1,0);
			knot_xaffect=VectorInsertion(knot_xaffect,1,2.5*knot_rx(1));
			knot_yaffect=VectorInsertion(knot_yaffect,1,5*knot_rx(1));
			knot_x=VectorInsertion(knot_x,2,28.8+2*le_base);
			knot_y=VectorInsertion(knot_y,2,10*le_base+20);
			knot_rx=VectorInsertion(knot_rx,2,14);
			knot_ry=VectorInsertion(knot_ry,2,8.5);
			knot_theta=VectorInsertion(knot_theta,2,atan(-1/5.5));
			knot_xaffect=VectorInsertion(knot_xaffect,2,[]);
			knot_yaffect=VectorInsertion(knot_yaffect,2,[]);
		else
			knot_x=VectorInsertion(knot_x,1,72+2*le_base);
			knot_y=VectorInsertion(knot_y,1,10*le_base-20);
			knot_r=VectorInsertion(knot_r,1,7.625);
			knot_xaffect=VectorInsertion(knot_xaffect,1,2.5*knot_r(1));
			knot_yaffect=VectorInsertion(knot_yaffect,1,5*knot_r(1));
			knot_x=VectorInsertion(knot_x,2,28.8+2*le_base);
			knot_y=VectorInsertion(knot_y,2,10*le_base+20);
			knot_r=VectorInsertion(knot_r,2,10.875);
			knot_xaffect=VectorInsertion(knot_xaffect,2,2.5*knot_r(2));
			knot_yaffect=VectorInsertion(knot_yaffect,2,5*knot_r(2));
		end
		if CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37
			Xobservedrelative=[0 5 10 15 20 25 30 35 40 45 50 55];
			Yobservedrelative=[140 110 105 100 95 90 85 80 75 70 50];
			Xbigknotobserved=28.5;
			Ybigknotobserved=93;
			Xshift=knot_x(2)-Xbigknotobserved;
			Yshift=knot_y(2)-Ybigknotobserved;
			Xlist=Xobservedrelative+Xshift;
			Ylist=Yobservedrelative+Yshift;
			oneovertanthetalist=[1e99    1e99    1e99    1e99    1e99    1e99    1e99    1e99    1e99    1e99    1e99    1e99;
				1e99    -8  -6  -3  -2.5    -2  -1.5    -2  -2.8    -3.1    -6  1e99;
				1e99    -10 -4.5    -2.5    -1  -1/12   -1/1.5  -1.25   -1.25   -2  -6  1e99;
				1e99    -19 -9.5    -1.5    -1/5.5  1/4 1/2.5   1/2 1/1.3   -3  -13 1e99;
				1e99    1e99    -8  -3  -4  5   1/4 3.5 1/1.5   3.5 1e99    1e99;
				1e99	7   1/2 1   1/2 1/4 -1/2.5  -1  -8  1e99    12	1e99;
				1e99	7	5.2	2	1/2	1/6	1/17.5	-1/10	-1/2	-1	-4.5    1e99;
				1e99	9	7	4.5	1.8	1/2	1/1.8	1/3	1.5	-7	-15 1e99;
				1e99    8   8   4.2 1.5 1/1.5   1/1.3   1.1 2   3   10  1e99;
				1e99    8   4   2.5 1.7 1.2 1.4 1.4 2.5 4   15  1e99;
				1e99    1e99    1e99    1e99    1e99    1e99    1e99    1e99    1e99    1e99    1e99    1e99];

			for i=1:size(oneovertanthetalist,1)
				for j=1:size(oneovertanthetalist,2)
					tanthetalist=MatrixInsertion(tanthetalist,i,j,1/oneovertanthetalist(i,j));
					thetalist=MatrixInsertion(thetalist,i,j,atan(tanthetalist(i,j)));
				end
			end
		end
		%{
		knot_x(1)=3.5*le_base;
		knot_y(1)=(10.5+0.25)*le_base;
		knot_r(1)=0*le_base;
		knot_xaffect(1)=0*le_base;
		knot_yaffect(1)=0*le_base;
		%}
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		if CasetoRun==15
			x_start=2*le_base;
			x_end=7*le_base;
			y_start=5*le_base;
			y_end=16*le_base;
		else
			x_start=2*le_base;
			x_end=7*le_base;
			y_start=2*le_base;
			y_end=19*le_base;
		end
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				if CasetoRun==15
					if y_trial<5*le_base
						continue;
					elseif y_trial<15*le_base
						if x_trial<2*le_base
							continue;
						elseif x_trial >7*le_base
							continue;
						end
					elseif y_trial<16*le_base %related to steel head height
						if x_trial<2*le_base
							continue;
						elseif x_trial>7*le_base
							continue;
						end
					else
						continue;
					end
				else
					if y_trial<2*le_base
						continue;
					elseif y_trial<18*le_base
						if x_trial<2*le_base
							continue;
						elseif x_trial >7*le_base
							continue;
						end
					elseif y_trial<19*le_base %related to steel head height
						if x_trial<2*le_base
							continue;
						elseif x_trial>7*le_base
							continue;
						end
					else
						continue;
					end
				end
				continuesignal=0;
				for knotnum=1:length(knot_x)
					if CasetoRun==25 || CasetoRun==32 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37
						if ((x_trial-knot_x(knotnum))*cos(knot_theta(knotnum))+(y_trial-knot_y(knotnum))*sin(knot_theta(knotnum)))^2/knot_rx(knotnum)^2+((x_trial-knot_x(knotnum))*sin(knot_theta(knotnum))-(y_trial-knot_y(knotnum))*cos(knot_theta(knotnum)))^2/knot_ry(knotnum)^2<1
							continuesignal=1;
						end
					elseif CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61
					else 
						knot_deltax=x_trial-knot_x(knotnum);
						knot_deltay=y_trial-knot_y(knotnum);
						if (knot_deltax^2+knot_deltay^2)<knot_r(knotnum)^2
							continuesignal=1;
						end
					end
				end
				if continuesignal==1
					continue;
				end
				sp=sp+1;
				if x_trial>=x_start && x_trial<=x_end && y_trial>=y_start && y_trial<=y_end
					x_number=round((x_trial-x_start-lp(1)/2)/lp(1)+1);
					y_number=round((y_trial-y_start-lp(2)/2)/lp(2)+1);
					layer=MatrixInsertion(layer,x_number,y_number,sp);
				end
				if CasetoRun==15
					if y_trial>15*le_base
						ignoremomentum=MatrixInsertion(ignoremomentum,sp,1,1);
					else
						ignoremomentum=MatrixInsertion(ignoremomentum,sp,1,0);
					end
				else
					if y_trial>18*le_base
						ignoremomentum=MatrixInsertion(ignoremomentum,sp,1,1);
					else
						ignoremomentum=MatrixInsertion(ignoremomentum,sp,1,0);
					end
				end
				%if sp>spCount
				%    disp('spCount wrong!');
				%    pause;
				%end
				xdirletter=CellInsertion(xdirletter,sp,[]);
				ydirletter=CellInsertion(ydirletter,sp,[]);
				zdirletter=CellInsertion(zdirletter,sp,[]);
				xydirletter=CellInsertion(xydirletter,sp,[]);
				yzdirletter=CellInsertion(yzdirletter,sp,[]);
				xzdirletter=CellInsertion(xzdirletter,sp,[]);
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				if CasetoRun==15
					if y_trial<15*le_base
						matmodel=VectorInsertion(matmodel,sp,1); % wood schmidt
						p_sp=MatrixInsertion(p_sp,sp,1, psp1); % Density
						xdirletter=CellInsertion(xdirletter,sp,'t');
						ydirletter=CellInsertion(ydirletter,sp,'l');
						zdirletter=CellInsertion(zdirletter,sp,'r');
						xydirletter=CellInsertion(xydirletter,sp,'tl');
						yzdirletter=CellInsertion(yzdirletter,sp,'lr');
						xzdirletter=CellInsertion(xzdirletter,sp,'tr');
					elseif y_trial<16*le_base %related to steel head height
						matmodel=VectorInsertion(matmodel,sp,2); %steel
						p_sp=MatrixInsertion(p_sp,sp,1, psp2); % Density
					end
				elseif CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37
					if y_trial<18*le_base
						if CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63
							itsasquishyball=0;
							for knotnum=1:length(knot_x)
								if ((x_trial-knot_x(knotnum))*cos(knot_theta(knotnum))+(y_trial-knot_y(knotnum))*sin(knot_theta(knotnum)))^2/knot_rx(knotnum)^2+((x_trial-knot_x(knotnum))*sin(knot_theta(knotnum))-(y_trial-knot_y(knotnum))*cos(knot_theta(knotnum)))^2/knot_ry(knotnum)^2<1
									itsasquishyball=1;
								end
							end
							if itsasquishyball
								matmodel=VectorInsertion(matmodel,sp,3);
								p_sp=MatrixInsertion(p_sp,sp,1,psp1);
							else
								matmodel=VectorInsertion(matmodel,sp,1); % wood schmidt
								p_sp=MatrixInsertion(p_sp,sp,1, psp1); % Density
								xdirletter=CellInsertion(xdirletter,sp,'l');
								ydirletter=CellInsertion(ydirletter,sp,'t');
								zdirletter=CellInsertion(zdirletter,sp,'r');
								xydirletter=CellInsertion(xydirletter,sp,'lt');
								yzdirletter=CellInsertion(yzdirletter,sp,'tr');
								xzdirletter=CellInsertion(xzdirletter,sp,'lr');
							end
						else
							matmodel=VectorInsertion(matmodel,sp,1); % wood schmidt
							p_sp=MatrixInsertion(p_sp,sp,1, psp1); % Density
							xdirletter=CellInsertion(xdirletter,sp,'l');
							ydirletter=CellInsertion(ydirletter,sp,'t');
							zdirletter=CellInsertion(zdirletter,sp,'r');
							xydirletter=CellInsertion(xydirletter,sp,'lt');
							yzdirletter=CellInsertion(yzdirletter,sp,'tr');
							xzdirletter=CellInsertion(xzdirletter,sp,'lr');
						end
					elseif y_trial<19*le_base %related to steel head height
						matmodel=VectorInsertion(matmodel,sp,2); %steel
						p_sp=MatrixInsertion(p_sp,sp,1, psp2); % Density
					end
				else
					if y_trial<18*le_base
						if CasetoRun==57 || CasetoRun==58 || CasetoRun==61
							itsasquishyball=0;
							for knotnum=1:length(knot_x)
								if ((x_trial-knot_x(knotnum))*cos(knot_theta(knotnum))+(y_trial-knot_y(knotnum))*sin(knot_theta(knotnum)))^2/knot_rx(knotnum)^2+((x_trial-knot_x(knotnum))*sin(knot_theta(knotnum))-(y_trial-knot_y(knotnum))*cos(knot_theta(knotnum)))^2/knot_ry(knotnum)^2<1
									itsasquishyball=1;
								end
							end
							if itsasquishyball
								matmodel=VectorInsertion(matmodel,sp,3);
								p_sp=MatrixInsertion(p_sp,sp,1,psp1);
							else
								matmodel=VectorInsertion(matmodel,sp,1); % wood schmidt
								p_sp=MatrixInsertion(p_sp,sp,1, psp1); % Density
								xdirletter=CellInsertion(xdirletter,sp,'t');
								ydirletter=CellInsertion(ydirletter,sp,'l');
								zdirletter=CellInsertion(zdirletter,sp,'r');
								xydirletter=CellInsertion(xydirletter,sp,'tl');
								yzdirletter=CellInsertion(yzdirletter,sp,'lr');
								xzdirletter=CellInsertion(xzdirletter,sp,'tr');
							end
						else
							matmodel=VectorInsertion(matmodel,sp,1); % wood schmidt
							p_sp=MatrixInsertion(p_sp,sp,1, psp1); % Density
							xdirletter=CellInsertion(xdirletter,sp,'t');
							ydirletter=CellInsertion(ydirletter,sp,'l');
							zdirletter=CellInsertion(zdirletter,sp,'r');
							xydirletter=CellInsertion(xydirletter,sp,'tl');
							yzdirletter=CellInsertion(yzdirletter,sp,'lr');
							xzdirletter=CellInsertion(xzdirletter,sp,'tr');
						end
					elseif y_trial<19*le_base %related to steel head height
						matmodel=VectorInsertion(matmodel,sp,2); %steel
						p_sp=MatrixInsertion(p_sp,sp,1, psp2); % Density
					end
				end
				if matmodel(sp)==1 || matmodel(sp)==3
					plotignore=VectorInsertion(plotignore,sp,0);
				elseif matmodel(sp)==2
					plotignore=VectorInsertion(plotignore,sp,1);
				end
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				if CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61
					orientationoffset=VectorInsertion(orientationoffset,sp,0);
					for knotnum=1:1
						if abs(x_trial-knot_x(knotnum))<=knot_xaffect(knotnum) && abs(y_trial-knot_y(knotnum))<=knot_yaffect(knotnum)
							knot_deltax=x_trial-knot_x(knotnum);
							knot_deltay=y_trial-knot_y(knotnum);
							L0=knot_xaffect(knotnum);
							L1=knot_xaffect(knotnum)-knot_x(knotnum);
							h=knot_yaffect(knotnum);
							if CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37
								dxdy=(sign(knot_deltax)*((pi*sin((knot_deltay*pi)/h)*((abs(knot_deltax)-L0) - knot_rx(knotnum) + ((abs(knot_deltax)-L0)^2*((L0 - 2*knot_rx(knotnum))/L0 - 1))/(2*L0) - ((abs(knot_deltax)-L0)*(L0 - 2*knot_rx(knotnum)))/L0))/(2*h)));
							else
								dxdy=(sign(knot_deltax)*((pi*sin((knot_deltay*pi)/h)*((abs(knot_deltax)-L0) - knot_r(knotnum) + ((abs(knot_deltax)-L0)^2*((L0 - 2*knot_r(knotnum))/L0 - 1))/(2*L0) - ((abs(knot_deltax)-L0)*(L0 - 2*knot_r(knotnum)))/L0))/(2*h)));
							end
							orientationoffset=VectorInsertion(orientationoffset,sp,atan(-dxdy));
						end
					end
					if x_trial>min(Xlist) && x_trial<max(Xlist) && y_trial>min(Ylist) && y_trial<max(Ylist)
						orientationoffset=VectorInsertion(orientationoffset,sp,interp2(Xlist,Ylist,thetalist,x_trial,y_trial));
					end
					
					if y_trial<18*le_base & y_trial>(18*le_base-lp(1))
						sp_predvelnum=sp_predvelnum+1;
						displacementmonitoredparticles=VectorInsertion(displacementmonitoredparticles,sp_predvelnum,sp);
					end
					%if ((x_trial>60 & x_trial<(60+lp(1))) & (y_trial<50 & x_trial>(50-lp(2)))) | ((x_trial<90 & x_trial>(90-lp(1))) & (y_trial<50 & x_trial>(50-lp(2))))
					%    troubleshotparticles=[troubleshotparticles sp];
					%end
				elseif CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37
					if plotignore(sp)
						orientationoffset=VectorInsertion(orientationoffset,sp,0);
					elseif matmodel(sp)==3
						orientationoffset=VectorInsertion(orientationoffset,sp,0);
					elseif y_trial<=13*le_base && y_trial>=7*le_base
						%orientationoffset(sp)=gerhardangles(2*le_base,7*le_base,x_trial,y_trial);
						%orientationoffset(sp)=gerhardanglesellipseonly(x_trial,y_trial,knot_x,knot_y,knot_rx,knot_ry,knot_theta);
						orientationoffset=VectorInsertion(orientationoffset,sp,gerhardanglescombined(2*le_base,7*le_base,x_trial,y_trial,knot_x,knot_y,knot_rx,knot_ry,knot_theta,CasetoRun));
						if orientationoffset(sp)<0 || orientationoffset(sp)>pi
							fprintf('%s',['angle inccorect' char(10)]);
							pause
							1;
						end
					else
						orientationoffset=VectorInsertion(orientationoffset,sp,pi/2);
					end
				else
					dxdy=0;
					for knotnum=1:length(knot_x)
						if abs(x_trial-knot_x(knotnum))<=knot_xaffect(knotnum) && abs(y_trial-knot_y(knotnum))<=knot_yaffect(knotnum)
							knot_deltax=x_trial-knot_x(knotnum);
							knot_deltay=y_trial-knot_y(knotnum);
							L0=knot_xaffect(knotnum);
							L1=knot_xaffect(knotnum)-knot_x(knotnum);
							h=knot_yaffect(knotnum);
							dxdy=dxdy+(sign(knot_deltax)*((pi*sin((knot_deltay*pi)/h)*((abs(knot_deltax)-L0) - knot_r(knotnum) + ((abs(knot_deltax)-L0)^2*((L0 - 2*knot_r(knotnum))/L0 - 1))/(2*L0) - ((abs(knot_deltax)-L0)*(L0 - 2*knot_r(knotnum)))/L0))/(2*h)));
						end
					end
					orientationoffset=VectorInsertion(orientationoffset,sp,atan(-dxdy));
					%if ((x_trial>60 & x_trial<(60+lp(1))) & (y_trial<50 & x_trial>(50-lp(2)))) | ((x_trial<90 & x_trial>(90-lp(1))) & (y_trial<50 & x_trial>(50-lp(2))))
					%    troubleshotparticles=[troubleshotparticles sp];
					%end
				end
				if y_trial<18*le_base & y_trial>(18*le_base-lp(1))
					sp_predvelnum=sp_predvelnum+1;
					displacementmonitoredparticles=VectorInsertion(displacementmonitoredparticles,sp_predvelnum,sp);
				end
				if CasetoRun==15
					if y_trial<5*le_base+lp(2) && y_trial>5*le_base && (x_trial>2*le_base && x_trial<7*le_base)
						yparticledamped=VectorInsertion(yparticledamped,length(yparticledamped)+1,sp);
					end
				else
					if y_trial<2*le_base+lp(2) && y_trial>2*le_base && (x_trial>2*le_base && x_trial<7*le_base)
						yparticledamped=VectorInsertion(yparticledamped,length(yparticledamped)+1,sp);
					end
				end
			end
		end
	elseif CasetoRun==64
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		x_end=8*le_base;
		y_start=2*le_base;
		y_end=9*le_base;
		x_crack.npaths=1;
		x_crack.nparticles(1)=6;

		x_crack.center(1,1,1)=20;
		x_crack.center(1,2,1)=55;
		x_crack.center(2,1,1)=22;
		x_crack.center(2,2,1)=55;
		x_crack.center(3,1,1)=32;
		x_crack.center(3,2,1)=55;
		x_crack.center(4,1,1)=42;
		x_crack.center(4,2,1)=55;
		x_crack.center(5,1,1)=51;
		x_crack.center(5,2,1)=55;
		x_crack.center(6,1,1)=52;
		x_crack.center(6,2,1)=55;
		
		x_crack.top=x_crack.center;
		x_crack.bot=x_crack.center;
				
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				%if x_trial>2*le_base && x_trial<8*le_base && y_trial>2*le_base && y_trial<6*le_base
				if x_trial<x_start
					continue;
				elseif x_trial<x_start+le_base
					if y_trial<y_start
						continue;
					elseif y_trial>y_end
						continue;
					end
				elseif x_trial<x_end
					if y_trial<y_start+2*le_base
						continue;
					elseif y_trial>y_end-2*le_base
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				
				xdirletter=CellInsertion(xdirletter,sp,[]);
				ydirletter=CellInsertion(ydirletter,sp,[]);
				zdirletter=CellInsertion(zdirletter,sp,[]);
				xydirletter=CellInsertion(xydirletter,sp,[]);
				yzdirletter=CellInsertion(yzdirletter,sp,[]);
				xzdirletter=CellInsertion(xzdirletter,sp,[]);
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				matmodel=VectorInsertion(matmodel,sp,2); %elastic (can be steel rubber or whatever)
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				plotignore=VectorInsertion(plotignore,sp,0);
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				orientationoffset=VectorInsertion(orientationoffset,sp,0);
				
				if x_trial>7*le_base+lp(1);
					yparticledamped=VectorInsertion(yparticledamped,length(yparticledamped)+1,sp);
				end

				
			end
		end
	elseif CasetoRun==66
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		x_end=13*le_base;
		y_start=2*le_base;
		y_end=9*le_base;
		
		x_crack.npaths=1;
		x_crack.nparticles(1)=6;
		
		x_crack.center(1,1,1)=20;
		x_crack.center(1,2,1)=55;
		x_crack.center(2,1,1)=22;
		x_crack.center(2,2,1)=55;
		x_crack.center(3,1,1)=32;
		x_crack.center(3,2,1)=55;
		x_crack.center(4,1,1)=42;
		x_crack.center(4,2,1)=55;
		x_crack.center(5,1,1)=51;
		x_crack.center(5,2,1)=55;
		x_crack.center(6,1,1)=52;
		x_crack.center(6,2,1)=55;
		
		x_crack.top=x_crack.center;
		x_crack.bot=x_crack.center;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				%if x_trial>2*le_base && x_trial<8*le_base && y_trial>2*le_base && y_trial<6*le_base
				if x_trial<x_start
					continue;
				elseif x_trial<x_start+le_base
					if y_trial<y_start
						continue;
					elseif y_trial>y_end
						continue;
					end
				elseif x_trial<x_end
					if y_trial<y_start+2*le_base
						continue;
					elseif y_trial>y_end-2*le_base
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				
				xdirletter=CellInsertion(xdirletter,sp,[]);
				ydirletter=CellInsertion(ydirletter,sp,[]);
				zdirletter=CellInsertion(zdirletter,sp,[]);
				xydirletter=CellInsertion(xydirletter,sp,[]);
				yzdirletter=CellInsertion(yzdirletter,sp,[]);
				xzdirletter=CellInsertion(xzdirletter,sp,[]);
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				matmodel=VectorInsertion(matmodel,sp,2); %elastic (can be steel rubber or whatever)
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				plotignore=VectorInsertion(plotignore,sp,0);
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				orientationoffset=VectorInsertion(orientationoffset,sp,0);
				
	%			if x_trial>12*le_base+lp(1);
	%				yparticledamped=[yparticledamped sp];
	%			end

				
			end
		end
	elseif CasetoRun==69
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		x_end=13*le_base;
		y_start=4*le_base;
		y_end=8*le_base;
		%{
		x_crack(1,1)=20;
		x_crack(1,2)=55;
		x_crack(2,1)=22;
		x_crack(2,2)=55;
		x_crack(3,1)=32;
		x_crack(3,2)=55;
		x_crack(4,1)=42;
		x_crack(4,2)=55;
		x_crack(5,1)=51;
		x_crack(5,2)=55;
		x_crack(6,1)=52;
		x_crack(6,2)=55;
		%}
		
		x_crack.npaths=1;
		x_crack.nparticles(1)=2;
		
		x_crack.center(1,1,1)=2*le_base;
		x_crack.center(1,2,1)=6*le_base;
		x_crack.center(2,1,1)=5*le_base;
		x_crack.center(2,2,1)=6*le_base;
		
		x_crack.top=x_crack.center;
		x_crack.bot=x_crack.center;
				
		pforcemax=10;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				%if x_trial>2*le_base && x_trial<8*le_base && y_trial>2*le_base && y_trial<6*le_base
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial>y_end
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				
				xdirletter=CellInsertion(xdirletter,sp,[]);
				ydirletter=CellInsertion(ydirletter,sp,[]);
				zdirletter=CellInsertion(zdirletter,sp,[]);
				xydirletter=CellInsertion(xydirletter,sp,[]);
				yzdirletter=CellInsertion(yzdirletter,sp,[]);
				xzdirletter=CellInsertion(xzdirletter,sp,[]);
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				matmodel=VectorInsertion(matmodel,sp,2); %elastic (can be steel rubber or whatever)
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				plotignore=VectorInsertion(plotignore,sp,0);
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				orientationoffset=VectorInsertion(orientationoffset,sp,0);
				if x_trial<x_start+lp(1) && y_trial<y_start+lp(2)
					rampedyforceparticle1=VectorInsertion(rampedyforceparticle1,length(rampedyforceparticle1)+1,sp);
				elseif x_trial<x_start+lp(1) && y_trial>y_end-lp(2)
					rampedyforceparticle2=VectorInsertion(rampedyforceparticle2,length(rampedyforceparticle2)+1,sp);
				end
				
	%			if x_trial>12*le_base+lp(1);
	%				yparticledamped=[yparticledamped sp];
	%			end

				
			end
		end
	elseif CasetoRun==68
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		x_end=22*le_base;
		y_start=2*le_base;
		y_end=10*le_base;
		
		x_crack.npaths=1;
		x_crack.nparticles(1)=3;
		
		x_crack.center(1,1,1)=60;
		x_crack.center(1,2,1)=55;
		x_crack.center(2,1,1)=60;
		x_crack.center(2,2,1)=41;
		x_crack.center(3,1,1)=60;
		x_crack.center(3,2,1)=40;
		
		x_crack.top=x_crack.center;
		x_crack.bot=x_crack.center;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				%if x_trial>2*le_base && x_trial<8*le_base && y_trial>2*le_base && y_trial<6*le_base
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial>y_end
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				
				xdirletter=CellInsertion(xdirletter,sp,[]);
				ydirletter=CellInsertion(ydirletter,sp,[]);
				zdirletter=CellInsertion(zdirletter,sp,[]);
				xydirletter=CellInsertion(xydirletter,sp,[]);
				yzdirletter=CellInsertion(yzdirletter,sp,[]);
				xzdirletter=CellInsertion(xzdirletter,sp,[]);
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				matmodel=VectorInsertion(matmodel,sp,2); %elastic (can be steel rubber or whatever)
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				plotignore=VectorInsertion(plotignore,sp,0);
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				orientationoffset=VectorInsertion(orientationoffset,sp,0);
				%{
				if y_trial<2*le_base+lp(2);
					yparticledamped=[yparticledamped sp];
				end
				%}
				%{
				if y_trial>4*le_base
					epsilonshrinkdotx_sp(sp,1)=-0.02;
					%epsilonshrinkdoty_sp(sp,1)=-0.01;
				else
					epsilonshrinkdotx_sp(sp,1)=0;
					%epsilonshrinkdoty_sp(sp,1)=0;
				end
				%}
				epsilonshrinkdot_sp=MatrixInsertion(epsilonshrinkdot_sp,sp,1,-0.02*(y_trial-y_start)/(y_end-y_start));
			end
		end

	elseif CasetoRun==71
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		x_end=22*le_base;
		y_start=2*le_base;
		y_end=10*le_base;
		
		x_crack.npaths=1;
		x_crack.nparticles(1)=3;
		
		x_crack.center(1,1,1)=60;
		x_crack.center(1,2,1)=55;
		x_crack.center(2,1,1)=60;
		x_crack.center(2,2,1)=50;
		x_crack.center(3,1,1)=60;
		x_crack.center(3,2,1)=49.5;
		
		x_crack.top=x_crack.center;
		x_crack.bot=x_crack.center;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				%if x_trial>2*le_base && x_trial<8*le_base && y_trial>2*le_base && y_trial<6*le_base
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial>y_end
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				
				xdirletter=CellInsertion(xdirletter,sp,[]);
				ydirletter=CellInsertion(ydirletter,sp,[]);
				zdirletter=CellInsertion(zdirletter,sp,[]);
				xydirletter=CellInsertion(xydirletter,sp,[]);
				yzdirletter=CellInsertion(yzdirletter,sp,[]);
				xzdirletter=CellInsertion(xzdirletter,sp,[]);
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				matmodel=VectorInsertion(matmodel,sp,2); %elastic (can be steel rubber or whatever)
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				plotignore=VectorInsertion(plotignore,sp,0);
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				orientationoffset=VectorInsertion(orientationoffset,sp,0);
				thetacrackrtl=VectorInsertion(thetacrackrtl,sp,0);
				%{
				if y_trial<2*le_base+lp(2);
					yparticledamped=[yparticledamped sp];
				end
				%}
				%{
				if y_trial>4*le_base
					epsilonshrinkdotx_sp(sp,1)=-0.02;
					%epsilonshrinkdoty_sp(sp,1)=-0.01;
				else
					epsilonshrinkdotx_sp(sp,1)=0;
					%epsilonshrinkdoty_sp(sp,1)=0;
				end
				%}
				epsilonshrinkdot_sp=MatrixInsertion(epsilonshrinkdot_sp,sp,1,-0.02*(y_trial-y_start)/(y_end-y_start));
			end
		end
	elseif CasetoRun==72
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		x_end=23*le_base;
		y_start=2*le_base;
		y_end=10*le_base;
		x_notch_start=12*le_base;
		x_notch_end=13*le_base;
		y_notch_tip=8*le_base;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				%if x_trial>2*le_base && x_trial<8*le_base && y_trial>2*le_base && y_trial<6*le_base
				if x_trial<x_start
					continue;
				elseif x_trial<x_notch_start
					if y_trial<y_start
						continue;
					elseif y_trial>y_end
						continue;
					end
				elseif x_trial<x_notch_end
					if y_trial<y_start
						continue;
					elseif y_trial>y_notch_tip
						continue;
					end
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial>y_end
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				
				ydirletter=CellInsertion(ydirletter,sp,[]);
				xdirletter=CellInsertion(xdirletter,sp,[]);
				zdirletter=CellInsertion(zdirletter,sp,[]);
				xydirletter=CellInsertion(xydirletter,sp,[]);
				yzdirletter=CellInsertion(yzdirletter,sp,[]);
				xzdirletter=CellInsertion(xzdirletter,sp,[]);
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				matmodel=VectorInsertion(matmodel,sp,2); %elastic (can be steel rubber or whatever)
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				plotignore=VectorInsertion(plotignore,sp,0);
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				orientationoffset=VectorInsertion(orientationoffset,sp,0);
				%{
				if y_trial<2*le_base+lp(2);
					yparticledamped=[yparticledamped sp];
				end
				%}
				%{
				if y_trial>4*le_base
					epsilonshrinkdotx_sp(sp,1)=-0.02;
					%epsilonshrinkdoty_sp(sp,1)=-0.01;
				else
					epsilonshrinkdotx_sp(sp,1)=0;
					%epsilonshrinkdoty_sp(sp,1)=0;
				end
				%}
				epsilonshrinkdot_sp=MatrixInsertion(epsilonshrinkdot_sp,sp,1,-0.02*(y_trial-y_start)/(y_end-y_start));
			end
		end
	elseif CasetoRun==73
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		x_end=23*le_base;
		y_start=2*le_base;
		y_end=10*le_base;
		x_notch_start=12*le_base;
		x_notch_end=13*le_base;
		y_notch_tip=8*le_base;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				%if x_trial>2*le_base && x_trial<8*le_base && y_trial>2*le_base && y_trial<6*le_base
				if x_trial<x_start
					continue;
				elseif x_trial<x_notch_start
					if y_trial<y_start
						continue;
					elseif y_trial>y_end
						continue;
					end
				elseif x_trial<x_notch_end
					if y_trial<y_start
						continue;
					elseif y_trial>y_notch_tip
						continue;
					end
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial>y_end
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl=VectorInsertion(thetacrackrtl,sp,NaN);
				xdirletter=CellInsertion(xdirletter,sp,'t');
				ydirletter=CellInsertion(ydirletter,sp,'r');
				zdirletter=CellInsertion(zdirletter,sp,'l');
				xydirletter=CellInsertion(xydirletter,sp,'tr');
				yzdirletter=CellInsertion(yzdirletter,sp,'rl');
				xzdirletter=CellInsertion(xzdirletter,sp,'tl');
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				matmodel=VectorInsertion(matmodel,sp,1); %wood_schmidt7
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				plotignore=VectorInsertion(plotignore,sp,0);
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				orientationoffset=VectorInsertion(orientationoffset,sp,0);
				%{
				if y_trial<2*le_base+lp(2);
					yparticledamped=[yparticledamped sp];
				end
				%}
				%{
				if y_trial>4*le_base
					epsilonshrinkdotx_sp(sp,1)=-0.02;
					%epsilonshrinkdoty_sp(sp,1)=-0.01;
				else
					epsilonshrinkdotx_sp(sp,1)=0;
					%epsilonshrinkdoty_sp(sp,1)=0;
				end
				%}
				epsilonshrinkdot_sp=MatrixInsertion(epsilonshrinkdot_sp,sp,1,-0.02*(y_trial-y_start)/(y_end-y_start));
			end
		end
	elseif CasetoRun==74
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		x_end=22*le_base;
		y_start=2*le_base;
		y_end=10*le_base;
		
		x_crack.npaths=1;
		x_crack.nparticles(1)=3;
		
		x_crack.center(1,1,1)=60;
		x_crack.center(1,2,1)=55;
		x_crack.center(2,1,1)=60;
		x_crack.center(2,2,1)=46;
		x_crack.center(3,1,1)=60;
		x_crack.center(3,2,1)=41;
		
		x_crack.top=x_crack.center;
		x_crack.bot=x_crack.center;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				%if x_trial>2*le_base && x_trial<8*le_base && y_trial>2*le_base && y_trial<6*le_base
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial>y_end
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl=VectorInsertion(thetacrackrtl,sp,NaN);
				xdirletter=CellInsertion(xdirletter,sp,'t');
				ydirletter=CellInsertion(ydirletter,sp,'r');
				zdirletter=CellInsertion(zdirletter,sp,'l');
				xydirletter=CellInsertion(xydirletter,sp,'tr');
				yzdirletter=CellInsertion(yzdirletter,sp,'rl');
				xzdirletter=CellInsertion(xzdirletter,sp,'tl');
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				matmodel=VectorInsertion(matmodel,sp,1); %wood_schmidt7
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				plotignore=VectorInsertion(plotignore,sp,0);
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				orientationoffset=VectorInsertion(orientationoffset,sp,0);
				%{
				if y_trial<2*le_base+lp(2);
					yparticledamped=[yparticledamped sp];
				end
				%}
				%{
				if y_trial>4*le_base
					epsilonshrinkdotx_sp(sp,1)=-0.02;
					%epsilonshrinkdoty_sp(sp,1)=-0.01;
				else
					epsilonshrinkdotx_sp(sp,1)=0;
					%epsilonshrinkdoty_sp(sp,1)=0;
				end
				%}
				epsilonshrinkdot_sp=MatrixInsertion(epsilonshrinkdot_sp,sp,1,-0.02*(y_trial-y_start)/(y_end-y_start));
			end
		end
	elseif CasetoRun==78 || CasetoRun==81 || CasetoRun==82
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		x_end=22*le_base;
		y_start=2*le_base;
		y_end=10*le_base;
		
		x_crack.npaths=1;
		x_crack.nparticles(1)=3;
		
		x_crack.center(1,1,1)=60;
		x_crack.center(1,2,1)=55;
		x_crack.center(2,1,1)=60;
		x_crack.center(2,2,1)=46;
		x_crack.center(3,1,1)=60;
		x_crack.center(3,2,1)=41;
		
		x_crack.top=x_crack.center;
		x_crack.bot=x_crack.center;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				%if x_trial>2*le_base && x_trial<8*le_base && y_trial>2*le_base && y_trial<6*le_base
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial>y_end
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl=VectorInsertion(thetacrackrtl,sp,NaN);
				xdirletter=CellInsertion(xdirletter,sp,'t');
				ydirletter=CellInsertion(ydirletter,sp,'r');
				zdirletter=CellInsertion(zdirletter,sp,'l');
				xydirletter=CellInsertion(xydirletter,sp,'tr');
				yzdirletter=CellInsertion(yzdirletter,sp,'rl');
				xzdirletter=CellInsertion(xzdirletter,sp,'tl');
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				if y_trial<4*le_base
					matmodel=VectorInsertion(matmodel,sp,2); %steel
					orientationoffset=VectorInsertion(orientationoffset,sp,NaN);
				else
					matmodel=VectorInsertion(matmodel,sp,1); %wood_schmidt7
					orientationoffset=VectorInsertion(orientationoffset,sp,0);
				end
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				plotignore=VectorInsertion(plotignore,sp,0);
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				%{
				if y_trial<2*le_base+lp(2);
					yparticledamped=[yparticledamped sp];
				end
				%}
				%{
				if y_trial>4*le_base
					epsilonshrinkdotx_sp(sp,1)=-0.02;
					%epsilonshrinkdoty_sp(sp,1)=-0.01;
				else
					epsilonshrinkdotx_sp(sp,1)=0;
					%epsilonshrinkdoty_sp(sp,1)=0;
				end
				%}
				epsilonshrinkdot_sp=MatrixInsertion(epsilonshrinkdot_sp,sp,1,-0.02*(y_trial-y_start)/(y_end-y_start));
			end
		end
	elseif CasetoRun==83
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		x_end=22*le_base;
		y_start=2*le_base;
		y_end=10*le_base;
		
		x_crack.npaths=2;
		x_crack.nparticles(1)=3;
		x_crack.nparticles(2)=3;
		
		x_crack.center(1,1,1)=40;
		x_crack.center(1,2,1)=55;
		x_crack.center(2,1,1)=40;
		x_crack.center(2,2,1)=46;
		x_crack.center(3,1,1)=40;
		x_crack.center(3,2,1)=41;
		
		x_crack.center(1,1,2)=80;
		x_crack.center(1,2,2)=55;
		x_crack.center(2,1,2)=80;
		x_crack.center(2,2,2)=46;
		x_crack.center(3,1,2)=80;
		x_crack.center(3,2,2)=41;
		
		
		x_crack.top=x_crack.center;
		x_crack.bot=x_crack.center;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				%if x_trial>2*le_base && x_trial<8*le_base && y_trial>2*le_base && y_trial<6*le_base
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial>y_end
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl=VectorInsertion(thetacrackrtl,sp,NaN);
				xdirletter=CellInsertion(xdirletter,sp,'t');
				ydirletter=CellInsertion(ydirletter,sp,'r');
				zdirletter=CellInsertion(zdirletter,sp,'l');
				xydirletter=CellInsertion(xydirletter,sp,'tr');
				yzdirletter=CellInsertion(yzdirletter,sp,'rl');
				xzdirletter=CellInsertion(xzdirletter,sp,'tl');
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				if y_trial<4*le_base
					matmodel=VectorInsertion(matmodel,sp,2); %steel
					orientationoffset=VectorInsertion(orientationoffset,sp,NaN);
				else
					matmodel=VectorInsertion(matmodel,sp,1); %wood_schmidt7
					orientationoffset=VectorInsertion(orientationoffset,sp,0);
				end
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				plotignore=VectorInsertion(plotignore,sp,0);
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				%{
				if y_trial<2*le_base+lp(2);
					yparticledamped=[yparticledamped sp];
				end
				%}
				%{
				if y_trial>4*le_base
					epsilonshrinkdotx_sp(sp,1)=-0.02;
					%epsilonshrinkdoty_sp(sp,1)=-0.01;
				else
					epsilonshrinkdotx_sp(sp,1)=0;
					%epsilonshrinkdoty_sp(sp,1)=0;
				end
				%}
				epsilonshrinkdot_sp=MatrixInsertion(epsilonshrinkdot_sp,sp,1,-0.02*(y_trial-y_start)/(y_end-y_start));
			end
		end
	elseif CasetoRun==84
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		x_end=22*le_base;
		y_start=2*le_base;
		y_end=10*le_base;
		
		x_crack.npaths=2;
		x_crack.nparticles(1:2)=4;
		
		x_crack.center(1,1,1)=60;
		x_crack.center(1,2,1)=62.5;
		x_crack.center(2,1,1)=60;
		x_crack.center(2,2,1)=40;
		x_crack.center(3,1,1)=60;
		x_crack.center(3,2,1)=20;
		x_crack.center(4,1,1)=60;
		x_crack.center(4,2,1)=2.5;
		
		x_crack.center(1,1,2)=2.5;
		x_crack.center(1,2,2)=30;
		x_crack.center(2,1,2)=50;
		x_crack.center(2,2,2)=30;
		x_crack.center(3,1,2)=70;
		x_crack.center(3,2,2)=30;
		x_crack.center(4,1,2)=122.5;
		x_crack.center(4,2,2)=30;

		x_crack.top=x_crack.center;
		x_crack.bot=x_crack.center;
		
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				%if x_trial>2*le_base && x_trial<8*le_base && y_trial>2*le_base && y_trial<6*le_base
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial>y_end
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl=VectorInsertion(thetacrackrtl,sp,NaN);
				xdirletter=CellInsertion(xdirletter,sp,'t');
				ydirletter=CellInsertion(ydirletter,sp,'r');
				zdirletter=CellInsertion(zdirletter,sp,'l');
				xydirletter=CellInsertion(xydirletter,sp,'tr');
				yzdirletter=CellInsertion(yzdirletter,sp,'rl');
				xzdirletter=CellInsertion(xzdirletter,sp,'tl');
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				%if y_trial<4*le_base
					matmodel=VectorInsertion(matmodel,sp,2); %steel
					orientationoffset=VectorInsertion(orientationoffset,sp,NaN);
				%else
				%	matmodel(sp)=1; %wood_schmidt7
				%	orientationoffset(sp)=0;
				%end
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				plotignore=VectorInsertion(plotignore,sp,0);
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				%{
				if y_trial<2*le_base+lp(2);
					yparticledamped=[yparticledamped sp];
				end
				%}
				%{
				if y_trial>4*le_base
					epsilonshrinkdotx_sp(sp,1)=-0.02;
					%epsilonshrinkdoty_sp(sp,1)=-0.01;
				else
					epsilonshrinkdotx_sp(sp,1)=0;
					%epsilonshrinkdoty_sp(sp,1)=0;
				end
				%}
				%epsilonshrinkdot_sp(sp,1)=-0.02*(y_trial-y_start)/(y_end-y_start);
			end
		end
	elseif CasetoRun==88 || CasetoRun==98 || CasetoRun==96
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		x_end=22*le_base;
		y_start=2*le_base;
		y_end=10*le_base;
		
		x_crack.npaths=2;
		x_crack.nparticles(1)=0;
		x_crack.nparticles(2)=0;
		%sizes are all messed up, correct before use please
		if CasetoRun==88
			x_crack.center(:,2,1)=transpose(57.5:-pi:40);
			x_crack.nparticles(1)=length(x_crack.venter(:,2,1));
			x_crack.center(1:x_crack.nparticles(1),1,1)=80;
		
			x_crack.center(:,:,2)=x_crack.center(:,:,1);
			x_crack.center(:,1,2)=40;
			x_crack.nparticles(1)=length(x_crack.center(:,2,2));
		elseif CasetoRun==98
			x_crack.center(:,2,1)=transpose(57.5:-pi:35);
			x_crack.nparticles(1)=length(x_crack.center(:,2,1));
			x_crack.center(1:x_crack.nparticles(1),1,1)=80;
			
			x_crack.center(:,2,2)=transpose(57.5:-pi:40);
			x_crack.center(:,1,2)=40;
			x_crack.nparticles(1)=length(x_crack.center(:,2,2));
		elseif CasetoRun==96
			x_crack.center(:,2,1)=transpose(57.5:-pi:35);
			branchingpoint=size(x_crack.center(:,:,1),1);
			x_crack.center(branchingpoint,2,1)=35;
			x_crack.center(:,1,1)=60;
			movingindex=0;
			for y_crack_trial=x_crack.center(branchingpoint,2,1)-pi:-pi:20
				movingindex=movingindex+1;
				x_crack.center(branchingpoint+movingindex,2,1)=y_crack_trial;
				x_crack.center(branchingpoint+movingindex,1,1)=60+pi/2*movingindex;
			end
			x_crack.nparticles(1)=size(x_crack.center,1);
			x_crack.nparticles(2)=x_crack.nparticles(1)-branchingpoint+1;
			x_crack.center(:,:,2)=x_crack.center(branchingpoint:size(x_crack{1},1),:,1);
			x_crack.center(:,1,2)=60-(x_crack(:,1,2)-60);
		end
		%{
		x_crack{1}(1,1)=80;
		x_crack{1}(1,2)=55;
		x_crack{1}(2,1)=80;
		x_crack{1}(2,2)=46;
		x_crack{1}(3,1)=80;
		x_crack{1}(3,2)=41;

		x_crack{2}(1,1)=40;
		x_crack{2}(1,2)=55;
		x_crack{2}(2,1)=40;
		x_crack{2}(2,2)=46;
		x_crack{2}(3,1)=40;
		x_crack{2}(3,2)=41;
		%}
		x_cracktop=x_crack;
		x_crackbot=x_crack;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				%if x_trial>2*le_base && x_trial<8*le_base && y_trial>2*le_base && y_trial<6*le_base
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial>y_end
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl=VectorInsertion(thetacrackrtl,sp,NaN);
				xdirletter=CellInsertion(xdirletter,sp,'t');
				ydirletter=CellInsertion(ydirletter,sp,'r');
				zdirletter=CellInsertion(zdirletter,sp,'l');
				xydirletter=CellInsertion(xydirletter,sp,'tr');
				yzdirletter=CellInsertion(yzdirletter,sp,'rl');
				xzdirletter=CellInsertion(xzdirletter,sp,'tl');
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				if y_trial<4*le_base
					matmodel=VectorInsertion(matmodel,sp,2); %steel
					orientationoffset=VectorInsertion(orientationoffset,sp,NaN);
				else
					if CasetoRun==98
						matmodel=VectorInsertion(matmodel,sp,1); %wood_schmidt7
						orientationoffset=VectorInsertion(orientationoffset,sp,0);
					else
						matmodel=VectorInsertion(matmodel,sp,2); %steel
						orientationoffset=VectorInsertion(orientationoffset,sp,NaN); %steel-steel for now
					end
				end
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				plotignore=VectorInsertion(plotignore,sp,0);
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				%{
				if y_trial<2*le_base+lp(2);
					yparticledamped=[yparticledamped sp];
				end
				%}
				%{
				if y_trial>4*le_base
					epsilonshrinkdotx_sp(sp,1)=-0.02;
					%epsilonshrinkdoty_sp(sp,1)=-0.01;
				else
					epsilonshrinkdotx_sp(sp,1)=0;
					%epsilonshrinkdoty_sp(sp,1)=0;
				end
				%}
				epsilonshrinkdot_sp=MatrixInsertion(epsilonshrinkdot_sp,sp,1,-0.02*(y_trial-y_start)/(y_end-y_start));
			end
		end
	elseif CasetoRun==100 || CasetoRun==101 || CasetoRun==105
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		x_end=22*le_base;
		y_start=2*le_base;
		y_end=10*le_base;
		
		x_crack.npaths=1;
		x_crack.nparticles(1:1)=3;
		
		x_crack.center(1,1,1)=60;
		x_crack.center(1,2,1)=55;
		x_crack.center(2,1,1)=60;
		x_crack.center(2,2,1)=46;
		x_crack.center(3,1,1)=60;
		x_crack.center(3,2,1)=41;

		x_crack.top=x_crack.center;
		x_crack.bot=x_crack.center;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				%if x_trial>2*le_base && x_trial<8*le_base && y_trial>2*le_base && y_trial<6*le_base
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial>y_end
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl=VectorInsertion(thetacrackrtl,sp,NaN);
				xdirletter=CellInsertion(xdirletter,sp,'t');
				ydirletter=CellInsertion(ydirletter,sp,'r');
				zdirletter=CellInsertion(zdirletter,sp,'l');
				xydirletter=CellInsertion(xydirletter,sp,'tr');
				yzdirletter=CellInsertion(yzdirletter,sp,'rl');
				xzdirletter=CellInsertion(xzdirletter,sp,'tl');
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				if y_trial<4*le_base
					matmodel=VectorInsertion(matmodel,sp,2); %steel
					orientationoffset=VectorInsertion(orientationoffset,sp,NaN);
				else
					matmodel=VectorInsertion(matmodel,sp,1); %wood_schmidt7
					orientationoffset=VectorInsertion(orientationoffset,sp,0);
				end
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				plotignore=VectorInsertion(plotignore,sp,0);
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				%{
				if y_trial<2*le_base+lp(2);
					yparticledamped=[yparticledamped sp];
				end
				%}
				%{
				if y_trial>4*le_base
					epsilonshrinkdotx_sp(sp,1)=-0.02;
					%epsilonshrinkdoty_sp(sp,1)=-0.01;
				else
					epsilonshrinkdotx_sp(sp,1)=0;
					%epsilonshrinkdoty_sp(sp,1)=0;
				end
				%}
				epsilonshrinkdot_sp=MatrixInsertion(epsilonshrinkdot_sp,sp,1,-0.02*(y_trial-y_start)/(y_end-y_start));
			end
		end	
	elseif CasetoRun==109
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		x_end=22*le_base;
		y_start=2*le_base;
		y_end=10*le_base;
		
		x_crack.npaths=1;
		x_crack.nparticles(1:1)=3;
		
		x_crack.center(1,1,1)=60;
		x_crack.center(1,2,1)=55;
		x_crack.center(2,1,1)=60;
		x_crack.center(2,2,1)=46;
		x_crack.center(3,1,1)=60;
		x_crack.center(3,2,1)=41;
		
		x_crack.top=x_crack.center;
		x_crack.bot=x_crack.center;
		
		x_cracktop=x_crack;
		x_crackbot=x_crack;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				%if x_trial>2*le_base && x_trial<8*le_base && y_trial>2*le_base && y_trial<6*le_base
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial>y_end
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl=VectorInsertion(thetacrackrtl,sp,NaN);
				xdirletter=CellInsertion(xdirletter,sp,'r');
				ydirletter=CellInsertion(ydirletter,sp,'t');
				zdirletter=CellInsertion(zdirletter,sp,'l');
				xydirletter=CellInsertion(xydirletter,sp,'rt');
				yzdirletter=CellInsertion(yzdirletter,sp,'tl');
				xzdirletter=CellInsertion(xzdirletter,sp,'rl');
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				if y_trial<4*le_base
					matmodel=VectorInsertion(matmodel,sp,2); %steel
					orientationoffset=VectorInsertion(orientationoffset,sp,NaN);
				else
					matmodel=VectorInsertion(matmodel,sp,1); %wood_schmidt7
					orientationoffset=VectorInsertion(orientationoffset,sp,pi/2);
				end
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				plotignore=VectorInsertion(plotignore,sp,0);
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				%{
				if y_trial<2*le_base+lp(2);
					yparticledamped=[yparticledamped sp];
				end
				%}
				%{
				if y_trial>4*le_base
					epsilonshrinkdotx_sp(sp,1)=-0.02;
					%epsilonshrinkdoty_sp(sp,1)=-0.01;
				else
					epsilonshrinkdotx_sp(sp,1)=0;
					%epsilonshrinkdoty_sp(sp,1)=0;
				end
				%}
				epsilonshrinkdot_sp=MatrixInsertion(epsilonshrinkdot_sp,sp,1,-0.02*(y_trial-y_start)/(y_end-y_start));
			end
		end	
	elseif CasetoRun==102
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		x_end=22*le_base;
		y_start=2*le_base;
		y_end=10*le_base;
		
		x_crack.npaths=3;
		x_crack.nparticles(1:3)=3;
		
		x_crack.center(1,1,1)=40;
		x_crack.center(1,2,1)=55;
		x_crack.center(2,1,1)=40;
		x_crack.center(2,2,1)=46;
		x_crack.center(3,1,1)=40;
		x_crack.center(3,2,1)=41;
		
		x_crack.center(1,1,2)=60;
		x_crack.center(1,2,2)=55;
		x_crack.center(2,1,2)=60;
		x_crack.center(2,2,2)=46;
		x_crack.center(3,1,2)=60;
		x_crack.center(3,2,2)=41;
		
		x_crack.center(1,1,3)=70;
		x_crack.center(1,2,3)=55;
		x_crack.center(2,1,3)=70;
		x_crack.center(2,2,3)=46;
		x_crack.center(3,1,3)=70;
		
		x_crack.top=x_crack.center;
		x_crack.bot=x_crack.center;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				%if x_trial>2*le_base && x_trial<8*le_base && y_trial>2*le_base && y_trial<6*le_base
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial>y_end
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl=VectorInsertion(thetacrackrtl,sp,NaN);
				xdirletter=CellInsertion(xdirletter,sp,'t');
				ydirletter=CellInsertion(ydirletter,sp,'r');
				zdirletter=CellInsertion(zdirletter,sp,'l');
				xydirletter=CellInsertion(xydirletter,sp,'tr');
				yzdirletter=CellInsertion(yzdirletter,sp,'rl');
				xzdirletter=CellInsertion(xzdirletter,sp,'tl');
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				if y_trial<4*le_base
					matmodel=VectorInsertion(matmodel,sp,2); %steel
					orientationoffset=VectorInsertion(orientationoffset,sp,NaN);
				else
					matmodel=VectorInsertion(matmodel,sp,1); %wood_schmidt7
					orientationoffset=VectorInsertion(orientationoffset,sp,0);
				end
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				plotignore=VectorInsertion(plotignore,sp,0);
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				%{
				if y_trial<2*le_base+lp(2);
					yparticledamped=[yparticledamped sp];
				end
				%}
				%{
				if y_trial>4*le_base
					epsilonshrinkdotx_sp(sp,1)=-0.02;
					%epsilonshrinkdoty_sp(sp,1)=-0.01;
				else
					epsilonshrinkdotx_sp(sp,1)=0;
					%epsilonshrinkdoty_sp(sp,1)=0;
				end
				%}
				epsilonshrinkdot_sp=MatrixInsertion(epsilonshrinkdot_sp,sp,1,-0.02*(y_trial-y_start)/(y_end-y_start));
			end
		end	
	elseif CasetoRun==106
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		x_end=22*le_base;
		y_start=2*le_base;
		y_end=10*le_base;
		
		x_crack{1}(:,2)=transpose(57.5:-pi:35);
		x_crack{1}(:,1)=80;

		x_crack{2}(:,2)=transpose(57.5:-pi:40);
		x_crack{2}(:,1)=40;
		
		x_cracktop=x_crack;
		x_crackbot=x_crack;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				%if x_trial>2*le_base && x_trial<8*le_base && y_trial>2*le_base && y_trial<6*le_base
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial>y_end
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl=VectorInsertion(thetacrackrtl,sp,NaN);
				xdirletter=CellInsertion(xdirletter,sp,'t');
				ydirletter=CellInsertion(ydirletter,sp,'r');
				zdirletter=CellInsertion(zdirletter,sp,'l');
				xydirletter=CellInsertion(xydirletter,sp,'tr');
				yzdirletter=CellInsertion(yzdirletter,sp,'rl');
				xzdirletter=CellInsertion(xzdirletter,sp,'tl');
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				if y_trial<4*le_base
					matmodel=VectorInsertion(matmodel,sp,2); %steel
					orientationoffset=VectorInsertion(orientationoffset,sp,NaN);
				else
					matmodel=VectorInsertion(matmodel,sp,1); %wood_schmidt7
					orientationoffset=VectorInsertion(orientationoffset,sp,0);
				end
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				plotignore=VectorInsertion(plotignore,sp,0);
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				%{
				if y_trial<2*le_base+lp(2);
					yparticledamped=[yparticledamped sp];
				end
				%}
				%{
				if y_trial>4*le_base
					epsilonshrinkdotx_sp(sp,1)=-0.02;
					%epsilonshrinkdoty_sp(sp,1)=-0.01;
				else
					epsilonshrinkdotx_sp(sp,1)=0;
					%epsilonshrinkdoty_sp(sp,1)=0;
				end
				%}
				epsilonshrinkdot_sp=MatrixInsertion(epsilonshrinkdot_sp,sp,1,-0.02*(y_trial-y_start)/(y_end-y_start));
			end
		end	
	elseif CasetoRun==107
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		x_end=22*le_base;
		y_start=2*le_base;
		y_end=10*le_base;
		
		x_crack{1}(:,2)=transpose(57.5:-pi:40);
		x_crack{1}(:,1)=80;

		x_crack{2}(:,2)=transpose(57.5:-pi:40);
		x_crack{2}(:,1)=40;
		
		x_cracktop=x_crack;
		x_crackbot=x_crack;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				%if x_trial>2*le_base && x_trial<8*le_base && y_trial>2*le_base && y_trial<6*le_base
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial>y_end
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl=VectorInsertion(thetacrackrtl,sp,NaN);
				xdirletter=CellInsertion(xdirletter,sp,'t');
				ydirletter=CellInsertion(ydirletter,sp,'r');
				zdirletter=CellInsertion(zdirletter,sp,'l');
				xydirletter=CellInsertion(xydirletter,sp,'tr');
				yzdirletter=CellInsertion(yzdirletter,sp,'rl');
				xzdirletter=CellInsertion(xzdirletter,sp,'tl');
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				if y_trial<4*le_base
					matmodel=VectorInsertion(matmodel,sp,2); %steel
					orientationoffset=VectorInsertion(orientationoffset,sp,NaN);
				else
					matmodel=VectorInsertion(matmodel,sp,1); %wood_schmidt7
					orientationoffset=VectorInsertion(orientationoffset,sp,0);
				end
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				plotignore=VectorInsertion(plotignore,sp,0);
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				%{
				if y_trial<2*le_base+lp(2);
					yparticledamped=[yparticledamped sp];
				end
				%}
				%{
				if y_trial>4*le_base
					epsilonshrinkdotx_sp(sp,1)=-0.02;
					%epsilonshrinkdoty_sp(sp,1)=-0.01;
				else
					epsilonshrinkdotx_sp(sp,1)=0;
					%epsilonshrinkdoty_sp(sp,1)=0;
				end
				%}
				epsilonshrinkdot_sp=MatrixInsertion(epsilonshrinkdot_sp,sp,1,-0.02*(y_trial-y_start)/(y_end-y_start));
			end
		end	
	elseif CasetoRun==103
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		x_end=22*le_base;
		y_start=2*le_base;
		y_end=10*le_base;
		
		x_crack.npaths=1;
		x_crack.nparticles(1:1)=2;
		
		x_crack.center(1,1,1)=60;
		x_crack.center(1,2,1)=41;
		x_crack.center(2,1,1)=60;
		x_crack.center(2,2,1)=36;
		
		x_crack.top=x_crack.center;
		x_crack.bot=x_crack.center;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				%if x_trial>2*le_base && x_trial<8*le_base && y_trial>2*le_base && y_trial<6*le_base
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial>y_end
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl=VectorInsertion(thetacrackrtl,sp,NaN);
				xdirletter=CellInsertion(xdirletter,sp,'t');
				ydirletter=CellInsertion(ydirletter,sp,'r');
				zdirletter=CellInsertion(zdirletter,sp,'l');
				xydirletter=CellInsertion(xydirletter,sp,'tr');
				yzdirletter=CellInsertion(yzdirletter,sp,'rl');
				xzdirletter=CellInsertion(xzdirletter,sp,'tl');
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				if y_trial<4*le_base
					matmodel=VectorInsertion(matmodel,sp,2); %steel
					orientationoffset=VectorInsertion(orientationoffset,sp,NaN);
				else
					matmodel=VectorInsertion(matmodel,sp,1); %wood_schmidt7
					orientationoffset=VectorInsertion(orientationoffset,sp,0);
				end
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				plotignore=VectorInsertion(plotignore,sp,0);
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				%{
				if y_trial<2*le_base+lp(2);
					yparticledamped=[yparticledamped sp];
				end
				%}
				%{
				if y_trial>4*le_base
					epsilonshrinkdotx_sp(sp,1)=-0.02;
					%epsilonshrinkdoty_sp(sp,1)=-0.01;
				else
					epsilonshrinkdotx_sp(sp,1)=0;
					%epsilonshrinkdoty_sp(sp,1)=0;
				end
				%}
				epsilonshrinkdot_sp=MatrixInsertion(epsilonshrinkdot_sp,sp,1,-0.02*(y_trial-y_start)/(y_end-y_start));
			end
		end	
	elseif CasetoRun==104 || CasetoRun==114
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		x_end=22*le_base;
		y_start=2*le_base;
		y_end=10*le_base;
		
		x_crack.npaths=1;
		x_crack.nparticles(1:1)=2;
		
		x_crack.center(1,1,1)=1;
		x_crack.center(1,2,1)=1;
		x_crack.center(2,1,1)=1;
		x_crack.center(2,2,1)=2;
		
		x_crack.top=x_crack.center;
		x_crack.bot=x_crack.center;

		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				%if x_trial>2*le_base && x_trial<8*le_base && y_trial>2*le_base && y_trial<6*le_base
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial>y_end
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl=VectorInsertion(thetacrackrtl,sp,NaN);
				xdirletter=CellInsertion(xdirletter,sp,'t');
				ydirletter=CellInsertion(ydirletter,sp,'r');
				zdirletter=CellInsertion(zdirletter,sp,'l');
				xydirletter=CellInsertion(xydirletter,sp,'tr');
				yzdirletter=CellInsertion(yzdirletter,sp,'rl');
				xzdirletter=CellInsertion(xzdirletter,sp,'tl');
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				if y_trial<4*le_base
					matmodel=VectorInsertion(matmodel,sp,2); %steel
					orientationoffset=VectorInsertion(orientationoffset,sp,NaN);
				else
					matmodel=VectorInsertion(matmodel,sp,1); %wood_schmidt7
					orientationoffset=VectorInsertion(orientationoffset,sp,0);
				end
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				plotignore=VectorInsertion(plotignore,sp,0);
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				%{
				if y_trial<2*le_base+lp(2);
					yparticledamped=[yparticledamped sp];
				end
				%}
				%{
				if y_trial>4*le_base
					epsilonshrinkdotx_sp(sp,1)=-0.02;
					%epsilonshrinkdoty_sp(sp,1)=-0.01;
				else
					epsilonshrinkdotx_sp(sp,1)=0;
					%epsilonshrinkdoty_sp(sp,1)=0;
				end
				%}
				epsilonshrinkdot_sp=MatrixInsertion(epsilonshrinkdot_sp,sp,1,-0.02*(y_trial-y_start)/(y_end-y_start));
			end
		end	
	elseif CasetoRun==108 || CasetoRun==110
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		x_end=22*le_base;
		y_start=2*le_base;
		y_end=10*le_base;
		
		x_crack.center(1,1,1)=1;
		x_crack.center(1,2,1)=1;
		x_crack.center(2,1,1)=1;
		x_crack.center(2,2,1)=2;
		
		x_crack.top=x_crack.center;
		x_crack.bot=x_crack.center;
		
		weakeningfactorcounter=0;
		weakeningfactorlist=[0.00288151222434182 0.00766816007402974 0.00819039114023511 0.00206492725892124 0.00550087229560278 0.00886610423295293 0.00271950803658363 0.00443702800163524 0.00941825156270763 0.00894423010348648 0.00571706432219782 0.00452053528811982 0.00167950736922723 0.00658014158621619 0.00846529684305844 0.00872439936759172 0.00846977684943388 0.00415260028628463 0.00502644146389766 0.00484150020418957 0.00187037971504438 0.00985947663837137 0.00289289872951303 0.000362044440089581 0.00303547310853137 0.00887375733748427 0.00192453208682581 0.00964888027067501 0.00791975845733582 0.00154541079076149 0.00529942189752767 0.00933693229143841 0.00978590745016202 0.00130750919289898 0.00686437069493387 0.00714991523231083 0.00103735466840257 0.00858819451675231 0.0079271329202272 0.00541936047566576 0.00652560397777236 0.00562448490332467 0.00330743732616964 0.00313379933617871 0.00709201739693978 0.00299051922312481 0.00932478809593775 0.00748362337780803 0.00531391396137042 0.0016958372338974 0.00517668132633026 0.00247342262797549 0.00699004862424677 0.00902714773653955 0.00944425392442729 0.00610135553603108 0.00182221157448127 0.000606461848265278 0.0019302177937423 0.00965688752409669 0.00346658832860904 0.00706319537603954 0.00963911544608514 0.00336156933121046 0.0099069389540077 0.00674555349925084 0.00338014016027076 0.00243160971239059 0.00919480902754352 0.00875235227644536 0.00999743954283944 0.00255743988087225 0.00803813897931835 0.00279163058646554 0.00402384241996415 0.00347113995562023 0.00447186258577744 0.00718688421503438 3.01039226423994E-06 0.0050185688529129 0.000711319832713989 0.00180146420933763 0.00651523374606015 0.00210395840673967 0.00525048438044075 0.00048255185000101 0.00306716274538377 0.00188922913948279 0.00968808365423962 0.00752112575444415 0.00341613831273792 0.00309143545727035 0.0033406072131505 0.00021153188192593 0.00133175354519212 0.00871365100470319 0.00672474092194059 0.000673813327952691 0.00764332327817865 0.00329429518638246 0.00270424341584231 0.00941066602601188 0.00286175394485562 0.00521835858259539 0.00469851201649738 0.00877488596244973 0.00905124423794886 0.00503536836177755 0.0097766299530509 0.00413010208800381 0.00531853354924132 0.00736649928139957 0.00931143033300578 0.000616355263154424 0.00233193456956093 0.00247148996314264 0.000671375154289947 0.00385162013296107 0.00545482773350906 0.00359362966897553 0.00243661178553081 0.00817887378453148 0.000299151843915149 0.00898913157279223 0.00921857812156791 0.00711994953969055 0.00660048033836392 0.008599383303583 0.00279165860375161 0.00736841621438943 0.00998526708330981 0.0015826881720091 0.00628321513135645 0.00120051164320441 0.00967202738175216 0.005817414523798 0.00494438807082617 0.00437688013412547 0.00597462802208307 0.0064215168162815 0.00415520487631298 0.00528947537216599 0.00951926264586612 0.0022295267628736 0.000113061800611495 0.00662590908224851 0.00748900887229356 0.00521380434083576 0.00787829770455287 0.00132112758696115 0.00499031109142165 0.00832729030759734];

		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				%if x_trial>2*le_base && x_trial<8*le_base && y_trial>2*le_base && y_trial<6*le_base
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial>y_end
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl=VectorInsertion(thetacrackrtl,sp,NaN);
				xdirletter=CellInsertion(xdirletter,sp,'t');
				ydirletter=CellInsertion(ydirletter,sp,'r');
				zdirletter=CellInsertion(zdirletter,sp,'l');
				xydirletter=CellInsertion(xydirletter,sp,'tr');
				yzdirletter=CellInsertion(yzdirletter,sp,'rl');
				xzdirletter=CellInsertion(xzdirletter,sp,'tl');
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				if y_trial<4*le_base
					matmodel=VectorInsertion(matmodel,sp,2); %steel
					orientationoffset=VectorInsertion(orientationoffset,sp,NaN);
				else
					matmodel=VectorInsertion(matmodel,sp,1); %wood_schmidt7
					orientationoffset=VectorInsertion(orientationoffset,sp,0);
				end
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				plotignore=VectorInsertion(plotignore,sp,0);
				if y_trial>10*le_base-lp(2);
					weakeningfactorcounter=weakeningfactorcounter+1;
					weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,weakeningfactorlist(weakeningfactorcounter));
				else
					weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				end
				epsilonshrinkdot_sp=MatrixInsertion(epsilonshrinkdot_sp,sp,1,-0.02*(y_trial-y_start)/(y_end-y_start));
			end
		end
	elseif CasetoRun==111 || CasetoRun==113
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=3.5*le_base;
		x_mid=8.5*le_base;
		x_end=16*le_base;
		y_start=4*le_base;
		y_mid1=9*le_base;
		y_mid2=11*le_base;
		y_end=16*le_base;
		steelcirclecenter=[6 7;
							6 13]*le_base;
		steelcircleradius=[1;1]*le_base;
		ncircle=size(steelcirclecenter,2);
		
		x_crack{1}=[7 10;
					11 10]*le_base;
		
		x_cracktop=x_crack;
		x_crackbot=x_crack;
		
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				if x_trial<x_start
					continue;
				elseif x_trial<x_mid
					if y_trial<y_start
						continue;
					elseif y_trial<y_mid1
					elseif y_trial<y_mid2
						continue;
					elseif y_trial<y_end
					else
						continue;
					end
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial<y_end
					else
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl=VectorInsertion(thetacrackrtl,sp,NaN);
				xdirletter=CellInsertion(xdirletter,sp,'t');
				ydirletter=CellInsertion(ydirletter,sp,'r');
				zdirletter=CellInsertion(zdirletter,sp,'l');
				xydirletter=CellInsertion(xydirletter,sp,'tr');
				yzdirletter=CellInsertion(yzdirletter,sp,'rl');
				xzdirletter=CellInsertion(xzdirletter,sp,'tl');
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				insidecircle=0;
				for icircle=1:ncircle
					if sqrt((x_trial-steelcirclecenter(icircle,1))^2+(y_trial-steelcirclecenter(icircle,2))^2)<steelcircleradius(icircle);
						insidecircle=1;
						break;
					end
				end
				if insidecircle
					matmodel=VectorInsertion(matmodel,sp,2); %steel
					orientationoffset=VectorInsertion(orientationoffset,sp,NaN);
					plotignore=VectorInsertion(plotignore,sp,1);
				else
					matmodel=VectorInsertion(matmodel,sp,1); %wood_schmidt7
					orientationoffset=VectorInsertion(orientationoffset,sp,0);
					plotignore=VectorInsertion(plotignore,sp,0);
				end
				if x_trial<6*le_base && x_trial>(6*le_base-lp(1)) && y_trial>13*le_base && y_trial<13*le_base+lp(2);
					ParticleswithPredYVel=VectorInsertion(ParticleswithPredYVel,1,sp);
				end
				if x_trial<6*le_base && x_trial>(6*le_base-lp(1)) && y_trial<7*le_base && y_trial>7*le_base-lp(2);
					ParticleswithPredYVel=VectorInsertion(ParticleswithPredYVel,2,sp);
				end
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
			end
		end
	elseif CasetoRun==115
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		x_end=5*le_base;
		y_start=2*le_base;
		y_end=5*le_base;
		
		x_crack{1}=[0.5 3.5;
					3.5-pi*1e-5 3.5]*le_base;
		x_defaultcracktip=[3.5 3.5]*le_base;
		
		x_cracktop=x_crack;
		x_crackbot=x_crack;
		
		steelstrength=5; %MPa
		
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial<y_end
					else
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl=VectorInsertion(thetacrackrtl,sp,NaN);
				xdirletter=CellInsertion(xdirletter,sp,'t');
				ydirletter=CellInsertion(ydirletter,sp,'r');
				zdirletter=CellInsertion(zdirletter,sp,'l');
				xydirletter=CellInsertion(xydirletter,sp,'tr');
				yzdirletter=CellInsertion(yzdirletter,sp,'rl');
				xzdirletter=CellInsertion(xzdirletter,sp,'tl');
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				matmodel=VectorInsertion(matmodel,sp,2); %steel
				orientationoffset=VectorInsertion(orientationoffset,sp,NaN);
				plotignore=VectorInsertion(plotignore,sp,0);
				
				if x_trial>5*le_base-lp(1)
					if y_trial>5*le_base-lp(2)
						tractionedcorner=VectorInsertion(tractionedcorner,length(tractionedcorner)+1,sp);
						normalcorner{length(tractionedcorner)}=[1 0;
																0 1];
					elseif y_trial<2*le_base+lp(2)
						tractionedcorner=VectorInsertion(tractionedcorner,length(tractionedcorner)+1,sp);
						normalcorner{length(tractionedcorner)}=[1 0;
																0 -1];
					else
						tractionededge=VectorInsertion(tractionededge,length(tractionededge)+1,sp);
						normaledge=VectorInsertion(normaledge,length(tractionededge),1,1);
						normaledge=VectorInsertion(normaledge,length(tractionededge),2,0);
						
					end
				elseif y_trial>5*le_base-lp(2)
					tractionededge=VectorInsertion(tractionededge,length(tractionededge)+1,sp);
					normaledge=MatrixInsertion(normaledge,length(tractionededge),1,0);
					normaledge=MatrixInsertion(normaledge,length(tractionededge),2,1);
				elseif y_trial<2*le_base+lp(2)
					tractionededge=VectorInsertion(tractionededge,length(tractionededge)+1,sp);
					normaledge=MatrixInsertion(normaledge,length(tractionededge),1,0);
					normaledge=MatrixInsertion(normaledge,length(tractionededge),2,-1);
				end
				
				%if x_trial<6*le_base && x_trial>(6*le_base-lp(1)) && y_trial>13*le_base && y_trial<13*le_base+lp(2);
				%	ParticleswithPredYVel(1)=sp;
				%end
				%if x_trial<6*le_base && x_trial>(6*le_base-lp(1)) && y_trial<7*le_base && y_trial>7*le_base-lp(2);
				%	ParticleswithPredYVel(2)=sp;
				%end
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
			end
		end
	elseif CasetoRun==116 || CasetoRun==119 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==117
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		x_end=4*le_base;
		y_start=2*le_base;
		y_end=4*le_base;
		
		if CasetoRun==117
			x_crack{1}=[0.5 3;
						3-pi*1e-5 3-pi*1e-5;
				3-pi*1e-5+2.5 3]*le_base;
		elseif CasetoRun==122
			rotationangle=30/180*pi;
			rotationcenter=[2 3]*le_base;
			rotationmatrix=[cos(rotationangle) -sin(rotationangle);
							sin(rotationangle) cos(rotationangle)];
			
			x_crack{1}=[0.5 3; %x1 y1
						3-pi*1e-5 3]*le_base; %x2 y2
			for icrackparticle=1:size(x_crack{1},1)
				x_crack{1}(icrackparticle,:)=transpose(rotationmatrix*transpose(x_crack{1}(icrackparticle,:)-rotationcenter))+rotationcenter;
			end
		else
			x_crack{1}=[0.5 3;
						3-pi*1e-5 3]*le_base;
		end
		x_defaultcracktip=[3 3]*le_base;
		
		x_cracktop=x_crack;
		x_crackbot=x_crack;
		
		steelstrength=5; %MPa
		
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial<y_end
					else
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl=VectorInsertion(thetacrackrtl,sp,NaN);
				xdirletter=CellInsertion(xdirletter,sp,'t');
				ydirletter=CellInsertion(ydirletter,sp,'r');
				zdirletter=CellInsertion(zdirletter,sp,'l');
				xydirletter=CellInsertion(xydirletter,sp,'tr');
				yzdirletter=CellInsertion(yzdirletter,sp,'rl');
				xzdirletter=CellInsertion(xzdirletter,sp,'tl');
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				matmodel=VectorInsertion(matmodel,sp,2); %steel
				orientationoffset=VectorInsertion(orientationoffset,sp,NaN);
				plotignore=VectorInsertion(plotignore,sp,0);
				
				if x_trial>4*le_base-lp(1)
					if y_trial>4*le_base-lp(2)
						tractionedcorner=VectorInsertion(tractionedcorner,length(tractionedcorner)+1,sp);
						normalcorner{length(tractionedcorner)}=[1 0;
																0 1];
					elseif y_trial<2*le_base+lp(2)
						tractionedcorner=VectorInsertion(tractionedcorner,length(tractionedcorner)+1,sp);
						normalcorner{length(tractionedcorner)}=[1 0;
																0 -1];
					else
						tractionededge=VectorInsertion(tractionededge,length(tractionededge)+1,sp);
						normaledge=MatrixInsertion(normaledge,length(tractionededge),1,1);
						normaledge=MatrixInsertion(normaledge,length(tractionededge),2,0);
					end
				elseif y_trial>4*le_base-lp(2)
					tractionededge=VectorInsertion(tractionededge,length(tractionededge)+1,sp);
					normaledge=MatrixInsertion(normaledge,length(tractionededge),1,0);
					normaledge=MatrixInsertion(normaledge,length(tractionededge),2,1);
				elseif y_trial<2*le_base+lp(2)
					tractionededge=VectorInsertion(tractionededge,length(tractionededge)+1,sp);
					normaledge=MatrixInsertion(normaledge,length(tractionededge),1,0);
					normaledge=MatrixInsertion(normaledge,length(tractionededge),2,-1);
				end
				
				%if x_trial<6*le_base && x_trial>(6*le_base-lp(1)) && y_trial>13*le_base && y_trial<13*le_base+lp(2);
				%	ParticleswithPredYVel(1)=sp;
				%end
				%if x_trial<6*le_base && x_trial>(6*le_base-lp(1)) && y_trial<7*le_base && y_trial>7*le_base-lp(2);
				%	ParticleswithPredYVel(2)=sp;
				%end
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
			end
		end
		spCount=sp;
		epsilonshrinkdot_sp=zeros(1,spCount);
		epsilonshrinkdotx_sp=zeros(1,spCount);
		epsilonshrinkdoty_sp=zeros(1,spCount);
	elseif CasetoRun==137
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		x_crack.npaths=1;
		x_crack.nparticles(1)=2;
		
		x_start=2*le_base;
		x_end=4*le_base;
		y_start=2*le_base;
		y_end=4*le_base;
		
		x_crack.center(1,1,1)=0.5*le_base;
		x_crack.center(1,2,1)=3*le_base;
		x_crack.center(2,1,1)=(3-(pi*1e-5))*le_base;
		x_crack.center(2,2,1)=3*le_base;
		
		for i=1:2
			for j=1:2
				x_crack.top(i,j,1)=x_crack.center(i,j,1);
				x_crack.bot(i,j,1)=x_crack.center(i,j,1);
			end
		end
		x_defaultcracktip=[3 3]*le_base;
		
		
		steelstrength=5; %MPa
		
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial<y_end
					else
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl=VectorInsertion(thetacrackrtl,sp,NaN);
				xdirletter=CellInsertion(xdirletter,sp,'t');
				ydirletter=CellInsertion(ydirletter,sp,'r');
				zdirletter=CellInsertion(zdirletter,sp,'l');
				xydirletter=CellInsertion(xydirletter,sp,'tr');
				yzdirletter=CellInsertion(yzdirletter,sp,'rl');
				xzdirletter=CellInsertion(xzdirletter,sp,'tl');
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				matmodel=VectorInsertion(matmodel,sp,2); %steel
				orientationoffset=VectorInsertion(orientationoffset,sp,NaN);
				plotignore=VectorInsertion(plotignore,sp,0);
				
				if x_trial>4*le_base-lp(1)
					if y_trial>4*le_base-lp(2)
						tractionedcorner=VectorInsertion(tractionedcorner,length(tractionedcorner)+1,sp);
						normalcorner{length(tractionedcorner)}=[1 0;
																0 1];
					elseif y_trial<2*le_base+lp(2)
						tractionedcorner=VectorInsertion(tractionedcorner,length(tractionedcorner)+1,sp);
						normalcorner{length(tractionedcorner)}=[1 0;
																0 -1];
					else
						tractionededge=VectorInsertion(tractionededge,length(tractionededge)+1,sp);
						normaledge=MatrixInsertion(normaledge,length(tractionededge),1,1);
						normaledge=MatrixInsertion(normaledge,length(tractionededge),2,0);
					end
				elseif y_trial>4*le_base-lp(2)
					tractionededge=VectorInsertion(tractionededge,length(tractionededge)+1,sp);
					normaledge=MatrixInsertion(normaledge,length(tractionededge),1,0);
					normaledge=MatrixInsertion(normaledge,length(tractionededge),2,1);
				elseif y_trial<2*le_base+lp(2)
					tractionededge=VectorInsertion(tractionededge,length(tractionededge)+1,sp);
					normaledge=MatrixInsertion(normaledge,length(tractionededge),1,0);
					normaledge=MatrixInsertion(normaledge,length(tractionededge),2,-1);
				end
				
				%if x_trial<6*le_base && x_trial>(6*le_base-lp(1)) && y_trial>13*le_base && y_trial<13*le_base+lp(2);
				%	ParticleswithPredYVel(1)=sp;
				%end
				%if x_trial<6*le_base && x_trial>(6*le_base-lp(1)) && y_trial<7*le_base && y_trial>7*le_base-lp(2);
				%	ParticleswithPredYVel(2)=sp;
				%end
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
			end
		end
		spCount=sp;
		epsilonshrinkdot_sp=zeros(1,spCount);
		epsilonshrinkdotx_sp=zeros(1,spCount);
		epsilonshrinkdoty_sp=zeros(1,spCount);
	elseif CasetoRun==118 || CasetoRun==173 || CasetoRun==192
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction
		
		tractionedcorner_counter=0; %size reference
		normalcorner_counter=0; %size reference
		tractionededge_counter=0; %size reference
		normaledge_counter=0; %size reference
		
		pforce_sp_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		x_end=4*le_base;
		y_start=2*le_base;
		y_end=4*le_base;
		
		x_crack_unused=cell(1,10);
		%x_crack=coder.nullcopy(x_crack_unused);
		x_crack.npaths=10;
		x_crack.nparticles(1:10)=2;
		%x_crack.center=zeros(2,2,10);
		%x_crack.top=zeros(2,2,10);
		%x_crack.bot=zeros(2,2,10);
		
		x_crack_temp=([0.33 0.371;0.4843 0.5235]+[2 2;2 2])*le_base;
		x_crack.center(1,1,1)=x_crack_temp(1,1);
		x_crack.center(1,2,1)=x_crack_temp(1,2);
		x_crack.center(2,1,1)=x_crack_temp(2,1);
		x_crack.center(2,2,1)=x_crack_temp(2,2);
		x_crack_temp=([0.2706 0.8233; 0.4120 0.9933]+[2 2;2 2])*le_base;
		x_crack.center(1,1,2)=x_crack_temp(1,1);
		x_crack.center(1,2,2)=x_crack_temp(1,2);
		x_crack.center(2,1,2)=x_crack_temp(2,1);
		x_crack.center(2,2,2)=x_crack_temp(2,2);
		x_crack_temp=([0.3115 1.5362; 0.4883 1.7130]+[2 2;2 2])*le_base;
		x_crack.center(1,1,3)=x_crack_temp(1,1);
		x_crack.center(1,2,3)=x_crack_temp(1,2);
		x_crack.center(2,1,3)=x_crack_temp(2,1);
		x_crack.center(2,2,3)=x_crack_temp(2,2);
		x_crack_temp=([0.9106 0.4681; 1.0908 0.3494]+[2 2;2 2])*le_base;
		x_crack.center(1,1,4)=x_crack_temp(1,1);
		x_crack.center(1,2,4)=x_crack_temp(1,2);
		x_crack.center(2,1,4)=x_crack_temp(2,1);
		x_crack.center(2,2,4)=x_crack_temp(2,2);
		x_crack_temp=([0.8329 0.9064; 1.0876 0.9599]+[2 2;2 2])*le_base;
		x_crack.center(1,1,5)=x_crack_temp(1,1);
		x_crack.center(1,2,5)=x_crack_temp(1,2);
		x_crack.center(2,1,5)=x_crack_temp(2,1);
		x_crack.center(2,2,5)=x_crack_temp(2,2);
		x_crack_temp=([0.7134 1.3365; 0.6068 1.5130]+[2 2;2 2])*le_base;
		x_crack.center(1,1,6)=x_crack_temp(1,1);
		x_crack.center(1,2,6)=x_crack_temp(1,2);
		x_crack.center(2,1,6)=x_crack_temp(2,1);
		x_crack.center(2,2,6)=x_crack_temp(2,2);
		x_crack_temp=([1.4393 0.3678; 1.6253 0.4967]+[2 2;2 2])*le_base;
		x_crack.center(1,1,7)=x_crack_temp(1,1);
		x_crack.center(1,2,7)=x_crack_temp(1,2);
		x_crack.center(2,1,7)=x_crack_temp(2,1);
		x_crack.center(2,2,7)=x_crack_temp(2,2);
		x_crack_temp=([1.5926 0.8224; 1.4581 0.9953]+[2 2;2 2])*le_base;
		x_crack.center(1,1,8)=x_crack_temp(1,1);
		x_crack.center(1,2,8)=x_crack_temp(1,2);
		x_crack.center(2,1,8)=x_crack_temp(2,1);
		x_crack.center(2,2,8)=x_crack_temp(2,2);
		x_crack_temp=([1.6752 1.2320; 1.5203 1.4134]+[2 2;2 2])*le_base;
		x_crack.center(1,1,9)=x_crack_temp(1,1);
		x_crack.center(1,2,9)=x_crack_temp(1,2);
		x_crack.center(2,1,9)=x_crack_temp(2,1);
		x_crack.center(2,2,9)=x_crack_temp(2,2);
		x_crack_temp=([1.1323 1.5215; 1.3586 1.6957]+[2 2;2 2])*le_base;
		x_crack.center(1,1,10)=x_crack_temp(1,1);
		x_crack.center(1,2,10)=x_crack_temp(1,2);
		x_crack.center(2,1,10)=x_crack_temp(2,1);
		x_crack.center(2,2,10)=x_crack_temp(2,2);
		
		%{
		if CasetoRun==117
			x_crack{1}=[0.5 3;
						3-pi*1e-5 3-pi*1e-5;
				3-pi*1e-5+2.5 3]*le_base;
		end
		x_defaultcracktip=[3 3]*le_base;
		%}
		
		for i=1:size(x_crack.center,1)
			for j=1:size(x_crack.center,2)
				for k=1:size(x_crack.center,3)
					x_crack.top(i,j,k)=x_crack.center(i,j,k);
					x_crack.bot(i,j,k)=x_crack.center(i,j,k);
				end
			end
		end
		
		x_crack.spacing=le(1)/2;
		steelstrength=25;
		x_crack.bridge.yieldforce1=steelstrength*x_crack.spacing*t0_plane;
		x_crack.bridge.kbase2(:,:)=1e99;
		x_crack.bridge.yieldforce2(:,:)=steelstrength*x_crack.spacing*t0_plane;
		x_crack.bridge.deltai1=0.002*le_base;
		x_crack.bridge.deltae=0.1*x_crack.bridge.deltai1;
		x_crack.bridge.kbase1=x_crack.bridge.yieldforce1/x_crack.bridge.deltae;
		x_crack.cohesivepath(1)=1;
		x_crack.cohesivepath(2)=1;
		x_crack.cohesivepath(3)=1;
		x_crack.cohesivepath(4)=1;
		x_crack.cohesivepath(5)=1;
		x_crack.cohesivepath(6)=1;
		x_crack.cohesivepath(7)=1;
		x_crack.cohesivepath(8)=1;
		x_crack.cohesivepath(9)=1;
		x_crack.cohesivepath(10)=1;
		
		x_crack.cohesivepoint(1,1)=1;
		x_crack.cohesivepoint(2,1)=1;
		x_crack.cohesivepoint(1,2)=1;
		x_crack.cohesivepoint(2,2)=1;
		x_crack.cohesivepoint(1,3)=1;
		x_crack.cohesivepoint(2,3)=1;
		x_crack.cohesivepoint(1,4)=1;
		x_crack.cohesivepoint(2,4)=1;
		x_crack.cohesivepoint(1,5)=1;
		x_crack.cohesivepoint(2,5)=1;
		x_crack.cohesivepoint(1,6)=1;
		x_crack.cohesivepoint(2,6)=1;
		x_crack.cohesivepoint(1,7)=1;
		x_crack.cohesivepoint(2,7)=1;
		x_crack.cohesivepoint(1,8)=1;
		x_crack.cohesivepoint(2,8)=1;
		x_crack.cohesivepoint(1,9)=1;
		x_crack.cohesivepoint(2,9)=1;
		x_crack.cohesivepoint(1,10)=1;
		x_crack.cohesivepoint(2,10)=1; %(iparticle,ipath)
		
		x_crack.bridge.pathcompletemonitor.values(1)=1;
		x_crack.bridge.pathcompletemonitor.values(2)=2;
		x_crack.bridge.pathcompletemonitor.values(3)=3;
		x_crack.bridge.pathcompletemonitor.values(4)=4;
		x_crack.bridge.pathcompletemonitor.values(5)=5;
		x_crack.bridge.pathcompletemonitor.values(6)=6;
		x_crack.bridge.pathcompletemonitor.values(7)=7;
		x_crack.bridge.pathcompletemonitor.values(8)=8;
		x_crack.bridge.pathcompletemonitor.values(9)=9;
		x_crack.bridge.pathcompletemonitor.values(10)=10;
		x_crack.bridge.pathcompletemonitor.size=10;


		%x_crack.top=x_crack.center;
		%x_crack.bot=x_crack.center;
		
		steelstrength=25; %MPa
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial<y_end
					else
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				
				if x_trial>4*le_base-lp(1)
					if y_trial>4*le_base-lp(2)
						tractionedcorner_counter=tractionedcorner_counter+1;
						normalcorner_counter=normalcorner_counter+1;
					elseif y_trial<2*le_base+lp(2)
						tractionedcorner_counter=tractionedcorner_counter+1;
						normalcorner_counter=normalcorner_counter+1;
					else
						tractionededge_counter=tractionededge_counter+1;
						normaledge_counter=normaledge_counter+1;
					end
				elseif y_trial>4*le_base-lp(2)
					tractionededge_counter=tractionededge_counter+1;
					normaledge_counter=normaledge_counter+1;
				elseif y_trial<2*le_base+lp(2)
					tractionededge_counter=tractionededge_counter+1;
					normaledge_counter=normaledge_counter+1;
				end
				
				%if x_trial<6*le_base && x_trial>(6*le_base-lp(1)) && y_trial>13*le_base && y_trial<13*le_base+lp(2);
				%	ParticleswithPredYVel(1)=sp;
				%end
				%if x_trial<6*le_base && x_trial>(6*le_base-lp(1)) && y_trial<7*le_base && y_trial>7*le_base-lp(2);
				%	ParticleswithPredYVel(2)=sp;
				%end
			end
		end
		spCount=sp;
		
		thetacrackrtl=zeros(1,spCount);
		xdirletter_unused=cell(1,spCount);
		ydirletter_unused=cell(1,spCount);
		zdirletter_unused=cell(1,spCount);
		xydirletter_unused=cell(1,spCount);
		yzdirletter_unused=cell(1,spCount);
		xzdirletter_unused=cell(1,spCount);
		
		xdirletter=coder.nullcopy(xdirletter_unused);
		ydirletter=coder.nullcopy(ydirletter_unused);
		zdirletter=coder.nullcopy(zdirletter_unused);
		xydirletter=coder.nullcopy(xydirletter_unused);
		yzdirletter=coder.nullcopy(yzdirletter_unused);
		xzdirletter=coder.nullcopy(xzdirletter_unused);
		
		x_sp=zeros(spCount,2);
		r1_sp=zeros(spCount,2);
		r2_sp=zeros(spCount,2);

		matmodel=zeros(1,spCount);
		orientationoffset=zeros(1,spCount);
		plotignore=zeros(1,spCount);
		tractionedcorner=zeros(1,spCount);
		p_sp=zeros(spCount,1); %it's a vertical vector
		weakeningfactor_sp=zeros(1,spCount);
		pforce_sp=zeros(spCount,2);
		alphahp=zeros(spCount,7);
		uncrackable_sp=zeros(1,spCount);

		
		epsilonshrinkdot_sp=zeros(1,spCount);
		epsilonshrinkdotx_sp=zeros(1,spCount);
		epsilonshrinkdoty_sp=zeros(1,spCount);

		tractionedcorner=zeros(1,tractionedcorner_counter);
		normalcorner=cell(1,normalcorner_counter);
		tractionededge=zeros(1,tractionededge_counter);
		normaledge=zeros(normaledge_counter,2);
		
		
		tractionedcorner_counter=0;
		normalcorner_counter=0;
		tractionededge_counter=0;
		normaledge_counter=0;
		
		sp=0;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial<y_end
					else
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl(sp)=NaN;
				xdirletter{sp}='t';
				ydirletter{sp}='r';
				zdirletter{sp}='l';
				xydirletter{sp}='tr';
				yzdirletter{sp}='rl';
				xzdirletter{sp}='tl';
				x_sp(sp,1)=x_trial;
				x_sp(sp,2)=y_trial;
				matmodel(sp)=4; %crackable elastic
				orientationoffset(sp)=NaN;
				plotignore(sp)=0;
				
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				weakeningfactor_sp(sp)=0;
				
				if x_trial>4*le_base-lp(1)
					if y_trial>4*le_base-lp(2)
						tractionedcorner_counter=tractionedcorner_counter+1;
						tractionedcorner(tractionedcorner_counter)=sp;
						normalcorner_counter=normalcorner_counter+1;
						normalcorner{normalcorner_counter}=[1 0;
																0 1];
					elseif y_trial<2*le_base+lp(2)
						tractionedcorner_counter=tractionedcorner_counter+1;
						tractionedcorner(tractionedcorner_counter)=sp;
						normalcorner_counter=normalcorner_counter+1;
						normalcorner{normalcorner_counter}=[1 0;
																0 -1];
					else
						tractionededge_counter=tractionededge_counter+1;
						tractionededge(tractionededge_counter)=sp;
						normaledge_counter=normaledge_counter+1;
						normaledge(normaledge_counter,1)=1;
						normaledge(normaledge_counter,2)=0;
					end
				elseif y_trial>4*le_base-lp(2)
					tractionededge_counter=tractionededge_counter+1;
					tractionededge(tractionededge_counter)=sp;
					normaledge_counter=normaledge_counter+1;
					normaledge(normaledge_counter,1)=0;
					normaledge(normaledge_counter,2)=1;
				elseif y_trial<2*le_base+lp(2)
					tractionededge_counter=tractionededge_counter+1;
					tractionededge(tractionededge_counter)=sp;
					normaledge_counter=normaledge_counter+1;
					normaledge(normaledge_counter,1)=0;
					normaledge(normaledge_counter,2)=-1;
				end
				
				%if x_trial<6*le_base && x_trial>(6*le_base-lp(1)) && y_trial>13*le_base && y_trial<13*le_base+lp(2);
				%	ParticleswithPredYVel(1)=sp;
				%end
				%if x_trial<6*le_base && x_trial>(6*le_base-lp(1)) && y_trial<7*le_base && y_trial>7*le_base-lp(2);
				%	ParticleswithPredYVel(2)=sp;
				%end
			end
		end
		1;
	elseif CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction
		
		tractionedcorner_counter=0; %size reference
		normalcorner_counter=0; %size reference
		tractionededge_counter=0; %size reference
		normaledge_counter=0; %size reference
		
		pforce_sp_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		if CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==132 || CasetoRun==130
			x_end=6*le_base;
		elseif CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==178 || CasetoRun==169
			x_end=5*le_base;
		elseif CasetoRun==179
			x_end=4*le_base;
		elseif CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==140 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142
			x_end=10*le_base;
		elseif CasetoRun==134 || CasetoRun==136
			x_end=7.5*le_base;
		end
		y_start=2*le_base;
		if CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128
			y_end=4*le_base;
		elseif CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169
			y_end=5*le_base;
		elseif CasetoRun==129 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130
			y_end=4.25*le_base;
		end
		
		if CasetoRun==123
			x_crack_unused=cell(1,2);
			%x_crack=coder.nullcopy(x_crack_unused);
			x_crack.npaths=2;
			x_crack.nparticles(1:2)=2;
			%x_crack.center=zeros(2,2,10);
			%x_crack.top=zeros(2,2,10);
			%x_crack.bot=zeros(2,2,10);
			
			x_crack_temp=[6 3;4.5 3]*le_base+[2 0;0 0]*le(1)+[pi pi;pi pi]/50;
			x_crack.center(1,1,1)=x_crack_temp(1,1);
			x_crack.center(1,2,1)=x_crack_temp(1,2);
			x_crack.center(2,1,1)=x_crack_temp(2,1);
			x_crack.center(2,2,1)=x_crack_temp(2,2);
			
			x_crack_temp=[3+0.5*cos(pi/3) 3+0.5*sin(pi/3);3-0.5*cos(pi/3) 3-0.5*sin(pi/3)]*le_base;
			x_crack.center(1,1,2)=x_crack_temp(1,1);
			x_crack.center(1,2,2)=x_crack_temp(1,2);
			x_crack.center(2,1,2)=x_crack_temp(2,1);
			x_crack.center(2,2,2)=x_crack_temp(2,2);
		elseif CasetoRun==166
			x_crack.npaths=1;
			x_crack.nparticles(1)=2;
			x_crack.center(1,1,1)=le(1)+0.01;
			x_crack.center(1,2,1)=le(2)+0.01;
			x_crack.center(2,1,1)=le(1)+0.011;
			x_crack.center(2,2,1)=le(2)+0.011;
			x_crack.terminatedprop(1,1)=1;
			x_crack.terminatedprop(1,2)=1;
			
			%start of for testing only
			
			x_crack.npaths=2;
			x_crack.nparticles(2)=5;
			x_crack.center(1:5,1:2,2)=[ ...
			+4.853930069693719e+000	+2.972240882749910e+000
			+4.950000017129133e+000	+2.999999994755408e+000
			+5.050000014504054e+000	+2.999999998547479e+000
			+5.149948599642003e+000	+3.003205858301732e+000
			+5.249897195596345e+000	+3.006411718110133e+000 ...
			];
			
			%end of for testing only
		elseif CasetoRun==169
			x_crack.npaths=1;
			x_crack.nparticles(1)=2;
			x_crack.center(1,1,1)=le(1)+0.01;
			x_crack.center(1,2,1)=le(2)+0.01;
			x_crack.center(2,1,1)=le(1)+0.011;
			x_crack.center(2,2,1)=le(2)+0.011;
			x_crack.terminatedprop(1,1)=1;
			x_crack.terminatedprop(1,2)=1;
		elseif CasetoRun==179
			x_crack.npaths=1;
			x_crack.nparticles(1)=2;
			x_crack.center(1,1,1)=le(1)+0.01;
			x_crack.center(1,2,1)=le(2)+0.01;
			x_crack.center(2,1,1)=le(1)+0.011;
			x_crack.center(2,2,1)=le(2)+0.011;
			x_crack.terminatedprop(1,1)=1;
			x_crack.terminatedprop(1,2)=1;
		elseif CasetoRun==177 || CasetoRun==178
			x_crack.npaths=1;
			x_crack.nparticles(1)=2;
			x_crack.center(1,1,1)=le(1)+0.01;
			x_crack.center(1,2,1)=le(2)+0.01;
			x_crack.center(2,1,1)=le(1)+0.011;
			x_crack.center(2,2,1)=le(2)+0.011;
			x_crack.terminatedprop(1,1)=1;
			x_crack.terminatedprop(1,2)=1;
			x_crack.npaths=2;
			x_crack.nparticles(2)=2;
			x_crack.center(1,1,2)=le(1)+0.01+0.001;
			x_crack.center(1,2,2)=le(2)+0.01;
			x_crack.center(2,1,2)=le(1)+0.011+0.001;
			x_crack.center(2,2,2)=le(2)+0.011;
			x_crack.terminatedprop(2,1)=1;
			x_crack.terminatedprop(2,2)=1;
			x_crack.npaths=3;
			x_crack.nparticles(3)=2;
			x_crack.center(1:2,1:2,3)=[ ...
			4.5 3.5
			5.5 3.5 ...
			];
			x_crack.terminatedprop(3,1)=1;
			x_crack.terminatedprop(3,2)=0;
		elseif CasetoRun==182 || CasetoRun==189
			x_crack.npaths=1;
			x_crack.nparticles(1)=2;
			x_crack.center(1,1,1)=le(1)+0.01;
			x_crack.center(1,2,1)=le(2)+0.01;
			x_crack.center(2,1,1)=le(1)+0.011;
			x_crack.center(2,2,1)=le(2)+0.011;
			x_crack.terminatedprop(1,1)=1;
			x_crack.terminatedprop(1,2)=1;

			x_crack.npaths=2;
			midarc.alpha.deltay=zeros(1,1); %line angle at middle
			midarc.alpha.deltax=zeros(1,1); %line angle at middle
			midarc.thetai=zeros(1,1); %arc angle at middle
			midarc.Ai=zeros(1,1); %arc amplitude
			midarc.xci=zeros(1,1); %x position of x center, calculated
			midarc.thetaend=zeros(1,1); %arc angle end, which is less than zero
			midarc.thetastart=zeros(1,1); %arc angle start, which is zero
			midarc.npoints=zeros(1,1); %number of points for the crack
			midarc.s=zeros(1,1); %side of specimen
			midarc.ytop=zeros(1,1); %top tip of the middle crack relative to bottom left corner of the specimen
			midarc.ybot=zeros(1,1); %bot tip of the middle crack relative to bottom left corner of the specimen
			midarc.generate.thetatrial=zeros(1,1);
			midarc.generate.xtrial=zeros(1,1);
			midarc.generate.ytrial=zeros(1,1);
			midarc.generate.A=zeros(1,1); %arc amplitude for generation
			midarc.generate.xc=zeros(1,1); %center of arc relative to bottom left corner of the specimen
			midarc.generate.yc=zeros(1,1); %center of arc relative to bottom left corner of the specimen
			
			midarc.npoints=11;
			midarc.ytop=(4-2)*le_base;
			midarc.ybot=(3-2)*le_base;
            midarc.s=3*le_base;
			midarc.alpha.deltay=(4-3)*le_base;
			midarc.alpha.deltax=(3.75-3.25)*le_base;
			midarc.thetai=reliableatan(midarc.alpha.deltay,-midarc.alpha.deltax); %yes it is flipped. it is noted that reliableatan takes (deltax,deltay) as input. it was flipped for the reason of theta=one over minus alpha
			midarc.Ai=abs(1/sin(midarc.thetai)*(midarc.s/2-midarc.ytop));
			midarc.xci=midarc.s/2-midarc.Ai*cos(midarc.thetai);
			midarc.thetaend=asin(1/midarc.Ai*(midarc.ybot-midarc.ytop));
			midarc.thetastart=0;
			midarc.generate.A=midarc.Ai;
			midarc.generate.yc=midarc.ytop;
			midarc.generate.xc=midarc.xci;
			for ipoint=1:midarc.npoints
				midarc.generate.thetatrial=midarc.thetastart+(midarc.thetaend-midarc.thetastart)/(midarc.npoints-1)*(ipoint-1);
				midarc.generate.xtrial=midarc.generate.xc+midarc.generate.A*cos(midarc.generate.thetatrial);
				midarc.generate.ytrial=midarc.generate.yc+midarc.generate.A*sin(midarc.generate.thetatrial);
				x_crack.center(ipoint,1,x_crack.npaths)=midarc.generate.xtrial+2*le_base;
				x_crack.center(ipoint,2,x_crack.npaths)=midarc.generate.ytrial+2*le_base;
            end
			
            disp('x_crack.center(1:5,1,2)=')
            disp(x_crack.center(1:5,1,2))
            disp('x_crack.center(1:5,2,2)=')
            disp(x_crack.center(1:5,2,2))

            x_crack.nparticles(2)=midarc.npoints;
			
			x_crack.npaths=3;
			x_crack.nparticles(3)=2;
			x_crack.center(1:2,1:2,3)=[ ...
			4.5 3.5
			5.5 3.5 ...
			];
			
			x_crack.terminatedprop(3,1)=1;
			x_crack.spacing=le(1)/2;
			x_crack.bridge.kbase1=1e99;
			steelstrength=25;
			x_crack.bridge.yieldforce1=steelstrength*x_crack.spacing*t0_plane;
			x_crack.bridge.kbase2(:,:)=1e99;
			x_crack.bridge.yieldforce2(:,:)=steelstrength*x_crack.spacing*t0_plane;
			x_crack.bridge.deltai1=0.002;
			x_crack.cohesivepath(2)=1;
			x_crack.cohesivepath(3)=1;
			x_crack.cohesivepoint(1,2)=1;
			x_crack.cohesivepoint(x_crack.nparticles(2),2)=1;
			x_crack.cohesivepoint(1,3)=1; %(iparticle,ipath)
			x_crack.bridge.pathcompletemonitor.values(1)=2;
			x_crack.bridge.pathcompletemonitor.values(2)=3;
			x_crack.bridge.pathcompletemonitor.size=2;

		elseif CasetoRun==183
			x_crack.npaths=1;
			x_crack.nparticles(1)=2;
			x_crack.center(1,1,1)=le(1)+0.01;
			x_crack.center(1,2,1)=le(2)+0.01;
			x_crack.center(2,1,1)=le(1)+0.011;
			x_crack.center(2,2,1)=le(2)+0.011;
			x_crack.terminatedprop(1,1)=1;
			x_crack.terminatedprop(1,2)=1;
		elseif CasetoRun==185
			x_crack.npaths=1;
			x_crack.nparticles(1)=2;
			x_crack.center(1,1,1)=le(1)+0.01;
			x_crack.center(1,2,1)=le(2)+0.01;
			x_crack.center(2,1,1)=le(1)+0.011;
			x_crack.center(2,2,1)=le(2)+0.011;
			x_crack.terminatedprop(1,1)=1;
			x_crack.terminatedprop(1,2)=1;
			x_crack.npaths=2;
			x_crack.nparticles(2)=9;
			x_crack.center(1:x_crack.nparticles(x_crack.npaths),1:2,x_crack.npaths)=[ ...
			3.5 3.5
			3.75 3.5
			4 3.5
			4.25 3.5
			4.5 3.5
			4.75 3.5
			5.0 3.5
			5.26 3.5
			5.51 3.5 ...
			]; %x y;x y
			x_crack.cohesivepath(2)=1;
			x_crack.cohesivepoint(1,2)=1;
			x_crack.cohesivepoint(2,2)=1;
			x_crack.cohesivepoint(3,2)=1;
			x_crack.cohesivepoint(4,2)=1;
			x_crack.cohesivepoint(5,2)=1;
			x_crack.cohesivepoint(6,2)=1;
			x_crack.cohesivepoint(7,2)=0;
			x_crack.cohesivepoint(8,2)=0;
			x_crack.cohesivepoint(9,2)=0;
			x_crack.spacing=0.25;
			x_crack.bridge.kbase1=1e99;
			x_crack.bridge.yieldforce1=E*0.000002;
			for ipath=1:x_crack.npaths
				if x_crack.cohesivepath(ipath)==1
					for iparticle=1:x_crack.nparticles(ipath)
						if x_crack.cohesivepoint(iparticle,ipath)==1
							%x_crack.force.top(iparticle,1,ipath)=10;
							%x_crack.force.bot(iparticle,1,ipath)=-10;
							x_crack.bridge.kbase2(:,:)=1e99;
							x_crack.bridge.yieldforce2(:,:)=E*0.000002;
						end
					end
				end
			end
			x_crack.bridge.deltai1=0.00002;
			x_crack.terminatedprop(2,1)=0;
			x_crack.terminatedprop(2,2)=0;
		elseif CasetoRun==193
			x_crack.npaths=1;
			x_crack.nparticles(1)=2;
			x_crack.center(1,1,1)=le(1)+0.01;
			x_crack.center(1,2,1)=le(2)+0.01;
			x_crack.center(2,1,1)=le(1)+0.011;
			x_crack.center(2,2,1)=le(2)+0.011;
			x_crack.terminatedprop(1,1)=1;
			x_crack.terminatedprop(1,2)=1;
			steelstrength=25;
			x_crack.npaths=2;
			x_crack.spacing=le(1)/2;
			x_crack.npaths=2;
			x_crack.nparticles(2)=17;
			x_crack.center(1:x_crack.nparticles(x_crack.npaths),1:2,x_crack.npaths)=[ ...
			1.49 3.5
			1.74 3.5
			2.0 3.5
			2.25 3.5
			2.5 3.5
			2.75 3.5
			3 3.5
			3.25 3.5
			3.5 3.5
			3.75 3.5
			4 3.5
			4.25 3.5
			4.5 3.5
			4.75 3.5
			5.0 3.5
			5.26 3.5
			5.51 3.5 ...
			]*le_base; %x y;x y
			x_crack.cohesivepath(2)=1;
			x_crack.cohesivepoint(1,2)=0;
			x_crack.cohesivepoint(2,2)=0;
			x_crack.cohesivepoint(3,2)=0;
			x_crack.cohesivepoint(4,2)=1;
			x_crack.cohesivepoint(5,2)=1;
			x_crack.cohesivepoint(6,2)=1;
			x_crack.cohesivepoint(7,2)=1;
			x_crack.cohesivepoint(8,2)=1;
			x_crack.cohesivepoint(9,2)=1;
			x_crack.cohesivepoint(10,2)=1;
			x_crack.cohesivepoint(11,2)=1;
			x_crack.cohesivepoint(12,2)=1;
			x_crack.cohesivepoint(13,2)=1;
			x_crack.cohesivepoint(14,2)=1;
			x_crack.cohesivepoint(15,2)=0;
			x_crack.cohesivepoint(16,2)=0;
			x_crack.cohesivepoint(17,2)=0;
			x_crack.bridge.deltai1=0.2*le_base;
			x_crack.bridge.deltae=1*x_crack.bridge.deltai1;
			x_crack.bridge.yieldforce1=steelstrength*x_crack.spacing*t0_plane;
			x_crack.bridge.kbase1=x_crack.bridge.yieldforce1/x_crack.bridge.deltae;
			x_crack.bridge.kbase2(:,:)=1e99;
			x_crack.bridge.yieldforce2(:,:)=steelstrength*x_crack.spacing*t0_plane;
			x_crack.terminatedprop(2,1)=0;
			x_crack.terminatedprop(2,2)=0;
			x_crack.bridge.pathcompletemonitor.values(1)=2;
			x_crack.bridge.pathcompletemonitor.size=1;
		elseif CasetoRun==186
			x_crack.npaths=1;
			x_crack.nparticles(1)=2;
			x_crack.center(1,1,1)=le(1)+0.01;
			x_crack.center(1,2,1)=le(2)+0.01;
			x_crack.center(2,1,1)=le(1)+0.011;
			x_crack.center(2,2,1)=le(2)+0.011;
			x_crack.terminatedprop(1,1)=1;
			x_crack.terminatedprop(1,2)=1;
			steelstrength=25;
			x_crack.npaths=2;
			x_crack.cohesivepath(2)=1;
			x_crack.spacing=le(1)/2;
			for iparticle=1:99999
				x_crack_trial=(4.25*le_base+(iparticle-1)*x_crack.spacing);
				if x_crack_trial>5*le_base+le(1)
					x_crack.nparticles(x_crack.npaths)=iparticle-1;
					break;
				end
				x_crack.center(iparticle,:,x_crack.npaths)=[x_crack_trial 3.5*le_base];
				%if iparticle>1 && x_crack_trial<=5
				%	x_crack.cohesivepoint(iparticle,x_crack.npaths)=1;
				%end
			end
			x_crack.bridge.deltai1=0.002*le_base;
			x_crack.bridge.deltae=0.25*x_crack.bridge.deltai1;
			x_crack.bridge.yieldforce1=steelstrength*x_crack.spacing*t0_plane;
			x_crack.bridge.kbase1=x_crack.bridge.yieldforce1/x_crack.bridge.deltae;
			x_crack.bridge.kbase2(:,:)=1e99;
			x_crack.bridge.yieldforce2(:,:)=steelstrength*x_crack.spacing*t0_plane;
			
			x_crack.terminatedprop(2,1)=0;
			x_crack.terminatedprop(2,2)=0;
			x_crack.cohesivepoint(1,2)=1;
			x_crack.bridge.pathcompletemonitor.values(1)=2;
			x_crack.bridge.pathcompletemonitor.size=1;
		elseif CasetoRun==184
			x_crack.npaths=1;
			x_crack.nparticles(1)=2;
			x_crack.center(1,1,1)=le(1)+0.01;
			x_crack.center(1,2,1)=le(2)+0.01;
			x_crack.center(2,1,1)=le(1)+0.011;
			x_crack.center(2,2,1)=le(2)+0.011;
			x_crack.terminatedprop(1,1)=1;
			x_crack.terminatedprop(1,2)=1;
			x_crack.npaths=2;
			x_crack.nparticles(2)=17;
			x_crack.center(1:x_crack.nparticles(x_crack.npaths),1:2,x_crack.npaths)=[ ...
			1.49 3.5
			1.74 3.5
			2.0 3.5
			2.25 3.5
			2.5 3.5
			2.75 3.5
			3 3.5
			3.25 3.5
			3.5 3.5
			3.75 3.5
			4 3.5
			4.25 3.5
			4.5 3.5
			4.75 3.5
			5.0 3.5
			5.26 3.5
			5.51 3.5 ...
			]; %x y;x y
			x_crack.cohesivepath(2)=1;
			x_crack.cohesivepoint(1,2)=0;
			x_crack.cohesivepoint(2,2)=0;
			x_crack.cohesivepoint(3,2)=0;
			x_crack.cohesivepoint(4,2)=1;
			x_crack.cohesivepoint(5,2)=1;
			x_crack.cohesivepoint(6,2)=1;
			x_crack.cohesivepoint(7,2)=1;
			x_crack.cohesivepoint(8,2)=1;
			x_crack.cohesivepoint(9,2)=1;
			x_crack.cohesivepoint(10,2)=1;
			x_crack.cohesivepoint(11,2)=1;
			x_crack.cohesivepoint(12,2)=1;
			x_crack.cohesivepoint(13,2)=1;
			x_crack.cohesivepoint(14,2)=1;
			x_crack.cohesivepoint(15,2)=0;
			x_crack.cohesivepoint(16,2)=0;
			x_crack.cohesivepoint(17,2)=0;
			x_crack.bridge.kbase1=E/100;
			x_crack.bridge.yieldforce1=E*0.002;
			for ipath=1:x_crack.npaths
				if x_crack.cohesivepath(ipath)==1
					for iparticle=1:x_crack.nparticles(ipath)
						if x_crack.cohesivepoint(iparticle,ipath)==1
							%x_crack.force.top(iparticle,1,ipath)=10;
							%x_crack.force.bot(iparticle,1,ipath)=-10;
							x_crack.bridge.kbase2(iparticle,ipath)=E/100;
							x_crack.bridge.yieldforce2(iparticle,ipath)=E*0.002;
						end
					end
				end
			end
			x_crack.bridge.deltai1=0.4;
			x_crack.terminatedprop(2,1)=1;
			x_crack.terminatedprop(2,2)=1;
		elseif CasetoRun==191
			x_crack.npaths=1;
			x_crack.nparticles(1)=2;
			x_crack.center(1,1,1)=le(1)+0.01;
			x_crack.center(1,2,1)=le(2)+0.01;
			x_crack.center(2,1,1)=le(1)+0.011;
			x_crack.center(2,2,1)=le(2)+0.011;
			x_crack.terminatedprop(1,1)=1;
			x_crack.terminatedprop(1,2)=1;
			x_crack.npaths=2;
			x_crack.nparticles(2)=2;
			x_crack.center(1:2,1:2,2)=[ ...
			3.5 3
			3.5 4 ...
			]*le_base; %x y;x y
			x_crack.npaths=3;
			x_crack.nparticles(3)=2;
			x_crack.center(1:2,1:2,3)=[ ...
			4.5 3.5
			5.5 3.5 ...
			]*le_base;
			x_crack.terminatedprop(3,1)=1;
			x_crack.spacing=le(1)/2;
			x_crack.bridge.kbase1=1e99;
			steelstrength=25;
			x_crack.bridge.yieldforce1=steelstrength*x_crack.spacing*t0_plane;
			x_crack.bridge.kbase2(:,:)=1e99;
			x_crack.bridge.yieldforce2(:,:)=steelstrength*x_crack.spacing*t0_plane;
			x_crack.bridge.deltai1=0.002*le_base;
			x_crack.cohesivepath(2)=1;
			x_crack.cohesivepath(3)=1;
			x_crack.cohesivepoint(1,2)=1;
			x_crack.cohesivepoint(2,2)=1;
			x_crack.cohesivepoint(1,3)=1; %(iparticle,ipath)
			x_crack.bridge.pathcompletemonitor.values(1)=2;
			x_crack.bridge.pathcompletemonitor.values(2)=3;
			x_crack.bridge.pathcompletemonitor.size=2;

		elseif CasetoRun==168 || CasetoRun==181 || CasetoRun==188
			x_crack.npaths=1;
			x_crack.nparticles(1)=2;
			x_crack.center(1,1,1)=le(1)+0.01;
			x_crack.center(1,2,1)=le(2)+0.01;
			x_crack.center(2,1,1)=le(1)+0.011;
			x_crack.center(2,2,1)=le(2)+0.011;
			x_crack.terminatedprop(1,1)=1;
			x_crack.terminatedprop(1,2)=1;
			x_crack.npaths=2;
			x_crack.nparticles(2)=2;
			x_crack.center(1:2,1:2,2)=[ ...
			3.25 3
			3.75 4 ...
			]; %x y;x y
			x_crack.npaths=3;
			x_crack.nparticles(3)=2;
			x_crack.center(1:2,1:2,3)=[ ...
			4.5 3.5
			5.5 3.5 ...
			];
			x_crack.terminatedprop(3,1)=1;
			x_crack.spacing=le(1)/2;
			x_crack.bridge.kbase1=1e99;
			steelstrength=25;
			x_crack.bridge.yieldforce1=steelstrength*x_crack.spacing*t0_plane;
			x_crack.bridge.kbase2(:,:)=1e99;
			x_crack.bridge.yieldforce2(:,:)=steelstrength*x_crack.spacing*t0_plane;
			x_crack.bridge.deltai1=0.002;
			x_crack.cohesivepath(2)=1;
			x_crack.cohesivepath(3)=1;
			x_crack.cohesivepoint(1,2)=1;
			x_crack.cohesivepoint(2,2)=1;
			x_crack.cohesivepoint(1,3)=1; %(iparticle,ipath)
			x_crack.bridge.pathcompletemonitor.values(1)=2;
			x_crack.bridge.pathcompletemonitor.values(2)=3;
			x_crack.bridge.pathcompletemonitor.size=2;
		elseif CasetoRun==187
			x_crack.npaths=1;
			x_crack.nparticles(1)=2;
			x_crack.center(1,1,1)=le(1)+0.01;
			x_crack.center(1,2,1)=le(2)+0.01;
			x_crack.center(2,1,1)=le(1)+0.011;
			x_crack.center(2,2,1)=le(2)+0.011;
			x_crack.terminatedprop(1,1)=1;
			x_crack.terminatedprop(1,2)=1;
			x_crack.spacing=le(1)/2;
			
			steelstrength=25;
			x_crack.bridge.yieldforce1=steelstrength*x_crack.spacing*t0_plane;
			
			x_crack.bridge.yieldforce2(:,:)=steelstrength*x_crack.spacing*t0_plane/2;
			x_crack.bridge.deltai1=0.002*le_base;
			x_crack.bridge.deltae=0.1*x_crack.bridge.deltai1;
			x_crack.bridge.kbase1=x_crack.bridge.yieldforce1/x_crack.bridge.deltae;
			%x_crack.bridge.kbase1=1e99;
			x_crack.bridge.kbase2(:,:)=x_crack.bridge.kbase1;
			x_crack.bridge.pathcompletemonitor.size=1;
			x_crack.bridge.pathcompletemonitor.values(1)=2;
			%start of for testing only
			%{
			x_crack.npaths=2;
			x_crack.nparticles(2)=7;
			x_crack.center(1:7,1:2,2)=[ ...
			+4.596752447366979e+000	+3.041619701808984e+000
			+4.696290712550657e+000	+3.051218335265043e+000
			+4.795909705886739e+000	+3.059939259714092e+000
			+4.895901988371145e+000	+3.061184153532690e+000
			+4.975000206978596e+000	+3.000000142189686e+000
			+5.025000185699557e+000	+2.999999910819500e+000
			+5.075000059195514e+000	+2.999999704432420e+000 ...
			];
			x_crack.terminatedprop(2,1)=1;
			x_crack.terminatedprop(2,2)=1;
			%}
			%end of for testing only
		elseif CasetoRun==167 || CasetoRun==176 || CasetoRun==190
			x_crack.npaths=1;
			x_crack.nparticles(1)=2;
			x_crack.center(1,1,1)=le(1)+0.01;
			x_crack.center(1,2,1)=le(2)+0.01;
			x_crack.center(2,1,1)=le(1)+0.011;
			x_crack.center(2,2,1)=le(2)+0.011;
			x_crack.terminatedprop(1,1)=1;
			x_crack.terminatedprop(1,2)=1;
			x_crack.spacing=le(1)/2;
			
			steelstrength=25;
			x_crack.bridge.yieldforce1=steelstrength*x_crack.spacing*t0_plane;
			
			x_crack.bridge.yieldforce2(:,:)=steelstrength*x_crack.spacing*t0_plane;
			x_crack.bridge.deltai1=0.002*le_base;
			x_crack.bridge.deltae=0.1*x_crack.bridge.deltai1;
			x_crack.bridge.kbase1=x_crack.bridge.yieldforce1/x_crack.bridge.deltae;
			%x_crack.bridge.kbase1=1e99;
			x_crack.bridge.kbase2(:,:)=x_crack.bridge.kbase1;
			x_crack.bridge.pathcompletemonitor.size=1;
			x_crack.bridge.pathcompletemonitor.values(1)=2;
			%start of for testing only
			%{
			x_crack.npaths=2;
			x_crack.nparticles(2)=7;
			x_crack.center(1:7,1:2,2)=[ ...
			+4.596752447366979e+000	+3.041619701808984e+000
			+4.696290712550657e+000	+3.051218335265043e+000
			+4.795909705886739e+000	+3.059939259714092e+000
			+4.895901988371145e+000	+3.061184153532690e+000
			+4.975000206978596e+000	+3.000000142189686e+000
			+5.025000185699557e+000	+2.999999910819500e+000
			+5.075000059195514e+000	+2.999999704432420e+000 ...
			];
			x_crack.terminatedprop(2,1)=1;
			x_crack.terminatedprop(2,2)=1;
			%}
			%end of for testing only
		elseif CasetoRun==163 || CasetoRun==170 || CasetoRun==171
			x_crack.npaths=1;
			x_crack.nparticles(1)=2;
			x_crack.center(1,1,1)=le(1)+0.01;
			x_crack.center(1,2,1)=le(2)+0.01;
			x_crack.center(2,1,1)=le(1)+0.011;
			x_crack.center(2,2,1)=le(2)+0.011;
			x_crack.terminatedprop(1,1)=1;
			x_crack.terminatedprop(1,2)=1;
			%start of for testing only
			%{
			x_crack.npaths=2;
			x_crack.nparticles(2)=7;
			x_crack.center(1:7,1:2,2)=[ ...
			+4.596752447366979e+000	+3.041619701808984e+000
			+4.696290712550657e+000	+3.051218335265043e+000
			+4.795909705886739e+000	+3.059939259714092e+000
			+4.895901988371145e+000	+3.061184153532690e+000
			+4.975000206978596e+000	+3.000000142189686e+000
			+5.025000185699557e+000	+2.999999910819500e+000
			+5.075000059195514e+000	+2.999999704432420e+000 ...
			];
			x_crack.terminatedprop(2,1)=1;
			x_crack.terminatedprop(2,2)=1;
			%}
			%end of for testing only
		elseif CasetoRun==165
			x_crack.npaths=1;
			x_crack.nparticles(1)=2;
			x_crack.center(1,1,1)=4.9;
			x_crack.center(1,2,1)=3;
			x_crack.center(2,1,1)=5.1;
			x_crack.center(2,2,1)=3;
			%x_crack.terminatedprop(1,1)=1;
			%x_crack.terminatedprop(1,2)=1;
			%start of for testing only
			x_crack.npaths=2;
			x_crack.nparticles(2)=22;
			x_crack.center(1:22,1:2,2)=[ ...
				+3.091765351281428e+000	+3.022806922837118e+000
				+3.185843691102719e+000	+3.007989220718556e+000
				+3.280977884646035e+000	+3.003541389201554e+000
				+3.376195649669847e+000	+3.001575602330670e+000
				+3.471429631288700e+000	+3.000701515846796e+000
				+3.566666812176795e+000	+3.000309518596676e+000
				+3.661904675242100e+000	+3.000135578982751e+000
				+3.757142679368846e+000	+3.000059419167263e+000
				+3.852380722826116e+000	+3.000026428069705e+000
				+3.947618807704730e+000	+3.000011979863817e+000
				+4.042856908329258e+000	+3.000005392529500e+000
				+4.138094987221649e+000	+3.000003264944478e+000
				+4.233333045219497e+000	+3.000001493655222e+000
				+4.328571099602669e+000	+3.000000882780074e+000
				+4.423809154429415e+000	+3.000000394093565e+000
				+4.519047214425030e+000	+2.999999786064010e+000
				+4.614285281001976e+000	+2.999999901102053e+000
				+4.709523365084847e+000	+3.000000081099648e+000
				+4.804761470287792e+000	+3.000000424946622e+000
				+4.899999560750276e+000	+3.000000000002859e+000
				+5.099999730741565e+000	+3.000000000001138e+000
				+5.299999999999999e+000	+3.000000000000000e+000 ...
				];
			x_crack.terminatedprop(2,1)=0;
			x_crack.terminatedprop(2,2)=0;
			%end of for testing only
		elseif CasetoRun==151
			x_crack_unused=cell(1,2);
			%x_crack=coder.nullcopy(x_crack_unused);
			x_crack.npaths=2;
			x_crack.nparticles(1:2)=2;
			%x_crack.center=zeros(2,2,10);
			%x_crack.top=zeros(2,2,10);
			%x_crack.bot=zeros(2,2,10);
			
			x_crack_temp=[6 3;4.5 3]*le_base+[2 0;0 0]*le(1)+[pi pi;pi pi]/50;
			x_crack.center(1,1,1)=x_crack_temp(1,1);
			x_crack.center(1,2,1)=x_crack_temp(1,2);
			x_crack.center(2,1,1)=x_crack_temp(2,1);
			x_crack.center(2,2,1)=x_crack_temp(2,2);
			
			x_crack_temp=[3+0.5*cos(pi/2) 3+0.5*sin(pi/2);3-0.5*cos(pi/2) 3-0.5*sin(pi/2)]*le_base;
			x_crack.center(1,1,2)=x_crack_temp(1,1);
			x_crack.center(1,2,2)=x_crack_temp(1,2);
			x_crack.center(2,1,2)=x_crack_temp(2,1);
			x_crack.center(2,2,2)=x_crack_temp(2,2);
		elseif CasetoRun==125 || CasetoRun==126
			x_crack_unused=cell(1,2);
			x_crack.npaths=1;
			x_crack.nparticles(1)=2;
			
			x_crack_temp=[6 3;4.5 3]*le_base+[2 0;0 0]*le(1)+[pi pi;pi pi]/50;
			x_crack.center(1,1,1)=x_crack_temp(1,1);
			x_crack.center(1,2,1)=x_crack_temp(1,2);
			x_crack.center(2,1,1)=x_crack_temp(2,1);
			x_crack.center(2,2,1)=x_crack_temp(2,2);
		elseif CasetoRun==127
			x_crack_unused=cell(1,2);
			x_crack.npaths=1;
			x_crack.nparticles(1)=2;
			
			x_crack_temp=[6 3;4.5 3]*le_base+[2 0;0 0]*le(1)+[pi 0;pi 0]/50;
			x_crack.center(1,1,1)=x_crack_temp(1,1);
			x_crack.center(1,2,1)=x_crack_temp(1,2);
			x_crack.center(2,1,1)=x_crack_temp(2,1);
			x_crack.center(2,2,1)=x_crack_temp(2,2);
		elseif CasetoRun==128
			x_crack_unused=cell(1,2);
			x_crack.npaths=1;
			x_crack.nparticles(1)=2;
			
			x_crack_temp=[6 3;4.5 3]*le_base+[2 0;0 0]*le(1)+[1 0;1 0]*le_base/4-[pi 0;pi 0]/50;
			x_crack.center(1,1,1)=x_crack_temp(1,1);
			x_crack.center(1,2,1)=x_crack_temp(1,2);
			x_crack.center(2,1,1)=x_crack_temp(2,1);
			x_crack.center(2,2,1)=x_crack_temp(2,2);
		elseif CasetoRun==129 || CasetoRun==132
			x_crack_unused=cell(1,2);
			x_crack.npaths=1;
			x_crack.nparticles(1)=2;
			
			x_crack_temp=[6 3;4.5 3]*le_base+[2 0;0 0]*le(1)+[pi 0;pi 0]/50+[0 1;0 1]*le_base/8;
			x_crack.center(1,1,1)=x_crack_temp(1,1);
			x_crack.center(1,2,1)=x_crack_temp(1,2);
			x_crack.center(2,1,1)=x_crack_temp(2,1);
			x_crack.center(2,2,1)=x_crack_temp(2,2);
		elseif CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142
			x_crack_unused=cell(1,2);
			x_crack.npaths=1;
			x_crack.nparticles(1)=2;
			
			x_crack_temp=[10 3;4.5 3]*le_base+[2 0;0 0]*le(1)+[pi 0;pi 0]/50+[0 1;0 1]*le_base/8;
			x_crack.center(1,1,1)=x_crack_temp(1,1);
			x_crack.center(1,2,1)=x_crack_temp(1,2);
			x_crack.center(2,1,1)=x_crack_temp(2,1);
			x_crack.center(2,2,1)=x_crack_temp(2,2);
		elseif CasetoRun==130
			x_crack_unused=cell(1,2);
			x_crack.npaths=1;
			x_crack.nparticles(1)=2;
			
			x_crack_temp=[6 3;4.5 3]*le_base+[2 0;0 0]*le(1)+[1 0;1 0]*le_base/4-[pi 0;pi 0]/50+[0 1;0 1]*le_base/8;
			x_crack.center(1,1,1)=x_crack_temp(1,1);
			x_crack.center(1,2,1)=x_crack_temp(1,2);
			x_crack.center(2,1,1)=x_crack_temp(2,1);
			x_crack.center(2,2,1)=x_crack_temp(2,2);
		end
		%{
		if CasetoRun==117
			x_crack{1}=[0.5 3;
						3-pi*1e-5 3-pi*1e-5;
				3-pi*1e-5+2.5 3]*le_base;
		end
		x_defaultcracktip=[3 3]*le_base;
		%}
		
		for i=1:size(x_crack.center,1)
			for j=1:size(x_crack.center,2)
				for k=1:size(x_crack.center,3)
					x_crack.top(i,j,k)=x_crack.center(i,j,k);
					x_crack.bot(i,j,k)=x_crack.center(i,j,k);
				end
			end
		end
				
		%x_crack.top=x_crack.center;
		%x_crack.bot=x_crack.center;
		
		steelstrength=25; %MPa
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial<y_end
					else
						continue;
					end
				else
					continue;
				end
				
				if CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==166
					if x_trial>5*le_base
						if y_trial>3*le_base-le(1)
							if y_trial<3*le_base+le(1)
								continue;
							end
						end
					end
				elseif CasetoRun==169
					if x_trial>4.5*le_base || x_trial<2.5*le_base
						if y_trial>3.5*le_base-le(1)
							if y_trial<3.5*le_base+le(1)
								continue;
							end
						end
					end
				elseif CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==178 || CasetoRun==188 || CasetoRun==191 || CasetoRun==189
				elseif CasetoRun==179
					if y_trial>3*le_base && y_trial<4*le_base && (x_trial<2.5*le_base || x_trial>3.5*le_base)
						continue;
					end
				elseif CasetoRun==167 || CasetoRun==176 || CasetoRun==187
					if x_trial>4.5*le_base
						if y_trial>3.5*le_base-le(1)
							if y_trial<3.5*le_base+le(1)
								continue;
							end
						end
					end
				elseif CasetoRun==190
					if x_trial>4.5*le_base || x_trial<2.5*le_base
						if y_trial>3.5*le_base-le(1)
							if y_trial<3.5*le_base+le(1)
								continue;
							end
						end
					end
				elseif CasetoRun==165
					if x_trial>5*le_base
						if y_trial>3*le_base-1.5*le(1)
							if y_trial<3*le_base+1.5*le(1)
								continue;
							end
						end
					end
				end
				
				sp=sp+1;
				
				if x_trial>4*le_base-lp(1)
					if y_trial>4*le_base-lp(2)
						tractionedcorner_counter=tractionedcorner_counter+1;
						normalcorner_counter=normalcorner_counter+1;
					elseif y_trial<2*le_base+lp(2)
						tractionedcorner_counter=tractionedcorner_counter+1;
						normalcorner_counter=normalcorner_counter+1;
					else
						tractionededge_counter=tractionededge_counter+1;
						normaledge_counter=normaledge_counter+1;
					end
				elseif y_trial>4*le_base-lp(2)
					tractionededge_counter=tractionededge_counter+1;
					normaledge_counter=normaledge_counter+1;
				elseif y_trial<2*le_base+lp(2)
					tractionededge_counter=tractionededge_counter+1;
					normaledge_counter=normaledge_counter+1;
				end
				
				%if x_trial<6*le_base && x_trial>(6*le_base-lp(1)) && y_trial>13*le_base && y_trial<13*le_base+lp(2);
				%	ParticleswithPredYVel(1)=sp;
				%end
				%if x_trial<6*le_base && x_trial>(6*le_base-lp(1)) && y_trial<7*le_base && y_trial>7*le_base-lp(2);
				%	ParticleswithPredYVel(2)=sp;
				%end
			end
		end
		spCount=sp;
		
		thetacrackrtl=zeros(1,spCount);
		xdirletter_unused=cell(1,spCount);
		ydirletter_unused=cell(1,spCount);
		zdirletter_unused=cell(1,spCount);
		xydirletter_unused=cell(1,spCount);
		yzdirletter_unused=cell(1,spCount);
		xzdirletter_unused=cell(1,spCount);
		
		xdirletter=coder.nullcopy(xdirletter_unused);
		ydirletter=coder.nullcopy(ydirletter_unused);
		zdirletter=coder.nullcopy(zdirletter_unused);
		xydirletter=coder.nullcopy(xydirletter_unused);
		yzdirletter=coder.nullcopy(yzdirletter_unused);
		xzdirletter=coder.nullcopy(xzdirletter_unused);
		
		x_sp=zeros(spCount,2);
		r1_sp=zeros(spCount,2);
		r2_sp=zeros(spCount,2);
		
		matmodel=zeros(1,spCount);
		uncrackable_sp=zeros(1,spCount);
		orientationoffset=zeros(1,spCount);
		plotignore=zeros(1,spCount);
		tractionedcorner=zeros(1,spCount);
		p_sp=zeros(spCount,1); %it's a vertical vector
		weakeningfactor_sp=zeros(1,spCount);
		pforce_sp=zeros(spCount,2);
		alphahp=zeros(spCount,7);
		
		epsilonshrinkdot_sp=zeros(1,spCount);
		epsilonshrinkdotx_sp=zeros(1,spCount);
		epsilonshrinkdoty_sp=zeros(1,spCount);

		tractionedcorner=zeros(1,tractionedcorner_counter);
		normalcorner=cell(1,normalcorner_counter);
		tractionededge=zeros(1,tractionededge_counter);
		normaledge=zeros(normaledge_counter,2);
		
		
		tractionedcorner_counter=0;
		normalcorner_counter=0;
		tractionededge_counter=0;
		normaledge_counter=0;
		
		sp=0;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial<y_end
					else
						continue;
					end
				else
					continue;
				end
				
				if CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==166
					if x_trial>5*le_base
						if y_trial>3*le_base-le(1)
							if y_trial<3*le_base+le(1)
								continue;
							end
						end
					end
				elseif CasetoRun==169
					if x_trial>4.5*le_base || x_trial<2.5*le_base
						if y_trial>3.5*le_base-le(1)
							if y_trial<3.5*le_base+le(1)
								continue;
							end
						end
					end
				elseif CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==178 || CasetoRun==188 || CasetoRun==191 || CasetoRun==189
				elseif CasetoRun==179
					if y_trial>3*le_base && y_trial<4*le_base && (x_trial<2.5*le_base || x_trial>3.5*le_base)
						continue;
					end
				elseif CasetoRun==167 || CasetoRun==176 || CasetoRun==187
					if x_trial>4.5*le_base
						if y_trial>3.5*le_base-le(1)
							if y_trial<3.5*le_base+le(1)
								continue;
							end
						end
					end
				elseif CasetoRun==190
					if x_trial>4.5*le_base || x_trial<2.5*le_base
						if y_trial>3.5*le_base-le(1)
							if y_trial<3.5*le_base+le(1)
								continue;
							end
						end
					end
				elseif CasetoRun==165
					if x_trial>5*le_base
						if y_trial>3*le_base-1.5*le(1)
							if y_trial<3*le_base+1.5*le(1)
								continue;
							end
						end
					end
				end
				
				sp=sp+1;
				thetacrackrtl(sp)=NaN;
				xdirletter{sp}='t';
				ydirletter{sp}='r';
				zdirletter{sp}='l';
				xydirletter{sp}='tr';
				yzdirletter{sp}='rl';
				xzdirletter{sp}='tl';
				if CasetoRun==179
					xdirletter{sp}='l';
					ydirletter{sp}='t';
					zdirletter{sp}='r';
					xydirletter{sp}='tl';
					yzdirletter{sp}='rt';
					xzdirletter{sp}='lr';
				end
				x_sp(sp,1)=x_trial;
				x_sp(sp,2)=y_trial;
				matmodel(sp)=4; %crackable elastic
				if CasetoRun==176
					matmodel(sp)=1;
				end
				orientationoffset(sp)=NaN;
				if CasetoRun==179
					matmodel(sp)=1;
					orientationoffset(sp)=0;
				end
				plotignore(sp)=0;
				
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				weakeningfactor_sp(sp)=0;
				if CasetoRun==188 || CasetoRun==191 || CasetoRun==190 || CasetoRun==187
					if y_trial<2.375*le_base
						uncrackable_sp(sp)=1;
					elseif y_trial>4.875*le_base
						uncrackable_sp(sp)=1;
					end
				end
				
				if x_trial>4*le_base-lp(1)
					if y_trial>4*le_base-lp(2)
						tractionedcorner_counter=tractionedcorner_counter+1;
						tractionedcorner(tractionedcorner_counter)=sp;
						normalcorner_counter=normalcorner_counter+1;
						normalcorner{normalcorner_counter}=[1 0;
																0 1];
					elseif y_trial<2*le_base+lp(2)
						tractionedcorner_counter=tractionedcorner_counter+1;
						tractionedcorner(tractionedcorner_counter)=sp;
						normalcorner_counter=normalcorner_counter+1;
						normalcorner{normalcorner_counter}=[1 0;
																0 -1];
					else
						tractionededge_counter=tractionededge_counter+1;
						tractionededge(tractionededge_counter)=sp;
						normaledge_counter=normaledge_counter+1;
						normaledge(normaledge_counter,1)=1;
						normaledge(normaledge_counter,2)=0;
					end
				elseif y_trial>4*le_base-lp(2)
					tractionededge_counter=tractionededge_counter+1;
					tractionededge(tractionededge_counter)=sp;
					normaledge_counter=normaledge_counter+1;
					normaledge(normaledge_counter,1)=0;
					normaledge(normaledge_counter,2)=1;
				elseif y_trial<2*le_base+lp(2)
					tractionededge_counter=tractionededge_counter+1;
					tractionededge(tractionededge_counter)=sp;
					normaledge_counter=normaledge_counter+1;
					normaledge(normaledge_counter,1)=0;
					normaledge(normaledge_counter,2)=-1;
				end
				
				%if x_trial<6*le_base && x_trial>(6*le_base-lp(1)) && y_trial>13*le_base && y_trial<13*le_base+lp(2);
				%	ParticleswithPredYVel(1)=sp;
				%end
				%if x_trial<6*le_base && x_trial>(6*le_base-lp(1)) && y_trial<7*le_base && y_trial>7*le_base-lp(2);
				%	ParticleswithPredYVel(2)=sp;
				%end
			end
		end
		1;
	elseif CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==147 || CasetoRun==145
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction
		
		tractionedcorner_counter=0; %size reference
		normalcorner_counter=0; %size reference
		tractionededge_counter=0; %size reference
		normaledge_counter=0; %size reference
		
		pforce_sp_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=3*le_base;
		x_end=12*le_base;
		y_start=2*le_base;
		y_end=5*le_base;
		
		if CasetoRun==144
			x_crack.npaths=1;
			x_crack.nparticles(1)=13;
			
			x_crack_temp=[7.5 0.5;
							7.5 1;
							7.5 1.5;
							7.5 2;
							7.5 2.5;
							7.5 3;
							7.5 3.5;
							7.5 4;
							7.5 4.5;
							7.5 5;
							7.5 5.5;
							7.5 6;
							7.5 6.5]*le_base;
							
			ipath=1;
			for iparticle=1:x_crack.nparticles(ipath);
				for dim=1:2
					x_crack.center(iparticle,dim,ipath)=x_crack_temp(iparticle,dim);
				end
			end
		elseif CasetoRun==148
			x_crack.npaths=1;
			x_crack.nparticles(1)=13;
			
			x_crack_temp=[7.125 0.5;
							7.125 1;
							7.125 1.5;
							7.125 2;
							7.125 2.5;
							7.125 3;
							7.125 3.5;
							7.125 4;
							7.125 4.5;
							7.125 5;
							7.125 5.5;
							7.125 6;
							7.125 6.5]*le_base;
							
			ipath=1;
			for iparticle=1:x_crack.nparticles(ipath);
				for dim=1:2
					x_crack.center(iparticle,dim,ipath)=x_crack_temp(iparticle,dim);
				end
			end
		elseif CasetoRun==146
			x_crack.npaths=1;
			x_crack.nparticles(1)=13;
			
			x_crack_temp=[5.5 0.5;
							5.5 1;
							5.5 1.5;
							5.5 2;
							5.5 2.5;
							5.5 3;
							5.5 3.5;
							5.5 4;
							5.5 4.5;
							5.5 5;
							5.5 5.5;
							5.5 6;
							5.5 6.5]*le_base;
		
			ipath=1;
			for iparticle=1:x_crack.nparticles(ipath);
				for dim=1:2
					x_crack.center(iparticle,dim,ipath)=x_crack_temp(iparticle,dim);
				end
			end
		elseif CasetoRun==149
			x_crack.npaths=1;
			x_crack.nparticles(1)=2;
			x_crack_temp=[5.5 0.5;
							5.5 1]*le_base;
		
			ipath=1;
			for iparticle=1:x_crack.nparticles(ipath);
				for dim=1:2
					x_crack.center(iparticle,dim,ipath)=x_crack_temp(iparticle,dim);
				end
			end
		elseif CasetoRun==147
		
			x_crack.npaths=1;
			x_crack.nparticles(1)=13;
			
			x_crack_temp=[9.5 0.5;
							9.5 1;
							9.5 1.5;
							9.5 2;
							9.5 2.5;
							9.5 3;
							9.5 3.5;
							9.5 4;
							9.5 4.5;
							9.5 5;
							9.5 5.5;
							9.5 6;
							9.5 6.5]*le_base;
		
			ipath=1;
			for iparticle=1:x_crack.nparticles(ipath);
				for dim=1:2
					x_crack.center(iparticle,dim,ipath)=x_crack_temp(iparticle,dim);
				end
			end
		elseif CasetoRun==145
			x_crack.npaths=2;
			x_crack.nparticles(1)=13;
			x_crack.nparticles(2)=13;
			
			ipath=1;
			x_crack_temp=[6.5 0.5;
							6.5 1;
							6.5 1.5;
							6.5 2;
							6.5 2.5;
							6.5 3;
							6.5 3.5;
							6.5 4;
							6.5 4.5;
							6.5 5;
							6.5 5.5;
							6.5 6;
							6.5 6.5]*le_base;
			for iparticle=1:x_crack.nparticles(ipath);
				for dim=1:2
					x_crack.center(iparticle,dim,ipath)=x_crack_temp(iparticle,dim);
				end
			end
			
			ipath=2;
			x_crack_temp=[7.5 0.5;
							7.5 1;
							7.5 1.5;
							7.5 2;
							7.5 2.5;
							7.5 3;
							7.5 3.5;
							7.5 4;
							7.5 4.5;
							7.5 5;
							7.5 5.5;
							7.5 6;
							7.5 6.5]*le_base;
			for iparticle=1:x_crack.nparticles(ipath);
				for dim=1:2
					x_crack.center(iparticle,dim,ipath)=x_crack_temp(iparticle,dim);
				end
			end
		end
		
		
		for i=1:size(x_crack.center,1)
			for j=1:size(x_crack.center,2)
				for k=1:size(x_crack.center,3)
					x_crack.top(i,j,k)=x_crack.center(i,j,k);
					x_crack.bot(i,j,k)=x_crack.center(i,j,k);
				end
			end
		end
		
		steelstrength=25; %MPa
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial<y_end
					else
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
			end
		end
		spCount=sp;
		
		thetacrackrtl=zeros(1,spCount);
		xdirletter_unused=cell(1,spCount);
		ydirletter_unused=cell(1,spCount);
		zdirletter_unused=cell(1,spCount);
		xydirletter_unused=cell(1,spCount);
		yzdirletter_unused=cell(1,spCount);
		xzdirletter_unused=cell(1,spCount);
		
		xdirletter=coder.nullcopy(xdirletter_unused);
		ydirletter=coder.nullcopy(ydirletter_unused);
		zdirletter=coder.nullcopy(zdirletter_unused);
		xydirletter=coder.nullcopy(xydirletter_unused);
		yzdirletter=coder.nullcopy(yzdirletter_unused);
		xzdirletter=coder.nullcopy(xzdirletter_unused);
		
		x_sp=zeros(spCount,2);
		r1_sp=zeros(spCount,2);
		r2_sp=zeros(spCount,2);

		matmodel=zeros(1,spCount);
		orientationoffset=zeros(1,spCount);
		plotignore=zeros(1,spCount);
		tractionedcorner=zeros(1,spCount);
		p_sp=zeros(spCount,1); %it's a vertical vector
		weakeningfactor_sp=zeros(1,spCount);
		pforce_sp=zeros(spCount,2);
		alphahp=zeros(spCount,7);
		
		epsilonshrinkdot_sp=zeros(1,spCount);
		epsilonshrinkdotx_sp=zeros(1,spCount);
		epsilonshrinkdoty_sp=zeros(1,spCount);

		tractionedcorner=zeros(1,tractionedcorner_counter);
		normalcorner=cell(1,normalcorner_counter);
		tractionededge=zeros(1,tractionededge_counter);
		normaledge=zeros(normaledge_counter,2);
		
		
		tractionedcorner_counter=0;
		normalcorner_counter=0;
		tractionededge_counter=0;
		normaledge_counter=0;
		
		sp=0;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial<y_end
					else
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl(sp)=NaN;
				xdirletter{sp}='t';
				ydirletter{sp}='r';
				zdirletter{sp}='l';
				xydirletter{sp}='tr';
				yzdirletter{sp}='rl';
				xzdirletter{sp}='tl';
				x_sp(sp,1)=x_trial;
				x_sp(sp,2)=y_trial;
				matmodel(sp)=4; %crackable elastic
				orientationoffset(sp)=NaN;
				plotignore(sp)=0;
				
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				weakeningfactor_sp(sp)=0;
				
			end
		end
		1;
	elseif CasetoRun==153
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction
		
		tractionedcorner_counter=0; %size reference
		normalcorner_counter=0; %size reference
		tractionededge_counter=0; %size reference
		normaledge_counter=0; %size reference
		
		pforce_sp_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_center=7*le_base;
		y_center=7*le_base;
		r_donut_internal=1*le_base;
		r_donut_external=1.5*le_base;
		r_donut_uncrackable=1.5*le_base;
		
		x_crack.npaths=8;
		r_crack_internal=5.5*le_base;
		r_crack_external=6*le_base;
		
		for ipath=1:x_crack.npaths
			x_crack.nparticles(ipath)=9;
			theta=2*pi*(0.5+ipath)/x_crack.npaths;
			for iparticle=1:x_crack.nparticles(ipath)
				r_crack=r_crack_internal+(r_crack_external-r_crack_internal)/(x_crack.nparticles(ipath)-1)*(iparticle-1);
				x_crack.center(iparticle,1,ipath)=x_center+r_crack*cos(theta);
				x_crack.center(iparticle,2,ipath)=y_center+r_crack*sin(theta);
			end
		end
		
		for i=1:size(x_crack.center,1)
			for j=1:size(x_crack.center,2)
				for k=1:size(x_crack.center,3)
					x_crack.top(i,j,k)=x_crack.center(i,j,k);
					x_crack.bot(i,j,k)=x_crack.center(i,j,k);
				end
			end
		end
		
		steelstrength=25; %MPa
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				delta_x_trial=[x_trial-x_center y_trial-y_center];
				r_trial=sqrt(dot(delta_x_trial,delta_x_trial));
				if r_trial<r_donut_internal
					continue;
				elseif r_trial>r_donut_external
					continue;
				end
				sp=sp+1;
			end
		end
		spCount=sp;
		
		thetacrackrtl=zeros(1,spCount);
		xdirletter_unused=cell(1,spCount);
		ydirletter_unused=cell(1,spCount);
		zdirletter_unused=cell(1,spCount);
		xydirletter_unused=cell(1,spCount);
		yzdirletter_unused=cell(1,spCount);
		xzdirletter_unused=cell(1,spCount);
		
		xdirletter=coder.nullcopy(xdirletter_unused);
		ydirletter=coder.nullcopy(ydirletter_unused);
		zdirletter=coder.nullcopy(zdirletter_unused);
		xydirletter=coder.nullcopy(xydirletter_unused);
		yzdirletter=coder.nullcopy(yzdirletter_unused);
		xzdirletter=coder.nullcopy(xzdirletter_unused);
		
		x_sp=zeros(spCount,2);
		r1_sp=zeros(spCount,2);
		r2_sp=zeros(spCount,2);

		matmodel=zeros(1,spCount);
		orientationoffset=zeros(1,spCount);
		plotignore=zeros(1,spCount);
		tractionedcorner=zeros(1,spCount);
		p_sp=zeros(spCount,1); %it's a vertical vector
		weakeningfactor_sp=zeros(1,spCount);
		pforce_sp=zeros(spCount,2);
		r_adjustor=zeros(1,spCount);
		alphahp=zeros(spCount,7);
		uncrackable_sp=zeros(1,spCount);
		
		epsilonshrinkdot_sp=zeros(1,spCount);
		epsilonshrinkdotx_sp=zeros(1,spCount);
		epsilonshrinkdoty_sp=zeros(1,spCount);

		tractionedcorner=zeros(1,tractionedcorner_counter);
		normalcorner=cell(1,normalcorner_counter);
		tractionededge=zeros(1,tractionededge_counter);
		normaledge=zeros(normaledge_counter,2);
		
		
		tractionedcorner_counter=0;
		normalcorner_counter=0;
		tractionededge_counter=0;
		normaledge_counter=0;
		
		sp=0;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				delta_x_trial=[x_trial-x_center y_trial-y_center];
				r_trial=sqrt(dot(delta_x_trial,delta_x_trial));
				if r_trial<r_donut_internal
					continue;
				elseif r_trial>r_donut_external
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl(sp)=NaN;
				xdirletter{sp}='t';
				ydirletter{sp}='r';
				zdirletter{sp}='l';
				xydirletter{sp}='tr';
				yzdirletter{sp}='rl';
				xzdirletter{sp}='tl';
				x_sp(sp,1)=x_trial;
				x_sp(sp,2)=y_trial;
				matmodel(sp)=4; %crackable elastic
				orientationoffset(sp)=NaN;
				plotignore(sp)=0;
				
				
				uncrackable_sp(sp)=0;
				if r_trial<r_donut_uncrackable
					uncrackable_sp(sp)=1;
					r_adjustor(sp)=1*le_base-r_trial;
				end
				
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				weakeningfactor_sp(sp)=0;
				
			end
		end
		1;
	elseif CasetoRun==154 || CasetoRun==161
		%vortex initiate
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction
		
		tractionedcorner_counter=0; %size reference
		normalcorner_counter=0; %size reference
		tractionededge_counter=0; %size reference
		normaledge_counter=0; %size reference
		
		center=4;
		x_center=center;
		y_center=center;
		resolution=refinementfactor;
		% Ring distribution
		nPar1                   = 45* resolution;
		nPar2                   = 4 * resolution;
		spCount                 = nPar1*nPar2;
		x_sp                    = zeros(spCount,2);
		A_sp                    = zeros(spCount,1);
		r1_sp                   = zeros(spCount,2);
		r2_sp                   = zeros(spCount,2);
		v_ssp_0=zeros(spCount,2);
		pforce_sp=zeros(spCount,2);
		% Ring distribution
		for i = 1:nPar1
			ttemp=(i-0.5)*2*pi/nPar1;
			for j = 1:nPar2
				rtemp=0.75+(j-0.5)*0.5/nPar2;
				x_sp((i-1)*nPar2+j,:)=[center+rtemp*cos(ttemp) center+rtemp*sin(ttemp)];
				A_sp((i-1)*nPar2+j)=0.5/nPar2*2*pi/nPar1*rtemp;
				r1_sp((i-1)*nPar2+j,:)=1*pi/nPar1*rtemp*[sin(ttemp) -cos(ttemp)];
				r2_sp((i-1)*nPar2+j,:)=0.25/nPar2*[cos(ttemp) sin(ttemp)];
			end
		end
		x_spo=x_sp;
		for sp=1:spCount
			R_sp                = sqrt((x_spo(sp,1)-center)^2 + (x_spo(sp,2)-center)^2);
			theta               = atan2((x_spo(sp,2)-center),(x_spo(sp,1)-center));
			Constant            = 1 - 32 * (R_sp-1)^2 + 256 * (R_sp-1)^4;
			alpha               = A * sin(C*pi*t_time) * Constant;
			alfap               = A^2 * C * pi * Constant;
			v_ssp_0(sp,1)         = alfap * (-sin(alpha)*(x_spo(sp,1)-center) - cos(alpha)*(x_spo(sp,2)-center));
			v_ssp_0(sp,2)         = alfap * (cos(alpha)*(x_spo(sp,1)-center) - sin(alpha)*(x_spo(sp,2)-center));
		end
		
		pforce_sp_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		
		x_crack.npaths=1;
		r_crack_internal=7.5*le_base;
		r_crack_external=8*le_base;
		%{
		for ipath=1:x_crack.npaths
			x_crack.nparticles(ipath)=9;
			theta=2*pi*(0.5+ipath)/x_crack.npaths;
			for iparticle=1:x_crack.nparticles(ipath)
				r_crack=r_crack_internal+(r_crack_external-r_crack_internal)/(x_crack.nparticles(ipath)-1)*(iparticle-1);
				x_crack.center(iparticle,1,ipath)=x_center+r_crack*cos(theta);
				x_crack.center(iparticle,2,ipath)=y_center+r_crack*sin(theta);
			end
		end
		%}
		x_crack.nparticles(1)=2;
		x_crack.center(1,1,1)=0.1;
		x_crack.center(1,2,1)=0.1;
		x_crack.center(2,1,1)=0.1;
		x_crack.center(2,2,1)=0.11;

		for i=1:size(x_crack.center,1)
			for j=1:size(x_crack.center,2)
				for k=1:size(x_crack.center,3)
					x_crack.top(i,j,k)=x_crack.center(i,j,k);
					x_crack.bot(i,j,k)=x_crack.center(i,j,k);
				end
			end
		end
		
		steelstrength=25; %MPa
		
		thetacrackrtl=zeros(1,spCount);
		xdirletter_unused=cell(1,spCount);
		ydirletter_unused=cell(1,spCount);
		zdirletter_unused=cell(1,spCount);
		xydirletter_unused=cell(1,spCount);
		yzdirletter_unused=cell(1,spCount);
		xzdirletter_unused=cell(1,spCount);
		
		xdirletter=coder.nullcopy(xdirletter_unused);
		ydirletter=coder.nullcopy(ydirletter_unused);
		zdirletter=coder.nullcopy(zdirletter_unused);
		xydirletter=coder.nullcopy(xydirletter_unused);
		yzdirletter=coder.nullcopy(yzdirletter_unused);
		xzdirletter=coder.nullcopy(xzdirletter_unused);
		
		
		matmodel=zeros(1,spCount);
		orientationoffset=zeros(1,spCount);
		plotignore=zeros(1,spCount);
		tractionedcorner=zeros(1,spCount);
		p_sp=zeros(spCount,1); %it's a vertical vector
		weakeningfactor_sp=zeros(1,spCount);
		pforce_sp=zeros(spCount,2);
		r_adjustor=zeros(1,spCount);
		alphahp=zeros(spCount,7);
		uncrackable_sp=zeros(1,spCount);
		
		epsilonshrinkdot_sp=zeros(1,spCount);
		epsilonshrinkdotx_sp=zeros(1,spCount);
		epsilonshrinkdoty_sp=zeros(1,spCount);

		tractionedcorner=zeros(1,tractionedcorner_counter);
		normalcorner=cell(1,normalcorner_counter);
		tractionededge=zeros(1,tractionededge_counter);
		normaledge=zeros(normaledge_counter,2);
		
		
		tractionedcorner_counter=0;
		normalcorner_counter=0;
		tractionededge_counter=0;
		normaledge_counter=0;
		
		sp=0;
		
		for isp=1:spCount
			thetacrackrtl(isp)=NaN;
			xdirletter{isp}='t';
			ydirletter{isp}='r';
			zdirletter{isp}='l';
			xydirletter{isp}='tr';
			yzdirletter{isp}='rl';
			xzdirletter{isp}='tl';
			%matmodel(isp)=4; %crackable elastic
			matmodel(isp)=6; %hyperelastic
			orientationoffset(isp)=NaN;
			plotignore(isp)=0;
			
			uncrackable_sp(isp)=0;
			
			p_sp=MatrixInsertion(p_sp,isp,1,psp);
			weakeningfactor_sp(isp)=0;
		end
		sp=spCount;
		1;
	elseif CasetoRun==150 || CasetoRun==152
		
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction
		
		tractionedcorner_counter=0; %size reference
		normalcorner_counter=0; %size reference
		tractionededge_counter=0; %size reference
		normaledge_counter=0; %size reference
		
		pforce_sp_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_center=7*le_base;
		y_center=7*le_base;
		r_donut_internal=1*le_base;
		r_donut_external=3*le_base;
		r_donut_uncrackable=2*le_base;
		
		x_crack.npaths=8;
		r_crack_internal=2.5*le_base;
		r_crack_external=r_donut_external+le(1)/2;
		r_crack_far=6*le_base;
		
		for ipath=1:x_crack.npaths
			x_crack.nparticles(ipath)=3;
			theta=2*pi*(0.5+ipath)/x_crack.npaths;
			for iparticle=1:x_crack.nparticles(ipath)
				r_crack=r_crack_internal+(r_crack_external-r_crack_internal)/(x_crack.nparticles(ipath)-1)*(iparticle-1);
				x_crack.center(iparticle,1,ipath)=x_center+r_crack*cos(theta);
				x_crack.center(iparticle,2,ipath)=y_center+r_crack*sin(theta);
			end
			x_crack.nparticles(ipath)=x_crack.nparticles(ipath)+1;
			r_crack=r_crack_far;
			x_crack.center(x_crack.nparticles(ipath),1,ipath)=x_center+r_crack*cos(theta);
			x_crack.center(x_crack.nparticles(ipath),2,ipath)=y_center+r_crack*sin(theta);
			
			x_crack.nparticles(ipath)=x_crack.nparticles(ipath)+1;
			r_crack=r_crack_far+0.1*le_base;
			x_crack.center(x_crack.nparticles(ipath),1,ipath)=x_center+r_crack*cos(theta);
			x_crack.center(x_crack.nparticles(ipath),2,ipath)=y_center+r_crack*sin(theta);
		end
		
		for i=1:size(x_crack.center,1)
			for j=1:size(x_crack.center,2)
				for k=1:size(x_crack.center,3)
					x_crack.top(i,j,k)=x_crack.center(i,j,k);
					x_crack.bot(i,j,k)=x_crack.center(i,j,k);
				end
			end
		end
		
		steelstrength=25; %MPa
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				delta_x_trial=[x_trial-x_center y_trial-y_center];
				r_trial=sqrt(dot(delta_x_trial,delta_x_trial));
				if r_trial<r_donut_internal
					continue;
				elseif r_trial>r_donut_external
					continue;
				end
				sp=sp+1;
			end
		end
		spCount=sp;
		
		thetacrackrtl=zeros(1,spCount);
		xdirletter_unused=cell(1,spCount);
		ydirletter_unused=cell(1,spCount);
		zdirletter_unused=cell(1,spCount);
		xydirletter_unused=cell(1,spCount);
		yzdirletter_unused=cell(1,spCount);
		xzdirletter_unused=cell(1,spCount);
		
		xdirletter=coder.nullcopy(xdirletter_unused);
		ydirletter=coder.nullcopy(ydirletter_unused);
		zdirletter=coder.nullcopy(zdirletter_unused);
		xydirletter=coder.nullcopy(xydirletter_unused);
		yzdirletter=coder.nullcopy(yzdirletter_unused);
		xzdirletter=coder.nullcopy(xzdirletter_unused);
		
		x_sp=zeros(spCount,2);
		r1_sp=zeros(spCount,2);
		r2_sp=zeros(spCount,2);

		matmodel=zeros(1,spCount);
		orientationoffset=zeros(1,spCount);
		plotignore=zeros(1,spCount);
		tractionedcorner=zeros(1,spCount);
		p_sp=zeros(spCount,1); %it's a vertical vector
		weakeningfactor_sp=zeros(1,spCount);
		pforce_sp=zeros(spCount,2);
		r_adjustor=zeros(1,spCount);
		alphahp=zeros(spCount,7);
		uncrackable_sp=zeros(1,spCount);
		deltarideal_sp=zeros(1,spCount);
		deltaractual_sp=zeros(1,spCount);
		
		epsilonshrinkdot_sp=zeros(1,spCount);
		epsilonshrinkdotx_sp=zeros(1,spCount);
		epsilonshrinkdoty_sp=zeros(1,spCount);

		tractionedcorner=zeros(1,tractionedcorner_counter);
		normalcorner=cell(1,normalcorner_counter);
		tractionededge=zeros(1,tractionededge_counter);
		normaledge=zeros(normaledge_counter,2);
		
		
		tractionedcorner_counter=0;
		normalcorner_counter=0;
		tractionededge_counter=0;
		normaledge_counter=0;
		
		sp=0;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				delta_x_trial=[x_trial-x_center y_trial-y_center];
				r_trial=sqrt(dot(delta_x_trial,delta_x_trial));
				if r_trial<r_donut_internal
					continue;
				elseif r_trial>r_donut_external
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl(sp)=NaN;
				xdirletter{sp}='t';
				ydirletter{sp}='r';
				zdirletter{sp}='l';
				xydirletter{sp}='tr';
				yzdirletter{sp}='rl';
				xzdirletter{sp}='tl';
				x_sp(sp,1)=x_trial;
				x_sp(sp,2)=y_trial;
				matmodel(sp)=4; %crackable elastic
				orientationoffset(sp)=NaN;
				plotignore(sp)=0;
				
				
				uncrackable_sp(sp)=0;
				if r_trial<r_donut_uncrackable
					uncrackable_sp(sp)=1;
					r_adjustor(sp)=1*le_base-r_trial;
				end
				
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				weakeningfactor_sp(sp)=0;
				
			end
		end
		1;
	elseif CasetoRun==158
		
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction
		
		tractionedcorner_counter=0; %size reference
		normalcorner_counter=0; %size reference
		tractionededge_counter=0; %size reference
		normaledge_counter=0; %size reference
		
		pforce_sp_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_center=7*le_base;
		y_center=7*le_base;
		r_donut_internal=1*le_base;
		r_donut_external=3*le_base;
		r_donut_innermid=1.5*le_base;
		r_donut_outtermid=2*le_base;
		r_donut_uncrackable=2*le_base;
		
		x_crack.npaths=8;
		%r_crack_internal=2.5*le_base;
		r_crack_internal=2*le_base;
		r_crack_external=r_donut_external-le(1)/2;
		r_crack_far=6*le_base;
		
		for ipath=1:x_crack.npaths
			%x_crack.nparticles(ipath)=3;
			x_crack.nparticles(ipath)=1;
			theta=2*pi*(0.5+ipath)/x_crack.npaths;
			for iparticle=1:x_crack.nparticles(ipath)
				%r_crack=r_crack_internal+(r_crack_external-r_crack_internal)/(x_crack.nparticles(ipath)-1)*(iparticle-1);
				r_crack=r_crack_internal;
				x_crack.center(iparticle,1,ipath)=x_center+r_crack*cos(theta);
				x_crack.center(iparticle,2,ipath)=y_center+r_crack*sin(theta);
			end
			x_crack.nparticles(ipath)=x_crack.nparticles(ipath)+1;
			r_crack=r_crack_far;
			x_crack.center(x_crack.nparticles(ipath),1,ipath)=x_center+r_crack*cos(theta);
			x_crack.center(x_crack.nparticles(ipath),2,ipath)=y_center+r_crack*sin(theta);
			
			x_crack.nparticles(ipath)=x_crack.nparticles(ipath)+1;
			r_crack=r_crack_far+0.1*le_base;
			x_crack.center(x_crack.nparticles(ipath),1,ipath)=x_center+r_crack*cos(theta);
			x_crack.center(x_crack.nparticles(ipath),2,ipath)=y_center+r_crack*sin(theta);
		end
		
		for i=1:size(x_crack.center,1)
			for j=1:size(x_crack.center,2)
				for k=1:size(x_crack.center,3)
					x_crack.top(i,j,k)=x_crack.center(i,j,k);
					x_crack.bot(i,j,k)=x_crack.center(i,j,k);
				end
			end
		end
		
		steelstrength=25; %MPa
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				delta_x_trial=[x_trial-x_center y_trial-y_center];
				r_trial=sqrt(dot(delta_x_trial,delta_x_trial));
				if r_trial<r_donut_internal
					continue;
				elseif r_trial>r_donut_external
					continue;
				end
				sp=sp+1;
			end
		end
		spCount=sp;
		
		thetacrackrtl=zeros(1,spCount);
		xdirletter_unused=cell(1,spCount);
		ydirletter_unused=cell(1,spCount);
		zdirletter_unused=cell(1,spCount);
		xydirletter_unused=cell(1,spCount);
		yzdirletter_unused=cell(1,spCount);
		xzdirletter_unused=cell(1,spCount);
		
		xdirletter=coder.nullcopy(xdirletter_unused);
		ydirletter=coder.nullcopy(ydirletter_unused);
		zdirletter=coder.nullcopy(zdirletter_unused);
		xydirletter=coder.nullcopy(xydirletter_unused);
		yzdirletter=coder.nullcopy(yzdirletter_unused);
		xzdirletter=coder.nullcopy(xzdirletter_unused);
		
		x_sp=zeros(spCount,2);
		r1_sp=zeros(spCount,2);
		r2_sp=zeros(spCount,2);

		matmodel=zeros(1,spCount);
		orientationoffset=zeros(1,spCount);
		plotignore=zeros(1,spCount);
		tractionedcorner=zeros(1,spCount);
		p_sp=zeros(spCount,1); %it's a vertical vector
		weakeningfactor_sp=zeros(1,spCount);
		pforce_sp=zeros(spCount,2);
		pforce_sp_base=zeros(spCount,2);
		r_adjustor=zeros(1,spCount);
		alphahp=zeros(spCount,7);
		uncrackable_sp=zeros(1,spCount);
		deltarideal_sp=zeros(1,spCount);
		deltaractual_sp=zeros(1,spCount);
		E_sp=zeros(1,spCount);
		exploding_sp=zeros(1,spCount);
		
		epsilonshrinkdot_sp=zeros(1,spCount);
		epsilonshrinkdotx_sp=zeros(1,spCount);
		epsilonshrinkdoty_sp=zeros(1,spCount);

		tractionedcorner=zeros(1,tractionedcorner_counter);
		normalcorner=cell(1,normalcorner_counter);
		tractionededge=zeros(1,tractionededge_counter);
		normaledge=zeros(normaledge_counter,2);
		
		
		tractionedcorner_counter=0;
		normalcorner_counter=0;
		tractionededge_counter=0;
		normaledge_counter=0;
		
		sp=0;
		
		stretchmultiplier=2.1; %how much does the donut stretch
		r0_donut=(r_donut_internal+r_donut_uncrackable)/2;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				delta_x_trial=[x_trial-x_center y_trial-y_center];
				r_trial=sqrt(dot(delta_x_trial,delta_x_trial));
				theta_trial=reliableatan(delta_x_trial(1),delta_x_trial(2));
				if r_trial<r_donut_internal
					continue;
				elseif r_trial>r_donut_external
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl(sp)=NaN;
				xdirletter{sp}='t';
				ydirletter{sp}='r';
				zdirletter{sp}='l';
				xydirletter{sp}='tr';
				yzdirletter{sp}='rl';
				xzdirletter{sp}='tl';
				x_sp(sp,1)=x_trial;
				x_sp(sp,2)=y_trial;
				matmodel(sp)=7; %Elastic E_sp
				orientationoffset(sp)=NaN;
				plotignore(sp)=0;
				
				
				uncrackable_sp(sp)=0;
				if r_trial<r_donut_uncrackable
					uncrackable_sp(sp)=1;
					r_adjustor(sp)=1*le_base-r_trial;
					pforce_sp_base(sp,1)=log(stretchmultiplier)*E*lp(1)*lp(2)*t0_plane/r0_donut*cos(theta_trial);
					pforce_sp_base(sp,2)=log(stretchmultiplier)*E*lp(1)*lp(2)*t0_plane/r0_donut*sin(theta_trial);
				end
				%the E_sp definition overrides the global E definition for matmodel=7
				%make sure E global is the highest E_sp value for curan condition calculation
				if r_trial>r_donut_outtermid 
					E_sp(sp)=E;
					p_sp(sp)=psp2;
				elseif r_trial>r_donut_innermid
					E_sp(sp)=E/10;
					p_sp(sp)=psp2;
				else
					E_sp(sp)=E;
					p_sp(sp)=psp2*10;
				end
				
				weakeningfactor_sp(sp)=0;
				
			end
		end
		1;
	elseif CasetoRun==180
		
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction
		
		tractionedcorner_counter=0; %size reference
		normalcorner_counter=0; %size reference
		tractionededge_counter=0; %size reference
		normaledge_counter=0; %size reference
		
		pforce_sp_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_center=7*le_base;
		y_center=7*le_base;
		r_donut_internal=1*le_base;
		r_donut_external=3*le_base;
		r_donut_uncrackable=2*le_base;
		
		x_crack.npaths=8;
		r_crack_internal=2*le_base;
		r_crack_external=r_donut_external-lp(1);
		r_crack_far=6*le_base;
		
		for ipath=1:x_crack.npaths
			%x_crack.nparticles(ipath)=3;
			x_crack.nparticles(ipath)=8;
			theta=2*pi*(0.5+ipath)/x_crack.npaths;
			for iparticle=1:x_crack.nparticles(ipath)
				r_crack=r_crack_internal+(r_crack_external-r_crack_internal)/(x_crack.nparticles(ipath)-1)*(iparticle-1);
				x_crack.center(iparticle,1,ipath)=x_center+r_crack*cos(theta);
				x_crack.center(iparticle,2,ipath)=y_center+r_crack*sin(theta);
			end
			x_crack.nparticles(ipath)=x_crack.nparticles(ipath)+1;
			r_crack=r_donut_external+3*le(1);
			x_crack.center(x_crack.nparticles(ipath),1,ipath)=x_center+r_crack*cos(theta);
			x_crack.center(x_crack.nparticles(ipath),2,ipath)=y_center+r_crack*sin(theta);
			x_crack.terminatedprop(ipath,1)=1;
			x_crack.terminatedprop(ipath,2)=0;
		end
		
		for i=1:size(x_crack.center,1)
			for j=1:size(x_crack.center,2)
				for k=1:size(x_crack.center,3)
					x_crack.top(i,j,k)=x_crack.center(i,j,k);
					x_crack.bot(i,j,k)=x_crack.center(i,j,k);
				end
			end
		end
		
		steelstrength=25; %MPa
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				delta_x_trial=[x_trial-x_center y_trial-y_center];
				r_trial=sqrt(dot(delta_x_trial,delta_x_trial));
				if r_trial<r_donut_internal
					continue;
				elseif r_trial>r_donut_external
					continue;
				end
				sp=sp+1;
			end
		end
		spCount=sp;
		
		thetacrackrtl=zeros(1,spCount);
		xdirletter_unused=cell(1,spCount);
		ydirletter_unused=cell(1,spCount);
		zdirletter_unused=cell(1,spCount);
		xydirletter_unused=cell(1,spCount);
		yzdirletter_unused=cell(1,spCount);
		xzdirletter_unused=cell(1,spCount);
		
		xdirletter=coder.nullcopy(xdirletter_unused);
		ydirletter=coder.nullcopy(ydirletter_unused);
		zdirletter=coder.nullcopy(zdirletter_unused);
		xydirletter=coder.nullcopy(xydirletter_unused);
		yzdirletter=coder.nullcopy(yzdirletter_unused);
		xzdirletter=coder.nullcopy(xzdirletter_unused);
		
		x_sp=zeros(spCount,2);
		r1_sp=zeros(spCount,2);
		r2_sp=zeros(spCount,2);

		matmodel=zeros(1,spCount);
		orientationoffset=zeros(1,spCount);
		plotignore=zeros(1,spCount);
		tractionedcorner=zeros(1,spCount);
		p_sp=zeros(spCount,1); %it's a vertical vector
		weakeningfactor_sp=zeros(1,spCount);
		pforce_sp=zeros(spCount,2);
		pforce_sp_base=zeros(spCount,2);
		r_adjustor=zeros(1,spCount);
		alphahp=zeros(spCount,7);
		uncrackable_sp=zeros(1,spCount);
		deltarideal_sp=zeros(1,spCount);
		deltaractual_sp=zeros(1,spCount);
		
		epsilonshrinkdot_sp=zeros(1,spCount);
		epsilonshrinkdotx_sp=zeros(1,spCount);
		epsilonshrinkdoty_sp=zeros(1,spCount);

		tractionedcorner=zeros(1,tractionedcorner_counter);
		normalcorner=cell(1,normalcorner_counter);
		tractionededge=zeros(1,tractionededge_counter);
		normaledge=zeros(normaledge_counter,2);
		
		
		tractionedcorner_counter=0;
		normalcorner_counter=0;
		tractionededge_counter=0;
		normaledge_counter=0;
		
		sp=0;
		stretchmultiplier=2.1; %to stop coder whining
		stretchmultiplier=1.9; %how much does the donut stretch
		r0_donut=(r_donut_internal+r_donut_uncrackable)/2;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				delta_x_trial=[x_trial-x_center y_trial-y_center];
				r_trial=sqrt(dot(delta_x_trial,delta_x_trial));
				theta_trial=reliableatan(delta_x_trial(1),delta_x_trial(2));
				if r_trial<r_donut_internal
					continue;
				elseif r_trial>r_donut_external
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl(sp)=NaN;
				xdirletter{sp}='t';
				ydirletter{sp}='r';
				zdirletter{sp}='l';
				xydirletter{sp}='tr';
				yzdirletter{sp}='rl';
				xzdirletter{sp}='tl';
				x_sp(sp,1)=x_trial;
				x_sp(sp,2)=y_trial;
				%matmodel switch
				%matmodel(sp)=6; %hyperelastic
				matmodel(sp)=4; %crackable elastic
				orientationoffset(sp)=NaN;
				plotignore(sp)=0;
				
				
				uncrackable_sp(sp)=0;
				if r_trial<r_donut_uncrackable
					uncrackable_sp(sp)=1;
					r_adjustor(sp)=1*le_base-r_trial;
					pforce_sp_base(sp,1)=log(stretchmultiplier)*E*lp(1)*lp(2)*t0_plane/r0_donut*cos(theta_trial);
					pforce_sp_base(sp,2)=log(stretchmultiplier)*E*lp(1)*lp(2)*t0_plane/r0_donut*sin(theta_trial);
				end
				
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				weakeningfactor_sp(sp)=0;
				
			end
		end
		if CasetoRun==159 || CasetoRun==162
			for isp=1:spCount
				x_sp(isp,:)=transpose(rotate.R*(transpose(x_sp(isp,:)-rotate.center)))+rotate.center;
				pforce_sp_base(isp,:)=transpose(rotate.R*(transpose(pforce_sp_base(isp,:))));
			end
		end
		1;
	elseif CasetoRun==194
		
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction
		
		tractionedcorner_counter=0; %size reference
		normalcorner_counter=0; %size reference
		tractionededge_counter=0; %size reference
		normaledge_counter=0; %size reference
		
		pforce_sp_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_center=7*le_base;
		y_center=7*le_base;
		r_donut_internal=1*le_base;
		r_donut_external=3*le_base;
		r_donut_uncrackable=2*le_base;
		
		x_crack.npaths=8;
		r_crack_internal=2.5*le_base;
		%r_crack_internal=2*le_base;
		r_crack_external=r_donut_external-lp(1);
		r_crack_far=6*le_base;
		
		steelstrength=25; %MPa
		x_crack.spacing=le(1)/2;
		x_crack.bridge.yieldforce1=steelstrength*x_crack.spacing*t0_plane;
		x_crack.bridge.yieldforce2(:,:)=x_crack.bridge.yieldforce1;
		x_crack.bridge.deltai1=0.002*le_base;
		x_crack.bridge.deltae=0.1*x_crack.bridge.deltai1;
		x_crack.bridge.kbase1=x_crack.bridge.yieldforce1/x_crack.bridge.deltae;
		x_crack.bridge.kbase2(:,:)=x_crack.bridge.kbase1;
		
		x_crack.bridge.pathcompletemonitor.size=x_crack.npaths
		
		for ipath=1:x_crack.npaths
			%x_crack.nparticles(ipath)=3;
			x_crack.nparticles(ipath)=8;
			x_crack.cohesivepath(ipath)=1;
			x_crack.cohesivepoint(1,ipath)=1;
			x_crack.bridge.pathcompletemonitor.values(ipath)=ipath;
			theta=2*pi*(0.5+ipath)/x_crack.npaths;
			for iparticle=1:x_crack.nparticles(ipath)
				r_crack=r_crack_internal+(r_crack_external-r_crack_internal)/(x_crack.nparticles(ipath)-1)*(iparticle-1);
				x_crack.center(iparticle,1,ipath)=x_center+r_crack*cos(theta);
				x_crack.center(iparticle,2,ipath)=y_center+r_crack*sin(theta);
			end
			x_crack.nparticles(ipath)=x_crack.nparticles(ipath)+1;
			r_crack=r_donut_external+3*le(1);
			x_crack.center(x_crack.nparticles(ipath),1,ipath)=x_center+r_crack*cos(theta);
			x_crack.center(x_crack.nparticles(ipath),2,ipath)=y_center+r_crack*sin(theta);
			x_crack.terminatedprop(ipath,1)=1;
			x_crack.terminatedprop(ipath,2)=0;
		end
		
		for i=1:size(x_crack.center,1)
			for j=1:size(x_crack.center,2)
				for k=1:size(x_crack.center,3)
					x_crack.top(i,j,k)=x_crack.center(i,j,k);
					x_crack.bot(i,j,k)=x_crack.center(i,j,k);
				end
			end
		end
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				delta_x_trial=[x_trial-x_center y_trial-y_center];
				r_trial=sqrt(dot(delta_x_trial,delta_x_trial));
				if r_trial<r_donut_internal
					continue;
				elseif r_trial>r_donut_external
					continue;
				end
				sp=sp+1;
			end
		end
		spCount=sp;
		
		thetacrackrtl=zeros(1,spCount);
		xdirletter_unused=cell(1,spCount);
		ydirletter_unused=cell(1,spCount);
		zdirletter_unused=cell(1,spCount);
		xydirletter_unused=cell(1,spCount);
		yzdirletter_unused=cell(1,spCount);
		xzdirletter_unused=cell(1,spCount);
		
		xdirletter=coder.nullcopy(xdirletter_unused);
		ydirletter=coder.nullcopy(ydirletter_unused);
		zdirletter=coder.nullcopy(zdirletter_unused);
		xydirletter=coder.nullcopy(xydirletter_unused);
		yzdirletter=coder.nullcopy(yzdirletter_unused);
		xzdirletter=coder.nullcopy(xzdirletter_unused);
		
		x_sp=zeros(spCount,2);
		r1_sp=zeros(spCount,2);
		r2_sp=zeros(spCount,2);

		matmodel=zeros(1,spCount);
		orientationoffset=zeros(1,spCount);
		plotignore=zeros(1,spCount);
		tractionedcorner=zeros(1,spCount);
		p_sp=zeros(spCount,1); %it's a vertical vector
		weakeningfactor_sp=zeros(1,spCount);
		pforce_sp=zeros(spCount,2);
		pforce_sp_base=zeros(spCount,2);
		r_adjustor=zeros(1,spCount);
		alphahp=zeros(spCount,7);
		uncrackable_sp=zeros(1,spCount);
		deltarideal_sp=zeros(1,spCount);
		deltaractual_sp=zeros(1,spCount);
		
		epsilonshrinkdot_sp=zeros(1,spCount);
		epsilonshrinkdotx_sp=zeros(1,spCount);
		epsilonshrinkdoty_sp=zeros(1,spCount);

		tractionedcorner=zeros(1,tractionedcorner_counter);
		normalcorner=cell(1,normalcorner_counter);
		tractionededge=zeros(1,tractionededge_counter);
		normaledge=zeros(normaledge_counter,2);
		
		
		tractionedcorner_counter=0;
		normalcorner_counter=0;
		tractionededge_counter=0;
		normaledge_counter=0;
		
		sp=0;
		stretchmultiplier=2.1; %to stop coder whining
		stretchmultiplier=1.9; %how much does the donut stretch
		r0_donut=(r_donut_internal+r_donut_uncrackable)/2;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				delta_x_trial=[x_trial-x_center y_trial-y_center];
				r_trial=sqrt(dot(delta_x_trial,delta_x_trial));
				theta_trial=reliableatan(delta_x_trial(1),delta_x_trial(2));
				if r_trial<r_donut_internal
					continue;
				elseif r_trial>r_donut_external
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl(sp)=NaN;
				xdirletter{sp}='t';
				ydirletter{sp}='r';
				zdirletter{sp}='l';
				xydirletter{sp}='tr';
				yzdirletter{sp}='rl';
				xzdirletter{sp}='tl';
				x_sp(sp,1)=x_trial;
				x_sp(sp,2)=y_trial;
				%matmodel switch
				%matmodel(sp)=6; %hyperelastic
				matmodel(sp)=4; %crackable elastic
				orientationoffset(sp)=NaN;
				plotignore(sp)=0;
				
				
				uncrackable_sp(sp)=0;
				if r_trial<r_donut_uncrackable
					uncrackable_sp(sp)=1;
					r_adjustor(sp)=1*le_base-r_trial;
					pforce_sp_base(sp,1)=log(stretchmultiplier)*E*lp(1)*lp(2)*t0_plane/r0_donut*cos(theta_trial);
					pforce_sp_base(sp,2)=log(stretchmultiplier)*E*lp(1)*lp(2)*t0_plane/r0_donut*sin(theta_trial);
				end
				
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				weakeningfactor_sp(sp)=0;
				
			end
		end
		if CasetoRun==159 || CasetoRun==162
			for isp=1:spCount
				x_sp(isp,:)=transpose(rotate.R*(transpose(x_sp(isp,:)-rotate.center)))+rotate.center;
				pforce_sp_base(isp,:)=transpose(rotate.R*(transpose(pforce_sp_base(isp,:))));
			end
		end
		1;
	elseif CasetoRun==175
		
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction
		
		tractionedcorner_counter=0; %size reference
		normalcorner_counter=0; %size reference
		tractionededge_counter=0; %size reference
		normaledge_counter=0; %size reference
		
		pforce_sp_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_center=7*le_base;
		y_center=7*le_base;
		r_donut_internal=1*le_base;
		r_donut_external=3*le_base;
		r_donut_uncrackable=2*le_base;
		
		x_crack.npaths=8;
		r_crack_internal=2.5*le_base;
		%r_crack_internal=2*le_base;
		r_crack_external=r_donut_external-lp(1);
		r_crack_far=6*le_base;
		
		for ipath=1:x_crack.npaths
			%x_crack.nparticles(ipath)=3;
			x_crack.nparticles(ipath)=8;
			theta=2*pi*(0.5+ipath)/x_crack.npaths;
			for iparticle=1:x_crack.nparticles(ipath)
				r_crack=r_crack_internal+(r_crack_external-r_crack_internal)/(x_crack.nparticles(ipath)-1)*(iparticle-1);
				x_crack.center(iparticle,1,ipath)=x_center+r_crack*cos(theta);
				x_crack.center(iparticle,2,ipath)=y_center+r_crack*sin(theta);
			end
			x_crack.nparticles(ipath)=x_crack.nparticles(ipath)+1;
			r_crack=r_donut_external+3*le(1);
			x_crack.center(x_crack.nparticles(ipath),1,ipath)=x_center+r_crack*cos(theta);
			x_crack.center(x_crack.nparticles(ipath),2,ipath)=y_center+r_crack*sin(theta);
			x_crack.terminatedprop(ipath,1)=1;
			x_crack.terminatedprop(ipath,2)=0;
		end
		
		for i=1:size(x_crack.center,1)
			for j=1:size(x_crack.center,2)
				for k=1:size(x_crack.center,3)
					x_crack.top(i,j,k)=x_crack.center(i,j,k);
					x_crack.bot(i,j,k)=x_crack.center(i,j,k);
				end
			end
		end
		
		steelstrength=25; %MPa
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				delta_x_trial=[x_trial-x_center y_trial-y_center];
				r_trial=sqrt(dot(delta_x_trial,delta_x_trial));
				if r_trial<r_donut_internal
					continue;
				elseif r_trial>r_donut_external
					continue;
				end
				sp=sp+1;
			end
		end
		spCount=sp;
		
		thetacrackrtl=zeros(1,spCount);
		xdirletter_unused=cell(1,spCount);
		ydirletter_unused=cell(1,spCount);
		zdirletter_unused=cell(1,spCount);
		xydirletter_unused=cell(1,spCount);
		yzdirletter_unused=cell(1,spCount);
		xzdirletter_unused=cell(1,spCount);
		
		xdirletter=coder.nullcopy(xdirletter_unused);
		ydirletter=coder.nullcopy(ydirletter_unused);
		zdirletter=coder.nullcopy(zdirletter_unused);
		xydirletter=coder.nullcopy(xydirletter_unused);
		yzdirletter=coder.nullcopy(yzdirletter_unused);
		xzdirletter=coder.nullcopy(xzdirletter_unused);
		
		x_sp=zeros(spCount,2);
		r1_sp=zeros(spCount,2);
		r2_sp=zeros(spCount,2);

		matmodel=zeros(1,spCount);
		orientationoffset=zeros(1,spCount);
		plotignore=zeros(1,spCount);
		tractionedcorner=zeros(1,spCount);
		p_sp=zeros(spCount,1); %it's a vertical vector
		weakeningfactor_sp=zeros(1,spCount);
		pforce_sp=zeros(spCount,2);
		pforce_sp_base=zeros(spCount,2);
		r_adjustor=zeros(1,spCount);
		alphahp=zeros(spCount,7);
		uncrackable_sp=zeros(1,spCount);
		deltarideal_sp=zeros(1,spCount);
		deltaractual_sp=zeros(1,spCount);
		
		epsilonshrinkdot_sp=zeros(1,spCount);
		epsilonshrinkdotx_sp=zeros(1,spCount);
		epsilonshrinkdoty_sp=zeros(1,spCount);

		tractionedcorner=zeros(1,tractionedcorner_counter);
		normalcorner=cell(1,normalcorner_counter);
		tractionededge=zeros(1,tractionededge_counter);
		normaledge=zeros(normaledge_counter,2);
		
		
		tractionedcorner_counter=0;
		normalcorner_counter=0;
		tractionededge_counter=0;
		normaledge_counter=0;
		
		sp=0;
		stretchmultiplier=2.1; %to stop coder whining
		stretchmultiplier=1.9; %how much does the donut stretch
		r0_donut=(r_donut_internal+r_donut_uncrackable)/2;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				delta_x_trial=[x_trial-x_center y_trial-y_center];
				r_trial=sqrt(dot(delta_x_trial,delta_x_trial));
				theta_trial=reliableatan(delta_x_trial(1),delta_x_trial(2));
				if r_trial<r_donut_internal
					continue;
				elseif r_trial>r_donut_external
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl(sp)=NaN;
				xdirletter{sp}='t';
				ydirletter{sp}='r';
				zdirletter{sp}='l';
				xydirletter{sp}='tr';
				yzdirletter{sp}='rl';
				xzdirletter{sp}='tl';
				x_sp(sp,1)=x_trial;
				x_sp(sp,2)=y_trial;
				%matmodel switch
				%matmodel(sp)=6; %hyperelastic
				matmodel(sp)=4; %crackable elastic
				orientationoffset(sp)=NaN;
				plotignore(sp)=0;
				
				
				uncrackable_sp(sp)=0;
				if r_trial<r_donut_uncrackable
					uncrackable_sp(sp)=1;
					r_adjustor(sp)=1*le_base-r_trial;
					pforce_sp_base(sp,1)=log(stretchmultiplier)*E*lp(1)*lp(2)*t0_plane/r0_donut*cos(theta_trial);
					pforce_sp_base(sp,2)=log(stretchmultiplier)*E*lp(1)*lp(2)*t0_plane/r0_donut*sin(theta_trial);
				end
				
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				weakeningfactor_sp(sp)=0;
				
			end
		end
		if CasetoRun==159 || CasetoRun==162
			for isp=1:spCount
				x_sp(isp,:)=transpose(rotate.R*(transpose(x_sp(isp,:)-rotate.center)))+rotate.center;
				pforce_sp_base(isp,:)=transpose(rotate.R*(transpose(pforce_sp_base(isp,:))));
			end
		end
		1;
	elseif CasetoRun==160
		
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction
		
		tractionedcorner_counter=0; %size reference
		normalcorner_counter=0; %size reference
		tractionededge_counter=0; %size reference
		normaledge_counter=0; %size reference
		
		pforce_sp_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_center=7*le_base;
		y_center=7*le_base;
		r_donut_internal=1*le_base;
		r_donut_external=3*le_base;
		r_donut_uncrackable=2*le_base;
		r_donut_uncrackable=2*le_base;
		
		x_crack.npaths=8;
		%r_crack_internal=2.5*le_base;
		r_crack_internal=2*le_base; %to stop coder whining
		r_crack_internal=2*le_base;
		r_crack_external=r_donut_external+2*le(1);
		r_crack_far=6*le_base;
		
		for ipath=1:x_crack.npaths
			%x_crack.nparticles(ipath)=3;
			x_crack.nparticles(ipath)=8;
			theta=2*pi*(0.5+ipath)/x_crack.npaths;
			for iparticle=1:x_crack.nparticles(ipath)
				r_crack=r_crack_internal+(r_crack_external-r_crack_internal)/(x_crack.nparticles(ipath)-1)*(iparticle-1);
				x_crack.center(iparticle,1,ipath)=x_center+r_crack*cos(theta);
				x_crack.center(iparticle,2,ipath)=y_center+r_crack*sin(theta);
			end
			x_crack.terminatedprop(ipath,1)=1;
			x_crack.terminatedprop(ipath,2)=1;
		end
		
		for i=1:size(x_crack.center,1)
			for j=1:size(x_crack.center,2)
				for k=1:size(x_crack.center,3)
					x_crack.top(i,j,k)=x_crack.center(i,j,k);
					x_crack.bot(i,j,k)=x_crack.center(i,j,k);
				end
			end
		end
		
		steelstrength=25; %MPa
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				delta_x_trial=[x_trial-x_center y_trial-y_center];
				r_trial=sqrt(dot(delta_x_trial,delta_x_trial));
				if r_trial<r_donut_internal
					continue;
				elseif r_trial>r_donut_external
					continue;
				end
				sp=sp+1;
			end
		end
		spCount=sp;
		
		thetacrackrtl=zeros(1,spCount);
		xdirletter_unused=cell(1,spCount);
		ydirletter_unused=cell(1,spCount);
		zdirletter_unused=cell(1,spCount);
		xydirletter_unused=cell(1,spCount);
		yzdirletter_unused=cell(1,spCount);
		xzdirletter_unused=cell(1,spCount);
		
		xdirletter=coder.nullcopy(xdirletter_unused);
		ydirletter=coder.nullcopy(ydirletter_unused);
		zdirletter=coder.nullcopy(zdirletter_unused);
		xydirletter=coder.nullcopy(xydirletter_unused);
		yzdirletter=coder.nullcopy(yzdirletter_unused);
		xzdirletter=coder.nullcopy(xzdirletter_unused);
		
		x_sp=zeros(spCount,2);
		r1_sp=zeros(spCount,2);
		r2_sp=zeros(spCount,2);

		matmodel=zeros(1,spCount);
		orientationoffset=zeros(1,spCount);
		plotignore=zeros(1,spCount);
		tractionedcorner=zeros(1,spCount);
		p_sp=zeros(spCount,1); %it's a vertical vector
		weakeningfactor_sp=zeros(1,spCount);
		pforce_sp=zeros(spCount,2);
		pforce_sp_base=zeros(spCount,2);
		r_adjustor=zeros(1,spCount);
		alphahp=zeros(spCount,7);
		uncrackable_sp=zeros(1,spCount);
		deltarideal_sp=zeros(1,spCount);
		deltaractual_sp=zeros(1,spCount);
		
		epsilonshrinkdot_sp=zeros(1,spCount);
		epsilonshrinkdotx_sp=zeros(1,spCount);
		epsilonshrinkdoty_sp=zeros(1,spCount);

		tractionedcorner=zeros(1,tractionedcorner_counter);
		normalcorner=cell(1,normalcorner_counter);
		tractionededge=zeros(1,tractionededge_counter);
		normaledge=zeros(normaledge_counter,2);
		
		
		tractionedcorner_counter=0;
		normalcorner_counter=0;
		tractionededge_counter=0;
		normaledge_counter=0;
		
		sp=0;
		stretchmultiplier=2.1; %to stop coder whining
		stretchmultiplier=1.9; %how much does the donut stretch
		r0_donut=(r_donut_internal+r_donut_uncrackable)/2;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				delta_x_trial=[x_trial-x_center y_trial-y_center];
				r_trial=sqrt(dot(delta_x_trial,delta_x_trial));
				theta_trial=reliableatan(delta_x_trial(1),delta_x_trial(2));
				if r_trial<r_donut_internal
					continue;
				elseif r_trial>r_donut_external
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl(sp)=NaN;
				xdirletter{sp}='t';
				ydirletter{sp}='r';
				zdirletter{sp}='l';
				xydirletter{sp}='tr';
				yzdirletter{sp}='rl';
				xzdirletter{sp}='tl';
				x_sp(sp,1)=x_trial;
				x_sp(sp,2)=y_trial;
				%matmodel switch
				%matmodel(sp)=6; %hyperelastic
				matmodel(sp)=4; %crackable elastic
				orientationoffset(sp)=NaN;
				plotignore(sp)=0;
				
				
				uncrackable_sp(sp)=0;
				if r_trial<r_donut_uncrackable
					uncrackable_sp(sp)=1;
					r_adjustor(sp)=1*le_base-r_trial;
					pforce_sp_base(sp,1)=log(stretchmultiplier)*E*lp(1)*lp(2)*t0_plane/r0_donut*cos(theta_trial);
					pforce_sp_base(sp,2)=log(stretchmultiplier)*E*lp(1)*lp(2)*t0_plane/r0_donut*sin(theta_trial);
				end
				
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				weakeningfactor_sp(sp)=0;
				
			end
		end
		if CasetoRun==159 || CasetoRun==162
			for isp=1:spCount
				x_sp(isp,:)=transpose(rotate.R*(transpose(x_sp(isp,:)-rotate.center)))+rotate.center;
				pforce_sp_base(isp,:)=transpose(rotate.R*(transpose(pforce_sp_base(isp,:))));
			end
		end
		1;
	elseif CasetoRun==155 || CasetoRun==157 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162
		
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction
		
		tractionedcorner_counter=0; %size reference
		normalcorner_counter=0; %size reference
		tractionededge_counter=0; %size reference
		normaledge_counter=0; %size reference
		
		pforce_sp_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_center=7*le_base;
		y_center=7*le_base;
		r_donut_internal=1*le_base;
		r_donut_external=3*le_base;
		r_donut_uncrackable=2*le_base;
		if CasetoRun==156 || CasetoRun==159 || CasetoRun==162
			r_donut_uncrackable=1.5*le_base;
		elseif CasetoRun==155 || CasetoRun==157
			r_donut_uncrackable=2*le_base;
		end
		
		x_crack.npaths=8;
		%r_crack_internal=2.5*le_base;
		r_crack_internal=2*le_base; %to stop coder whining
		if CasetoRun==155 || CasetoRun==157
			r_crack_internal=2*le_base;
		elseif CasetoRun==156 || CasetoRun==159 || CasetoRun==162
			r_crack_internal=2.75*le_base;
		end
		r_crack_external=r_donut_external-le(1)/2;
		r_crack_far=6*le_base;
		
		for ipath=1:x_crack.npaths
			%x_crack.nparticles(ipath)=3;
			x_crack.nparticles(ipath)=1;
			theta=2*pi*(0.5+ipath)/x_crack.npaths;
			for iparticle=1:x_crack.nparticles(ipath)
				%r_crack=r_crack_internal+(r_crack_external-r_crack_internal)/(x_crack.nparticles(ipath)-1)*(iparticle-1);
				r_crack=r_crack_internal;
				x_crack.center(iparticle,1,ipath)=x_center+r_crack*cos(theta);
				x_crack.center(iparticle,2,ipath)=y_center+r_crack*sin(theta);
			end
			x_crack.nparticles(ipath)=x_crack.nparticles(ipath)+1;
			r_crack=r_crack_far;
			x_crack.center(x_crack.nparticles(ipath),1,ipath)=x_center+r_crack*cos(theta);
			x_crack.center(x_crack.nparticles(ipath),2,ipath)=y_center+r_crack*sin(theta);
			
			x_crack.nparticles(ipath)=x_crack.nparticles(ipath)+1;
			r_crack=r_crack_far+0.1*le_base;
			x_crack.center(x_crack.nparticles(ipath),1,ipath)=x_center+r_crack*cos(theta);
			x_crack.center(x_crack.nparticles(ipath),2,ipath)=y_center+r_crack*sin(theta);
		end
		
		if CasetoRun==159 || CasetoRun==162
			rotate.angle_deg=15;
			rotate.angle=rotate.angle_deg/180*pi;
			rotate.center=[x_center y_center];
			rotate.R=[cos(rotate.angle) -sin(rotate.angle);sin(rotate.angle) cos(rotate.angle)];
			for ipath=1:x_crack.npaths
				for iparticle=1:x_crack.nparticles(ipath)
					x_crack.center(iparticle,:,ipath)=transpose(rotate.R*(transpose(x_crack.center(iparticle,:,ipath)-rotate.center)))+rotate.center;
				end
			end
		end
		
		for i=1:size(x_crack.center,1)
			for j=1:size(x_crack.center,2)
				for k=1:size(x_crack.center,3)
					x_crack.top(i,j,k)=x_crack.center(i,j,k);
					x_crack.bot(i,j,k)=x_crack.center(i,j,k);
				end
			end
		end
		
		steelstrength=25; %MPa
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				delta_x_trial=[x_trial-x_center y_trial-y_center];
				r_trial=sqrt(dot(delta_x_trial,delta_x_trial));
				if r_trial<r_donut_internal
					continue;
				elseif r_trial>r_donut_external
					continue;
				end
				sp=sp+1;
			end
		end
		spCount=sp;
		
		thetacrackrtl=zeros(1,spCount);
		xdirletter_unused=cell(1,spCount);
		ydirletter_unused=cell(1,spCount);
		zdirletter_unused=cell(1,spCount);
		xydirletter_unused=cell(1,spCount);
		yzdirletter_unused=cell(1,spCount);
		xzdirletter_unused=cell(1,spCount);
		
		xdirletter=coder.nullcopy(xdirletter_unused);
		ydirletter=coder.nullcopy(ydirletter_unused);
		zdirletter=coder.nullcopy(zdirletter_unused);
		xydirletter=coder.nullcopy(xydirletter_unused);
		yzdirletter=coder.nullcopy(yzdirletter_unused);
		xzdirletter=coder.nullcopy(xzdirletter_unused);
		
		x_sp=zeros(spCount,2);
		r1_sp=zeros(spCount,2);
		r2_sp=zeros(spCount,2);

		matmodel=zeros(1,spCount);
		orientationoffset=zeros(1,spCount);
		plotignore=zeros(1,spCount);
		tractionedcorner=zeros(1,spCount);
		p_sp=zeros(spCount,1); %it's a vertical vector
		weakeningfactor_sp=zeros(1,spCount);
		pforce_sp=zeros(spCount,2);
		pforce_sp_base=zeros(spCount,2);
		r_adjustor=zeros(1,spCount);
		alphahp=zeros(spCount,7);
		uncrackable_sp=zeros(1,spCount);
		deltarideal_sp=zeros(1,spCount);
		deltaractual_sp=zeros(1,spCount);
		
		epsilonshrinkdot_sp=zeros(1,spCount);
		epsilonshrinkdotx_sp=zeros(1,spCount);
		epsilonshrinkdoty_sp=zeros(1,spCount);

		tractionedcorner=zeros(1,tractionedcorner_counter);
		normalcorner=cell(1,normalcorner_counter);
		tractionededge=zeros(1,tractionededge_counter);
		normaledge=zeros(normaledge_counter,2);
		
		
		tractionedcorner_counter=0;
		normalcorner_counter=0;
		tractionededge_counter=0;
		normaledge_counter=0;
		
		sp=0;
		stretchmultiplier=2.1; %to stop coder whining
		if CasetoRun==157
			%stretch adjust
			stretchmultiplier=1.95; %how much does the donut stretch
		elseif CasetoRun==155 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162
			stretchmultiplier=2.1;
		end
		r0_donut=(r_donut_internal+r_donut_uncrackable)/2;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				delta_x_trial=[x_trial-x_center y_trial-y_center];
				r_trial=sqrt(dot(delta_x_trial,delta_x_trial));
				theta_trial=reliableatan(delta_x_trial(1),delta_x_trial(2));
				if r_trial<r_donut_internal
					continue;
				elseif r_trial>r_donut_external
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl(sp)=NaN;
				xdirletter{sp}='t';
				ydirletter{sp}='r';
				zdirletter{sp}='l';
				xydirletter{sp}='tr';
				yzdirletter{sp}='rl';
				xzdirletter{sp}='tl';
				x_sp(sp,1)=x_trial;
				x_sp(sp,2)=y_trial;
				if CasetoRun==156 || CasetoRun==159 || CasetoRun==162
					matmodel(sp)=4; %crackable elastic
				elseif CasetoRun==155 || CasetoRun==157
					%matmodel switch
					%matmodel(sp)=6; %hyperelastic
					matmodel(sp)=4; %crackable elastic
				end
				orientationoffset(sp)=NaN;
				plotignore(sp)=0;
				
				
				uncrackable_sp(sp)=0;
				if r_trial<r_donut_uncrackable
					uncrackable_sp(sp)=1;
					r_adjustor(sp)=1*le_base-r_trial;
					pforce_sp_base(sp,1)=log(stretchmultiplier)*E*lp(1)*lp(2)*t0_plane/r0_donut*cos(theta_trial);
					pforce_sp_base(sp,2)=log(stretchmultiplier)*E*lp(1)*lp(2)*t0_plane/r0_donut*sin(theta_trial);
				end
				
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				weakeningfactor_sp(sp)=0;
				
			end
		end
		if CasetoRun==159 || CasetoRun==162
			for isp=1:spCount
				x_sp(isp,:)=transpose(rotate.R*(transpose(x_sp(isp,:)-rotate.center)))+rotate.center;
				pforce_sp_base(isp,:)=transpose(rotate.R*(transpose(pforce_sp_base(isp,:))));
			end
		end
		1;
	elseif CasetoRun==172 || CasetoRun==174
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction
		
		tractionedcorner_counter=0; %size reference
		normalcorner_counter=0; %size reference
		tractionededge_counter=0; %size reference
		normaledge_counter=0; %size reference
		
		pforce_sp_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_center=7*le_base;
		y_center=7*le_base;
		r_donut_internal=1*le_base;
		r_donut_external=3*le_base;
		r_donut_uncrackable=0*le_base;
		r_donut_push=1.5*le_base;
		
		x_crack.npaths=1;
		x_crack.nparticles(1)=2;
		x_crack.terminatedprop(1,1)=1; %crack is terminated, no further propagation
		x_crack.terminatedprop(1,2)=1; %crack is terminated, no further propagation
		x_crack.center(1,1,1)=x_center+10e-5;
		x_crack.center(1,2,1)=y_center+10e-5;
		x_crack.center(2,1,1)=x_center+11e-5;
		x_crack.center(2,2,1)=y_center+11e-5;
		
		
		%additional for troubleshooting
		%{
		x_crack.center(1,1,1)=x_center+r_donut_internal-le(1);
		x_crack.center(1,2,1)=y_center;
		x_crack.center(2,1,1)=x_center+r_donut_internal+le(1);
		x_crack.center(2,2,2)=y_center;
		x_crack.terminatedprop(1,1)=0;
		x_crack.terminatedprop(1,2)=0;
		%}
		
		
		rotate.angle_deg=0;
		rotate.angle=rotate.angle_deg/180*pi;
		rotate.center=[x_center y_center];
		rotate.R=[cos(rotate.angle) -sin(rotate.angle);sin(rotate.angle) cos(rotate.angle)];
		for ipath=1:x_crack.npaths
			for iparticle=1:x_crack.nparticles(ipath)
				x_crack.center(iparticle,:,ipath)=transpose(rotate.R*(transpose(x_crack.center(iparticle,:,ipath)-rotate.center)))+rotate.center;
			end
		end
		
		for i=1:size(x_crack.center,1)
			for j=1:size(x_crack.center,2)
				for k=1:size(x_crack.center,3)
					x_crack.top(i,j,k)=x_crack.center(i,j,k);
					x_crack.bot(i,j,k)=x_crack.center(i,j,k);
				end
			end
		end
		
		steelstrength=25; %MPa
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				delta_x_trial=[x_trial-x_center y_trial-y_center];
				r_trial=sqrt(dot(delta_x_trial,delta_x_trial));
				if r_trial<r_donut_internal
					continue;
				elseif r_trial>r_donut_external
					continue;
				end
				sp=sp+1;
			end
		end
		spCount=sp;
		
		thetacrackrtl=zeros(1,spCount);
		xdirletter_unused=cell(1,spCount);
		ydirletter_unused=cell(1,spCount);
		zdirletter_unused=cell(1,spCount);
		xydirletter_unused=cell(1,spCount);
		yzdirletter_unused=cell(1,spCount);
		xzdirletter_unused=cell(1,spCount);
		
		xdirletter=coder.nullcopy(xdirletter_unused);
		ydirletter=coder.nullcopy(ydirletter_unused);
		zdirletter=coder.nullcopy(zdirletter_unused);
		xydirletter=coder.nullcopy(xydirletter_unused);
		yzdirletter=coder.nullcopy(yzdirletter_unused);
		xzdirletter=coder.nullcopy(xzdirletter_unused);
		
		
		x_sp=zeros(spCount,2);
		r1_sp=zeros(spCount,2);
		r2_sp=zeros(spCount,2);
		
		matmodel=zeros(1,spCount);
		orientationoffset=zeros(1,spCount);
		plotignore=zeros(1,spCount);
		tractionedcorner=zeros(1,spCount);
		p_sp=zeros(spCount,1); %it's a vertical vector
		Efactor_sp=zeros(1,spCount);
		pforce_sp=zeros(spCount,2);
		pforce_sp_base=zeros(spCount,2);
		r_adjustor=zeros(1,spCount);
		alphahp=zeros(spCount,7);
		uncrackable_sp=zeros(1,spCount);
		donut_pushed_sp=zeros(1,spCount);
		deltarideal_sp=zeros(1,spCount);
		deltaractual_sp=zeros(1,spCount);
		weakeningfactor_sp=zeros(1,spCount);
		
		epsilonshrinkdot_sp=zeros(1,spCount);
		epsilonshrinkdotx_sp=zeros(1,spCount);
		epsilonshrinkdoty_sp=zeros(1,spCount);
		
		tractionedcorner=zeros(1,tractionedcorner_counter);
		normalcorner=cell(1,normalcorner_counter);
		tractionededge=zeros(1,tractionededge_counter);
		normaledge=zeros(normaledge_counter,2);
		
		
		tractionedcorner_counter=0;
		normalcorner_counter=0;
		tractionededge_counter=0;
		normaledge_counter=0;
		
		sp=0;
		stretchmultiplier=2.1; %to stop coder whining
		stretchmultiplier=2.1;
		r0_donut=(r_donut_internal+r_donut_uncrackable)/2;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				delta_x_trial=[x_trial-x_center y_trial-y_center];
				r_trial=sqrt(dot(delta_x_trial,delta_x_trial));
				theta_trial=reliableatan(delta_x_trial(1),delta_x_trial(2));
				if r_trial<r_donut_internal
					continue;
				elseif r_trial>r_donut_external
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl(sp)=NaN;
				xdirletter{sp}='t';
				ydirletter{sp}='r';
				zdirletter{sp}='l';
				xydirletter{sp}='tr';
				yzdirletter{sp}='rl';
				xzdirletter{sp}='tl';
				x_sp(sp,1)=x_trial;
				x_sp(sp,2)=y_trial;
				matmodel(sp)=4; %crackable elastic
				orientationoffset(sp)=NaN;
				plotignore(sp)=0;
				relativeangle_rad=reliableatan(delta_x_trial(1),delta_x_trial(2));
				relativeangle_deg=relativeangle_rad/pi*180;
				if relativeangle_deg>30 && relativeangle_deg<45
					Efactor_sp(sp)=0.9;
				else
					Efactor_sp(sp)=1;
				end
				
				uncrackable_sp(sp)=0;
				if r_trial<r_donut_uncrackable
					uncrackable_sp(sp)=1;
				end
				
				donut_pushed_sp(sp)=0;
				if r_trial<r_donut_push
					donut_pushed_sp(sp)=1;
					r_adjustor(sp)=1*le_base-r_trial;
					pforce_sp_base(sp,1)=log(stretchmultiplier)*E*lp(1)*lp(2)*t0_plane/r0_donut*cos(theta_trial);
					pforce_sp_base(sp,2)=log(stretchmultiplier)*E*lp(1)*lp(2)*t0_plane/r0_donut*sin(theta_trial);
				end
				
				
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				weakeningfactor_sp(sp)=0;
				
			end
		end
		
		for isp=1:spCount
			x_sp(isp,:)=transpose(rotate.R*(transpose(x_sp(isp,:)-rotate.center)))+rotate.center;
			pforce_sp_base(isp,:)=transpose(rotate.R*(transpose(pforce_sp_base(isp,:))));
		end
		1;
	elseif CasetoRun==164
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction
		
		tractionedcorner_counter=0; %size reference
		normalcorner_counter=0; %size reference
		tractionededge_counter=0; %size reference
		normaledge_counter=0; %size reference
		
		pforce_sp_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_center=7*le_base;
		y_center=7*le_base;
		r_donut_internal=1*le_base;
		r_donut_external=3*le_base;
		r_donut_uncrackable=0*le_base;
		r_donut_push=1.5*le_base;
		
		x_crack.npaths=1;
		x_crack.nparticles(1)=2;
		x_crack.terminatedprop(1,1)=1; %crack is terminated, no further propagation
		x_crack.terminatedprop(1,2)=1; %crack is terminated, no further propagation
		x_crack.center(1,1,1)=x_center+10e-5;
		x_crack.center(1,2,1)=y_center+10e-5;
		x_crack.center(2,1,1)=x_center+11e-5;
		x_crack.center(2,2,1)=y_center+11e-5;
		rotate.angle_deg=0;
		rotate.angle=rotate.angle_deg/180*pi;
		rotate.center=[x_center y_center];
		rotate.R=[cos(rotate.angle) -sin(rotate.angle);sin(rotate.angle) cos(rotate.angle)];
		for ipath=1:x_crack.npaths
			for iparticle=1:x_crack.nparticles(ipath)
				x_crack.center(iparticle,:,ipath)=transpose(rotate.R*(transpose(x_crack.center(iparticle,:,ipath)-rotate.center)))+rotate.center;
			end
		end
		
		for i=1:size(x_crack.center,1)
			for j=1:size(x_crack.center,2)
				for k=1:size(x_crack.center,3)
					x_crack.top(i,j,k)=x_crack.center(i,j,k);
					x_crack.bot(i,j,k)=x_crack.center(i,j,k);
				end
			end
		end
		
		steelstrength=25; %MPa
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				delta_x_trial=[x_trial-x_center y_trial-y_center];
				r_trial=sqrt(dot(delta_x_trial,delta_x_trial));
				if r_trial<r_donut_internal
					continue;
				elseif r_trial>r_donut_external
					continue;
				end
				sp=sp+1;
			end
		end
		spCount=sp;
		
		thetacrackrtl=zeros(1,spCount);
		xdirletter_unused=cell(1,spCount);
		ydirletter_unused=cell(1,spCount);
		zdirletter_unused=cell(1,spCount);
		xydirletter_unused=cell(1,spCount);
		yzdirletter_unused=cell(1,spCount);
		xzdirletter_unused=cell(1,spCount);
		
		xdirletter=coder.nullcopy(xdirletter_unused);
		ydirletter=coder.nullcopy(ydirletter_unused);
		zdirletter=coder.nullcopy(zdirletter_unused);
		xydirletter=coder.nullcopy(xydirletter_unused);
		yzdirletter=coder.nullcopy(yzdirletter_unused);
		xzdirletter=coder.nullcopy(xzdirletter_unused);
		
		x_sp=zeros(spCount,2);
		r1_sp=zeros(spCount,2);
		r2_sp=zeros(spCount,2);
		
		matmodel=zeros(1,spCount);
		orientationoffset=zeros(1,spCount);
		plotignore=zeros(1,spCount);
		tractionedcorner=zeros(1,spCount);
		p_sp=zeros(spCount,1); %it's a vertical vector
		weakeningfactor_sp=zeros(1,spCount);
		pforce_sp=zeros(spCount,2);
		pforce_sp_base=zeros(spCount,2);
		r_adjustor=zeros(1,spCount);
		alphahp=zeros(spCount,7);
		uncrackable_sp=zeros(1,spCount);
		donut_pushed_sp=zeros(1,spCount);
		deltarideal_sp=zeros(1,spCount);
		deltaractual_sp=zeros(1,spCount);
		
		epsilonshrinkdot_sp=zeros(1,spCount);
		epsilonshrinkdotx_sp=zeros(1,spCount);
		epsilonshrinkdoty_sp=zeros(1,spCount);
		
		tractionedcorner=zeros(1,tractionedcorner_counter);
		normalcorner=cell(1,normalcorner_counter);
		tractionededge=zeros(1,tractionededge_counter);
		normaledge=zeros(normaledge_counter,2);
		
		
		tractionedcorner_counter=0;
		normalcorner_counter=0;
		tractionededge_counter=0;
		normaledge_counter=0;
		
		sp=0;
		stretchmultiplier=2.1; %to stop coder whining
		stretchmultiplier=2.1;
		r0_donut=(r_donut_internal+r_donut_uncrackable)/2;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				delta_x_trial=[x_trial-x_center y_trial-y_center];
				r_trial=sqrt(dot(delta_x_trial,delta_x_trial));
				theta_trial=reliableatan(delta_x_trial(1),delta_x_trial(2));
				if r_trial<r_donut_internal
					continue;
				elseif r_trial>r_donut_external
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl(sp)=NaN;
				xdirletter{sp}='t';
				ydirletter{sp}='r';
				zdirletter{sp}='l';
				xydirletter{sp}='tr';
				yzdirletter{sp}='rl';
				xzdirletter{sp}='tl';
				x_sp(sp,1)=x_trial;
				x_sp(sp,2)=y_trial;
				matmodel(sp)=4; %crackable elastic
				orientationoffset(sp)=NaN;
				plotignore(sp)=0;
				
				
				uncrackable_sp(sp)=0;
				if r_trial<r_donut_uncrackable
					uncrackable_sp(sp)=1;
				end
				
				donut_pushed_sp(sp)=0;
				if r_trial<r_donut_push
					donut_pushed_sp(sp)=1;
					r_adjustor(sp)=1*le_base-r_trial;
					pforce_sp_base(sp,1)=log(stretchmultiplier)*E*lp(1)*lp(2)*t0_plane/r0_donut*cos(theta_trial);
					pforce_sp_base(sp,2)=log(stretchmultiplier)*E*lp(1)*lp(2)*t0_plane/r0_donut*sin(theta_trial);
				end
				
				
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				weakeningfactor_sp(sp)=0;
				
			end
		end
		
		for isp=1:spCount
			x_sp(isp,:)=transpose(rotate.R*(transpose(x_sp(isp,:)-rotate.center)))+rotate.center;
			pforce_sp_base(isp,:)=transpose(rotate.R*(transpose(pforce_sp_base(isp,:))));
		end
		1;
	elseif CasetoRun==138
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction
		
		tractionedcorner_counter=0; %size reference
		normalcorner_counter=0; %size reference
		tractionededge_counter=0; %size reference
		normaledge_counter=0; %size reference
		
		pforce_sp_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		x_end=4*le_base;
		y_start=2*le_base;
		y_end=4*le_base;
		
		x_crack_unused=cell(1,2);
		x_crack.npaths=1;
		x_crack.nparticles(1)=2;
		
		x_crack_temp=[0.5 3;
						3-pi*1e-5 3]*le_base;
		x_crack.center(1,1,1)=x_crack_temp(1,1);
		x_crack.center(1,2,1)=x_crack_temp(1,2);
		x_crack.center(2,1,1)=x_crack_temp(2,1);
		x_crack.center(2,2,1)=x_crack_temp(2,2);
		
		%{
		if CasetoRun==117
			x_crack{1}=[0.5 3;
						3-pi*1e-5 3-pi*1e-5;
				3-pi*1e-5+2.5 3]*le_base;
		end
		x_defaultcracktip=[3 3]*le_base;
		%}
		
		for i=1:size(x_crack.center,1)
			for j=1:size(x_crack.center,2)
				for k=1:size(x_crack.center,3)
					x_crack.top(i,j,k)=x_crack.center(i,j,k);
					x_crack.bot(i,j,k)=x_crack.center(i,j,k);
				end
			end
		end
				
		%x_crack.top=x_crack.center;
		%x_crack.bot=x_crack.center;
		
		steelstrength=25; %MPa
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial<y_end
					else
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				
				if x_trial>4*le_base-lp(1)
					if y_trial>4*le_base-lp(2)
						tractionedcorner_counter=tractionedcorner_counter+1;
						normalcorner_counter=normalcorner_counter+1;
					elseif y_trial<2*le_base+lp(2)
						tractionedcorner_counter=tractionedcorner_counter+1;
						normalcorner_counter=normalcorner_counter+1;
					else
						tractionededge_counter=tractionededge_counter+1;
						normaledge_counter=normaledge_counter+1;
					end
				elseif y_trial>4*le_base-lp(2)
					tractionededge_counter=tractionededge_counter+1;
					normaledge_counter=normaledge_counter+1;
				elseif y_trial<2*le_base+lp(2)
					tractionededge_counter=tractionededge_counter+1;
					normaledge_counter=normaledge_counter+1;
				end
				
				%if x_trial<6*le_base && x_trial>(6*le_base-lp(1)) && y_trial>13*le_base && y_trial<13*le_base+lp(2);
				%	ParticleswithPredYVel(1)=sp;
				%end
				%if x_trial<6*le_base && x_trial>(6*le_base-lp(1)) && y_trial<7*le_base && y_trial>7*le_base-lp(2);
				%	ParticleswithPredYVel(2)=sp;
				%end
			end
		end
		spCount=sp;
		
		thetacrackrtl=zeros(1,spCount);
		xdirletter_unused=cell(1,spCount);
		ydirletter_unused=cell(1,spCount);
		zdirletter_unused=cell(1,spCount);
		xydirletter_unused=cell(1,spCount);
		yzdirletter_unused=cell(1,spCount);
		xzdirletter_unused=cell(1,spCount);
		
		xdirletter=coder.nullcopy(xdirletter_unused);
		ydirletter=coder.nullcopy(ydirletter_unused);
		zdirletter=coder.nullcopy(zdirletter_unused);
		xydirletter=coder.nullcopy(xydirletter_unused);
		yzdirletter=coder.nullcopy(yzdirletter_unused);
		xzdirletter=coder.nullcopy(xzdirletter_unused);
		
		x_sp=zeros(spCount,2);
		r1_sp=zeros(spCount,2);
		r2_sp=zeros(spCount,2);
		matmodel=zeros(1,spCount);
		orientationoffset=zeros(1,spCount);
		plotignore=zeros(1,spCount);
		tractionedcorner=zeros(1,spCount);
		p_sp=zeros(spCount,1); %it's a vertical vector
		weakeningfactor_sp=zeros(1,spCount);
		pforce_sp=zeros(spCount,2);
		alphahp=zeros(spCount,7);
		
		epsilonshrinkdot_sp=zeros(1,spCount);
		epsilonshrinkdotx_sp=zeros(1,spCount);
		epsilonshrinkdoty_sp=zeros(1,spCount);

		tractionedcorner=zeros(1,tractionedcorner_counter);
		normalcorner=cell(1,normalcorner_counter);
		for icell=1:normalcorner_counter
			normalcorner{icell}=zeros(2,2);
		end
		tractionededge=zeros(1,tractionededge_counter);
		normaledge=zeros(normaledge_counter,2);
		
		
		tractionedcorner_counter=0;
		normalcorner_counter=0;
		tractionededge_counter=0;
		normaledge_counter=0;
		
		sp=0;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial<y_end
					else
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl(sp)=NaN;
				xdirletter{sp}='t';
				ydirletter{sp}='r';
				zdirletter{sp}='l';
				xydirletter{sp}='tr';
				yzdirletter{sp}='rl';
				xzdirletter{sp}='tl';
				x_sp(sp,1)=x_trial;
				x_sp(sp,2)=y_trial;
				matmodel(sp)=4; %crackable elastic
				orientationoffset(sp)=NaN;
				plotignore(sp)=0;
				
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				weakeningfactor_sp(sp)=0;
				
				if x_trial>4*le_base-lp(1)
					if y_trial>4*le_base-lp(2)
						tractionedcorner_counter=tractionedcorner_counter+1;
						tractionedcorner(tractionedcorner_counter)=sp;
						normalcorner_counter=normalcorner_counter+1;
						normalcorner{normalcorner_counter}=[1 0;
																0 1];
					elseif y_trial<2*le_base+lp(2)
						tractionedcorner_counter=tractionedcorner_counter+1;
						tractionedcorner(tractionedcorner_counter)=sp;
						normalcorner_counter=normalcorner_counter+1;
						normalcorner{normalcorner_counter}=[1 0;
																0 -1];
					else
						tractionededge_counter=tractionededge_counter+1;
						tractionededge(tractionededge_counter)=sp;
						normaledge_counter=normaledge_counter+1;
						normaledge(normaledge_counter,1)=1;
						normaledge(normaledge_counter,2)=0;
					end
				elseif y_trial>4*le_base-lp(2)
					tractionededge_counter=tractionededge_counter+1;
					tractionededge(tractionededge_counter)=sp;
					normaledge_counter=normaledge_counter+1;
					normaledge(normaledge_counter,1)=0;
					normaledge(normaledge_counter,2)=1;
				elseif y_trial<2*le_base+lp(2)
					tractionededge_counter=tractionededge_counter+1;
					tractionededge(tractionededge_counter)=sp;
					normaledge_counter=normaledge_counter+1;
					normaledge(normaledge_counter,1)=0;
					normaledge(normaledge_counter,2)=-1;
				end
				
				%if x_trial<6*le_base && x_trial>(6*le_base-lp(1)) && y_trial>13*le_base && y_trial<13*le_base+lp(2);
				%	ParticleswithPredYVel(1)=sp;
				%end
				%if x_trial<6*le_base && x_trial>(6*le_base-lp(1)) && y_trial<7*le_base && y_trial>7*le_base-lp(2);
				%	ParticleswithPredYVel(2)=sp;
				%end
			end
		end
		1;
	elseif CasetoRun==124
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction
		
		tractionedcorner_counter=0; %size reference
		normalcorner_counter=0; %size reference
		tractionededge_counter=0; %size reference
		normaledge_counter=0; %size reference
		
		pforce_sp_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_end=8*le_base;
		x_start=x_end-7.85;
		y_start=4.5*le_base-6.47/2;
		y_end=4.5*le_base+6.47/2;
		
		x_crack_unused=cell(1,2);
		%x_crack=coder.nullcopy(x_crack_unused);
		x_crack.npaths=1;
		x_crack.nparticles(1)=2;
		%x_crack.center=zeros(2,2,10);
		%x_crack.top=zeros(2,2,10);
		%x_crack.bot=zeros(2,2,10);
		initialcracklength=1.61025641025641;
		
		x_crack.center(1,1,1)=(8+1)*le_base;
		x_crack.center(1,2,1)=4.5*le_base;
		x_crack.center(2,1,1)=8*le_base-initialcracklength;
		x_crack.center(2,2,1)=4.5*le_base;
		
		%{
		if CasetoRun==117
			x_crack{1}=[0.5 3;
						3-pi*1e-5 3-pi*1e-5;
				3-pi*1e-5+2.5 3]*le_base;
		end
		x_defaultcracktip=[3 3]*le_base;
		%}
		
		for i=1:size(x_crack.center,1)
			for j=1:size(x_crack.center,2)
				for k=1:size(x_crack.center,3)
					x_crack.top(i,j,k)=x_crack.center(i,j,k);
					x_crack.bot(i,j,k)=x_crack.center(i,j,k);
				end
			end
		end
		
		%x_crack.top=x_crack.center;
		%x_crack.bot=x_crack.center;
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial<y_end
					else
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				
				if x_trial>4*le_base-lp(1)
					if y_trial>4*le_base-lp(2)
						tractionedcorner_counter=tractionedcorner_counter+1;
						normalcorner_counter=normalcorner_counter+1;
					elseif y_trial<2*le_base+lp(2)
						tractionedcorner_counter=tractionedcorner_counter+1;
						normalcorner_counter=normalcorner_counter+1;
					else
						tractionededge_counter=tractionededge_counter+1;
						normaledge_counter=normaledge_counter+1;
					end
				elseif y_trial>4*le_base-lp(2)
					tractionededge_counter=tractionededge_counter+1;
					normaledge_counter=normaledge_counter+1;
				elseif y_trial<2*le_base+lp(2)
					tractionededge_counter=tractionededge_counter+1;
					normaledge_counter=normaledge_counter+1;
				end
				
				%if x_trial<6*le_base && x_trial>(6*le_base-lp(1)) && y_trial>13*le_base && y_trial<13*le_base+lp(2);
				%	ParticleswithPredYVel(1)=sp;
				%end
				%if x_trial<6*le_base && x_trial>(6*le_base-lp(1)) && y_trial<7*le_base && y_trial>7*le_base-lp(2);
				%	ParticleswithPredYVel(2)=sp;
				%end
			end
		end
		spCount=sp;
		LWStatus=zeros(1,spCount);
		EWStatus=zeros(1,spCount);
		
		thetacrackrtl=zeros(1,spCount);
		xdirletter_unused=cell(1,spCount);
		ydirletter_unused=cell(1,spCount);
		zdirletter_unused=cell(1,spCount);
		xydirletter_unused=cell(1,spCount);
		yzdirletter_unused=cell(1,spCount);
		xzdirletter_unused=cell(1,spCount);
		
		xdirletter=coder.nullcopy(xdirletter_unused);
		ydirletter=coder.nullcopy(ydirletter_unused);
		zdirletter=coder.nullcopy(zdirletter_unused);
		xydirletter=coder.nullcopy(xydirletter_unused);
		yzdirletter=coder.nullcopy(yzdirletter_unused);
		xzdirletter=coder.nullcopy(xzdirletter_unused);
		
		x_sp=zeros(spCount,2);
		r1_sp=zeros(spCount,2);
		r2_sp=zeros(spCount,2);
		matmodel=zeros(1,spCount);
		orientationoffset=zeros(1,spCount);
		plotignore=zeros(1,spCount);
		tractionedcorner=zeros(1,spCount);
		p_sp=zeros(spCount,1); %it's a vertical vector
		weakeningfactor_sp=zeros(1,spCount);
		pforce_sp=zeros(spCount,2);
		alphahp=zeros(spCount,7);
		
		epsilonshrinkdot_sp=zeros(1,spCount);
		epsilonshrinkdotx_sp=zeros(1,spCount);
		epsilonshrinkdoty_sp=zeros(1,spCount);

		tractionedcorner=zeros(1,tractionedcorner_counter);
		normalcorner=cell(1,normalcorner_counter);
		tractionededge=zeros(1,tractionededge_counter);
		normaledge=zeros(normaledge_counter,2);
		
		
		tractionedcorner_counter=0;
		normalcorner_counter=0;
		tractionededge_counter=0;
		normaledge_counter=0;
		
		sp=0;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial<y_end
					else
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl(sp)=NaN;
				xdirletter{sp}='t';
				ydirletter{sp}='r';
				zdirletter{sp}='l';
				xydirletter{sp}='tr';
				yzdirletter{sp}='rl';
				xzdirletter{sp}='tl';
				x_sp(sp,1)=x_trial;
				x_sp(sp,2)=y_trial;
				LWStatus(sp)=LWRequest(x_trial,y_trial,x_start,y_start,x_end,y_end); %tempmarker3
				if LWStatus(sp)==0
					matmodel(sp)=5; %crackable elastic
					EWStatus(sp)=1;
				else
					matmodel(sp)=4;
					EWStatus(sp)=0;
				end
				orientationoffset(sp)=NaN;
				plotignore(sp)=0;
				
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				weakeningfactor_sp(sp)=0;
				
				if x_trial>4*le_base-lp(1)
					if y_trial>4*le_base-lp(2)
						tractionedcorner_counter=tractionedcorner_counter+1;
						tractionedcorner(tractionedcorner_counter)=sp;
						normalcorner_counter=normalcorner_counter+1;
						normalcorner{normalcorner_counter}=[1 0;
																0 1];
					elseif y_trial<2*le_base+lp(2)
						tractionedcorner_counter=tractionedcorner_counter+1;
						tractionedcorner(tractionedcorner_counter)=sp;
						normalcorner_counter=normalcorner_counter+1;
						normalcorner{normalcorner_counter}=[1 0;
																0 -1];
					else
						tractionededge_counter=tractionededge_counter+1;
						tractionededge(tractionededge_counter)=sp;
						normaledge_counter=normaledge_counter+1;
						normaledge(normaledge_counter,1)=1;
						normaledge(normaledge_counter,2)=0;
					end
				elseif y_trial>4*le_base-lp(2)
					tractionededge_counter=tractionededge_counter+1;
					tractionededge(tractionededge_counter)=sp;
					normaledge_counter=normaledge_counter+1;
					normaledge(normaledge_counter,1)=0;
					normaledge(normaledge_counter,1)=1;
				elseif y_trial<2*le_base+lp(2)
					tractionededge_counter=tractionededge_counter+1;
					tractionededge(tractionededge_counter)=sp;
					normaledge_counter=normaledge_counter+1;
					normaledge(normaledge_counter,1)=0;
					normaledge(normaledge_counter,2)=-1;
				end
				
				%if x_trial<6*le_base && x_trial>(6*le_base-lp(1)) && y_trial>13*le_base && y_trial<13*le_base+lp(2);
				%	ParticleswithPredYVel(1)=sp;
				%end
				%if x_trial<6*le_base && x_trial>(6*le_base-lp(1)) && y_trial<7*le_base && y_trial>7*le_base-lp(2);
				%	ParticleswithPredYVel(2)=sp;
				%end
			end
		end
		%{
		close all;
		scatter([x_sp(1,1);x_sp(:,1)],[x_sp(1,2);x_sp(:,2)],1,[1.5 EWStatus],'filled');
		hold on
		plot([x_crack.center(1,1,1) x_crack.center(2,1,1)],[x_crack.center(1,2,1) x_crack.center(2,2,1)],'LineWidth',2,'Color','Black');
		daspect([1 1 1]);
		axis([le_base,9*le_base,le_base,8*le_base]);
		set(gca,'xtick',[0:le_base:10*le_base]);
		set(gca,'ytick',[0:le_base:9*le_base]);
		pause
		hold off
		%}
		1;
	elseif CasetoRun==112
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction
		
		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		x_end=12*le_base;
		y_start=13*le_base;
		y_end=15*le_base;
		
		x_crack{1}=[0.5 0.25;
					0.5 0.75]*le_base;
		
		x_cracktop=x_crack;
		x_crackbot=x_crack;
		iParticleswithPredYVel=0;
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial<y_end
					else
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
			end
		end
		spCount=sp;
		pforce_sp=zeros(spCount,2);
		sp=0;
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial<y_end
					else
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				
				if x_trial>11*le_base && x_trial<11*le_base+lp(1) && y_trial>14*le_base && y_trial<14*le_base+lp(2)
					iParticleswithPredYVel=iParticleswithPredYVel+1;
					ParticleswithPredYVel=VectorInsertion(ParticleswithPredYVel,iParticleswithPredYVel,sp);
				end
				
				thetacrackrtl=VectorInsertion(thetacrackrtl,sp,NaN);
				xdirletter=CellInsertion(xdirletter,sp,'t');
				ydirletter=CellInsertion(ydirletter,sp,'r');
				zdirletter=CellInsertion(zdirletter,sp,'l');
				xydirletter=CellInsertion(xydirletter,sp,'tr');
				yzdirletter=CellInsertion(yzdirletter,sp,'rl');
				xzdirletter=CellInsertion(xzdirletter,sp,'tl');
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				matmodel=VectorInsertion(matmodel,sp,2); %steel
				orientationoffset=VectorInsertion(orientationoffset,sp,NaN);
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				plotignore=VectorInsertion(plotignore,sp,0);
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				pforce_sp=MatrixInsertion(pforce_sp,sp,1,0);
				pforce_sp=MatrixInsertion(pforce_sp,sp,2,0);
			end
		end
	elseif CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		if CasetoRun==94
			x_end=8*le_base;
		else
			x_end=7*le_base;
		end
		y_start=2*le_base;
		y_end=7*le_base;
		
		movingindex=0;
		if CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90
			crackparticlespacing=pi/10; %relative to le_base
		elseif CasetoRun==89
			crackparticlespacing=1; %relative to le_base
		end
		if CasetoRun==86 || CasetoRun==87 || CasetoRun==89 || CasetoRun==90 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99
			crackparticleend=9.5;
		elseif CasetoRun==91
			crackparticleend=8.5;
		end
		for movingcoordinate=0.5:crackparticlespacing:crackparticleend
			movingindex=movingindex+1;
			
			x_crack{1}(movingindex,1)=movingcoordinate*le_base;
			if CasetoRun==86
				x_crack{1}(movingindex,2)=(4+7/8)*le_base;
			elseif CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==89
				x_crack{1}(movingindex,2)=(4+1/2)*le_base;
			elseif CasetoRun==97
				x_crack{1}(movingindex,2)=(4)*le_base;
			elseif CasetoRun==99
				x_crack{1}(movingindex,2)=(4+1/8)*le_base;		
			elseif CasetoRun==90
				x_crack{1}(movingindex,2)=(6+1/8)*le_base;
			else
				fprintf('%s',['CasetoRun Error! 1904101734' char(10)]);
				pause;
				1;
			end
			
			if CasetoRun==86
				x_crack{2}(movingindex,1)=(4+7/8)*le_base;
			elseif CasetoRun==87 || CasetoRun==95
				x_crack{2}(movingindex,1)=(4+1/2)*le_base;
			elseif CasetoRun==97
				x_crack{2}(movingindex,1)=(4)*le_base;
			elseif CasetoRun==99
				x_crack{2}(movingindex,1)=(4+1/8)*le_base;
			elseif CasetoRun==91
				x_crack{2}(movingindex,1)=(9+1/2)*le_base;
			elseif CasetoRun==92
				x_crack{2}(movingindex,1)=(9+1/2)*le_base;
			elseif CasetoRun==94
				x_crack{2}(movingindex,1)=(6.5)*le_base;
			elseif CasetoRun==93
				x_crack{2}(movingindex,1)=(10+1/2)*le_base;
			elseif CasetoRun==90
				x_crack{2}(movingindex,1)=(6+1/8)*le_base;
			elseif CasetoRun==89
			else
				fprintf('%s',['CasetoRun Error! 1904101735' char(10)]);
				pause;
				1;
			end
			
			if CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90
				x_crack{2}(movingindex,2)=movingcoordinate*le_base;
			elseif CasetoRun==89
			else
				fprintf('%s',['CasetoRun Error! 1904101939' char(10)]);
				pause;
				1;
			end
		end
		
		x_cracktop=x_crack;
		x_crackbot=x_crack;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				%if x_trial>2*le_base && x_trial<8*le_base && y_trial>2*le_base && y_trial<6*le_base
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial>y_end
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl=VectorInsertion(thetacrackrtl,sp,NaN);
				xdirletter=CellInsertion(xdirletter,sp,'t');
				ydirletter=CellInsertion(ydirletter,sp,'r');
				zdirletter=CellInsertion(zdirletter,sp,'l');
				xydirletter=CellInsertion(xydirletter,sp,'tr');
				yzdirletter=CellInsertion(yzdirletter,sp,'rl');
				xzdirletter=CellInsertion(xzdirletter,sp,'tl');
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				%if y_trial<4*le_base
					matmodel=VectorInsertion(matmodel,sp,2); %steel
					orientationoffset=VectorInsertion(orientationoffset,sp,NaN);
				%else
				%	matmodel(sp)=1; %wood_schmidt7
				%	orientationoffset(sp)=0;
				%end
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				plotignore=VectorInsertion(plotignore,sp,0);
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				%{
				if y_trial<2*le_base+lp(2);
					yparticledamped=[yparticledamped sp];
				end
				%}
				%{
				if y_trial>4*le_base
					epsilonshrinkdotx_sp(sp,1)=-0.02;
					%epsilonshrinkdoty_sp(sp,1)=-0.01;
				else
					epsilonshrinkdotx_sp(sp,1)=0;
					%epsilonshrinkdoty_sp(sp,1)=0;
				end
				%}
				%epsilonshrinkdot_sp(sp,1)=-0.02*(y_trial-y_start)/(y_end-y_start);
			end
		end
	elseif CasetoRun==85
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=1*le_base;
		x_end=3*le_base;
		y_start=1*le_base;
		y_end=3*le_base;
		
		x_crack.npaths=2;
		x_crack.nparticles(1:2)=2;
		
		x_crack.center(1,1,1)=0.5*le_base;
		x_crack.center(1,2,1)=15/8*le_base;
		x_crack.center(2,1,1)=3.5*le_base;
		x_crack.center(2,2,1)=15/8*le_base;
		
		x_crack.center(1,1,2)=15/8*le_base;
		x_crack.center(1,2,2)=3.5*le_base;
		x_crack.center(2,1,2)=15/8*le_base;
		x_crack.center(2,2,2)=0.5*le_base;
		
		x_crack.top=x_crack.center;
		x_crack.bot=x_crack.center;

		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				%if x_trial>2*le_base && x_trial<8*le_base && y_trial>2*le_base && y_trial<6*le_base
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial>y_end
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl=VectorInsertion(thetacrackrtl,sp,NaN);
				xdirletter=CellInsertion(xdirletter,sp,'t');
				ydirletter=CellInsertion(ydirletter,sp,'r');
				zdirletter=CellInsertion(zdirletter,sp,'l');
				xydirletter=CellInsertion(xydirletter,sp,'tr');
				yzdirletter=CellInsertion(yzdirletter,sp,'rl');
				xzdirletter=CellInsertion(xzdirletter,sp,'tl');
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				%if y_trial<4*le_base
					matmodel=VectorInsertion(matmodel,sp,2); %steel
					orientationoffset=VectorInsertion(orientationoffset,sp,NaN);
				%else
				%	matmodel(sp)=1; %wood_schmidt7
				%	orientationoffset(sp)=0;
				%end
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				plotignore=VectorInsertion(plotignore,sp,0);
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				%{
				if y_trial<2*le_base+lp(2);
					yparticledamped=[yparticledamped sp];
				end
				%}
				%{
				if y_trial>4*le_base
					epsilonshrinkdotx_sp(sp,1)=-0.02;
					%epsilonshrinkdoty_sp(sp,1)=-0.01;
				else
					epsilonshrinkdotx_sp(sp,1)=0;
					%epsilonshrinkdoty_sp(sp,1)=0;
				end
				%}
				%epsilonshrinkdot_sp(sp,1)=-0.02*(y_trial-y_start)/(y_end-y_start);
			end
		end
	elseif CasetoRun==79 || CasetoRun==80
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		x_end=22*le_base;
		y_start=2*le_base;
		y_end=10*le_base;
		
		x_crack.npaths=1;
		x_crack.nparticles(1)=3;
		
		x_crack.center(1,1,1)=60+le_base/2;
		x_crack.center(1,2,1)=55;
		x_crack.center(2,1,1)=60+le_base/2;
		x_crack.center(2,2,1)=46;
		x_crack.center(3,1,1)=60+le_base/2;
		x_crack.center(3,2,1)=41;
		
		x_crack.top=x_crack.center;
		x_crack.bot=x_crack.center;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				%if x_trial>2*le_base && x_trial<8*le_base && y_trial>2*le_base && y_trial<6*le_base
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial>y_end
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl=VectorInsertion(thetacrackrtl,sp,NaN);
				xdirletter=CellInsertion(xdirletter,sp,'t');
				ydirletter=CellInsertion(ydirletter,sp,'r');
				zdirletter=CellInsertion(zdirletter,sp,'l');
				xydirletter=CellInsertion(xydirletter,sp,'tr');
				yzdirletter=CellInsertion(yzdirletter,sp,'rl');
				xzdirletter=CellInsertion(xzdirletter,sp,'tl');
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				if y_trial<4*le_base
					matmodel=VectorInsertion(matmodel,sp,2); %steel
					orientationoffset=VectorInsertion(orientationoffset,sp,NaN);
				else
					matmodel=VectorInsertion(matmodel,sp,1); %wood_schmidt7
					orientationoffset=VectorInsertion(orientationoffset,sp,0);
				end
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				plotignore=VectorInsertion(plotignore,sp,0);
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				%{
				if y_trial<2*le_base+lp(2);
					yparticledamped=[yparticledamped sp];
				end
				%}
				%{
				if y_trial>4*le_base
					epsilonshrinkdotx_sp(sp,1)=-0.02;
					%epsilonshrinkdoty_sp(sp,1)=-0.01;
				else
					epsilonshrinkdotx_sp(sp,1)=0;
					%epsilonshrinkdoty_sp(sp,1)=0;
				end
				%}
				epsilonshrinkdot_sp=MatrixInsertion(epsilonshrinkdot_sp,sp,1,-0.02*(y_trial-y_start)/(y_end-y_start));
			end
		end
	elseif CasetoRun==77
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		x_end=22*le_base;
		y_start=2*le_base;
		y_end=10*le_base;
		
		x_crack.npaths=1;
		x_crack.center(:,2,1)=transpose([57.5:-1.25:2.5]);
		x_crack.center(:,1,1)=60;
		x_crack.nparticles(1)=size(x_crack.center,1);
		
		x_crack.top=x_crack.center;
		x_crack.bot=x_crack.center;
		
		ncforce_cracktop=zeros(x_crack.nparticles(1),2);
		ncforce_crackbot=zeros(x_crack.nparticles(1),2);
		%ncforce_cracktop(8:38,1)=100*(le(2)/4);
		%ncforce_crackbot=-ncforce_cracktop;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				%if x_trial>2*le_base && x_trial<8*le_base && y_trial>2*le_base && y_trial<6*le_base
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial>y_end
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				thetacrackrtl=VectorInsertion(thetacrackrtl,sp,NaN);
				xdirletter=CellInsertion(xdirletter,sp,'t');
				ydirletter=CellInsertion(ydirletter,sp,'r');
				zdirletter=CellInsertion(zdirletter,sp,'l');
				xydirletter=CellInsertion(xydirletter,sp,'tr');
				yzdirletter=CellInsertion(yzdirletter,sp,'rl');
				xzdirletter=CellInsertion(xzdirletter,sp,'tl');
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				matmodel=VectorInsertion(matmodel,sp,1); %wood_schmidt7
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				plotignore=VectorInsertion(plotignore,sp,0);
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				orientationoffset=VectorInsertion(orientationoffset,sp,0);
				%{
				if y_trial<2*le_base+lp(2);
					yparticledamped=[yparticledamped sp];
				end
				%}
				%{
				if y_trial>4*le_base
					epsilonshrinkdotx_sp(sp,1)=-0.02;
					%epsilonshrinkdoty_sp(sp,1)=-0.01;
				else
					epsilonshrinkdotx_sp(sp,1)=0;
					%epsilonshrinkdoty_sp(sp,1)=0;
				end
				%}
				epsilonshrinkdot_sp=MatrixInsertion(epsilonshrinkdot_sp,sp,1,0);
			end
		end
	elseif CasetoRun==67
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		x_end=22*le_base;
		y_start=2*le_base;
		y_end=6*le_base;
		
		x_crack.npaths=1;
		x_crack.nparticles(1)=3;

		
		x_crack.center(1,1,1)=60.1;
		x_crack.center(1,2,1)=30.1;
		x_crack.center(2,1,1)=60.1;
		x_crack.center(2,2,1)=21.1;
		x_crack.center(3,1,1)=60.1;
		x_crack.center(3,2,1)=20.1;
		
		x_crack.top=x_crack.center;
		x_crack.bot=x_crack.center;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				%if x_trial>2*le_base && x_trial<8*le_base && y_trial>2*le_base && y_trial<6*le_base
				if x_trial<x_start
					continue;
				elseif x_trial<x_end
					if y_trial<y_start
						continue;
					elseif y_trial>y_end
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				
				xdirletter=CellInsertion(xdirletter,sp,[]);
				ydirletter=CellInsertion(ydirletter,sp,[]);
				zdirletter=CellInsertion(zdirletter,sp,[]);
				xydirletter=CellInsertion(xydirletter,sp,[]);
				yzdirletter=CellInsertion(yzdirletter,sp,[]);
				xzdirletter=CellInsertion(xzdirletter,sp,[]);
				x_sp=MatrixInsertion(x_sp,sp,1:2,[x_trial y_trial]);
				matmodel=VectorInsertion(matmodel,sp,2); %elastic (can be steel rubber or whatever)
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				plotignore=VectorInsertion(plotignore,sp,0);
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				orientationoffset=VectorInsertion(orientationoffset,sp,0);
				
				if y_trial<2*le_base+lp(2);
					yparticledamped=VectorInsertion(yparticledamped,length(yparticledamped)+1,sp);
				end

				epsilonshrinkdot_sp=MatrixInsertion(epsilonshrinkdot_sp,sp,1,-0.02);
				
			end
		end
	elseif CasetoRun==65 || CasetoRun==70
		particle_per_cell       = 4;
		%spCount                 = 5*4*particle_per_cell;
		%spCount                 = 5*4*particle_per_cell-((30-7*2)*2);
		lp(1)                   = le(1)/sqrt(particle_per_cell);                                 % size of particle in X direction
		lp(2)                   = lp(1);                              % size of particle in Y direction

		pforce_sp=[];
		pforce_sp_sp=[];
		epsilonshrinkdot_sp=[];
		epsilonshrinkdotx_sp=[];
		epsilonshrinkdoty_sp=[];

		sp=0;
		sp_predvelnum=0;
		displacementmonitoredparticles=[];
		
		x_start=2*le_base;
		x_end=8*le_base;
		y_start=1*le_base;
		y_end=8*le_base;
		
		x_crack.npaths=1;
		x_crack.nparticles(1)=6;
		
		x_crack.center(1,1,1)=20;
		x_crack.center(1,2,1)=37;
		x_crack.center(2,1,1)=22;
		x_crack.center(2,2,1)=37;
		x_crack.center(3,1,1)=32;
		x_crack.center(3,2,1)=37;
		x_crack.center(4,1,1)=42;
		x_crack.center(4,2,1)=37;
		x_crack.center(5,1,1)=51;
		x_crack.center(5,2,1)=37;
		x_crack.center(6,1,1)=52;
		x_crack.center(6,2,1)=37;
		
		x_crack.top=x_crack.center;
		x_crack.bot=x_crack.center;
		
		for i=1:(NN(2)-1)*sqrt(particle_per_cell);
			y_trial=(lp(2)/2)+(i-1)*lp(2);
			for j=1:(NN(1)-1)*sqrt(particle_per_cell);
				x_trial=(lp(1)/2)+(j-1)*lp(1);
				%if x_trial>2*le_base && x_trial<8*le_base && y_trial>2*le_base && y_trial<6*le_base
				if x_trial<x_start
					continue;
				elseif x_trial<x_start+1*le_base
					if y_trial<y_start
						continue;
					elseif y_trial>y_end
						continue;
					end
				elseif x_trial<x_end
					if y_trial<y_start+1*le_base
						continue;
					elseif y_trial>y_end-3*le_base
						continue;
					end
				else
					continue;
				end
				
				sp=sp+1;
				
				xdirletter=CellInsertion(xdirletter,sp,[]);
				ydirletter=CellInsertion(ydirletter,sp,[]);
				zdirletter=CellInsertion(zdirletter,sp,[]);
				xydirletter=CellInsertion(xydirletter,sp,[]);
				yzdirletter=CellInsertion(yzdirletter,sp,[]);
				xzdirletter=CellInsertion(xzdirletter,sp,[]);
				x_sp=MatrixInsertion(x_sp,sp,1,x_trial);
				x_sp=MatrixInsertion(x_sp,sp,2,y_trial);
				matmodel=VectorInsertion(matmodel,sp,2); %elastic (can be steel rubber or whatever)
				p_sp=MatrixInsertion(p_sp,sp,1,psp2);
				plotignore=VectorInsertion(plotignore,sp,0);
				weakeningfactor_sp=VectorInsertion(weakeningfactor_sp,sp,0);
				orientationoffset=VectorInsertion(orientationoffset,sp,0);
				
				if x_trial>7*le_base+lp(1);
					yparticledamped=VectorInsertion(yparticledamped,length(yparticledamped)+1,sp);
				end
				
			end
		end
	end
	
	spCount=sp;

	d_sp                    = zeros(spCount,2);
	E_acc                   = zeros(spCount,1);
	%{
	if exist('epsilonshrinkdot_sp')
	else
		epsilonshrinkdot_sp     = zeros(spCount,1);
	end
	if exist('epsilonshrinkdotx_sp')
	else
		epsilonshrinkdotx_sp     = zeros(spCount,1);
	end
	if exist('epsilonshrinkdoty_sp')
	else
		epsilonshrinkdoty_sp     = zeros(spCount,1);
	end
	if exist('pforce_sp')
	else
		pforce_sp               = zeros(spCount,2);
	end
	%}
	
	s_sp=zeros(spCount,3);
	pforce_sp=zeros(spCount,2);
	e_t_global_big=zeros(spCount,6);
	e_pl_global_big=zeros(spCount,6);
	alphahp=zeros(spCount,7);
	
	
%{
%switchable1
	if size(epsilonshrinkdot_sp,1)==0
		epsilonshrinkdot_sp=ResizeMatrix(epsilonshrinkdot_sp,spCount,1);
	end
	if size(epsilonshrinkdotx_sp,1)==0
		epsilonshrinkdotx_sp=zeros(spCount,1);
	end
	if size(epsilonshrinkdoty_sp,1)==0
		epsilonshrinkdoty_sp=zeros(spCount,1);
	end
	if size(pforce_sp,1)==0
		pforce_sp=zeros(spCount,2);
	end
	%evaltimes_accummulated  = zeros(spCount,1);
%}
%switchable1

	%{
	for i=1:6
		for j=1:30
			%if (j>7 & j<24) & (i==1|i==6)
			%    continue;
			%end
			sp=sp+1;
			if sp>spCount
				disp('spCount wrong!');
				pause;
			end
			x_sp(sp,1:2)= [4*le(1,1)+0.5*lp(1,1)+(j-1)*lp(1,1) 4*le(1,2)+0.5*lp(1,2)+(i-1)*lp(1,2)];
			if j==15
				sp_predvelnum=sp_predvelnum+1;
				displacementmonitoredparticles(sp_predvelnum)=sp;
			end
			xdirletter{sp}='l';
			ydirletter{sp}='r';
			zdirletter{sp}='t';
			xydirletter{sp}='lr';
			yzdirletter{sp}='rt';
			xzdirletter{sp}='lt';
		end
	end
	%}
	% x_sp: Vector, position of MPs
	% spCount: total number of MPs

	%DELTAt=k*DELTAt_critical


	%% Plot initial condition
%{
%switchable1
	if Debugging.Active==0
		if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==21 || CasetoRun==17 || CasetoRun==4 || CasetoRun==7 || CasetoRun==5 || CasetoRun==6
			initial_figure = Plot_Initial(x_sp,LOC,le,orientationoffset,xdirletter,ydirletter,lp);
		elseif CasetoRun==10
			initial_figure = Plot_Initial_sp(x_sp,LOC,le,orientationoffset,xdirletter,ydirletter,lp);
		elseif CasetoRun==8 || CasetoRun==9
			initial_figure = Plot_Initial_var(x_sp,LOC,LOCX,LOCY,orientationoffset,xdirletter,ydirletter,lp);
		elseif CasetoRun==11 || CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==56 || CasetoRun==60 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==15 || CasetoRun==14
			initial_figure = Plot_Initial_linehighlighted(x_sp,LOC,le,orientationoffset,xdirletter,ydirletter,lp);
		elseif CasetoRun==61 || CasetoRun==62 || CasetoRun==63
			if runorjustplot==0
				initial_figure = Plot_Initial_squishy(x_sp,LOC,le,orientationoffset,xdirletter,ydirletter,lp,matmodel);
			else
				initial_figure = Plot_Initial_squishy2(x_sp,LOC,le,orientationoffset,xdirletter,ydirletter,lp,matmodel);
			end
		elseif CasetoRun==12 || CasetoRun==16 || CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44
			initial_figure = Plot_Initial_linehighlighted2(x_sp,LOC,le,orientationoffset,xdirletter,ydirletter,lp);
		elseif CasetoRun==64 || CasetoRun==66 || CasetoRun==69 || CasetoRun==67 || CasetoRun==68 || CasetoRun==71 || CasetoRun==72 || CasetoRun==73 || CasetoRun==74 || CasetoRun==78 || CasetoRun==81 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==83 || CasetoRun==77 || CasetoRun==65 || CasetoRun==70
			initial_figure = Plot_Initial(x_sp,LOC,le,orientationoffset,xdirletter,ydirletter,lp);
		elseif CasetoRun==84 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124 || CasetoRun==117 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110 || CasetoRun==96 || CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89 || CasetoRun==85
			initial_figure = Plot_Initial_crackmulti(x_sp,LOC,le,orientationoffset,xdirletter,ydirletter,lp,x_crack,CasetoRun);
		elseif CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174
			initial_figure = Plot_Initial_crackmulti_r_sp(r1_sp,r2_sp,x_sp,LOC,le,orientationoffset,xdirletter,ydirletter,lp,x_crack,CasetoRun);
		end
	end
%}
%switchable1
	
	%% Particle variables
	dparticle               = lp(1)*lp(2);                          % area of particle domain
	x_spo                   = x_sp;                                 % initial position
	d_sp                    = zeros(spCount,2);                     % displacement
	s_sp                    = zeros(spCount,3);                     % Stress tensor
	ds_sp                   = zeros(spCount,3);                     % Stress increment
	if CasetoRun==154 || CasetoRun==161
		v_ssp=v_ssp_0;
	else
		v_ssp               = zeros(spCount,2);                     % velocty
	end
	e_sp                    = zeros(spCount,3);                     % Strain tensor
	de_sp                   = zeros(spCount,3);                     % Strain increment
	ptraction_sp            = zeros(spCount,2);                     % traction
	F_sp                    = cell(spCount,1);                      % Gradient deformation
	e_pl_sp                 = zeros(spCount,3);
	sigma_local_big         = zeros(spCount,6);
	sigma_global_big        = zeros(spCount,6);
	e_t_global_big          = zeros(spCount,6);
	e_pl_global_big         = zeros(spCount,6);
	alphahp                 = zeros(spCount,7);
	f_final_vect            = zeros(spCount,7);
	surfacewithfmax         = zeros(1,spCount);
	E_acc                   = zeros(1,spCount);
	evaltimes               = zeros(spCount,1);
	stackvars               = zeros(spCount+1,2);
	duration                = zeros(1,spCount);
	dudx_sp                 = zeros(spCount,4); %11, 12, 21, 22
	W_sp                    = zeros(spCount,1);
	thetacrack              = zeros(1,spCount);
	%thetacrackrtl           = zeros(1,spCount);
	sigmainf                = 0;
	G                       = 0;
	Ga                      = 0;
	Grelativeerror          = 0;
	sigmamaxprincmaxperfy   = 0; %max of all nodes
	
	coder.varsize('f_final_vect');
	coder.varsize('surfacewithfmax');
	coder.varsize('E_acc');
	
	%rexp: exponential asymtotic approach of loading
	rexp.rs=zeros(1,1);
	rexp.rsdot=zeros(1,1);
	rexp.A=zeros(1,1);
	rexp.ts=zeros(1,1);
	rexp.switched=zeros(1,1);
	
	%pushcol: spring-damper as function of average radial distance/velocity
	pushcol.spcounter=zeros(1,1);
	pushcol.initialcalculated=zeros(1,1);
	pushcol.deltax.initial=zeros(spCount,2);
	pushcol.deltax.current=zeros(spCount,2);
	pushcol.theta.initial=zeros(1,spCount);
	pushcol.theta.current=zeros(1,spCount);
	pushcol.absolute_r_sp.initial=zeros(1,spCount);
	pushcol.absolute_r_sp.current=zeros(1,spCount);
	pushcol.relative_r_sp.current=zeros(1,spCount);
	pushcol.relative_r_sp.curavg=zeros(1,1);
	pushcol.relative_r_sp.coltgt=zeros(1,1);
	pushcol.relative_r_sp.delta=zeros(1,1);
	pushcol.relative_r_sp.springforce=zeros(1,1);
	pushcol.v_r_sp.current=zeros(1,spCount);
	pushcol.v_r_sp.curavg=zeros(1,1);
	pushcol.v_r_sp.coltgt=zeros(1,1);
	pushcol.v_r_sp.delta=zeros(1,1);
	pushcol.v_r_sp.dampforce=zeros(1,1);	
	
	%anerror: case 154 (vortex) velocity field error calculation (numerical vs analytical)
	anerror.gridsize=zeros(1,1);
	anerror.t_deviation=zeros(1,1);
	anerror.v_ssp_an=zeros(spCount,2);
	anerror.v_err_absolute=zeros(spCount,2);
	anerror.v_srsserror=zeros(1,1);
	anerror.v_srssan=zeros(1,1);
	anerror.v_err_relative=zeros(1,1);
	anerror.u_sp=zeros(spCount,2);
	anerror.u_sp_an=zeros(spCount,2);
	anerror.u_err_absolute=zeros(spCount,2);
	anerror.u_err_relative=zeros(1,1);
	anerror.u_srsserror=zeros(1,1);
	anerror.u_srssan=zeros(1,1);
	
	
	if CasetoRun==83 || CasetoRun==84 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124 || CasetoRun==117 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110 || CasetoRun==96 || CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89 || CasetoRun==85
		r1crack_sp = cell(1,1);
		r2crack_sp = cell(1,1);
		v_crack             = cell(x_crack.npaths);
		for i=1:length(x_crack)
			v_crack{i}      = zeros(x_crack.nparticles(i),2);
		end
	else
		v_crack             = zeros(size(x_crack));
	end
	

	%% Initial condition
	% Gradient deformation
	if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==21 || CasetoRun==17 || CasetoRun==4 || CasetoRun==5 || CasetoRun==6 || CasetoRun==7 || CasetoRun==10 || CasetoRun==11 || CasetoRun==12 || CasetoRun==16 || CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44 || CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==15 || CasetoRun==14 || CasetoRun==64 || CasetoRun==66 || CasetoRun==69 || CasetoRun==67 || CasetoRun==68 || CasetoRun==71 || CasetoRun==72 || CasetoRun==73 || CasetoRun==74 || CasetoRun==78 || CasetoRun==81 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==77 || CasetoRun==65 || CasetoRun==70
		r1crack_sp = cell(1,1);
		r2crack_sp = cell(1,1);
		for sp_inloop = 1:spCount
			r1_sp(sp_inloop,:) = [lp(1,1)/2 0];
			r2_sp(sp_inloop,:) = [0 lp(1,2)/2];
			F_sp{sp_inloop} = [1 0; 0 1];
		end

		Fcrack_sp=cell(1,size(x_crack.center,1));
		for spcrack=1:size(x_crack.center,1)
			r1crack_sp{1}=MatrixInsertion(r1crack_sp{1},spcrack,1,lp(1,1)/2);
			r1crack_sp{1}=MatrixInsertion(r1crack_sp{1},spcrack,2,0);
			Fcrack_sp{spcrack}=[1 0; 0 1];
		end
	elseif CasetoRun==154 || CasetoRun==161
		for sp_inloop = 1:spCount
			F_sp{sp_inloop} = [1 0; 0 1];
		end
		
		length_x_crack=x_crack.npaths;
		r1crack_sp = cell(1,length_x_crack);
		r2crack_sp = cell(1,length_x_crack);
		
		Fcrack_sp=cell(1,length_x_crack);
		
		for icrackpath=1:length_x_crack
			Fcrack_sp{icrackpath}=cell(1,x_crack.nparticles(icrackpath));
			r1crack_sp{icrackpath}=zeros(x_crack.nparticles(icrackpath),2);
			r2crack_sp{icrackpath}=zeros(x_crack.nparticles(icrackpath),2);
		end
		
		for icrackpath=1:length_x_crack
			for spcrack=1:size(x_crack.nparticles(icrackpath),1)
				r1crack_sp{icrackpath}(spcrack,1) = lp(1,1)/2;
				r1crack_sp{icrackpath}(spcrack,2) = 0;
				r2crack_sp{icrackpath}(spcrack,1) = 0;
				r2crack_sp{icrackpath}(spcrack,2) = lp(1,2)/2;
				Fcrack_sp{icrackpath}{spcrack} = [1 0; 0 1];		
			end
		end
	elseif CasetoRun==83 || CasetoRun==84 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124 || CasetoRun==117 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110 || CasetoRun==96 || CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89 || CasetoRun==85
		for sp_inloop = 1:spCount
			r1_sp(sp_inloop,:) = [lp(1,1)/2 0];
			r2_sp(sp_inloop,:) = [0 lp(1,2)/2];
			F_sp{sp_inloop} = [1 0; 0 1];
		end
		if CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174
			for isp=1:spCount
				r1_sp(isp,:)=transpose(rotate.R*(transpose(r1_sp(isp,:))));
				r2_sp(isp,:)=transpose(rotate.R*(transpose(r2_sp(isp,:))));
			end
		end
		length_x_crack=x_crack.npaths;
		r1crack_sp = cell(1,length_x_crack);
		r2crack_sp = cell(1,length_x_crack);
		
		Fcrack_sp=cell(1,length_x_crack);
		
		for icrackpath=1:length_x_crack
			Fcrack_sp{icrackpath}=cell(1,x_crack.nparticles(icrackpath));
			r1crack_sp{icrackpath}=zeros(x_crack.nparticles(icrackpath),2);
			r2crack_sp{icrackpath}=zeros(x_crack.nparticles(icrackpath),2);
		end
		
		for icrackpath=1:length_x_crack
			for spcrack=1:size(x_crack.nparticles(icrackpath),1)
				r1crack_sp{icrackpath}(spcrack,1) = lp(1,1)/2;
				r1crack_sp{icrackpath}(spcrack,2) = 0;
				r2crack_sp{icrackpath}(spcrack,1) = 0;
				r2crack_sp{icrackpath}(spcrack,2) = lp(1,2)/2;
				Fcrack_sp{icrackpath}{spcrack} = [1 0; 0 1];		
			end
		end
		
	elseif CasetoRun==8 || CasetoRun==9
		for sp_inloop = 1:spCount
			r1_sp(sp_inloop,:) = [lp(sp_inloop,1)/2 0];
			r2_sp(sp_inloop,:) = [0 lp(sp_inloop,2)/2];
			F_sp{sp_inloop} = [1 0; 0 1];
		end
	end
	r10_sp = r1_sp;
	r20_sp = r2_sp;
	%A_sp                    = zeros(spCount,1);
	t_sp                    = ones(spCount,1)*t0_plane;
	if CasetoRun==154 || CasetoRun==161
	else
		A_sp                    = 4.*abs(r1_sp(:,1).*r2_sp(:,2)-r1_sp(:,2).*r2_sp(:,1)); 
	end
	A_spo                   = A_sp;
	t_spo                   = t_sp;
	m_sp                    = p_sp.*A_sp.*t_sp;                           % mass
	
	% Traction
	%{
	for sp_inloop=1:spCount
		if x_sp(sp_inloop,1)>1.01
			ptraction_sp(sp_inloop,1) = 0;
		end
	end
	%}
	
	if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==21 || CasetoRun==17
		%dmax=-4*le_base;
		%{
		dmax=-0.2680*le_base;
		%dmax=-0.3*le_base;
		%t1=20*2;
		t1=4;
		t2=6;
		t3=10;
		t4=12;
		t5=16;
		%}
		%pforce_maxpres=-30;
		%pforce_max=pforce_maxpres*10/2;
	elseif CasetoRun==4
		dmax=-20;
		t1=10;
		
		pforce_maxpres=-30;
		pforce_max=pforce_maxpres*10/2;
	elseif CasetoRun==5 || CasetoRun==6
	elseif CasetoRun==7
	elseif CasetoRun==8 || CasetoRun==9
	elseif CasetoRun==10
	elseif CasetoRun==11
	elseif CasetoRun==12 || CasetoRun==16 || CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44
	elseif CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==15 || CasetoRun==14
	elseif CasetoRun==158
		
	end
	

	%{
	while sp<spCount+0.0001
		for i=1:6
			for j=1:24
				if j==24
					sp_predvelnum=sp_predvelnum+1;
					particleswithpredeterminedvelocities(sp_predvelnum)=sp;
					predeterminedvelocityvalueref(sp_predvelnum,:)=[1 0]; 
					%ptraction_sp(sp_predvelnum,1)=1000000;
				end
				sp=sp+1;
			end
		end
	end
	%}
	%% start the algorithm
	% video
	if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==21 || CasetoRun==17
		videofps=60;                              % video output fps
		timescale=0.5;                      % video speed-up factor
	elseif CasetoRun==4
		videofps=60;                              % video output fps
		timescale=1;                      % video speed-up factor
	elseif CasetoRun==5 || CasetoRun==6
		videofps=60;                              % video output fps
		timescale=0.5;                      % video speed-up factor
	elseif CasetoRun==7
		videofps=60;                              % video output fps
		timescale=0.5;                      % video speed-up factor
	elseif CasetoRun==8 || CasetoRun==9
		videofps=60;                              % video output fps
		timescale=0.5;                      % video speed-up factor
	elseif CasetoRun==10
		videofps=60;                              % video output fps
		timescale=0.5;                      % video speed-up factor
	elseif CasetoRun==11
		videofps=60;                              % video output fps
		timescale=0.5;                      % video speed-up factor
	elseif CasetoRun==12 || CasetoRun==16 || CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44
		videofps=60;                              % video output fps
		timescale=0.5;                      % video speed-up factor
	elseif CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==15 || CasetoRun==14
		videofps=60;                              % video output fps
		timescale=0.5;                      % video speed-up factor
	elseif CasetoRun==64 || CasetoRun==66 || CasetoRun==69 || CasetoRun==67 || CasetoRun==68 || CasetoRun==71 || CasetoRun==72 || CasetoRun==73 || CasetoRun==74 || CasetoRun==78 || CasetoRun==81 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==83 || CasetoRun==84 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==117 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110 || CasetoRun==96 || CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89 || CasetoRun==85 || CasetoRun==77 || CasetoRun==65 || CasetoRun==70
		videofps=60;                              % video output fps
		timescale=0.1;                      % video speed-up factor
	elseif CasetoRun==118 || CasetoRun==173
		videofps=60;                              % video output fps
		timescale=0.2/4/10;                      % video speed-up factor
		%timescale=0.2/1/10;
	elseif CasetoRun==182
		videofps=60;                              % video output fps
		timescale=dt*videofps; % 1:1 frame to timestep(dt)
		%timescale=dt*videofps*32; % 1:1 frame to timestep(dt)
	elseif CasetoRun==193
		videofps=60;                              % video output fps
		timescale=dt*videofps*64; % 1:1 frame to timestep(dt)
	elseif CasetoRun==187
		videofps=60;                              % video output fps
		timescale=dt*videofps; % 1:1 frame to timestep(dt)
		%timescale=dt*videofps*32; % 1:1 frame to timestep(dt)
	elseif CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189
		videofps=60;                              % video output fps
		timescale=dt*videofps*32*refinementfactor/16; % 1:1 frame to timestep(dt)
		%timescale=dt*videofps*32; % 1:1 frame to timestep(dt)
	elseif CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==177 || CasetoRun==178 || CasetoRun==169 || CasetoRun==165
		videofps=60;                              % video output fps
		timescale=dt*videofps; % 1:1 frame to timestep(dt)
		%timescale=dt*videofps*32; % 1:1 frame to timestep(dt)
    elseif CasetoRun==183
		videofps=60;                              % video output fps
		timescale=dt*videofps*10; % 1:1 frame to timestep(dt)
		%timescale=dt*videofps*32; % 1:1 frame to timestep(dt)
	elseif CasetoRun==179
		videofps=60;                              % video output fps
		timescale=dt*videofps*32; % 32x skip frame to timestep(dt)
	elseif CasetoRun==171 || CasetoRun==166
		videofps=60;                              % video output fps
		%timescale=dt*videofps; % 1:1 frame to timestep(dt)
		timescale=dt*videofps*128; % 1:1 frame to timestep(dt)
	
	elseif CasetoRun==127 || CasetoRun==125 || CasetoRun==126 || CasetoRun==129 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==134 || CasetoRun==138
		videofps=60;                              % video output fps
		timescale=0.2/4/10;                      % video speed-up factor
	elseif CasetoRun==139 || CasetoRun==140 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142
		videofps=60;                              % video output fps
		timescale=0.2/4;                      % video speed-up factor
	elseif CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==152 || CasetoRun==153 || CasetoRun==147 || CasetoRun==145
		videofps=60;                              % video output fps
		timescale=0.5;                      % video speed-up factor
		%timescale=dt*videofps; % 1:1 frame to timestep(dt)
	elseif CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174
		videofps=60;                              % video output fps
		timescale=0.1;                      % video speed-up factor
		%timescale=0.5;                      % video speed-up factor
		%timescale=dt*videofps; % 1:1 frame to timestep(dt)		
	elseif CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180
		videofps=60;                              % video output fps
		timescale=0.5;                      % video speed-up factor
		%timescale=dt*videofps; % 1:1 frame to timestep(dt)
	elseif CasetoRun==154
		videofps=60;                              % video output fps
		%timescale=resolution*dt*videofps; % 1:resolution frame to timestep(dt)
		timescale=dt*videofps; % 1:resolution frame to timestep(dt)
	elseif CasetoRun==161
		videofps=60;
		timescale=dt*videofps; % 1:resolution frame to timestep(dt)
	elseif CasetoRun==136
		videofps=60;                              % video output fps
		timescale=0.5/200;                      % video speed-up factor	
		timescale=dt*videofps; % 1:1 frame to timestep(dt)
	elseif CasetoRun==135
		videofps=60;                              % video output fps
		timescale=0.5;                      % video speed-up factor	
	elseif CasetoRun==128 || CasetoRun==130
		%1:1 frame to timestep(dt)
		videofps=60;                              % video output fps
		timescale=dt*videofps; % 1:1 frame to timestep(dt)
	elseif CasetoRun==124
		videofps=60;                              % video output fps
		%timescale=0.2/refinementfactor;                      % video speed-up factor
		timescale=0.2/5*40;                      % video speed-up factor
	elseif CasetoRun==137
		videofps=60;                              % video output fps
		timescale=0.2/4/10;                      % video speed-up factor	
	end
	timestep = videofps*ftime/timescale;     % number of frame to save
	%r=timestep/ftime;      % number of frame per second video ~200s
	autosavetimeinterval=2.5;
	autosaveruntimeinterval=60*10; %autosave run-time interval in secodns
	fprintf('%s',['Running ' mfilename '-' int2txt(CasetoRun) char(10)]);
	
%{
%switchable1
	if exist('refinemenfactorinput')
		disp(['refinementfactor=' int2txt(refinementfactor)]);
		uiload;
	elseif Debugging.Active==0
		uiload;
	else
		load(Debugging.FileName);
		disp([Debugging.FileName ' loaded']);
	end
	if runorjustplot==1
		ttstart=1;
		ttstart=input('new ttstart? (default is 1) ');
	elseif runorjustplot==2
		ttstart=tt;
	end
	justloadedyo=1;
	if CasetoRun==14
		sourcefilename=TimeStampedName;
	end

	TimeStampedNameNew=[mfilename '-' int2txt(CasetoRun) '_' casename];
	TimeStampedNameBasic=TimeStampedNameNew;
	if dtoverride
		TimeStampedNameNew=[TimeStampedNameNew '-ms=' float2txt(0,massscalingfactor)];
	end
	if CasetoRun==14
		TimeStampedNameNew=[TimeStampedNameNew '-cores=' int2txt(numberofcores)];
	elseif CasetoRun==19 || CasetoRun==21
		TimeStampedNameNew=[TimeStampedNameNew '-RF=' float2txt(0,ReductionFactor)];
	elseif CasetoRun==26 || CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124 || CasetoRun==117
		TimeStampedNameNew=[TimeStampedNameNew '-RefLvl=' int2txt(refinementfactor)];
	elseif CasetoRun==27
		currentgcp=gcp;
		TimeStampedNameNew=[TimeStampedNameNew '-cores=' int2txt(currentgcp.NumWorkers)];
	end
	if exist('refinemenfactorinput')
		try
			load([TimeStampedNameNew '-Master.mat']);
		catch
		end
	end
	if exist('tt')
		if exist('IsItDump')
			clear IsItDump;
		else
			if exist('refinemenfactorinput')
			else
				tt=input('New tt? (type tt for no change) ');
			end
			load([TimeStampedName '\\' int2txt(tt) '.mat']);
		end
		if CompareTexts(TimeStampedName,TimeStampedNameNew)==0;
			copyfile([TimeStampedName '-Master.mat'],[TimeStampedNameNew '-Master.mat']);
			mkdir(TimeStampedNameNew);
			if CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==17
				mkdir([TimeStampedNameNew '\\evaltimes']);
			end
			if CasetoRun==27
				mkdir([TimeStampedNameNew '\\scheduleotf']); %put up top
			end
			
			for i=1:tt
				try
					copyfile([TimeStampedName '\\' int2txt(i) '.mat'],TimeStampedNameNew);
				catch
					1;
				end
			end
		end

	else
%}
%switchable1
		tt=1;
		TLD=[];
		coder.varsize('TLD');
		ntt=0;
		
%{
%switchable1
		mkdir(TimeStampedNameNew)
		if CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==17
			mkdir([TimeStampedNameNew '\\evaltimes']);
		end
		if CasetoRun==27
			mkdir([TimeStampedNameNew '\\scheduleotf']);
		end
	end
	TimeStampedName=TimeStampedNameNew;
	%autosavetimemodprev=0;
%}
%switchable1
%[
%switchable1
	if CasetoRun==161
		TimeStampedName=['Out-' VersionNum '-Case_' int2txt(CasetoRun) '-' casenamelist{CasetoRun} '-' int2txt(refinementfactor)];
	else
		TimeStampedName=['Out-' VersionNum '-Case_' int2txt(CasetoRun) '-' casenamelist{CasetoRun}];
	end
%]
%switchable1	
%{
%switchable2
%{
%switchable3
	try
%}
%switchable3
		tt=loadsinglelong([TimeStampedName '-Master-' 'tt' '.txt']);
%{
%switchable3
	catch
	end
%}
%switchable3
	
	if tt>1
		TLD=loadmatrixfloat([TimeStampedName '-Master-' 'TLD' '.txt']);
		ttstart=loadsinglelong([TimeStampedName '-Master-' 'ttstart' '.txt']);
		
		t_time=loadsinglefloat([TimeStampedName '-Slave-' 't_time' '-' int2txt(tt) '.txt']);
		v_ssp=loadmatrixfloat([TimeStampedName '-Slave-' 'v_ssp' '-' int2txt(tt) '.txt']);
		x_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'x_sp' '-' int2txt(tt) '.txt']);
		F_sp=loadcellmatrixfloat([TimeStampedName '-Slave-' 'F_sp' '-' int2txt(tt) '.txt']);
		A_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'A_sp' '-' int2txt(tt) '.txt']);
		t_sp=loadmatrixfloat([TimeStampedName '-Slave-' 't_sp' '-' int2txt(tt) '.txt']);
		s_sp=loadmatrixfloat([TimeStampedName '-Slave-' 's_sp' '-' int2txt(tt) '.txt']);
		p_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'p_sp' '-' int2txt(tt) '.txt']);
		r1_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r1_sp' '-' int2txt(tt) '.txt']);
		r2_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r2_sp' '-' int2txt(tt) '.txt']);
		F_rollerX=loadmatrixfloat([TimeStampedName '-Slave-' 'F_rollerX' '-' int2txt(tt) '.txt']);
		F_rollerY=loadmatrixfloat([TimeStampedName '-Slave-' 'F_rollerY' '-' int2txt(tt) '.txt']);
		E_acc=loadmatrixfloat([TimeStampedName '-Slave-' 'E_acc' '-' int2txt(tt) '.txt']);
		e_pl_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'e_pl_sp' '-' int2txt(tt) '.txt']);
		sigma_global_big=loadmatrixfloat([TimeStampedName '-Slave-' 'sigma_global_big' '-' int2txt(tt) '.txt']);
		e_t_global_big=loadmatrixfloat([TimeStampedName '-Slave-' 'e_t_global_big' '-' int2txt(tt) '.txt']);
		e_pl_global_big=loadmatrixfloat([TimeStampedName '-Slave-' 'e_pl_global_big' '-' int2txt(tt) '.txt']);
		alphahp=loadmatrixfloat([TimeStampedName '-Slave-' 'alphahp' '-' int2txt(tt) '.txt']);
		f_final_vect=loadmatrixfloat([TimeStampedName '-Slave-' 'f_final_vect' '-' int2txt(tt) '.txt']);
		surfacewithfmax=loadmatrixfloat([TimeStampedName '-Slave-' 'surfacewithfmax' '-' int2txt(tt) '.txt']);
		sigma_local_big=loadmatrixfloat([TimeStampedName '-Slave-' 'sigma_local_big' '-' int2txt(tt) '.txt']);
		DispPump=loadsinglefloat([TimeStampedName '-Slave-' 'DispPump' '-' int2txt(tt) '.txt']);
		evaltimes=loadmatrixfloat([TimeStampedName '-Slave-' 'evaltimes' '-' int2txt(tt) '.txt']);
		stackvars=loadmatrixfloat([TimeStampedName '-Slave-' 'stackvars' '-' int2txt(tt) '.txt']);
		duration=loadmatrixfloat([TimeStampedName '-Slave-' 'duration' '-' int2txt(tt) '.txt']);
		x_crack=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crack' '-' int2txt(tt) '.txt']);
		x_cracktop=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_cracktop' '-' int2txt(tt) '.txt']);
		x_crackbot=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crackbot' '-' int2txt(tt) '.txt']);
		dudx_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'dudx_sp' '-' int2txt(tt) '.txt']);
		W_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'W_sp' '-' int2txt(tt) '.txt']);
		thetacrackrtl=loadmatrixfloat([TimeStampedName '-Slave-' 'thetacrackrtl' '-' int2txt(tt) '.txt']);
		thetacrack=loadmatrixfloat([TimeStampedName '-Slave-' 'thetacrack' '-' int2txt(tt) '.txt']);
		pforce_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'pforce_sp' '-' int2txt(tt) '.txt']);
		sigmainf=loadsinglefloat([TimeStampedName '-Slave-' 'sigmainf' '-' int2txt(tt) '.txt']);
		G=loadsinglefloat([TimeStampedName '-Slave-' 'G' '-' int2txt(tt) '.txt']);
		Ga=loadsinglefloat([TimeStampedName '-Slave-' 'Ga' '-' int2txt(tt) '.txt']);
		Grelativeerror=loadsinglefloat([TimeStampedName '-Slave-' 'Grelativeerror' '-' int2txt(tt) '.txt']);
		ntforce_si=loadmatrixfloat([TimeStampedName '-Slave-' 'ntforce_si' '-' int2txt(tt) '.txt']);
	end

%}
%switchable2
	%AccummulatedTocReductor=0; %looks like no use anymore
%{
%switchable1
	if exist('DispPump')==0
		DispPump=0;
	end
	if CasetoRun==14
		tic;
		elapsedtime=[];
		starttimestep=[];
		 endtimestep=[];
	end
%}
%switchable1



%[
%switchable1
	DispPump=0;
	t_time=0;
	rampfactor=0;
	rampfactordot=0;
	rampfactordoubledot=0;
	pforce_sp_save.saved=zeros(1,1);
	pforce_sp_save.values=zeros(spCount,2);
	n_iter=1;
%]
%switchable1
%[
%switchable2
	savesinglelong(ttstart,[TimeStampedName '-Master-' 'ttstart' '.txt']);
%]
%switchable2
    while tt<=timestep
		
		1;
		1;
		1;
		1;
		1;
		%{
		simulationbreaksignal=1;
		simulationbreaksignal=1;
		simulationbreaksignal=1;
		%}
		if CasetoRun==5
			if tt==2399+1
				simulationbreaksignal=1;
			end
		end
		if simulationbreaksignal
			tt=tt+1;
			break
		end
		
		ft              = ftime/timestep*tt;
		%     ft=ftime;
		
		
		
		while t_time<ft+0.0000000001
			justloadedyo=0;
			
			PredXDisp=0;
			PredYDisp=0;
			PredXDisp2=0;
			PredYDisp2=0;

			PredXVel=0;
			PredXAcc=0;
			PredYVel=0;
			PredYAcc=0;
			PredXVel2=0;
			PredXAcc2=0;
			PredYVel2=0;
			PredYAcc2=0;
			ParticlePredYVel=0;
			sigmainf=0;
			if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==21 || CasetoRun==17
				if mod(t_time,(loadtime+pausetime))<=loadtime
					PredYVel=(dispload*pi*sin((pi*mod(t_time,(loadtime+pausetime)))/loadtime))/(2*loadtime);
					PredYAcc=(dispload*pi^2*cos((pi*mod(t_time,(loadtime+pausetime)))/loadtime))/(2*loadtime^2);
				else
					PredYVel=0;
					PredYAcc=0;
				end            
				DispPump=DispPump+PredYVel*dt;
			elseif CasetoRun==54
				if mod(t_time,(loadtime+pausetime))<=loadtime
					PredYVel=dispload/loadtime;
					PredYAcc=0;
				else
					PredYVel=0;
					PredYAcc=0;
				end
				DispPump=DispPump+PredYVel*dt;
			elseif CasetoRun==4
				if t_time<=t1
					PredYVel=(dmax*pi*sin((pi*t_time)/t1))/(2*t1);
					PredYAcc=(dmax*pi^2*cos((pi*t_time)/t1))/(2*t1^2);
				else
					PredYVel=0;
					PredYAcc=0;
				end
				DispPump=DispPump+PredYVel*dt;
			elseif CasetoRun==5 || CasetoRun==6
				if mod(t_time,(loadtime+pausetime))<=loadtime
					PredYVel=(dispload*pi*sin((pi*mod(t_time,(loadtime+pausetime)))/loadtime))/(2*loadtime);
					PredYAcc=(dispload*pi^2*cos((pi*mod(t_time,(loadtime+pausetime)))/loadtime))/(2*loadtime^2);
				else
					PredYVel=0;
					PredYAcc=0;
				end            
				DispPump=DispPump+PredYVel*dt;
			elseif CasetoRun==7
				if mod(t_time,(loadtime+pausetime))<=loadtime
					PredYVel=(dispload*pi*sin((pi*mod(t_time,(loadtime+pausetime)))/loadtime))/(2*loadtime);
					PredYAcc=(dispload*pi^2*cos((pi*mod(t_time,(loadtime+pausetime)))/loadtime))/(2*loadtime^2);
				else
					PredYVel=0;
					PredYAcc=0;
				end            
				DispPump=DispPump+PredYVel*dt;
			elseif CasetoRun==8 || CasetoRun==9
				if mod(t_time,(loadtime+pausetime))<=loadtime
					PredYVel=(dispload*pi*sin((pi*mod(t_time,(loadtime+pausetime)))/loadtime))/(2*loadtime);
					PredYAcc=(dispload*pi^2*cos((pi*mod(t_time,(loadtime+pausetime)))/loadtime))/(2*loadtime^2);
				else
					PredYVel=0;
					PredYAcc=0;
				end            
				DispPump=DispPump+PredYVel*dt;
			elseif CasetoRun==10
				if mod(t_time,(loadtime+pausetime))<=loadtime
					PredYVel=(dispload*pi*sin((pi*mod(t_time,(loadtime+pausetime)))/loadtime))/(2*loadtime);
					PredYAcc=(dispload*pi^2*cos((pi*mod(t_time,(loadtime+pausetime)))/loadtime))/(2*loadtime^2);
				else
					PredYVel=0;
					PredYAcc=0;
				end            
				DispPump=DispPump+PredYVel*dt;
			elseif CasetoRun==11 || CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==15 || CasetoRun==14
				if mod(t_time,(loadtime+pausetime))<=loadtime
					PredYVel=(dispload*pi*sin((pi*mod(t_time,(loadtime+pausetime)))/loadtime))/(2*loadtime);
					PredYAcc=(dispload*pi^2*cos((pi*mod(t_time,(loadtime+pausetime)))/loadtime))/(2*loadtime^2);
				else
					PredYVel=0;
					PredYAcc=0;
				end            
				DispPump=DispPump+PredYVel*dt;
			elseif CasetoRun==12 || CasetoRun==16 || CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44
				if mod(t_time,(loadtime+pausetime))<=loadtime
					PredYVel=(dispload*pi*sin((pi*mod(t_time,(loadtime+pausetime)))/loadtime))/(2*loadtime);
					PredYAcc=(dispload*pi^2*cos((pi*mod(t_time,(loadtime+pausetime)))/loadtime))/(2*loadtime^2);
				else
					PredYVel=0;
					PredYAcc=0;
				end            
				DispPump=DispPump+PredYVel*dt;
			elseif CasetoRun==64 || CasetoRun==66 || CasetoRun==65 || CasetoRun==70
				if mod(t_time,(loadtime+pausetime))<=loadtime
					PredYVel=(dispload*pi*sin((pi*mod(t_time,(loadtime+pausetime)))/loadtime))/(2*loadtime);
					PredYVel2=-PredYVel;
					PredYAcc=(dispload*pi^2*cos((pi*mod(t_time,(loadtime+pausetime)))/loadtime))/(2*loadtime^2);
					PredYAcc2=-PredYAcc;
				else
					PredYVel=0;
					PredYAcc=0;
				end            
				DispPump=DispPump+PredYVel*dt;        
			elseif CasetoRun==67 || CasetoRun==68 || CasetoRun==71 || CasetoRun==72 || CasetoRun==73 || CasetoRun==74 || CasetoRun==78 || CasetoRun==81 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==110 || CasetoRun==96
				ncforce_cracktop=zeros(size(x_crack.center(:,:,1)));
				ncforce_crackbot=zeros(size(x_crack.center(:,:,1)));
			elseif CasetoRun==111 || CasetoRun==113
				ncforce_cracktop=zeros(size(x_crack.center(:,:,1)));
				ncforce_crackbot=zeros(size(x_crack.center(:,:,1)));
				if mod(t_time,(loadtime+pausetime))<=loadtime
					ParticlePredYVel=VectorInsertion(ParticlePredYVel,1,(dispload*pi*sin((pi*mod(t_time,(loadtime+pausetime)))/loadtime))/(2*loadtime));
				else
					ParticlePredYVel=VectorInsertion(ParticlePredYVel,1,0);
				end
				ParticlePredYVel=VectorInsertion(ParticlePredYVel,2,-ParticlePredYVel(1));
				PredYVel=ParticlePredYVel(1);
				PredYVel2=ParticlePredYVel(2);
			elseif CasetoRun==121
				if t_time<loadtime/2
					rampfactor=0.5-0.5*cos(pi/loadtime*t_time);
				else
					rampfactor=0.5+pi*(t_time-(loadtime/2))/(2*loadtime);
				end
				sigmainf=sigmainfmax*rampfactor;
				S=sigmainf;
				x_central=[2 3]*le_base;
				a=1*le_base;
				for nsi=1:length(tractionededge_si)
					si=tractionededge_si(nsi);
					x=LOC(si,1)-x_central(1);
					if x==0
						x=le_base*1e-5;
					end
					y=LOC(si,2)-x_central(2);
					sigmay=real(S*a^2*(1/a^2 + (y*2i)/((x + y*1i)^2 - a^2)^(3/2)))/2 + (real(S)*(real((x - y*1i)/((x - y*1i)^2 - a^2)^(1/2)) + real((x + y*1i)/((x + y*1i)^2 - a^2)^(1/2)) - 1))/2;
					sigmax = - real(S*a^2*(1/a^2 + (y*2i)/((x + y*1i)^2 - a^2)^(3/2)))/2 - (real(S)*(real((x - y*1i)/((x - y*1i)^2 - a^2)^(1/2)) + real((x + y*1i)/((x + y*1i)^2 - a^2)^(1/2)) - 1))/2 + S*(real((x - y*1i)/((x - y*1i)^2 - a^2)^(1/2)) + real((x + y*1i)/((x + y*1i)^2 - a^2)^(1/2)) - 1);
					sigmaxy = imag(S*a^2*(1/a^2 + (y*2i)/((x + y*1i)^2 - a^2)^(3/2)))/2;
					sigma_inxysystem=[sigmax sigmaxy;sigmaxy sigmay];
					ntforce_si(si,:)=normaledge_si(nsi,:)*sigma_inxysystem*le(1)*t0_plane; %assuming le(1)=le(2)
				end
				for nsi=1:length(tractionedcorner_si)
					si=tractionedcorner_si(nsi);
					x=LOC(si,1)-x_central(1);
					if x==0
						x=le_base*1e-5;
					end
					y=LOC(si,2)-x_central(2);
					sigmay=real(S*a^2*(1/a^2 + (y*2i)/((x + y*1i)^2 - a^2)^(3/2)))/2 + (real(S)*(real((x - y*1i)/((x - y*1i)^2 - a^2)^(1/2)) + real((x + y*1i)/((x + y*1i)^2 - a^2)^(1/2)) - 1))/2;
					sigmax = - real(S*a^2*(1/a^2 + (y*2i)/((x + y*1i)^2 - a^2)^(3/2)))/2 - (real(S)*(real((x - y*1i)/((x - y*1i)^2 - a^2)^(1/2)) + real((x + y*1i)/((x + y*1i)^2 - a^2)^(1/2)) - 1))/2 + S*(real((x - y*1i)/((x - y*1i)^2 - a^2)^(1/2)) + real((x + y*1i)/((x + y*1i)^2 - a^2)^(1/2)) - 1);
					sigmaxy = imag(S*a^2*(1/a^2 + (y*2i)/((x + y*1i)^2 - a^2)^(3/2)))/2;
					sigma_inxysystem=[sigmax sigmaxy;sigmaxy sigmay];
					ntforce_si(si,:)=(normalcorner_si{nsi}(1,:)*sigma_inxysystem+normalcorner_si{nsi}(2,:)*sigma_inxysystem)*0.5*le(1)*t0_plane; %assuming le(1)=le(2)
				end
			elseif CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==122 || CasetoRun==120 || CasetoRun==117 || CasetoRun==138
				pforce_sp=zeros(spCount,2);
				if CasetoRun==115
					if mod(t_time,(loadtime+pausetime))<=loadtime
						rampfactor=(0.5-0.5*cos(pi*mod(t_time,(loadtime+pausetime))));
					else
						rampfactor=1;
					end
				elseif CasetoRun==116 || CasetoRun==119 || CasetoRun==122 || CasetoRun==120 || CasetoRun==117
					if t_time<loadtime/2
						rampfactor=0.5-0.5*cos(pi/loadtime*t_time);
					else
						rampfactor=0.5+pi*(t_time-(loadtime/2))/(2*loadtime);
					end
				elseif CasetoRun==138
					if t_time<endcostime
						rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*t_time));
						rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*t_time/(2*endcostime));
					else
						rampfactor=endcosramp*(1+pi*(t_time-endcostime)/(2*endcostime));
						rampfactordot=endcosramp*pi/(2*endcostime);
					end
				end
				sigmainf=sigmainfmax*rampfactor;
				S=sigmainf;
				if CasetoRun==115
					x_central=[2 3.5]*le_base;
					a=1.5*le_base;
				elseif CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==120 || CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124 || CasetoRun==117 || CasetoRun==137
					x_central=[2 3]*le_base;
					a=1*le_base;
				end
				for nsp=1:length(tractionededge)
					sp=tractionededge(nsp);
					if CasetoRun==120
						x=x_spo(sp,1)-x_central(1);
						y=x_spo(sp,2)-x_central(2);
					else
						x=x_sp(sp,1)-x_central(1);
						y=x_sp(sp,2)-x_central(2);
					end
					sigmay=real(S*a^2*(1/a^2 + (y*2i)/((x + y*1i)^2 - a^2)^(3/2)))/2 + (real(S)*(real((x - y*1i)/((x - y*1i)^2 - a^2)^(1/2)) + real((x + y*1i)/((x + y*1i)^2 - a^2)^(1/2)) - 1))/2;
					sigmax = - real(S*a^2*(1/a^2 + (y*2i)/((x + y*1i)^2 - a^2)^(3/2)))/2 - (real(S)*(real((x - y*1i)/((x - y*1i)^2 - a^2)^(1/2)) + real((x + y*1i)/((x + y*1i)^2 - a^2)^(1/2)) - 1))/2 + S*(real((x - y*1i)/((x - y*1i)^2 - a^2)^(1/2)) + real((x + y*1i)/((x + y*1i)^2 - a^2)^(1/2)) - 1);
					sigmaxy = imag(S*a^2*(1/a^2 + (y*2i)/((x + y*1i)^2 - a^2)^(3/2)))/2;
					sigma_inxysystem=[sigmax sigmaxy;sigmaxy sigmay];
					%pforce_sp_sp=normaledge(nsp,:)*sigma_inxysystem*lp(1)*t0_plane; %assuming lp(1)=lp(2)
					%pforce_sp=MatrixInsertion(pforce_sp,sp,1,pforce_sp_sp(1,1));
					%pforce_sp=MatrixInsertion(pforce_sp,sp,2,pforce_sp_sp(1,2));
					pforce_sp(sp,:)=normaledge(nsp,:)*sigma_inxysystem*lp(1)*t0_plane; %assuming lp(1)=lp(2)
				end
				for nsp=1:length(tractionedcorner)
					sp=tractionedcorner(nsp);
					if CasetoRun==120
						x=x_spo(sp,1)-x_central(1);
						y=x_spo(sp,2)-x_central(2);
					else
						x=x_sp(sp,1)-x_central(1);
						y=x_sp(sp,2)-x_central(2);
					end
					sigmay=real(S*a^2*(1/a^2 + (y*2i)/((x + y*1i)^2 - a^2)^(3/2)))/2 + (real(S)*(real((x - y*1i)/((x - y*1i)^2 - a^2)^(1/2)) + real((x + y*1i)/((x + y*1i)^2 - a^2)^(1/2)) - 1))/2;
					sigmax = - real(S*a^2*(1/a^2 + (y*2i)/((x + y*1i)^2 - a^2)^(3/2)))/2 - (real(S)*(real((x - y*1i)/((x - y*1i)^2 - a^2)^(1/2)) + real((x + y*1i)/((x + y*1i)^2 - a^2)^(1/2)) - 1))/2 + S*(real((x - y*1i)/((x - y*1i)^2 - a^2)^(1/2)) + real((x + y*1i)/((x + y*1i)^2 - a^2)^(1/2)) - 1);
					sigmaxy = imag(S*a^2*(1/a^2 + (y*2i)/((x + y*1i)^2 - a^2)^(3/2)))/2;
					sigma_inxysystem=[sigmax sigmaxy;sigmaxy sigmay];
					%pforce_sp_sp=(normalcorner{nsp}(1,:)*sigma_inxysystem+normalcorner{nsp}(2,:)*sigma_inxysystem)*lp(1)*t0_plane; %assuming lp(1)=lp(2)
					%pforce_sp=MatrixInsertion(pforce_sp,sp,1,pforce_sp_sp(1,1));
					%pforce_sp=MatrixInsertion(pforce_sp,sp,2,pforce_sp_sp(1,2));
					pforce_sp(sp,:)=(normalcorner{nsp}(1,:)*sigma_inxysystem+normalcorner{nsp}(2,:)*sigma_inxysystem)*lp(1)*t0_plane; %assuming lp(1)=lp(2)
				end
				1;
				%implementing sigmainf to traction
				%K1=sigmainf;
				%{
				for nsp=1:length(tractionededge)
					sp=tractionededge(nsp);
					delta_x=x_sp(sp,:)-x_defaultcracktip;
					r=sqrt(dot(delta_x,delta_x));
					theta=reliableatan(delta_x(1),delta_x(2));
					sigmathetatheta=K1/sqrt(2*pi*r)*(3/4*cos(theta/2)+1/4*cos(3*theta/2));
					sigmartheta=K1/sqrt(2*pi*r)*(1/4*sin(theta/2)+1/4*sin(3*theta/2));
					sigmarr=K1/sqrt(2*pi*r)*(5/4*cos(theta/2)-1/4*cos(3*theta/2));
					sigma_inrthetasystem=[sigmarr sigmartheta;
										  sigmartheta sigmathetatheta];
					n1old=[cos(theta) sin(theta)];
					sigma_inxysystem=rotatetensorfromold(sigma_inrthetasystem,n1old);
					pforce_sp(sp,:)=normaledge(nsp,:)*sigma_inxysystem;
				end
				for nsp=1:length(tractionedcorner)
					sp=tractionedcorner(nsp);
					delta_x=x_sp(sp,:)-x_defaultcracktip;
					r=sqrt(dot(delta_x,delta_x));
					theta=reliableatan(delta_x(1),delta_x(2));
					sigmathetatheta=K1/sqrt(2*pi*r)*(3/4*cos(theta/2)+1/4*cos(3*theta/2));
					sigmartheta=K1/sqrt(2*pi*r)*(1/4*sin(theta/2)+1/4*sin(3*theta/2));
					sigmarr=K1/sqrt(2*pi*r)*(5/4*cos(theta/2)-1/4*cos(3*theta/2));
					sigma_inrthetasystem=[sigmarr sigmartheta;
										  sigmartheta sigmathetatheta];
					n1old=[cos(theta) sin(theta)];
					sigma_inxysystem=rotatetensorfromold(sigma_inrthetasystem,n1old);
					pforce_sp(sp,:)=normalcorner{nsp}(1,:)*sigma_inxysystem+normalcorner{nsp}(2,:)*sigma_inxysystem;
				end
				%}
			elseif CasetoRun==170
				%124 predvelvalue
				if t_time<endcostime
					rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*t_time));
					rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*t_time/(2*endcostime));
					rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*t_time/(2*endcostime));
				else
					rampfactor=endcosramp*(1+pi*(t_time-endcostime)/(2*endcostime));
					rampfactordot=endcosramp*pi/(2*endcostime);
					rampfactordoubledot=0;
				end
				PredYVel=-dispload*rampfactordot;
				PredYAcc=-dispload*rampfactordoubledot;
				PredYVel2=-PredYVel;
				PredYAcc2=-PredYAcc;
				PredXVel=PredYVel;
				PredXAcc=PredYAcc;
				PredXVel2=PredYVel2;
				PredXAcc2=PredYAcc2;
				
				nro=PredVelVect.nY; %Number of Relevant nOdes
				
				
				for iro=1:nro %iro=RUNNING NUMBER (i) of Relevant nOdes
					if iro<=length(NodeswithPredYVel)
						PredVelVect.YVel(iro)=PredYVel;
						PredVelVect.YAcc(iro)=PredYAcc;
						
					else
						PredVelVect.YVel(iro)=PredYVel2;
						PredVelVect.YAcc(iro)=PredYAcc2;
					end
				end
				DispPump=DispPump+PredYVel2*dt;
			elseif CasetoRun==171
				if rexp.switched==0
					if t_time<endcostime
						rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*t_time));
						rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*t_time/(2*endcostime));
						rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*t_time/(2*endcostime));
					else
						rampfactor=endcosramp*(1+pi*(t_time-endcostime)/(2*endcostime));
						rampfactordot=endcosramp*pi/(2*endcostime);
						rampfactordoubledot=0;
					end
					if sigmamaxprincmaxperfy>0.00125
					%if sigmamaxprincmaxperfy>0.45 %between 0.5 and 0.475
						rexp.switched=1;
						rexp.rs=rampfactor;
						rexp.rsdot=rampfactordot;
						rexp.A=999*rampfactor;
						rexp.ts=t_time;
					end
				elseif rexp.switched==1
					rampfactor=rexp.rs+rexp.rsdot*(t_time-rexp.ts);
					rampfactordot=rexp.rsdot;
					rampfactordoubledot=0;
				end
					
				PredYVel=-dispload*rampfactordot;
				PredYAcc=-dispload*rampfactordoubledot;
				PredYVel2=-PredYVel;
				PredYAcc2=-PredYAcc;
				PredXVel=PredYVel;
				PredXAcc=PredYAcc;
				PredXVel2=PredYVel2;
				PredXAcc2=PredYAcc2;
				
				nro=PredVelVect.nY; %Number of Relevant nOdes
				
				for iro=1:nro %iro=RUNNING NUMBER (i) of Relevant nOdes
					if iro<=length(NodeswithPredYVel)
						PredVelVect.YVel(iro)=PredYVel;
						PredVelVect.YAcc(iro)=PredYAcc;
						
					else
						PredVelVect.YVel(iro)=PredYVel2;
						PredVelVect.YAcc(iro)=PredYAcc2;
					end
				end
				DispPump=DispPump+PredYVel2*dt;
			elseif CasetoRun==178
				if rexp.switched==0
					if t_time<endcostime
						rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*t_time));
						rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*t_time/(2*endcostime));
						rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*t_time/(2*endcostime));
					else
						rampfactor=endcosramp*(1+pi*(t_time-endcostime)/(2*endcostime));
						rampfactordot=endcosramp*pi/(2*endcostime);
						rampfactordoubledot=0;
					end
					if sigmamaxprincmaxperfy>0.9
					%if sigmamaxprincmaxperfy>0.45 %between 0.5 and 0.475
						rexp.switched=1;
						rexp.rs=rampfactor;
						rexp.rsdot=rampfactordot;
						rexp.A=0.5*rampfactor;
						rexp.ts=t_time;
					end
				elseif rexp.switched==1
					rampfactor=rexp.rs+rexp.A*(1-exp(-rexp.rsdot/rexp.A*(t_time-rexp.ts)));
					rampfactordot=rexp.rsdot*exp(-rexp.rsdot/rexp.A*(t_time-rexp.ts));
					rampfactordoubledot=-rexp.rsdot^2/rexp.A*exp(-rexp.rsdot/rexp.A*(t_time-rexp.ts));
				end
					
				PredYVel=-dispload*rampfactordot;
				PredYAcc=-dispload*rampfactordoubledot;
				PredYVel2=-PredYVel;
				PredYAcc2=-PredYAcc;
				PredXVel=PredYVel*1.5;
				PredXAcc=PredYAcc*1.5;
				PredXVel2=PredYVel2*1.5;
				PredXAcc2=PredYAcc2*1.5;
				
				nro=PredVelVect.nY; %Number of Relevant nOdes
				
				for iro=1:nro %iro=RUNNING NUMBER (i) of Relevant nOdes
					if iro<=length(NodeswithPredYVel)
						PredVelVect.YVel(iro)=PredYVel;
						PredVelVect.YAcc(iro)=PredYAcc;
						
					else
						PredVelVect.YVel(iro)=PredYVel2;
						PredVelVect.YAcc(iro)=PredYAcc2;
					end
				end
				
				nro=PredVelVect.nX; %Number of Relevant nOdes
				
				for iro=1:nro %iro=RUNNING NUMBER (i) of Relevant nOdes
					if iro<=length(NodeswithPredXVel)
						PredVelVect.XVel(iro)=PredXVel;
						PredVelVect.XAcc(iro)=PredXAcc;
						
					else
						PredVelVect.XVel(iro)=PredXVel2;
						PredVelVect.XAcc(iro)=PredXAcc2;
					end
				end
				
				DispPump=DispPump+PredYVel2*dt;
			elseif CasetoRun==183
				N0 = Compute_Interpolator_CPDI_optimized_N0(spCount,cellCount,x_sp,le,NN,LOC,r1_sp,r2_sp,A_sp,t_sp,0,0);
				if t_time<=5*dt
					rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*t_time));
					rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*t_time/(2*endcostime));
					rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*t_time/(2*endcostime));
				else
					rampfactor=0;
					rampfactordot=0;
					rampfactordoubledot=0;
				end
				PredYDisp=-dispload*rampfactor;
				PredYDisp2=-PredYDisp;
				PredXDisp=PredYDisp;
				PredXDisp2=PredYDisp2;
				
				PredYVel=-dispload*rampfactordot;
				PredYAcc=-dispload*rampfactordoubledot;
				PredYVel2=-PredYVel;
				PredYAcc2=-PredYAcc;
				PredXVel=PredYVel;
				PredXAcc=PredYAcc;
				PredXVel2=PredYVel2;
				PredXAcc2=PredYAcc2;
				
				nro=PredVelVect.nY; %Number of Relevant nOdes
				
				for iro=1:nro %iro=RUNNING NUMBER (i) of Relevant nOdes
					if iro<=length(NodeswithPredYVel)
						PredVelVect.YDisp(iro)=PredYDisp;
						PredVelVect.YVel(iro)=PredYVel;
						PredVelVect.YAcc(iro)=PredYAcc;
					else
						PredVelVect.YDisp(iro)=PredYDisp2;
						PredVelVect.YVel(iro)=PredYVel2;
						PredVelVect.YAcc(iro)=PredYAcc2;
					end
				end
				DispPump=DispPump+PredYVel2*dt;
			elseif CasetoRun==183-999
				N0 = Compute_Interpolator_CPDI_optimized_N0(spCount,cellCount,x_sp,le,NN,LOC,r1_sp,r2_sp,A_sp,t_sp,0,0);
				if rexp.switched==0
					if t_time<endcostime
						rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*t_time));
						rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*t_time/(2*endcostime));
						rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*t_time/(2*endcostime));
					else
						rampfactor=endcosramp*(1+pi*(t_time-endcostime)/(2*endcostime));
						rampfactordot=endcosramp*pi/(2*endcostime);
						rampfactordoubledot=0;
					end
					if sigmamaxprincmaxperfy>0.9
					%if sigmamaxprincmaxperfy>0.45 %between 0.5 and 0.475
						rexp.switched=1;
						rexp.rs=rampfactor;
						rexp.rsdot=rampfactordot;
						rexp.A=0.5*rampfactor;
						rexp.ts=t_time;
					end
				elseif rexp.switched==1
					rampfactor=rexp.rs+rexp.A*(1-exp(-rexp.rsdot/rexp.A*(t_time-rexp.ts)));
					rampfactordot=rexp.rsdot*exp(-rexp.rsdot/rexp.A*(t_time-rexp.ts));
					rampfactordoubledot=-rexp.rsdot^2/rexp.A*exp(-rexp.rsdot/rexp.A*(t_time-rexp.ts));
				end
				PredYDisp=-dispload*rampfactor;
				PredYDisp2=-PredYDisp;
				PredXDisp=PredYDisp;
				PredXDisp2=PredYDisp2;
				
				PredYVel=-dispload*rampfactordot;
				PredYAcc=-dispload*rampfactordoubledot;
				PredYVel2=-PredYVel;
				PredYAcc2=-PredYAcc;
				PredXVel=PredYVel;
				PredXAcc=PredYAcc;
				PredXVel2=PredYVel2;
				PredXAcc2=PredYAcc2;
				
				nro=PredVelVect.nY; %Number of Relevant nOdes
				
				for iro=1:nro %iro=RUNNING NUMBER (i) of Relevant nOdes
					if iro<=length(NodeswithPredYVel)
						PredVelVect.YDisp(iro)=PredYDisp;
						PredVelVect.YVel(iro)=PredYVel;
						PredVelVect.YAcc(iro)=PredYAcc;
					else
						PredVelVect.YDisp(iro)=PredYDisp2;
						PredVelVect.YVel(iro)=PredYVel2;
						PredVelVect.YAcc(iro)=PredYAcc2;
					end
				end
				DispPump=DispPump+PredYVel2*dt;
			elseif CasetoRun==192
				if t_time<endcostime
					rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*t_time));
					rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*t_time/(2*endcostime));
					rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*t_time/(2*endcostime));
				else
					rampfactor=endcosramp*(1+pi*(t_time-endcostime)/(2*endcostime));
					rampfactordot=endcosramp*pi/(2*endcostime);
					rampfactordoubledot=0;
				end
				PredYVel=-dispload*rampfactordot;
				PredYAcc=-dispload*rampfactordoubledot;
				PredYVel2=-PredYVel;
				PredYAcc2=-PredYAcc;
				PredXVel=PredYVel;
				PredXAcc=PredYAcc;
				PredXVel2=PredYVel2;
				PredXAcc2=PredYAcc2;
				
				nro=PredVelVect.nY; %Number of Relevant nOdes
				
				for iro=1:nro %iro=RUNNING NUMBER (i) of Relevant nOdes
					if iro<=length(NodeswithPredYVel)
						PredVelVect.YVel(iro)=PredYVel;
						PredVelVect.YAcc(iro)=PredYAcc;
						
					else
						PredVelVect.YVel(iro)=PredYVel2;
						PredVelVect.YAcc(iro)=PredYAcc2;
					end
				end

				nro=PredVelVect.nX; %Number of Relevant nOdes
				
				for iro=1:nro %iro=RUNNING NUMBER (i) of Relevant nOdes
					if iro<=length(NodeswithPredXVel)
						PredVelVect.XVel(iro)=PredXVel;
						PredVelVect.XAcc(iro)=PredXAcc;
						
					else
						PredVelVect.XVel(iro)=PredXVel2;
						PredVelVect.XAcc(iro)=PredXAcc2;
					end
				end

				DispPump=DispPump+PredYVel2*dt;
			elseif CasetoRun==193
				if t_time<endcostime
					rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*t_time));
					rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*t_time/(2*endcostime));
					rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*t_time/(2*endcostime));
				else
					rampfactor=endcosramp*(1+pi*(t_time-endcostime)/(2*endcostime));
					rampfactordot=endcosramp*pi/(2*endcostime);
					rampfactordoubledot=0;
				end
				PredYVel=-dispload*rampfactordot;
				PredYAcc=-dispload*rampfactordoubledot;
				PredYVel2=-PredYVel;
				PredYAcc2=-PredYAcc;
				PredXVel=PredYVel;
				PredXAcc=PredYAcc;
				PredXVel2=PredYVel2;
				PredXAcc2=PredYAcc2;
				
				nro=PredVelVect.nY; %Number of Relevant nOdes
				
				for iro=1:nro %iro=RUNNING NUMBER (i) of Relevant nOdes
					if iro<=length(NodeswithPredYVel)
						PredVelVect.YVel(iro)=PredYVel;
						PredVelVect.YAcc(iro)=PredYAcc;
						
					else
						PredVelVect.YVel(iro)=PredYVel2;
						PredVelVect.YAcc(iro)=PredYAcc2;
					end
				end
				DispPump=DispPump+PredYVel2*dt;

			elseif CasetoRun==187
				if rexp.switched==0
					if t_time<endcostime
						rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*t_time));
						rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*t_time/(2*endcostime));
						rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*t_time/(2*endcostime));
					else
						rampfactor=endcosramp*(1+pi*(t_time-endcostime)/(2*endcostime));
						rampfactordot=endcosramp*pi/(2*endcostime);
						rampfactordoubledot=0;
					end
					if sigmamaxprincmaxperfy>0.9
					%if sigmamaxprincmaxperfy>0.45 %between 0.5 and 0.475
						rexp.switched=1;
						rexp.rs=rampfactor;
						rexp.rsdot=rampfactordot;
						rexp.A=99*rampfactor;
						rexp.A=0.004-rexp.rs;
						rexp.ts=t_time;
					end
				elseif rexp.switched==1
					rampfactor=rexp.rs+rexp.A*(1-exp(-rexp.rsdot/rexp.A*(t_time-rexp.ts)));
					rampfactordot=rexp.rsdot*exp(-rexp.rsdot/rexp.A*(t_time-rexp.ts));
					rampfactordoubledot=-rexp.rsdot^2/rexp.A*exp(-rexp.rsdot/rexp.A*(t_time-rexp.ts));
				end
				PredYVel=-dispload*rampfactordot;
				PredYAcc=-dispload*rampfactordoubledot;
				PredYVel2=-PredYVel;
				PredYAcc2=-PredYAcc;
				PredXVel=PredYVel;
				PredXAcc=PredYAcc;
				PredXVel2=PredYVel2;
				PredXAcc2=PredYAcc2;
				
				nro=PredVelVect.nY; %Number of Relevant nOdes
				
				for iro=1:nro %iro=RUNNING NUMBER (i) of Relevant nOdes
					if iro<=length(NodeswithPredYVel)
						PredVelVect.YVel(iro)=PredYVel;
						PredVelVect.YAcc(iro)=PredYAcc;
						
					else
						PredVelVect.YVel(iro)=PredYVel2;
						PredVelVect.YAcc(iro)=PredYAcc2;
					end
				end
				DispPump=DispPump+PredYVel2*dt;

			elseif CasetoRun==186 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==189
				if rexp.switched==0
					if t_time<endcostime
						rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*t_time));
						rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*t_time/(2*endcostime));
						rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*t_time/(2*endcostime));
					else
						rampfactor=endcosramp*(1+pi*(t_time-endcostime)/(2*endcostime));
						rampfactordot=endcosramp*pi/(2*endcostime);
						rampfactordoubledot=0;
					end
					if sigmamaxprincmaxperfy>0.9
					%if sigmamaxprincmaxperfy>0.45 %between 0.5 and 0.475
						rexp.switched=1;
						rexp.rs=rampfactor;
						rexp.rsdot=rampfactordot;
						rexp.A=99*rampfactor;
						rexp.ts=t_time;
					end
				elseif rexp.switched==1
					rampfactor=rexp.rs+rexp.A*(1-exp(-rexp.rsdot/rexp.A*(t_time-rexp.ts)));
					rampfactordot=rexp.rsdot*exp(-rexp.rsdot/rexp.A*(t_time-rexp.ts));
					rampfactordoubledot=-rexp.rsdot^2/rexp.A*exp(-rexp.rsdot/rexp.A*(t_time-rexp.ts));
				end
				PredYVel=-dispload*rampfactordot;
				PredYAcc=-dispload*rampfactordoubledot;
				PredYVel2=-PredYVel;
				PredYAcc2=-PredYAcc;
				PredXVel=PredYVel;
				PredXAcc=PredYAcc;
				PredXVel2=PredYVel2;
				PredXAcc2=PredYAcc2;
				
				nro=PredVelVect.nY; %Number of Relevant nOdes
				
				for iro=1:nro %iro=RUNNING NUMBER (i) of Relevant nOdes
					if iro<=length(NodeswithPredYVel)
						PredVelVect.YVel(iro)=PredYVel;
						PredVelVect.YAcc(iro)=PredYAcc;
						
					else
						PredVelVect.YVel(iro)=PredYVel2;
						PredVelVect.YAcc(iro)=PredYAcc2;
					end
				end
				DispPump=DispPump+PredYVel2*dt;

			elseif CasetoRun==163 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==169
				if rexp.switched==0
					if t_time<endcostime
						rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*t_time));
						rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*t_time/(2*endcostime));
						rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*t_time/(2*endcostime));
					else
						rampfactor=endcosramp*(1+pi*(t_time-endcostime)/(2*endcostime));
						rampfactordot=endcosramp*pi/(2*endcostime);
						rampfactordoubledot=0;
					end
					if sigmamaxprincmaxperfy>0.9
					%if sigmamaxprincmaxperfy>0.45 %between 0.5 and 0.475
						rexp.switched=1;
						rexp.rs=rampfactor;
						rexp.rsdot=rampfactordot;
						rexp.A=0.5*rampfactor;
						rexp.ts=t_time;
					end
				elseif rexp.switched==1
					rampfactor=rexp.rs+rexp.A*(1-exp(-rexp.rsdot/rexp.A*(t_time-rexp.ts)));
					rampfactordot=rexp.rsdot*exp(-rexp.rsdot/rexp.A*(t_time-rexp.ts));
					rampfactordoubledot=-rexp.rsdot^2/rexp.A*exp(-rexp.rsdot/rexp.A*(t_time-rexp.ts));
				end
					
				PredYVel=-dispload*rampfactordot;
				PredYAcc=-dispload*rampfactordoubledot;
				PredYVel2=-PredYVel;
				PredYAcc2=-PredYAcc;
				PredXVel=PredYVel;
				PredXAcc=PredYAcc;
				PredXVel2=PredYVel2;
				PredXAcc2=PredYAcc2;
				
				nro=PredVelVect.nY; %Number of Relevant nOdes
				
				for iro=1:nro %iro=RUNNING NUMBER (i) of Relevant nOdes
					if iro<=length(NodeswithPredYVel)
						PredVelVect.YVel(iro)=PredYVel;
						PredVelVect.YAcc(iro)=PredYAcc;
						
					else
						PredVelVect.YVel(iro)=PredYVel2;
						PredVelVect.YAcc(iro)=PredYAcc2;
					end
				end
				DispPump=DispPump+PredYVel2*dt;
			elseif CasetoRun==166
				if rexp.switched==0
					if t_time<endcostime
						rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*t_time));
						rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*t_time/(2*endcostime));
						rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*t_time/(2*endcostime));
					else
						rampfactor=endcosramp*(1+pi*(t_time-endcostime)/(2*endcostime));
						rampfactordot=endcosramp*pi/(2*endcostime);
						rampfactordoubledot=0;
					end
					if sigmamaxprincmaxperfy>0.0125
					%if sigmamaxprincmaxperfy>0.45 %between 0.5 and 0.475
						rexp.switched=1;
						rexp.rs=rampfactor;
						rexp.rsdot=rampfactordot;
						rexp.A=999*rampfactor;
						rexp.ts=t_time;
					end
				elseif rexp.switched==1
					%{
					%exponential asymptotic
					rampfactor=rexp.rs+rexp.A*(1-exp(-rexp.rsdot/rexp.A*(t_time-rexp.ts)));
					rampfactordot=rexp.rsdot*exp(-rexp.rsdot/rexp.A*(t_time-rexp.ts));
					rampfactordoubledot=-rexp.rsdot^2/rexp.A*exp(-rexp.rsdot/rexp.A*(t_time-rexp.ts));
					%}
					
					%linear
					rampfactor=rexp.rs+rexp.rsdot*(t_time-rexp.ts);
					rampfactordot=rexp.rsdot;
					rampfactordoubledot=0;
				end
					
				PredYVel=-dispload*rampfactordot;
				PredYAcc=-dispload*rampfactordoubledot;
				PredYVel2=-PredYVel;
				PredYAcc2=-PredYAcc;
				PredXVel=PredYVel;
				PredXAcc=PredYAcc;
				PredXVel2=PredYVel2;
				PredXAcc2=PredYAcc2;
				
				nro=PredVelVect.nY; %Number of Relevant nOdes
				
				for iro=1:nro %iro=RUNNING NUMBER (i) of Relevant nOdes
					if iro<=length(NodeswithPredYVel)
						PredVelVect.YVel(iro)=PredYVel;
						PredVelVect.YAcc(iro)=PredYAcc;
						
					else
						PredVelVect.YVel(iro)=PredYVel2;
						PredVelVect.YAcc(iro)=PredYAcc2;
					end
				end
				DispPump=DispPump+PredYVel2*dt;
			elseif CasetoRun==173 || CasetoRun==192
				if rexp.switched==0
					if t_time<endcostime
						rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*t_time));
						rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*t_time/(2*endcostime));
						rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*t_time/(2*endcostime));
					else
						rampfactor=endcosramp*(1+pi*(t_time-endcostime)/(2*endcostime));
						rampfactordot=endcosramp*pi/(2*endcostime);
						rampfactordoubledot=0;
					end
					if sigmamaxprincmaxperfy>0.9
						rexp.switched=1;
						rexp.rs=rampfactor;
						rexp.rsdot=rampfactordot;
						rexp.A=3*rampfactor;
						rexp.ts=t_time;
					end
				elseif rexp.switched==1
					rampfactor=rexp.rs+rexp.A*(1-exp(-rexp.rsdot/rexp.A*(t_time-rexp.ts)));
					rampfactordot=rexp.rsdot*exp(-rexp.rsdot/rexp.A*(t_time-rexp.ts));
					rampfactordoubledot=-rexp.rsdot^2/rexp.A*exp(-rexp.rsdot/rexp.A*(t_time-rexp.ts));
				end

				PredYVel=-dispload*rampfactordot;
				PredYAcc=-dispload*rampfactordoubledot;
				PredYVel2=-PredYVel;
				PredYAcc2=-PredYAcc;
				PredXVel=PredYVel;
				PredXAcc=PredYAcc;
				PredXVel2=PredYVel2;
				PredXAcc2=PredYAcc2;
				
				nro=PredVelVect.nY; %Number of Relevant nOdes
				
				
				for iro=1:nro %iro=RUNNING NUMBER (i) of Relevant nOdes
					if iro<=length(NodeswithPredYVel)
						PredVelVect.YVel(iro)=PredYVel;
						PredVelVect.YAcc(iro)=PredYAcc;
					else
						PredVelVect.YVel(iro)=PredYVel2;
						PredVelVect.YAcc(iro)=PredYAcc2;
					end
				end
				DispPump=DispPump+PredYVel2*dt;
			elseif CasetoRun==165
				%124 predvelvalue
				if rexp.switched==0
					if t_time<endcostime
						rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*t_time));
						rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*t_time/(2*endcostime));
						rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*t_time/(2*endcostime));
					else
						rampfactor=endcosramp*(1+pi*(t_time-endcostime)/(2*endcostime));
						rampfactordot=endcosramp*pi/(2*endcostime);
						rampfactordoubledot=0;
					end
					if sigmamaxprincmaxperfy>0.9
						rexp.switched=1;
						rexp.rs=rampfactor;
						rexp.rsdot=rampfactordot;
						rexp.A=0.5*rampfactor;
						rexp.ts=t_time;
					end
				elseif rexp.switched==1
					rampfactor=rexp.rs+rexp.A*(1-exp(-rexp.rsdot/rexp.A*(t_time-rexp.ts)));
					rampfactordot=rexp.rsdot*exp(-rexp.rsdot/rexp.A*(t_time-rexp.ts));
					rampfactordoubledot=-rexp.rsdot^2/rexp.A*exp(-rexp.rsdot/rexp.A*(t_time-rexp.ts));
				end

				PredYVel=-dispload*rampfactordot;
				PredYAcc=-dispload*rampfactordoubledot;
				PredYVel2=-PredYVel;
				PredYAcc2=-PredYAcc;
				PredXVel=PredYVel;
				PredXAcc=PredYAcc;
				PredXVel2=PredYVel2;
				PredXAcc2=PredYAcc2;
				
				nro=PredVelVect.nY; %Number of Relevant nOdes
				
				
				for iro=1:nro %iro=RUNNING NUMBER (i) of Relevant nOdes
					if iro<=length(NodeswithPredYVel)
						PredVelVect.YVel(iro)=PredYVel;
						PredVelVect.YAcc(iro)=PredYAcc;
					else
						PredVelVect.YVel(iro)=PredYVel2;
						PredVelVect.YAcc(iro)=PredYAcc2;
					end
				end
				DispPump=DispPump+PredYVel2*dt;
			elseif CasetoRun==118 || CasetoRun==123 || CasetoRun==151 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==130 || CasetoRun==124 || CasetoRun==137
				%124 predvelvalue
				if t_time<endcostime
					rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*t_time));
					rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*t_time/(2*endcostime));
					rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*t_time/(2*endcostime));
				else
					rampfactor=endcosramp*(1+pi*(t_time-endcostime)/(2*endcostime));
					rampfactordot=endcosramp*pi/(2*endcostime);
					rampfactordoubledot=0;
				end
				PredYVel=-dispload*rampfactordot;
				PredYAcc=-dispload*rampfactordoubledot;
				PredYVel2=-PredYVel;
				PredYAcc2=-PredYAcc;
				PredXVel=PredYVel;
				PredXAcc=PredYAcc;
				PredXVel2=PredYVel2;
				PredXAcc2=PredYAcc2;
				
				nro=PredVelVect.nY; %Number of Relevant nOdes
				
				
				for iro=1:nro %iro=RUNNING NUMBER (i) of Relevant nOdes
					if iro<=length(NodeswithPredYVel)
						PredVelVect.YVel(iro)=PredYVel;
						PredVelVect.YAcc(iro)=PredYAcc;
					else
						PredVelVect.YVel(iro)=PredYVel2;
						PredVelVect.YAcc(iro)=PredYAcc2;
					end
				end
				DispPump=DispPump+PredYVel2*dt;
			elseif CasetoRun==140 || CasetoRun==141 || CasetoRun==142
				if t_time<endcostime
					rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*t_time));
					rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*t_time/(2*endcostime));
				else
					rampfactor=endcosramp*(1+pi*(t_time-endcostime)/(2*endcostime));
					rampfactordot=endcosramp*pi/(2*endcostime);
				end
				PredYVel=-dispload*rampfactordot;
				%PredYVel2=-PredYVel; &only the bottom is pulled
				PredXVel=-4*0.15167634039640241135537956256614*dispload*rampfactordot;
				PredXVel2=-PredXVel; %
				DispPump=DispPump+PredYVel2*dt;
			elseif CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==147
				if t_time<endcostime
					rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*t_time));
					rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*t_time/(2*endcostime));
					rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*t_time/(2*endcostime));
				else
					rampfactor=endcosramp*(1+pi*(t_time-endcostime)/(2*endcostime));
					rampfactordot=endcosramp*pi/(2*endcostime);
					rampfactordoubledot=0;
				end
				PredXVel=dispload*rampfactordot;
				PredXAcc=dispload*rampfactordoubledot;
				DispPump=DispPump+PredXVel*dt;
			elseif CasetoRun==155
				%{
				if t_time<4*endcostime
					rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*t_time));
					rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*t_time/(2*endcostime));
					rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*t_time/(2*endcostime));
				else
					rampfactor=0;
					rampfactordot=0;
					rampfactordoubledot=0;
				end
				%}
				if t_time<2*endcostime
					rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*t_time));
					rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*t_time/(2*endcostime));
					rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*t_time/(2*endcostime));
				elseif t_time<3*endcostime
					rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*(2*endcostime)));
					rampfactordot=0;
					rampfactordoubledot=0;
				elseif t_time<5*endcostime
					rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*(t_time-endcostime)));
					rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*(t_time-endcostime)/(2*endcostime));
					rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*(t_time-endcostime)/(2*endcostime));
				else
					rampfactor=0;
					rampfactordot=0;
					rampfactordoubledot=0;
				end
				pforce_sp=pforce_sp_base*rampfactor;
				%pforce_sp=pforce_sp_base;
				PredXVel=dispload*rampfactordot;
				PredXAcc=dispload*rampfactordoubledot;
			elseif CasetoRun==158
				%changing ramp not used
			elseif CasetoRun==157
				%{
				if t_time<4*endcostime
					rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*t_time));
					rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*t_time/(2*endcostime));
					rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*t_time/(2*endcostime));
				else
					rampfactor=0;
					rampfactordot=0;
					rampfactordoubledot=0;
				end
				%}
				if t_time<2*endcostime
					rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*t_time));
					rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*t_time/(2*endcostime));
					rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*t_time/(2*endcostime));
				elseif t_time<3*endcostime
					rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*(2*endcostime)));
					rampfactordot=0;
					rampfactordoubledot=0;
				elseif t_time<5*endcostime
					rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*(t_time-endcostime)));
					rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*(t_time-endcostime)/(2*endcostime));
					rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*(t_time-endcostime)/(2*endcostime));
				else
					rampfactor=0;
					rampfactordot=0;
					rampfactordoubledot=0;
				end
				pforce_sp=pforce_sp_base*rampfactor;
				%pforce_sp=pforce_sp_base;
				PredXVel=dispload*rampfactordot;
				PredXAcc=dispload*rampfactordoubledot;
			elseif CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==162
				if CasetoRun==160
					if t_time<2*endcostime
						rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*t_time));
						rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*t_time/(2*endcostime));
						rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*t_time/(2*endcostime));
					elseif t_time<3*endcostime
						rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*(2*endcostime)));
						rampfactordot=0;
						rampfactordoubledot=0;
					elseif t_time<5*endcostime
						rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*(t_time-endcostime)));
						rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*(t_time-endcostime)/(2*endcostime));
						rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*(t_time-endcostime)/(2*endcostime));
					else
						rampfactor=0;
						rampfactordot=0;
						rampfactordoubledot=0;
					end
				elseif CasetoRun==175 || CasetoRun==194 || CasetoRun==180
					if t_time<2*endcostime
						rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*t_time));
						rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*t_time/(2*endcostime));
						rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*t_time/(2*endcostime));
					elseif t_time<3*endcostime
						rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*(2*endcostime)));
						rampfactordot=0;
						rampfactordoubledot=0;
					elseif t_time<5*endcostime
						rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*(t_time-endcostime)));
						rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*(t_time-endcostime)/(2*endcostime));
						rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*(t_time-endcostime)/(2*endcostime));
					elseif t_time<6*endcostime
						rampfactor=0;
						rampfactordot=0;
						rampfactordoubledot=0;
					elseif t_time<8*endcostime
						rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*(t_time-2*endcostime)));
						rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*(t_time-2*endcostime)/(2*endcostime));
						rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*(t_time-2*endcostime)/(2*endcostime));
					elseif t_time<9*endcostime
						rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*(2*endcostime)));
						rampfactordot=0;
						rampfactordoubledot=0;
					elseif t_time<11*endcostime
						rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*(t_time-3*endcostime)));
						rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*(t_time-3*endcostime)/(2*endcostime));
						rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*(t_time-3*endcostime)/(2*endcostime));
					else
						rampfactor=0;
						rampfactordot=0;
						rampfactordoubledot=0;
					end
				elseif CasetoRun==162
					if t_time<endcostime
						rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*t_time));
						rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*t_time/(2*endcostime));
						rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*t_time/(2*endcostime));
					else
						rampfactor=endcosramp*(1+pi*(t_time-endcostime)/(2*endcostime));
						rampfactordot=endcosramp*pi/(2*endcostime);
						rampfactordoubledot=0;
					end
				end
				if pushcol.initialcalculated==0
					for isp=1:spCount
						if uncrackable_sp(isp)==1
							pushcol.deltax.current(isp,:)=x_spo(isp,:)-[x_center y_center];
							pushcol.absolute_r_sp.initial(isp)=sqrt(dot(pushcol.deltax.current(isp,:),pushcol.deltax.current(isp,:)));
							pushcol.theta.initial(isp)=reliableatan(pushcol.deltax.current(isp,1),pushcol.deltax.current(isp,2));
						end
					end
					pushcol.initialcalculated=1;
				end
				pushcol.spcounter=0;
				for isp=1:spCount
					if uncrackable_sp(isp)==1
						pushcol.deltax.current(isp,:)=x_sp(isp,:)-[x_center y_center];
						pushcol.theta.current(isp)=reliableatan(pushcol.deltax.current(isp,1),pushcol.deltax.current(isp,2));
						pushcol.absolute_r_sp.current(isp)=sqrt(dot(pushcol.deltax.current(isp,:),pushcol.deltax.current(isp,:)));
						pushcol.relative_r_sp.current(isp)=pushcol.absolute_r_sp.current(isp)-pushcol.absolute_r_sp.initial(isp);
						pushcol.relative_r_sp.curavg=pushcol.relative_r_sp.curavg+pushcol.relative_r_sp.current(isp);
						pushcol.v_r_sp.current(isp)=dot(v_ssp(isp,:),[cos(pushcol.theta.current(isp)) sin(pushcol.theta.current(isp))]);
						pushcol.v_r_sp.curavg=pushcol.v_r_sp.curavg+pushcol.v_r_sp.current(isp);
						pushcol.spcounter=pushcol.spcounter+1;
					end
				end
				k_spring=0.5*E*t0_plane;
				m_relevant=m_sp(1); %assuming all the particle masses are the same
				c_critical=2*sqrt(k_spring*m_relevant);
				c_applied1=0.5*c_critical;
				c_applied2=0.8*m_sp(1)/dt;
				c_applied=min(c_applied1,c_applied2);
				
				pushcol.relative_r_sp.curavg=pushcol.relative_r_sp.curavg/pushcol.spcounter;
				pushcol.relative_r_sp.coltgt=dispload*rampfactor; %from dispload;
				pushcol.relative_r_sp.delta=pushcol.relative_r_sp.curavg-pushcol.relative_r_sp.coltgt;
				pushcol.relative_r_sp.springforce=0; %to stop coder whining
				if pushcol.relative_r_sp.delta<0
					pushcol.relative_r_sp.springforce=-pushcol.relative_r_sp.delta*k_spring;
				else
					pushcol.relative_r_sp.springforce=0;
				end

				pushcol.v_r_sp.curavg=pushcol.v_r_sp.curavg/pushcol.spcounter;
				pushcol.v_r_sp.coltgt=dispload*rampfactordot; %from dispload;
				pushcol.v_r_sp.delta=pushcol.v_r_sp.curavg-pushcol.v_r_sp.coltgt;
				pushcol.v_r_sp.dampforce=-pushcol.v_r_sp.delta*c_applied;
				
				%pforce_sp=pforce_sp_base*rampfactor;
				for isp=1:spCount
					if uncrackable_sp(isp)==1
						pforce_sp(isp,:)=[cos(pushcol.theta.initial(isp)) sin(pushcol.theta.initial(isp))]*(pushcol.relative_r_sp.springforce+pushcol.v_r_sp.dampforce);
					end
				end
				%pforce_sp=pforce_sp_base;
				PredXVel=dispload*rampfactordot;
				PredXAcc=dispload*rampfactordoubledot;
			elseif CasetoRun==164 || CasetoRun==172 || CasetoRun==174
				if t_time<endcostime
					rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*t_time));
					rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*t_time/(2*endcostime));
					rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*t_time/(2*endcostime));
				else
					rampfactor=endcosramp*(1+pi*(t_time-endcostime)/(2*endcostime));
					rampfactordot=endcosramp*pi/(2*endcostime);
					rampfactordoubledot=0;
				end
				if pushcol.initialcalculated==0
					for isp=1:spCount
						if donut_pushed_sp(isp)==1
							pushcol.deltax.current(isp,:)=x_spo(isp,:)-[x_center y_center];
							pushcol.absolute_r_sp.initial(isp)=sqrt(dot(pushcol.deltax.current(isp,:),pushcol.deltax.current(isp,:)));
							pushcol.theta.initial(isp)=reliableatan(pushcol.deltax.current(isp,1),pushcol.deltax.current(isp,2));
						end
					end
					pushcol.initialcalculated=1;
				end
				pushcol.spcounter=0;
				for isp=1:spCount
					if donut_pushed_sp(isp)==1
						pushcol.deltax.current(isp,:)=x_sp(isp,:)-[x_center y_center];
						pushcol.theta.current(isp)=reliableatan(pushcol.deltax.current(isp,1),pushcol.deltax.current(isp,2));
						pushcol.absolute_r_sp.current(isp)=sqrt(dot(pushcol.deltax.current(isp,:),pushcol.deltax.current(isp,:)));
						pushcol.relative_r_sp.current(isp)=pushcol.absolute_r_sp.current(isp)-pushcol.absolute_r_sp.initial(isp);
						pushcol.relative_r_sp.curavg=pushcol.relative_r_sp.curavg+pushcol.relative_r_sp.current(isp);
						pushcol.v_r_sp.current(isp)=dot(v_ssp(isp,:),[cos(pushcol.theta.current(isp)) sin(pushcol.theta.current(isp))]);
						pushcol.v_r_sp.curavg=pushcol.v_r_sp.curavg+pushcol.v_r_sp.current(isp);
						pushcol.spcounter=pushcol.spcounter+1;
					end
				end
				k_spring=0.5*E*t0_plane;
				m_relevant=m_sp(1); %assuming all the particle masses are the same
				c_critical=2*sqrt(k_spring*m_relevant);
				c_applied1=0.5*c_critical;
				c_applied2=0.8*m_sp(1)/dt;
				c_applied=min(c_applied1,c_applied2);
				
				pushcol.relative_r_sp.curavg=pushcol.relative_r_sp.curavg/pushcol.spcounter;
				pushcol.relative_r_sp.coltgt=dispload*rampfactor; %from dispload;
				pushcol.relative_r_sp.delta=pushcol.relative_r_sp.curavg-pushcol.relative_r_sp.coltgt;
				pushcol.relative_r_sp.springforce=-pushcol.relative_r_sp.delta*k_spring;
				pushcol.v_r_sp.curavg=pushcol.v_r_sp.curavg/pushcol.spcounter;
				pushcol.v_r_sp.coltgt=dispload*rampfactordot; %from dispload;
				pushcol.v_r_sp.delta=pushcol.v_r_sp.curavg-pushcol.v_r_sp.coltgt;
				pushcol.v_r_sp.dampforce=-pushcol.v_r_sp.delta*c_applied;
				
				%pforce_sp=pforce_sp_base*rampfactor;
				for isp=1:spCount
					if donut_pushed_sp(isp)==1
						pforce_sp(isp,:)=[cos(pushcol.theta.initial(isp)) sin(pushcol.theta.initial(isp))]*(pushcol.relative_r_sp.springforce+pushcol.v_r_sp.dampforce);
					end
				end
				%pforce_sp=pforce_sp_base;
				PredXVel=dispload*rampfactordot;
				PredXAcc=dispload*rampfactordoubledot;
			elseif CasetoRun==156 || CasetoRun==159
				%{
				if t_time<4*endcostime
					rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*t_time));
					rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*t_time/(2*endcostime));
					rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*t_time/(2*endcostime));
				else
					rampfactor=0;
					rampfactordot=0;
					rampfactordoubledot=0;
				end
				%}
				if t_time<endcostime
					rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*t_time));
					rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*t_time/(2*endcostime));
					rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*t_time/(2*endcostime));
				else
					rampfactor=endcosramp*(1+pi*(t_time-endcostime)/(2*endcostime));
					rampfactordot=endcosramp*pi/(2*endcostime);
					rampfactordoubledot=0;
				end
				%pforce_sp=pforce_sp_base;
				PredXVel=dispload*rampfactordot;
				PredXAcc=dispload*rampfactordoubledot;
			elseif CasetoRun==150
				%pforce_sp experiment
				pforce_sp=zeros(spCount,2);
				if t_time<4*endcostime
					rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*t_time));
					rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*t_time/(2*endcostime));
					rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*t_time/(2*endcostime));
				else
					rampfactor=0;
					rampfactordot=0;
					rampfactordoubledot=0;
				end
				r0=(0.8+rampfactor)*le_base;
				exprate=7/0.2;
				pforce_base=1.5*E*le_base^2*t0_plane/(4*(1.25*le_base))/(refinementfactor^2);
				k_spring=0.5*E*t0_plane;
				m_relevant=m_sp(1); %assuming all the particle masses are the same
				c_critical=2*sqrt(k_spring*m_relevant);
				c_applied1=0.5*c_critical;
                c_applied2=0.8*m_sp(1)/dt;
                c_applied=min(c_applied1,c_applied2);
                x_tgt=zeros(spCount,2);
                v_tgt=zeros(spCount,2);
                delta_x_wall=zeros(spCount,2);
                delta_v_wall=zeros(spCount,2);
				%thalflife=0.0001;
				%k=log(2)/thalflife;
				deltarideal_sp=zeros(1,spCount);
				for isp=1:spCount
					if uncrackable_sp(isp)>0.5
						delta_x0=[x_spo(isp,1)-x_center x_spo(isp,2)-y_center];
						delta_x=[x_sp(isp,1)-x_center x_sp(isp,2)-y_center];
						%theta_0=reliableatan(delta_x0(1),delta_x0(2));
						deltaractual_sp(isp)=sqrt(dot(delta_x,delta_x))-sqrt(dot(delta_x0,delta_x0));
					end
					deltarideal_sp(isp)=rampfactor;
				end
				PredXVel=dispload*rampfactordot;
				DispPump=DispPump+PredXVel*dt;		
			elseif CasetoRun==154 || CasetoRun==161
				pforce_sp=zeros(spCount,2);
				%vortex loading
				
				for isp = 1:spCount
					%{
					R_sp(isp)                = sqrt((x_spo(isp,1)-center)^2 + (x_spo(isp,2)-center)^2);
					theta(isp)               = atan2((x_spo(isp,2)-center),(x_spo(isp,1)-center));
					Constant(isp)            = 1 - 32 * (R_sp(isp)-1)^2 + 256 * (R_sp(isp)-1)^4;

					alpha(isp)   = A*sin(C*pi*(n_iter-1)*dt)*Constant(isp);
					beta(isp)    = theta(isp) + alpha(isp);        
					b_r(isp)     = -R_sp(isp)*A^2*(cos(C*pi*(n_iter-1)*dt))^2*C^2*pi^2*(4*R_sp(isp)-3)^4*(4*R_sp(isp)-5)^4+2/psp*2048*(4*R_sp(isp)-5)^2*(R_sp(isp)-1)^2*(4*R_sp(isp)-3)^2*A^2*(sin(C*pi*(n_iter-1)*dt))^2*R_sp(isp)*Mu;
					b_angle(isp) = -A*sin(C*pi*(n_iter-1)*dt)*(R_sp(isp)*C^2*pi^2*(4*R_sp(isp)-3)^2*(4*R_sp(isp)-5)^2+1/psp*64*Mu*(96*R_sp(isp)^3-240*R_sp(isp)^2+188*R_sp(isp)-45));
					b_sp(isp,1)  = b_r(isp) * cos(beta(isp)) - b_angle(isp) * sin(beta(isp));
					b_sp(isp,2)  = b_r(isp) * sin(beta(isp)) + b_angle(isp) * cos(beta(isp));     
					%}
					
					R_sp                = sqrt((x_spo(isp,1)-center)^2 + (x_spo(isp,2)-center)^2);
					theta               = atan2((x_spo(isp,2)-center),(x_spo(isp,1)-center));
					Constant            = 1 - 32 * (R_sp-1)^2 + 256 * (R_sp-1)^4;

					alpha   = A*sin(C*pi*(n_iter-1)*dt)*Constant;
					beta    = theta + alpha;
					alfap   = A^2 * C * pi * Constant;
					b_r     = -R_sp*A^2*(cos(C*pi*(n_iter-1)*dt))^2*C^2*pi^2*(4*R_sp-3)^4*(4*R_sp-5)^4+2/psp*2048*(4*R_sp-5)^2*(R_sp-1)^2*(4*R_sp-3)^2*A^2*(sin(C*pi*(n_iter-1)*dt))^2*R_sp*Mu;
					b_angle = -A*sin(C*pi*(n_iter-1)*dt)*(R_sp*C^2*pi^2*(4*R_sp-3)^2*(4*R_sp-5)^2+1/psp*64*Mu*(96*R_sp^3-240*R_sp^2+188*R_sp-45));
					%pforce_sp(isp,1)=m_sp(isp)*(b_r * cos(beta) - b_angle * sin(beta))/2;
					pforce_sp(isp,1)=m_sp(isp)*(b_r * cos(beta) - b_angle * sin(beta)); %full force for hyperelastic
					%pforce_sp(isp,2)=m_sp(isp)*(b_r * sin(beta) + b_angle * cos(beta))/2;
					pforce_sp(isp,2)=m_sp(isp)*(b_r * sin(beta) + b_angle * cos(beta)); %full force for hyperelastic
                    alpha   = A*sin(C*pi*(n_iter)*dt)*Constant; %this is a hotfix! because analytical solution is comparable to the simulation's end of solver
					anerror.v_ssp_an(isp,1)=alfap*cos(C*pi*n_iter*dt)*(-sin(alpha)*(x_spo(isp,1)-center)-cos(alpha)*(x_spo(isp,2)-center));
					anerror.v_ssp_an(isp,2)=alfap*cos(C*pi*n_iter*dt)*(cos(alpha)*(x_spo(isp,1)-center)-sin(alpha)*(x_spo(isp,2)-center));
					
					anerror.u_sp_an(isp,1)   = (A * (cos(alpha)*(x_spo(isp,1)-center) - sin(alpha)*(x_spo(isp,2)-center))) - (x_spo(isp,1)-center);
					anerror.u_sp_an(isp,2)   = (A * (sin(alpha)*(x_spo(isp,1)-center) + cos(alpha)*(x_spo(isp,2)-center))) - (x_spo(isp,2)-center);

					%fair comparison to v_ssp for after generic_solver
				end
				n_iter=n_iter+1;
			elseif CasetoRun==153 %ring only
				pforce_sp=zeros(spCount,2);
				if t_time<2*endcostime
					rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*t_time));
					rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*t_time/(2*endcostime));
					rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*t_time/(2*endcostime));
				elseif t_time<3*endcostime
					rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*(2*endcostime)));
					rampfactordot=0;
					rampfactordoubledot=0;
				elseif t_time<5*endcostime
					rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*(t_time-endcostime)));
					rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*(t_time-endcostime)/(2*endcostime));
					rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*(t_time-endcostime)/(2*endcostime));
				else
					rampfactor=0;
					rampfactordot=0;
					rampfactordoubledot=0;
				end
				
				r0=(0.8+rampfactor)*le_base;
				exprate=7/0.2;
				pforce_base=1.5*E*le_base^2*t0_plane/(4*(1.25*le_base))/(refinementfactor^2);
				k_spring=0.5*E*t0_plane;
				m_relevant=m_sp(1); %assuming all the particle masses are the same
				c_critical=2*sqrt(k_spring*m_relevant);
				c_applied1=0.5*c_critical;
                c_applied2=0.8*m_sp(1)/dt;
                c_applied=min(c_applied1,c_applied2);
                x_tgt=zeros(spCount,2);
                v_tgt=zeros(spCount,2);
                delta_x_wall=zeros(spCount,2);
                delta_v_wall=zeros(spCount,2);
				%thalflife=0.0001;
				%k=log(2)/thalflife;
				for isp=1:spCount
					delta_x_trial_0=[x_spo(isp,1)-x_center x_spo(isp,2)-y_center];
					theta_0=reliableatan(delta_x_trial_0(1),delta_x_trial_0(2));
					r_0=sqrt(dot(delta_x_trial_0,delta_x_trial_0));
					r_tgt=r_0+rampfactor;
					x_tgt(isp,1)=x_center+r_tgt*cos(theta_0);
					x_tgt(isp,2)=y_center+r_tgt*sin(theta_0);
					v_tgt(isp,1)=rampfactordot*cos(theta_0);
					v_tgt(isp,2)=rampfactordot*sin(theta_0);
					%delta_x_trial=[x_sp(isp,1)-x_center x_sp(isp,2)-y_center];
					%theta=reliableatan(delta_x_trial(1),delta_x_trial(2));
					%pforce_sp_scalar(isp)=pforce_base*exp(-exprate*(r+r_adjustor(isp)-r0));
					%1;
					%r=sqrt(dot(delta_x_trial,delta_x_trial));
					for dim=1:2
						delta_x_wall(isp,dim)=x_sp(isp,dim)-x_tgt(isp,dim);
						delta_v_wall(isp,dim)=v_ssp(isp,dim)-v_tgt(isp,dim);
						pforce_sp(isp,dim)=-delta_x_wall(isp,dim)*k_spring-delta_v_wall(isp,dim)*c_applied;
                    end
                    1;
					%pforce_sp(isp,1)=k_spring*(rampfactor+r+r_adjustor(isp)-r0)*cos(theta)-c_applied*(v_ssp(isp,1)-rampfactordot);
					%pforce_sp(isp,2)=k_spring*(rampfactor+r+r_adjustor(isp)-r0)*sin(theta)-c_applied*(v_ssp(isp,2)-rampfactordot);
                end
				PredXVel=dispload*rampfactordot;
				DispPump=DispPump+PredXVel*dt;			
			elseif CasetoRun==152 %custom donut
				pforce_sp=zeros(spCount,2);
				if t_time<endcostime
					rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*t_time));
					rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*t_time/(2*endcostime));
					rampfactordoubledot=endcosramp*(pi/(2*endcostime))^2*cos(pi*t_time/(2*endcostime));
				else
					rampfactor=endcosramp*(1+pi*(t_time-endcostime)/(2*endcostime));
					rampfactordot=endcosramp*pi/(2*endcostime);
					rampfactordoubledot=0;
				end
				%rampfactormax=endcosramp*(1+pi*(0.17-endcostime)/(2*endcostime));
				%rampfactor=min(rampfactor,rampfactormax);
				r0=(0.8+rampfactor)*le_base;
				exprate=15;
				pforce_base=1.5*E*le_base^2*t0_plane/(4*(1.25*le_base))/(refinementfactor^2);
				
				if pforce_sp_save.saved==1
					for isp=1:spCount
						for idim=1:2
							pforce_sp(isp,idim)=pforce_sp_save.values(isp,idim);
						end
					end
				else
					for isp=1:spCount
						if uncrackable_sp(isp)>0.5
							delta_x_trial=[x_sp(isp,1)-x_center x_sp(isp,2)-y_center];
							theta=reliableatan(delta_x_trial(1),delta_x_trial(2));
							r=sqrt(dot(delta_x_trial,delta_x_trial));
							pforce_sp(isp,1)=pforce_base*rampfactor*cos(theta)*exp(-exprate*(r+r_adjustor(isp)-r0));
							pforce_sp(isp,2)=pforce_base*rampfactor*sin(theta)*exp(-exprate*(r+r_adjustor(isp)-r0));
						end
					end
				end
				PredXVel=dispload*rampfactordot;
				DispPump=DispPump+PredXVel*dt;		
				if pforce_sp_save.saved==0 && t_time>=0.17
					for isp=1:spCount
						for idim=1:2
							pforce_sp_save.values(isp,idim)=pforce_sp(isp,idim);
						end
					end
					pforce_sp_save.saved=1;
				end
			elseif CasetoRun==145
				if t_time<endcostime
					rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*t_time));
					rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*t_time/(2*endcostime));
				else
					rampfactor=endcosramp*(1+pi*(t_time-endcostime)/(2*endcostime));
					rampfactordot=endcosramp*pi/(2*endcostime);
				end
				PredXVel=dispload*rampfactordot;
				PredXVel2=-PredXVel;
				DispPump=DispPump+PredXVel*dt;
			elseif CasetoRun==143
				if t_time<endcostime
					rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*t_time));
					rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*t_time/(2*endcostime));
				else
					rampfactor=endcosramp*(1+pi*(t_time-endcostime)/(2*endcostime));
					rampfactordot=endcosramp*pi/(2*endcostime);
				end
				PredYVel=-dispload*rampfactordot;
				%PredYVel2=-PredYVel; &only the bottom is pulled
				PredXVel=4*0.15167634039640241135537956256614*dispload*rampfactordot;
				PredXVel2=-PredXVel; %
				DispPump=DispPump+PredYVel2*dt;
			elseif CasetoRun==134 || CasetoRun==136
				if t_time<endcostime
					rampfactor=endcosramp*(1-cos(pi/(2*endcostime)*t_time));
					rampfactordot=endcosramp*pi/(2*endcostime)*sin(pi*t_time/(2*endcostime));
				else
					rampfactor=endcosramp*(1+pi*(t_time-endcostime)/(2*endcostime));
					rampfactordot=endcosramp*pi/(2*endcostime);
				end
				PredXVel=-dispload*rampfactordot;
				PredXVel2=-PredXVel;
				PredYVel=PredXVel;
				PredYVel2=PredXVel2;
				DispPump=DispPump+PredXVel2*dt;
			elseif CasetoRun==112
				ncforce_cracktop=zeros(size(x_crack.center(:,:,1)));
				ncforce_crackbot=zeros(size(x_crack.center(:,:,1)));
				if mod(t_time,(loadtime+pausetime))<=loadtime
					ParticlePredYVel=(dispload*pi*sin((pi*mod(t_time,(loadtime+pausetime)))/loadtime))/(2*loadtime);
				else
					ParticlePredYVel=0;
				end
			elseif CasetoRun==83
				% whats this, its all wrong
				for icrackpath=1:length(x_crack)
					ncforce_cracktop=zeros(size(x_crack));
					ncforce_crackbot=zeros(size(x_crack));
				end
			elseif CasetoRun==84 || CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89 || CasetoRun==85
				if mod(t_time,(loadtime+pausetime))<=loadtime
					PredYVel=(dispload*pi*sin((pi*mod(t_time,(loadtime+pausetime)))/loadtime))/(2*loadtime);
					PredYAcc=(dispload*pi^2*cos((pi*mod(t_time,(loadtime+pausetime)))/loadtime))/(2*loadtime^2);
				else
					PredYVel=0;
					PredYAcc=0;
				end
				PredXVel=PredYVel;
				PredXAcc=PredYAcc;
				%for below is all wrong
				for icrackpath=1:length(x_crack)
					ncforce_cracktop=zeros(size(x_crack));	
					ncforce_crackbot=zeros(size(x_crack));
				end
				DispPump=DispPump+PredYVel*dt;
			elseif CasetoRun==77
				if t_time<1
					crackpressure=100*(0.5-0.5*cos(pi/1*t_time));
				else
					crackpressure=100;
				end
				ncforce_cracktop(8:38,1)=crackpressure*(le(2)/4);
				ncforce_crackbot=-ncforce_cracktop;
			elseif CasetoRun==69 % currently not designed for repetitions
				if t_time<=loadtime
					pforcecurrent=pforcemax*(0.5-0.5*cos(pi*t_time/loadtime));
				else
					pforcecurrent=pforcemax;
				end
				pforce_sp=zeros(sp,2);
				for nsp=1:length(rampedyforceparticle1)
					pforce_sp(rampedyforceparticle1(nsp),2)=-pforcecurrent;
				end
				for nsp=1:length(rampedyforceparticle2)
					pforce_sp(rampedyforceparticle2(nsp),2)=pforcecurrent;
				end
			end
			
			if CloseEnough(t_time,Debugging.Time,1e-5,2)
				1;
			end
%{
%switchable1
			if CasetoRun==73 || CasetoRun==74 || CasetoRun==78 || CasetoRun==81 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==83 || CasetoRun==84 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==115 || CasetoRun==116 || CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124 || CasetoRun==117 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110 || CasetoRun==96 || CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89 || CasetoRun==85 || CasetoRun==77
				%disp(['max(max(f_final_vect))=' num2str(max(max(f_final_vect)))]);
				crackedparticle=length(thetacrackrtl)-sum(isnan(thetacrackrtl));
				disp(['n_cracked=' int2txt(crackedparticle)]);
				for i=1:length(thetacrackrtl)		
					if isnan(thetacrackrtl(i))
					else
						disp(['f_final_vect(' int2txt(i) ',:)=' num2str(f_final_vect(i,:))]);
					end
				end
			elseif CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120
			end
			1; % pause here % break here
%}
%switchable1
		%    if CasetoRun==73 || CasetoRun==74 || CasetoRun==78 || CasetoRun==81 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==83 || CasetoRun==84 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124 || CasetoRun==117 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110 || CasetoRun==96 || CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89 || CasetoRun==85 || CasetoRun==77
		%        if isnan(min(thetacrackrtl))
		%        else
		%            disp('go to line 4525, add a breakpoint')
		%            pause
		%            1;
		%        end
		%    end
%{
%switchable1
			if 1==0
				IsItDump=1;
				save([TimeStampedName '-Dump.mat'],'-v7.3', ...
					'tt', ...
					't_time', ...
					'v_ssp', ...
					'x_sp', ...
					'F_sp', ...
					'A_sp', ...
					't_sp', ...
					's_sp', ...
					'p_sp', ...
					'r1_sp', ...
					'r2_sp', ...
					'F_rollerX', ...
					'F_rollerY', ...
					'E_acc', ...
					'e_pl_sp', ...
					'sigma_global_big', ...
					'e_t_global_big', ...
					'e_pl_global_big', ...
					'alphahp', ...
					'f_final_vect', ...
					'surfacewithfmax', ...
					'sigma_local_big', ...
					'DispPump', ...
					'TimeStampedName', ...
					'TLD', ...
					'IsItDump', ...
					'evaltimes', ...
					'stackvars', ...
					'duration', ...
					'ttstart', ...
					'x_crack', ...
					'x_cracktop', ...
					'x_crackbot', ...
					'dudx_sp', ...
					'W_sp', ...
					'thetacrackrtl', ...
					'thetacrack', ...
					'pforce_sp', ...
					'sigmainf', ...
					'G', ...
					'Ga', ...
					'Grelativeerror', ...
					'ntforce_si');
				clear IsItDump
			end
%}
%switchable1
			
			if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==21 || CasetoRun==17 || CasetoRun==4 || CasetoRun==5 || CasetoRun==6 || CasetoRun==7 || CasetoRun==8 || CasetoRun==9 || CasetoRun==10 || CasetoRun==11 || CasetoRun==12 || CasetoRun==16 || CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44 || CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==15 || CasetoRun==14 || CasetoRun==64 || CasetoRun==66 || CasetoRun==65 || CasetoRun==70 || CasetoRun==84 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==115 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110 || CasetoRun==96 || CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89 || CasetoRun==85 
				fprintf('%s',['t_time=' float2txt(5,t_time) ', DispPump=' float2txt(5,DispPump) '=' float2txt(5,DispPump/le_base) '*le_base' char(10)]);
				%disp(['t_time=' num2str(t_time) ', DispPump=' num2str(DispPump) '=' num2str(DispPump/le_base) '*le_base']);
			elseif CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==117
				fprintf('%s',['refinement=' int2txt(refinementfactor) ', t_time=' float2txt(5,t_time) ', sigmainf=' float2txt(5,sigmainf) char(10)]);
				%disp(['refinement=' num2str(refinementfactor) ', t_time=' num2str(t_time) ', sigmainf=' num2str(sigmainf)]);
			elseif CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124
				fprintf('%s',['refinement=' int2txt(refinementfactor) ', t_time=' float2txt(5,t_time) ', DispPump=' float2txt(5,DispPump) char(10)]);
				%disp(['refinement=' num2str(refinementfactor) ', t_time=' num2str(t_time) ', DispPump=' num2str(DispPump)]);
			elseif CasetoRun==67 || CasetoRun==68 || CasetoRun==71 || CasetoRun==72 || CasetoRun==73 || CasetoRun==74 || CasetoRun==78 || CasetoRun==81 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==83 || CasetoRun==77
				fprintf('%s',['t_time=' float2txt(5,t_time) char(10)]);
				%disp(['t_time=' num2str(t_time)]);
			elseif CasetoRun==69
				fprintf('%s',['t_time=' float2txt(5,t_time) ', pforcecurrent=' float2txt(5,pforcecurrent) char(10)]);
				%disp(['t_time=' num2str(t_time) ', pforcecurrent=' num2str(pforcecurrent)]);
            end
            if CloseEnough(t_time,0.005842128785810849801729549568563,1e-5,2)
                1;
            end
            if tt<=10
                1;
            end
            if tt>=30
                1;
            end
            %save([num2str(tt) 'frilanfdsjafdsa']); LWStatus EWStatus
            %save('temp.mat');
			[energy,sigmamaxprincmaxperfy,G,thetac,v_ssp,x_sp,F_sp,A_sp,t_sp,s_sp,p_sp,r1_sp,r2_sp,F_rollerX,F_rollerY,E_acc,e_pl_sp,sigma_global_big,e_t_global_big,e_pl_global_big,alphahp,f_final_vect,surfacewithfmax,sigma_local_big,Fyignore,evaltimes,stackvars,duration,x_crack,dudx_sp,W_sp,thetacrackrtl,thetacrack,s_si,s_si_comb,s_tip_dump,x_tip_dump,s_gauss_dump,x_gauss_dump,s_si_K1,s_tip_K1_dump,r_propdirweighted_dump,u_si_comb,d_tip_dump,d_LOC_tip_dump,dumpresult] = ...
				Generic_Solver_Predvel(energy,N0,PredVelVect,deltarideal_sp,LWStatus,EWStatus,tt,ntforce_si,refinementfactor,ParticleswithPredYVel,ParticlePredYVel,Version,CModel,nodeCount,spCount,cellCount,x_sp,x_spo,d_sp,le,NN,LOC,b_sp,A_sp,t_sp,ptraction_sp,v_ssp,s_sp,m_sp,p_sp,nfbcx,nfbcy,fbcx,fbcy,E,nu,F_sp,A_spo,t_spo,dt,r1_sp,r10_sp,r2_sp,r20_sp,NodeswithPredXVel,NodeswithPredXVel2,NodeswithPredYVel,NodeswithPredYVel2,PredXVel,PredXVel2,PredYVel,PredYVel2,PredXAcc,PredXAcc2,PredYAcc,PredYAcc2,E_acc,epsilonshrinkdot_sp,epsilonshrinkdotx_sp,epsilonshrinkdoty_sp,e_pl_sp,sigma_global_big,e_t_global_big,e_pl_global_big,alphahp,pforce_sp,xdirletter,ydirletter,zdirletter,xydirletter,yzdirletter,xzdirletter,ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,Grt,Gtl,Grl,nurt,nutl,nurl,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit,CasetoRun,troubleshotparticles,matmodel,weakeningfactor_sp,orientationoffset,ynodedamped,yparticledamped,t0_plane,psp1,ignoremomentum,le_c,LOCX,LOCY,Rdisplayedparticles,t_time,Debugging,x_crack,dudx_sp,W_sp,thetacrackrtl,ncforce_cracktop,ncforce_crackbot,le_base,dumpresult,uncrackable_sp,sigmamaxprincmaxperfy,Efactor_sp);
			

			stressnorm=0;
			dispnorm=0;
			
			Ga=0;
			Grelativeerror=0;
			if CasetoRun==144 || CasetoRun==148 || CasetoRun==145 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147
				steelstrength=9999999;
			elseif CasetoRun==179
				steelstrength=1e10;
			else
				steelstrength=25; %MPa
			end

			if CasetoRun==115 || CasetoRun==116 || CasetoRun==117
				sigmamaxprinc=zeros(spCount,1);
				for sp_inloop=1:spCount
					sigmamaxprinc(sp_inloop)=0.5*(s_sp(sp_inloop,1)+s_sp(sp_inloop,2))+sqrt((0.5*(s_sp(sp_inloop,1)-s_sp(sp_inloop,2)))^2+s_sp(sp_inloop,3)^2);
				end
				if max(sigmamaxprinc)>steelstrength
					fprintf('%s',['Material Failure!, spCount=' int2txt(spCount) ', simgainf=' float2txt(5,sigmainf) ', sp=' float2txt(5,FindMax(sigmamaxprinc)) ', x_sp=[' float2txt(5,x_sp(spCount,1)) ',' float2txt(5,x_sp(spCount,2)) ']' char(10)]);
					%disp(['Material Failure!, spCount=' num2str(spCount) ', simgainf=' num2str(sigmainf) ', sp=' num2str(FindMax(sigmamaxprinc)) ', x_sp=[' num2str(x_sp(sp),1) ',' num2str(x_sp(sp),2) ']']);
%{
%switchable1
					if exist('refinemenfactorinput')
%}
%switchable1
						return;
%{
%switchable1
					else
						pause;
					end
%}
%switchable1
				end
			elseif CasetoRun==183
			elseif CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189
			elseif CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124
				sigmamaxprinc=zeros(spCount,1);
				for sp_inloop=1:spCount
					sigmamaxprinc(sp_inloop)=0.5*(s_sp(sp_inloop,1)+s_sp(sp_inloop,2))+sqrt((0.5*(s_sp(sp_inloop,1)-s_sp(sp_inloop,2)))^2+s_sp(sp_inloop,3)^2);
				end
				if max(sigmamaxprinc)>steelstrength
					fprintf('%s',['Material Failure!, spCount=' int2txt(spCount) ', sp=' float2txt(5,FindMax(sigmamaxprinc)) ', x_sp=[' float2txt(5,x_sp(sp,1)) ',' float2txt(5,x_sp(sp,2)) ']' char(10)]);
					%disp(['Material Failure!, spCount=' num2str(spCount) ', simgainf=' num2str(sigmainf) ', sp=' num2str(FindMax(sigmamaxprinc)) ', x_sp=[' num2str(x_sp(sp),1) ',' num2str(x_sp(sp),2) ']']);
%{
%switchable1
					if exist('refinemenfactorinput')
%}
%switchable1
						return;
%{
%switchable1
					else
						pause;
					end
%}
%switchable1
				end
			elseif CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120
				if sigmainf>0.5
%{
%switchable1

					if exist('refinemenfactorinput')
%}
%switchable1
						SIGMAmxstressnorm=0;
						SIGMAm=0;
						for sp_inloop=1:spCount
							if CasetoRun==120
								x=x_spo(sp_inloop,1)-x_central(1);
								y=x_spo(sp_inloop,2)-x_central(2);
							else
								x=x_sp(sp_inloop,1)-x_central(1);
								y=x_sp(sp_inloop,2)-x_central(2);
							end
							sigmay=real(S*a^2*(1/a^2 + (y*2i)/((x + y*1i)^2 - a^2)^(3/2)))/2 + (real(S)*(real((x - y*1i)/((x - y*1i)^2 - a^2)^(1/2)) + real((x + y*1i)/((x + y*1i)^2 - a^2)^(1/2)) - 1))/2;
							sigmax = - real(S*a^2*(1/a^2 + (y*2i)/((x + y*1i)^2 - a^2)^(3/2)))/2 - (real(S)*(real((x - y*1i)/((x - y*1i)^2 - a^2)^(1/2)) + real((x + y*1i)/((x + y*1i)^2 - a^2)^(1/2)) - 1))/2 + S*(real((x - y*1i)/((x - y*1i)^2 - a^2)^(1/2)) + real((x + y*1i)/((x + y*1i)^2 - a^2)^(1/2)) - 1);
							sigmaxy = imag(S*a^2*(1/a^2 + (y*2i)/((x + y*1i)^2 - a^2)^(3/2)))/2;
							sigmaerror=s_sp(sp_inloop,:)-[sigmax sigmay sigmaxy];
							SIGMAmxstressnorm=SIGMAmxstressnorm+m_sp(sp_inloop)*sqrt(dot(sigmaerror,sigmaerror));
							SIGMAm=SIGMAm+m_sp(sp_inloop);
						end
						stressnorm=SIGMAmxstressnorm/SIGMAm;
						gridsize=le(1); %assuming size in x and in y are the same
%{
%switchable1
					end
%}
%switchable1
				end
				K1=sigmainf*sqrt(3.1415926536*a);
				Ga=K1^2*(1-nu^2)/E;
				Grelativeerror=abs(G-Ga)/Ga;
				fprintf('%s',['Ga=' float2txt(5,Ga) ', G=' float2txt(5,G) ', thetac=' float2txt(5,thetac*180/3.1415926536) ' degrees' char(10)]);
				if sigmainf>0.5 
%{
%switchable1
					if exist('refinemenfactorinput')
%}
%switchable1
						Dmatrix=E/((1+nu)*(1-2*nu))*[1-nu nu 0;nu 1-nu 0;0 0 (1-2*nu)];
						return;
%{
%switchable1
					end
%}
%switchable1
				end
				1;
			end
%{
%switchable1
			if CasetoRun==3 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==17
				save([TimeStampedName '\\evaltimes\\t_time=' char(vpa(t_time)) '.mat'],'-v7.3','evaltimes');
			end
%}
%switchable1
			
%{
%switchable1
			if CasetoRun==27
				for j=1:size(stackvars,1)
					if stackvars(j,2)==0
						stackvars(j,3)=stackvars(size(stackvars,1),2)/1000;
					else
						stackvars(j,3)=0;
					end
				end
				StressProfile=figure;
				set(StressProfile,'visible','off');
				hold on;
				set(StressProfile,'Position',[0 0 720 1280]);
				currentgcp=gcp;
				title(['cores=' num2str(currentgcp.NumWorkers) ', tt= ' num2str(i) ', t_time=' char(vpa(t_time))]);
				%xlim([0 xupperlimit]);

				BarProfile=barh(stackvars,'stacked');
				set(BarProfile,{'FaceColor'},{'none';'k';'r'},'EdgeColor','none','BarWidth',1);
				%set(BarProfile,'BarWidth',1);
				saveas(StressProfile,[TimeStampedName '\\scheduleotf\\tt=' num2str(tt) ', t_time=' char(vpa(t_time)) '.png']);
				%frame = getframe(StressProfile);
				%writeVideo(writerObj,frame);
				hold off;
				close(StressProfile);
			end
%}
%switchable1
			%if CloseEnough(t_time,0.857,1e-5,2)
			%    return
			%end
%{
%switchable1
			if CasetoRun==14
				elapsedtime=[elapsedtime toc];
				starttimestep=[starttimestep t_time];
			end
%}
%switchable1
			% Update time and step 
			t_time=t_time+dt;
%{
%switchable1
			if CasetoRun==14
				endtimestep=[endtimestep t_time];
				save([TimeStampedName '-timehistory.mat'],'-v7.3','elapsedtime','starttimestep','endtimestep','numberofcores','sourcefilename');
			end
%}
%switchable1
		end
		
		%% Plot the result

		F=zeros(1,2);
		D=zeros(1,2);
		for i=1:sp_predvelnum
			for j=1:2
			   D(j)=D(j)+(x_sp(displacementmonitoredparticles(i),j)-x_spo(displacementmonitoredparticles(i),j));
			end
		end

		for i=1:length(F_rollerX)
			F(1)=F(1)+F_rollerX(i);
		end
		for i=1:length(F_rollerY)
			F(2)=F(2)+F_rollerY(i);
		end

		%{
		for i=1:2
			F(i)=sum(pforce_sp(:,i));
		end
		%}

		D=D/sp_predvelnum;
		if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==21 || CasetoRun==17 || CasetoRun==64 || CasetoRun==66 || CasetoRun==65 || CasetoRun==70
			CurrentTLDSize=size(TLD,1);
			TLD=MatrixInsertion(TLD,CurrentTLDSize+1,1,t_time);
			TLD=MatrixInsertion(TLD,CurrentTLDSize+1,2,F(2));
			TLD=MatrixInsertion(TLD,CurrentTLDSize+1,3,D(2));
		elseif CasetoRun==67 || CasetoRun==68 || CasetoRun==71 || CasetoRun==72 || CasetoRun==73 || CasetoRun==74 || CasetoRun==78 || CasetoRun==81 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==83 || CasetoRun==84 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124 || CasetoRun==117 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110 || CasetoRun==96 || CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89 || CasetoRun==85 || CasetoRun==77 || CasetoRun==69
		elseif CasetoRun==4
			CurrentTLDSize=size(TLD,1);
			TLD=MatrixInsertion(TLD,CurrentTLDSize+1,1,t_time);
			TLD=MatrixInsertion(TLD,CurrentTLDSize+1,2,F(2));
			TLD=MatrixInsertion(TLD,CurrentTLDSize+1,3,D(2));
		elseif CasetoRun==5 || CasetoRun==6
			CurrentTLDSize=size(TLD,1);
			TLD=MatrixInsertion(TLD,CurrentTLDSize+1,1,t_time);
			TLD=MatrixInsertion(TLD,CurrentTLDSize+1,2,F(2)-sum(Fyignore));
			TLD=MatrixInsertion(TLD,CurrentTLDSize+1,3,D(2));
		elseif CasetoRun==7
			CurrentTLDSize=size(TLD,1);
			TLD=MatrixInsertion(TLD,CurrentTLDSize+1,1,t_time);
			TLD=MatrixInsertion(TLD,CurrentTLDSize+1,2,F(2)-sum(Fyignore));
			TLD=MatrixInsertion(TLD,CurrentTLDSize+1,3,D(2));
		elseif CasetoRun==8 || CasetoRun==9
			CurrentTLDSize=size(TLD,1);
			TLD=MatrixInsertion(TLD,CurrentTLDSize+1,1,t_time);
			TLD=MatrixInsertion(TLD,CurrentTLDSize+1,2,F(2));
			TLD=MatrixInsertion(TLD,CurrentTLDSize+1,3,D(2));
		elseif CasetoRun==10
			CurrentTLDSize=size(TLD,1);
			TLD=MatrixInsertion(TLD,CurrentTLDSize+1,1,t_time);
			TLD=MatrixInsertion(TLD,CurrentTLDSize+1,2,F(2));
			TLD=MatrixInsertion(TLD,CurrentTLDSize+1,3,D(2));
		elseif CasetoRun==11
			CurrentTLDSize=size(TLD,1);
			TLD=MatrixInsertion(TLD,CurrentTLDSize+1,1,t_time);
			TLD=MatrixInsertion(TLD,CurrentTLDSize+1,2,F(2));
			TLD=MatrixInsertion(TLD,CurrentTLDSize+1,3,D(2));
		elseif CasetoRun==12 || CasetoRun==16 || CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44
			CurrentTLDSize=size(TLD,1);
			TLD=MatrixInsertion(TLD,CurrentTLDSize+1,1,t_time);
			TLD=MatrixInsertion(TLD,CurrentTLDSize+1,2,F(2));
			TLD=MatrixInsertion(TLD,CurrentTLDSize+1,3,D(2));
		elseif CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==15 || CasetoRun==14
			CurrentTLDSize=size(TLD,1);
			TLD=MatrixInsertion(TLD,CurrentTLDSize+1,1,t_time);
			TLD=MatrixInsertion(TLD,CurrentTLDSize+1,2,F(2));
			TLD=MatrixInsertion(TLD,CurrentTLDSize+1,3,D(2));
		end
		%predeterminedvelocityvalue
		%for i=1:length(particleswithpredeterminedvelocities)
			%disp(['v(' num2str(particleswithpredeterminedvelocities(i)) ')=[' num2str(v_ssp(particleswithpredeterminedvelocities(i),1)) ' ' num2str(v_ssp(particleswithpredeterminedvelocities(i),2)) ']']);
			%disp(['d(' num2str(particleswithpredeterminedvelocities(i)) ')=[' num2str(x_sp(particleswithpredeterminedvelocities(i),1)-x_spo(particleswithpredeterminedvelocities(i),1)) ' ' num2str(x_sp(particleswithpredeterminedvelocities(i),2)-x_spo(particleswithpredeterminedvelocities(i),2)) ']']);
		%end
		
		%start of v_ssp_an and u_sp error calculation
		if CasetoRun==154
			anerror.v_err_absolute=anerror.v_ssp_an-v_ssp;
			anerror.v_srsserror=sqrt(dot(anerror.v_err_absolute(:,1),anerror.v_err_absolute(:,1))+dot(anerror.v_err_absolute(:,2),anerror.v_err_absolute(:,2)));
			anerror.v_srssan=sqrt(dot(anerror.v_ssp_an(:,1),anerror.v_ssp_an(:,1))+dot(anerror.v_ssp_an(:,2),anerror.v_ssp_an(:,2)));
			anerror.v_err_relative=anerror.v_srsserror/anerror.v_srssan;

			%anerror.u_sp=x_sp-x_spo;
			for isp=1:spCount
				for idim=1:2
					anerror.u_sp(isp,idim)=x_sp(isp,idim)-x_spo(isp,idim);
				end
			end
			anerror.u_err_absolute=anerror.u_sp_an-anerror.u_sp;
			anerror.u_srsserror=sqrt(dot(anerror.u_err_absolute(:,1),anerror.u_err_absolute(:,1))+dot(anerror.u_err_absolute(:,2),anerror.u_err_absolute(:,2)));
			anerror.u_srssan=sqrt(dot(anerror.u_sp_an(:,1),anerror.u_sp_an(:,1))+dot(anerror.u_sp_an(:,2),anerror.u_sp_an(:,2)));
			anerror.u_err_relative=anerror.u_srsserror/anerror.u_srssan;
		end
		%end of v_ssp_an and u_sp error calculation
		
		%autosavetimemodnew=mod(t_time,autosavetimeinterval);
%{
%switchable1
		if justloadedyo==1
			justloadedyo=0;
		else
%}
%switchable1
			%ttstart=516; % define ttstart here
%{
%switchable1
			save([TimeStampedName '-Master.mat'],'-v7.3', ...
				'tt', ...
				'TimeStampedName', ...
				'TLD', ...
				'ttstart');
%}
%switchable1
			if CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189
				if tt==1
					savesinglelong(1,[TimeStampedName '-Master-' 'x_crack_bridge_tt_first' '.txt']);
					savesinglelong(1,[TimeStampedName '-Master-' 'x_crack_bridge_tt_last' '.txt']);
					x_crack.bridge.tt_last.savetoken=0;
				end
				if x_crack.bridge.tt_first.savetoken
					savesinglelong(x_crack.bridge.tt_first.value,[TimeStampedName '-Master-' 'x_crack_bridge_tt_first' '.txt']);
					x_crack.bridge.tt_first.savetoken=0;
				end
				if x_crack.bridge.tt_last.savetoken
					savesinglelong(x_crack.bridge.tt_last.value,[TimeStampedName '-Master-' 'x_crack_bridge_tt_last' '.txt']);
					x_crack.bridge.tt_last.savetoken=0;
				end
			end
			parfor i=1:4
				if i==1
					savesinglefloat(energy.kinetic.value,[TimeStampedName '-Slave-' 'energy_kinetic_value' '-' int2txt(tt) '.txt']);
					savesinglefloat(energy.strain.value,[TimeStampedName '-Slave-' 'energy_strain_value' '-' int2txt(tt) '.txt']);
					savesinglefloat(energy.work.value,[TimeStampedName '-Slave-' 'energy_work_value' '-' int2txt(tt) '.txt']);
					savesinglefloat(x_crack.bridge.storedanddissed.value,[TimeStampedName '-Slave-' 'x_crack_bridge_storedanddissed_value' '-' int2txt(tt) '.txt']);
				elseif i==2
					savesinglelong(tt,[TimeStampedName '-Slave-' 'tt' '-' int2txt(tt) '.txt']);
					savesinglefloat(t_time,[TimeStampedName '-Slave-' 't_time' '-' int2txt(tt) '.txt']);
					savesinglefloat(DispPump,[TimeStampedName '-Slave-' 'DispPump' '-' int2txt(tt) '.txt']);
				elseif i==3
					savematrixfloat(F_rollerX,[TimeStampedName '-Slave-' 'F_rollerX' '-' int2txt(tt) '.txt']);
				elseif i==4
					savematrixfloat(F_rollerY,[TimeStampedName '-Slave-' 'F_rollerY' '-' int2txt(tt) '.txt']);
				end
			end
			if ((CasetoRun~=161) && tt==1) || dumpresult || ((CasetoRun==161) && t_time>=0.5) %targettime
				fprintf('%s',['Saving, tt=' int2txt(tt) char(10)]);
				parfor i=1:4
					if i==1
						savestring(TimeStampedName,[TimeStampedName '-Master-' 'TimeStampedName' '.txt']);
						savematrixfloat(TLD,[TimeStampedName '-Master-' 'TLD' '.txt']);
						
						
						savematrixfloat(v_ssp,[TimeStampedName '-Slave-' 'v_ssp' '-' int2txt(tt) '.txt']);
						savematrixfloat(x_sp,[TimeStampedName '-Slave-' 'x_sp' '-' int2txt(tt) '.txt']);
						savecellmatrixfloat(F_sp,[TimeStampedName '-Slave-' 'F_sp' '-' int2txt(tt) '.txt']);
						savematrixfloat(A_sp,[TimeStampedName '-Slave-' 'A_sp' '-' int2txt(tt) '.txt']);
						savematrixfloat(t_sp,[TimeStampedName '-Slave-' 't_sp' '-' int2txt(tt) '.txt']);
						savematrix3float(s_si,[TimeStampedName '-Slave-' 's_si' '-' int2txt(tt) '.txt']);
						savematrixfloat(s_si_comb,[TimeStampedName '-Slave-' 's_si_comb' '-' int2txt(tt) '.txt']);
						savematrixfloat(x_gauss_dump,[TimeStampedName '-Slave-' 'x_gauss_dump' '-' int2txt(tt) '.txt']);
						savematrixfloat(s_si_K1,[TimeStampedName '-Slave-' 's_si_K1' '-' int2txt(tt) '.txt']);
						savematrixfloat(u_si_comb,[TimeStampedName '-Slave-' 'u_si_comb' '-' int2txt(tt) '.txt']);
						savematrixfloat(x_crack.bridge.absforce,[TimeStampedName '-Slave-' 'x_crack_bridge_absforce' '-' int2txt(tt) '.txt']);
						savematrixfloat(x_crack.bridge.firsttimeactive,[TimeStampedName '-Slave-' 'x_crack_bridge_firsttimeactive' '-' int2txt(tt) '.txt']);
					elseif i==2
						savematrixfloat(s_sp,[TimeStampedName '-Slave-' 's_sp' '-' int2txt(tt) '.txt']);
						savematrixfloat(p_sp,[TimeStampedName '-Slave-' 'p_sp' '-' int2txt(tt) '.txt']);
						savematrixfloat(r1_sp,[TimeStampedName '-Slave-' 'r1_sp' '-' int2txt(tt) '.txt']);
						savematrixfloat(r2_sp,[TimeStampedName '-Slave-' 'r2_sp' '-' int2txt(tt) '.txt']);
						savematrixfloat(E_acc,[TimeStampedName '-Slave-' 'E_acc' '-' int2txt(tt) '.txt']);
						savematrixfloat(e_pl_sp,[TimeStampedName '-Slave-' 'e_pl_sp' '-' int2txt(tt) '.txt']);
						savematrixfloat(sigma_global_big,[TimeStampedName '-Slave-' 'sigma_global_big' '-' int2txt(tt) '.txt']);
						savematrixfloat(e_t_global_big,[TimeStampedName '-Slave-' 'e_t_global_big' '-' int2txt(tt) '.txt']);
						savematrixfloat(e_pl_global_big,[TimeStampedName '-Slave-' 'e_pl_global_big' '-' int2txt(tt) '.txt']);
						savematrixfloat(s_tip_dump,[TimeStampedName '-Slave-' 's_tip_dump' '-' int2txt(tt) '.txt']);
						savematrixfloat(s_tip_K1_dump,[TimeStampedName '-Slave-' 's_tip_K1_dump' '-' int2txt(tt) '.txt']);
						savematrixfloat(d_tip_dump,[TimeStampedName '-Slave-' 'd_tip_dump' '-' int2txt(tt) '.txt']);
						savesinglefloat(rampfactor,[TimeStampedName '-Slave-' 'rampfactor' '-' int2txt(tt) '.txt']);
						savematrixfloat(x_crack.bridge.adjusted.absdeltaxmaxi,[TimeStampedName '-Slave-' 'x_crack_bridge_absdeltaxmaxi' '-' int2txt(tt) '.txt']);
						
					elseif i==3
						savematrixfloat(alphahp,[TimeStampedName '-Slave-' 'alphahp' '-' int2txt(tt) '.txt']);
						savematrixfloat(f_final_vect,[TimeStampedName '-Slave-' 'f_final_vect' '-' int2txt(tt) '.txt']);
						savematrixfloat(surfacewithfmax,[TimeStampedName '-Slave-' 'surfacewithfmax' '-' int2txt(tt) '.txt']);
						savematrixfloat(sigma_local_big,[TimeStampedName '-Slave-' 'sigma_local_big' '-' int2txt(tt) '.txt']);
						savematrixfloat(evaltimes,[TimeStampedName '-Slave-' 'evaltimes' '-' int2txt(tt) '.txt']);
						savematrixfloat(stackvars,[TimeStampedName '-Slave-' 'stackvars' '-' int2txt(tt) '.txt']);
						savematrixfloat(duration,[TimeStampedName '-Slave-' 'duration' '-' int2txt(tt) '.txt']);
						savematrix3floatcell(x_crack.center,x_crack.nparticles,x_crack.npaths,[TimeStampedName '-Slave-' 'x_crack' '-' int2txt(tt) '.txt'])
						savematrix3floatcell(x_crack.top,x_crack.nparticles,x_crack.npaths,[TimeStampedName '-Slave-' 'x_cracktop' '-' int2txt(tt) '.txt'])
						savematrix3floatcell(x_crack.bot,x_crack.nparticles,x_crack.npaths,[TimeStampedName '-Slave-' 'x_crackbot' '-' int2txt(tt) '.txt'])
						%savematrix3float(x_crack.center,[TimeStampedName '-Slave-' 'x_crack.center' '-' int2txt(tt) '.txt']);
						%savematrix3float(x_crack.top,[TimeStampedName '-Slave-' 'x_crack.top' '-' int2txt(tt) '.txt']);
						%savematrix3float(x_crack.bottom,[TimeStampedName '-Slave-' 'x_crack.bottom' '-' int2txt(tt) '.txt']);
						%savematrixlong(x_crack.nparticles,[TimeStampedName '-Slave-' 'x_crack.nparticles' '-' int2txt(tt) '.txt']);
						%savesinglelong(x_crack.npaths,[TimeStampedName '-Slave-' 'x_crack.npaths' '-' int2txt(tt) '.txt']);
						%savecellmatrixfloat(x_cracktop,[TimeStampedName '-Slave-' 'x_cracktop' '-' int2txt(tt) '.txt']);
						%savecellmatrixfloat(x_crackbot,[TimeStampedName '-Slave-' 'x_crackbot' '-' int2txt(tt) '.txt']);
						savematrixfloat(x_tip_dump,[TimeStampedName '-Slave-' 'x_tip_dump' '-' int2txt(tt) '.txt']);
						savematrixfloat(d_LOC_tip_dump,[TimeStampedName '-Slave-' 'd_LOC_tip_dump' '-' int2txt(tt) '.txt']);
						savematrixfloat(x_crack.tipcrackratio,[TimeStampedName '-Slave-' 'x_crack_tipcrackratio' '-' int2txt(tt) '.txt']);
						savematrixfloat(x_crack.bridge.base.absdeltax,[TimeStampedName '-Slave-' 'x_crack_bridge_base_absdeltax' '-' int2txt(tt) '.txt']);
					elseif i==4
						savematrixfloat(dudx_sp,[TimeStampedName '-Slave-' 'dudx_sp' '-' int2txt(tt) '.txt']);
						savematrixfloat(W_sp,[TimeStampedName '-Slave-' 'W_sp' '-' int2txt(tt) '.txt']);
						savematrixfloat(thetacrackrtl,[TimeStampedName '-Slave-' 'thetacrackrtl' '-' int2txt(tt) '.txt']);
						savematrixfloat(thetacrack,[TimeStampedName '-Slave-' 'thetacrack' '-' int2txt(tt) '.txt']);
						savematrixfloat(pforce_sp,[TimeStampedName '-Slave-' 'pforce_sp' '-' int2txt(tt) '.txt']);
						savesinglefloat(sigmainf,[TimeStampedName '-Slave-' 'sigmainf' '-' int2txt(tt) '.txt']);
						savesinglefloat(G,[TimeStampedName '-Slave-' 'G' '-' int2txt(tt) '.txt']);
						savesinglefloat(Ga,[TimeStampedName '-Slave-' 'Ga' '-' int2txt(tt) '.txt']);
						savesinglefloat(Grelativeerror,[TimeStampedName '-Slave-' 'Grelativeerror' '-' int2txt(tt) '.txt']);
						savematrixfloat(ntforce_si,[TimeStampedName '-Slave-' 'ntforce_si' '-' int2txt(tt) '.txt']);
						%savematrixfloat(asdf,[TimeStampedName '-Slave-' 'asdf' '-' int2txt(tt) '.txt']);
						savematrixfloat(s_gauss_dump,[TimeStampedName '-Slave-' 's_gauss_dump' '-' int2txt(tt) '.txt']);
						savematrixfloat(r_propdirweighted_dump,[TimeStampedName '-Slave-' 'r_propdirweighted_dump' '-' int2txt(tt) '.txt']);
					end
				end
				%start of case-specific data dumps
				if CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180
					parfor i=1:4
						if i==1
							savesinglefloat(pushcol.relative_r_sp.curavg,[TimeStampedName '-Slave-' 'pushcol.relative_r_sp.curavg' '-' int2txt(tt) '.txt']);
							savesinglefloat(pushcol.relative_r_sp.coltgt,[TimeStampedName '-Slave-' 'pushcol.relative_r_sp.coltgt' '-' int2txt(tt) '.txt']);
						elseif i==2
							savesinglefloat(pushcol.relative_r_sp.delta,[TimeStampedName '-Slave-' 'pushcol.relative_r_sp.delta' '-' int2txt(tt) '.txt']);
							savesinglefloat(pushcol.relative_r_sp.springforce,[TimeStampedName '-Slave-' 'pushcol.relative_r_sp.springforce' '-' int2txt(tt) '.txt']);
						elseif i==3
							savesinglefloat(pushcol.v_r_sp.curavg,[TimeStampedName '-Slave-' 'pushcol.v_r_sp.curavg' '-' int2txt(tt) '.txt']);
							savesinglefloat(pushcol.v_r_sp.coltgt,[TimeStampedName '-Slave-' 'pushcol.v_r_sp.coltgt' '-' int2txt(tt) '.txt']);
						elseif i==4
							savesinglefloat(pushcol.v_r_sp.delta,[TimeStampedName '-Slave-' 'pushcol.v_r_sp.delta' '-' int2txt(tt) '.txt']);
							savesinglefloat(pushcol.v_r_sp.dampforce,[TimeStampedName '-Slave-' 'pushcol.v_r_sp.dampforce' '-' int2txt(tt) '.txt']);
						end
					end
				elseif CasetoRun==154 || CasetoRun==161
					parfor i=1:4
						if i==1
							savematrixfloat(anerror.v_ssp_an,[TimeStampedName '-Slave-' 'anerror.v_ssp_an' '-' int2txt(tt) '.txt']);
							savematrixfloat(anerror.u_sp_an,[TimeStampedName '-Slave-' 'anerror.u_sp_an' '-' int2txt(tt) '.txt']);
						elseif i==2
							savematrixfloat(anerror.u_sp,[TimeStampedName '-Slave-' 'anerror.u_sp' '-' int2txt(tt) '.txt']);
							savesinglefloat(anerror.v_srsserror,[TimeStampedName '-Slave-' 'anerror.v_srsserror' '-' int2txt(tt) '.txt']);
							savesinglefloat(anerror.u_srsserror,[TimeStampedName '-Slave-' 'anerror.u_srsserror' '-' int2txt(tt) '.txt']);
						elseif i==3
							savesinglefloat(anerror.v_srssan,[TimeStampedName '-Slave-' 'anerror.v_srssan' '-' int2txt(tt) '.txt']);
							savesinglefloat(anerror.u_srssan,[TimeStampedName '-Slave-' 'anerror.u_srssan' '-' int2txt(tt) '.txt']);
						elseif i==4
							savesinglefloat(anerror.v_err_relative,[TimeStampedName '-Slave-' 'anerror.v_err_relative' '-' int2txt(tt) '.txt']);
							savesinglefloat(anerror.u_err_relative,[TimeStampedName '-Slave-' 'anerror.u_err_relative' '-' int2txt(tt) '.txt']);
						end
					end
				end
				if CasetoRun==191 || CasetoRun==192
					parfor i=1:3
						if i==1
							savematrixfloat(x_crack.sequence.tipreg,[TimeStampedName '-Slave-' 'x_crack_sequence_tipreg' '-' int2txt(tt) '.txt']);
						elseif i==2
							savematrixfloat(x_crack.sequence.merge,[TimeStampedName '-Slave-' 'x_crack_sequence_merge' '-' int2txt(tt) '.txt']);
						elseif i==3
							savematrixfloat(x_crack.nparticles,[TimeStampedName '-Slave-' 'x_crack_nparticles' '-' int2txt(tt) '.txt']);
						end
					end
					x_crack.sequence.tipreg=zeros(200,2);
					x_crack.sequence.merge=zeros(200,2);
				end				%end of case-specific data dumps
				savesinglelong(tt,[TimeStampedName '-Master-' 'tt' '.txt']);
				if ntt<=1
					savesinglelong(tt,[TimeStampedName '-Master-' 'ttstart' '.txt']);
				end
				ntt=ntt+1;
				if CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174
					if ntt>2000
						return;
					end
				elseif CasetoRun==153
					if ntt>999
						return;
					end
				elseif CasetoRun==154 || CasetoRun==161
					%if ntt>2500
					if ntt>600
						return;
					end
				elseif CasetoRun==175 || CasetoRun==194 || CasetoRun==180
					if ntt>1000
						return;
					end
				elseif CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189
					if ntt>refinementfactor/5*750
						return;
					end
				else
					if ntt>500
						return;
					end
				end
			else
				fprintf('%s',['Skipping tt=' int2txt(tt) char(10)]);
			end
			
			if CasetoRun==161
				if t_time>=0.5 %targettime
					anerror.gridsize=le(1);
					anerror.t_deviation=t_time-0.5 %targettime;
					for isp=1:spCount
						for idim=1:2
							anerror.u_sp(isp,idim)=x_sp(isp,idim)-x_spo(isp,idim);
						end
					end
					anerror.u_err_absolute=anerror.u_sp_an-anerror.u_sp;
					anerror.u_srsserror=sqrt(dot(anerror.u_err_absolute(:,1),anerror.u_err_absolute(:,1))+dot(anerror.u_err_absolute(:,2),anerror.u_err_absolute(:,2)));
					anerror.u_srssan=sqrt(dot(anerror.u_sp_an(:,1),anerror.u_sp_an(:,1))+dot(anerror.u_sp_an(:,2),anerror.u_sp_an(:,2)));
					anerror.u_err_relative=anerror.u_srsserror/anerror.u_srssan;
					savesinglelong(tt,[TimeStampedName '-Master-' 'ttstart' '.txt']);
					savesinglelong(tt,[TimeStampedName '-Master-' 'tt' '.txt']);
					return;
				end
			end
%{
%switchable1
			save([TimeStampedName '\\' num2str(tt) '.mat'],'-v7.3', ...
				'tt', ...
				't_time', ...
				'v_ssp', ...
				'x_sp', ...
				'F_sp', ...
				'A_sp', ...
				't_sp', ...
				's_sp', ...
				'p_sp', ...
				'r1_sp', ...
				'r2_sp', ...
				'F_rollerX', ...
				'F_rollerY', ...
				'E_acc', ...
				'e_pl_sp', ...
				'sigma_global_big', ...
				'e_t_global_big', ...
				'e_pl_global_big', ...
				'alphahp', ...
				'f_final_vect', ...
				'surfacewithfmax', ...
				'sigma_local_big', ...
				'DispPump', ...
				'evaltimes', ...
				'stackvars', ...
				'duration', ...
				'x_crack', ...
				'x_cracktop', ...
				'x_crackbot', ...
				'dudx_sp', ...
				'W_sp', ...
				'thetacrackrtl', ...
				'thetacrack', ...
				'pforce_sp', ...
				'sigmainf', ...
				'G', ...
				'Ga', ...
				'Grelativeerror', ...
				'ntforce_si');
%}
%switchable1

%{
%switchable1

		end
%}
%switchable1
		%autosavetimemodprev=autosavetimemodnew;
		
		tt=tt+1;
	end
	tt=tt-1;    
	%{
    close(StressProfile1);
    close(StressProfile2);
    close(StressProfile4);
	%}  
    if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==21 || CasetoRun==17
    elseif CasetoRun==4
        loadplot=TLD(:,2)/1000;
		dispplot=zeros(1,length(TLD(:,3)));
        for i=1:length(TLD(:,3))
            dispplot(i)=1+TLD(i,3)/50;
        end
    elseif CasetoRun==5 || CasetoRun==6
    elseif CasetoRun==7
    elseif CasetoRun==8 || CasetoRun==9
    elseif CasetoRun==10
    elseif CasetoRun==11
    elseif CasetoRun==12 || CasetoRun==16 || CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44
    elseif CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==15 || CasetoRun==14
    end

    % Start Printing TLD Video
%{
%switchable1
    if exist('layer')==0
        layer=[];
    end
%}
%switchable1
    if CasetoRun==5
        tt=min(tt,2399);
    end
%{
%switchable2
    for switcher=1:5
        PrintResults_parfor(le_base,switcher,TimeStampedName,videofps,tt,ttstart,DispPump,CModel,LOC,le,d_sp,e_sp,v_ssp,spCount,niCount,E_acc,TLD,plotignore,matmodel,lp,layer,CasetoRun,orientationoffset,xdirletter,ydirletter,x_spo, ...
            ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit,thetacrackrtl,refinementfactor,frameskip);
    end
%}
%switchable2

%{
%switchable1
    %plot(TLD(:,3),TLD(:,2));
    %uisave
    disp(['Look for: ' TimeStampedName]);
    close all;
    if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==21 || CasetoRun==17
    elseif CasetoRun==4
        plot(dispplot,loadplot);
        hold on;
        set(gca,'color','none');
        hold off;
    elseif CasetoRun==5 || CasetoRun==6
    elseif CasetoRun==7
    elseif CasetoRun==8 || CasetoRun==9
    elseif CasetoRun==10
    elseif CasetoRun==11
    elseif CasetoRun==12 || CasetoRun==16 || CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44
    elseif CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==15 || CasetoRun==14
    end
    soundplay
%}
%switchable1
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [energy,sigmamaxprincmaxperfy,G,thetac,v_ssp_out,x_sp_out,F_sp,A_sp,t_sp,s_sp,p_sp,r1_sp,r2_sp,F_rollerX,F_rollerY,E_acc,e_pl_sp,sigma_global_big,e_t_global_big,e_pl_global_big,alphahp,f_final_vect,surfacewithfmax,sigma_local_big,Fyignore,evaltimes,stackvars,duration,x_crack,dudx_sp,W_sp,thetacrackrtl,thetacrack,s_si,s_si_comb,s_tip_dump,x_tip_dump,s_gauss_dump,x_gauss_dump,s_si_K1,s_tip_K1_dump,r_propdirweighted_dump,u_si_comb,d_tip_dump,d_LOC_tip_dump,dumpresult] = Generic_Solver_Predvel(energy,N0,PredVelVect,deltarideal_sp,LWStatus,EWStatus,tt,ntforce_si,refinementfactor,ParticleswithPredYVel,ParticlePredYVel,Version,CModel,nodeCount,spCount,cellCount,x_sp,x_spo,d_sp,le,NN,LOC,b_sp,A_sp,t_sp,ptraction_sp,v_ssp,s_sp,m_sp,p_sp,nfbcx,nfbcy,fbcx,fbcy,E,nu,F_sp,A_spo,t_spo,dt,r1_sp,r10_sp,r2_sp,r20_sp,NodeswithPredXVel,NodeswithPredXVel2,NodeswithPredYVel,NodeswithPredYVel2,PredXVel,PredXVel2,PredYVel,PredYVel2,PredXAcc,PredXAcc2,PredYAcc,PredYAcc2,E_acc,epsilonshrinkdot_sp,epsilonshrinkdotx_sp,epsilonshrinkdoty_sp,e_pl_sp,sigma_global_big,e_t_global_big,e_pl_global_big,alphahp,pforce_sp,xdirletter,ydirletter,zdirletter,xydirletter,yzdirletter,xzdirletter,ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,Grt,Gtl,Grl,nurt,nutl,nurl,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit,CasetoRun,troubleshotparticles,matmodel,weakeningfactor_sp,orientationoffset,ynodedamped,yparticledamped,t0_plane,psp1,ignoremomentum,le_c,LOCX,LOCY,Rdisplayedparticles,t_time,Debugging,x_crack,dudx_sp,W_sp,thetacrackrtl,ncforce_cracktop,ncforce_crackbot,le_base,dumpresult,uncrackable_sp,sigmamaxprincmaxperfy,Efactor_sp)
    G=0;
	thetac=[];
	niCount=NN(1)*NN(2);fprintf('%s',['marker #620' char(10)]);
	
	s_tip_dump=zeros(200,3);
	coder.varsize('s_tip_dump');
	s_tip_dump=zeros(2,3);
	s_tip_K1_dump=zeros(200,3);
	coder.varsize('s_tip_K1_dump');
	s_tip_K1_dump=zeros(2,3);
	
	x_tip_dump=zeros(200,2);
	coder.varsize('x_tip_dump');
	x_tip_dump=zeros(2,2);
	
	uncrackable_si_comb=zeros(niCount,1);
	
	s_gauss_dump=zeros(5000,3);
	coder.varsize('s_gauss_dump');
	s_gauss_dump=zeros(2,3);

	x_gauss_dump=zeros(5000,2);
	coder.varsize('x_gauss_dump');
	x_gauss_dump=zeros(2,2);
	diameter=1; %diameter for the gauss integrator
	if CasetoRun==118 || CasetoRun==173
		diameter=2*le(1);
	elseif CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130
		diameter=0.75;
    elseif CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165
        diameter=1e-9;
	else
		diameter=0.75;
	end
	[xy_gauss W_gauss]=GaussQuadCircle(diameter);
	x_crack.gauss.npoints=size(xy_gauss,1);
	iparticle=1;
	
	for ipath=1:x_crack.npaths
		for itip=1:2
			if itip==1
				iparticle=1;
			elseif itip==2
				iparticle=x_crack.nparticles(ipath);
			end
			for igausspoint=1:x_crack.gauss.npoints
				for dim=1:2
					x_crack.gauss.locs(igausspoint,dim,ipath,itip)=x_crack.center(iparticle,dim,ipath)+xy_gauss(igausspoint,dim);
				end
				x_crack.gauss.weights(igausspoint,ipath,itip)=W_gauss(igausspoint);
			end
		end
    	end
    
	%% Store particles into cell
	if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==21 || CasetoRun==17 || CasetoRun==4 || CasetoRun==5 || CasetoRun==6 || CasetoRun==7 || CasetoRun==10 || CasetoRun==11 || CasetoRun==12 || CasetoRun==16 || CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44 || CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==15 || CasetoRun==14 || CasetoRun==64 || CasetoRun==66 || CasetoRun==69 || CasetoRun==67 || CasetoRun==68 || CasetoRun==71 || CasetoRun==72 || CasetoRun==73 || CasetoRun==74 || CasetoRun==78 || CasetoRun==81 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==83 || CasetoRun==84 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==96 || CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89 || CasetoRun==85 || CasetoRun==77 || CasetoRun==65 || CasetoRun==70
		if CompareTexts(Version,'CPDI')
			[N,dN,CONNECT,spElems,mspoints,NODES,Nmatrix,dNxmatrix,dNymatrix,CONNECTpn] = Compute_Interpolator_CPDI(spCount,cellCount,x_sp,le,NN,LOC,r1_sp,r2_sp,A_sp,t_sp);
		elseif CompareTexts(Version,'MPM')
			[N,dN,CONNECT,spElems,mspoints,NODES,Nmatrix,dNxmatrix,dNymatrix] = Compute_Interpolator_MPM(spCount,cellCount,x_sp,le,NN,LOC,r1_sp,r2_sp,A_sp,t_sp);
		else
			fprintf('%s',['Invalid Version Input' char(10)]);
		end
	elseif CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124 || CasetoRun==117 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110
		if CompareTexts(Version,'CPDI')
			[N,dN,CONNECT,spElems,mspoints,NODES,CONNECTpn,~] = Compute_Interpolator_CPDI_optimized(spCount,cellCount,x_sp,le,NN,LOC,r1_sp,r2_sp,A_sp,t_sp,0,1);fprintf('%s',['marker #621' char(10)]);
		elseif CompareTexts(Version,'MPM')
			fprintf('%s',['Optimized MPM for patrticles not available yet! 1904122119' char(10)]);
			pause;
			1;
			%[N,dN,CONNECT,spElems,mspoints,NODES,Nmatrix,dNxmatrix,dNymatrix] = Compute_Interpolator_MPM(spCount,cellCount,x_sp,le,NN,LOC,r1_sp,r2_sp,A_sp,t_sp);
		else
			fprintf('%s',['Invalid Version Input! 1904122120' char(10)]);
			pause;
			1;
		end
	elseif CasetoRun==8 || CasetoRun==9
		if CompareTexts(Version,'CPDI')
			[N,dN,CONNECT,spElems,mspoints,NODES,Nmatrix,dNxmatrix,dNymatrix] = Compute_Interpolator_CPDI_var(spCount,cellCount,x_sp,le_c,NN,LOC,r1_sp,r2_sp,A_sp,LOCX,LOCY);
		elseif CompareTexts(Version,'MPM')
			fprintf('%s',['MPM not available for CasetoRun=' int2txt(CasetoRun) char(10)]);
		else
			fprintf('%s',['Invalid Version Input' char(10)]);
		end
    end
    
	lengthCONNECTpn=niCount;
	lengthCONNECT=spCount;
	niSizes=CONNECTpn.nrparticles;
	spSizes=zeros(1,spCount);
	for sp=1:spCount
		spSizes(sp)=length(CONNECT{sp});
	end
    numberofcrackpaths=x_crack.npaths;
	TheFieldSplitBase3_old=cell(1,niCount);
	for i=1:niCount
		TheFieldSplitBase3_old{i}=zeros(niSizes(i),numberofcrackpaths);
	end
	
	TheFieldSplitBase3=zeros(FindMaxVal(spSizes),lengthCONNECT,numberofcrackpaths);
	%{
	TheFieldSplitBase3=cell(1,lengthCONNECT);
	for sp=1:lengthCONNECT
		TheFieldSplitBase3{sp}=zeros(spSizes(sp),numberofcrackpaths);
	end
	%}
	TheFieldSplit=zeros(FindMaxVal(spSizes),lengthCONNECT);
	if CasetoRun==64 || CasetoRun==66 || CasetoRun==69 || CasetoRun==67 || CasetoRun==68 || CasetoRun==71 || CasetoRun==72 || CasetoRun==73 || CasetoRun==74 || CasetoRun==78 || CasetoRun==81 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==77 || CasetoRun==65 || CasetoRun==70
		if (CasetoRun==72 || CasetoRun==73 || CasetoRun==74 || CasetoRun==78 || CasetoRun==81 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==77) && x_crack.npaths==0
			%TheFieldSplit=ones(NN(1)*NN(2),spCount); % to stop coder whining
			TheFieldSplit=cell(1,lengthCONNECT);
			for sp=1:lengthCONNECT
				TheFieldSplit{sp}=zeros(1,spSizes(sp));
			end
			fieldnumber=1;
		else
			sp_crack_count=size(x_crack.center(:,:,1),1);
			sp_cracktop_count=sp_crack_count;
			sp_crackbot_count=sp_crack_count;
			
			[N_crack,dN_crack,CONNECT_crack,spElems_crack,mspoints_crack,NODES_crack,Nmatrix_crack,dNxmatrix_crack,dNymatrix_crack,CONNECTpn_crack] = Compute_Interpolator_MPM(sp_crack_count,cellCount,x_crack.center(:,:,1),le,NN,LOC,r1_sp,r2_sp,A_sp,t_sp);
			[N_cracktop,dN_cracktop,CONNECT_cracktop,spElems_cracktop,mspoints_cracktop,NODES_cracktop,Nmatrix_cracktop,dNxmatrix_cracktop,dNymatrix_cracktop,CONNECTpn_cracktop] = Compute_Interpolator_MPM(sp_cracktop_count,cellCount,x_crack.top(:,:,1),le,NN,LOC,r1_sp,r2_sp,A_sp,t_sp);
			[N_crackbot,dN_crackbot,CONNECT_crackbot,spElems_crackbot,mspoints_crackbot,NODES_crackbot,Nmatrix_crackbot,dNxmatrix_crackbot,dNymatrix_crackbot,CONNECTpn_crackbot] = Compute_Interpolator_MPM(sp_crackbot_count,cellCount,x_crack.bot(:,:,1),le,NN,LOC,r1_sp,r2_sp,A_sp,t_sp);
			
			[TheFieldSplit,Nmatrix,dNxmatrix,dNymatrix,Nmatrixtop,Nmatrixbot,NmatrixAll] = SplitField(spSizes,LOC,x_sp,CONNECT,CONNECTpn,x_crack.center(:,:,1),CONNECT_crack,CONNECTpn_crack,Nmatrix,dNxmatrix,dNymatrix,t_time);
		end
		
	elseif CasetoRun==83 || CasetoRun==84 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==96 || CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89 || CasetoRun==85
		if x_crack.npaths==0;
			TheFieldSplit=ones(NN(1)*NN(2),spCount); % to stop coder whining
			fieldnumber=1;
		else
			NODES_cracktop=zeros(x_crack.npaths,spCount);
			for icrackpath=x_crack.npaths
				sp_crack_count=x_crack.nparticles(icrackpath);
				sp_cracktop_count=x_crack.nparticles(icrackpath);
				sp_crackbot_count=x_crack.nparticles(icrackpath);
				
				[N_crack{icrackpath},dN_crack{icrackpath},CONNECT_crack{icrackpath},spElems_crack{icrackpath},mspoints_crack{icrackpath},NODES_crack{icrackpath},Nmatrix_crack{icrackpath},dNxmatrix_crack{icrackpath},dNymatrix_crack{icrackpath},CONNECTpn_crack{icrackpath}] = Compute_Interpolator_MPM(sp_crack_count,cellCount,x_crack.center(1:x_crack.nparticles(icrackpath),:,icrackpath),le,NN,LOC,r1_sp,r2_sp,A_sp,t_sp);
				[N_cracktop{icrackpath},dN_cracktop{icrackpath},CONNECT_cracktop{icrackpath},spElems_cracktop{icrackpath},mspoints_cracktop{icrackpath},NODES_cracktop(icrackpath,1:x_crack.nparticles(icrackpath)),Nmatrix_cracktop{icrackpath},dNxmatrix_cracktop{icrackpath},dNymatrix_cracktop{icrackpath},CONNECTpn_cracktop{icrackpath}] = Compute_Interpolator_MPM(sp_cracktop_count,cellCount,x_crack.top(1:x_crack.nparticles(icrackpath),:,icrackpath),le,NN,LOC,r1_sp,r2_sp,A_sp,t_sp);
				[N_crackbot{icrackpath},dN_crackbot{icrackpath},CONNECT_crackbot{icrackpath},spElems_crackbot{icrackpath},mspoints_crackbot{icrackpath},NODES_crackbot{icrackpath},Nmatrix_crackbot{icrackpath},dNxmatrix_crackbot{icrackpath},dNymatrix_crackbot{icrackpath},CONNECTpn_crackbot{icrackpath}] = Compute_Interpolator_MPM(sp_crackbot_count,cellCount,x_crack.bot(1:x_crack.nparticles(icrackpath),:,icrackpath),le,NN,LOC,r1_sp,r2_sp,A_sp,t_sp);
				% please optimize later by:
				% eliminating unneccessary output variables (suspected: only Nmatrix is needed)
				% prealocating cells for variables that do matter
			end
			
			for icrackpath=x_crack.npaths:-1:1;
				%[TheFieldSplit_crack{icrackpath},Nmatrix_crack{icrackpath},dNxmatrix_crack{icrackpath},dNymatrix_crack{icrackpath},NmatrixAll_crack{icrackpath}] = SplitFieldMulti_crack(LOC,x_crack{icrackpath},CONNECT_crack{icrackpath},CONNECTpn_crack{icrackpath},x_crack,CONNECT_crack,CONNECTpn_crack,Nmatrix_crack{icrackpath},dNxmatrix_crack{icrackpath},dNymatrix_crack{icrackpath},t_time,icrackpath,1);
				[TheFieldSplit_cracktop{icrackpath},Nmatrix_cracktop{icrackpath},dNxmatrix_cracktop{icrackpath},dNymatrix_cracktop{icrackpath},NmatrixAll_cracktop{icrackpath}] = SplitFieldMulti_crack(LOC,x_crack.top(1:x_crack.nparticles(icrackpath),:,icrackpath),CONNECT_cracktop{icrackpath},CONNECTpn_cracktop{icrackpath},x_crack.center(1:x_crack.nparticles(icrackpath),:,icrackpath),CONNECT_crack,CONNECTpn_crack,Nmatrix_cracktop{icrackpath},dNxmatrix_cracktop{icrackpath},dNymatrix_cracktop{icrackpath},t_time,icrackpath,2);
				[TheFieldSplit_crackbot{icrackpath},Nmatrix_crackbot{icrackpath},dNxmatrix_crackbot{icrackpath},dNymatrix_crackbot{icrackpath},NmatrixAll_crackbot{icrackpath}] = SplitFieldMulti_crack(LOC,x_crack.bot(1:x_crack.nparticles(icrackpath),:,icrackpath),CONNECT_crackbot{icrackpath},CONNECTpn_crackbot{icrackpath},x_crack.center(1:x_crack.nparticles(icrackpath),:,icrackpath),CONNECT_crack,CONNECTpn_crack,Nmatrix_crackbot{icrackpath},dNxmatrix_crackbot{icrackpath},dNymatrix_crackbot{icrackpath},t_time,icrackpath,3);
				
			end
			icrackpath_outloop=1;
			[TheFieldSplit,Nmatrix,dNxmatrix,dNymatrix,NmatrixAll] = SplitFieldMulti(spSizes,LOC,x_sp,CONNECT,CONNECTpn,x_crack.center(1:x_crack.nparticles(icrackpath_outloop),:,icrackpath_outloop),CONNECT_crack,CONNECTpn_crack,Nmatrix,dNxmatrix,dNymatrix,t_time);
		end
	elseif CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124 || CasetoRun==117 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110
		fprintf('%s',['marker #622' char(10)]);
		x_crack_length=x_crack.npaths;fprintf('%s',['marker #801' char(10)]);
		%x_crack_nulled=coder.nullcopy(x_crack);
		nCrackParticle=zeros(1,x_crack_length);fprintf('%s',['marker #802' char(10)]);
		for i=1:x_crack_length
			nCrackParticle(i)=x_crack.nparticles(i);
		end
		%x_cracktop_nulled=coder.nullcopy(x_cracktop);
		
		%additional for troubleshooting
		[N_crack,dN_crack,CONNECT_crack,spElems_crack,NODES_crack,CONNECTpn_crack]=Compute_Interpolator_MPM_CrackParticleNoCell(t_time,x_crack,le,NN,LOC);fprintf('%s',['marker #623' char(10)]);
		%[N_crack,dN_crack,CONNECT_crack,spElems_crack,NODES_crack,CONNECTpn_crack]=Compute_Interpolator_MPM_CrackParticleNoCell(x_crack,le,NN,LOC);fprintf('%s',['marker #623' char(10)]);
		
		
		TheFieldSplitBase3_cracktop_sp=cell(1,x_crack_length);
		for i=1:x_crack_length
			TheFieldSplitBase3_cracktop_sp{i}=zeros(4,x_crack.nparticles(i),x_crack_length);
		end
		TheFieldSplitBase3_crackbot_sp=cell(1,x_crack_length);
		for i=1:x_crack_length
			TheFieldSplitBase3_crackbot_sp{i}=zeros(4,x_crack.nparticles(i),x_crack_length);
		end
		
		TheFieldSplit_cracktop=cell(1,x_crack_length);
		for i=1:x_crack_length
			TheFieldSplit_cracktop{i}=zeros(4,x_crack.nparticles(i));
		end
		
		TheFieldSplit_crackbot=cell(1,x_crack_length);
		for i=1:x_crack_length
			TheFieldSplit_crackbot{i}=zeros(4,x_crack.nparticles(i));
		end
		
		%{
		for icrackpath=1:x_crack_length
			sp_crack_count=x_crack.nparticles(icrackpath);
			sp_cracktop_count=x_crack.nparticles(icrackpath);
			sp_crackbot_count=x_crack.nparticles(icrackpath);
			
			%[N_crack{icrackpath},dN_crack{icrackpath},CONNECT_crack{icrackpath},spElems_crack{icrackpath},mspoints_crack{icrackpath},NODES_crack{icrackpath},Nmatrix_crack{icrackpath},CONNECTpn_crack{icrackpath}] = Compute_Interpolator_MPM_optimized(sp_crack_count,cellCount,x_crack.center(1:x_crack.nparticles(icrackpath),:,icrackpath),le,NN,LOC,r1_sp,r2_sp,A_sp,t_sp);
			
			[N_cracktop{icrackpath},dN_cracktop{icrackpath},CONNECT_cracktop{icrackpath},spElems_cracktop{icrackpath},mspoints_cracktop{icrackpath},NODES_cracktop(icrackpath,:),Nmatrix_cracktop{icrackpath},CONNECTpn_cracktop{icrackpath}] = Compute_Interpolator_MPM_optimized(sp_cracktop_count,cellCount,x_crack.top(1:x_crack.nparticles(icrackpath),:,icrackpath),le,NN,LOC,r1_sp,r2_sp,A_sp,t_sp);
			[N_crackbot{icrackpath},dN_crackbot{icrackpath},CONNECT_crackbot{icrackpath},spElems_crackbot{icrackpath},mspoints_crackbot{icrackpath},NODES_crackbot{icrackpath},Nmatrix_crackbot{icrackpath},CONNECTpn_crackbot{icrackpath}] = Compute_Interpolator_MPM_optimized(sp_crackbot_count,cellCount,x_crack.bot(1:x_crack.nparticles(icrackpath),:,icrackpath),le,NN,LOC,r1_sp,r2_sp,A_sp,t_sp);
			
			% please optimize later by:
			% eliminating unneccessary output variables (suspected: only Nmatrix is needed)
			% prealocating cells for variables that do matter
		end
		%}
		fprintf('%s',['marker #624' char(10)]);
		if x_crack_length==0;
			%TheFieldSplit=ones(NN(1)*NN(2),spCount); % to stop coder whining
			TheFieldSplit=zeros(FindMaxVal(spSizes),lengthCONNECT);
			TheFieldSplit=ones(FindMaxVal(spSizes),lengthCONNECT);
			fieldnumber=1;
		else
			
			for icrackpath2=1:x_crack_length
				[TheFieldSplitBase3_cracktop_sp{icrackpath2}] = SplitFieldMulti_crackoptimized2_nocell(LOC,x_crack.top(1:x_crack.nparticles(icrackpath2),:,icrackpath2),CONNECT_crack.top,CONNECTpn_crack.top,x_crack,icrackpath2,2,le);
				[TheFieldSplitBase3_crackbot_sp{icrackpath2}] = SplitFieldMulti_crackoptimized2_nocell(LOC,x_crack.bot(1:x_crack.nparticles(icrackpath2),:,icrackpath2),CONNECT_crack.bot,CONNECTpn_crack.bot,x_crack,icrackpath2,3,le);
			end
			fprintf('%s',['marker #625' char(10)]);
			[TheFieldSplitBase3_old,TheFieldSplitBase3_sp,spSizes] = SplitFieldMultiOptimized2(LOC,x_sp,CONNECT,CONNECTpn,x_crack,t_time,le);
			fprintf('%s',['marker #626' char(10)]);
			%shit up there
			ncrackpath=x_crack_length;
			maplist=zeros(1000,ncrackpath);
			maplistsize=1;
			coder.varsize('maplist');
			maplist(1,:)=ones(1,ncrackpath);
			%[TheFieldSplit,maplist,maplistsize]=Base3Mapping(TheFieldSplitBase3_old,CONNECTpn,maplist,maplistsize,spCount);
			[TheFieldSplit,maplist,maplistsize]=Base3Mapping_sp(TheFieldSplitBase3_sp,CONNECT,maplist,maplistsize,niCount);fprintf('%s',['marker #627' char(10)]);
			for icrackpath=1:ncrackpath
				[TheFieldSplit_cracktop{icrackpath},maplist,maplistsize]=Base3Mapping_crack(TheFieldSplitBase3_cracktop_sp{icrackpath},CONNECTpn_crack.top.values(:,:,icrackpath),CONNECT_crack.top.values(:,:,icrackpath),CONNECT_crack.top.nrnodes(icrackpath,:),maplist,maplistsize);
				[TheFieldSplit_crackbot{icrackpath},maplist,maplistsize]=Base3Mapping_crack(TheFieldSplitBase3_crackbot_sp{icrackpath},CONNECTpn_crack.bot.values(:,:,icrackpath),CONNECT_crack.bot.values(:,:,icrackpath),CONNECT_crack.bot.nrnodes(icrackpath,:),maplist,maplistsize);
			end
			%fieldnumber=size(maplist,1);
			fieldnumber=maplistsize;fprintf('%s',['marker #628' char(10)]);
			%{
			UniqueFieldSplit=unique(TheFieldSplit);
			for icrackpath=1:length(x_crack)
				UniqueFieldSplit=[UniqueFieldSplit;unique(TheFieldSplit_cracktop{icrackpath})];
				UniqueFieldSplit=[UniqueFieldSplit;unique(TheFieldSplit_crackbot{icrackpath})];
			end
			UniqueFieldSplit=unique(UniqueFieldSplit);
			for i=1:size(TheFieldSplit,1)
				for sp_inloop=1:size(TheFieldSplit,2)
					TheFieldSplit(i,sp_inloop)=integermapping(TheFieldSplit(i,sp_inloop),UniqueFieldSplit);
				end
			end
			for icrackpath=1:length(x_crack)
				for i=1:size(TheFieldSplit_cracktop{icrackpath},1)
					for sp_inloop=1:size(TheFieldSplit_cracktop{icrackpath},2)
						TheFieldSplit_cracktop{icrackpath}(i,sp_inloop)=integermapping(TheFieldSplit_cracktop{icrackpath}(i,sp_inloop),UniqueFieldSplit);
						TheFieldSplit_crackbot{icrackpath}(i,sp_inloop)=integermapping(TheFieldSplit_crackbot{icrackpath}(i,sp_inloop),UniqueFieldSplit);
					end
				end
			end
			fieldnumber=length(UniqueFieldSplit);
			%}
			%{
			ncrackpath=size(TheFieldSplitBase3_old,3);
			maplistcounter=1;
			maplist(1,1,:)=ones(1,1,ncrackpath);
			TheFieldSplit=ones(size(TheFieldSplitBase3_old,1),size(TheFieldSplitBase3_old,2));
			for i=1:size(CONNECTpn,1)
				CONNECTpnLength=0;
				for j=1:size(CONNECTpn,2);
					if CONNECTpn(i,j)>0
						CONNECTpnLength=CONNECTpnLength+1;
					else
						break;
					end
				end
				for nsp=1:CONNECTpnLength
					sp=CONNECTpn(i,nsp);
					matchfound=0;
					for imaplist=1:size(maplist,1);
						if sum(maplist(imaplist,1,:)==TheFieldSplitBase3_old(i,sp,:))==ncrackpath;
							matchfound=1;
							TheFieldSplit(i,sp)=imaplist;
							break;
						end
					end
					if matchfound==0
						TheFieldSplit(i,sp)=size(maplist,1)+1;
						maplist(size(maplist,1)+1,1,:)=TheFieldSplitBase3_old(i,sp,:);
					end
				end
			end
			%}
		end
	else
		%TheFieldSplit=ones(NN(1)*NN(2),spCount); % to stop coder whining
		TheFieldSplit=cell(1,lengthCONNECT);
		for sp_inloop=1:lengthCONNECT
			TheFieldSplit{sp_inloop}=zeros(1,spSizes(sp_inloop));
		end
		fieldnumber=1;
	end
	%nodal preallocation
	force_si_loading=zeros(niCount,2,fieldnumber);
	s_si=zeros(niCount,3,fieldnumber);
	s_si_comb=zeros(niCount,3);
	LW_si_comb=zeros(niCount,1);
	EW_si_comb=zeros(niCount,1);

	s_si_K1=zeros(niCount,3);

	u_si=zeros(niCount,2,fieldnumber);
	v_si=zeros(niCount,2,fieldnumber);
	x_si=zeros(niCount,2,fieldnumber);
	x0_si=zeros(niCount,2,fieldnumber);
	niforce_si_spring=zeros(niCount,2,fieldnumber);
	
	u_si_comb=zeros(niCount,2);
	uncrackable_si=zeros(niCount,fieldnumber);
	deltarideal_si=zeros(niCount,fieldnumber);
	deltaractual_si=zeros(niCount,fieldnumber);
	
	% N: Shape function
	% dN: Gradient of shape function
	% spElems(p): element index where "p" locates
	% mspoints(e): all particles indexes where locate in the cell "e"
	% CONNECT{sp}: list of node numbers connected to particle sp
	% CONNECTpn(i,nsp): list of particle numbers connected to node i
	
	%numberofparticleswithpredeterminedvelocities=length(particleswithpredeterminedvelocities);
	
	%% Mapping from particle to nodes
	%pforce_sp               = [0*ones(spCount,1) 0*ones(spCount,1)];
	%for i=1:numberofparticleswithpredeterminedvelocities  
	%    pforce_sp(particleswithpredeterminedvelocities(i),:)=[100000 0];
	%end
	%{
	for i=1:numberofparticleswithpredeterminedvelocities
		for j=1:2
			v_ssp(particleswithpredeterminedvelocities(i),j)=predeterminedvelocityvalue(i,j);
		end
	end
	%}
	%pforce_sp_boundaryonly
	%v_ssp_out_boundaryonly
	%deltav_ssp
	%calculation of x_crack.force
	
	if CasetoRun==-1
		x_crack.force.top=zeros(200,2,200);
		x_crack.force.bot=zeros(200,2,200);
		x_crack.bridge.firsttimeactive=zeros(200,200);
		for ipath=1:x_crack.npaths
		if x_crack.cohesivepath(ipath)==1
			for iparticle=1:x_crack.nparticles(ipath)
			if x_crack.cohesivepoint(iparticle,ipath)==1
			if iparticle>1 && iparticle<x_crack.nparticles(ipath)
				if x_crack.bridge.isactive(iparticle,ipath)==0
					x_crack.bridge.isactive(iparticle,ipath)=1;
					x_crack.bridge.firsttimeactive(iparticle,ipath)=1;
					for idim=1:2
						x_crack.bridge.firsttimedeltax(iparticle,idim,ipath)=(x_crack.bot(iparticle,idim,ipath)-x_crack.top(iparticle,idim,ipath));
					end
					x_crack.bridge.absfirsttimedeltax(iparticle,ipath)=sqrt(dot(x_crack.bridge.firsttimedeltax(iparticle,:,ipath),x_crack.bridge.firsttimedeltax(iparticle,:,ipath)));
					if x_crack.bridge.absfirsttimedeltax(iparticle,ipath)==0
						x_crack.bridge.kbase2(iparticle,ipath)=1e99;
					else
						x_crack.bridge.kbase2(iparticle,ipath)=x_crack.bridge.yieldforce1/x_crack.bridge.absfirsttimedeltax(iparticle,ipath);
					end
				end
			end
			end
			end
		end
		end
		for ipath=1:x_crack.npaths
			for iparticle=1:x_crack.nparticles(ipath)
                if ipath==2 && iparticle==2
                    1;
                end
				for idim=1:2
					x_crack.bridge.base.deltax(iparticle,idim,ipath)=(x_crack.bot(iparticle,idim,ipath)-x_crack.top(iparticle,idim,ipath));
					x_crack.bridge.adjusted.deltax(iparticle,idim,ipath)=x_crack.bridge.base.deltax(iparticle,idim,ipath)-x_crack.bridge.firsttimedeltax(iparticle,idim,ipath);
				end
				x_crack.bridge.base.absdeltax(iparticle,ipath)=sqrt(dot(x_crack.bridge.base.deltax(iparticle,:,ipath),x_crack.bridge.base.deltax(iparticle,:,ipath)));
				
				if x_crack.bridge.adjusted.absdeltaxmax(iparticle,ipath)>0
					x_crack.bridge.adjusted.absdeltaxbefore(iparticle,ipath)=x_crack.bridge.adjusted.absdeltax(iparticle,ipath);
				end
				
				x_crack.bridge.adjusted.absdeltax(iparticle,ipath)=sqrt(dot(x_crack.bridge.adjusted.deltax(iparticle,:,ipath),x_crack.bridge.adjusted.deltax(iparticle,:,ipath)));
				if x_crack.bridge.base.absdeltax(iparticle,ipath)>x_crack.bridge.base.absdeltaxmax(iparticle,ipath)
					x_crack.bridge.base.absdeltaxmax(iparticle,ipath)=x_crack.bridge.base.absdeltax(iparticle,ipath);
				end
				if x_crack.bridge.isactive(iparticle,ipath)
				if x_crack.bridge.adjusted.absdeltax(iparticle,ipath)>x_crack.bridge.adjusted.absdeltaxmax(iparticle,ipath)
					x_crack.bridge.adjusted.absdeltaxmax(iparticle,ipath)=x_crack.bridge.adjusted.absdeltax(iparticle,ipath);
					deltay=x_crack.bridge.yieldforce1/x_crack.bridge.kbase1; %no use whatsoever
					x_crack.bridge.adjusted.absdeltaxmaxi(iparticle,ipath)=max(0,x_crack.bridge.adjusted.absdeltaxmax(iparticle,ipath)-deltay); %no use whatsoever
				end
				end
			end
		end
		x_crack.bridge.allsevered=1;
		x_crack.bridge.mostsevered=1;
		for ipath=1:x_crack.npaths
		if x_crack.cohesivepath(ipath)==1
			for iparticle=1:x_crack.nparticles(ipath)
			if x_crack.cohesivepoint(iparticle,ipath)==1
			if iparticle>1 && iparticle<x_crack.nparticles(ipath);
				deltay=x_crack.bridge.yieldforce1/x_crack.bridge.kbase2(iparticle,ipath);
				if x_crack.bridge.base.absdeltaxmax(iparticle,ipath)<=deltay
					k_t=x_crack.bridge.kbase2(iparticle,ipath); %current stiffness value
				elseif x_crack.bridge.base.absdeltaxmax(iparticle,ipath)<deltay+x_crack.bridge.deltai1
					maxforce=x_crack.bridge.yieldforce1*(1-(x_crack.bridge.base.absdeltaxmax(iparticle,ipath)-deltay)/x_crack.bridge.deltai1);
					k_t=maxforce/x_crack.bridge.base.absdeltaxmax(iparticle,ipath);
				else
					maxforce=0;
					k_t=0;
				end
				x_crack.bridge.absforcebefore(iparticle,ipath)=x_crack.bridge.absforce(iparticle,ipath);
				x_crack.bridge.absforce(iparticle,ipath)=k_t*x_crack.bridge.base.absdeltax(iparticle,ipath);
				
				%"cheat" dissipation below adjusted
				if x_crack.bridge.absforce(iparticle,ipath)>0
					1;
				end
				x_crack.bridge.storedanddissed.d=(x_crack.bridge.absforce(iparticle,ipath)+x_crack.bridge.absforcebefore(iparticle,ipath))/2*(x_crack.bridge.adjusted.absdeltax(iparticle,ipath)-x_crack.bridge.adjusted.absdeltaxbefore(iparticle,ipath));
				x_crack.bridge.storedanddissed.value=x_crack.bridge.storedanddissed.value+x_crack.bridge.storedanddissed.d;
				
				
				x_crack.bridge.pathcompletemonitor.check=0;
				for icheck=1:x_crack.bridge.pathcompletemonitor.size
					if ipath==x_crack.bridge.pathcompletemonitor.values(icheck)
						x_crack.bridge.pathcompletemonitor.check=1;
						break;
					end
				end
				if x_crack.bridge.tt_first.value==0 && x_crack.bridge.absforce(iparticle,ipath)>0
					if x_crack.bridge.pathcompletemonitor.check
						x_crack.bridge.tt_first.value=tt;
						x_crack.bridge.tt_first.savetoken=1;
					end
				end
				if x_crack.bridge.allsevered==1 && x_crack.bridge.tt_first.value~=0
					if x_crack.bridge.pathcompletemonitor.check
						if x_crack.bridge.absforce(iparticle,ipath)>0
							x_crack.bridge.allsevered=0;
						end
					end
				end
				if x_crack.bridge.mostsevered==1 && x_crack.bridge.tt_first.value~=0 && (iparticle<=3 || iparticle>=x_crack.nparticles(ipath)-3)
					if x_crack.bridge.pathcompletemonitor.check
						if x_crack.bridge.absforce(iparticle,ipath)>0
							x_crack.bridge.mostsevered=0;
						end
					end
				end
				
				for idim=1:2
					if x_crack.bridge.base.absdeltax(iparticle,ipath)>0
						x_crack.force.top(iparticle,idim,ipath)=x_crack.bridge.base.deltax(iparticle,idim,ipath)/x_crack.bridge.base.absdeltax(iparticle,ipath)*x_crack.bridge.absforce(iparticle,ipath);
						x_crack.force.bot(iparticle,idim,ipath)=-x_crack.force.top(iparticle,idim,ipath);
					else
						x_crack.force.top(iparticle,idim,ipath)=0;
						x_crack.force.bot(iparticle,idim,ipath)=0;
					end
				end
			end
			end
			end
		end
		end
		%if x_crack.bridge.allsevered==1 && x_crack.bridge.tt_first.value~=0 && x_crack.bridge.tt_last.value==0;
		if x_crack.bridge.mostsevered==1 && x_crack.bridge.tt_first.value~=0 && x_crack.bridge.tt_last.value==0;
			x_crack.bridge.tt_last.value=tt;
			x_crack.bridge.tt_last.savetoken=1;
		end
	elseif CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189
		x_crack.force.top=zeros(200,2,200);
		x_crack.force.bot=zeros(200,2,200);
		x_crack.bridge.firsttimeactive=zeros(200,200);
		for ipath=1:x_crack.npaths
		if x_crack.cohesivepath(ipath)==1
			for iparticle=1:x_crack.nparticles(ipath)
                if ipath==2 && iparticle==2
                    1;
                end
			if x_crack.cohesivepoint(iparticle,ipath)==1
			if iparticle>1 && iparticle<x_crack.nparticles(ipath)
				if x_crack.bridge.isactive(iparticle,ipath)==0
					x_crack.bridge.isactive(iparticle,ipath)=1;
					x_crack.bridge.firsttimeactive(iparticle,ipath)=1;
					for idim=1:2
						%x_crack.bridge.firsttimedeltax(iparticle,idim,ipath)=(x_crack.bot(iparticle,idim,ipath)-x_crack.top(iparticle,idim,ipath))*0.99;
						x_crack.bridge.firsttimedeltax(iparticle,idim,ipath)=(x_crack.bot(iparticle,idim,ipath)-x_crack.top(iparticle,idim,ipath));
					end
				end
			end
			end
			end
		end
		end
		for ipath=1:x_crack.npaths
			for iparticle=1:x_crack.nparticles(ipath)
                if ipath==2 && iparticle==2
                    1;
                end
				for idim=1:2
					x_crack.bridge.base.deltax(iparticle,idim,ipath)=(x_crack.bot(iparticle,idim,ipath)-x_crack.top(iparticle,idim,ipath));
					x_crack.bridge.adjusted.deltax(iparticle,idim,ipath)=x_crack.bridge.base.deltax(iparticle,idim,ipath)-x_crack.bridge.firsttimedeltax(iparticle,idim,ipath);
				end
				x_crack.bridge.base.absdeltax(iparticle,ipath)=sqrt(dot(x_crack.bridge.base.deltax(iparticle,:,ipath),x_crack.bridge.base.deltax(iparticle,:,ipath)));
				
				if x_crack.bridge.adjusted.absdeltaxmax(iparticle,ipath)>0
					x_crack.bridge.adjusted.absdeltaxbefore(iparticle,ipath)=x_crack.bridge.adjusted.absdeltax(iparticle,ipath);
				end
				
				x_crack.bridge.adjusted.absdeltax(iparticle,ipath)=sqrt(dot(x_crack.bridge.adjusted.deltax(iparticle,:,ipath),x_crack.bridge.adjusted.deltax(iparticle,:,ipath)));
				if x_crack.bridge.base.absdeltax(iparticle,ipath)>x_crack.bridge.base.absdeltaxmax(iparticle,ipath)
					x_crack.bridge.base.absdeltaxmax(iparticle,ipath)=x_crack.bridge.base.absdeltax(iparticle,ipath);
				end
				if x_crack.bridge.isactive(iparticle,ipath)
				if x_crack.bridge.adjusted.absdeltax(iparticle,ipath)>x_crack.bridge.adjusted.absdeltaxmax(iparticle,ipath)
					x_crack.bridge.adjusted.absdeltaxmax(iparticle,ipath)=x_crack.bridge.adjusted.absdeltax(iparticle,ipath);
					deltay=x_crack.bridge.yieldforce1/x_crack.bridge.kbase1;
					x_crack.bridge.adjusted.absdeltaxmaxi(iparticle,ipath)=max(0,x_crack.bridge.adjusted.absdeltaxmax(iparticle,ipath)-deltay);
				end
				end
			end
		end
		x_crack.bridge.allsevered=1;
		x_crack.bridge.mostsevered=1;
		for ipath=1:x_crack.npaths
		if x_crack.cohesivepath(ipath)==1
			for iparticle=1:x_crack.nparticles(ipath)
			if x_crack.cohesivepoint(iparticle,ipath)==1
			if iparticle>1 && iparticle<x_crack.nparticles(ipath);
				deltay=x_crack.bridge.yieldforce1/x_crack.bridge.kbase1;
				if x_crack.bridge.adjusted.absdeltaxmax(iparticle,ipath)<deltay
					k_t=x_crack.bridge.kbase1; %current stiffness value
				elseif x_crack.bridge.adjusted.absdeltaxmax(iparticle,ipath)<deltay+x_crack.bridge.deltai1
					maxforce=x_crack.bridge.yieldforce1*(1-(x_crack.bridge.adjusted.absdeltaxmax(iparticle,ipath)-deltay)/x_crack.bridge.deltai1);
					k_t=maxforce/x_crack.bridge.adjusted.absdeltaxmax(iparticle,ipath);
				else
					maxforce=0;
					k_t=0;
				end
				x_crack.bridge.absforcebefore(iparticle,ipath)=x_crack.bridge.absforce(iparticle,ipath);
				x_crack.bridge.absforce(iparticle,ipath)=k_t*x_crack.bridge.adjusted.absdeltax(iparticle,ipath);
				
				%"cheat" dissipation below
				if x_crack.bridge.absforce(iparticle,ipath)>0
					1;
				end
				x_crack.bridge.storedanddissed.d=(x_crack.bridge.absforce(iparticle,ipath)+x_crack.bridge.absforcebefore(iparticle,ipath))/2*(x_crack.bridge.adjusted.absdeltax(iparticle,ipath)-x_crack.bridge.adjusted.absdeltaxbefore(iparticle,ipath));
				x_crack.bridge.storedanddissed.value=x_crack.bridge.storedanddissed.value+x_crack.bridge.storedanddissed.d;
				
				
				x_crack.bridge.pathcompletemonitor.check=0;
				for icheck=1:x_crack.bridge.pathcompletemonitor.size
					if ipath==x_crack.bridge.pathcompletemonitor.values(icheck)
						x_crack.bridge.pathcompletemonitor.check=1;
						break;
					end
				end
				if x_crack.bridge.tt_first.value==0 && x_crack.bridge.absforce(iparticle,ipath)>0
					if x_crack.bridge.pathcompletemonitor.check
						x_crack.bridge.tt_first.value=tt;
						x_crack.bridge.tt_first.savetoken=1;
					end
				end
				if x_crack.bridge.allsevered==1 && x_crack.bridge.tt_first.value~=0
					if x_crack.bridge.pathcompletemonitor.check
						if x_crack.bridge.absforce(iparticle,ipath)>0
							x_crack.bridge.allsevered=0;
						end
					end
				end
				if x_crack.bridge.mostsevered==1 && x_crack.bridge.tt_first.value~=0 && (iparticle<=3 || iparticle>=x_crack.nparticles(ipath)-3)
					if x_crack.bridge.pathcompletemonitor.check
						if x_crack.bridge.absforce(iparticle,ipath)>0
							x_crack.bridge.mostsevered=0;
						end
					end
				end
				
				for idim=1:2
					if x_crack.bridge.adjusted.absdeltax(iparticle,ipath)>0
						x_crack.force.top(iparticle,idim,ipath)=x_crack.bridge.adjusted.deltax(iparticle,idim,ipath)/x_crack.bridge.adjusted.absdeltax(iparticle,ipath)*x_crack.bridge.absforce(iparticle,ipath);
						x_crack.force.bot(iparticle,idim,ipath)=-x_crack.force.top(iparticle,idim,ipath);
					else
						x_crack.force.top(iparticle,idim,ipath)=0;
						x_crack.force.bot(iparticle,idim,ipath)=0;
					end
				end
			end
			end
			end
		end
		end
		%if x_crack.bridge.allsevered==1 && x_crack.bridge.tt_first.value~=0 && x_crack.bridge.tt_last.value==0;
		if x_crack.bridge.mostsevered==1 && x_crack.bridge.tt_first.value~=0 && x_crack.bridge.tt_last.value==0;
			x_crack.bridge.tt_last.value=tt;
			x_crack.bridge.tt_last.savetoken=1;
		end
	end
	
	if CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124 || CasetoRun==117 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110
		[mEfactor_si,x0_si,x_si,deltarideal_si,LW_si_comb,EW_si_comb,nmass_si,nmomentum_si,niforce_si,neforce_si,traction_si,pforce_si,ncforce_si,s_si,s_si_comb,u_si,u_si_comb,v_si,uncrackable_si,uncrackable_si_comb,~]=Interpolate_Particle_To_Grid_WithPredeterminedVelocity2_optimized(LOC,N_crack,CONNECT_crack,NODES_crack,TheFieldSplit_cracktop,TheFieldSplit_crackbot,x_crack,deltarideal_sp,NODES,nodeCount,CONNECT,le,N,dN,spCount,b_sp,A_sp,t_sp,ptraction_sp,v_ssp,s_sp,m_sp,pforce_sp,TheFieldSplit,CasetoRun,fieldnumber,x_sp,x_spo,uncrackable_sp,LWStatus,EWStatus,Efactor_sp); fprintf('%s',['marker #630' char(10)]);
		1;
	else
		[nmass_si,nmomentum_si,niforce_si,neforce_si,traction_si,pforce_si,ncforce_si,~]=Interpolate_Particle_To_Grid_WithPredeterminedVelocity2(NODES,nodeCount,CONNECT,le,N,dN,spCount,b_sp,A_sp,t_sp,ptraction_sp,v_ssp,s_sp,m_sp,pforce_sp,Nmatrix,dNxmatrix,dNymatrix,ncforce_cracktop,ncforce_crackbot,Nmatrix_cracktop,Nmatrix_crackbot,TheFieldSplit,CasetoRun,CONNECTpn);
	end

	% nmass_si: nodal mass
	% nmomentum_si: nodal momentum
	% niforce_si: nodal internal force
	% neforce_si: nodal external force
	% traction_si: nodal traction
	
	%% Update momentum
	% Update force and momentum
	if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==21 || CasetoRun==17
		nforce_si      = niforce_si + neforce_si + traction_si + pforce_si - 0.1*nmomentum_si; %legit damping
	elseif CasetoRun==4
		nforce_si      = niforce_si + neforce_si + traction_si + pforce_si;
	elseif CasetoRun==64 || CasetoRun==65 || CasetoRun==70
		Nmatrixmaxfinder=zeros(length(ynodedamped),size(Nmatrix,2));
		for i=1:length(ynodedamped)
			Nmatrixmaxfinder(i,:)=Nmatrix(ynodedamped(i),:,1)+Nmatrix(ynodedamped(i),:,2)+Nmatrix(ynodedamped(i),:,3);
		end
		yparticledampedtowhichnode=zeros(1,length(yparticledamped));
		ydampingnodaldisplacement=zeros(1,length(ynodedamped));
		ydampingnodalvelocity=zeros(1,length(ynodedamped));
		for i=1:length(yparticledamped)
			yparticledampedtowhichnode(i)=FindMax(Nmatrixmaxfinder(:,yparticledamped(i)));
			ydampingnodaldisplacement(yparticledampedtowhichnode(i))=ydampingnodaldisplacement(yparticledampedtowhichnode(i))+(x_sp(yparticledamped(i),2)-x_spo(yparticledamped(i),2));
			ydampingnodalvelocity(yparticledampedtowhichnode(i))=ydampingnodalvelocity(yparticledampedtowhichnode(i))+v_ssp(yparticledamped(i),2);
		end
		ynodalreactionforce=zeros(size(niforce_si));
		ydampedBCstiffness=le(1)*t0_plane*E/le(2);
		thalflife=0.5;
		k=log(2)/thalflife;
		dampingratio=0.1;
		ydampedBCdamping=k*psp1*le(1)*le(2)*t0_plane;
		ydampedBCdamping=dampingratio*2*sqrt(ydampedBCstiffness*psp1*le(1)*le(2)*t0_plane);
		for i=1:length(ydampingnodaldisplacement)
			ynodalreactionforce(ynodedamped(i),2)=-ydampedBCstiffness*ydampingnodaldisplacement(i)-ydampedBCdamping*ydampingnodalvelocity(i);
		end
		
		nforce_si      = niforce_si + neforce_si + traction_si + pforce_si + ynodalreactionforce - k*nmomentum_si; %BC damping
	elseif CasetoRun==66 || CasetoRun==69 || CasetoRun==68 || CasetoRun==71 || CasetoRun==72
		nforce_si      = niforce_si + neforce_si + traction_si + pforce_si + - 0.1*nmomentum_si; %legit damping
	elseif CasetoRun==73 || CasetoRun==74 || CasetoRun==78 || CasetoRun==81 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==83 || CasetoRun==84 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==120 || CasetoRun==117 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110 || CasetoRun==96 || CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89 || CasetoRun==85
		nforce_si      = niforce_si + neforce_si + traction_si + pforce_si; %no damping
	elseif CasetoRun==123 || CasetoRun==151 || CasetoRun==125 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130
		fprintf('%s',['marker #631' char(10)]);
		t_halflife=0.01;
		k=log(2)/t_halflife;
		nforce_si      = niforce_si + neforce_si + traction_si + pforce_si - k*nmomentum_si; %with damping
		fprintf('%s',['marker #632' char(10)]);
	elseif CasetoRun==171
		fprintf('%s',['marker #631' char(10)]);
		t_halflife=0.001;
		k=log(2)/t_halflife;
		nforce_si      = niforce_si + neforce_si + traction_si + pforce_si - k*nmomentum_si; %with damping
		fprintf('%s',['marker #632' char(10)]);
	elseif CasetoRun==165
		fprintf('%s',['marker #631' char(10)]);
		t_halflife=0.0001;
		k=log(2)/t_halflife;
		nforce_si      = niforce_si + neforce_si + traction_si + pforce_si - k*nmomentum_si; %with damping
		fprintf('%s',['marker #632' char(10)]);
	elseif CasetoRun==182
		fprintf('%s',['marker #631' char(10)]);
		t_halflife=0.01;
		k=log(2)/t_halflife;
		nforce_si      = niforce_si + neforce_si + traction_si + pforce_si - k*nmomentum_si; %with damping
		fprintf('%s',['marker #632' char(10)]);	
	elseif CasetoRun==183
		fprintf('%s',['marker #631' char(10)]);
		t_halflife=0.01;
		k=log(2)/t_halflife;
		k=0;
		nforce_si      = niforce_si + neforce_si + traction_si + pforce_si - k*nmomentum_si; %with damping
		
		
		eadcb.disp.tgt=zeros(1,1);
		eadcb.disp.actual=zeros(1,1);
		eadcb.vel.tgt=zeros(1,1);
		eadcb.vel.actual=zeros(1,1);
		eadcb.stiffness.ideal=zeros(1,1);
		eadcb.stiffness.actual=zeros(1,1);
		eadcb.dampingratio=zeros(1,1);
		eadcb.sprungmass.ideal=zeros(1,1);
		eadcb.sprungmass.actual=zeros(1,1);
		eadcb.dampingcoeff=zeros(1,1);
		eadcb.returnforce=zeros(1,1);
        eadcb.springforce=zeros(1,1);
        eadcb.dampingforce=zeros(1,1);
		eadcb.dim=zeros(1,1);
		eadcb.N=zeros(1,1);
		eadcb.m_si=zeros(1,1);
		eadcb.mv_si=zeros(1,1); %momentum
		eadcb.v_si=zeros(1,1);
		eadcb.mu_si=zeros(1,1);
		eadcb.u_si=zeros(1,1);
		
		eadcb.sprungmass.ideal=p_sp(1)*le(1)*le(2)*t0_plane/2;
		eadcb.dampingratio=0.5;
		eadcb.stiffness.ideal=E*t0_plane;
		%eadcb.dampingcoeff=eadcb.dampingratio*eadcb.sprungmass.ideal/dt;
		
		
		eadcb.dim=1;
		for iro=1:PredVelVect.nX
			io=PredVelVect.XNodes(iro);
			eadcb.m_si=0;
			eadcb.mu_si=0;
			eadcb.mv_si=0;
			for irp=1:N0.CONNECTpn.nrparticles(io)
				ip=N0.CONNECTpn.values(io,irp);
				eadcb.N=N0.Npn.values(io,irp);
				eadcb.m_si=eadcb.m_si+eadcb.N*m_sp(ip);
			end
			ip=N0.CONNECTpn.values(io,1);
			eadcb.N=N0.Npn.values(io,1);
			for irp=2:N0.CONNECTpn.nrparticles(io)
				if N0.Npn.values(io,irp)>eadcb.N
					ip=N0.CONNECTpn.values(io,irp);
					eadcb.N=N0.Npn.values(io,irp);
				end
			end
			if eadcb.m_si>0
				eadcb.u_si=x_sp(ip,eadcb.dim)-x_spo(ip,eadcb.dim);
				eadcb.v_si=v_ssp(ip,eadcb.dim);
				eadcb.sprungmass.actual=eadcb.m_si; %1st layer only
				eadcb.stiffness.actual=eadcb.stiffness.ideal*eadcb.sprungmass.actual/eadcb.sprungmass.ideal;
				eadcb.dampingcoeff=eadcb.dampingratio*2*sqrt(eadcb.stiffness.actual*eadcb.sprungmass.actual);
				eadcb.disp.tgt=PredVelVect.XDisp(iro);
				eadcb.vel.tgt=PredVelVect.XVel(iro);
				eadcb.disp.actual=eadcb.u_si; %1st layer only
				eadcb.vel.actual=eadcb.v_si; %1st layer only
				eadcb.springforce=-eadcb.stiffness.actual*(eadcb.disp.actual-eadcb.disp.tgt);
				eadcb.dampingforce=-eadcb.dampingcoeff*(eadcb.vel.actual-eadcb.vel.tgt);
				eadcb.returnforce=0*eadcb.springforce+eadcb.dampingforce;
				nforce_si(io,eadcb.dim,1)=eadcb.returnforce; %1st layer only
			end
            if u_si(io,eadcb.dim,1)~=0 && iro==9
                1;
            end
		end


		eadcb.dim=2;
		for iro=1:PredVelVect.nY
			io=PredVelVect.YNodes(iro);
			eadcb.m_si=0;
			eadcb.mu_si=0;
			eadcb.mv_si=0;
			for irp=1:N0.CONNECTpn.nrparticles(io)
				ip=N0.CONNECTpn.values(io,irp);
				eadcb.N=N0.Npn.values(io,irp);
				eadcb.m_si=eadcb.m_si+eadcb.N*m_sp(ip);
			end
			ip=N0.CONNECTpn.values(io,1);
			eadcb.N=N0.Npn.values(io,1);
			for irp=2:N0.CONNECTpn.nrparticles(io)
				if N0.Npn.values(io,irp)>eadcb.N
					ip=N0.CONNECTpn.values(io,irp);
					eadcb.N=N0.Npn.values(io,irp);
				end
			end
			if eadcb.m_si>0
				eadcb.u_si=x_sp(ip,eadcb.dim)-x_spo(ip,eadcb.dim);
				eadcb.v_si=v_ssp(ip,eadcb.dim);
				eadcb.sprungmass.actual=eadcb.m_si; %1st layer only
				eadcb.stiffness.actual=eadcb.stiffness.ideal*eadcb.sprungmass.actual/eadcb.sprungmass.ideal;
				eadcb.dampingcoeff=eadcb.dampingratio*2*sqrt(eadcb.stiffness.actual*eadcb.sprungmass.actual);
				eadcb.dampingcoeff=eadcb.dampingratio*eadcb.sprungmass.ideal/dt;
				eadcb.disp.tgt=PredVelVect.YDisp(iro);
				eadcb.vel.tgt=PredVelVect.YVel(iro);
				eadcb.disp.actual=eadcb.u_si; %1st layer only
				eadcb.vel.actual=eadcb.v_si; %1st layer only
				eadcb.springforce=-eadcb.stiffness.actual*(eadcb.disp.actual-eadcb.disp.tgt);
				eadcb.dampingforce=-eadcb.dampingcoeff*(eadcb.vel.actual-eadcb.vel.tgt);
				eadcb.returnforce=0*eadcb.springforce+eadcb.dampingforce;
				nforce_si(io,eadcb.dim,1)=eadcb.returnforce; %1st layer only
			end
            if u_si(io,eadcb.dim,1)~=0 && iro==9
                1;
            end
		end
		
		fprintf('%s',['marker #632' char(10)]);
	elseif CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189
		fprintf('%s',['marker #631' char(10)]);
		t_halflife=0.01;
		k=log(2)/t_halflife;
		k=0;
		nforce_si=niforce_si+neforce_si+traction_si+pforce_si-k*nmomentum_si+ncforce_si; %with damping
		fprintf('%s',['marker #632' char(10)]);
	elseif CasetoRun==163 || CasetoRun==170 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166
		fprintf('%s',['marker #631' char(10)]);
		t_halflife=0.01;
		k=log(2)/t_halflife;
		nforce_si      = niforce_si + neforce_si + traction_si + pforce_si - k*nmomentum_si; %with damping
		fprintf('%s',['marker #632' char(10)]);
	elseif CasetoRun==124
		fprintf('%s',['marker #631' char(10)]);
		t_halflife=0.01/2;
		k=log(2)/t_halflife;
		nforce_si      = niforce_si + neforce_si + traction_si + pforce_si - k*nmomentum_si; %with damping
		fprintf('%s',['marker #632' char(10)]);
	elseif CasetoRun==152
		fprintf('%s',['marker #631' char(10)]);
		t_halflife=0.0001;
		k=log(2)/t_halflife;
		nforce_si      = niforce_si + neforce_si + traction_si + pforce_si - k*nmomentum_si; %with damping
		fprintf('%s',['marker #632' char(10)]);
	elseif CasetoRun==150
		%pforce_si experiment
		x_center=7*le_base;
		y_center=7*le_base;
		k_spring=E*t0_plane;
		for ifield=1:fieldnumber
			for ino=1:niCount
				if uncrackable_si(ino,ifield)>0
					deltax0_si=[x0_si(ino,1,ifield)-x_center x0_si(ino,2,ifield)-y_center];
					r0_si=sqrt(dot(deltax0_si,deltax0_si));
					deltax_si=[x_si(ino,1,ifield)-x_center x_si(ino,2,ifield)-y_center];
					r_si=sqrt(dot(deltax_si,deltax_si));
					theta_si=reliableatan(deltax_si(1),deltax_si(2));
					deltaractual_si(ino,ifield)=r_si-r0_si;
					radialforce_si=-k_spring*(deltaractual_si(ino,ifield)-deltarideal_si(ino,ifield))
					force_si_loading(ino,:,ifield)=radialforce_si*[cos(theta_si) sin(theta_si)]*uncrackable_si(ino,ifield);
				end
			end
		end
		fprintf('%s',['marker #631' char(10)]);
		t_halflife=0.001;
		k=log(2)/t_halflife;
		nforce_si      = niforce_si + neforce_si + traction_si + pforce_si + force_si_loading - k*nmomentum_si; %with damping
		fprintf('%s',['marker #632' char(10)]);
	elseif CasetoRun==155
		%phase pump loading
		x_center=7*le_base;
		y_center=7*le_base;
		%nPredVel=8
		%PredVelVect.nX=2;
		%PredVelVect.nY=2;
		%{
		for io=1:niCount
			if CloseEnough(LOC(io,1),10*le_base,1e-3,1) && CloseEnough(LOC(io,2),7*le_base,1e-3,1)
				PredVelVect.XNodes(1)=io;
			elseif CloseEnough(LOC(io,1),7*le_base,1e-3,1) && CloseEnough(LOC(io,2),10*le_base,1e-3,1)
				PredVelVect.YNodes(1)=io;
			elseif CloseEnough(LOC(io,1),4*le_base,1e-3,1) && CloseEnough(LOC(io,2),7*le_base,1e-3,1)
				PredVelVect.XNodes(2)=io;
			elseif CloseEnough(LOC(io,1),7*le_base,1e-3,1) && CloseEnough(LOC(io,2),4*le_base,1e-3,1)
				PredVelVect.YNodes(2)=io;
			end
		end
		%}
		%{
		for io=1:niCount
			if CloseEnough(LOC(io,1),10*le_base,1e-3,1) && CloseEnough(LOC(io,2),7*le_base,1e-3,1)
				PredVelVect.XNodes(1)=io;
				PredVelVect.YNodes(1)=io;
			elseif CloseEnough(LOC(io,1),9*le_base,1e-3,1) && CloseEnough(LOC(io,2),9*le_base,1e-3,1)
				PredVelVect.XNodes(2)=io;
				PredVelVect.YNodes(2)=io;
			elseif CloseEnough(LOC(io,1),7*le_base,1e-3,1) && CloseEnough(LOC(io,2),10*le_base,1e-3,1)
				PredVelVect.XNodes(3)=io;
				PredVelVect.YNodes(3)=io;
			elseif CloseEnough(LOC(io,1),5*le_base,1e-3,1) && CloseEnough(LOC(io,2),9*le_base,1e-3,1)
				PredVelVect.XNodes(4)=io;
				PredVelVect.YNodes(4)=io;
			elseif CloseEnough(LOC(io,1),4*le_base,1e-3,1) && CloseEnough(LOC(io,2),7*le_base,1e-3,1)
				PredVelVect.XNodes(5)=io;
				PredVelVect.YNodes(5)=io;
			elseif CloseEnough(LOC(io,1),5*le_base,1e-3,1) && CloseEnough(LOC(io,2),5*le_base,1e-3,1)
				PredVelVect.XNodes(6)=io;
				PredVelVect.YNodes(6)=io;
			elseif CloseEnough(LOC(io,1),7*le_base,1e-3,1) && CloseEnough(LOC(io,2),4*le_base,1e-3,1)
				PredVelVect.XNodes(7)=io;
				PredVelVect.YNodes(7)=io;
			elseif CloseEnough(LOC(io,1),9*le_base,1e-3,1) && CloseEnough(LOC(io,2),5*le_base,1e-3,1)
				PredVelVect.XNodes(8)=io;
				PredVelVect.YNodes(8)=io;
			end
		end
		%}
		
		for iX=1:PredVelVect.nX
			io=PredVelVect.XNodes(iX);
			deltax_si=[LOC(io,1)-x_center LOC(io,2)-y_center];
			theta_si=reliableatan(deltax_si(1),deltax_si(2));
			PredVelVect.XPhase(iX)=1;
			PredVelVect.XVel(iX)=PredXVel*cos(theta_si); %PredXVel is just piggybacked to pass on PredVel magnitude
			PredVelVect.XAcc(iX)=PredXAcc*cos(theta_si); %PredXAcc is just piggybacked to pass on PredAcc magnitude
		end

		for iY=1:PredVelVect.nY
			io=PredVelVect.YNodes(iY);
			deltax_si=[LOC(io,1)-x_center LOC(io,2)-y_center];
			theta_si=reliableatan(deltax_si(1),deltax_si(2));
			PredVelVect.YPhase(iY)=1;
			PredVelVect.YVel(iY)=PredXVel*cos(theta_si); %PredXVel is just piggybacked to pass on PredVel magnitude
			PredVelVect.YAcc(iY)=PredXAcc*cos(theta_si); %PredXAcc is just piggybacked to pass on PredAcc magnitude
		end
		
		%{
		iPredVel=0;
		for iPredVel=1:nPredVel
			io=PredVelVect.XNodes(iPredVel);
			deltax_si=[LOC(io,1)-x_center LOC(io,2)-y_center];
			theta_si=reliableatan(deltax_si(1),deltax_si(2));
			PredVelVect.XPhase(iPredVel)=1;
			PredVelVect.YPhase(iPredVel)=1;
			PredVelVect.XVel(iPredVel)=PredXVel*cos(theta_si); %PredXVel is just piggybacked to pass on PredVel magnitude
			PredVelVect.YVel(iPredVel)=PredXVel*sin(theta_si);
			PredVelVect.XAcc(iPredVel)=PredXAcc*cos(theta_si); %PredXAcc is just piggybacked to pass on PredAcc magnitude
			PredVelVect.YAcc(iPredVel)=PredXAcc*sin(theta_si);
		end
		%}
		%{
		k_spring=E*t0_plane;
		
		nPredVel=0;
		for ino=1:niCount
			if uncrackable_si(ino,1)>=1 && sum(nmass_si(ino,:))<=2*m_sp(1)
				nPredVel=nPredVel+1;
			end
		end
		PredVelVect.nX=nPredVel;
		PredVelVect.nY=nPredVel;
		iPredVel=0;
		for ino=1:niCount
			if uncrackable_si(ino,1)>=1 && sum(nmass_si(ino,:))<=2*m_sp(1)
				iPredVel=iPredVel+1;
				deltax_si=[LOC(ino,1)-x_center LOC(ino,2)-y_center];
				theta_si=reliableatan(deltax_si(1),deltax_si(2));
				PredVelVect.XNodes(iPredVel)=ino;
				PredVelVect.YNodes(iPredVel)=ino;
				%PredVelVect.XPhase(iPredVel)=uncrackable_si(ino,1);
				%PredVelVect.YPhase(iPredVel)=uncrackable_si(ino,1);
				PredVelVect.XPhase(iPredVel)=1;
				PredVelVect.YPhase(iPredVel)=1;
				PredVelVect.XVel(iPredVel)=PredXVel*cos(theta_si); %PredXVel is just piggybacked to pass on PredVel magnitude
				PredVelVect.YVel(iPredVel)=PredXVel*sin(theta_si);
				PredVelVect.XAcc(iPredVel)=PredXAcc*cos(theta_si); %PredXAcc is just piggybacked to pass on PredAcc magnitude
				PredVelVect.YAcc(iPredVel)=PredXAcc*sin(theta_si);
			end
		end
		%}
		fprintf('%s',['marker #631' char(10)]);
		t_halflife=0.0001; %works
		k=log(2)/t_halflife;
		nforce_si      = niforce_si + neforce_si + traction_si + pforce_si + force_si_loading - k*nmomentum_si; %with damping
		fprintf('%s',['marker #632' char(10)]);
	elseif CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174
		%phase pump loading
		x_center=7*le_base;
		y_center=7*le_base;
		%nPredVel=8
		%PredVelVect.nX=2;
		%PredVelVect.nY=2;
		%{
		for io=1:niCount
			if CloseEnough(LOC(io,1),10*le_base,1e-3,1) && CloseEnough(LOC(io,2),7*le_base,1e-3,1)
				PredVelVect.XNodes(1)=io;
			elseif CloseEnough(LOC(io,1),7*le_base,1e-3,1) && CloseEnough(LOC(io,2),10*le_base,1e-3,1)
				PredVelVect.YNodes(1)=io;
			elseif CloseEnough(LOC(io,1),4*le_base,1e-3,1) && CloseEnough(LOC(io,2),7*le_base,1e-3,1)
				PredVelVect.XNodes(2)=io;
			elseif CloseEnough(LOC(io,1),7*le_base,1e-3,1) && CloseEnough(LOC(io,2),4*le_base,1e-3,1)
				PredVelVect.YNodes(2)=io;
			end
		end
		%}
		%{
		for io=1:niCount
			if CloseEnough(LOC(io,1),10*le_base,1e-3,1) && CloseEnough(LOC(io,2),7*le_base,1e-3,1)
				PredVelVect.XNodes(1)=io;
				PredVelVect.YNodes(1)=io;
			elseif CloseEnough(LOC(io,1),9*le_base,1e-3,1) && CloseEnough(LOC(io,2),9*le_base,1e-3,1)
				PredVelVect.XNodes(2)=io;
				PredVelVect.YNodes(2)=io;
			elseif CloseEnough(LOC(io,1),7*le_base,1e-3,1) && CloseEnough(LOC(io,2),10*le_base,1e-3,1)
				PredVelVect.XNodes(3)=io;
				PredVelVect.YNodes(3)=io;
			elseif CloseEnough(LOC(io,1),5*le_base,1e-3,1) && CloseEnough(LOC(io,2),9*le_base,1e-3,1)
				PredVelVect.XNodes(4)=io;
				PredVelVect.YNodes(4)=io;
			elseif CloseEnough(LOC(io,1),4*le_base,1e-3,1) && CloseEnough(LOC(io,2),7*le_base,1e-3,1)
				PredVelVect.XNodes(5)=io;
				PredVelVect.YNodes(5)=io;
			elseif CloseEnough(LOC(io,1),5*le_base,1e-3,1) && CloseEnough(LOC(io,2),5*le_base,1e-3,1)
				PredVelVect.XNodes(6)=io;
				PredVelVect.YNodes(6)=io;
			elseif CloseEnough(LOC(io,1),7*le_base,1e-3,1) && CloseEnough(LOC(io,2),4*le_base,1e-3,1)
				PredVelVect.XNodes(7)=io;
				PredVelVect.YNodes(7)=io;
			elseif CloseEnough(LOC(io,1),9*le_base,1e-3,1) && CloseEnough(LOC(io,2),5*le_base,1e-3,1)
				PredVelVect.XNodes(8)=io;
				PredVelVect.YNodes(8)=io;
			end
		end
		%}
		
		for iX=1:PredVelVect.nX
			io=PredVelVect.XNodes(iX);
			deltax_si=[LOC(io,1)-x_center LOC(io,2)-y_center];
			theta_si=reliableatan(deltax_si(1),deltax_si(2));
			PredVelVect.XPhase(iX)=1;
			PredVelVect.XVel(iX)=PredXVel*cos(theta_si); %PredXVel is just piggybacked to pass on PredVel magnitude
			PredVelVect.XAcc(iX)=PredXAcc*cos(theta_si); %PredXAcc is just piggybacked to pass on PredAcc magnitude
		end

		for iY=1:PredVelVect.nY
			io=PredVelVect.YNodes(iY);
			deltax_si=[LOC(io,1)-x_center LOC(io,2)-y_center];
			theta_si=reliableatan(deltax_si(1),deltax_si(2));
			PredVelVect.YPhase(iY)=1;
			PredVelVect.YVel(iY)=PredXVel*cos(theta_si); %PredXVel is just piggybacked to pass on PredVel magnitude
			PredVelVect.YAcc(iY)=PredXAcc*cos(theta_si); %PredXAcc is just piggybacked to pass on PredAcc magnitude
		end
		
		%{
		iPredVel=0;
		for iPredVel=1:nPredVel
			io=PredVelVect.XNodes(iPredVel);
			deltax_si=[LOC(io,1)-x_center LOC(io,2)-y_center];
			theta_si=reliableatan(deltax_si(1),deltax_si(2));
			PredVelVect.XPhase(iPredVel)=1;
			PredVelVect.YPhase(iPredVel)=1;
			PredVelVect.XVel(iPredVel)=PredXVel*cos(theta_si); %PredXVel is just piggybacked to pass on PredVel magnitude
			PredVelVect.YVel(iPredVel)=PredXVel*sin(theta_si);
			PredVelVect.XAcc(iPredVel)=PredXAcc*cos(theta_si); %PredXAcc is just piggybacked to pass on PredAcc magnitude
			PredVelVect.YAcc(iPredVel)=PredXAcc*sin(theta_si);
		end
		%}
		%{
		k_spring=E*t0_plane;
		
		nPredVel=0;
		for ino=1:niCount
			if uncrackable_si(ino,1)>=1 && sum(nmass_si(ino,:))<=2*m_sp(1)
				nPredVel=nPredVel+1;
			end
		end
		PredVelVect.nX=nPredVel;
		PredVelVect.nY=nPredVel;
		iPredVel=0;
		for ino=1:niCount
			if uncrackable_si(ino,1)>=1 && sum(nmass_si(ino,:))<=2*m_sp(1)
				iPredVel=iPredVel+1;
				deltax_si=[LOC(ino,1)-x_center LOC(ino,2)-y_center];
				theta_si=reliableatan(deltax_si(1),deltax_si(2));
				PredVelVect.XNodes(iPredVel)=ino;
				PredVelVect.YNodes(iPredVel)=ino;
				%PredVelVect.XPhase(iPredVel)=uncrackable_si(ino,1);
				%PredVelVect.YPhase(iPredVel)=uncrackable_si(ino,1);
				PredVelVect.XPhase(iPredVel)=1;
				PredVelVect.YPhase(iPredVel)=1;
				PredVelVect.XVel(iPredVel)=PredXVel*cos(theta_si); %PredXVel is just piggybacked to pass on PredVel magnitude
				PredVelVect.YVel(iPredVel)=PredXVel*sin(theta_si);
				PredVelVect.XAcc(iPredVel)=PredXAcc*cos(theta_si); %PredXAcc is just piggybacked to pass on PredAcc magnitude
				PredVelVect.YAcc(iPredVel)=PredXAcc*sin(theta_si);
			end
		end
		%}
		fprintf('%s',['marker #631' char(10)]);
		%t_halflife test
		%t_halflife=0.0001; %works
		t_halflife=100;
		k=log(2)/t_halflife;
		k=0;
		nforce_si      = niforce_si + neforce_si + traction_si + pforce_si + force_si_loading - k*nmomentum_si; %with damping
		fprintf('%s',['marker #632' char(10)]);
	elseif CasetoRun==158
		%phase pump loading
		x_center=7*le_base;
		y_center=7*le_base;
		%nPredVel=8
		%PredVelVect.nX=2;
		%PredVelVect.nY=2;
		%{
		for io=1:niCount
			if CloseEnough(LOC(io,1),10*le_base,1e-3,1) && CloseEnough(LOC(io,2),7*le_base,1e-3,1)
				PredVelVect.XNodes(1)=io;
			elseif CloseEnough(LOC(io,1),7*le_base,1e-3,1) && CloseEnough(LOC(io,2),10*le_base,1e-3,1)
				PredVelVect.YNodes(1)=io;
			elseif CloseEnough(LOC(io,1),4*le_base,1e-3,1) && CloseEnough(LOC(io,2),7*le_base,1e-3,1)
				PredVelVect.XNodes(2)=io;
			elseif CloseEnough(LOC(io,1),7*le_base,1e-3,1) && CloseEnough(LOC(io,2),4*le_base,1e-3,1)
				PredVelVect.YNodes(2)=io;
			end
		end
		%}
		%{
		for io=1:niCount
			if CloseEnough(LOC(io,1),10*le_base,1e-3,1) && CloseEnough(LOC(io,2),7*le_base,1e-3,1)
				PredVelVect.XNodes(1)=io;
				PredVelVect.YNodes(1)=io;
			elseif CloseEnough(LOC(io,1),9*le_base,1e-3,1) && CloseEnough(LOC(io,2),9*le_base,1e-3,1)
				PredVelVect.XNodes(2)=io;
				PredVelVect.YNodes(2)=io;
			elseif CloseEnough(LOC(io,1),7*le_base,1e-3,1) && CloseEnough(LOC(io,2),10*le_base,1e-3,1)
				PredVelVect.XNodes(3)=io;
				PredVelVect.YNodes(3)=io;
			elseif CloseEnough(LOC(io,1),5*le_base,1e-3,1) && CloseEnough(LOC(io,2),9*le_base,1e-3,1)
				PredVelVect.XNodes(4)=io;
				PredVelVect.YNodes(4)=io;
			elseif CloseEnough(LOC(io,1),4*le_base,1e-3,1) && CloseEnough(LOC(io,2),7*le_base,1e-3,1)
				PredVelVect.XNodes(5)=io;
				PredVelVect.YNodes(5)=io;
			elseif CloseEnough(LOC(io,1),5*le_base,1e-3,1) && CloseEnough(LOC(io,2),5*le_base,1e-3,1)
				PredVelVect.XNodes(6)=io;
				PredVelVect.YNodes(6)=io;
			elseif CloseEnough(LOC(io,1),7*le_base,1e-3,1) && CloseEnough(LOC(io,2),4*le_base,1e-3,1)
				PredVelVect.XNodes(7)=io;
				PredVelVect.YNodes(7)=io;
			elseif CloseEnough(LOC(io,1),9*le_base,1e-3,1) && CloseEnough(LOC(io,2),5*le_base,1e-3,1)
				PredVelVect.XNodes(8)=io;
				PredVelVect.YNodes(8)=io;
			end
		end
		%}
		
		for iX=1:PredVelVect.nX
			io=PredVelVect.XNodes(iX);
			deltax_si=[LOC(io,1)-x_center LOC(io,2)-y_center];
			theta_si=reliableatan(deltax_si(1),deltax_si(2));
			PredVelVect.XPhase(iX)=1;
			PredVelVect.XVel(iX)=PredXVel*cos(theta_si); %PredXVel is just piggybacked to pass on PredVel magnitude
			PredVelVect.XAcc(iX)=PredXAcc*cos(theta_si); %PredXAcc is just piggybacked to pass on PredAcc magnitude
		end

		for iY=1:PredVelVect.nY
			io=PredVelVect.YNodes(iY);
			deltax_si=[LOC(io,1)-x_center LOC(io,2)-y_center];
			theta_si=reliableatan(deltax_si(1),deltax_si(2));
			PredVelVect.YPhase(iY)=1;
			PredVelVect.YVel(iY)=PredXVel*cos(theta_si); %PredXVel is just piggybacked to pass on PredVel magnitude
			PredVelVect.YAcc(iY)=PredXAcc*cos(theta_si); %PredXAcc is just piggybacked to pass on PredAcc magnitude
		end
		
		%{
		iPredVel=0;
		for iPredVel=1:nPredVel
			io=PredVelVect.XNodes(iPredVel);
			deltax_si=[LOC(io,1)-x_center LOC(io,2)-y_center];
			theta_si=reliableatan(deltax_si(1),deltax_si(2));
			PredVelVect.XPhase(iPredVel)=1;
			PredVelVect.YPhase(iPredVel)=1;
			PredVelVect.XVel(iPredVel)=PredXVel*cos(theta_si); %PredXVel is just piggybacked to pass on PredVel magnitude
			PredVelVect.YVel(iPredVel)=PredXVel*sin(theta_si);
			PredVelVect.XAcc(iPredVel)=PredXAcc*cos(theta_si); %PredXAcc is just piggybacked to pass on PredAcc magnitude
			PredVelVect.YAcc(iPredVel)=PredXAcc*sin(theta_si);
		end
		%}
		%{
		k_spring=E*t0_plane;
		
		nPredVel=0;
		for ino=1:niCount
			if uncrackable_si(ino,1)>=1 && sum(nmass_si(ino,:))<=2*m_sp(1)
				nPredVel=nPredVel+1;
			end
		end
		PredVelVect.nX=nPredVel;
		PredVelVect.nY=nPredVel;
		iPredVel=0;
		for ino=1:niCount
			if uncrackable_si(ino,1)>=1 && sum(nmass_si(ino,:))<=2*m_sp(1)
				iPredVel=iPredVel+1;
				deltax_si=[LOC(ino,1)-x_center LOC(ino,2)-y_center];
				theta_si=reliableatan(deltax_si(1),deltax_si(2));
				PredVelVect.XNodes(iPredVel)=ino;
				PredVelVect.YNodes(iPredVel)=ino;
				%PredVelVect.XPhase(iPredVel)=uncrackable_si(ino,1);
				%PredVelVect.YPhase(iPredVel)=uncrackable_si(ino,1);
				PredVelVect.XPhase(iPredVel)=1;
				PredVelVect.YPhase(iPredVel)=1;
				PredVelVect.XVel(iPredVel)=PredXVel*cos(theta_si); %PredXVel is just piggybacked to pass on PredVel magnitude
				PredVelVect.YVel(iPredVel)=PredXVel*sin(theta_si);
				PredVelVect.XAcc(iPredVel)=PredXAcc*cos(theta_si); %PredXAcc is just piggybacked to pass on PredAcc magnitude
				PredVelVect.YAcc(iPredVel)=PredXAcc*sin(theta_si);
			end
		end
		%}
		fprintf('%s',['marker #631' char(10)]);
		t_halflife=0.0001; %works
		k=log(2)/t_halflife;
		k=0; %overridden, no damping
		nforce_si      = niforce_si + neforce_si + traction_si + pforce_si + force_si_loading - k*nmomentum_si; %with damping
		fprintf('%s',['marker #632' char(10)]);
	elseif CasetoRun==156 || CasetoRun==159
		%phase pump loading
		x_center=7*le_base;
		y_center=7*le_base;
		%nPredVel=8
		%PredVelVect.nX=2;
		%PredVelVect.nY=2;
		%{
		for io=1:niCount
			if CloseEnough(LOC(io,1),10*le_base,1e-3,1) && CloseEnough(LOC(io,2),7*le_base,1e-3,1)
				PredVelVect.XNodes(1)=io;
			elseif CloseEnough(LOC(io,1),7*le_base,1e-3,1) && CloseEnough(LOC(io,2),10*le_base,1e-3,1)
				PredVelVect.YNodes(1)=io;
			elseif CloseEnough(LOC(io,1),4*le_base,1e-3,1) && CloseEnough(LOC(io,2),7*le_base,1e-3,1)
				PredVelVect.XNodes(2)=io;
			elseif CloseEnough(LOC(io,1),7*le_base,1e-3,1) && CloseEnough(LOC(io,2),4*le_base,1e-3,1)
				PredVelVect.YNodes(2)=io;
			end
		end
		%}
		%{
		for io=1:niCount
			if CloseEnough(LOC(io,1),10*le_base,1e-3,1) && CloseEnough(LOC(io,2),7*le_base,1e-3,1)
				PredVelVect.XNodes(1)=io;
				PredVelVect.YNodes(1)=io;
			elseif CloseEnough(LOC(io,1),9*le_base,1e-3,1) && CloseEnough(LOC(io,2),9*le_base,1e-3,1)
				PredVelVect.XNodes(2)=io;
				PredVelVect.YNodes(2)=io;
			elseif CloseEnough(LOC(io,1),7*le_base,1e-3,1) && CloseEnough(LOC(io,2),10*le_base,1e-3,1)
				PredVelVect.XNodes(3)=io;
				PredVelVect.YNodes(3)=io;
			elseif CloseEnough(LOC(io,1),5*le_base,1e-3,1) && CloseEnough(LOC(io,2),9*le_base,1e-3,1)
				PredVelVect.XNodes(4)=io;
				PredVelVect.YNodes(4)=io;
			elseif CloseEnough(LOC(io,1),4*le_base,1e-3,1) && CloseEnough(LOC(io,2),7*le_base,1e-3,1)
				PredVelVect.XNodes(5)=io;
				PredVelVect.YNodes(5)=io;
			elseif CloseEnough(LOC(io,1),5*le_base,1e-3,1) && CloseEnough(LOC(io,2),5*le_base,1e-3,1)
				PredVelVect.XNodes(6)=io;
				PredVelVect.YNodes(6)=io;
			elseif CloseEnough(LOC(io,1),7*le_base,1e-3,1) && CloseEnough(LOC(io,2),4*le_base,1e-3,1)
				PredVelVect.XNodes(7)=io;
				PredVelVect.YNodes(7)=io;
			elseif CloseEnough(LOC(io,1),9*le_base,1e-3,1) && CloseEnough(LOC(io,2),5*le_base,1e-3,1)
				PredVelVect.XNodes(8)=io;
				PredVelVect.YNodes(8)=io;
			end
		end
		%}
		%{
		for iX=1:PredVelVect.nX
			io=PredVelVect.XNodes(iX);
			deltax_si=[LOC(io,1)-x_center LOC(io,2)-y_center];
			theta_si=reliableatan(deltax_si(1),deltax_si(2));
			PredVelVect.XPhase(iX)=1;
			PredVelVect.XVel(iX)=PredXVel*cos(theta_si); %PredXVel is just piggybacked to pass on PredVel magnitude
			PredVelVect.XAcc(iX)=PredXAcc*cos(theta_si); %PredXAcc is just piggybacked to pass on PredAcc magnitude
		end

		for iY=1:PredVelVect.nY
			io=PredVelVect.YNodes(iY);
			deltax_si=[LOC(io,1)-x_center LOC(io,2)-y_center];
			theta_si=reliableatan(deltax_si(1),deltax_si(2));
			PredVelVect.YPhase(iY)=1;
			PredVelVect.YVel(iY)=PredXVel*cos(theta_si); %PredXVel is just piggybacked to pass on PredVel magnitude
			PredVelVect.YAcc(iY)=PredXAcc*cos(theta_si); %PredXAcc is just piggybacked to pass on PredAcc magnitude
		end
		%}
		%{
		iPredVel=0;
		for iPredVel=1:nPredVel
			io=PredVelVect.XNodes(iPredVel);
			deltax_si=[LOC(io,1)-x_center LOC(io,2)-y_center];
			theta_si=reliableatan(deltax_si(1),deltax_si(2));
			PredVelVect.XPhase(iPredVel)=1;
			PredVelVect.YPhase(iPredVel)=1;
			PredVelVect.XVel(iPredVel)=PredXVel*cos(theta_si); %PredXVel is just piggybacked to pass on PredVel magnitude
			PredVelVect.YVel(iPredVel)=PredXVel*sin(theta_si);
			PredVelVect.XAcc(iPredVel)=PredXAcc*cos(theta_si); %PredXAcc is just piggybacked to pass on PredAcc magnitude
			PredVelVect.YAcc(iPredVel)=PredXAcc*sin(theta_si);
		end
		%}
		
		k_spring=E*t0_plane;
		
		nPredVel=0;
		for ino=1:niCount
			if uncrackable_si(ino,1)>=1 && sum(nmass_si(ino,:))<=2*m_sp(1)
				nPredVel=nPredVel+1;
			end
		end
		PredVelVect.nX=nPredVel;
		PredVelVect.nY=nPredVel;
		iPredVel=0;
		for ino=1:niCount
			if uncrackable_si(ino,1)>=1 && sum(nmass_si(ino,:))<=2*m_sp(1)
				iPredVel=iPredVel+1;
				deltax_si=[LOC(ino,1)-x_center LOC(ino,2)-y_center];
				theta_si=reliableatan(deltax_si(1),deltax_si(2));
				PredVelVect.XNodes(iPredVel)=ino;
				PredVelVect.YNodes(iPredVel)=ino;
				%PredVelVect.XPhase(iPredVel)=uncrackable_si(ino,1);
				%PredVelVect.YPhase(iPredVel)=uncrackable_si(ino,1);
				PredVelVect.XPhase(iPredVel)=1;
				PredVelVect.YPhase(iPredVel)=1;
				PredVelVect.XVel(iPredVel)=PredXVel*cos(theta_si); %PredXVel is just piggybacked to pass on PredVel magnitude
				PredVelVect.YVel(iPredVel)=PredXVel*sin(theta_si);
				PredVelVect.XAcc(iPredVel)=PredXAcc*cos(theta_si); %PredXAcc is just piggybacked to pass on PredAcc magnitude
				PredVelVect.YAcc(iPredVel)=PredXAcc*sin(theta_si);
			end
		end
		
		fprintf('%s',['marker #631' char(10)]);
		t_halflife=0.001; %works
		k=log(2)/t_halflife;
		nforce_si      = niforce_si + neforce_si + traction_si + pforce_si + force_si_loading - k*nmomentum_si; %with damping
		fprintf('%s',['marker #632' char(10)]);
	elseif CasetoRun==153 || CasetoRun==154 || CasetoRun==161
		fprintf('%s',['marker #631' char(10)]);
		t_halflife=0; %bogus inputs to prevent the chance of coder whining
		k=log(2); % bogus inputs to prevent the chance of coder whining
		nforce_si      = niforce_si + neforce_si + traction_si + pforce_si; %with damping
		fprintf('%s',['marker #632' char(10)]);
	elseif CasetoRun==126 || CasetoRun==118 || CasetoRun==173 || CasetoRun==127
		fprintf('%s',['marker #631' char(10)]);
		%t_halflife=0.0002; %25 times the damping
		t_halflife=0.002; %25 times the damping
		k=log(2)/t_halflife;
		nforce_si      = niforce_si + neforce_si + traction_si + pforce_si - k*nmomentum_si; %with damping
		fprintf('%s',['marker #632' char(10)]);
	elseif CasetoRun==121
		nforce_si      = niforce_si + neforce_si + traction_si + pforce_si + ntforce_si; %no damping
	elseif CasetoRun==77
		nforce_si      = niforce_si + neforce_si + traction_si + pforce_si + ncforce_si; %no damping
	elseif CasetoRun==67
		Nmatrixmaxfinder=zeros(length(ynodedamped),size(Nmatrix,2));
		for i=1:length(ynodedamped)
			Nmatrixmaxfinder(i,:)=Nmatrix(ynodedamped(i),:,1)+Nmatrix(ynodedamped(i),:,2)+Nmatrix(ynodedamped(i),:,3);
		end
		yparticledampedtowhichnode=zeros(1,length(yparticledamped));
		ydampingnodaldisplacement=zeros(1,length(ynodedamped));
		ydampingnodalvelocity=zeros(1,length(ynodedamped));
		for i=1:length(yparticledamped)
			yparticledampedtowhichnode(i)=FindMax(Nmatrixmaxfinder(:,yparticledamped(i)));
			ydampingnodaldisplacement(yparticledampedtowhichnode(i))=ydampingnodaldisplacement(yparticledampedtowhichnode(i))+(x_sp(yparticledamped(i),2)-x_spo(yparticledamped(i),2));
			ydampingnodalvelocity(yparticledampedtowhichnode(i))=ydampingnodalvelocity(yparticledampedtowhichnode(i))+v_ssp(yparticledamped(i),2);
		end
		ynodalreactionforce=zeros(size(niforce_si));
		ydampedBCstiffness=le(1)*t0_plane*E/le(2);
		thalflife=0.5;
		k=log(2)/thalflife;
		dampingratio=0.1;
		ydampedBCdamping=k*psp1*le(1)*le(2)*t0_plane;
		ydampedBCdamping=dampingratio*2*sqrt(ydampedBCstiffness*psp1*le(1)*le(2)*t0_plane);
		for i=1:length(ydampingnodaldisplacement)
			ynodalreactionforce(ynodedamped(i),2)=-ydampedBCstiffness*ydampingnodaldisplacement(i)-ydampedBCdamping*ydampingnodalvelocity(i);
		end
		
		nforce_si      = niforce_si + neforce_si + traction_si + pforce_si + ynodalreactionforce - k*nmomentum_si; %BC damping
	elseif CasetoRun==5 || CasetoRun==6
		ymomentumignore_prev=m_sp.*v_ssp(:,2).*ignoremomentum;
		Nmatrixmaxfinder=zeros(length(ynodedamped),size(Nmatrix,2));
		for i=1:length(ynodedamped)
			Nmatrixmaxfinder(i,:)=Nmatrix(ynodedamped(i),:);
		end
		yparticledampedtowhichnode=zeros(1,length(yparticledamped));
		ydampingnodaldisplacement=zeros(1,length(ynodedamped));
		ydampingnodalvelocity=zeros(1,length(ynodedamped));
		for i=1:length(yparticledamped)
			yparticledampedtowhichnode(i)=FindMax(Nmatrixmaxfinder(:,yparticledamped(i)));
			ydampingnodaldisplacement(yparticledampedtowhichnode(i))=ydampingnodaldisplacement(yparticledampedtowhichnode(i))+(x_sp(yparticledamped(i),2)-x_spo(yparticledamped(i),2));
			ydampingnodalvelocity(yparticledampedtowhichnode(i))=ydampingnodalvelocity(yparticledampedtowhichnode(i))+v_ssp(yparticledamped(i),2);
		end
		ynodalreactionforce=zeros(size(niforce_si));
		ydampedBCstiffness=le(1)*t0_plane*El/le(2);
		thalflife=0.5;
		k=log(2)/thalflife;
		dampingratio=0.1;
		ydampedBCdamping=k*psp1*le(1)*le(2)*t0_plane;
		ydampedBCdamping=dampingratio*2*sqrt(ydampedBCstiffness*psp1*le(1)*le(2)*t0_plane);
		for i=1:length(ydampingnodaldisplacement)
			ynodalreactionforce(ynodedamped(i),2)=-ydampedBCstiffness*ydampingnodaldisplacement(i)-ydampedBCdamping*ydampingnodalvelocity(i);
		end
		
		nforce_si      = niforce_si + neforce_si + traction_si + pforce_si + ynodalreactionforce - k*nmomentum_si; %BC damping
	elseif CasetoRun==7
		ymomentumignore_prev=m_sp.*v_ssp(:,2).*ignoremomentum;
		Nmatrixmaxfinder=zeros(length(ynodedamped),size(Nmatrix,2));
		for i=1:length(ynodedamped)
			Nmatrixmaxfinder(i,:)=Nmatrix(ynodedamped(i),:);
		end
		yparticledampedtowhichnode=zeros(1,length(yparticledamped));
		ydampingnodaldisplacement=zeros(1,length(ynodedamped));
		ydampingnodalvelocity=zeros(1,length(ynodedamped));
		for i=1:length(yparticledamped)
			yparticledampedtowhichnode(i)=FindMax(Nmatrixmaxfinder(:,yparticledamped(i)));
			ydampingnodaldisplacement(yparticledampedtowhichnode(i))=ydampingnodaldisplacement(yparticledampedtowhichnode(i))+(x_sp(yparticledamped(i),2)-x_spo(yparticledamped(i),2));
			ydampingnodalvelocity(yparticledampedtowhichnode(i))=ydampingnodalvelocity(yparticledampedtowhichnode(i))+v_ssp(yparticledamped(i),2);
		end
		ynodalreactionforce=zeros(size(niforce_si));
		ydampedBCstiffness=le(1)*t0_plane*El/le(2);
		thalflife=0.5;
		k=log(2)/thalflife;
		dampingratio=0.1;
		ydampedBCdamping=k*psp1*le(1)*le(2)*t0_plane;
		ydampedBCdamping=dampingratio*2*sqrt(ydampedBCstiffness*psp1*le(1)*le(2)*t0_plane);
		for i=1:length(ydampingnodaldisplacement)
			ynodalreactionforce(ynodedamped(i),2)=-ydampedBCstiffness*ydampingnodaldisplacement(i)-ydampedBCdamping*ydampingnodalvelocity(i);
		end
		
		nforce_si      = niforce_si + neforce_si + traction_si + pforce_si + ynodalreactionforce - k*nmomentum_si; %BC damping
		%nforce_si      = niforce_si + neforce_si + traction_si + pforce_si + ynodalreactionforce - 0.1*nmomentum_si; %legit damping
	elseif CasetoRun==8 || CasetoRun==9
		nforce_si      = niforce_si + neforce_si + traction_si + pforce_si - 0.1*nmomentum_si; %legit damping;
	elseif CasetoRun==10
		ymomentumignore_prev=m_sp.*v_ssp(:,2).*ignoremomentum;
		Nmatrixmaxfinder=zeros(length(ynodedamped),size(Nmatrix,2));
		for i=1:length(ynodedamped)
			Nmatrixmaxfinder(i,:)=Nmatrix(ynodedamped(i),:);
		end
		yparticledampedtowhichnode=zeros(1,length(yparticledamped));
		ydampingnodaldisplacement=zeros(1,length(ynodedamped));
		ydampingnodalvelocity=zeros(1,length(ynodedamped));
		for i=1:length(yparticledamped)
			yparticledampedtowhichnode(i)=FindMax(Nmatrixmaxfinder(:,yparticledamped(i)));
			ydampingnodaldisplacement(yparticledampedtowhichnode(i))=ydampingnodaldisplacement(yparticledampedtowhichnode(i))+(x_sp(yparticledamped(i),2)-x_spo(yparticledamped(i),2));
			ydampingnodalvelocity(yparticledampedtowhichnode(i))=ydampingnodalvelocity(yparticledampedtowhichnode(i))+v_ssp(yparticledamped(i),2);
		end
		ynodalreactionforce=zeros(size(niforce_si));
		ydampedBCstiffness=le(1)*t0_plane*El/le(2);
		thalflife=0.5;
		k=log(2)/thalflife;
		dampingratio=0.1;
		ydampedBCdamping=k*psp1*le(1)*le(2)*t0_plane;
		ydampedBCdamping=dampingratio*2*sqrt(ydampedBCstiffness*psp1*le(1)*le(2)*t0_plane);
		for i=1:length(ydampingnodaldisplacement)
			ynodalreactionforce(ynodedamped(i),2)=-ydampedBCstiffness*ydampingnodaldisplacement(i)-ydampedBCdamping*ydampingnodalvelocity(i);
		end
		
		nforce_si      = niforce_si + neforce_si + traction_si + pforce_si + ynodalreactionforce - k*nmomentum_si; %BC damping
	 elseif CasetoRun==11 || CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==15 || CasetoRun==14
		ymomentumignore_prev=m_sp.*v_ssp(:,2).*ignoremomentum;
		Nmatrixmaxfinder=zeros(length(ynodedamped),size(Nmatrix,2));
		for i=1:length(ynodedamped)
			Nmatrixmaxfinder(i,:)=Nmatrix(ynodedamped(i),:);
		end
		yparticledampedtowhichnode=zeros(1,length(yparticledamped));
		ydampingnodaldisplacement=zeros(1,length(ynodedamped));
		ydampingnodalvelocity=zeros(1,length(ynodedamped));
		for i=1:length(yparticledamped)
			yparticledampedtowhichnode(i)=FindMax(Nmatrixmaxfinder(:,yparticledamped(i)));
			ydampingnodaldisplacement(yparticledampedtowhichnode(i))=ydampingnodaldisplacement(yparticledampedtowhichnode(i))+(x_sp(yparticledamped(i),2)-x_spo(yparticledamped(i),2));
			ydampingnodalvelocity(yparticledampedtowhichnode(i))=ydampingnodalvelocity(yparticledampedtowhichnode(i))+v_ssp(yparticledamped(i),2);
		end
		ynodalreactionforce=zeros(size(niforce_si));
		ydampedBCstiffness=le(1)*t0_plane*El/le(2);
		thalflife=0.5;
		k=log(2)/thalflife;
		dampingratio=0.1;
		ydampedBCdamping=k*psp1*le(1)*le(2)*t0_plane;
		ydampedBCdamping=dampingratio*2*sqrt(ydampedBCstiffness*psp1*le(1)*le(2)*t0_plane);
		for i=1:length(ydampingnodaldisplacement)
			ynodalreactionforce(ynodedamped(i),2)=-ydampedBCstiffness*ydampingnodaldisplacement(i)-ydampedBCdamping*ydampingnodalvelocity(i);
		end
		
		nforce_si      = niforce_si + neforce_si + traction_si + pforce_si + ynodalreactionforce - k*nmomentum_si; %BC damping
		%nforce_si      = niforce_si + neforce_si + traction_si + pforce_si + ynodalreactionforce - 0.1*nmomentum_si; %legit damping
	 elseif CasetoRun==12 || CasetoRun==16 || CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44
		ymomentumignore_prev=m_sp.*v_ssp(:,2).*ignoremomentum;
		Nmatrixmaxfinder=zeros(length(ynodedamped),size(Nmatrix,2));
		for i=1:length(ynodedamped)
			Nmatrixmaxfinder(i,:)=Nmatrix(ynodedamped(i),:);
		end
		yparticledampedtowhichnode=zeros(1,length(yparticledamped));
		ydampingnodaldisplacement=zeros(1,length(ynodedamped));
		ydampingnodalvelocity=zeros(1,length(ynodedamped));
		for i=1:length(yparticledamped)
			yparticledampedtowhichnode(i)=FindMax(Nmatrixmaxfinder(:,yparticledamped(i)));
			ydampingnodaldisplacement(yparticledampedtowhichnode(i))=ydampingnodaldisplacement(yparticledampedtowhichnode(i))+(x_sp(yparticledamped(i),2)-x_spo(yparticledamped(i),2));
			ydampingnodalvelocity(yparticledampedtowhichnode(i))=ydampingnodalvelocity(yparticledampedtowhichnode(i))+v_ssp(yparticledamped(i),2);
		end
		ynodalreactionforce=zeros(size(niforce_si));
		ydampedBCstiffness=le(1)*t0_plane*El/le(2);
		thalflife=0.5;
		k=log(2)/thalflife;
		dampingratio=0.1;
		ydampedBCdamping=k*psp1*le(1)*le(2)*t0_plane;
		ydampedBCdamping=dampingratio*2*sqrt(ydampedBCstiffness*psp1*le(1)*le(2)*t0_plane);
		for i=1:length(ydampingnodaldisplacement)
			ynodalreactionforce(ynodedamped(i),2)=-ydampedBCstiffness*ydampingnodaldisplacement(i)-ydampedBCdamping*ydampingnodalvelocity(i);
		end
		
		nforce_si      = niforce_si + neforce_si + traction_si + pforce_si + ynodalreactionforce - k*nmomentum_si; %BC damping
		%nforce_si      = niforce_si + neforce_si + traction_si + pforce_si + ynodalreactionforce - 0.1*nmomentum_si; %legit damping
	end
	
	nmomentum_si   = nmomentum_si + nforce_si*dt;
	
	% Boundary condition
	[nforce_si]     = Boundary_Dirichlet(nfbcx,nfbcy,fbcx,fbcy,nforce_si); % Boundary condition for nodal force
	[nmomentum_si]  = Boundary_Dirichlet(nfbcx,nfbcy,fbcx,fbcy,nmomentum_si); % Boundary condition for nodal force
	
	%predvel experiment
	%nmomentum_si=nmomentum_si*(0.5^(1/1000)); %damping
	if CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==117 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110
		%fieldnumber=max(max(TheFieldSplit));
		fprintf('%s',['marker #633' char(10)]);
		F_rollerX=zeros(1,length(NodeswithPredXVel));
		for i=1:length(NodeswithPredXVel)
			for j=1:1
				nmomentum_si_old=nmomentum_si(NodeswithPredXVel(i),j,:);
				for field=1:1
					nmomentum_si(NodeswithPredXVel(i),j,field)=nmass_si(NodeswithPredXVel(i),field)*PredXVel;
					nforce_si(NodeswithPredXVel(i),j,field)=nmass_si(NodeswithPredXVel(i),field)*PredXAcc;
				end
				F_rollerX(i)=sum((nmomentum_si(NodeswithPredXVel(i),j,:)-nmomentum_si_old(1,1,:)))/dt;
			end
			%F_roller(i,2)=0;
		end
		for i=1:length(NodeswithPredXVel2)
			for j=1:1
				nmomentum_si_old=nmomentum_si(NodeswithPredXVel2(i),j,:);
				for field=1:1
					nmomentum_si(NodeswithPredXVel2(i),j,field)=nmass_si(NodeswithPredXVel2(i),field)*PredXVel2;
					nforce_si(NodeswithPredXVel2(i),j,field)=nmass_si(NodeswithPredXVel2(i),field)*PredXAcc2;
				end
				F_rollerX(i)=sum((nmomentum_si(NodeswithPredXVel2(i),j,:)-nmomentum_si_old(1,1,:)))/dt;
			end
			%F_roller(i,2)=0;
		end
		
		
		F_rollerY=zeros(1,length(NodeswithPredYVel));
		for i=1:length(NodeswithPredYVel)
			for j=2:2
				nmomentum_si_old=nmomentum_si(NodeswithPredYVel(i),j,:);
				for field=1:1
					nmomentum_si(NodeswithPredYVel(i),j,field)=nmass_si(NodeswithPredYVel(i),field)*PredYVel;
					nforce_si(NodeswithPredYVel(i),j,field)=nmass_si(NodeswithPredYVel(i),field)*PredYAcc;
				end
				F_rollerY(i)=sum((nmomentum_si(NodeswithPredYVel(i),j,:)-nmomentum_si_old(1,1,:)))/dt;
			end
			%F_roller(i,2)=0;
		end
		for i=1:length(NodeswithPredYVel2)
			for j=2:2
				nmomentum_si_old=nmomentum_si(NodeswithPredYVel2(i),j,:);
				for field=1:1
					nmomentum_si(NodeswithPredYVel2(i),j,field)=nmass_si(NodeswithPredYVel2(i),field)*PredYVel2;
					nforce_si(NodeswithPredYVel2(i),j,field)=nmass_si(NodeswithPredYVel2(i),field)*PredYAcc2;
				end
			end
			%F_roller(i,2)=0;
		end
		fprintf('%s',['marker #634' char(10)]);
	elseif CasetoRun==183
		%183 PredVel ni Protocol
		%fieldnumber=max(max(TheFieldSplit));
		fprintf('%s',['marker #633' char(10)]);
		
		
		F_rollerX=zeros(1,PredVelVect.nX);


		F_rollerY=zeros(1,PredVelVect.nY);
		fprintf('%s',['marker #634' char(10)]);
	elseif CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==189 || CasetoRun==192
		%186 PredVel ni Protocol
		%additions: One Sided F_roller calculations, total actuator work calculation
		%fieldnumber=max(max(TheFieldSplit));
		energy.work.ddt=0;
		fprintf('%s',['marker #633' char(10)]);
		F_rollerX=zeros(1,PredVelVect.nX);
		for i=1:PredVelVect.nX
			nmomentum_si_old=nmomentum_si(PredVelVect.XNodes(i),1,1);
			nforce_si_old=nforce_si(PredVelVect.XNodes(i),1,1);
			nmomentum_si(PredVelVect.XNodes(i),1,1)=PredVelVect.XPhase(i)*nmass_si(PredVelVect.XNodes(i),1)*PredVelVect.XVel(i)+(1-PredVelVect.XPhase(i))*nmomentum_si_old; %only field #1 is restrained
			nforce_si(PredVelVect.XNodes(i),1,1)=PredVelVect.XPhase(i)*nmass_si(PredVelVect.XNodes(i),1)*PredVelVect.XAcc(i)+(1-PredVelVect.XPhase(i))*nforce_si_old;
			F_rollerX(i)=(nmomentum_si(PredVelVect.XNodes(i),1,1)-nmomentum_si_old)/dt;
			energy.work.ddt=energy.work.ddt+F_rollerX(i)*PredVelVect.XVel(i);
			%F_roller(i,2)=0;
		end

		F_rollerY=zeros(1,PredVelVect.nY);
		for i=1:PredVelVect.nY
			nmomentum_si_old=nmomentum_si(PredVelVect.YNodes(i),2,1);
			nforce_si_old=nforce_si(PredVelVect.YNodes(i),2,1);
			nmomentum_si(PredVelVect.YNodes(i),2,1)=PredVelVect.YPhase(i)*nmass_si(PredVelVect.YNodes(i),1)*PredVelVect.YVel(i)+(1-PredVelVect.YPhase(i))*nmomentum_si_old;
			nforce_si(PredVelVect.YNodes(i),2,1)=PredVelVect.YPhase(i)*nmass_si(PredVelVect.YNodes(i),1)*PredVelVect.YAcc(i)+(1-PredVelVect.YPhase(i))*nforce_si_old;
			F_rollerY(i)=(nmomentum_si(PredVelVect.YNodes(i),2,1)-nmomentum_si_old)/dt;
			energy.work.ddt=energy.work.ddt+F_rollerY(i)*PredVelVect.YVel(i);
			if PredVelVect.YVel(i)<0
				F_rollerY(i)=0;
			end
			%F_roller(i,2)=0;
		end
		energy.work.value=energy.work.value+energy.work.ddt*dt;
		fprintf('%s',['marker #634' char(10)]);
	elseif CasetoRun==124 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==118 || CasetoRun==173
		%124 PredVel ni Protocol
		%fieldnumber=max(max(TheFieldSplit));
		fprintf('%s',['marker #633' char(10)]);
		F_rollerX=zeros(1,PredVelVect.nX);
		for i=1:PredVelVect.nX
			nmomentum_si_old=nmomentum_si(PredVelVect.XNodes(i),1,1);
			nforce_si_old=nforce_si(PredVelVect.XNodes(i),1,1);
			nmomentum_si(PredVelVect.XNodes(i),1,1)=PredVelVect.XPhase(i)*nmass_si(PredVelVect.XNodes(i),1)*PredVelVect.XVel(i)+(1-PredVelVect.XPhase(i))*nmomentum_si_old; %only field #1 is restrained
			nforce_si(PredVelVect.XNodes(i),1,1)=PredVelVect.XPhase(i)*nmass_si(PredVelVect.XNodes(i),1)*PredVelVect.XAcc(i)+(1-PredVelVect.XPhase(i))*nforce_si_old;
			F_rollerX(i)=sum((nmomentum_si(PredVelVect.XNodes(i),1,1)-nmomentum_si_old(1,1)))/dt;
			%F_roller(i,2)=0;
		end

		F_rollerY=zeros(1,PredVelVect.nY);
		for i=1:PredVelVect.nY
			nmomentum_si_old=nmomentum_si(PredVelVect.YNodes(i),2,1);
			nforce_si_old=nforce_si(PredVelVect.YNodes(i),2,1);
			nmomentum_si(PredVelVect.YNodes(i),2,1)=PredVelVect.YPhase(i)*nmass_si(PredVelVect.YNodes(i),1)*PredVelVect.YVel(i)+(1-PredVelVect.YPhase(i))*nmomentum_si_old;
			nforce_si(PredVelVect.YNodes(i),2,1)=PredVelVect.YPhase(i)*nmass_si(PredVelVect.YNodes(i),1)*PredVelVect.YAcc(i)+(1-PredVelVect.YPhase(i))*nforce_si_old;
			F_rollerY(i)=sum((nmomentum_si(PredVelVect.YNodes(i),2)-nmomentum_si_old(1,1)))/dt;
			%F_roller(i,2)=0;
		end
		fprintf('%s',['marker #634' char(10)]);
	else
		fieldnumber=size(Nmatrix,3);
		
		F_rollerX=zeros(1,length(NodeswithPredXVel));
		for i=1:length(NodeswithPredXVel)
			for j=1:1
				nmomentum_si_old=nmomentum_si(NodeswithPredXVel(i),j,:);
				for field=1:fieldnumber
					nmomentum_si(NodeswithPredXVel(i),j,field)=nmass_si(NodeswithPredXVel(i),field)*PredXVel;
					nmomentum_si(NodeswithPredXVel(i),j,field)=nmass_si(NodeswithPredXVel(i),field)*PredXVel;
				end
				F_rollerX(i)=sum((nmomentum_si(NodeswithPredXVel(i),j,:)-nmomentum_si_old(1,1,:)))/dt;
				%nforce_si(NodeswithPredVel(i),j)=0;
			end
			%F_roller(i,2)=0;
		end
		
		for i=1:length(NodeswithPredXVel2)
			for j=1:1
				nmomentum_si_old=nmomentum_si(NodeswithPredXVel2(i),j,:);
				for field=1:fieldnumber
					nmomentum_si(NodeswithPredXVel2(i),j,field)=nmass_si(NodeswithPredXVel2(i),field)*PredXVel2;
				end
				F_rollerX(i)=sum((nmomentum_si(NodeswithPredXVel2(i),j,:)-nmomentum_si_old(1,1,:)))/dt;
				%nforce_si(NodeswithPredVel(i),j)=0;
			end
			%F_roller(i,2)=0;
		end
		
		
		F_rollerY=zeros(1,length(NodeswithPredYVel));
		for i=1:length(NodeswithPredYVel)
			for j=2:2
				nmomentum_si_old=nmomentum_si(NodeswithPredYVel(i),j,:);
				for field=1:fieldnumber
					nmomentum_si(NodeswithPredYVel(i),j,field)=nmass_si(NodeswithPredYVel(i),field)*PredYVel;
				end
				F_rollerY(i)=sum((nmomentum_si(NodeswithPredYVel(i),j,:)-nmomentum_si_old(1,1,:)))/dt;
				%nforce_si(NodeswithPredVel(i),j)=0;
			end
			%F_roller(i,2)=0;
		end
		
		for i=1:length(NodeswithPredYVel2)
			for j=2:2
				nmomentum_si_old=nmomentum_si(NodeswithPredYVel2(i),j,:);
				for field=1:fieldnumber
					nmomentum_si(NodeswithPredYVel2(i),j,field)=nmass_si(NodeswithPredYVel2(i),field)*PredYVel2;
				end
				%nforce_si(NodeswithPredVel(i),j)=0;
			end
			%F_roller(i,2)=0;
		end
	end
	if CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124 || CasetoRun==117 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110
		fprintf('%s',['marker #635' char(10)]);
		[v_ssp_out,x_sp_out] = Update_Prtcl_Posn_WPredVOR_optmzd(PredVelVect,CONNECTpn,NODES,dt,CONNECT,N,spCount,nmass_si,nforce_si,nmomentum_si,x_spo,v_ssp,x_sp,NodeswithPredXVel,NodeswithPredXVel2,NodeswithPredYVel,NodeswithPredYVel2,PredXVel,PredXVel2,PredYVel,PredYVel2,TheFieldSplit,fieldnumber,spSizes,CasetoRun);fprintf('%s',['marker #636' char(10)]);
	else
		[v_ssp_out,x_sp_out] = Update_Particle_Position_WithPredVel2(Nmatrix,CONNECTpn,NODES,dt,CONNECT,N,spCount,nmass_si,nforce_si,nmomentum_si,x_spo,v_ssp,x_sp,NodeswithPredXVel,NodeswithPredXVel2,NodeswithPredXVel2,NodeswithPredYVel,NodeswithPredYVel2,PredXVel,PredXVel2,PredYVel,PredYVel2,fieldnumber);
	end
	
	v_ssp_out=real(v_ssp_out);
	x_sp_out=real(x_sp_out);
	if CasetoRun==64 || CasetoRun==66 || CasetoRun==69 || CasetoRun==67 || CasetoRun==68 || CasetoRun==71 || CasetoRun==72 || CasetoRun==73 || CasetoRun==74 || CasetoRun==78 || CasetoRun==81 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==83 || CasetoRun==84 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124 || CasetoRun==117 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110 || CasetoRun==96 || CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89 || CasetoRun==85 || CasetoRun==77 || CasetoRun==65 || CasetoRun==70
		if (CasetoRun==72 || CasetoRun==73 || CasetoRun==74 || CasetoRun==78 || CasetoRun==81 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==83 || CasetoRun==77) && length(x_crack)==0
		elseif CasetoRun==84 || CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89 || CasetoRun==85 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==96
			for icrackpath=1:length(x_crack)
				[x_cracktop{icrackpath}] = UpdateCrackPosition_multi(Nmatrix_cracktop{icrackpath},NmatrixAll_cracktop{icrackpath},dt,nmass_si,nmomentum_si,x_cracktop{icrackpath});
				[x_crackbot{icrackpath}] = UpdateCrackPosition_multi(Nmatrix_crackbot{icrackpath},NmatrixAll_crackbot{icrackpath},dt,nmass_si,nmomentum_si,x_crackbot{icrackpath});
				for spcrack=1:size(x_crack{icrackpath},1)
					x_crack{icrackpath}(spcrack,:)=(x_cracktop{icrackpath}(spcrack,:)+x_crackbot{icrackpath}(spcrack,:))/2;
				end
			end
		elseif CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124 || CasetoRun==117 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110
			%NODES_cracktop_nullcopy=coder.nullcopy(NODES_cracktop); 
			%x_cracktop_nullcopy=coder.nullcopy(x_cracktop);
			%CONNECT_cracktop_nullcopy=coder.nullcopy(CONNECT_cracktop);
			%TheFieldSplit_cracktop_nullcopy=coder.nullcopy(TheFieldSplit_cracktop);
			%NODES_crackbot_nullcopy=coder.nullcopy(NODES_crackbot);
			%x_crackbot_nullcopy=coder.nullcopy(x_crackbot);
			%CONNECT_crackbot_nullcopy=coder.nullcopy(CONNECT_crackbot);
			%TheFieldSplit_crackbot_nullcopy=coder.nullcopy(TheFieldSplit_crackbot);
			fprintf('%s',['marker #637' char(10)]);
			x_crack=UpdateCrackPosition_multioptimized_topandbot(m_sp,N_crack,NODES_crack,CONNECT_crack,dt,nmass_si,nmomentum_si,x_crack,TheFieldSplit_cracktop,TheFieldSplit_crackbot,CasetoRun);
			%{
			for icrackpath=1:x_crack.npaths
				
				[temp_x_crack_top]=UpdateCrackPosition_multioptimized(N_cracktop{icrackpath},NODES_cracktop(icrackpath,:),CONNECT_cracktop_nullcopy{icrackpath},dt,nmass_si,nmomentum_si,x_crack.top(1:x_crack.nparticles(icrackpath),:,icrackpath),TheFieldSplit_cracktop{icrackpath});
				for i=1:size(temp_x_crack_top,1)
					for j=1:size(temp_x_crack_top,2)
						x_crack.top(i,j,icrackpath)=temp_x_crack_top(i,j);
					end
				end
				%fiasco went down above, solved for now
				[temp_x_crack_bot]=UpdateCrackPosition_multioptimized(N_crackbot{icrackpath},NODES_crackbot_nullcopy{icrackpath},CONNECT_crackbot_nullcopy{icrackpath},dt,nmass_si,nmomentum_si,x_crack.bot(1:x_crack.nparticles(icrackpath),:,icrackpath),TheFieldSplit_crackbot{icrackpath});
				for i=1:size(temp_x_crack_bot,1)
					for j=1:size(temp_x_crack_bot,2)
						x_crack.bot(i,j,icrackpath)=temp_x_crack_bot(i,j);
					end
				end
			end
			%x_cracktop_nullcopy=coder.nullcopy(x_cracktop);
			%x_crackbot_nullcopy=coder.nullcopy(x_crackbot);
			%}
			
			for icrackpath=1:x_crack.npaths
				for spcrack=1:x_crack.nparticles(icrackpath)
					for idimension=1:size(x_crack.center(:,:,icrackpath),2)
						x_crack.center(spcrack,idimension,icrackpath)=(x_crack.top(spcrack,idimension,icrackpath)+x_crack.bot(spcrack,idimension,icrackpath))/2;
					end
				end
			end
			fprintf('%s',['marker #638' char(10)]);
		else
			%[x_crack,x_cracktop,x_crackbot]=UpdateCrackPosition(x_crack,x_cracktop,x_crackbot,nmass_si,nmomentum_si,Nmatrix_crack,Nmatrix_cracktop,Nmatrix_crackbot,dt,Nmatrixtop,Nmatrixbot,v_ssp_out,m_sp);
			[x_crack.center(1:x_crack.nparticles(1),:,1),x_crack.top(1:x_crack.nparticles(1),:,1),x_crack.bot(1:x_crack.nparticles(1),:,1)]=UpdateCrackPosition2(x_crack.center(:,:,1),x_crack.top(1:x_crack.nparticles(1),:,1),x_crack.bot(1:x_crack.nparticles(1),:,1),nmass_si,nmomentum_si,Nmatrix_crack,Nmatrix_cracktop,Nmatrix_crackbot,dt,Nmatrix,v_ssp_out,m_sp,nfbcx,nfbcy,fbcx,fbcy);
			% Nmatrix_crack: MPM Nmatrix for crack particles (green)
			% Nmatrix_cracktop: MPM Nmatrix for crack top surface particles (red)
			% Nmatrix_crackbot: MPM Nmatrix for crack bot surface particles (blue)
		end
	end
	Fyignore=[];
	if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==21 || CasetoRun==17 || CasetoRun==64 || CasetoRun==66 || CasetoRun==69 || CasetoRun==67 || CasetoRun==68 || CasetoRun==71 || CasetoRun==72 || CasetoRun==73 || CasetoRun==74 || CasetoRun==78 || CasetoRun==81 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==83 || CasetoRun==84 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124 || CasetoRun==117 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110 || CasetoRun==96 || CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89 || CasetoRun==85 || CasetoRun==77 || CasetoRun==65 || CasetoRun==70
	elseif CasetoRun==4
	elseif CasetoRun==5 || CasetoRun==6
		ymomentumignore_new=m_sp.*v_ssp_out(:,2).*ignoremomentum;
		Fyignore=(ymomentumignore_new-ymomentumignore_prev)/dt;
	elseif CasetoRun==7
		ymomentumignore_new=m_sp.*v_ssp_out(:,2).*ignoremomentum;
		Fyignore=(ymomentumignore_new-ymomentumignore_prev)/dt;
	elseif CasetoRun==8 || CasetoRun==9
	elseif CasetoRun==10
		ymomentumignore_new=m_sp.*v_ssp_out(:,2).*ignoremomentum;
		Fyignore=(ymomentumignore_new-ymomentumignore_prev)/dt;
	elseif CasetoRun==11 || CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==15 || CasetoRun==14
		ymomentumignore_new=m_sp.*v_ssp_out(:,2).*ignoremomentum;
		Fyignore=(ymomentumignore_new-ymomentumignore_prev)/dt;
	elseif CasetoRun==12 || CasetoRun==16 || CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44
		ymomentumignore_new=m_sp.*v_ssp_out(:,2).*ignoremomentum;
		Fyignore=(ymomentumignore_new-ymomentumignore_prev)/dt;
	end
	%{
	[nvelo_si,L_si] = Interpolate_velocity_back(NODES,nodeCount,spCount,CONNECT,m_sp,v_ssp_out,N,dN,nmass_si);
	
	
	for i=1:length(NodeswithPredVel)
		for j=1:2
			nforce_si(NodeswithPredVel(i),j)=nmass_si(NodeswithPredVel(i))*PredAcc(j);
			for k=1:2
				nforce_si(NodeswithPredVel(i),j)=nforce_si(NodeswithPredVel(i),j)+L_si(i,j,k)*nmomentum_si(NodeswithPredVel(i),k);
			end
		end
	end
	[v_ssp_out,x_sp_out] = Update_Particle_Position_WithPredVel(NODES,dt,CONNECT,N,spCount,nmass_si,nforce_si,nmomentum_si,x_spo,v_ssp,x_sp,NodeswithPredVel,PredVel);
	%}
	%% Update solid particle velocity and position
	% velocity particle: v_ssp
	% position particle: x_sp
	% displacement particle: d_sp
	%{
	for i=1:numberofparticleswithpredeterminedvelocities
		for j=1:2
			v_ssp_out(particleswithpredeterminedvelocities(i),j)=predeterminedvelocityvalue(i,j);
		end
	end
	%}
	%{
	for i=1:numberofparticleswithpredeterminedvelocities
		%v_ssp(particleswithpredeterminedvelocities(i),1)=predeterminedvelocityvalue(1);
		%v_ssp(particleswithpredeterminedvelocities(i),2)=predeterminedvelocityvalue(2);
		%x_sp_out(particleswithpredeterminedvelocities(i),1)=x_sp(particleswithpredeterminedvelocities(i),1)+predeterminedvelocityvalue(1)*dt;
		%x_sp_out(particleswithpredeterminedvelocities(i),2)=x_sp(particleswithpredeterminedvelocities(i),2)+predeterminedvelocityvalue(2)*dt;
	end
	%}
	%% Mapping nodal velocity back to node
	if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==21 || CasetoRun==17 || CasetoRun==4 || CasetoRun==5 || CasetoRun==6 || CasetoRun==7 || CasetoRun==10 || CasetoRun==11 || CasetoRun==12 || CasetoRun==16 || CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44 || CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==15 || CasetoRun==14
		if CompareTexts(Version,'CPDI')
			[N,dN,CONNECT,spElems,mspoints,NODES,Nmatrix,dNxmatrix,dNymatrix,CONNECTpn] = Compute_Interpolator_CPDI(spCount,cellCount,x_sp,le,NN,LOC,r1_sp,r2_sp,A_sp,t_sp);
		elseif CompareTexts(Version,'MPM')
		else
			fprintf('%s',['Invalid Version Input' char(10)]);
		end
	elseif CasetoRun==8 || CasetoRun==9
		if CompareTexts(Version,'CPDI')
			[N,dN,CONNECT,spElems,mspoints,NODES,Nmatrix,dNxmatrix,dNymatrix] = Compute_Interpolator_CPDI_var(spCount,cellCount,x_sp,le_c,NN,LOC,r1_sp,r2_sp,A_sp,LOCX,LOCY);
		elseif CompareTexts(Version,'MPM')
		else
			fprintf('%s',['Invalid Version Input' char(10)]);
		end
	elseif CasetoRun==64 || CasetoRun==66 || CasetoRun==69 || CasetoRun==67 || CasetoRun==68 || CasetoRun==71 || CasetoRun==72 || CasetoRun==73 || CasetoRun==74 || CasetoRun==78 || CasetoRun==81 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==83 || CasetoRun==84 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124 || CasetoRun==117 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110 || CasetoRun==96 || CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89 || CasetoRun==85 || CasetoRun==77 || CasetoRun==65 || CasetoRun==70
	elseif CasetoRun==154 || CasetoRun==161
		%quan's cpdi fix goes here
		
		%fix activated
		[N,dN,CONNECT,spElems,mspoints,NODES,CONNECTpn,~] = Compute_Interpolator_CPDI_optimized(spCount,cellCount,x_sp_out,le,NN,LOC,r1_sp,r2_sp,A_sp,t_sp,0,1);fprintf('%s',['marker #815' char(10)]);
		if x_crack_length==0;
			%TheFieldSplit=ones(NN(1)*NN(2),spCount); % to stop coder whining
			TheFieldSplit=zeros(FindMaxVal(spSizes),lengthCONNECT);
			TheFieldSplit=ones(FindMaxVal(spSizes),lengthCONNECT);
			fieldnumber=1;
		else
			fprintf('%s',['marker #811' char(10)]);
			[TheFieldSplitBase3_old,TheFieldSplitBase3_sp,spSizes] = SplitFieldMultiOptimized2(LOC,x_sp_out,CONNECT,CONNECTpn,x_crack,t_time,le);
			fprintf('%s',['marker #814' char(10)]);
			%shit up there
			ncrackpath=x_crack_length;
			maplist=zeros(1000,ncrackpath);
			maplistsize=1;
			coder.varsize('maplist');
			maplist(1,:)=ones(1,ncrackpath);
			[TheFieldSplit,maplist,maplistsize]=Base3Mapping_sp(TheFieldSplitBase3_sp,CONNECT,maplist,maplistsize,niCount);fprintf('%s',['marker #812' char(10)]);
			fieldnumber=maplistsize;fprintf('%s',['marker #813' char(10)]);
		end
		
		%Recalculate TheFieldSplit_sp only?
	end
	
	if CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124 || CasetoRun==117 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110
		fprintf('%s',['marker #639' char(10)]);
		[nvelo_si] = Interpolate_velocity_back_optimized(NODES,nodeCount,spCount,CONNECT,m_sp,v_ssp_out,N,dN,nmass_si,TheFieldSplit,fieldnumber);fprintf('%s',['marker #640' char(10)]);
	elseif CasetoRun==154 || CasetoRun==161
		%quan's cpdi fix for nmass
		fprintf('%s',['marker #639' char(10)]);
		[nvelo_si] = Interpolate_velocity_back_optimized_msp(NODES,nodeCount,spCount,CONNECT,m_sp,v_ssp_out,N,dN,TheFieldSplit,fieldnumber);fprintf('%s',['marker #640' char(10)]);
	else
		[nvelo_si,~] = Interpolate_velocity_back(NODES,nodeCount,spCount,CONNECT,m_sp,v_ssp_out,N,dN,nmass_si,Nmatrix,dNxmatrix,dNymatrix);
	end
	% Boundary condition
	[nvelo_si] = Boundary_Dirichlet(nfbcx,nfbcy,fbcx,fbcy,nvelo_si); % Boundary condition for nodal force
	%% Update effective stress
	if CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124 || CasetoRun==117 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110
		fprintf('%s',['marker #641' char(10)]);
        if CloseEnough(t_time,0.0013958250738250609253310319246566,1e-5,2)
            1;
        end
		%sse_sp: specific (volume) elastic strain energy
		[sse_sp,F_sp,A_sp,t_sp,s_sp,p_sp,E_acc,e_pl_sp,sigma_global_big,e_t_global_big,e_pl_global_big,alphahp,f_final_vect,surfacewithfmax,sigma_local_big,evaltimes,stackvars,duration,dudx_sp,W_sp,thetacrackrtl,thetacrack,justcracked,Qacoustic,h,RQ,QbackRback,AbeforeQ_rtl] = ...
			Update_Stress_par_optimized(CModel,NODES,dt,cellCount,mspoints,CONNECT,nvelo_si,dN,E,nu,F_sp,A_spo,t_spo,m_sp,s_sp,p_sp,A_sp,t_sp,E_acc,epsilonshrinkdot_sp,epsilonshrinkdotx_sp,epsilonshrinkdoty_sp,e_pl_sp,sigma_global_big,e_t_global_big,e_pl_global_big,alphahp,xdirletter,ydirletter,zdirletter,xydirletter,yzdirletter,xzdirletter,ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,Grt,Gtl,Grl,nurt,nutl,nurl,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit,CasetoRun,troubleshotparticles,matmodel,weakeningfactor_sp,orientationoffset,Rdisplayedparticles,t_time,Debugging,spCount,dudx_sp,W_sp,thetacrackrtl,TheFieldSplit,fieldnumber,Efactor_sp);
		%LOC and everything previous is temporary here
        fprintf('%s',['marker #642' char(10)]);
	else
		[F_sp,A_sp,t_sp,s_sp,p_sp,E_acc,e_pl_sp,sigma_global_big,e_t_global_big,e_pl_global_big,alphahp,f_final_vect,surfacewithfmax,sigma_local_big,evaltimes,stackvars,duration,dudx_sp,W_sp,thetacrackrtl,thetacrack,justcracked,Qacoustic,h,RQ,QbackRback,AbeforeQ_rtl] = ...
			Update_Stress_par(CModel,NODES,dt,cellCount,mspoints,CONNECT,nvelo_si,dN,E,nu,F_sp,A_spo,t_spo,m_sp,s_sp,p_sp,A_sp,t_sp,E_acc,epsilonshrinkdot_sp,epsilonshrinkdotx_sp,epsilonshrinkdoty_sp,e_pl_sp,sigma_global_big,e_t_global_big,e_pl_global_big,alphahp,xdirletter,ydirletter,zdirletter,xydirletter,yzdirletter,xzdirletter,ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,Grt,Gtl,Grl,nurt,nutl,nurl,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit,CasetoRun,troubleshotparticles,matmodel,weakeningfactor_sp,orientationoffset,Rdisplayedparticles,t_time,Debugging,Nmatrix,dNxmatrix,dNymatrix,spCount,dudx_sp,W_sp,thetacrackrtl);
    end
	f_nucleate=2;
	n=zeros(2,1);
	expansion=2;
	icrackparticle=0;
	if (CasetoRun==72) && length(x_crack)==0
		s_max_max=-inf;
		s_max_max_num=0;
		thetamax=zeros(1,spCount);
		thetamin=zeros(1,spCount);
		s_max=zeros(1,spCount);
		s_min=zeros(1,spCount);
		s_shear=zeros(1,spCount);
		for sp=1:spCount
			theta=1/2*atan(2*s_sp(sp,3)/(s_sp(sp,1)-s_sp(sp,2)));
			s_first=(s_sp(sp,1)+s_sp(sp,2))/2+(s_sp(sp,1)-s_sp(sp,2))/2*cos(2*theta)+s_sp(sp,3)*sin(2*theta);
			s_second=(s_sp(sp,1)+s_sp(sp,2))/2-(s_sp(sp,1)-s_sp(sp,2))/2*cos(2*theta)-s_sp(sp,3)*sin(2*theta);
			if s_first>s_second
				thetamax(sp)=theta;
				thetamin(sp)=theta+pi/2;
			else
				thetamax(sp)=theta+pi/2;
				thetamin(sp)=theta;
			end
			s_max(sp)=max(s_first,s_second);
			s_min(sp)=min(s_first,s_second);
			s_shear(sp)=(s_max(sp)-s_min(sp))/2;
			if s_max(sp)>s_max_max
				s_max_max_num=sp;
				s_max_max=s_max(sp);
				s_max_theta=thetamin(sp);
			end
		end
		fprintf('%s',['s_max_max=' float2txt(5,s_max_max) ', s_max_theta=' float2txt(5,s_max_theta) ', s_max_max_num=' float2txt(5,s_max_max_num) char(10)]);
		if s_max_max>f_nucleate
			lp=zeros(1,1);
			lp(1)=le(1)/2;
			s_max_theta=mod(s_max_theta+pi,pi)-pi;
			x_crack(2,:)=x_sp(s_max_max_num,:)-lp(1)/2*[cos(s_max_theta) sin(s_max_theta)];
			x_crack(3,:)=x_sp(s_max_max_num,:)+lp(1)/2*[cos(s_max_theta) sin(s_max_theta)];
			x_crack(1,:)=x_crack(2,:)-le(1)*[cos(s_max_theta) sin(s_max_theta)];
			x_cracktop=x_crack;
			x_crackbot=x_crack;
		end
	elseif CasetoRun==73
	elseif CasetoRun==123 || CasetoRun==125 || CasetoRun==126 || CasetoRun==128 || CasetoRun==130
		
		%crack propagation of 123 (gauss average)
		%currently propagation only
		no=niCount;
		%s_tip(ipath,dim,itip);
		int_s_tip_dA=zeros(x_crack.npaths,3,2); %ipath, dimension, which tip
		s_tip=zeros(x_crack.npaths,3,2); %ipath, dimension, which tip
		s_tip_gauss=zeros(x_crack.npaths,3,2,x_crack.gauss.npoints); %ipath, dimension, which tip, igausspoint
		deltax_previous=zeros(1,2,1);
		theta_crack_trial=zeros(1,2);
		deltatheta_crack=zeros(1,2);
		s_tip_dump=zeros(2*x_crack.npaths,3);
		s_tip_K1_dump=zeros(2*x_crack.npaths,3);
		x_tip_dump=zeros(2*x_crack.npaths,2);
		s_gauss_dump=zeros(2*x_crack.gauss.npoints*x_crack.npaths,3);
		x_gauss_dump=zeros(2*x_crack.gauss.npoints*x_crack.npaths,2);
		sigmaW=zeros(1,1);
		icrackparticle=1;
		tip_dumpcounter=0;
		gauss_dumpcounter=0;
		for tip=2:-1:1
			%tip=1: particle of highest index
			%tip=2: particle of lowerst index
			for ipath=1:x_crack.npaths
				if tip==2
					icrackparticle=x_crack.nparticles(ipath);
				elseif tip==1
					icrackparticle=1;
				end
				for igausspoint=1:x_crack.gauss.npoints
					for nio=1:4
						io=CONNECT_crack.gauss(igausspoint,nio,ipath,tip);
						for dim=1:3
							s_tip_gauss(ipath,dim,tip,igausspoint)=s_tip_gauss(ipath,dim,tip,igausspoint)+s_si_comb(io,dim)*N_crack.gauss(1,nio,igausspoint,ipath,tip);
                        end
                    end
					gauss_dumpcounter=gauss_dumpcounter+1;
                    for dim=1:3
						s_gauss_dump(gauss_dumpcounter,dim)=s_tip_gauss(ipath,dim,tip,igausspoint);
                    end
                    for dim=1:2
                        x_gauss_dump(gauss_dumpcounter,dim)=x_crack.gauss.locs(igausspoint,dim,ipath,tip);
                    end
                end
                %plot(x_tip_dump(1:200,1),x_tip_dump(1:200,2),'o');
				sigmaW=0;
				for igausspoint=1:x_crack.gauss.npoints
					for dim=1:3
						int_s_tip_dA(ipath,dim,tip)=int_s_tip_dA(ipath,dim,tip)+s_tip_gauss(ipath,dim,tip,igausspoint)*x_crack.gauss.weights(igausspoint,ipath,tip);
					end
					sigmaW=sigmaW+x_crack.gauss.weights(igausspoint,ipath,tip);
				end
				1;
				for dim=1:3
					s_tip(ipath,dim,tip)=int_s_tip_dA(ipath,dim,tip)/sigmaW;
				end
				1;
				tip_dumpcounter=tip_dumpcounter+1;
				for dim=1:3
					s_tip_dump(tip_dumpcounter,dim)=s_tip(ipath,dim,tip);
				end
				1;
				for dim=1:2
					x_tip_dump(tip_dumpcounter,dim)=x_crack.center(icrackparticle,dim,ipath);
				end
				s_tip_max=(s_tip(ipath,1,tip)+s_tip(ipath,2,tip))/2+sqrt( ((s_tip(ipath,1,tip)-s_tip(ipath,2,tip))/2)^2 + (s_tip(ipath,3,tip))^2 ); %calculate principal stress
				steelstrength=0.0125;
				if s_tip_max>steelstrength
					theta_crack=0.5*(pi-reliableatan((s_tip(ipath,1,tip)-s_tip(ipath,2,tip))/2,-s_tip(ipath,3,tip)));
					crackextension=le(1);
					if tip==2
						deltax_previous=x_crack.center(icrackparticle,:,ipath)-x_crack.center(icrackparticle-1,:,ipath);
					elseif tip==1
						deltax_previous=x_crack.center(1,:,ipath)-x_crack.center(1+1,:,ipath);
					end
					%theta_previous=reliableatan(deltax_previous(1,1,1),deltax_previous(1,2,1));
					theta_crack_trial(1)=theta_crack;
					theta_crack_trial(2)=mod(theta_crack+pi,2*pi); %two possibilities for crack angle, 
					if (deltax_previous(1,1,1)*cos(theta_crack_trial(1))+deltax_previous(1,2,1)*sin(theta_crack_trial(1)))>0 % cos of theta_crack_trial with current crack tip trajectory
						theta_crack=theta_crack_trial(1);
					else
						theta_crack=theta_crack_trial(2);
					end
					if tip==2
						x_crack.center(icrackparticle+1,1,ipath)=x_crack.center(icrackparticle,1,ipath)+crackextension*cos(theta_crack);
						x_crack.top(icrackparticle+1,1,ipath)=x_crack.center(icrackparticle+1,1,ipath);
						x_crack.bot(icrackparticle+1,1,ipath)=x_crack.center(icrackparticle+1,1,ipath);
						x_crack.center(icrackparticle+1,2,ipath)=x_crack.center(icrackparticle,2,ipath)+crackextension*sin(theta_crack);
						x_crack.top(icrackparticle+1,2,ipath)=x_crack.center(icrackparticle+1,2,ipath);
						x_crack.bot(icrackparticle+1,2,ipath)=x_crack.center(icrackparticle+1,2,ipath);
					elseif tip==1
						for icrackparticlemove=x_crack.nparticles(ipath):-1:1
							for dim=1:2
								x_crack.center(icrackparticlemove+1,dim,ipath)=x_crack.center(icrackparticlemove,dim,ipath);
								x_crack.top(icrackparticlemove+1,dim,ipath)=x_crack.top(icrackparticlemove,dim,ipath);
								x_crack.bot(icrackparticlemove+1,dim,ipath)=x_crack.bot(icrackparticlemove,dim,ipath);
							end
						end
						x_crack.center(1,1,ipath)=x_crack.center(2,1,ipath)+crackextension*cos(theta_crack);
                        x_crack.top(1,1,ipath)=x_crack.center(1,1,ipath);
                        x_crack.bot(1,1,ipath)=x_crack.center(1,1,ipath);
						x_crack.center(1,2,ipath)=x_crack.center(2,2,ipath)+crackextension*sin(theta_crack);
                        x_crack.top(1,2,ipath)=x_crack.center(1,2,ipath);
                        x_crack.bot(1,2,ipath)=x_crack.center(1,2,ipath);
					end
					x_crack.nparticles(ipath)=x_crack.nparticles(ipath)+1;
				end
			end
		end
		1;
        
		%{
		justcrackednodes=zeros(1,no);
		crackanglenodes=zeros(1,no);
		nfield=fieldnumber;
		steelstrength=0.125;
		for io=1:no
			for ifield=1:nfield
				sigmamaxprinc=(s_si(io,1,ifield)+s_si(io,2,ifield))/2+sqrt(((s_si(io,1,ifield)-s_si(io,2,ifield))/2)^2+(s_si(io,3,ifield))^2);
				if sigmamaxprinc>steelstrength
					justcrackednodes(io)=1;
					crackanglenodes(io)=0.5*(pi-reliableatan((s_sp(1,1)-s_sp(1,2))/2,-s_sp(1,3)));
				end
			end
		end
		fprintf('%s',['marker #643b' char(10)]);
		if sum(justcrackednodes)>0
			justcrackedlist=zeros(sum(justcrackednodes),1);
			justcrackedcounter=0;
			for io=1:no
				if justcrackednodes(io)
					justcrackedcounter=justcrackedcounter+1;
					justcrackedlist(justcrackedcounter)=io;
				end
			end
			
			justcrackedlist=CrackParticleClustering_nodes(LOC,1.5*le(1),justcrackedlist);
			ntestedangle=size(Qacoustic{justcrackedlist{1}(1)},3);
			theta=zeros(ntestedangle,1);
			errorntestedangle=36*1*1*1;
			error=zeros(1,errorntestedangle);
			
			for crackgroup=1:length(justcrackedlist)
				justcrackedcounter=length(justcrackedlist{crackgroup});	
				x_justcrackedcenter=zeros(2,1);
				x_justcrackedcenter(1)=sum(LOC(justcrackedlist{crackgroup},1))/justcrackedcounter;
				x_justcrackedcenter(2)=sum(LOC(justcrackedlist{crackgroup},2))/justcrackedcounter;
				for i=1:errorntestedangle
					theta(i)=(i-1)/36*1*1*1*pi;
					error(i)=0;
					for spc=1:justcrackedcounter
						error(i)=error(i)+(mod(thetacrack(justcrackedlist{crackgroup}(spc))-theta(i)+pi/2,pi)-pi/2)^2;
					end
				end
				thetajustcrackedcenter=theta(FindMin(error));
				considered=ones(x_crack.npaths,2);
				distancelist=zeros(x_crack.npaths,2);
				thetapropagationlist=zeros(x_crack.npaths,2);
				n_nairncrack0=0;
				n_nairncrack1=0;
				for icrackpath=x_crack.npaths:-1:1
					for whichtip=1:2
						if whichtip==1
							n_nairncrack1=x_crack.nparticles(icrackpath);
							n_nairncrack0=n_nairncrack1-1;
						elseif whichtip==2
							n_nairncrack1=1;
							n_nairncrack0=2;
						else
							fprintf('%s',['whichtip error! 1904151959' char(10)]);
							pause;
							1;
						end
						
						x_cracktip=x_crack.center(n_nairncrack1,:,icrackpath);
						thetatocrackcenter=reliableatan(x_justcrackedcenter(1)-x_cracktip(1),x_justcrackedcenter(2)-x_cracktip(2));
						theta_prev=reliableatan(x_crack.center(n_nairncrack1,1,icrackpath)-x_crack.center(n_nairncrack0,1,icrackpath),x_crack.center(n_nairncrack1,2,icrackpath)-x_crack.center(n_nairncrack0,2,icrackpath));
						deltatheta_tocrackvsprev=mod(thetatocrackcenter-theta_prev+pi,2*pi)-pi;
						if abs(deltatheta_tocrackvsprev)>pi
							fprintf('%s',['deltatheta_tocrackvsprev error! 1904112048' char(10)]);
							pause;
							1;
						end
						if abs(deltatheta_tocrackvsprev)>pi/2
							considered(icrackpath,whichtip)=0;
							distancelist(icrackpath,whichtip)=inf;
							continue;
						end
						propagationlength=sqrt((x_crack.center(n_nairncrack1,1,icrackpath)-x_justcrackedcenter(1))^2+(x_crack.center(n_nairncrack1,2,icrackpath)-x_justcrackedcenter(2))^2);
						if propagationlength>1.5*le(1)
							considered(icrackpath,whichtip)=0;
							distancelist(icrackpath,whichtip)=inf;
							continue;
						end
						distancelist(icrackpath,whichtip)=propagationlength;
						for i=1:36*1*1*1
							theta(i)=(i-1)/36*1*1*1*2*pi;
							error(i)=(mod(thetajustcrackedcenter-theta(i)+pi/2,pi)-pi/2)^2+(mod(thetatocrackcenter-theta(i)+pi,2*pi)-pi)^2;
						end
						theta_crackpropagation=theta(FindMin(error));
						theta_crackpropagation=mod(theta_crackpropagation-theta_prev+pi,2*pi)+theta_prev-pi;
						thetapropagationlist(icrackpath,whichtip)=theta_crackpropagation;
					end
				end
				if sum(sum(considered))>0
					ncrackandwhichtip=FindMinMatrix(distancelist);
					icrackpath=ncrackandwhichtip(1);
					whichtip=ncrackandwhichtip(2);
					if whichtip==1
						n_nairncrack1=x_crack.nparticles(icrackpath);
					else
						n_nairncrack1=1;
					end
					propagationlength=distancelist(icrackpath,whichtip);
					theta_crackpropagation=thetapropagationlist(icrackpath,whichtip);
					idealpropagationlength=le(1)/4; %assuming lp(1)==lp(2)
					%propagationlengthreductionfactor=max([1 round(propagationlength/idealpropagationlength)]);
					propagationlengthreductionfactor=1;
					if whichtip==1
						x_crack.nparticles(icrackpath)=x_crack.nparticles(icrackpath)+propagationlengthreductionfactor;
						for i=1:propagationlengthreductionfactor
							x_crack.center(n_nairncrack1+i,:,icrackpath)=[x_crack.center(n_nairncrack1,1,icrackpath)+i/propagationlengthreductionfactor*propagationlength*cos(theta_crackpropagation) x_crack.center(n_nairncrack1,2,icrackpath)+i/propagationlengthreductionfactor*propagationlength*sin(theta_crackpropagation)];
							x_crack.top(n_nairncrack1+i,:,icrackpath)=x_crack.center(n_nairncrack1+i,:,icrackpath);
							x_crack.bot(n_nairncrack1+i,:,icrackpath)=x_crack.center(n_nairncrack1+i,:,icrackpath);
						end
					elseif whichtip==2
						for i=x_crack.nparticles(icrackpath):-1:1
							x_crack.center(i+propagationlengthreductionfactor,:,icrackpath)=x_crack.center(i,:,icrackpath);
							x_crack.top(i+propagationlengthreductionfactor,:,icrackpath)=x_crack.top(i,:,icrackpath);
							x_crack.bot(i+propagationlengthreductionfactor,:,icrackpath)=x_crack.bot(i,:,icrackpath);
						end
                        x_crack.nparticles(icrackpath)=x_crack.nparticles(icrackpath)+propagationlengthreductionfactor;
						n_nairncrack1=n_nairncrack1+propagationlengthreductionfactor;
						for i=1:propagationlengthreductionfactor
							x_crack.center(n_nairncrack1-i,:,icrackpath)=[x_crack.center(n_nairncrack1,1,icrackpath)+i/propagationlengthreductionfactor*propagationlength*cos(theta_crackpropagation) x_crack.center(n_nairncrack1,2,icrackpath)+i/propagationlengthreductionfactor*propagationlength*sin(theta_crackpropagation)];
							x_crack.top(n_nairncrack1-i,:,icrackpath)=x_crack.center(n_nairncrack1-i,:,icrackpath);
							x_crack.bot(n_nairncrack1-i,:,icrackpath)=x_crack.center(n_nairncrack1-i,:,icrackpath);
						end
					else
						fprintf('%s',['which tip error! 1904151909' char(10)]);
						pause;
						1;
					end
				else
					intheprevention=0;
					preventiondistance=0.075*le_base;
					preventionangle=pi/4;
					for icrackpath=1:x_crack.npaths;
						for spcrack=1:(x_crack.nparticles(icrackpath)-1)
							vector1a=[(x_justcrackedcenter(1)-x_crack.center(spcrack,1,icrackpath));(x_justcrackedcenter(2)-x_crack.center(spcrack,2,icrackpath))];
							vector1b=[(x_justcrackedcenter(1)-x_crack.center(spcrack+1,1,icrackpath));(x_justcrackedcenter(2)-x_crack.center(spcrack+1,2,icrackpath))];
							distance1a=sqrt(dot(vector1a,vector1a));
							distance1b=sqrt(dot(vector1b,vector1b));
							
							distance1a_old=sqrt((x_justcrackedcenter(1)-x_crack.center(spcrack,1,icrackpath))^2+(x_justcrackedcenter(2)-x_crack.center(spcrack,2,icrackpath))^2);
							distance1b_old=sqrt((x_justcrackedcenter(1)-x_crack.center(spcrack+1,1,icrackpath))^2+(x_justcrackedcenter(2)-x_crack.center(spcrack+1,2,icrackpath))^2);
							
							distance1=min([distance1a distance1b]);
							
							area2=abs(TriangleArea(x_justcrackedcenter,x_crack.center(spcrack,:,icrackpath),x_crack.center(spcrack+1,:,icrackpath)));
							
							inbetween2vector=[(x_crack.center(spcrack+1,1,icrackpath)-x_crack.center(spcrack,1,icrackpath));(x_crack.center(spcrack+1,2,icrackpath)-x_crack.center(spcrack,2,icrackpath))];
							
							inbetween2=sqrt(dot(inbetween2vector,inbetween2vector));
							
							inbetween2_old=sqrt((x_crack.center(spcrack+1,1,icrackpath)-x_crack.center(spcrack,1,icrackpath))^2+(x_crack.center(spcrack+1,2,icrackpath)-x_crack.center(spcrack,2,icrackpath))^2);
							distance2=area2/inbetween2;
							
							signcos1=dot(vector1a,inbetween2vector);
							signcos2=dot(vector1b,inbetween2vector);
							
							if signcos1*signcos2>0
								distance=distance1;
							else
								distance=distance2;
							end
							
							if distance<preventiondistance
								thetanairncrack=reliableatan(x_crack.center(spcrack+1,1,icrackpath)-x_crack.center(spcrack,1,icrackpath),x_crack.center(spcrack+1,2,icrackpath)-x_crack.center(spcrack,2,icrackpath));
								
								absdeltatheta=abs(mod(thetanairncrack-thetajustcrackedcenter+pi/2,pi)-pi/2);
								
								if absdeltatheta<preventionangle
									intheprevention=1;
								end
							end
							if intheprevention==1
								break;
							end
						end
						if intheprevention==1
							break;
						end
					end
					if intheprevention==0
						thetainitiate=mod(thetajustcrackedcenter-pi,pi)+pi; %always pointing down, pi<theta<2*pi
						icrackpath=x_crack.npaths+1;
						x_crack.npaths=x_crack.npaths+1;
						x_crack.nparticles(icrackpath)=2;
						x_crack.center(2,2,icrackpath)=x_justcrackedcenter(2)+le(1)/2/2*sin(thetainitiate); %assuming le(1)=le(2);
						x_crack.center(2,1,icrackpath)=x_justcrackedcenter(1)+le(1)/2/2*cos(thetainitiate);
						x_crack.center(1,2,icrackpath)=x_justcrackedcenter(2)-le(1)/2/2*sin(thetainitiate);
						x_crack.center(1,1,icrackpath)=x_justcrackedcenter(1)-le(1)/2/2*cos(thetainitiate);
						%fprintf('%s',['>>line 8967: size(x_crack' int2txt(icrackpath) '},1)=' int2txt(x_crack.nparticles(icrackpath)) char(10)]);
						%fprintf('%s',['>>line 8968: size(x_cracktop{' int2txt(icrackpath) '},1)=' int2txt(size(x_cracktop{icrackpath},1)) char(10)]);
						%{
						for i=1:size(x_cracktop{icrackpath},1)
							for j=1:size(x_cracktop{icrackpath},2)
								%fprintf('%s',['>>line 8973: x_cracktop{' int2txt(icrackpath) '}(' int2txt(i) ',' int2txt(j) ')=' float2txt(5,x_cracktop{icrackpath}(i,j)) char(10)]);
							end
						end
						for i=1:size(x_crackbot{icrackpath},1)
							for j=1:size(x_crackbot{icrackpath},2)
								%fprintf('%s',['>>line 8980: x_crackbot{' int2txt(icrackpath) '}(' int2txt(i) ',' int2txt(j) ')=' float2txt(5,x_crackbot{icrackpath}(i,j)) char(10)]);
							end
						end
						for i=1:size(x_crack{icrackpath},1)
							for j=1:size(x_crack{icrackpath},2)
								%fprintf('%s',['>>line 8987: x_crack{' int2txt(icrackpath) '}(' int2txt(i) ',' int2txt(j) ')=' float2txt(5,x_crack{icrackpath}(i,j)) char(10)]);
							end
						end
						%}
						for i=1:x_crack.nparticles(icrackpath)
							for j=1:2
								%fprintf('%s',['>>line 8973: x_crack{' int2txt(icrackpath) '}(' int2txt(i) ',' int2txt(j) ')=' float2txt(5,x_crack{icrackpath}(i,j)) char(10)]);
								x_crack.top(i,j,icrackpath)=x_crack.center(i,j,icrackpath);
								x_crack.bot(i,j,icrackpath)=x_crack.center(i,j,icrackpath);
							end
						end
						%shit below
						%x_cracktop{icrackpath}=x_crack{icrackpath};
						%x_crackbot{icrackpath}=x_crack{icrackpath};
						%shit above
					end
					%soundplay
					1;
				end
				
				
%{
%switchable1
				soundplay;
%}
%switchable1
				1; %pause multi average and propagate here
			end
			
		end
		fprintf('%s',['marker #644b' char(10)]);
		%}
	elseif CasetoRun==127 || CasetoRun==132 || CasetoRun==131
		%crack propagation of 118 (node centric not particle)
		%node centric propagation
		%no gauss propagation
		%currently propagation only
		no=niCount;
		%s_tip(ipath,dim,itip);
		s_tip=zeros(x_crack.npaths,3,2);
		s_tip_K1=zeros(x_crack.npaths,3,2); %ncrackpaths; dimension (x and y); which tip
		deltax_previous=zeros(1,2,1);
		theta_crack_trial=zeros(1,2);
		deltatheta_crack=zeros(1,2);
		s_tip_dump=zeros(2*x_crack.npaths,3);
		s_tip_K1_dump=zeros(2*x_crack.npaths,3);
		x_tip_dump=zeros(2*x_crack.npaths,2);
		K1_maxradius=3*le(1);
		K1_estimate=zeros(1,2);
		K1_distance=zeros(1,2);
		for tip=1:2
			%tip=1: particle of highest index
			%tip=2: particle of lowerst index
			for ipath=1:x_crack.npaths
				if tip==1
					icrackparticle=x_crack.nparticles(ipath);
				elseif tip==2
					icrackparticle=1;
                end
				closestro=1; % i of (relevant) node with highest N
				for ro=2:4
					if N_crack.center(1,ro,icrackparticle,ipath)>N_crack.center(1,ro-1,icrackparticle,ipath)
						closestro=ro;
					end
				end
				closestio=CONNECT_crack.center.values(icrackparticle,closestro,ipath);
				for dim=1:2
					K1_distance(dim)=LOC(closestio,dim)-x_crack.center(icrackparticle,dim,ipath);
				end
				K1_r=sqrt(dot(K1_distance,K1_distance));
				K1_theta=reliableatan(K1_distance(1),K1_distance(2));
				K1_estimate(1)=s_si_comb(closestio,1)*sqrt(2*pi*K1_r)/(cos(K1_theta/2)*(1-sin(K1_theta/2)*sin(3*K1_theta/2))); %K1 related to sigmaxx
				K1_estimate(2)=s_si_comb(closestio,2)*sqrt(2*pi*K1_r)/(cos(K1_theta/2)*(1+sin(K1_theta/2)*sin(3*K1_theta/2))); %K1 related to sigmayy
				K1_estimate_taken=0.5*abs(sum(K1_estimate));
				
				for io=1:niCount %what's the proper term for niCount now, "no" (Number of nOdes)?
					for dim=1:2
						K1_distance(dim)=LOC(io,dim)-x_crack.center(icrackparticle,dim,ipath);
					end
					K1_r=sqrt(dot(K1_distance,K1_distance));
					if K1_r<K1_maxradius
						K1_theta=reliableatan(K1_distance(1),K1_distance(2));
						s_si_K1(io,1)=K1_estimate_taken/sqrt(2*pi*K1_r)*(cos(K1_theta/2)*(1-sin(K1_theta/2)*sin(3*K1_theta/2))); %K1 related to sigmaxx
						s_si_K1(io,2)=K1_estimate_taken/sqrt(2*pi*K1_r)*(cos(K1_theta/2)*(1+sin(K1_theta/2)*sin(3*K1_theta/2))); %K1 related to sigmayy
						s_si_K1(io,3)=K1_estimate_taken/sqrt(2*pi*K1_r)*(cos(K1_theta/2)*sin(K1_theta/2)*cos(3*K1_theta/2)); %K1 related to sigmayy
					end
				end
				for nio=1:4
					io=CONNECT_crack.center.values(icrackparticle,nio,ipath);
					for dim=1:3
						s_tip(ipath,dim,tip)=s_tip(ipath,dim,tip)+s_si_comb(io,dim)*N_crack.center(1,nio,icrackparticle,ipath);
						s_tip_K1(ipath,dim,tip)=s_tip_K1(ipath,dim,tip)+s_si_K1(io,dim)*N_crack.center(1,nio,icrackparticle,ipath);
					end
				end
				for dim=1:3
					s_tip_dump(2*(ipath-1)+tip,dim)=s_tip(ipath,dim,tip);
					s_tip_K1_dump(2*(ipath-1)+tip,dim)=s_tip_K1(ipath,dim,tip);
				end
				for dim=1:2
					x_tip_dump(2*(ipath-1)+tip,dim)=x_crack.center(icrackparticle,dim,ipath);
				end
				s_tip_max=(s_tip(ipath,1,tip)+s_tip(ipath,2,tip))/2+sqrt( ((s_tip(ipath,1,tip)-s_tip(ipath,2,tip))/2)^2 + (s_tip(ipath,3,tip))^2 ); %calculate principal stress
				steelstrength=0.0125;
				if s_tip_max>steelstrength
					theta_crack=0.5*(pi-reliableatan((s_tip(ipath,1,tip)-s_tip(ipath,2,tip))/2,-s_tip(ipath,3,tip)));
					crackextension=le(1);
					if tip==1
						deltax_previous=x_crack.center(icrackparticle,:,ipath)-x_crack.center(icrackparticle-1,:,ipath);
					elseif tip==2
						deltax_previous=x_crack.center(1,:,ipath)-x_crack.center(1+1,:,ipath);
					end
					%theta_previous=reliableatan(deltax_previous(1,1,1),deltax_previous(1,2,1));
					theta_crack_trial(1)=theta_crack;
					theta_crack_trial(2)=mod(theta_crack+pi,2*pi); %two possibilities for crack angle, 
					if (deltax_previous(1,1,1)*cos(theta_crack_trial(1))+deltax_previous(1,2,1)*sin(theta_crack_trial(1)))>0 % cos of theta_crack_trial with current crack tip trajectory
						theta_crack=theta_crack_trial(1);
					else
						theta_crack=theta_crack_trial(2);
					end
					if tip==1
						x_crack.center(icrackparticle+1,1,ipath)=x_crack.center(icrackparticle,1,ipath)+crackextension*cos(theta_crack);
						x_crack.top(icrackparticle+1,1,ipath)=x_crack.center(icrackparticle+1,1,ipath);
						x_crack.bot(icrackparticle+1,1,ipath)=x_crack.center(icrackparticle+1,1,ipath);
						x_crack.center(icrackparticle+1,2,ipath)=x_crack.center(icrackparticle,2,ipath)+crackextension*sin(theta_crack);
						x_crack.top(icrackparticle+1,2,ipath)=x_crack.center(icrackparticle+1,2,ipath);
						x_crack.bot(icrackparticle+1,2,ipath)=x_crack.center(icrackparticle+1,2,ipath);
					elseif tip==2
						for icrackparticlemove=x_crack.nparticles(ipath):-1:1
							for dim=1:2
								x_crack.center(icrackparticlemove+1,dim,ipath)=x_crack.center(icrackparticlemove,dim,ipath);
								x_crack.top(icrackparticlemove+1,dim,ipath)=x_crack.top(icrackparticlemove,dim,ipath);
								x_crack.bot(icrackparticlemove+1,dim,ipath)=x_crack.bot(icrackparticlemove,dim,ipath);
							end
						end
						x_crack.center(1,1,ipath)=x_crack.center(2,1,ipath)+crackextension*cos(theta_crack);
                        x_crack.top(1,1,ipath)=x_crack.center(1,1,ipath);
                        x_crack.bot(1,1,ipath)=x_crack.center(1,1,ipath);
						x_crack.center(1,2,ipath)=x_crack.center(2,2,ipath)+crackextension*sin(theta_crack);
                        x_crack.top(1,2,ipath)=x_crack.center(1,2,ipath);
                        x_crack.bot(1,2,ipath)=x_crack.center(1,2,ipath);
					end
					x_crack.nparticles(ipath)=x_crack.nparticles(ipath)+1;
				end
			end
		end
	elseif CasetoRun==133 || CasetoRun==135 || CasetoRun==134 || CasetoRun==129 || CasetoRun==138
		%crack propagation of 133
		%propagation denied for this
		%node centric propagation
		%no gauss propagation
		%currently propagation only
		no=niCount;
		%s_tip(ipath,dim,itip);
		s_tip=zeros(x_crack.npaths,3,2);
		s_tip_K1=zeros(x_crack.npaths,3,2); %ncrackpaths; dimension (x and y); which tip
		deltax_previous=zeros(1,2,1);
		theta_crack_trial=zeros(1,2);
		deltatheta_crack=zeros(1,2);
		s_tip_dump=zeros(2*x_crack.npaths,3);
		s_tip_K1_dump=zeros(2*x_crack.npaths,3);
		x_tip_dump=zeros(2*x_crack.npaths,2);
		r_propdirweighted_dump=zeros(2*x_crack.npaths,2);
		K1_maxradius=3*le(1);
		K1_estimate=zeros(1,2);
		K1_distance=zeros(1,2);
		r_propdirweighted=zeros(x_crack.npaths,2,2); %crackpath num, dimension, which tip
		sigma_maxprinc_magnitude=0;
		r_propdircompliment=zeros(1,2);
		a_transform=zeros(2,2);
		s_tip_tensor=zeros(2,2);
		s_tip_tensor_transformed=zeros(2,2);
		%r_propdirweighted=zeros(1,2); %dimension only
		for tip=1:2
			%tip=1: particle of highest index
			%tip=2: particle of lowerst index
			for ipath=1:x_crack.npaths
				if tip==1
					icrackparticle=x_crack.nparticles(ipath);
				elseif tip==2
					icrackparticle=1;
                end
				closestro=1; % i of (relevant) node with highest N
				for ro=2:4
					if N_crack.center(1,ro,icrackparticle,ipath)>N_crack.center(1,ro-1,icrackparticle,ipath)
						closestro=ro;
					end
				end
				closestio=CONNECT_crack.center.values(icrackparticle,closestro,ipath);
				for dim=1:2
					K1_distance(dim)=LOC(closestio,dim)-x_crack.center(icrackparticle,dim,ipath);
				end
				K1_r=sqrt(dot(K1_distance,K1_distance));
				K1_theta=reliableatan(K1_distance(1),K1_distance(2));
				K1_estimate(1)=s_si_comb(closestio,1)*sqrt(2*pi*K1_r)/(cos(K1_theta/2)*(1-sin(K1_theta/2)*sin(3*K1_theta/2))); %K1 related to sigmaxx
				K1_estimate(2)=s_si_comb(closestio,2)*sqrt(2*pi*K1_r)/(cos(K1_theta/2)*(1+sin(K1_theta/2)*sin(3*K1_theta/2))); %K1 related to sigmayy
				K1_estimate_taken=0.5*abs(sum(K1_estimate));
				
				for io=1:niCount %what's the proper term for niCount now, "no" (Number of nOdes)?
					for dim=1:2
						K1_distance(dim)=LOC(io,dim)-x_crack.center(icrackparticle,dim,ipath);
					end
					K1_r=sqrt(dot(K1_distance,K1_distance));
					if K1_r<K1_maxradius
						K1_theta=reliableatan(K1_distance(1),K1_distance(2));
						s_si_K1(io,1)=K1_estimate_taken/sqrt(2*pi*K1_r)*(cos(K1_theta/2)*(1-sin(K1_theta/2)*sin(3*K1_theta/2))); %K1 related to sigmaxx
						s_si_K1(io,2)=K1_estimate_taken/sqrt(2*pi*K1_r)*(cos(K1_theta/2)*(1+sin(K1_theta/2)*sin(3*K1_theta/2))); %K1 related to sigmayy
						s_si_K1(io,3)=K1_estimate_taken/sqrt(2*pi*K1_r)*(cos(K1_theta/2)*sin(K1_theta/2)*cos(3*K1_theta/2)); %K1 related to sigmayy
					end
				end
				sigma_maxprinc_magnitude=0;
				for nio=1:4
					io=CONNECT_crack.center.values(icrackparticle,nio,ipath);
					% insert vector interpolation here
					maxprinc_thetastress=-0.5*reliableatan(0.5*(s_si_comb(io,1)-s_si_comb(io,2)),-s_si_comb(io,3));
					maxprinc_magnitude=0.5*(s_si_comb(io,1)+s_si_comb(io,2))+sqrt((0.5*(s_si_comb(io,1)-s_si_comb(io,2)))^2+(s_si_comb(io,3))^2);
					sigma_maxprinc_magnitude=sigma_maxprinc_magnitude+maxprinc_magnitude;
					maxprinc_thetapropagation=maxprinc_thetastress+pi/2;
					maxprinc_n_propagation=[cos(maxprinc_thetapropagation) sin(maxprinc_thetapropagation)];
					maxprinc_n_distance=zeros(1,2);
					for dim=1:2
						maxprinc_n_distance(dim)=LOC(io,dim)-x_crack.center(icrackparticle,dim,ipath);
					end
					maxprinc_n_propagation=maxprinc_n_propagation*sign(dot(maxprinc_n_propagation,maxprinc_n_distance));
					for dim=1:2
						if maxprinc_magnitude>0
							r_propdirweighted(ipath,dim,tip)=r_propdirweighted(ipath,dim,tip)+maxprinc_magnitude*maxprinc_n_propagation(dim);
						end
					end
					%tempmarker7
					for dim=1:3
						s_tip(ipath,dim,tip)=s_tip(ipath,dim,tip)+s_si_comb(io,dim)*N_crack.center(1,nio,icrackparticle,ipath);
						s_tip_K1(ipath,dim,tip)=s_tip_K1(ipath,dim,tip)+s_si_K1(io,dim)*N_crack.center(1,nio,icrackparticle,ipath);
					end
				end
				r_propdirweighted_magnitude=sqrt(dot(r_propdirweighted(ipath,:,tip),r_propdirweighted(ipath,:,tip)));
				for dim=1:2
					r_propdirweighted(ipath,dim,tip)=r_propdirweighted(ipath,dim,tip)/r_propdirweighted_magnitude;
				end
				r_propangle=reliableatan(r_propdirweighted(ipath,1,tip),r_propdirweighted(ipath,2,tip));
				r_propdircompliment(1)=cos(r_propangle); %equivalent to sin(theta+90 degrees)
				r_propdircompliment(2)=-sin(r_propangle); %equivalent to cos(theta+90 degrees)
				for dim=1:2
					a_transform(1,dim)=r_propdirweighted(ipath,dim,tip);
					a_transform(2,dim)=r_propdircompliment(dim);
				end
				s_tip_tensor(1,1)=s_tip(ipath,1,tip);
				s_tip_tensor(1,2)=s_tip(ipath,3,tip);
				s_tip_tensor(2,1)=s_tip(ipath,3,tip);
				s_tip_tensor(2,2)=s_tip(ipath,2,tip);
				for dim_i=1:2
					for dim_j=1:2
						s_tip_tensor_transformed(2,2)=s_tip_tensor_transformed(2,2)+a_transform(2,dim_i)*a_transform(2,dim_j)*s_tip_tensor(dim_i,dim_j);
					end
				end
				for dim=1:3
					s_tip_dump(2*(ipath-1)+tip,dim)=s_tip(ipath,dim,tip);
					s_tip_K1_dump(2*(ipath-1)+tip,dim)=s_tip_K1(ipath,dim,tip);
				end
				for dim=1:2
					x_tip_dump(2*(ipath-1)+tip,dim)=x_crack.center(icrackparticle,dim,ipath);
					r_propdirweighted_dump(2*(ipath-1)+tip,dim)=r_propdirweighted(ipath,dim,tip);
				end
				s_tip_max=(s_tip(ipath,1,tip)+s_tip(ipath,2,tip))/2+sqrt( ((s_tip(ipath,1,tip)-s_tip(ipath,2,tip))/2)^2 + (s_tip(ipath,3,tip))^2 ); %calculate principal stress
				if CasetoRun==138 || CasetoRun==133 || CasetoRun==139
					steelstrength=9999999;
				else
					steelstrength=0.0125;
				end
				if s_tip_tensor_transformed(2,2)>steelstrength
					theta_crack=r_propangle;
					crackextension=le(1);
					if tip==1
						deltax_previous=x_crack.center(icrackparticle,:,ipath)-x_crack.center(icrackparticle-1,:,ipath);
					elseif tip==2
						deltax_previous=x_crack.center(1,:,ipath)-x_crack.center(1+1,:,ipath);
					end
					%theta_previous=reliableatan(deltax_previous(1,1,1),deltax_previous(1,2,1));
					theta_crack_trial(1)=theta_crack;
					theta_crack_trial(2)=mod(theta_crack+pi,2*pi); %two possibilities for crack angle, 
					if (deltax_previous(1,1,1)*cos(theta_crack_trial(1))+deltax_previous(1,2,1)*sin(theta_crack_trial(1)))>0 % cos of theta_crack_trial with current crack tip trajectory
						theta_crack=theta_crack_trial(1);
%{
					else
						fprintf('%s',['line 10411>> crack direction reversed!' char(10)]);
						theta_crack=theta_crack_trial(2);
					end
%}
						if tip==1
							x_crack.center(icrackparticle+1,1,ipath)=x_crack.center(icrackparticle,1,ipath)+crackextension*cos(theta_crack);
							x_crack.center(icrackparticle+1,2,ipath)=x_crack.center(icrackparticle,2,ipath)+crackextension*sin(theta_crack);
							for idim=1:2
								x_crack.top(icrackparticle+1,idim,ipath)=x_crack.center(icrackparticle+1,idim,ipath);
								x_crack.bot(icrackparticle+1,idim,ipath)=x_crack.center(icrackparticle+1,idim,ipath);
							end
							x_crack.cohesivepoint(icrackparticle+1,ipath)=1;
						elseif tip==2
							for icrackparticlemove=x_crack.nparticles(ipath):-1:1
								for idim=1:2
									x_crack.center(icrackparticlemove+1,idim,ipath)=x_crack.center(icrackparticlemove,idim,ipath);
									x_crack.top(icrackparticlemove+1,idim,ipath)=x_crack.top(icrackparticlemove,idim,ipath);
									x_crack.bot(icrackparticlemove+1,idim,ipath)=x_crack.bot(icrackparticlemove,idim,ipath);
								end
							end
							x_crack.center(1,1,ipath)=x_crack.center(2,1,ipath)+crackextension*cos(theta_crack);
							x_crack.center(1,2,ipath)=x_crack.center(2,2,ipath)+crackextension*sin(theta_crack);
							for idim=1:2
								x_crack.top(1,idim,ipath)=x_crack.center(1,idim,ipath);
								x_crack.bot(1,idim,ipath)=x_crack.center(1,idim,ipath);
							end
							x_crack.cohesivepoint(1,ipath)=1;
						end
						x_crack.nparticles(ipath)=x_crack.nparticles(ipath)+1;
					else
						fprintf('%s',['line 10412>> propagation denied!' char(10)]);
					end
				end
			end
		end
	elseif CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==194
		%crack propagation of 163
		% of 139 with initiation
		%node centric propagation
		%no gauss propagation
		no=niCount;
		%s_tip(ipath,dim,itip);
		s_tip=zeros(x_crack.npaths,3,2);
		s_tip_K1=zeros(x_crack.npaths,3,2); %ncrackpaths; dimension (x and y); which tip
		deltax_previous=zeros(1,2,1);
		theta_crack_trial=zeros(1,2);
		deltatheta_crack=zeros(1,2);
		s_tip_dump=zeros(2*x_crack.npaths,3);
		d_tip_dump=zeros(2*x_crack.npaths,8);
		d_LOC_tip_dump=zeros(2*x_crack.npaths,8);
		s_tip_K1_dump=zeros(2*x_crack.npaths,3);
		u_tip_dump=zeros(2*x_crack.npaths,8);
		x_tip_dump=zeros(2*x_crack.npaths,2);
		r_propdirweighted_dump=zeros(2*x_crack.npaths,2);
		K1_maxradius=3*le(1);
		K1_estimate=zeros(1,2);
		K1_distance=zeros(1,2);
		r_propdirweighted=zeros(x_crack.npaths,2,2); %crackpath num, dimension, which tip
		sigma_maxprinc_magnitude=0;
		r_propdircompliment=zeros(1,2);
		a_transform=zeros(2,2);
		s_tip_tensor=zeros(2,2);
		s_tip_tensor_transformed=zeros(2,2);
		LOC_avg=zeros(1,2);
		nio_designator=zeros(1,4);
		d_natural=zeros(8,1);
		delta_x=zeros(1,2);
		epsilon_tip=zeros(3,1);
		x_crack_ghosttip=zeros(1,2);
		x1=zeros(1,2);
		x2=zeros(1,2);
		x3=zeros(1,2);
		x4=zeros(1,2);
		Area=zeros(1,4);
		foundcrossing.ipath3=zeros(1,200); %so not clash with ipath
		foundcrossing.icrackparticle3=zeros(1,200); %so not to clash with iparticle
		foundcrossing.ratio=zeros(1,200); %at which point where crossing happens?
		foundcrossing.size3=zeros(1,1); %how many found? %again size3 so to not clash with regular size, perhaps.
		%nio_designator(1): in the natural coordinates, node 1 associates with which nio?
		%nio_designator(2): in the natural coordinates, node 2 associates with which nio?
		%nio_designator(3): in the natural coordinates, node 3 associates with which nio?
		%nio_designator(4): in the natural coordinates, node 4 associates with which nio?
		
		io_natural_cross_before=0;
		io_natural_cross_after=0;
		io_natural_sides=zeros(1,4);
		
		steelstrength=0.0125; %to stop coder whining
		if CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==182 || CasetoRun==177 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==194
			steelstrength=0.0125;
			k_dumpresult=0.99;
		elseif CasetoRun==179 || CasetoRun==183 || CasetoRun==184
			steelstrength=1e10; %cracking denied
			k_dumpresult=0.99;
		elseif CasetoRun==185
			steelstrength=0.0125; %cracking denied
			k_dumpresult=0.99;
		elseif CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==194
			steelstrength=25;
			k_dumpresult=0.9;
		end
		steelstrengthbase=steelstrength;
        
        %r_propdirweighted=zeros(1,2); %dimension only
		%allowpropagation=1;
		for tip=1:2
			%tip=1: particle of highest index
			%tip=2: particle of lowerst index
			for ipath=1:x_crack.npaths
				if x_crack.terminatedprop(ipath,tip)==0
					if tip==1
						icrackparticle=x_crack.nparticles(ipath);
					elseif tip==2
						icrackparticle=1;
					end
					LOC_avg=zeros(1,2);
					for nio=1:4
						io=CONNECT_crack.center.values(icrackparticle,nio,ipath);
						for dim=1:2
							LOC_avg(1,dim)=LOC_avg(1,dim)+LOC(io,dim);
						end
					end
					for dim=1:2
						LOC_avg(1,dim)=LOC_avg(1,dim)/4;
					end
					for nio=1:4
						io=CONNECT_crack.center.values(icrackparticle,nio,ipath);
						if LOC(io,1)<LOC_avg(1,1)
							if LOC(io,2)<LOC_avg(1,2)
								nio_designator(1)=nio;
							elseif LOC(io,2)>LOC_avg(1,2) %can just write else, but this way it's more readable. also equal is not possible, so I left it out
								nio_designator(4)=nio;
							end
						elseif LOC(io,1)>LOC_avg(1,1) %same drill, trying to improve readability
							if LOC(io,2)<LOC_avg(1,2)
								nio_designator(2)=nio;
							elseif LOC(io,2)>LOC_avg(1,2)
								nio_designator(3)=nio;
							end
						end
					end
					%allowpropagation=1;
					tip_crackability=0;
					for io_natural=1:4
						nio_outside=nio_designator(io_natural);
						io=CONNECT_crack.center.values(icrackparticle,nio_outside,ipath);
						tip_crackability=tip_crackability+uncrackable_si_comb(io)*N_crack.center(1,nio_outside,icrackparticle,ipath);
					end
					%finding where the crack cuts the cell
					for itrial=1:x_crack.nparticles(ipath)-1
						io_natural_cross_before=0;
						io_natural_cross_after=0;
						io_natural_sides=zeros(1,4);
						if tip==1
							x1(1,1)=x_crack.center(icrackparticle-(itrial-1),1,ipath);
							x1(1,2)=x_crack.center(icrackparticle-(itrial-1),2,ipath);
							x2(1,1)=x_crack.center(icrackparticle-itrial,1,ipath);
							x2(1,2)=x_crack.center(icrackparticle-itrial,2,ipath);
						elseif tip==2
							x1(1,1)=x_crack.center(1+(itrial-1),1,ipath);
							x1(1,2)=x_crack.center(1+(itrial-1),2,ipath);
							x2(1,1)=x_crack.center(1+itrial,1,ipath);
							x2(1,2)=x_crack.center(1+itrial,2,ipath);
						end
											
						for io_natural=1:4
							nio_outside=nio_designator(io_natural);
							io=CONNECT_crack.center.values(icrackparticle,nio_outside,ipath);
							x3(1,1)=LOC(io,1);
							x3(1,2)=LOC(io,2);
							nio_outside=nio_designator(mod(io_natural+1-1,4)+1);
							io=CONNECT_crack.center.values(icrackparticle,nio_outside,ipath);
							x4(1,1)=LOC(io,1);
							x4(1,2)=LOC(io,2);
							Area(1)=TriangleArea(x1,x2,x3);
							Area(2)=TriangleArea(x1,x2,x4);
							Area(3)=TriangleArea(x3,x4,x1);
							Area(4)=TriangleArea(x3,x4,x2);
							if (Area(1)<0 && Area(2)>=0 && Area(3)>=0 && Area(4)<0) || (Area(1)>=0 && Area(2)<0 && Area(3)<0 && Area(4)>=0)
								%before and before-1: top(2) for tip==1, bottom(3) for tip==2
								%after and after+1: bottom(3) for tip==1, top(2) for tip==1
								io_natural_cross_before=io_natural;
								if tip==1
									io_natural_sides(io_natural_cross_before)=2;
									io_natural_sides(mod(io_natural_cross_before-1-1,4)+1)=2;
								elseif tip==2
									io_natural_sides(io_natural_cross_before)=3;
									io_natural_sides(mod(io_natural_cross_before-1-1,4)+1)=3;
								end
								
								io_natural_cross_after=mod(io_natural+1-1,4)+1;
								if tip==1
									io_natural_sides(io_natural_cross_after)=3;							
									io_natural_sides(mod(io_natural_cross_after+1-1,4)+1)=3;
								elseif tip==2
									io_natural_sides(io_natural_cross_after)=2;
									io_natural_sides(mod(io_natural_cross_after+1-1,4)+1)=2;
								end
								break;
							end
						end
						if io_natural_cross_before>0
							break;
						end
					end
					x_crack.Efactor(ipath,tip)=0;
					x_crack.mEfactor(ipath,tip)=0;
					x_crack.mass(ipath,tip)=0;
					for io_natural=1:4
						nio_outside=nio_designator(io_natural);
						io=CONNECT_crack.center.values(icrackparticle,nio_outside,ipath);
						if CasetoRun==174
							x_crack.mEfactor(ipath,tip)=x_crack.mEfactor(ipath,tip)+N_crack.center(1,nio_outside,icrackparticle,ipath)*mEfactor_si(io,1);
							x_crack.mass(ipath,tip)=x_crack.mass(ipath,tip)+N_crack.center(1,nio_outside,icrackparticle,ipath)*nmass_si(io,1);
						end
						for dim=1:2
							index=2*(io_natural-1)+dim;
                            if io_natural_sides(io_natural)==2
                                d_natural(index,1)=u_si(io,dim,TheFieldSplit_cracktop{ipath}(nio_outside,icrackparticle));
                            elseif io_natural_sides(io_natural)==3
                                d_natural(index,1)=u_si(io,dim,TheFieldSplit_crackbot{ipath}(nio_outside,icrackparticle));
                            else
                                d_natural(index,1)=u_si_comb(io,dim);
                            end
						end
						%if uncrackable_si_comb(io)>0.25
						if tip_crackability>0.125
							x_crack.terminatedprop(ipath,tip)=1;
							break;
						elseif sum(nmass_si(io,:))<=0
							%allowpropagation=0;
							x_crack.terminatedprop(ipath,tip)=1;
							x_crack.openedgetip(ipath,tip)=1;
							if tip==1
								deltax_previous=x_crack.center(icrackparticle,:,ipath)-x_crack.center(icrackparticle-1,:,ipath);
								x_crack.cohesivepoint(icrackparticle,ipath)=0;
							elseif tip==2
								deltax_previous=x_crack.center(1,:,ipath)-x_crack.center(1+1,:,ipath);
								x_crack.cohesivepoint(1,ipath)=0;
							end
							if tip==1
								%CLEAR EDGE EXTENSION
								%might need idim=1:2 loop, but don't touch if still works OK?
								%did it anyway
								
								% no shift here, just adding to the list
								for idim=1:2
									x_crack.center(icrackparticle+1,idim,ipath)=x_crack.center(icrackparticle,idim,ipath)+deltax_previous(idim);
									x_crack.top(icrackparticle+1,idim,ipath)=x_crack.center(icrackparticle+1,idim,ipath);
									x_crack.bot(icrackparticle+1,idim,ipath)=x_crack.center(icrackparticle+1,idim,ipath);
								end
							elseif tip==2
								% shift here
								
								%shift loop below:
								for icrackparticlemove=x_crack.nparticles(ipath):-1:1
									for idim=1:2
										x_crack.center(icrackparticlemove+1,idim,ipath)=x_crack.center(icrackparticlemove,idim,ipath);
										x_crack.top(icrackparticlemove+1,idim,ipath)=x_crack.top(icrackparticlemove,idim,ipath);
										x_crack.bot(icrackparticlemove+1,idim,ipath)=x_crack.bot(icrackparticlemove,idim,ipath);
										
										
										x_crack.force.top(icrackparticlemove+1,idim,ipath)=x_crack.force.top(icrackparticlemove,idim,ipath);
										x_crack.force.bot(icrackparticlemove+1,idim,ipath)=x_crack.force.bot(icrackparticlemove,idim,ipath);
										x_crack.bridge.base.deltax(icrackparticlemove+1,idim,ipath)=x_crack.bridge.base.deltax(icrackparticlemove,idim,ipath);
										x_crack.bridge.adjusted.deltax(icrackparticlemove+1,idim,ipath)=x_crack.bridge.adjusted.deltax(icrackparticlemove,idim,ipath);
										x_crack.bridge.firsttimedeltax(icrackparticlemove+1,idim,ipath)=x_crack.bridge.firsttimedeltax(icrackparticlemove,idim,ipath);
										%(icrackparticlemove+1,idim,ipath)
										%(icrackparticlemove,idim,ipath)
										%=
									end
									x_crack.bridge.absforce(icrackparticlemove+1,ipath)=x_crack.bridge.absforce(icrackparticlemove,ipath);
									x_crack.bridge.isactive(icrackparticlemove+1,ipath)=x_crack.bridge.isactive(icrackparticlemove,ipath);
									x_crack.bridge.firsttimeactive(icrackparticlemove+1,ipath)=x_crack.bridge.firsttimeactive(icrackparticlemove,ipath);
									x_crack.bridge.adjusted.absdeltaxmax(icrackparticlemove+1,ipath)=x_crack.bridge.adjusted.absdeltaxmax(icrackparticlemove,ipath);
									x_crack.bridge.base.absdeltax(icrackparticlemove+1,ipath)=x_crack.bridge.base.absdeltax(icrackparticlemove,ipath);
									x_crack.bridge.adjusted.absdeltax(icrackparticlemove+1,ipath)=x_crack.bridge.adjusted.absdeltax(icrackparticlemove,ipath);
									x_crack.bridge.adjusted.absdeltaxmaxi(icrackparticlemove+1,ipath)=x_crack.bridge.adjusted.absdeltaxmaxi(icrackparticlemove,ipath);
									x_crack.bridge.kbase2(icrackparticlemove+1,ipath)=x_crack.bridge.kbase2(icrackparticlemove,ipath);
									x_crack.bridge.yieldforce2(icrackparticlemove+1,ipath)=x_crack.bridge.yieldforce2(icrackparticlemove,ipath);
									x_crack.bridge.deltai2(icrackparticlemove+1,ipath)=x_crack.bridge.deltai2(icrackparticlemove,ipath);
									x_crack.cohesivepoint(icrackparticlemove+1,ipath)=x_crack.cohesivepoint(icrackparticlemove,ipath);
								end
								
								%adding to the list here:
								for idim=1:2
									x_crack.center(1,idim,ipath)=x_crack.center(2,idim,ipath)+deltax_previous(idim);
									x_crack.top(1,idim,ipath)=x_crack.center(1,idim,ipath);
									x_crack.bot(1,idim,ipath)=x_crack.center(1,idim,ipath);
								end
							end
                            x_crack.nparticles(ipath)=x_crack.nparticles(ipath)+1;
							break;
							
						end
					end
					
					if CasetoRun==174
						if x_crack.mass(ipath,tip)>0 && x_crack.mEfactor(ipath,tip)>0
							x_crack.Efactor(ipath,tip)=x_crack.mEfactor(ipath,tip)/x_crack.mass(ipath,tip);
    						fprintf('%s',['ipath=' int2txt(ipath) '; tip=' int2txt(tip) '; x_crack.Efactor(ipath,tip)=' float2scitxt(5,x_crack.Efactor(ipath,tip)) char(10)]);
                            1;
                        else
    						fprintf('%s',['ipath=' int2txt(ipath) '; tip=' int2txt(tip) '; x_crack.Efactor(ipath,tip)=default (1)' char(10)]);
							x_crack.Efactor(ipath,tip)=1;
						end
						steelstrength=steelstrengthbase*x_crack.Efactor(ipath,tip);
						%steelstrength=steelstrengthbase; %turned off for now
					end
					
					a=le(1)/2;
					b=le(2)/2;
					
					for dim=1:2
						delta_x(dim)=x_crack.center(icrackparticle,dim,ipath)-LOC_avg(1,dim);
					end
					
					xi=delta_x(1)/a;
					eta=delta_x(2)/b;
					
					B=1/4*[(-1+eta)/a 0 (1-eta)/a 0 (1+eta)/a 0 (-1-eta)/a 0;
							0 (-1+xi)/b 0 (-1-xi)/b 0 (1+xi)/b 0 (1-xi)/b;
							(-1+xi)/b (-1+eta)/a (-1-xi)/b (1-eta)/a (1+xi)/b (1+eta)/a (1-xi)/b (-1-eta)/a];
					
					epsilon_tip=B*d_natural;
					%tempmarker5

					D=E/((1+nu)*(1-2*nu))*[1-nu nu 0;nu 1-nu 0;0 0 (1-2*nu)];
					
					s_tip_temp=D*epsilon_tip;
					
					for idim=1:3
						s_tip(ipath,idim,tip)=s_tip_temp(idim,1);
					end
					for idim=1:3
						s_tip_dump(2*(ipath-1)+tip,idim)=s_tip(ipath,idim,tip);
						s_tip_K1_dump(2*(ipath-1)+tip,idim)=s_tip_K1(ipath,idim,tip);
					end
					for idim=1:8
						d_tip_dump(2*(ipath-1)+tip,idim)=d_natural(idim,1);
						io_natural=ceil(idim/2);
						xydim=mod(idim-1,2)+1;
						d_LOC_tip_dump(2*(ipath-1)+tip,idim)=LOC(CONNECT_crack.center.values(icrackparticle,nio_designator(io_natural),ipath),xydim);;
					end
					for idim=1:2
						x_tip_dump(2*(ipath-1)+tip,idim)=x_crack.center(icrackparticle,idim,ipath);
					end
					s_tip_max=(s_tip(ipath,1,tip)+s_tip(ipath,2,tip))/2+sqrt( ((s_tip(ipath,1,tip)-s_tip(ipath,2,tip))/2)^2 + (s_tip(ipath,3,tip))^2 ); %calculate principal stress
					
					if s_tip_max>k_dumpresult*steelstrength
						dumpresult=1;
					end
					x_crack.tipcrackratio(ipath,tip)=s_tip_max/steelstrength;
					if x_crack.terminatedprop(ipath,tip)==0 && s_tip_max>steelstrength
					%if s_tip_max>steelstrength
						if ipath==1 && x_crack.nparticles(ipath)>=10
							1;
						end
						theta_crack=0.5*(pi-reliableatan((s_tip(ipath,1,tip)-s_tip(ipath,2,tip))/2,-s_tip(ipath,3,tip)));
						if CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==194
							crackextension=x_crack.spacing;
						else
							crackextension=le(1)/2;
						end
						if tip==1
							deltax_previous=x_crack.center(icrackparticle,:,ipath)-x_crack.center(icrackparticle-1,:,ipath);
						elseif tip==2
							deltax_previous=x_crack.center(1,:,ipath)-x_crack.center(1+1,:,ipath);
						end
						%theta_previous=reliableatan(deltax_previous(1,1,1),deltax_previous(1,2,1));
						theta_crack_trial(1)=theta_crack;
						theta_crack_trial(2)=mod(theta_crack+pi,2*pi); %two possibilities for crack angle, 
						if (deltax_previous(1,1,1)*cos(theta_crack_trial(1))+deltax_previous(1,2,1)*sin(theta_crack_trial(1)))>0 % cos of theta_crack_trial with current crack tip trajectory
							theta_crack=theta_crack_trial(1);
						else
							theta_crack=theta_crack_trial(2);
						end
						if tip==1
							%STRENGTH EXCEEDING PROPAGATION
							x_crack.center(icrackparticle+1,1,ipath)=x_crack.center(icrackparticle,1,ipath)+crackextension*cos(theta_crack);
							x_crack.center(icrackparticle+1,2,ipath)=x_crack.center(icrackparticle,2,ipath)+crackextension*sin(theta_crack);
							for idim=1:2
								x_crack.top(icrackparticle+1,idim,ipath)=x_crack.center(icrackparticle+1,idim,ipath);
								x_crack.bot(icrackparticle+1,idim,ipath)=x_crack.center(icrackparticle+1,idim,ipath);
							end
							x_crack.cohesivepoint(icrackparticle+1,ipath)=1;
							x_crack.sequence.tipreg(ipath,tip)=1;

							x_crack_ghosttip(1,1)=x_crack.center(icrackparticle,1,ipath)+3*crackextension*cos(theta_crack);
							x_crack_ghosttip(1,2)=x_crack.center(icrackparticle,2,ipath)+3*crackextension*sin(theta_crack);
						elseif tip==2
							for icrackparticlemove=x_crack.nparticles(ipath):-1:1
								for idim=1:2
									x_crack.center(icrackparticlemove+1,idim,ipath)=x_crack.center(icrackparticlemove,idim,ipath);
									x_crack.top(icrackparticlemove+1,idim,ipath)=x_crack.top(icrackparticlemove,idim,ipath);
									x_crack.bot(icrackparticlemove+1,idim,ipath)=x_crack.bot(icrackparticlemove,idim,ipath);
									
									x_crack.force.top(icrackparticlemove+1,idim,ipath)=x_crack.force.top(icrackparticlemove,idim,ipath);
									x_crack.force.bot(icrackparticlemove+1,idim,ipath)=x_crack.force.bot(icrackparticlemove,idim,ipath);
									x_crack.bridge.base.deltax(icrackparticlemove+1,idim,ipath)=x_crack.bridge.base.deltax(icrackparticlemove,idim,ipath);
									x_crack.bridge.adjusted.deltax(icrackparticlemove+1,idim,ipath)=x_crack.bridge.adjusted.deltax(icrackparticlemove,idim,ipath);
									x_crack.bridge.firsttimedeltax(icrackparticlemove+1,idim,ipath)=x_crack.bridge.firsttimedeltax(icrackparticlemove,idim,ipath);
								end
								x_crack.bridge.absforce(icrackparticlemove+1,ipath)=x_crack.bridge.absforce(icrackparticlemove,ipath);
								x_crack.bridge.isactive(icrackparticlemove+1,ipath)=x_crack.bridge.isactive(icrackparticlemove,ipath);
								x_crack.bridge.firsttimeactive(icrackparticlemove+1,ipath)=x_crack.bridge.firsttimeactive(icrackparticlemove,ipath);
								x_crack.bridge.adjusted.absdeltaxmax(icrackparticlemove+1,ipath)=x_crack.bridge.adjusted.absdeltaxmax(icrackparticlemove,ipath);
								x_crack.bridge.base.absdeltax(icrackparticlemove+1,ipath)=x_crack.bridge.base.absdeltax(icrackparticlemove,ipath);
								x_crack.bridge.adjusted.absdeltax(icrackparticlemove+1,ipath)=x_crack.bridge.adjusted.absdeltax(icrackparticlemove,ipath);
								x_crack.bridge.adjusted.absdeltaxmaxi(icrackparticlemove+1,ipath)=x_crack.bridge.adjusted.absdeltaxmaxi(icrackparticlemove,ipath);
								x_crack.bridge.kbase2(icrackparticlemove+1,ipath)=x_crack.bridge.kbase2(icrackparticlemove,ipath);
								x_crack.bridge.yieldforce2(icrackparticlemove+1,ipath)=x_crack.bridge.yieldforce2(icrackparticlemove,ipath);
								x_crack.bridge.deltai2(icrackparticlemove+1,ipath)=x_crack.bridge.deltai2(icrackparticlemove,ipath);
								x_crack.cohesivepoint(icrackparticlemove+1,ipath)=x_crack.cohesivepoint(icrackparticlemove,ipath);
							end
							x_crack.center(1,1,ipath)=x_crack.center(2,1,ipath)+crackextension*cos(theta_crack);
							x_crack.center(1,2,ipath)=x_crack.center(2,2,ipath)+crackextension*sin(theta_crack);
							for idim=1:2
								x_crack.top(1,idim,ipath)=x_crack.center(1,idim,ipath);
								x_crack.bot(1,idim,ipath)=x_crack.center(1,idim,ipath);
							end
							x_crack.cohesivepoint(1,ipath)=1;
							x_crack.sequence.tipreg(ipath,tip)=1;
							
							x_crack_ghosttip(1,1)=x_crack.center(2,1,ipath)+3*crackextension*cos(theta_crack);
							x_crack_ghosttip(1,2)=x_crack.center(2,2,ipath)+3*crackextension*sin(theta_crack);
						end
						if tip==1
							x1(1,1)=x_crack.center(icrackparticle,1,ipath);
							x1(1,2)=x_crack.center(icrackparticle,2,ipath);
						elseif tip==2
							x1(1,1)=x_crack.center(2,1,ipath);
							x1(1,2)=x_crack.center(2,2,ipath);
						end
						x2(1,1)=x_crack_ghosttip(1,1);
						x2(1,2)=x_crack_ghosttip(1,2);

						foundcrossing.ipath3=zeros(1,200); %so not clash with ipath
						foundcrossing.icrackparticle3=zeros(1,200); %so not to clash with iparticle
						foundcrossing.ratio=zeros(1,200); %at which point where crossing happens?
						foundcrossing.size3=zeros(1,1); %how many found? %again size3 so to not clash with regular size, perhaps.
						
						for ipath2=1:x_crack.npaths
							for icrackparticle2=1:(x_crack.nparticles(ipath2)-1)
								if ipath2==ipath
									%icrackparticle: deals with the propagation, what's currently the particle as the tip
									%icrackparticle2: the loop for checking crack crossing
									if tip==1 && icrackparticle2>=icrackparticle-2
										continue;
									elseif tip==2 && icrackparticle2<=2
										continue;
                                    end
                                end
                                %start of crossing checks
                                for dim=1:2
                                    x3(1,dim)=x_crack.center(icrackparticle2,dim,ipath2);
                                    x4(1,dim)=x_crack.center(icrackparticle2+1,dim,ipath2);
                                end
                                Area(1)=TriangleArea(x1,x2,x3);
                                Area(2)=TriangleArea(x1,x2,x4);
                                Area(3)=TriangleArea(x3,x4,x1);
                                Area(4)=TriangleArea(x3,x4,x2);
                                if (Area(1)<0 && Area(2)>=0 && Area(3)>=0 && Area(4)<0) || (Area(1)>=0 && Area(2)<0 && Area(3)<0 && Area(4)>=0)
                                    foundcrossing.size3=foundcrossing.size3+1;
                                    foundcrossing.ipath3(foundcrossing.size3)=ipath2;
                                    foundcrossing.icrackparticle3(foundcrossing.size3)=icrackparticle2;
                                    foundcrossing.ratio(foundcrossing.size3)=abs(Area(3))/(abs(Area(3))+abs(Area(4)));%ratio between 1-crossing distance to 1-2 distance
                                end
                                %end of crossing checks
							end
						end
						foundcrossing_ratio_min=2;
						for ifoundcrossing=1:foundcrossing.size3
							if foundcrossing.ratio(ifoundcrossing)<foundcrossing_ratio_min
								foundcrossing_ratio_min=foundcrossing.ratio(ifoundcrossing);
								x_crack.sequence.merge(ipath,tip)=foundcrossing.ipath3(ifoundcrossing);
							end
						end
						if foundcrossing.size3>0
							x_crack.terminatedprop(ipath,tip)=1;
							if tip==1
								x_crack.center(icrackparticle+1,1,ipath)=x_crack.center(icrackparticle,1,ipath)+foundcrossing_ratio_min*3.1*crackextension*cos(theta_crack);
								x_crack.top(icrackparticle+1,1,ipath)=x_crack.center(icrackparticle+1,1,ipath);
								x_crack.bot(icrackparticle+1,1,ipath)=x_crack.center(icrackparticle+1,1,ipath);
								x_crack.center(icrackparticle+1,2,ipath)=x_crack.center(icrackparticle,2,ipath)+foundcrossing_ratio_min*3.1*crackextension*sin(theta_crack);
								x_crack.top(icrackparticle+1,2,ipath)=x_crack.center(icrackparticle+1,2,ipath);
								x_crack.bot(icrackparticle+1,2,ipath)=x_crack.center(icrackparticle+1,2,ipath);
							elseif tip==2
								x_crack.center(1,1,ipath)=x_crack.center(2,1,ipath)+foundcrossing_ratio_min*3.1*crackextension*cos(theta_crack);
								x_crack.top(1,1,ipath)=x_crack.center(1,1,ipath);
								x_crack.bot(1,1,ipath)=x_crack.center(1,1,ipath);
								x_crack.center(1,2,ipath)=x_crack.center(2,2,ipath)+foundcrossing_ratio_min*3.1*crackextension*sin(theta_crack);
								x_crack.top(1,2,ipath)=x_crack.center(1,2,ipath);
								x_crack.bot(1,2,ipath)=x_crack.center(1,2,ipath);
							end
						end
						x_crack.nparticles(ipath)=x_crack.nparticles(ipath)+1;
					end
				end
			end
		end
		
		
		%initiation starts below
		justcrackednodes=zeros(1,no);
		crackanglenodes=zeros(1,no);
		nfield=fieldnumber;
		mi_base=m_sp(1)*4;
		%steelstrength=0.25; %define custom streel strength initiation here
		% steel strength already defined in propagation "subroutine"
		sigmamaxprincmaxperfy=0; %max of all nodes
		steelstrength=steelstrengthbase;
		if CasetoRun==186 || CasetoRun==193 || CasetoRun==194 || CasetoRun==192
			%initiation denied
			steelstrength=1e99;
			steelstrengthbase=1e99;
		end
		for io=1:no
			if uncrackable_si(io,1)>0.125
				continue;
			end
			if CasetoRun==174
				if nmass_si(io,1)>0
					steelstrength=steelstrengthbase*(mEfactor_si(io,1)/nmass_si(io,1));
				else
					steelstrength=steelstrengthbase;
				end
			end
			%steelstrength=steelstrengthbase; %turned off for now
			
			for ifield=1:1
				sigmamaxprinc=(s_si(io,1,ifield)+s_si(io,2,ifield))/2+sqrt(((s_si(io,1,ifield)-s_si(io,2,ifield))/2)^2+(s_si(io,3,ifield))^2);
				sigmamaxprincmaxperfy=max(sigmamaxprincmaxperfy,sigmamaxprinc/steelstrength);
				if sigmamaxprinc>k_dumpresult*steelstrength
					dumpresult=1;
				end
				if nmass_si(io,1)>=0.125*mi_base && sigmamaxprinc>steelstrength %nmass treshold so crack doesnt initiate in thin air
					justcrackednodes(io)=1;
					crackanglenodes(io)=0.5*(pi-reliableatan((s_si(io,1,ifield)-s_si(io,2,ifield))/2,-s_si(io,3,ifield)));
				end
			end
		end
		fprintf('%s',['marker #643b' char(10)]);
		if sum(justcrackednodes)>0
			justcrackedlist=zeros(sum(justcrackednodes),1);
			justcrackedcounter=0;
			for io=1:no
				if justcrackednodes(io)
					justcrackedcounter=justcrackedcounter+1;
					justcrackedlist(justcrackedcounter)=io;
				end
			end
			
			%justcrackedlist=CrackParticleClustering_nodes(LOC,1.5*le(1),justcrackedlist);
			fprintf('%s',['marker #702' char(10)]);
			%ntestedangle=size(Qacoustic{justcrackedlist{1}(1)},3);
			ntestedangle=36;
			fprintf('%s',['marker #703' char(10)]);
			theta=zeros(ntestedangle,1);
			fprintf('%s',['marker #704' char(10)]);
			errorntestedangle=36*1*1*1;
			error=zeros(1,errorntestedangle);
			
			x_justcrackedcenter=zeros(2,1);
			for iro=1:length(justcrackedlist)
				%justcrackedcounter=length(justcrackedlist{iro});	
				x_justcrackedcenter(1)=LOC(justcrackedlist(iro),1);
				x_justcrackedcenter(2)=LOC(justcrackedlist(iro),2);
				%x_justcrackedcenter(1)=sum(LOC(justcrackedlist{iro},1))/justcrackedcounter;
				%x_justcrackedcenter(2)=sum(LOC(justcrackedlist{iro},2))/justcrackedcounter;
				%{
				for i=1:errorntestedangle
					theta(i)=(i-1)/36*1*1*1*pi;
					error(i)=0;
					for spc=1:justcrackedcounter
						error(i)=error(i)+(mod(thetacrack(justcrackedlist{iro}(spc))-theta(i)+pi/2,pi)-pi/2)^2;
					end
				end
				%}
				thetajustcrackedcenter=crackanglenodes(justcrackedlist(iro));
				%thetajustcrackedcenter=theta(FindMin(error));
				%considered=ones(x_crack.npaths,2);
				%distancelist=zeros(x_crack.npaths,2);
				%thetapropagationlist=zeros(x_crack.npaths,2);
				%n_nairncrack0=0;
				%n_nairncrack1=0;
				
				intheprevention=0;
				preventiondistance=1.5*le(1);
				preventionangle=pi/4;
				for icrackpath=1:x_crack.npaths;
					for spcrack=1:(x_crack.nparticles(icrackpath)-1)
						vector1a=[(x_justcrackedcenter(1)-x_crack.center(spcrack,1,icrackpath));(x_justcrackedcenter(2)-x_crack.center(spcrack,2,icrackpath))];
						vector1b=[(x_justcrackedcenter(1)-x_crack.center(spcrack+1,1,icrackpath));(x_justcrackedcenter(2)-x_crack.center(spcrack+1,2,icrackpath))];
						distance1a=sqrt(dot(vector1a,vector1a));
						distance1b=sqrt(dot(vector1b,vector1b));
						
						distance1a_old=sqrt((x_justcrackedcenter(1)-x_crack.center(spcrack,1,icrackpath))^2+(x_justcrackedcenter(2)-x_crack.center(spcrack,2,icrackpath))^2);
						distance1b_old=sqrt((x_justcrackedcenter(1)-x_crack.center(spcrack+1,1,icrackpath))^2+(x_justcrackedcenter(2)-x_crack.center(spcrack+1,2,icrackpath))^2);
						
						distance1=min([distance1a distance1b]);
						
						area2=abs(TriangleArea(x_justcrackedcenter,x_crack.center(spcrack,:,icrackpath),x_crack.center(spcrack+1,:,icrackpath)));
						
						inbetween2vector=[(x_crack.center(spcrack+1,1,icrackpath)-x_crack.center(spcrack,1,icrackpath));(x_crack.center(spcrack+1,2,icrackpath)-x_crack.center(spcrack,2,icrackpath))];
						
						inbetween2=sqrt(dot(inbetween2vector,inbetween2vector));
						
						inbetween2_old=sqrt((x_crack.center(spcrack+1,1,icrackpath)-x_crack.center(spcrack,1,icrackpath))^2+(x_crack.center(spcrack+1,2,icrackpath)-x_crack.center(spcrack,2,icrackpath))^2);
						distance2=area2/inbetween2;
						
						signcos1=dot(vector1a,inbetween2vector);
						signcos2=dot(vector1b,inbetween2vector);
						
						if signcos1*signcos2>0
							distance=distance1;
						else
							distance=distance2;
						end
						
						if distance<preventiondistance
							thetanairncrack=reliableatan(x_crack.center(spcrack+1,1,icrackpath)-x_crack.center(spcrack,1,icrackpath),x_crack.center(spcrack+1,2,icrackpath)-x_crack.center(spcrack,2,icrackpath));
							
							absdeltatheta=abs(mod(thetanairncrack-thetajustcrackedcenter+pi/2,pi)-pi/2);
							
							if absdeltatheta<preventionangle
								intheprevention=1;
							end
						end
						if intheprevention==1
							break;
						end
					end
					if intheprevention==1
						break;
					end
				end
				if intheprevention==0
					thetainitiate=mod(thetajustcrackedcenter-pi,pi)+pi; %always pointing down, pi<theta<2*pi
					icrackpath=x_crack.npaths+1;
					x_crack.npaths=x_crack.npaths+1;
					if CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==194
						x_crack.nparticles(icrackpath)=3;
						x_crack.center(3,2,icrackpath)=x_justcrackedcenter(2)+le(1)/2*sin(thetainitiate); %assuming le(1)=le(2);
						x_crack.center(3,1,icrackpath)=x_justcrackedcenter(1)+le(1)/2*cos(thetainitiate);
						x_crack.center(1,2,icrackpath)=x_justcrackedcenter(2)-le(1)/2*sin(thetainitiate);
						x_crack.center(1,1,icrackpath)=x_justcrackedcenter(1)-le(1)/2*cos(thetainitiate);
						x_crack.center(2,2,icrackpath)=x_justcrackedcenter(2);
						x_crack.center(2,1,icrackpath)=x_justcrackedcenter(1);
						x_crack.cohesivepath(icrackpath)=1;
						x_crack.cohesivepoint(1,icrackpath)=1;
						x_crack.cohesivepoint(2,icrackpath)=1;
						x_crack.cohesivepoint(3,icrackpath)=1;
					else
						x_crack.nparticles(icrackpath)=2;
						x_crack.center(2,2,icrackpath)=x_justcrackedcenter(2)+le(1)/2*sin(thetainitiate); %assuming le(1)=le(2);
						x_crack.center(2,1,icrackpath)=x_justcrackedcenter(1)+le(1)/2*cos(thetainitiate);
						x_crack.center(1,2,icrackpath)=x_justcrackedcenter(2)-le(1)/2*sin(thetainitiate);
						x_crack.center(1,1,icrackpath)=x_justcrackedcenter(1)-le(1)/2*cos(thetainitiate);
					end
					%fprintf('%s',['>>line 8967: size(x_crack' int2txt(icrackpath) '},1)=' int2txt(x_crack.nparticles(icrackpath)) char(10)]);
					%fprintf('%s',['>>line 8968: size(x_cracktop{' int2txt(icrackpath) '},1)=' int2txt(size(x_cracktop{icrackpath},1)) char(10)]);
					%{
					for i=1:size(x_cracktop{icrackpath},1)
						for j=1:size(x_cracktop{icrackpath},2)
							%fprintf('%s',['>>line 8973: x_cracktop{' int2txt(icrackpath) '}(' int2txt(i) ',' int2txt(j) ')=' float2txt(5,x_cracktop{icrackpath}(i,j)) char(10)]);
						end
					end
					for i=1:size(x_crackbot{icrackpath},1)
						for j=1:size(x_crackbot{icrackpath},2)
							%fprintf('%s',['>>line 8980: x_crackbot{' int2txt(icrackpath) '}(' int2txt(i) ',' int2txt(j) ')=' float2txt(5,x_crackbot{icrackpath}(i,j)) char(10)]);
						end
					end
					for i=1:size(x_crack{icrackpath},1)
						for j=1:size(x_crack{icrackpath},2)
							%fprintf('%s',['>>line 8987: x_crack{' int2txt(icrackpath) '}(' int2txt(i) ',' int2txt(j) ')=' float2txt(5,x_crack{icrackpath}(i,j)) char(10)]);
						end
					end
					%}
					for i=1:x_crack.nparticles(icrackpath)
						for j=1:2
							%fprintf('%s',['>>line 8973: x_crack{' int2txt(icrackpath) '}(' int2txt(i) ',' int2txt(j) ')=' float2txt(5,x_crack{icrackpath}(i,j)) char(10)]);
							x_crack.top(i,j,icrackpath)=x_crack.center(i,j,icrackpath);
							x_crack.bot(i,j,icrackpath)=x_crack.center(i,j,icrackpath);
						end
					end
					%shit below
					%x_cracktop{icrackpath}=x_crack{icrackpath};
					%x_crackbot{icrackpath}=x_crack{icrackpath};
					%shit above
				end
				%soundplay
				1;
			end
		end
	elseif CasetoRun==151 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==139 || CasetoRun==118 || CasetoRun==173
		%crack propagation of 139
		%propagation denied for this
		%node centric propagation
		%no gauss propagation
		%currently propagation only
		no=niCount;
		%s_tip(ipath,dim,itip);
		s_tip=zeros(x_crack.npaths,3,2);
		s_tip_K1=zeros(x_crack.npaths,3,2); %ncrackpaths; dimension (x and y); which tip
		deltax_previous=zeros(1,2,1);
		theta_crack_trial=zeros(1,2);
		deltatheta_crack=zeros(1,2);
		s_tip_dump=zeros(2*x_crack.npaths,3);
		d_tip_dump=zeros(2*x_crack.npaths,8);
		d_LOC_tip_dump=zeros(2*x_crack.npaths,8);
		s_tip_K1_dump=zeros(2*x_crack.npaths,3);
		u_tip_dump=zeros(2*x_crack.npaths,8);
		x_tip_dump=zeros(2*x_crack.npaths,2);
		r_propdirweighted_dump=zeros(2*x_crack.npaths,2);
		K1_maxradius=3*le(1);
		K1_estimate=zeros(1,2);
		K1_distance=zeros(1,2);
		r_propdirweighted=zeros(x_crack.npaths,2,2); %crackpath num, dimension, which tip
		sigma_maxprinc_magnitude=0;
		r_propdircompliment=zeros(1,2);
		a_transform=zeros(2,2);
		s_tip_tensor=zeros(2,2);
		s_tip_tensor_transformed=zeros(2,2);
		LOC_avg=zeros(1,2);
		nio_designator=zeros(1,4);
		d_natural=zeros(8,1);
		delta_x=zeros(1,2);
		epsilon_tip=zeros(3,1);
		x_crack_ghosttip=zeros(1,2);
		x1=zeros(1,2);
		x2=zeros(1,2);
		x3=zeros(1,2);
		x4=zeros(1,2);
		Area=zeros(1,4);
		foundcrossing.ipath3=zeros(1,200); %so not clash with ipath
		foundcrossing.icrackparticle3=zeros(1,200); %so not to clash with iparticle
		foundcrossing.ratio=zeros(1,200); %at which point where crossing happens?
		foundcrossing.size3=zeros(1,1); %how many found? %again size3 so to not clash with regular size, perhaps.
		%nio_designator(1): in the natural coordinates, node 1 associates with which nio?
		%nio_designator(2): in the natural coordinates, node 2 associates with which nio?
		%nio_designator(3): in the natural coordinates, node 3 associates with which nio?
		%nio_designator(4): in the natural coordinates, node 4 associates with which nio?
		
		io_natural_cross_before=0;
		io_natural_cross_after=0;
		io_natural_sides=zeros(1,4);
		sigmamaxprincmaxperfy=0;
        
        %r_propdirweighted=zeros(1,2); %dimension only
		%allowpropagation=1;
		for tip=1:2
			%tip=1: particle of highest index
			%tip=2: particle of lowerst index
			for ipath=1:x_crack.npaths
				if x_crack.terminatedprop(ipath,tip)==0
					if tip==1
						icrackparticle=x_crack.nparticles(ipath);
					elseif tip==2
						icrackparticle=1;
					end
					LOC_avg=zeros(1,2);
					for nio=1:4
						io=CONNECT_crack.center.values(icrackparticle,nio,ipath);
						for dim=1:2
							LOC_avg(1,dim)=LOC_avg(1,dim)+LOC(io,dim);
						end
					end
					for dim=1:2
						LOC_avg(1,dim)=LOC_avg(1,dim)/4;
					end
					for nio=1:4
						io=CONNECT_crack.center.values(icrackparticle,nio,ipath);
						if LOC(io,1)<LOC_avg(1,1)
							if LOC(io,2)<LOC_avg(1,2)
								nio_designator(1)=nio;
							elseif LOC(io,2)>LOC_avg(1,2) %can just write else, but this way it's more readable. also equal is not possible, so I left it out
								nio_designator(4)=nio;
							end
						elseif LOC(io,1)>LOC_avg(1,1) %same drill, trying to improve readability
							if LOC(io,2)<LOC_avg(1,2)
								nio_designator(2)=nio;
							elseif LOC(io,2)>LOC_avg(1,2)
								nio_designator(3)=nio;
							end
						end
					end
					%allowpropagation=1;
					tip_crackability=0;
					for io_natural=1:4
						nio_outside=nio_designator(io_natural);
						io=CONNECT_crack.center.values(icrackparticle,nio_outside,ipath);
						tip_crackability=tip_crackability+uncrackable_si_comb(io)*N_crack.center(1,nio_outside,icrackparticle,ipath);
					end
					%finding where the crack cuts the cell
					for itrial=1:x_crack.nparticles(ipath)-1
						io_natural_cross_before=0;
						io_natural_cross_after=0;
						io_natural_sides=zeros(1,4);
						if tip==1
							x1(1,1)=x_crack.center(icrackparticle-(itrial-1),1,ipath);
							x1(1,2)=x_crack.center(icrackparticle-(itrial-1),2,ipath);
							x2(1,1)=x_crack.center(icrackparticle-itrial,1,ipath);
							x2(1,2)=x_crack.center(icrackparticle-itrial,2,ipath);
						elseif tip==2
							x1(1,1)=x_crack.center(1+(itrial-1),1,ipath);
							x1(1,2)=x_crack.center(1+(itrial-1),2,ipath);
							x2(1,1)=x_crack.center(1+itrial,1,ipath);
							x2(1,2)=x_crack.center(1+itrial,2,ipath);
						end
											
						for io_natural=1:4
							nio_outside=nio_designator(io_natural);
							io=CONNECT_crack.center.values(icrackparticle,nio_outside,ipath);
							x3(1,1)=LOC(io,1);
							x3(1,2)=LOC(io,2);
							nio_outside=nio_designator(mod(io_natural+1-1,4)+1);
							io=CONNECT_crack.center.values(icrackparticle,nio_outside,ipath);
							x4(1,1)=LOC(io,1);
							x4(1,2)=LOC(io,2);
							Area(1)=TriangleArea(x1,x2,x3);
							Area(2)=TriangleArea(x1,x2,x4);
							Area(3)=TriangleArea(x3,x4,x1);
							Area(4)=TriangleArea(x3,x4,x2);
							if (Area(1)<0 && Area(2)>=0 && Area(3)>=0 && Area(4)<0) || (Area(1)>=0 && Area(2)<0 && Area(3)<0 && Area(4)>=0)
								%before and before-1: top(2) for tip==1, bottom(3) for tip==2
								%after and after+1: bottom(3) for tip==1, top(2) for tip==1
								io_natural_cross_before=io_natural;
								if tip==1
									io_natural_sides(io_natural_cross_before)=2;
									io_natural_sides(mod(io_natural_cross_before-1-1,4)+1)=2;
								elseif tip==2
									io_natural_sides(io_natural_cross_before)=3;
									io_natural_sides(mod(io_natural_cross_before-1-1,4)+1)=3;
								end
								
								io_natural_cross_after=mod(io_natural+1-1,4)+1;
								if tip==1
									io_natural_sides(io_natural_cross_after)=3;							
									io_natural_sides(mod(io_natural_cross_after+1-1,4)+1)=3;
								elseif tip==2
									io_natural_sides(io_natural_cross_after)=2;
									io_natural_sides(mod(io_natural_cross_after+1-1,4)+1)=2;
								end
								break;
							end
						end
						if io_natural_cross_before>0
							break;
						end
					end
					for io_natural=1:4
						nio_outside=nio_designator(io_natural);
						io=CONNECT_crack.center.values(icrackparticle,nio_outside,ipath);
						for dim=1:2
							index=2*(io_natural-1)+dim;
                            if io_natural_sides(io_natural)==2
                                d_natural(index,1)=u_si(io,dim,TheFieldSplit_cracktop{ipath}(nio_outside,icrackparticle));
                            elseif io_natural_sides(io_natural)==3
                                d_natural(index,1)=u_si(io,dim,TheFieldSplit_crackbot{ipath}(nio_outside,icrackparticle));
                            else
                                d_natural(index,1)=u_si_comb(io,dim);
                            end
						end
						%if uncrackable_si_comb(io)>0.25
						if tip_crackability>0.125
							x_crack.terminatedprop(ipath,tip)=1;
							break;
						elseif sum(nmass_si(io,:))<=0
							%allowpropagation=0;
							x_crack.terminatedprop(ipath,tip)=1;
							if tip==1
								deltax_previous=x_crack.center(icrackparticle,:,ipath)-x_crack.center(icrackparticle-1,:,ipath);
							elseif tip==2
								deltax_previous=x_crack.center(1,:,ipath)-x_crack.center(1+1,:,ipath);
							end							
							if tip==1
								x_crack.center(icrackparticle+1,1,ipath)=x_crack.center(icrackparticle,1,ipath)+deltax_previous(1);
								x_crack.top(icrackparticle+1,1,ipath)=x_crack.center(icrackparticle+1,1,ipath);
								x_crack.bot(icrackparticle+1,1,ipath)=x_crack.center(icrackparticle+1,1,ipath);
								x_crack.center(icrackparticle+1,2,ipath)=x_crack.center(icrackparticle,2,ipath)+deltax_previous(2);
								x_crack.top(icrackparticle+1,2,ipath)=x_crack.center(icrackparticle+1,2,ipath);
								x_crack.bot(icrackparticle+1,2,ipath)=x_crack.center(icrackparticle+1,2,ipath);
							elseif tip==2
								for icrackparticlemove=x_crack.nparticles(ipath):-1:1
									for dim=1:2
										x_crack.center(icrackparticlemove+1,dim,ipath)=x_crack.center(icrackparticlemove,dim,ipath);
										x_crack.top(icrackparticlemove+1,dim,ipath)=x_crack.top(icrackparticlemove,dim,ipath);
										x_crack.bot(icrackparticlemove+1,dim,ipath)=x_crack.bot(icrackparticlemove,dim,ipath);
									end
								end
								x_crack.center(1,1,ipath)=x_crack.center(2,1,ipath)+deltax_previous(1);
								x_crack.top(1,1,ipath)=x_crack.center(1,1,ipath);
								x_crack.bot(1,1,ipath)=x_crack.center(1,1,ipath);
								x_crack.center(1,2,ipath)=x_crack.center(2,2,ipath)+deltax_previous(2);
								x_crack.top(1,2,ipath)=x_crack.center(1,2,ipath);
								x_crack.bot(1,2,ipath)=x_crack.center(1,2,ipath);
							end
                            x_crack.nparticles(ipath)=x_crack.nparticles(ipath)+1;
							break;
						end
					end
					
					a=le(1)/2;
					b=le(2)/2;
					
					for dim=1:2
						delta_x(dim)=x_crack.center(icrackparticle,dim,ipath)-LOC_avg(1,dim);
					end
					
					xi=delta_x(1)/a;
					eta=delta_x(2)/b;
					
					B=1/4*[(-1+eta)/a 0 (1-eta)/a 0 (1+eta)/a 0 (-1-eta)/a 0;
							0 (-1+xi)/b 0 (-1-xi)/b 0 (1+xi)/b 0 (1-xi)/b;
							(-1+xi)/b (-1+eta)/a (-1-xi)/b (1-eta)/a (1+xi)/b (1+eta)/a (1-xi)/b (-1-eta)/a];
					
					epsilon_tip=B*d_natural;
					%tempmarker5

					D=E/((1+nu)*(1-2*nu))*[1-nu nu 0;nu 1-nu 0;0 0 (1-2*nu)];
					
					s_tip_temp=D*epsilon_tip;
					
					for dim=1:3
						s_tip(ipath,dim,tip)=s_tip_temp(dim,1);
					end
					for dim=1:3
						s_tip_dump(2*(ipath-1)+tip,dim)=s_tip(ipath,dim,tip);
						s_tip_K1_dump(2*(ipath-1)+tip,dim)=s_tip_K1(ipath,dim,tip);
					end
					for dim=1:8
						d_tip_dump(2*(ipath-1)+tip,dim)=d_natural(dim,1);
						io_natural=ceil(dim/2);
						xydim=mod(dim-1,2)+1;
						d_LOC_tip_dump(2*(ipath-1)+tip,dim)=LOC(CONNECT_crack.center.values(icrackparticle,nio_designator(io_natural),ipath),xydim);;
					end
					for dim=1:2
						x_tip_dump(2*(ipath-1)+tip,dim)=x_crack.center(icrackparticle,dim,ipath);
					end
					s_tip_max=(s_tip(ipath,1,tip)+s_tip(ipath,2,tip))/2+sqrt( ((s_tip(ipath,1,tip)-s_tip(ipath,2,tip))/2)^2 + (s_tip(ipath,3,tip))^2 ); %calculate principal stress
					
					steelstrength=0.125; %to stop coder whining
					if CasetoRun==139 || CasetoRun==140 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142
						steelstrength=0.125;
						k_dumpresult=0.999;
					elseif CasetoRun==136
						steelstrength=0.00125;
						k_dumpresult=0.999;
					elseif CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165
						steelstrength=0.0125;
						k_dumpresult=0.995;
					elseif CasetoRun==184
						steelstrength=1e10; %cracking denied
						k_dumpresult=0.99;
					elseif CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==147 || CasetoRun==145
						steelstrength=999999999;
						k_dumpresult=0.995;
					elseif CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161
						steelstrength=0.25;
						k_dumpresult=0.7;
					end
					if s_tip_max>k_dumpresult*steelstrength
						dumpresult=1;
					end
					x_crack.tipcrackratio(ipath,tip)=s_tip_max/steelstrength;
					sigmamaxprincmaxperfy=max(sigmamaxprincmaxperfy,s_tip_max/steelstrength);
					if x_crack.terminatedprop(ipath,tip)==0 && s_tip_max>steelstrength
					%if s_tip_max>steelstrength
						if ipath==1 && x_crack.nparticles(ipath)>=10
							1;
						end
						theta_crack=0.5*(pi-reliableatan((s_tip(ipath,1,tip)-s_tip(ipath,2,tip))/2,-s_tip(ipath,3,tip)));
						crackextension=le(1)/2;
						if tip==1
							deltax_previous=x_crack.center(icrackparticle,:,ipath)-x_crack.center(icrackparticle-1,:,ipath);
						elseif tip==2
							deltax_previous=x_crack.center(1,:,ipath)-x_crack.center(1+1,:,ipath);
						end
						%theta_previous=reliableatan(deltax_previous(1,1,1),deltax_previous(1,2,1));
						theta_crack_trial(1)=theta_crack;
						theta_crack_trial(2)=mod(theta_crack+pi,2*pi); %two possibilities for crack angle, 
						if (deltax_previous(1,1,1)*cos(theta_crack_trial(1))+deltax_previous(1,2,1)*sin(theta_crack_trial(1)))>0 % cos of theta_crack_trial with current crack tip trajectory
							theta_crack=theta_crack_trial(1);
						else
							theta_crack=theta_crack_trial(2);
						end
						if tip==1
							x_crack.center(icrackparticle+1,1,ipath)=x_crack.center(icrackparticle,1,ipath)+crackextension*cos(theta_crack);
							x_crack.top(icrackparticle+1,1,ipath)=x_crack.center(icrackparticle+1,1,ipath);
							x_crack.bot(icrackparticle+1,1,ipath)=x_crack.center(icrackparticle+1,1,ipath);
							x_crack.center(icrackparticle+1,2,ipath)=x_crack.center(icrackparticle,2,ipath)+crackextension*sin(theta_crack);
							x_crack.top(icrackparticle+1,2,ipath)=x_crack.center(icrackparticle+1,2,ipath);
							x_crack.bot(icrackparticle+1,2,ipath)=x_crack.center(icrackparticle+1,2,ipath);
							x_crack_ghosttip(1,1)=x_crack.center(icrackparticle,1,ipath)+3*crackextension*cos(theta_crack);
							x_crack_ghosttip(1,2)=x_crack.center(icrackparticle,2,ipath)+3*crackextension*sin(theta_crack);
						elseif tip==2
							for icrackparticlemove=x_crack.nparticles(ipath):-1:1
								for dim=1:2
									x_crack.center(icrackparticlemove+1,dim,ipath)=x_crack.center(icrackparticlemove,dim,ipath);
									x_crack.top(icrackparticlemove+1,dim,ipath)=x_crack.top(icrackparticlemove,dim,ipath);
									x_crack.bot(icrackparticlemove+1,dim,ipath)=x_crack.bot(icrackparticlemove,dim,ipath);
								end
							end
							x_crack.center(1,1,ipath)=x_crack.center(2,1,ipath)+crackextension*cos(theta_crack);
							x_crack.top(1,1,ipath)=x_crack.center(1,1,ipath);
							x_crack.bot(1,1,ipath)=x_crack.center(1,1,ipath);
							x_crack.center(1,2,ipath)=x_crack.center(2,2,ipath)+crackextension*sin(theta_crack);
							x_crack.top(1,2,ipath)=x_crack.center(1,2,ipath);
							x_crack.bot(1,2,ipath)=x_crack.center(1,2,ipath);
							x_crack_ghosttip(1,1)=x_crack.center(2,1,ipath)+3*crackextension*cos(theta_crack);
							x_crack_ghosttip(1,2)=x_crack.center(2,2,ipath)+3*crackextension*sin(theta_crack);
						end
						if tip==1
							x1(1,1)=x_crack.center(icrackparticle,1,ipath);
							x1(1,2)=x_crack.center(icrackparticle,2,ipath);
						elseif tip==2
							x1(1,1)=x_crack.center(2,1,ipath);
							x1(1,2)=x_crack.center(2,2,ipath);
						end
						x2(1,1)=x_crack_ghosttip(1,1);
						x2(1,2)=x_crack_ghosttip(1,2);

						foundcrossing.ipath3=zeros(1,200); %so not clash with ipath
						foundcrossing.icrackparticle3=zeros(1,200); %so not to clash with iparticle
						foundcrossing.ratio=zeros(1,200); %at which point where crossing happens?
						foundcrossing.size3=zeros(1,1); %how many found? %again size3 so to not clash with regular size, perhaps.

						for ipath2=1:x_crack.npaths
							for icrackparticle2=1:(x_crack.nparticles(ipath2)-1)
								if ipath2==ipath
									%icrackparticle: deals with the propagation, what's currently the particle as the tip
									%icrackparticle2: the loop for checking crack crossing
									if tip==1 && icrackparticle2>=icrackparticle-2
										continue;
									elseif tip==2 && icrackparticle2<=2
										continue;
                                    end
                                end
                                %start of crossing checks
                                for dim=1:2
                                    x3(1,dim)=x_crack.center(icrackparticle2,dim,ipath2);
                                    x4(1,dim)=x_crack.center(icrackparticle2+1,dim,ipath2);
                                end
                                Area(1)=TriangleArea(x1,x2,x3);
                                Area(2)=TriangleArea(x1,x2,x4);
                                Area(3)=TriangleArea(x3,x4,x1);
                                Area(4)=TriangleArea(x3,x4,x2);
                                if (Area(1)<0 && Area(2)>=0 && Area(3)>=0 && Area(4)<0) || (Area(1)>=0 && Area(2)<0 && Area(3)<0 && Area(4)>=0)
                                    foundcrossing.size3=foundcrossing.size3+1;
                                    foundcrossing.ipath3(foundcrossing.size3)=ipath2;
                                    foundcrossing.icrackparticle3(foundcrossing.size3)=icrackparticle2;
                                    foundcrossing.ratio(foundcrossing.size3)=abs(Area(3))/(abs(Area(3))+abs(Area(4)));%ratio between 1-crossing distance to 1-2 distance
                                end
                                %end of crossing checks
							end
						end
						foundcrossing_ratio_min=2;
						for ifoundcrossing=1:foundcrossing.size3
							if foundcrossing.ratio(ifoundcrossing)<foundcrossing_ratio_min
								foundcrossing_ratio_min=foundcrossing.ratio(ifoundcrossing);
							end
						end
						if foundcrossing.size3>0
							x_crack.terminatedprop(ipath,tip)=1;
							if tip==1
								x_crack.center(icrackparticle+1,1,ipath)=x_crack.center(icrackparticle,1,ipath)+foundcrossing_ratio_min*3.1*crackextension*cos(theta_crack);
								x_crack.top(icrackparticle+1,1,ipath)=x_crack.center(icrackparticle+1,1,ipath);
								x_crack.bot(icrackparticle+1,1,ipath)=x_crack.center(icrackparticle+1,1,ipath);
								x_crack.center(icrackparticle+1,2,ipath)=x_crack.center(icrackparticle,2,ipath)+foundcrossing_ratio_min*3.1*crackextension*sin(theta_crack);
								x_crack.top(icrackparticle+1,2,ipath)=x_crack.center(icrackparticle+1,2,ipath);
								x_crack.bot(icrackparticle+1,2,ipath)=x_crack.center(icrackparticle+1,2,ipath);
							elseif tip==2
								x_crack.center(1,1,ipath)=x_crack.center(2,1,ipath)+foundcrossing_ratio_min*3.1*crackextension*cos(theta_crack);
								x_crack.top(1,1,ipath)=x_crack.center(1,1,ipath);
								x_crack.bot(1,1,ipath)=x_crack.center(1,1,ipath);
								x_crack.center(1,2,ipath)=x_crack.center(2,2,ipath)+foundcrossing_ratio_min*3.1*crackextension*sin(theta_crack);
								x_crack.top(1,2,ipath)=x_crack.center(1,2,ipath);
								x_crack.bot(1,2,ipath)=x_crack.center(1,2,ipath);
							end
						end
						x_crack.nparticles(ipath)=x_crack.nparticles(ipath)+1;
					end
				end
			end
		end
	elseif CasetoRun==124
		%crack propagation of 124
		%propagation denied for this
		%node centric propagation
		%no gauss propagation
		%currently propagation only
		no=niCount;
		%s_tip(ipath,dim,itip);
		s_tip=zeros(x_crack.npaths,3,2);
		s_tip_K1=zeros(x_crack.npaths,3,2); %ncrackpaths; dimension (x and y); which tip
		deltax_previous=zeros(1,2,1);
		theta_crack_trial=zeros(1,2);
		deltatheta_crack=zeros(1,2);
		s_tip_dump=zeros(2*x_crack.npaths,3);
		d_tip_dump=zeros(2*x_crack.npaths,8);
		d_LOC_tip_dump=zeros(2*x_crack.npaths,8);
		s_tip_K1_dump=zeros(2*x_crack.npaths,3);
		u_tip_dump=zeros(2*x_crack.npaths,8);
		x_tip_dump=zeros(2*x_crack.npaths,2);
		r_propdirweighted_dump=zeros(2*x_crack.npaths,2);
		K1_maxradius=3*le(1);
		K1_estimate=zeros(1,2);
		K1_distance=zeros(1,2);
		r_propdirweighted=zeros(x_crack.npaths,2,2); %crackpath num, dimension, which tip
		sigma_maxprinc_magnitude=0;
		r_propdircompliment=zeros(1,2);
		a_transform=zeros(2,2);
		s_tip_tensor=zeros(2,2);
		s_tip_tensor_transformed=zeros(2,2);
		LOC_avg=zeros(1,2);
		nio_designator=zeros(1,4);
		d_natural=zeros(8,1);
		delta_x=zeros(1,2);
		epsilon_tip=zeros(3,1);
		x_crack_ghosttip=zeros(1,2);
		x1=zeros(1,2);
		x2=zeros(1,2);
		x3=zeros(1,2);
		x4=zeros(1,2);
		Area=zeros(1,4);
		foundcrossing.ipath3=zeros(1,200); %so not clash with ipath
		foundcrossing.icrackparticle3=zeros(1,200); %so not to clash with iparticle
		foundcrossing.ratio=zeros(1,200); %at which point where crossing happens?
		foundcrossing.size3=zeros(1,1); %how many found? %again size3 so to not clash with regular size, perhaps.
		%nio_designator(1): in the natural coordinates, node 1 associates with which nio?
		%nio_designator(2): in the natural coordinates, node 2 associates with which nio?
		%nio_designator(3): in the natural coordinates, node 3 associates with which nio?
		%nio_designator(4): in the natural coordinates, node 4 associates with which nio?
		
		io_natural_cross_before=0;
		io_natural_cross_after=0;
		io_natural_sides=zeros(1,4);
        
        %r_propdirweighted=zeros(1,2); %dimension only
		%allowpropagation=1;
		for tip=1:2
			%tip=1: particle of highest index
			%tip=2: particle of lowerst index
			for ipath=1:x_crack.npaths
				if x_crack.terminatedprop(ipath,tip)==0
					if tip==1
						icrackparticle=x_crack.nparticles(ipath);
					elseif tip==2
						icrackparticle=1;
					end
					LOC_avg=zeros(1,2);
					for nio=1:4
						io=CONNECT_crack.center.values(icrackparticle,nio,ipath);
						for dim=1:2
							LOC_avg(1,dim)=LOC_avg(1,dim)+LOC(io,dim);
						end
					end
					for dim=1:2
						LOC_avg(1,dim)=LOC_avg(1,dim)/4;
					end
					for nio=1:4
						io=CONNECT_crack.center.values(icrackparticle,nio,ipath);
						if LOC(io,1)<LOC_avg(1,1)
							if LOC(io,2)<LOC_avg(1,2)
								nio_designator(1)=nio;
							elseif LOC(io,2)>LOC_avg(1,2) %can just write else, but this way it's more readable. also equal is not possible, so I left it out
								nio_designator(4)=nio;
							end
						elseif LOC(io,1)>LOC_avg(1,1) %same drill, trying to improve readability
							if LOC(io,2)<LOC_avg(1,2)
								nio_designator(2)=nio;
							elseif LOC(io,2)>LOC_avg(1,2)
								nio_designator(3)=nio;
							end
						end
					end
					%allowpropagation=1;
					tip_crackability=0;
					for io_natural=1:4
						nio_outside=nio_designator(io_natural);
						io=CONNECT_crack.center.values(icrackparticle,nio_outside,ipath);
						tip_crackability=tip_crackability+uncrackable_si_comb(io)*N_crack.center(1,nio_outside,icrackparticle,ipath);
					end
					%finding where the crack cuts the cell
					for itrial=1:x_crack.nparticles(ipath)-1
						io_natural_cross_before=0;
						io_natural_cross_after=0;
						io_natural_sides=zeros(1,4);
						if tip==1
							x1(1,1)=x_crack.center(icrackparticle-(itrial-1),1,ipath);
							x1(1,2)=x_crack.center(icrackparticle-(itrial-1),2,ipath);
							x2(1,1)=x_crack.center(icrackparticle-itrial,1,ipath);
							x2(1,2)=x_crack.center(icrackparticle-itrial,2,ipath);
						elseif tip==2
							x1(1,1)=x_crack.center(1+(itrial-1),1,ipath);
							x1(1,2)=x_crack.center(1+(itrial-1),2,ipath);
							x2(1,1)=x_crack.center(1+itrial,1,ipath);
							x2(1,2)=x_crack.center(1+itrial,2,ipath);
						end
											
						for io_natural=1:4
							nio_outside=nio_designator(io_natural);
							io=CONNECT_crack.center.values(icrackparticle,nio_outside,ipath);
							x3(1,1)=LOC(io,1);
							x3(1,2)=LOC(io,2);
							nio_outside=nio_designator(mod(io_natural+1-1,4)+1);
							io=CONNECT_crack.center.values(icrackparticle,nio_outside,ipath);
							x4(1,1)=LOC(io,1);
							x4(1,2)=LOC(io,2);
							Area(1)=TriangleArea(x1,x2,x3);
							Area(2)=TriangleArea(x1,x2,x4);
							Area(3)=TriangleArea(x3,x4,x1);
							Area(4)=TriangleArea(x3,x4,x2);
							if (Area(1)<0 && Area(2)>=0 && Area(3)>=0 && Area(4)<0) || (Area(1)>=0 && Area(2)<0 && Area(3)<0 && Area(4)>=0)
								%before and before-1: top(2) for tip==1, bottom(3) for tip==2
								%after and after+1: bottom(3) for tip==1, top(2) for tip==1
								io_natural_cross_before=io_natural;
								if tip==1
									io_natural_sides(io_natural_cross_before)=2;
									io_natural_sides(mod(io_natural_cross_before-1-1,4)+1)=2;
								elseif tip==2
									io_natural_sides(io_natural_cross_before)=3;
									io_natural_sides(mod(io_natural_cross_before-1-1,4)+1)=3;
								end
								
								io_natural_cross_after=mod(io_natural+1-1,4)+1;
								if tip==1
									io_natural_sides(io_natural_cross_after)=3;							
									io_natural_sides(mod(io_natural_cross_after+1-1,4)+1)=3;
								elseif tip==2
									io_natural_sides(io_natural_cross_after)=2;
									io_natural_sides(mod(io_natural_cross_after+1-1,4)+1)=2;
								end
								break;
							end
						end
						if io_natural_cross_before>0
							break;
						end
					end
					for io_natural=1:4
						nio_outside=nio_designator(io_natural);
						io=CONNECT_crack.center.values(icrackparticle,nio_outside,ipath);
						for dim=1:2
							index=2*(io_natural-1)+dim;
                            if io_natural_sides(io_natural)==2
                                d_natural(index,1)=u_si(io,dim,TheFieldSplit_cracktop{ipath}(nio_outside,icrackparticle));
                            elseif io_natural_sides(io_natural)==3
                                d_natural(index,1)=u_si(io,dim,TheFieldSplit_crackbot{ipath}(nio_outside,icrackparticle));
                            else
                                d_natural(index,1)=u_si_comb(io,dim);
                            end
						end
						%if uncrackable_si_comb(io)>0.25
						if tip_crackability>0.125
							x_crack.terminatedprop(ipath,tip)=1;
							break;
						elseif sum(nmass_si(io,:))<=0
							%allowpropagation=0;
							x_crack.terminatedprop(ipath,tip)=1;
							if tip==1
								deltax_previous=x_crack.center(icrackparticle,:,ipath)-x_crack.center(icrackparticle-1,:,ipath);
							elseif tip==2
								deltax_previous=x_crack.center(1,:,ipath)-x_crack.center(1+1,:,ipath);
							end							
							if tip==1
								x_crack.center(icrackparticle+1,1,ipath)=x_crack.center(icrackparticle,1,ipath)+deltax_previous(1);
								x_crack.top(icrackparticle+1,1,ipath)=x_crack.center(icrackparticle+1,1,ipath);
								x_crack.bot(icrackparticle+1,1,ipath)=x_crack.center(icrackparticle+1,1,ipath);
								x_crack.center(icrackparticle+1,2,ipath)=x_crack.center(icrackparticle,2,ipath)+deltax_previous(2);
								x_crack.top(icrackparticle+1,2,ipath)=x_crack.center(icrackparticle+1,2,ipath);
								x_crack.bot(icrackparticle+1,2,ipath)=x_crack.center(icrackparticle+1,2,ipath);
							elseif tip==2
								for icrackparticlemove=x_crack.nparticles(ipath):-1:1
									for dim=1:2
										x_crack.center(icrackparticlemove+1,dim,ipath)=x_crack.center(icrackparticlemove,dim,ipath);
										x_crack.top(icrackparticlemove+1,dim,ipath)=x_crack.top(icrackparticlemove,dim,ipath);
										x_crack.bot(icrackparticlemove+1,dim,ipath)=x_crack.bot(icrackparticlemove,dim,ipath);
									end
								end
								x_crack.center(1,1,ipath)=x_crack.center(2,1,ipath)+deltax_previous(1);
								x_crack.top(1,1,ipath)=x_crack.center(1,1,ipath);
								x_crack.bot(1,1,ipath)=x_crack.center(1,1,ipath);
								x_crack.center(1,2,ipath)=x_crack.center(2,2,ipath)+deltax_previous(2);
								x_crack.top(1,2,ipath)=x_crack.center(1,2,ipath);
								x_crack.bot(1,2,ipath)=x_crack.center(1,2,ipath);
							end
                            x_crack.nparticles(ipath)=x_crack.nparticles(ipath)+1;
							break;
						end
					end
					
					a=le(1)/2;
					b=le(2)/2;
					
					for dim=1:2
						delta_x(dim)=x_crack.center(icrackparticle,dim,ipath)-LOC_avg(1,dim);
					end
					
					xi=delta_x(1)/a;
					eta=delta_x(2)/b;
					
					B=1/4*[(-1+eta)/a 0 (1-eta)/a 0 (1+eta)/a 0 (-1-eta)/a 0;
							0 (-1+xi)/b 0 (-1-xi)/b 0 (1+xi)/b 0 (1-xi)/b;
							(-1+xi)/b (-1+eta)/a (-1-xi)/b (1-eta)/a (1+xi)/b (1+eta)/a (1-xi)/b (-1-eta)/a];
					
					epsilon_tip=B*d_natural;
					%tempmarker5
					EWStatus_tip=0;
					LWStatus_tip=0;
					for nio=1:4
						io=CONNECT_crack.center.values(icrackparticle,nio_outside,ipath);
						EWStatus_tip=EWStatus_tip+EW_si_comb(io)*N_crack.center(1,nio,icrackparticle,ipath);
						LWStatus_tip=LWStatus_tip+LW_si_comb(io)*N_crack.center(1,nio,icrackparticle,ipath);
					end
					E_LW=E;
					E_EW=40/1200*E;
					steelstrength_LW=0.125;
					steelstrength_EW=sqrt(E_EW/E_LW)*steelstrength_LW;
					E_tip=(E_EW*EWStatus_tip+E_LW*LWStatus_tip)/(EWStatus_tip+LWStatus_tip);
					steelstrength=(steelstrength_EW*EWStatus_tip+steelstrength_LW*LWStatus_tip)/(EWStatus_tip+LWStatus_tip);
					
					D=E_tip/((1+nu)*(1-2*nu))*[1-nu nu 0;nu 1-nu 0;0 0 (1-2*nu)];
					
					s_tip_temp=D*epsilon_tip;
					
					for dim=1:3
						s_tip(ipath,dim,tip)=s_tip_temp(dim,1);
					end
					for dim=1:3
						s_tip_dump(2*(ipath-1)+tip,dim)=s_tip(ipath,dim,tip);
						s_tip_K1_dump(2*(ipath-1)+tip,dim)=s_tip_K1(ipath,dim,tip);
					end
					for dim=1:8
						d_tip_dump(2*(ipath-1)+tip,dim)=d_natural(dim,1);
						io_natural=ceil(dim/2);
						xydim=mod(dim-1,2)+1;
						d_LOC_tip_dump(2*(ipath-1)+tip,dim)=LOC(CONNECT_crack.center.values(icrackparticle,nio_designator(io_natural),ipath),xydim);;
					end
					for dim=1:2
						x_tip_dump(2*(ipath-1)+tip,dim)=x_crack.center(icrackparticle,dim,ipath);
					end
					s_tip_max=(s_tip(ipath,1,tip)+s_tip(ipath,2,tip))/2+sqrt( ((s_tip(ipath,1,tip)-s_tip(ipath,2,tip))/2)^2 + (s_tip(ipath,3,tip))^2 ); %calculate principal stress
					
					%steelstrength=0.125; %to stop coder whining
					k_dumpresult=0.8;
					
					if s_tip_max>k_dumpresult*steelstrength
						dumpresult=1;
					end
					x_crack.tipcrackratio(ipath,tip)=s_tip_max/steelstrength;
					if x_crack.terminatedprop(ipath,tip)==0 && s_tip_max>steelstrength
					%if s_tip_max>steelstrength
						if ipath==1 && x_crack.nparticles(ipath)>=10
							1;
						end
						theta_crack=0.5*(pi-reliableatan((s_tip(ipath,1,tip)-s_tip(ipath,2,tip))/2,-s_tip(ipath,3,tip)));
						crackextension=le(1)/2;
						if tip==1
							deltax_previous=x_crack.center(icrackparticle,:,ipath)-x_crack.center(icrackparticle-1,:,ipath);
						elseif tip==2
							deltax_previous=x_crack.center(1,:,ipath)-x_crack.center(1+1,:,ipath);
						end
						%theta_previous=reliableatan(deltax_previous(1,1,1),deltax_previous(1,2,1));
						theta_crack_trial(1)=theta_crack;
						theta_crack_trial(2)=mod(theta_crack+pi,2*pi); %two possibilities for crack angle, 
						if (deltax_previous(1,1,1)*cos(theta_crack_trial(1))+deltax_previous(1,2,1)*sin(theta_crack_trial(1)))>0 % cos of theta_crack_trial with current crack tip trajectory
							theta_crack=theta_crack_trial(1);
						else
							theta_crack=theta_crack_trial(2);
						end
						if tip==1
							x_crack.center(icrackparticle+1,1,ipath)=x_crack.center(icrackparticle,1,ipath)+crackextension*cos(theta_crack);
							x_crack.top(icrackparticle+1,1,ipath)=x_crack.center(icrackparticle+1,1,ipath);
							x_crack.bot(icrackparticle+1,1,ipath)=x_crack.center(icrackparticle+1,1,ipath);
							x_crack.center(icrackparticle+1,2,ipath)=x_crack.center(icrackparticle,2,ipath)+crackextension*sin(theta_crack);
							x_crack.top(icrackparticle+1,2,ipath)=x_crack.center(icrackparticle+1,2,ipath);
							x_crack.bot(icrackparticle+1,2,ipath)=x_crack.center(icrackparticle+1,2,ipath);
							x_crack_ghosttip(1,1)=x_crack.center(icrackparticle,1,ipath)+3*crackextension*cos(theta_crack);
							x_crack_ghosttip(1,2)=x_crack.center(icrackparticle,2,ipath)+3*crackextension*sin(theta_crack);
						elseif tip==2
							for icrackparticlemove=x_crack.nparticles(ipath):-1:1
								for dim=1:2
									x_crack.center(icrackparticlemove+1,dim,ipath)=x_crack.center(icrackparticlemove,dim,ipath);
									x_crack.top(icrackparticlemove+1,dim,ipath)=x_crack.top(icrackparticlemove,dim,ipath);
									x_crack.bot(icrackparticlemove+1,dim,ipath)=x_crack.bot(icrackparticlemove,dim,ipath);
								end
							end
							x_crack.center(1,1,ipath)=x_crack.center(2,1,ipath)+crackextension*cos(theta_crack);
							x_crack.top(1,1,ipath)=x_crack.center(1,1,ipath);
							x_crack.bot(1,1,ipath)=x_crack.center(1,1,ipath);
							x_crack.center(1,2,ipath)=x_crack.center(2,2,ipath)+crackextension*sin(theta_crack);
							x_crack.top(1,2,ipath)=x_crack.center(1,2,ipath);
							x_crack.bot(1,2,ipath)=x_crack.center(1,2,ipath);
							x_crack_ghosttip(1,1)=x_crack.center(2,1,ipath)+3*crackextension*cos(theta_crack);
							x_crack_ghosttip(1,2)=x_crack.center(2,2,ipath)+3*crackextension*sin(theta_crack);
						end
						if tip==1
							x1(1,1)=x_crack.center(icrackparticle,1,ipath);
							x1(1,2)=x_crack.center(icrackparticle,2,ipath);
						elseif tip==2
							x1(1,1)=x_crack.center(2,1,ipath);
							x1(1,2)=x_crack.center(2,2,ipath);
						end
						x2(1,1)=x_crack_ghosttip(1,1);
						x2(1,2)=x_crack_ghosttip(1,2);

						foundcrossing.ipath3=zeros(1,200); %so not clash with ipath
						foundcrossing.icrackparticle3=zeros(1,200); %so not to clash with iparticle
						foundcrossing.ratio=zeros(1,200); %at which point where crossing happens?
						foundcrossing.size3=zeros(1,1); %how many found? %again size3 so to not clash with regular size, perhaps.

						for ipath2=1:x_crack.npaths
							for icrackparticle2=1:(x_crack.nparticles(ipath2)-1)
								if ipath2==ipath
									%icrackparticle: deals with the propagation, what's currently the particle as the tip
									%icrackparticle2: the loop for checking crack crossing
									if tip==1 && icrackparticle2>=icrackparticle-2
										continue;
									elseif tip==2 && icrackparticle2<=2
										continue;
                                    end
                                end
                                %start of crossing checks
                                for dim=1:2
                                    x3(1,dim)=x_crack.center(icrackparticle2,dim,ipath2);
                                    x4(1,dim)=x_crack.center(icrackparticle2+1,dim,ipath2);
                                end
                                Area(1)=TriangleArea(x1,x2,x3);
                                Area(2)=TriangleArea(x1,x2,x4);
                                Area(3)=TriangleArea(x3,x4,x1);
                                Area(4)=TriangleArea(x3,x4,x2);
                                if (Area(1)<0 && Area(2)>=0 && Area(3)>=0 && Area(4)<0) || (Area(1)>=0 && Area(2)<0 && Area(3)<0 && Area(4)>=0)
                                    foundcrossing.size3=foundcrossing.size3+1;
                                    foundcrossing.ipath3(foundcrossing.size3)=ipath2;
                                    foundcrossing.icrackparticle3(foundcrossing.size3)=icrackparticle2;
                                    foundcrossing.ratio(foundcrossing.size3)=abs(Area(3))/(abs(Area(3))+abs(Area(4)));%ratio between 1-crossing distance to 1-2 distance
                                end
                                %end of crossing checks
							end
						end
						foundcrossing_ratio_min=2;
						for ifoundcrossing=1:foundcrossing.size3
							if foundcrossing.ratio(ifoundcrossing)<foundcrossing_ratio_min
								foundcrossing_ratio_min=foundcrossing.ratio(ifoundcrossing);
							end
						end
						if foundcrossing.size3>0
							x_crack.terminatedprop(ipath,tip)=1;
							if tip==1
								x_crack.center(icrackparticle+1,1,ipath)=x_crack.center(icrackparticle,1,ipath)+foundcrossing_ratio_min*3.1*crackextension*cos(theta_crack);
								x_crack.top(icrackparticle+1,1,ipath)=x_crack.center(icrackparticle+1,1,ipath);
								x_crack.bot(icrackparticle+1,1,ipath)=x_crack.center(icrackparticle+1,1,ipath);
								x_crack.center(icrackparticle+1,2,ipath)=x_crack.center(icrackparticle,2,ipath)+foundcrossing_ratio_min*3.1*crackextension*sin(theta_crack);
								x_crack.top(icrackparticle+1,2,ipath)=x_crack.center(icrackparticle+1,2,ipath);
								x_crack.bot(icrackparticle+1,2,ipath)=x_crack.center(icrackparticle+1,2,ipath);
							elseif tip==2
								x_crack.center(1,1,ipath)=x_crack.center(2,1,ipath)+foundcrossing_ratio_min*3.1*crackextension*cos(theta_crack);
								x_crack.top(1,1,ipath)=x_crack.center(1,1,ipath);
								x_crack.bot(1,1,ipath)=x_crack.center(1,1,ipath);
								x_crack.center(1,2,ipath)=x_crack.center(2,2,ipath)+foundcrossing_ratio_min*3.1*crackextension*sin(theta_crack);
								x_crack.top(1,2,ipath)=x_crack.center(1,2,ipath);
								x_crack.bot(1,2,ipath)=x_crack.center(1,2,ipath);
							end
						end
						x_crack.nparticles(ipath)=x_crack.nparticles(ipath)+1;
					end
				end
			end
		end
	elseif CasetoRun==-1 %118 originally uses this
		%crack propagation of 118
		if CloseEnough(t_time,0.001377337324502874186735179584673,1e-5,2)
			1;
		end
		fprintf('%s',['marker #643' char(10)]);
		if sum(justcracked)>0
			justcrackedlist=zeros(sum(justcracked),1);
			justcrackedcounter=0;
			for sp=1:spCount
				if justcracked(sp)
					justcrackedcounter=justcrackedcounter+1;
					justcrackedlist(justcrackedcounter)=sp;
				end
			end
			
			justcrackedlist=CrackParticleClustering(x_sp,le(1),justcrackedlist);
			ntestedangle=size(Qacoustic{justcrackedlist{1}(1)},3);
			theta=zeros(ntestedangle,1);
			errorntestedangle=36*1*1*1;
			error=zeros(1,errorntestedangle);
			
			for crackgroup=1:length(justcrackedlist)
				justcrackedcounter=length(justcrackedlist{crackgroup});	
				x_justcrackedcenter=zeros(2,1);
				x_justcrackedcenter(1)=sum(x_sp(justcrackedlist{crackgroup},1))/justcrackedcounter;
				x_justcrackedcenter(2)=sum(x_sp(justcrackedlist{crackgroup},2))/justcrackedcounter;
				for i=1:errorntestedangle
					theta(i)=(i-1)/36*1*1*1*pi;
					error(i)=0;
					for spc=1:justcrackedcounter
						error(i)=error(i)+(mod(thetacrack(justcrackedlist{crackgroup}(spc))-theta(i)+pi/2,pi)-pi/2)^2;
					end
				end
				thetajustcrackedcenter=theta(FindMin(error));
				considered=ones(x_crack.npaths,2);
				distancelist=zeros(x_crack.npaths,2);
				thetapropagationlist=zeros(x_crack.npaths,2);
				n_nairncrack0=0;
				n_nairncrack1=0;
				for icrackpath=x_crack.npaths:-1:1
					for whichtip=1:2
						if whichtip==1
							n_nairncrack1=x_crack.nparticles(icrackpath);
							n_nairncrack0=n_nairncrack1-1;
						elseif whichtip==2
							n_nairncrack1=1;
							n_nairncrack0=2;
						else
							fprintf('%s',['whichtip error! 1904151959' char(10)]);
							pause;
							1;
						end
						
						x_cracktip=x_crack.center(n_nairncrack1,:,icrackpath);
						thetatocrackcenter=reliableatan(x_justcrackedcenter(1)-x_cracktip(1),x_justcrackedcenter(2)-x_cracktip(2));
						theta_prev=reliableatan(x_crack.center(n_nairncrack1,1,icrackpath)-x_crack.center(n_nairncrack0,1,icrackpath),x_crack.center(n_nairncrack1,2,icrackpath)-x_crack.center(n_nairncrack0,2,icrackpath));
						deltatheta_tocrackvsprev=mod(thetatocrackcenter-theta_prev+pi,2*pi)-pi;
						if abs(deltatheta_tocrackvsprev)>pi
							fprintf('%s',['deltatheta_tocrackvsprev error! 1904112048' char(10)]);
							pause;
							1;
						end
						if abs(deltatheta_tocrackvsprev)>pi/2
							considered(icrackpath,whichtip)=0;
							distancelist(icrackpath,whichtip)=inf;
							continue;
						end
						propagationlength=sqrt((x_crack.center(n_nairncrack1,1,icrackpath)-x_justcrackedcenter(1))^2+(x_crack.center(n_nairncrack1,2,icrackpath)-x_justcrackedcenter(2))^2);
						if propagationlength>1.5*le(1)
							considered(icrackpath,whichtip)=0;
							distancelist(icrackpath,whichtip)=inf;
							continue;
						end
						distancelist(icrackpath,whichtip)=propagationlength;
						for i=1:36*1*1*1
							theta(i)=(i-1)/36*1*1*1*2*pi;
							error(i)=(mod(thetajustcrackedcenter-theta(i)+pi/2,pi)-pi/2)^2+(mod(thetatocrackcenter-theta(i)+pi,2*pi)-pi)^2;
						end
						theta_crackpropagation=theta(FindMin(error));
						theta_crackpropagation=mod(theta_crackpropagation-theta_prev+pi,2*pi)+theta_prev-pi;
						thetapropagationlist(icrackpath,whichtip)=theta_crackpropagation;
					end
				end
				if sum(sum(considered))>0
					ncrackandwhichtip=FindMinMatrix(distancelist);
					icrackpath_outloop=ncrackandwhichtip(1);
					whichtip=ncrackandwhichtip(2);
					if whichtip==1
						n_nairncrack1=x_crack.nparticles(icrackpath_outloop);
					else
						n_nairncrack1=1;
					end
					propagationlength=distancelist(icrackpath_outloop,whichtip);
					theta_crackpropagation=thetapropagationlist(icrackpath_outloop,whichtip);
					idealpropagationlength=le(1)/4; %assuming lp(1)==lp(2)
					%propagationlengthreductionfactor=max([1 round(propagationlength/idealpropagationlength)]);
					propagationlengthreductionfactor=1;
					if whichtip==1
						x_crack.nparticles(icrackpath_outloop)=x_crack.nparticles(icrackpath_outloop)+propagationlengthreductionfactor;
						for i=1:propagationlengthreductionfactor
							x_crack.center(n_nairncrack1+i,:,icrackpath_outloop)=[x_crack.center(n_nairncrack1,1,icrackpath_outloop)+i/propagationlengthreductionfactor*propagationlength*cos(theta_crackpropagation) x_crack.center(n_nairncrack1,2,icrackpath_outloop)+i/propagationlengthreductionfactor*propagationlength*sin(theta_crackpropagation)];
							x_crack.top(n_nairncrack1+i,:,icrackpath_outloop)=x_crack.center(n_nairncrack1+i,:,icrackpath_outloop);
							x_crack.bot(n_nairncrack1+i,:,icrackpath_outloop)=x_crack.center(n_nairncrack1+i,:,icrackpath_outloop);
						end
					elseif whichtip==2
						for i=x_crack.nparticles(icrackpath_outloop):-1:1
							x_crack.center(i+propagationlengthreductionfactor,:,icrackpath_outloop)=x_crack.center(i,:,icrackpath_outloop);
							x_crack.top(i+propagationlengthreductionfactor,:,icrackpath_outloop)=x_crack.top(i,:,icrackpath_outloop);
							x_crack.bot(i+propagationlengthreductionfactor,:,icrackpath_outloop)=x_crack.bot(i,:,icrackpath_outloop);
						end
						x_crack.nparticles(icrackpath_outloop)=x_crack.nparticles(icrackpath_outloop)+propagationlengthreductionfactor;
						n_nairncrack1=n_nairncrack1+propagationlengthreductionfactor;
						for i=1:propagationlengthreductionfactor
							x_crack.center(n_nairncrack1-i,:,icrackpath_outloop)=[x_crack.center(n_nairncrack1,1,icrackpath_outloop)+i/propagationlengthreductionfactor*propagationlength*cos(theta_crackpropagation) x_crack.center(n_nairncrack1,2,icrackpath_outloop)+i/propagationlengthreductionfactor*propagationlength*sin(theta_crackpropagation)];
							x_crack.top(n_nairncrack1-i,:,icrackpath_outloop)=x_crack.center(n_nairncrack1-i,:,icrackpath_outloop);
							x_crack.bot(n_nairncrack1-i,:,icrackpath_outloop)=x_crack.center(n_nairncrack1-i,:,icrackpath_outloop);
						end
					else
						fprintf('%s',['which tip error! 1904151909' char(10)]);
						pause;
						1;
					end
				else
					intheprevention=0;
					preventiondistance=0.075*le_base;
					preventionangle=pi/4;
					for icrackpath=1:x_crack.npaths;
						for spcrack=1:(x_crack.nparticles(icrackpath)-1)
							vector1a=[(x_justcrackedcenter(1)-x_crack.center(spcrack,1,icrackpath));(x_justcrackedcenter(2)-x_crack.center(spcrack,2,icrackpath))];
							vector1b=[(x_justcrackedcenter(1)-x_crack.center(spcrack+1,1,icrackpath));(x_justcrackedcenter(2)-x_crack.center(spcrack+1,2,icrackpath))];
							distance1a=sqrt(dot(vector1a,vector1a));
							distance1b=sqrt(dot(vector1b,vector1b));
							
							distance1a_old=sqrt((x_justcrackedcenter(1)-x_crack.center(spcrack,1,icrackpath))^2+(x_justcrackedcenter(2)-x_crack.center(spcrack,2,icrackpath))^2);
							distance1b_old=sqrt((x_justcrackedcenter(1)-x_crack.center(spcrack+1,1,icrackpath))^2+(x_justcrackedcenter(2)-x_crack.center(spcrack+1,2,icrackpath))^2);
							
							distance1=min([distance1a distance1b]);
							
							area2=abs(TriangleArea(x_justcrackedcenter,x_crack.center(spcrack,:,icrackpath),x_crack.center(spcrack+1,:,icrackpath)));
							
							inbetween2vector=[(x_crack.center(spcrack+1,1,icrackpath)-x_crack.center(spcrack,1,icrackpath));(x_crack.center(spcrack+1,2,icrackpath)-x_crack.center(spcrack,2,icrackpath))];
							
							inbetween2=sqrt(dot(inbetween2vector,inbetween2vector));
							
							inbetween2_old=sqrt((x_crack.center(spcrack+1,1,icrackpath)-x_crack.center(spcrack,1,icrackpath))^2+(x_crack.center(spcrack+1,2,icrackpath)-x_crack.center(spcrack,2,icrackpath))^2);
							distance2=area2/inbetween2;
							
							signcos1=dot(vector1a,inbetween2vector);
							signcos2=dot(vector1b,inbetween2vector);
							
							if signcos1*signcos2>0
								distance=distance1;
							else
								distance=distance2;
							end
							
							if distance<preventiondistance
								thetanairncrack=reliableatan(x_crack.center(spcrack+1,1,icrackpath)-x_crack.center(spcrack,1,icrackpath),x_crack.center(spcrack+1,2,icrackpath)-x_crack.center(spcrack,2,icrackpath));
								
								absdeltatheta=abs(mod(thetanairncrack-thetajustcrackedcenter+pi/2,pi)-pi/2);
								
								if absdeltatheta<preventionangle
									intheprevention=1;
								end
							end
							if intheprevention==1
								break;
							end
						end
						if intheprevention==1
							break;
						end
					end
					if intheprevention==0
						thetainitiate=mod(thetajustcrackedcenter-pi,pi)+pi; %always pointing down, pi<theta<2*pi
						icrackpath_outloop=x_crack.npaths+1;
						x_crack.npaths=x_crack.npaths+1;
						x_crack.nparticles(icrackpath_outloop)=2;
						x_crack.center(2,2,icrackpath_outloop)=x_justcrackedcenter(2)+le(1)/2/2*sin(thetainitiate); %assuming le(1)=le(2);
						x_crack.center(2,1,icrackpath_outloop)=x_justcrackedcenter(1)+le(1)/2/2*cos(thetainitiate);
						x_crack.center(1,2,icrackpath_outloop)=x_justcrackedcenter(2)-le(1)/2/2*sin(thetainitiate);
						x_crack.center(1,1,icrackpath_outloop)=x_justcrackedcenter(1)-le(1)/2/2*cos(thetainitiate);
						%fprintf('%s',['>>line 8967: size(x_crack' int2txt(icrackpath_outloop) '},1)=' int2txt(x_crack.nparticles(icrackpath_outloop)) char(10)]);
						%fprintf('%s',['>>line 8968: size(x_cracktop{' int2txt(icrackpath_outloop) '},1)=' int2txt(size(x_cracktop{icrackpath_outloop},1)) char(10)]);
						%{
						for i=1:size(x_cracktop{icrackpath_outloop},1)
							for j=1:size(x_cracktop{icrackpath_outloop},2)
								%fprintf('%s',['>>line 8973: x_cracktop{' int2txt(icrackpath_outloop) '}(' int2txt(i) ',' int2txt(j) ')=' float2txt(5,x_cracktop{icrackpath_outloop}(i,j)) char(10)]);
							end
						end
						for i=1:size(x_crackbot{icrackpath_outloop},1)
							for j=1:size(x_crackbot{icrackpath_outloop},2)
								%fprintf('%s',['>>line 8980: x_crackbot{' int2txt(icrackpath_outloop) '}(' int2txt(i) ',' int2txt(j) ')=' float2txt(5,x_crackbot{icrackpath_outloop}(i,j)) char(10)]);
							end
						end
						for i=1:size(x_crack{icrackpath_outloop},1)
							for j=1:size(x_crack{icrackpath_outloop},2)
								%fprintf('%s',['>>line 8987: x_crack{' int2txt(icrackpath_outloop) '}(' int2txt(i) ',' int2txt(j) ')=' float2txt(5,x_crack{icrackpath_outloop}(i,j)) char(10)]);
							end
						end
						%}
						for i=1:x_crack.nparticles(icrackpath_outloop)
							for j=1:2
								%fprintf('%s',['>>line 8973: x_crack{' int2txt(icrackpath_outloop) '}(' int2txt(i) ',' int2txt(j) ')=' float2txt(5,x_crack{icrackpath_outloop}(i,j)) char(10)]);
								x_crack.top(i,j,icrackpath_outloop)=x_crack.center(i,j,icrackpath_outloop);
								x_crack.bot(i,j,icrackpath_outloop)=x_crack.center(i,j,icrackpath_outloop);
							end
						end
						%shit below
						%x_cracktop{icrackpath_outloop}=x_crack{icrackpath_outloop};
						%x_crackbot{icrackpath_outloop}=x_crack{icrackpath_outloop};
						%shit above
					end
					%soundplay
					1;
				end
				
				
%{
%switchable1
				soundplay;
%}
%switchable1
				1; %pause multi average and propagate here
			end
			
		end
		fprintf('%s',['marker #644' char(10)]);
	elseif CasetoRun==74 || CasetoRun==78 || CasetoRun==81 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==83 || CasetoRun==84 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==115 || CasetoRun==116 || CasetoRun==117 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110 || CasetoRun==96 || CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89 || CasetoRun==85 || CasetoRun==77 %average and propagate
		if sum(justcracked)>0
			justcrackedlist=zeros(sum(justcracked),1);
			justcrackedcounter=0;
			for sp=1:spCount
				if justcracked(sp)
					justcrackedcounter=justcrackedcounter+1;
					justcrackedlist(justcrackedcounter)=sp;
				end
			end
			justcrackedlist=CrackParticleClustering(x_sp,le(1),justcrackedlist);
			ntestedangle=size(Qacoustic{justcrackedlist{1}(1)},3);
			theta=zeros(ntestedangle,1);
			errorntestedangle=36*1*1*1;
			error=zeros(1,errorntestedangle)
			
			AbeforeQ=zeros(2,2,2,2,spCount);
			% grouping just done
			for crackgroup=1:length(justcrackedlist)
				justcrackedcounter=length(justcrackedlist{crackgroup});
				for nspcracked=1:justcrackedcounter;
					for i=1:2
					for j=1:2
					for k=1:2
					for l=1:2
					for p=1:2
					for q=1:2
					for m=1:2
					for nn=1:2
						AbeforeQ(i,j,k,l,justcrackedlist{crackgroup}(nspcracked))=AbeforeQ(i,j,k,l,justcrackedlist{crackgroup}(nspcracked))+QbackRback(i,p,justcrackedlist{crackgroup}(nspcracked))*QbackRback(j,q,justcrackedlist{crackgroup}(nspcracked))*QbackRback(k,m,justcrackedlist{crackgroup}(nspcracked))*QbackRback(l,nn,justcrackedlist{crackgroup}(nspcracked))*AbeforeQ_rtl(p,q,m,nn,justcrackedlist{crackgroup}(nspcracked));
					end
					end
					end
					end
					end
					end
					end
					end
					Qacoustic{justcrackedlist{crackgroup}(nspcracked)}=zeros(size(Qacoustic{justcrackedlist{crackgroup}(nspcracked)}));
					for itestedangle=1:ntestedangle
						theta(itestedangle)=itestedangle/ntestedangle*2*pi;
						n(1)=cos(theta(itestedangle));
						n(2)=sin(theta(itestedangle));
						for m=1:2
						for nn=1:2
						for o=1:2
						for p=1:2
							Qacoustic{justcrackedlist{crackgroup}(nspcracked)}(nn,o,itestedangle)=Qacoustic{justcrackedlist{crackgroup}(nspcracked)}(nn,o,itestedangle)+n(m)*AbeforeQ(m,nn,o,p,justcrackedlist{crackgroup}(nspcracked))*n(p);
						end
						end
						end
						end
					end
				end
				x_justcrackedcenter=zeros(2,1);
				x_justcrackedcenter(1)=sum(x_sp(justcrackedlist{crackgroup},1))/justcrackedcounter;
				x_justcrackedcenter(2)=sum(x_sp(justcrackedlist{crackgroup},2))/justcrackedcounter;
				if CasetoRun==80 || CasetoRun==82 || CasetoRun==83 || CasetoRun==84 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==117 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110 || CasetoRun==96 || CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89 || CasetoRun==85 %case 80 uses Q average
					%ntestedangle=size(Qacoustic{justcrackedlist{crackgroup}(1)},3);
					lambda1_avg=zeros(ntestedangle,1);
					lambda2_avg=zeros(ntestedangle,1);
					%theta=zeros(ntestedangle,1);
					%n=zeros(2,1);
					h_avg=zeros(2,2,ntestedangle); %1st index: direction; 2nd index: which lambda; 3rd index: which
					%{
					for i=1:justcrackedcounter
						for j=1:ntestedangle
							Qacoustic{justcrackedlist{crackgroup}(i)}(:,:,j)=(QbackRback(:,:,justcrackedlist{crackgroup}(i)))*Qacoustic{justcrackedlist{crackgroup}(i)}(:,:,j)*transpose(QbackRback(:,:,justcrackedlist{crackgroup}(i)));
						end
					end
					%}
					Qacoustic_avg=zeros(2,2,ntestedangle);
					dudx_avg=zeros(2,2);
					for i=1:justcrackedcounter
						if i==1
							Qacoustic_avg=Qacoustic{justcrackedlist{crackgroup}(i)};
							dudx_avg=[dudx_sp(justcrackedlist{crackgroup}(i),1) dudx_sp(justcrackedlist{crackgroup}(i),2);dudx_sp(justcrackedlist{crackgroup}(i),3) dudx_sp(justcrackedlist{crackgroup}(i),4)];
							%h_avg=h{justcrackedlist{crackgroup}(i)};
						else
							Qacoustic_avg=Qacoustic_avg+Qacoustic{justcrackedlist{crackgroup}(i)};
							dudx_avg=dudx_avg+[dudx_sp(justcrackedlist{crackgroup}(i),1) dudx_sp(justcrackedlist{crackgroup}(i),2);dudx_sp(justcrackedlist{crackgroup}(i),3) dudx_sp(justcrackedlist{crackgroup}(i),4)];
							%h_avg=h_avg+h{justcrackedlist{crackgroup}(i)};
						end
					end
					Qacoustic_avg=Qacoustic_avg/justcrackedcounter;
					dudx_avg=dudx_avg/justcrackedcounter;
					%h_avg=h_avg/justcrackedcounter;
					for i=1:ntestedangle
						theta(i)=i/ntestedangle*2*pi;
						n(1)=cos(theta(i));
						n(2)=sin(theta(i));
						[h_eig,lambda_eig]=eig(Qacoustic_avg(:,:,i));
						h_avg(:,:,i)=real(h_eig);
						lambda1_avg(i)=real(lambda_eig(1,1));
						lambda2_avg(i)=real(lambda_eig(2,2));
					end
					lambdamin=min([lambda1_avg;lambda2_avg]);
					if length(lambdamin)>1
						fprintf('%s',['length(lamdabmin)>1!' char(10)]);
						pause;
						1;
					end
					lambdaminlessthanzero=1; % switcher for making sure the averaged acoustic tensor still has less than zero eigen value(s). firstly assumed that it is, unless proven otherwise below.
					if lambdamin>0
						fprintf('%s',['Warning, lamdamin>0 on avg(Q)!' char(10)]);
						fprintf('%s',['Ditching average acoustic tensor, switching to individual acoustic tensor' char(10)]);
						lambdaminlessthanzero=0;
						%pause;
						1;
					end
					if lambdaminlessthanzero==1
						localminima1index=zeros(1,0);
						localminima2index=zeros(1,0);
						for i=1:ntestedangle
							if lambda1_avg(i)<0 && lambda1_avg(i)<=lambda1_avg(mod((i-1)-1,ntestedangle)+1) && lambda1_avg(i)<=lambda1_avg(mod((i+1)-1,ntestedangle)+1)
							%if lambda1_avg(i)<=lambda1_avg(mod((i-1)-1,ntestedangle)+1) && lambda1_avg(i)<=lambda1_avg(mod((i+1)-1,ntestedangle)+1)
								localminima1index=[localminima1index i];
							end
							if lambda2_avg(i)<0 && lambda2_avg(i)<=lambda2_avg(mod((i-1)-1,ntestedangle)+1) && lambda2_avg(i)<=lambda2_avg(mod((i+1)-1,ntestedangle)+1)
							%if lambda2_avg(i)<=lambda2_avg(mod((i-1)-1,ntestedangle)+1) && lambda2_avg(i)<=lambda2_avg(mod((i+1)-1,ntestedangle)+1)
								localminima2index=[localminima2index i];
							end
						end
						nldudxhl=zeros(length(localminima1index)+length(localminima2index),1);
						h_localminima=zeros(2,length(localminima1index)+length(localminima2index));
						for i=1:length(localminima1index)
							n(1)=cos(theta(localminima1index(i)));
							n(2)=sin(theta(localminima1index(i)));
							nldudxhl(i)=transpose(n)*dudx_avg*h_avg(:,1,localminima1index(i));
							h_localminima(:,i)=h_avg(:,1,localminima1index(i));
						end
						for i=1:length(localminima2index)
							n(1)=cos(theta(localminima2index(i)));
							n(2)=sin(theta(localminima2index(i)));
							nldudxhl(i+length(localminima1index))=transpose(n)*dudx_avg*h_avg(:,2,localminima2index(i));
							h_localminima(:,i+length(localminima1index))=h_avg(:,2,localminima2index(i));
						end
						localminimaindex=[localminima1index localminima2index];
						FindMaxnldudxhl=FindMax(nldudxhl); %I put FindMax(nldudxhl) to a variable FindMaxnldudxhl as I need to call it twice. Better to save the result rather than calling the function twice.
						crackindex=localminimaindex(FindMaxnldudxhl);
						thetamin=theta(crackindex);
						thetacrack_avg=mod(thetamin+pi/2+pi/2,pi)-pi/2;
						1; %pause average Q calculation
						for i=1:justcrackedcounter
							thetacrack(justcrackedlist{crackgroup}(i))=thetacrack_avg;
							thetacrackrtl(justcrackedlist{crackgroup}(i))=thetacrack_avg-reliableatan(RQ(1,1,justcrackedlist{crackgroup}(i)),RQ(1,2,justcrackedlist{crackgroup}(i)));
						end
						thetajustcrackedcenter=thetacrack_avg;
						1;
					else
						for i=1:errorntestedangle
							theta(i)=(i-1)/36*1*1*1*pi;
							error(i)=0;
							for spc=1:justcrackedcounter
								error(i)=error(i)+(mod(thetacrack(justcrackedlist{crackgroup}(spc))-theta(i)+pi/2,pi)-pi/2)^2;
							end
						end
						thetajustcrackedcenter=theta(FindMin(error));
						1;
					end
				else
					for i=1:errorntestedangle
						theta(i)=(i-1)/36*1*1*1*pi;
						error(i)=0;
						for spc=1:justcrackedcounter
							error(i)=error(i)+(mod(thetacrack(justcrackedlist{crackgroup}(spc))-theta(i)+pi/2,pi)-pi/2)^2;
						end
					end
					thetajustcrackedcenter=theta(FindMin(error));
				end
				if CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==117 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110
					considered=ones(length(x_crack),2);
					distancelist=zeros(length(x_crack),2);
					thetapropagationlist=zeros(length(x_crack),2);
					n_nairncrack0=0;
					n_nairncrack1=0;
					for icrackpath=length(x_crack):-1:1
						for whichtip=1:2
							if whichtip==1
								n_nairncrack1=size(x_crack{icrackpath},1);
								n_nairncrack0=n_nairncrack1-1;
							elseif whichtip==2
								n_nairncrack1=1;
								n_nairncrack0=2;
							else
								fprintf('%s',['whichtip error! 1904151959' char(10)]);
								pause;
								1;
							end
							x_cracktip=x_crack{icrackpath}(n_nairncrack1,:);
							thetatocrackcenter=reliableatan(x_justcrackedcenter(1)-x_cracktip(1),x_justcrackedcenter(2)-x_cracktip(2));
							theta_prev=reliableatan(x_crack{icrackpath}(n_nairncrack1,1)-x_crack{icrackpath}(n_nairncrack0,1),x_crack{icrackpath}(n_nairncrack1,2)-x_crack{icrackpath}(n_nairncrack0,2));
							deltatheta_tocrackvsprev=mod(thetatocrackcenter-theta_prev+pi,2*pi)-pi;
							if abs(deltatheta_tocrackvsprev)>pi
								fprintf('%s',['deltatheta_tocrackvsprev error! 1904112048' char(10)]);
								pause;
								1;
							end
							if abs(deltatheta_tocrackvsprev)>pi/2
								considered(icrackpath,whichtip)=0;
								distancelist(icrackpath,whichtip)=inf;
								continue;
							end
							propagationlength=sqrt((x_crack{icrackpath}(n_nairncrack1,1)-x_justcrackedcenter(1))^2+(x_crack{icrackpath}(n_nairncrack1,2)-x_justcrackedcenter(2))^2);
							if propagationlength>1.5*le(1)
								considered(icrackpath,whichtip)=0;
								distancelist(icrackpath,whichtip)=inf;
								continue;
							end
							distancelist(icrackpath,whichtip)=propagationlength;
							for i=1:36*1*1*1
								theta(i)=(i-1)/36*1*1*1*2*pi;
								error(i)=(mod(thetajustcrackedcenter-theta(i)+pi/2,pi)-pi/2)^2+(mod(thetatocrackcenter-theta(i)+pi,2*pi)-pi)^2;
							end
							theta_crackpropagation=theta(FindMin(error));
							theta_crackpropagation=mod(theta_crackpropagation-theta_prev+pi,2*pi)+theta_prev-pi;
							thetapropagationlist(icrackpath,whichtip)=theta_crackpropagation;
						end
					end
					if sum(sum(considered))>0
						ncrackandwhichtip=FindMinMatrix(distancelist);
						icrackpath_outloop=ncrackandwhichtip(1);
						whichtip=ncrackandwhichtip(2);
						if whichtip==1
							n_nairncrack1=size(x_crack{icrackpath_outloop},1);
						else
							n_nairncrack1=1;
						end
						propagationlength=distancelist(icrackpath_outloop,whichtip);
						theta_crackpropagation=thetapropagationlist(icrackpath_outloop,whichtip);
						idealpropagationlength=le(1)/4; %assuming lp(1)==lp(2)
						%propagationlengthreductionfactor=max([1 round(propagationlength/idealpropagationlength)]);
						propagationlengthreductionfactor=1;
						if whichtip==1
							for i=1:propagationlengthreductionfactor
								x_crack{icrackpath_outloop}(n_nairncrack1+i,:)=[x_crack{icrackpath_outloop}(n_nairncrack1,1)+i/propagationlengthreductionfactor*propagationlength*cos(theta_crackpropagation) x_crack{icrackpath_outloop}(n_nairncrack1,2)+i/propagationlengthreductionfactor*propagationlength*sin(theta_crackpropagation)];
								x_cracktop{icrackpath_outloop}(n_nairncrack1+i,:)=x_crack{icrackpath_outloop}(n_nairncrack1+i,:);
								x_crackbot{icrackpath_outloop}(n_nairncrack1+i,:)=x_crack{icrackpath_outloop}(n_nairncrack1+i,:);
							end
						elseif whichtip==2
							for i=size(x_crack{icrackpath_outloop},1):-1:1
								x_crack{icrackpath_outloop}(i+propagationlengthreductionfactor,:)=x_crack{icrackpath_outloop}(i,:);
								x_cracktop{icrackpath_outloop}(i+propagationlengthreductionfactor,:)=x_cracktop{icrackpath_outloop}(i,:);
								x_crackbot{icrackpath_outloop}(i+propagationlengthreductionfactor,:)=x_crackbot{icrackpath_outloop}(i,:);
							end
							n_nairncrack1=n_nairncrack1+propagationlengthreductionfactor;
							for i=1:propagationlengthreductionfactor
								x_crack{icrackpath_outloop}(n_nairncrack1-i,:)=[x_crack{icrackpath_outloop}(n_nairncrack1,1)+i/propagationlengthreductionfactor*propagationlength*cos(theta_crackpropagation) x_crack{icrackpath_outloop}(n_nairncrack1,2)+i/propagationlengthreductionfactor*propagationlength*sin(theta_crackpropagation)];
								x_cracktop{icrackpath_outloop}(n_nairncrack1-i,:)=x_crack{icrackpath_outloop}(n_nairncrack1-i,:);
								x_crackbot{icrackpath_outloop}(n_nairncrack1-i,:)=x_crack{icrackpath_outloop}(n_nairncrack1-i,:);

							end
						else
							fprintf('%s',['which tip error! 1904151909' char(10)]);
							pause
							1;
						end
					else
						intheprevention=0;
						preventiondistance=le(1)/2;
						preventionangle=pi/4;
						for icrackpath=1:length(x_crack);
							for spcrack=1:(size(x_crack{icrackpath},1)-1)
								vector1a=[(x_justcrackedcenter(1)-x_crack{icrackpath}(spcrack,1));(x_justcrackedcenter(2)-x_crack{icrackpath}(spcrack,2))];
								vector1b=[(x_justcrackedcenter(1)-x_crack{icrackpath}(spcrack+1,1));(x_justcrackedcenter(2)-x_crack{icrackpath}(spcrack+1,2))];
								distance1a=sqrt(dot(vector1a,vector1a));
								distance1b=sqrt(dot(vector1b,vector1b));
								
								distance1a_old=sqrt((x_justcrackedcenter(1)-x_crack{icrackpath}(spcrack,1))^2+(x_justcrackedcenter(2)-x_crack{icrackpath}(spcrack,2))^2);
								distance1b_old=sqrt((x_justcrackedcenter(1)-x_crack{icrackpath}(spcrack+1,1))^2+(x_justcrackedcenter(2)-x_crack{icrackpath}(spcrack+1,2))^2);
								
								distance1=min([distance1a distance1b]);
								
								area2=abs(TriangleArea(x_justcrackedcenter,x_crack{icrackpath}(spcrack,:),x_crack{icrackpath}(spcrack+1,:)));
								
								inbetween2vector=[(x_crack{icrackpath}(spcrack+1,1)-x_crack{icrackpath}(spcrack,1));(x_crack{icrackpath}(spcrack+1,2)-x_crack{icrackpath}(spcrack,2))];
								
								inbetween2=sqrt(dot(inbetween2vector,inbetween2vector));
								
								inbetween2_old=sqrt((x_crack{icrackpath}(spcrack+1,1)-x_crack{icrackpath}(spcrack,1))^2+(x_crack{icrackpath}(spcrack+1,2)-x_crack{icrackpath}(spcrack,2))^2);
								distance2=area2/inbetween2;
								
								signcos1=dot(vector1a,inbetween2vector);
								signcos2=dot(vector1b,inbetween2vector);
								
								if signcos1*signcos2>0
									distance=distance1;
								else
									distance=distance2;
								end
								
								if distance<preventiondistance
									thetanairncrack=reliableatan(x_crack{icrackpath}(spcrack+1,1)-x_crack{icrackpath}(spcrack,1),x_crack{icrackpath}(spcrack+1,2)-x_crack{icrackpath}(spcrack,2));
									
									absdeltatheta=abs(mod(thetanairncrack-thetajustcrackedcenter+pi/2,pi)-pi/2);
									
									if absdeltatheta<preventionangle
										intheprevention=1;
									end
								end
								if intheprevention==1
									break;
								end
							end
							if intheprevention==1
								break;
							end
						end
						if intheprevention==0
							thetainitiate=mod(thetajustcrackedcenter-pi,pi)+pi; %always pointing down, pi<theta<2*pi
							icrackpath_outloop=length(x_crack)+1;
							x_crack{icrackpath_outloop}(2,2)=x_justcrackedcenter(2)+le(1)/2/2*sin(thetainitiate); %assuming le(1)=le(2);
							x_crack{icrackpath_outloop}(2,1)=x_justcrackedcenter(1)+le(1)/2/2*cos(thetainitiate);
							x_crack{icrackpath_outloop}(1,2)=x_justcrackedcenter(2)-le(1)/2/2*sin(thetainitiate);
							x_crack{icrackpath_outloop}(1,1)=x_justcrackedcenter(1)-le(1)/2/2*cos(thetainitiate);
							x_cracktop{icrackpath_outloop}=x_crack{icrackpath_outloop};
							x_crackbot{icrackpath_outloop}=x_crack{icrackpath_outloop};
						end
						%soundplay
						1;
					end
%{
%switchable1
					soundplay;
%}
%switchable1
					1; %pause multi average and propagate here
				else
					n_nairncrack=size(x_crack,1);
					x_cracktip=x_crack(n_nairncrack,:);
					thetatocrackcenter=reliableatan(x_justcrackedcenter(1)-x_cracktip(1),x_justcrackedcenter(2)-x_cracktip(2));
					theta_prev=reliableatan(x_crack(n_nairncrack,1)-x_crack(n_nairncrack-1,1),x_crack(n_nairncrack,2)-x_crack(n_nairncrack-1,2));
					propagationlength=sqrt((x_crack(n_nairncrack,1)-x_justcrackedcenter(1))^2+(x_crack(n_nairncrack,2)-x_justcrackedcenter(2))^2);
					idealpropagationlength=le(1)/4; %assuming lp(1)==lp(2)
					propagationlengthreductionfactor=max([1 round(propagationlength/idealpropagationlength)]);
					for i=1:36*1*1*1
						theta(i)=(i-1)/36*1*1*1*2*pi;
						error(i)=(mod(thetajustcrackedcenter-theta(i)+pi/2,pi)-pi/2)^2+(mod(thetatocrackcenter-theta(i)+pi,2*pi)-pi)^2;
					end
					theta_crackpropagation=theta(FindMin(error));
					theta_crackpropagation=mod(theta_crackpropagation-theta_prev+pi,2*pi)+theta_prev-pi;
					for i=1:propagationlengthreductionfactor
						x_crack.center(n_nairncrack+i,:,1)=[x_crack(n_nairncrack,1)+i/propagationlengthreductionfactor*propagationlength*cos(theta_crackpropagation) x_crack(n_nairncrack,2)+i/propagationlengthreductionfactor*propagationlength*sin(theta_crackpropagation)];
						x_crack.top(n_nairncrack+i,:,1)=x_crack(n_nairncrack+i,:);
						x_crack.bot(n_nairncrack+i,:,1)=x_crack(n_nairncrack+i,:);
					end
					1; %pause average and propagate here
				end
			end
			% grouping effect stops
		end
	elseif CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120
		%start function for calculating J integral
		K_sp=0.5*(p_sp.*(v_ssp_out(:,1).^2 + v_ssp_out(:,2).^2));
		n_tip=size(x_crack{1},1);
		x_tip=x_crack{1}(n_tip,:);
		ni_Jcenter=FindMax(Nmatrix_cracktop{1}(:,n_tip));
		if length(x_crack)>1
			fprintf('%s',['too many icrackpath! 1905132233' char(10)]);
			pause
			1;
		end
		if mod(refinementfactor,2)==0
		else
			fprintf('%s',['refinement factor has to be even! 1905132234' char(10)]);
			pause
			1;
		end
		expansion=0.5*refinementfactor;
		n_pointperside=2*expansion+1;
		
		%listing surrounding nodes in counter-clockwise order
		ni_list{4}(n_pointperside)=0;
		ni_list{3}(n_pointperside)=0;
		ni_list{2}(n_pointperside)=0;
		ni_list{1}(n_pointperside)=0;
		%ni_list index: 1 = left, 2 = bottom, 3 = right, 4 = top
		
		for i=1:n_pointperside
			ni_list{1}(i)=ni_Jcenter-expansion+expansion*NN(1)-(i-1)*NN(1);
			ni_list{2}(i)=ni_Jcenter-expansion*NN(1)-expansion+(i-1);
			ni_list{3}(i)=ni_Jcenter+expansion-expansion*NN(1)+(i-1)*NN(1);
			ni_list{4}(i)=ni_Jcenter+expansion*NN(1)+expansion-(i-1);
		end
		
		
		for toporbot=1:2
			sidebreaksignal=0;
			for crackline=(n_tip-1):-1:1
				for side=1:4
					for sideline=1:(length(ni_list{side})-1)
						if side==3 && sideline==2 && crackline==2
							1;
						end
						x1=LOC(ni_list{side}(sideline),:);
						x2=LOC(ni_list{side}(sideline+1),:);
						if toporbot==1
							x3=x_cracktop{1}(crackline,:);
							x4=x_cracktop{1}(crackline+1,:);
							[CrossDir,RelativeLocation]=FindCrossing(x1,x2,x3,x4);
						elseif toporbot==2
							x3=x_crackbot{1}(crackline,:);
							x4=x_crackbot{1}(crackline+1,:);
							[CrossDir,RelativeLocation]=FindCrossing(x1,x2,x3,x4);
						end
						if CrossDir>0
							sidebreaksignal=1;
							break;
						end
					end
					if sidebreaksignal==1
						break;
					end
				end
				if sidebreaksignal==1
					break;
				end
			end
			if toporbot==1
				crackline_top=crackline;
				side_top=side;
				sideline_top=sideline;
				CrossDir_top=CrossDir;
				RelativeLocation_top=RelativeLocation;
			elseif toporbot==2
				crackline_bot=crackline;
				side_bot=side;
				sideline_bot=sideline;
				CrossDir_bot=CrossDir;
				RelativeLocation_bot=RelativeLocation;
			end
		end
		nfield=3;
		nNodes=size(CONNECTpn,1);
		M_ni=zeros(nNodes,nfield);
		MW_ni=zeros(nNodes,nfield);
		Mdudx_ni=zeros(nNodes,4,nfield);
		Ms_ni=zeros(nNodes,3,nfield);
		MK_ni=zeros(nNodes,nfield);
		
		%{
		for npid=1:nNodes
			for nsp=1:size(TheFieldSplitBase3_old{ni},1)
				sp=CONNECTpn(ni,nsp);
				if N{sp}()==0 || m_sp(sp)==0
					continue
				end
				M_ni(npid,TheFieldSplitBase3_old(npid,sp))            = M_ni(npid,TheFieldSplitBase3_old(npid,sp)) + m_sp(sp)*N{sp}(j);
				MW_ni(npid,TheFieldSplitBase3_old(npid,sp))            = MW_ni(npid,TheFieldSplitBase3_old(npid,sp)) + (m_sp(sp)*W_sp(sp))*N{sp}(j);
				Mdudx_ni(npid,:,TheFieldSplitBase3_old(npid,sp))            = Mdudx_ni(npid,:,TheFieldSplitBase3_old(npid,sp)) + (m_sp(sp)*dudx_sp(sp,:))*N{sp}(j);
				Ms_ni(npid,:,TheFieldSplitBase3_old(npid,sp))            = Ms_ni(npid,:,TheFieldSplitBase3_old(npid,sp)) + (m_sp(sp)*s_sp(sp,:))*N{sp}(j);
				MK_ni(npid,TheFieldSplitBase3_old(npid,sp))            = MK_ni(npid,TheFieldSplitBase3_old(npid,sp)) + (m_sp(sp)*K_sp(sp))*N{sp}(j);
			end
		end
		%}
		for sp=1:spCount
			for j=1:NODES(sp)
				npid                           = CONNECT{sp}(j);
				if N{sp}(j)==0 || m_sp(sp)==0
					continue
				end
				M_ni(npid,TheFieldSplitBase3{sp}(j,1))            = M_ni(npid,TheFieldSplitBase3{sp}(j,1)) + m_sp(sp)*N{sp}(j);
				MW_ni(npid,TheFieldSplitBase3{sp}(j,1))            = MW_ni(npid,TheFieldSplitBase3{sp}(j,1)) + (m_sp(sp)*W_sp(sp))*N{sp}(j);
				Mdudx_ni(npid,:,TheFieldSplitBase3{sp}(j,1))            = Mdudx_ni(npid,:,TheFieldSplitBase3{sp}(j,1)) + (m_sp(sp)*dudx_sp(sp,:))*N{sp}(j);
				Ms_ni(npid,:,TheFieldSplitBase3{sp}(j,1))            = Ms_ni(npid,:,TheFieldSplitBase3{sp}(j,1)) + (m_sp(sp)*s_sp(sp,:))*N{sp}(j);
				MK_ni(npid,TheFieldSplitBase3{sp}(j,1))            = MK_ni(npid,TheFieldSplitBase3{sp}(j,1)) + (m_sp(sp)*K_sp(sp))*N{sp}(j);
			end 
		end
		
		sidegap=mod(side_bot-side_top,4);
		J1=0;
		J2=0;
		hoopstress=[];
		hooptheta=[];
		hoopindex=0;
		dudx_ni_before=zeros(1,4);
		dudx_ni_after=zeros(1,4);
		s_ni_before=zeros(1,3);
		s_ni_after=zeros(1,3);
		n=zeros(2,1);
		for relativeside=0:4-sidegap
			side=mod(side_bot-1+relativeside,4)+1;
			startsidenode=1;
			endsidenode=(2*expansion)+1;
			if relativeside==0
				startsidenode=sideline_bot;
			elseif relativeside==4-sidegap
				endsidenode=sideline_top+1;
			end
			for sideline=startsidenode:endsidenode-1
				nodebefore=ni_list{side}(sideline);
				nodeafter=ni_list{side}(sideline+1);
				if relativeside==0 || relativeside==1
					sumsequence=1:2:3;
				elseif relativeside==(4-sidegap) || relativeside==(4-sidegap-1)
					sumsequence=1:2;
				else
					sumsequence=1:3;
				end
				M_before=sum(M_ni(nodebefore,sumsequence));
				if M_before==0
					W_ni_before=0;
					dudx_ni_before(1:4)=0;
					s_ni_before(1:3)=0;
					K_ni_before=0;
				else
					W_ni_before=sum(MW_ni(nodebefore,sumsequence))/M_before;
					K_ni_before=sum(MK_ni(nodebefore,:))/M_before;
					for index=1:4
						dudx_ni_before(index)=sum(Mdudx_ni(nodebefore,index,sumsequence))/M_before;
					end
					for index=1:3
						s_ni_before(index)=sum(Ms_ni(nodebefore,index,sumsequence))/M_before;
					end
				end
				M_after=sum(M_ni(nodeafter,sumsequence));
				if M_after==0
					W_ni_after=0;
					dudx_ni_after(1:4)=0;
					s_ni_after(1:3)=0;
					K_ni_after=0;
				else
					W_ni_after=sum(MW_ni(nodeafter,sumsequence))/M_after;
					K_ni_after=sum(MK_ni(nodeafter,:))/M_after;
					for index=1:4
						dudx_ni_after(index)=sum(Mdudx_ni(nodeafter,index,sumsequence))/M_after;
					end
					for index=1:3
						s_ni_after(index)=sum(Ms_ni(nodeafter,index,sumsequence))/M_after;
					end
				end
				if relativeside==0 && sideline==startsidenode
					hoopindex=hoopindex+1;
					currentnode=nodebefore;
					hooptheta=VectorInsertion(hooptheta,hoopindex,reliableatan(LOC(currentnode,1)-x_crack{1}(n_tip,1),LOC(currentnode,2)-x_crack{1}(n_tip,2)));
					Q=[cos(hooptheta(hoopindex)) sin(hooptheta(hoopindex));-sin(hooptheta(hoopindex)) cos(hooptheta(hoopindex))];
					oldsigma=[s_ni_before(1) s_ni_before(3);s_ni_before(3) s_ni_before(2)];
					newsigma=Q*oldsigma*transpose(Q);
					hoopstress=VectorInsertion(hoopstress,hoopindex,newsigma(2,2));
				end
				
				hoopindex=hoopindex+1;
				currentnode=nodeafter;
				hooptheta=VectorInsertion(hooptheta,hoopindex,reliableatan(LOC(currentnode,1)-x_crack{1}(n_tip,1),LOC(currentnode,2)-x_crack{1}(n_tip,2)));
				Q=[cos(hooptheta(hoopindex)) sin(hooptheta(hoopindex));-sin(hooptheta(hoopindex)) cos(hooptheta(hoopindex))];
				oldsigma=[s_ni_after(1) s_ni_after(3);s_ni_after(3) s_ni_after(2)];
				newsigma=Q*oldsigma*transpose(Q);
				hoopstress=VectorInsertion(hoopstress,hoopindex,newsigma(2,2));
				
				if side==1
					n(1,1)=-1;
					n(2,1)=0;
				elseif side==2
					n(1,1)=0;
					n(2,1)=-1;
				elseif side==3
					n(1,1)=1;
					n(2,1)=0;
				elseif side==4
					n(1,1)=0;
					n(2,1)=1;
				end
				
				F1before=(W_ni_before+K_ni_before)*n(1)-dot([s_ni_before(1) s_ni_before(3);s_ni_before(3) s_ni_before(2)]*n,[dudx_ni_before(1);dudx_ni_before(3)]);
				F2before=(W_ni_before+K_ni_before)*n(2)-dot([s_ni_before(1) s_ni_before(3);s_ni_before(3) s_ni_before(2)]*n,[dudx_ni_before(2);dudx_ni_before(4)]);
				
				F1after=(W_ni_after+K_ni_after)*n(1)-dot([s_ni_after(1) s_ni_after(3);s_ni_after(3) s_ni_after(2)]*n,[dudx_ni_after(1);dudx_ni_after(3)]);
				F2after=(W_ni_after+K_ni_after)*n(2)-dot([s_ni_after(1) s_ni_after(3);s_ni_after(3) s_ni_after(2)]*n,[dudx_ni_after(2);dudx_ni_after(4)]);
				
				
				%The following is just for debugging purposes:
				%{
				W_ni_before_track(side,sideline)=W_ni_before;
				W_ni_after_track(side,sideline)=W_ni_after;
				W_ni_track(side,sideline)=(W_ni_before+W_ni_after)/2;
				
				K_ni_before_track(side,sideline)=K_ni_before;
				K_ni_after_track(side,sideline)=K_ni_after;
				K_ni_track(side,sideline)=(K_ni_before+K_ni_after)/2;
				
				n1(side,sideline)=n(1);
				n2(side,sideline)=n(2);
				
				indot1_before_track(side,sideline)=dot([s_ni_before(1) s_ni_before(3);s_ni_before(3) s_ni_before(2)]*n,[dudx_ni_before(1);dudx_ni_before(3)]);
				indot1_after_track(side,sideline)=dot([s_ni_after(1) s_ni_after(3);s_ni_after(3) s_ni_after(2)]*n,[dudx_ni_after(1);dudx_ni_after(3)]);
				indot1_track(side,sideline)=(indot1_before_track(side,sideline)+indot1_after_track(side,sideline))/2;
				
				s_ni_1_before_track(side,sideline)=s_ni_before(1);
				s_ni_2_before_track(side,sideline)=s_ni_before(2);
				s_ni_3_before_track(side,sideline)=s_ni_before(3);
				
				s_ni_1_after_track(side,sideline)=s_ni_after(1);
				s_ni_2_after_track(side,sideline)=s_ni_after(2);
				s_ni_3_after_track(side,sideline)=s_ni_after(3);
				
				dudx_ni_1_before_track(side,sideline)=dudx_ni_before(1);
				dudx_ni_2_before_track(side,sideline)=dudx_ni_before(2);
				dudx_ni_3_before_track(side,sideline)=dudx_ni_before(3);
				dudx_ni_4_before_track(side,sideline)=dudx_ni_before(4);
				
				dudx_ni_1_after_track(side,sideline)=dudx_ni_after(1);
				dudx_ni_2_after_track(side,sideline)=dudx_ni_after(2);
				dudx_ni_3_after_track(side,sideline)=dudx_ni_after(3);
				dudx_ni_4_after_track(side,sideline)=dudx_ni_after(4);
				
				dudx_ni_1_avg_track(side,sideline)=(dudx_ni_before(1)+dudx_ni_after(1))/2;
				dudx_ni_2_avg_track(side,sideline)=(dudx_ni_before(2)+dudx_ni_after(2))/2;
				dudx_ni_3_avg_track(side,sideline)=(dudx_ni_before(3)+dudx_ni_after(3))/2;
				dudx_ni_4_avg_track(side,sideline)=(dudx_ni_before(4)+dudx_ni_after(4))/2;
				
				s_ni_1_avg(side,sideline)=(s_ni_1_before_track(side,sideline)+s_ni_1_after_track(side,sideline))/2;
				s_ni_2_avg(side,sideline)=(s_ni_2_before_track(side,sideline)+s_ni_2_after_track(side,sideline))/2;
				s_ni_3_avg(side,sideline)=(s_ni_3_before_track(side,sideline)+s_ni_3_after_track(side,sideline))/2;
				
				indot2_before_track(side,sideline)=dot([s_ni_before(1) s_ni_before(3);s_ni_before(3) s_ni_before(2)]*n,[dudx_ni_before(2);dudx_ni_before(4)]);
				indot2_after_track(side,sideline)=dot([s_ni_after(1) s_ni_after(3);s_ni_after(3) s_ni_after(2)]*n,[dudx_ni_after(2);dudx_ni_after(4)]);
				indot2_track(side,sideline)=(indot2_before_track(side,sideline)+indot2_after_track(side,sideline))/2;
				
				W_ni_contributionto1(side,sideline)=W_ni_track(side,sideline)*n1(side,sideline);
				W_ni_contributionto2(side,sideline)=W_ni_track(side,sideline)*n2(side,sideline);
				
				K_ni_contributionto1(side,sideline)=K_ni_track(side,sideline)*n1(side,sideline);
				K_ni_contributionto2(side,sideline)=K_ni_track(side,sideline)*n2(side,sideline);
				%}
				
				
				if relativeside==0 && sideline==startsidenode
					F1before=F1before*(1-RelativeLocation_bot)+F1after*(RelativeLocation_bot);
					F2before=F2before*(1-RelativeLocation_bot)+F2after*(RelativeLocation_bot);
					deltai=(1-RelativeLocation_bot)*le(1); %assuming square grid
				elseif relativeside==4-sidegap && sideline==endsidenode-1
					F1after=F1before*(1-RelativeLocation_top)+F1after*(RelativeLocation_top);
					F2after=F2before*(1-RelativeLocation_top)+F2after*(RelativeLocation_top);
					deltai=RelativeLocation_top*le(1); %assuming square grid
				end
				
				%The following is just for debugging purposes:
				%{				
				F1before_store(side,sideline)=F1before;
				F2before_store(side,sideline)=F2before;
				F1after_store(side,sideline)=F1after;
				F2after_store(side,sideline)=F2after;
				%}
				
				J1=J1+(F1before+F1after)/2*deltai;
				J2=J2+(F2before+F2after)/2*deltai;
			end
		end
		deltax_crack=x_crack{1}(n_tip,1)-x_crack{1}(n_tip-1,1);
		deltay_crack=x_crack{1}(n_tip,2)-x_crack{1}(n_tip-1,2);
		
		
		thetacold=reliableatan(deltax_crack,deltay_crack);
		%thetac=reliableatan(J1,J2);
		%thetac=thetacold;
		%thetac=thetamin;
		maxhoopstresssofar=[];
		for i=1:length(hooptheta)
			deltathetac=mod((hooptheta(i)-thetacold)+pi,2*pi)-pi;
			if deltathetac<-pi/2 || deltathetac>pi/2
				continue;
			end
			if length(maxhoopstresssofar)==0
				maxhoopstresssofar=hoopstress(i);
				maxhoopstressnumsofar=i;
			else
				if hoopstress(i)>maxhoopstresssofar
					maxhoopstresssofar=hoopstress(i);
					maxhoopstressnumsofar=i;
				end
			end
		end
		thetac=hooptheta(maxhoopstressnumsofar);
		if CasetoRun==116 || CasetoRun==117 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==120 || CasetoRun==121
			thetac=0;
		end
		deltathetac=mod((thetac-thetacold)+pi,2*pi)-pi;
		newcrackdistance=sqrt(deltax_crack^2+deltay_crack^2);
		G=J1*cos(thetac)+J2*sin(thetac);
		%disp(['G=' num2str(G) ', thetac=' num2str(thetac*180/3.1415926536) ' degrees']);
	else
		%start function for calculating J integral
		K_sp=0.5*(p_sp.*(v_ssp_out(:,1).^2 + v_ssp_out(:,2).^2));
		n_tip=size(x_crack,1);
		x_tip=x_crack(n_tip,:);
		ni_Jcenter=FindMax(Nmatrix_crack(:,n_tip));
		if CasetoRun==68 || CasetoRun==71 || CasetoRun==72 || CasetoRun==73 || CasetoRun==74 || CasetoRun==78 || CasetoRun==81 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==83 || CasetoRun==84 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124 || CasetoRun==117 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110 || CasetoRun==96 || CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89 || CasetoRun==85 || CasetoRun==77
			for moveJcenterrepeate=0:999999
				if LOC(ni_Jcenter,2)>50-expansion*le(2)
					ni_Jcenter=ni_Jcenter-NN(1);
				elseif LOC(ni_Jcenter,2)<10+expansion*le(2)
					ni_Jcenter=ni_Jcenter+NN(1);
					expansion=2;
				elseif CasetoRun==69
					expansion=2;
				else
					expansion=2;
				end
				if CasetoRun==71
				else
					break;
					1;
				end
			end
		elseif CasetoRun==72
			for moveJcenterrepeate=0:999999
				if LOC(ni_Jcenter,2)>40-expansion*le(2)
					ni_Jcenter=ni_Jcenter-NN(1);
				elseif LOC(ni_Jcenter,2)<10+expansion*le(2)
					ni_Jcenter=ni_Jcenter+NN(1);
				else
					break;
					1;
				end
			end
		end
		
		n_pointperside=2*expansion+1;
		
		%listing surrounding nodes in counter-clockwise order
		ni_list{4}(n_pointperside)=0;
		ni_list{3}(n_pointperside)=0;
		ni_list{2}(n_pointperside)=0;
		ni_list{1}(n_pointperside)=0;
		%ni_list index: 1 = left, 2 = bottom, 3 = right, 4 = top
		
		for i=1:n_pointperside
			ni_list{1}(i)=ni_Jcenter-expansion+expansion*NN(1)-(i-1)*NN(1);
			ni_list{2}(i)=ni_Jcenter-expansion*NN(1)-expansion+(i-1);
			ni_list{3}(i)=ni_Jcenter+expansion-expansion*NN(1)+(i-1)*NN(1);
			ni_list{4}(i)=ni_Jcenter+expansion*NN(1)+expansion-(i-1);
		end
		
		
		for toporbot=1:2
			sidebreaksignal=0;
			for crackline=(n_tip-1):-1:1
				for side=1:4
					for sideline=1:(length(ni_list{side})-1)
						if side==3 && sideline==2 && crackline==2
							1;
						end
						x1=LOC(ni_list{side}(sideline),:);
						x2=LOC(ni_list{side}(sideline+1),:);
						if toporbot==1
							x3=x_cracktop(crackline,:);
							x4=x_cracktop(crackline+1,:);
							[CrossDir,RelativeLocation]=FindCrossing(x1,x2,x3,x4);
						elseif toporbot==2
							x3=x_crackbot(crackline,:);
							x4=x_crackbot(crackline+1,:);
							[CrossDir,RelativeLocation]=FindCrossing(x1,x2,x3,x4);
						end
						if CrossDir>0
							sidebreaksignal=1;
							break;
						end
					end
					if sidebreaksignal==1
						break;
					end
				end
				if sidebreaksignal==1
					break;
				end
			end
			if toporbot==1
				crackline_top=crackline;
				side_top=side;
				sideline_top=sideline;
				CrossDir_top=CrossDir;
				RelativeLocation_top=RelativeLocation;
			elseif toporbot==2
				crackline_bot=crackline;
				side_bot=side;
				sideline_bot=sideline;
				CrossDir_bot=CrossDir;
				RelativeLocation_bot=RelativeLocation;
			end
		end
		nNodes=size(CONNECTpn,1);
		M_ni=zeros(nNodes,3);
		MW_ni=zeros(nNodes,3);
		Mdudx_ni=zeros(nNodes,4,3);
		Ms_ni=zeros(nNodes,3,3);
		MK_ni=zeros(nNodes,3);
		for field=1:size(Nmatrix,3)
			M_ni(:,field)=Nmatrix(:,:,field)*m_sp;
			MW_ni(:,field)=Nmatrix(:,:,field)*(m_sp.*W_sp);
			Mdudx_ni(:,:,field)=Nmatrix(:,:,field)*(m_sp.*dudx_sp);
			Ms_ni(:,:,field)=Nmatrix(:,:,field)*(m_sp.*s_sp);
			MK_ni(:,:,field)=Nmatrix(:,:,field)*(m_sp.*K_sp);
		end
		sidegap=mod(side_bot-side_top,4);
		J1=0;
		J2=0;
		hoopstress=[];
		hooptheta=[];
		hoopindex=0;
		dudx_ni_before=zeros(1,4);
		dudx_ni_after=zeros(1,4);
		s_ni_before=zeros(1,3);
		s_ni_after=zeros(1,3);
		for relativeside=0:4-sidegap
			side=mod(side_bot-1+relativeside,4)+1;
			startsidenode=1;
			endsidenode=(2*expansion)+1;
			if relativeside==0
				startsidenode=sideline_bot;
			elseif relativeside==4-sidegap
				endsidenode=sideline_top+1;
			end
			for sideline=startsidenode:endsidenode-1
				nodebefore=ni_list{side}(sideline);
				nodeafter=ni_list{side}(sideline+1);
				if relativeside==0 || relativeside==1
					sumsequence=1:2:3;
				elseif relativeside==(4-sidegap) || relativeside==(4-sidegap-1)
					sumsequence=1:2;
				else
					sumsequence=1:3;
				end
				M_before=sum(M_ni(nodebefore,sumsequence));
				if M_before==0
					W_ni_before=0;
					dudx_ni_before(1:4)=0;
					s_ni_before(1:3)=0;
					K_ni_before=0;
				else
					W_ni_before=sum(MW_ni(nodebefore,sumsequence))/M_before;
					K_ni_before=sum(MK_ni(nodebefore,:))/M_before;
					for index=1:4
						dudx_ni_before(index)=sum(Mdudx_ni(nodebefore,index,sumsequence))/M_before;
					end
					for index=1:3
						s_ni_before(index)=sum(Ms_ni(nodebefore,index,sumsequence))/M_before;
					end
				end
				
				M_after=sum(M_ni(nodeafter,sumsequence));
				if M_after==0
					W_ni_after=0;
					dudx_ni_after(1:4)=0;
					s_ni_after(1:3)=0;
					K_ni_after=0;
				else
					W_ni_after=sum(MW_ni(nodeafter,sumsequence))/M_after;
					K_ni_after=sum(MK_ni(nodeafter,:))/M_after;
					for index=1:4
						if side==1 && sideline==1 && index==2
							1;
						end
						dudx_ni_after(index)=sum(Mdudx_ni(nodeafter,index,sumsequence))/M_after;
					end
					for index=1:3
						s_ni_after(index)=sum(Ms_ni(nodeafter,index,sumsequence))/M_after;
					end
				end
				if relativeside==0 && sideline==startsidenode
					hoopindex=hoopindex+1;
					currentnode=nodebefore;
					hooptheta=VectorInsertion(hooptheta,hoopindex,reliableatan(LOC(currentnode,1)-x_crack(n_tip,1),LOC(currentnode,2)-x_crack(n_tip,2)));
					Q=[cos(hooptheta(hoopindex)) sin(hooptheta(hoopindex));-sin(hooptheta(hoopindex)) cos(hooptheta(hoopindex))];
					oldsigma=[s_ni_before(1) s_ni_before(3);s_ni_before(3) s_ni_before(2)];
					newsigma=Q*oldsigma*transpose(Q);
					hoopstress=VectorInsertion(hoopstress,hoopindex,newsigma(2,2));
				end
				
				hoopindex=hoopindex+1;
				currentnode=nodeafter;
				hooptheta=VectorInsertion(hooptheta,hoopindex,reliableatan(LOC(currentnode,1)-x_crack(n_tip,1),LOC(currentnode,2)-x_crack(n_tip,2)));
				Q=[cos(hooptheta(hoopindex)) sin(hooptheta(hoopindex));-sin(hooptheta(hoopindex)) cos(hooptheta(hoopindex))];
				oldsigma=[s_ni_after(1) s_ni_after(3);s_ni_after(3) s_ni_after(2)];
				newsigma=Q*oldsigma*transpose(Q);
				hoopstress=VectorInsertion(hoopstress,hoopindex,newsigma(2,2));
				
				if side==1
					n(1,1)=-1;
					n(2,1)=0;
				elseif side==2
					n(1,1)=0;
					n(2,1)=-1;
				elseif side==3
					n(1,1)=1;
					n(2,1)=0;
				elseif side==4
					n(1,1)=0;
					n(2,1)=1;
				end
				
				F1before=(W_ni_before+K_ni_before)*n(1)-dot([s_ni_before(1) s_ni_before(3);s_ni_before(3) s_ni_before(2)]*n,[dudx_ni_before(1);dudx_ni_before(3)]);
				F2before=(W_ni_before+K_ni_before)*n(2)-dot([s_ni_before(1) s_ni_before(3);s_ni_before(3) s_ni_before(2)]*n,[dudx_ni_before(2);dudx_ni_before(4)]);
				
				F1after=(W_ni_after+K_ni_after)*n(1)-dot([s_ni_after(1) s_ni_after(3);s_ni_after(3) s_ni_after(2)]*n,[dudx_ni_after(1);dudx_ni_after(3)]);
				F2after=(W_ni_after+K_ni_after)*n(2)-dot([s_ni_after(1) s_ni_after(3);s_ni_after(3) s_ni_after(2)]*n,[dudx_ni_after(2);dudx_ni_after(4)]);
				%{
				W_ni_before_track(side,sideline)=W_ni_before;
				W_ni_after_track(side,sideline)=W_ni_after;
				W_ni_track(side,sideline)=(W_ni_before+W_ni_after)/2;
				
				K_ni_before_track(side,sideline)=K_ni_before;
				K_ni_after_track(side,sideline)=K_ni_after;
				K_ni_track(side,sideline)=(K_ni_before+K_ni_after)/2;
				
				n1(side,sideline)=n(1);
				n2(side,sideline)=n(2);
				
				indot1_before_track(side,sideline)=dot([s_ni_before(1) s_ni_before(3);s_ni_before(3) s_ni_before(2)]*n,[dudx_ni_before(1);dudx_ni_before(3)]);
				indot1_after_track(side,sideline)=dot([s_ni_after(1) s_ni_after(3);s_ni_after(3) s_ni_after(2)]*n,[dudx_ni_after(1);dudx_ni_after(3)]);
				indot1_track(side,sideline)=(indot1_before_track(side,sideline)+indot1_after_track(side,sideline))/2;
				
				s_ni_1_before_track(side,sideline)=s_ni_before(1);
				s_ni_2_before_track(side,sideline)=s_ni_before(2);
				s_ni_3_before_track(side,sideline)=s_ni_before(3);
				
				s_ni_1_after_track(side,sideline)=s_ni_after(1);
				s_ni_2_after_track(side,sideline)=s_ni_after(2);
				s_ni_3_after_track(side,sideline)=s_ni_after(3);
				
				dudx_ni_1_before_track(side,sideline)=dudx_ni_before(1);
				dudx_ni_2_before_track(side,sideline)=dudx_ni_before(2);
				dudx_ni_3_before_track(side,sideline)=dudx_ni_before(3);
				dudx_ni_4_before_track(side,sideline)=dudx_ni_before(4);
				
				dudx_ni_1_after_track(side,sideline)=dudx_ni_after(1);
				dudx_ni_2_after_track(side,sideline)=dudx_ni_after(2);
				dudx_ni_3_after_track(side,sideline)=dudx_ni_after(3);
				dudx_ni_4_after_track(side,sideline)=dudx_ni_after(4);
				
				dudx_ni_1_avg_track(side,sideline)=(dudx_ni_before(1)+dudx_ni_after(1))/2;
				dudx_ni_2_avg_track(side,sideline)=(dudx_ni_before(2)+dudx_ni_after(2))/2;
				dudx_ni_3_avg_track(side,sideline)=(dudx_ni_before(3)+dudx_ni_after(3))/2;
				dudx_ni_4_avg_track(side,sideline)=(dudx_ni_before(4)+dudx_ni_after(4))/2;
				
				s_ni_1_avg(side,sideline)=(s_ni_1_before_track(side,sideline)+s_ni_1_after_track(side,sideline))/2;
				s_ni_2_avg(side,sideline)=(s_ni_2_before_track(side,sideline)+s_ni_2_after_track(side,sideline))/2;
				s_ni_3_avg(side,sideline)=(s_ni_3_before_track(side,sideline)+s_ni_3_after_track(side,sideline))/2;
				
				indot2_before_track(side,sideline)=dot([s_ni_before(1) s_ni_before(3);s_ni_before(3) s_ni_before(2)]*n,[dudx_ni_before(2);dudx_ni_before(4)]);
				indot2_after_track(side,sideline)=dot([s_ni_after(1) s_ni_after(3);s_ni_after(3) s_ni_after(2)]*n,[dudx_ni_after(2);dudx_ni_after(4)]);
				indot2_track(side,sideline)=(indot2_before_track(side,sideline)+indot2_after_track(side,sideline))/2;
				
				W_ni_contributionto1(side,sideline)=W_ni_track(side,sideline)*n1(side,sideline);
				W_ni_contributionto2(side,sideline)=W_ni_track(side,sideline)*n2(side,sideline);
				
				K_ni_contributionto1(side,sideline)=K_ni_track(side,sideline)*n1(side,sideline);
				K_ni_contributionto2(side,sideline)=K_ni_track(side,sideline)*n2(side,sideline);
				%}
				if relativeside==0 && sideline==startsidenode
					F1before=F1before*(1-RelativeLocation_bot)+F1after*(RelativeLocation_bot);
					F2before=F2before*(1-RelativeLocation_bot)+F2after*(RelativeLocation_bot);
					deltai=(1-RelativeLocation_bot)*le(1); %assuming square grid
				elseif relativeside==4-sidegap && sideline==endsidenode-1
					F1after=F1before*(1-RelativeLocation_top)+F1after*(RelativeLocation_top);
					F2after=F2before*(1-RelativeLocation_top)+F2after*(RelativeLocation_top);
					deltai=RelativeLocation_top*le(1); %assuming square grid
				end
				J1=J1+(F1before+F1after)/2*deltai;
				J2=J2+(F2before+F2after)/2*deltai;
			end
		
		end
		deltax_crack=x_crack(n_tip,1)-x_crack(n_tip-1,1);
		deltay_crack=x_crack(n_tip,2)-x_crack(n_tip-1,2);
		%{
		nx_cell=ceil(x_crack(n_tip,1)/le(1));
		ny_cell=ceil(x_crack(n_tip,2)/le(2));
		ni_bl=nx_cell+(ny_cell-1)*NN(1);
		ni_br=ni_bl+1;
		ni_tl=ni_bl+NN(1);
		ni_tr=ni_tl+1;
		x_factor=(x_crack(n_tip,1)-LOC(ni_bl,1))/(LOC(ni_br,1)-LOC(ni_bl,1));
		y_factor=(x_crack(n_tip,2)-LOC(ni_bl,2))/(LOC(ni_tl,2)-LOC(ni_bl,2));
		
		
		M_ni_all=M_ni(:,1)+M_ni(:,2)+M_ni(:,3);
		Ms_ni_all=Ms_ni(:,:,1)+Ms_ni(:,:,2)+Ms_ni(:,:,3);
		
		s_ni_bl=Ms_ni_all(ni_bl,:)/M_ni_all(ni_bl);
		s_ni_br=Ms_ni_all(ni_br,:)/M_ni_all(ni_br);
		s_ni_tl=Ms_ni_all(ni_tl,:)/M_ni_all(ni_tl);
		s_ni_tr=Ms_ni_all(ni_tr,:)/M_ni_all(ni_tr);
		
		s_ni_tip=(s_ni_bl*(1-x_factor)+s_ni_br*x_factor)*(1-y_factor)+(s_ni_tl*(1-x_factor)+s_ni_tr*x_factor)*y_factor;
		
		thetaprinc=1/2*atan(2*s_ni_tip(1,3)/(s_ni_tip(1,1)-s_ni_tip(1,2)));
		s_ni_tip_first=(s_ni_tip(1,1)+s_ni_tip(1,2))/2+(s_ni_tip(1,1)-s_ni_tip(1,2))/2*cos(2*thetaprinc)+s_ni_tip(1,3)*sin(2*thetaprinc);
		s_ni_tip_second=(s_ni_tip(1,1)+s_ni_tip(1,2))/2-(s_ni_tip(1,1)-s_ni_tip(1,2))/2*cos(2*thetaprinc)-s_ni_tip(1,3)*sin(2*thetaprinc);
		
		if s_ni_tip_first>s_ni_tip_second
			thetamin=thetaprinc+pi/2;
		else
			thetamin=thetaprinc;
		end
		
		thetamin=mod(thetamin+pi/2,pi)-pi/2;
		%}
		thetacold=reliableatan(deltax_crack,deltay_crack);
		%thetac=reliableatan(J1,J2);
		%thetac=thetacold;
		%thetac=thetamin;
		maxhoopstresssofar=[];
		for i=1:length(hooptheta)
			deltathetac=mod((hooptheta(i)-thetacold)+pi,2*pi)-pi;
			if deltathetac<-pi/2 || deltathetac>pi/2
				continue;
			end
			if length(maxhoopstresssofar)==0
				maxhoopstresssofar=hoopstress(i);
				maxhoopstressnumsofar=i;
			else
				if hoopstress(i)>maxhoopstresssofar
					maxhoopstresssofar=hoopstress(i);
					maxhoopstressnumsofar=i;
				end
			end
		end
		thetac=hooptheta(maxhoopstressnumsofar);
		deltathetac=mod((thetac-thetacold)+pi,2*pi)-pi;
		newcrackdistance=sqrt(deltax_crack^2+deltay_crack^2);
		G=J1*cos(thetac)+J2*sin(thetac);
		fprintf('%s',['G=' float2txt(5,G) ', thetac=' float2txt(5,thetac*180/3.1415926536) ' degrees' char(10)]);
		if CasetoRun==64 || CasetoRun==65 || CasetoRun==70 || CasetoRun==66 || CasetoRun==67 || CasetoRun==68 || CasetoRun==71 || CasetoRun==72
			Gcnow=0.14;
			if CasetoRun==68
				Gcnow=0.5;
			end
			if G>Gcnow && deltathetac<pi && deltathetac>-pi
				newx_crack=x_crack(n_tip,:)+newcrackdistance*[cos(thetac) sin(thetac)]
				x_crack=[x_crack;newx_crack]
				x_cracktop=[x_cracktop;newx_crack];
				x_crackbot=[x_crackbot;newx_crack];
				1;
			end
		end
	end
	%{
	disp('intersection found!')
	disp(['crackline=' num2str(crackline) ' out of ' num2str(n_tip-1)]);
	disp(['side=' num2str(side)]);
	disp(['sideline=' num2str(sideline) ' out of ' num2str(length(ni_list{side})-1)]);
	disp(['CrossDir=' num2str(CrossDir)]);
	disp(['RelativeLocation=' num2str(RelativeLocation)]);
	AbsoluteLocation=LOC(ni_list{side}(sideline),:)+LOC(ni_list{side}(sideline+1),:)*RelativeLocation;
	disp(['Absolute Coordinate = (' num2str(AbsoluteLocation,1) ',' num2str(AbsoluteLocation,2) ')']);
	
	pause
	1;
	%}
	
	%end function for calculating J
	
	energy.kinetic.value=0;
	energy.strain.value=0;
	for ip=1:spCount
		energy.kinetic.value=energy.kinetic.value+0.5*m_sp(ip)*(v_ssp_out(ip,1)^2+v_ssp_out(ip,2)^2);
		energy.strain.value=energy.strain.value+sse_sp(ip)*A_sp(ip)*t_sp(ip);
	end
	
	
	%% Update the topology of particles
	%if CasetoRun==12 || CasetoRun==16 || CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44
	%else
	[r1_sp,r2_sp] = Update_topology(spCount,F_sp,r1_sp,r10_sp,r2_sp,r20_sp);
	r1_sp=real(r1_sp);
	r2_sp=real(r2_sp);
	%end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [thecell, thenodes, cellcentralcoordinates, cellnodescoordinates]=identifycellsandnodes_reg(x_sp,LOC,LOCC,outputrequest)
	LOCX=[0:1:NN(1)]*le(1);
	LOCY=[0:1:NN(2)]*le(2);
    xindex=0;
    yindex=0;
    for i=1:length(LOCX)
        if x_sp(1)<LOCX(i)
            xindex=i-1;
            break;
        end
    end
    for i=1:length(LOCY)
        if x_sp(2)<LOCY(i)
            yindex=i-1;
            break;
        end
    end
    if outputrequest(1)==1
        thecell=(yindex-1)*(length(LOCX)-1)+xindex;
    end
    if outputrequest(2)==1
		thenodes=zeros(1,4);
        thenodes(1)=(yindex-1)*(length(LOCX))+xindex;
        thenodes(2)=thenodes(1)+1;
        thenodes(3)=thenodes(1)+length(LOCX);
        thenodes(4)=thenodes(3)+1;
    end
    if outputrequest(3)==1
		cellcentralcoordinates=zeros(size(LOCC(thecell,:)));
        cellcentralcoordinates(1,:)=LOCC(thecell,:);
    end
    if outputrequest(4)==1
		cellnodescoordinates=zeros(4,size(LOC(thenodes(i),:),2));
        for i=1:4
            cellnodescoordinates(i,:)=LOC(thenodes(i),:);
        end
    end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [thecell, thenodes, cellcentralcoordinates, cellnodescoordinates]=identifycellsandnodes(x_sp,LOCX,LOCY,LOC,LOCC,outputrequest)
    xindex=0;
    yindex=0;
    for i=1:length(LOCX)
        if x_sp(1)<LOCX(i)
            xindex=i-1;
            break;
        end
    end
    for i=1:length(LOCY)
        if x_sp(2)<LOCY(i)
            yindex=i-1;
            break;
        end
    end
    if outputrequest(1)==1
        thecell=(yindex-1)*(length(LOCX)-1)+xindex;
    end
    if outputrequest(2)==1
		thenodes=zeros(1,4);
        thenodes(1)=(yindex-1)*(length(LOCX))+xindex;
        thenodes(2)=thenodes(1)+1;
        thenodes(3)=thenodes(1)+length(LOCX);
        thenodes(4)=thenodes(3)+1;
    end
    if outputrequest(3)==1
		cellcentralcoordinates=zeros(1,size(LOCC(thecell,:),2));
        cellcentralcoordinates(1,:)=LOCC(thecell,:);
    end
    if outputrequest(4)==1
		cellnodescoordinates=zeros(4,size(LOC(thenodes(i),:),2));
        for i=1:4
            cellnodescoordinates(i,:)=LOC(thenodes(i),:);
        end
    end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [TheFieldSplit,Nmatrix,dNxmatrix,dNymatrix,Nmatrixtop,Nmatrixbot,NmatrixAll] = SplitField(spSizes,LOC,x_sp,CONNECT,CONNECTpn,x_crack_centeronly,CONNECT_crack,CONNECTpn_crack,Nmatrix,dNxmatrix,dNymatrix,t_time)
	NmatrixAll=Nmatrix;
	Nmatrixtop=zeros(size(NmatrixAll));
	Nmatrixbot=zeros(size(NmatrixAll));
	Nmatrix(1,1,3)=0;
	dNxmatrix(1,1,3)=0;
	dNymatrix(1,1,3)=0;
	TheFieldSplit=cell(1,lengthCONNECT);
	for sp=1:lengthCONNECT
		TheFieldSplit{sp}=zeros(1,spSizes(sp));
	end
	%for SuspectedNodeCounter=1:length(CONNECTpn_crack)
	Area=zeros(4,1);
	for sp=1:length(CONNECT)
		for ni=1:length(CONNECT{sp})
			Field2Counter=0;
			Field3Counter=0;
			for crack_p_counter=1:(size(x_crack_centeronly,1)-1)
				i=CONNECT{sp}(ni);
				x1=x_sp(sp,:);
				x2=LOC(i,:);
				x3=x_crack_centeronly(crack_p_counter,:);
				x4=x_crack_centeronly(crack_p_counter+1,:);
				Area(1)=TriangleArea(x1,x2,x3);
				Area(2)=TriangleArea(x1,x2,x4);
				Area(3)=TriangleArea(x3,x4,x1);
				Area(4)=TriangleArea(x3,x4,x2);
				if Area(1)<0 && Area(2)>=0 && Area(3)>=0 && Area(4)<0
                    %{
                    if sp==220 && ni==8 && CloseEnough(x1(1),58.740308582876274101636226987466,1e-5,2)
                        1;
                        plot(x1(1),x1(2),'o','DisplayName','particle')
                        hold on
                        plot(x2(1),x2(2),'o','DisplayName','node')
                        plot(x3(1),x3(2),'o','DisplayName','crackbefore')
                        plot(x4(1),x4(2),'o','DisplayName','crackafter')
                        legend show
                        hold off
                        1;
                    end
                    %}
					Field2Counter=Field2Counter+1;
				elseif Area(1)>=0 && Area(2)<0 && Area(3)<0 && Area(4)>=0
                    %{
                    if sp==220 && ni==8 && CloseEnough(x1(1),58.740308582876274101636226987466,1e-5,2)
                        1;
                        plot(x1(1),x1(2),'o','DisplayName','particle')
                        hold on
                        plot(x2(1),x2(2),'o','DisplayName','node')
                        plot(x3(1),x3(2),'o','DisplayName','crackbefore')
                        plot(x4(1),x4(2),'o','DisplayName','crackafter')
                        legend show
                        hold off
                        1;
                    end
                    %}
					Field3Counter=Field3Counter+1;
				end
            end
            if Field2Counter>0 && Field3Counter>0
                %{
                try
                    asdf(-pi);
                catch exc
                    disp('Field Split Error!');
                    getReport(exc,'extended');
                    pause;
                    1;
                end
                %}
                1;
                Field23Min=min([Field2Counter Field3Counter]);
                Field2Counter=Field2Counter-Field23Min;
                Field3Counter=Field3Counter-Field23Min;
                1;
            end
			if mod(Field2Counter,2)>0
				TheFieldSplit{sp}(ni)=2;
				Nmatrix(i,sp,2)=Nmatrix(i,sp,1);
				Nmatrix(i,sp,1)=0;
				dNxmatrix(i,sp,2)=dNxmatrix(i,sp,1);
				dNxmatrix(i,sp,1)=0;
				dNymatrix(i,sp,2)=dNymatrix(i,sp,1);
				dNymatrix(i,sp,1)=0;
			elseif mod(Field3Counter,2)>0
				TheFieldSplit{sp}(ni)=3;
				Nmatrix(i,sp,3)=Nmatrix(i,sp,1);
				Nmatrix(i,sp,1)=0;
				dNxmatrix(i,sp,3)=dNxmatrix(i,sp,1);
				dNxmatrix(i,sp,1)=0;
				dNymatrix(i,sp,3)=dNymatrix(i,sp,1);
				dNymatrix(i,sp,1)=0;
			end
		end
	end
    for i=1:size(CONNECTpn,1)
		niSize=size(CONNECTpn,2); %size of list of sp for a certain ni
		for nsp=1:size(CONNECTpn,2)
			if CONNECTpn(i,nsp)<1
				niSize=nsp-1;
				break;
			end
		end
		TheFieldSplit_ni=zeros(1,niSize) %A row of TheFieldSplit for a certain ni
		for nsp=1:niSize
			nni=0;
			sp=CONNECTpn(i,nsp);
			for nni=1:length(CONNECT{sp});
				if CONNECT{sp}(nni)==i;
					break;
				end
			end
			TheFieldSplit_ni(1,nsp)=TheFieldSplit{sp}(nni);
		end
        if CloseEnough(t_time,0.25291484448446682753441905333602,1e-5,2) && i==613 %temporary for debugging
            1;
        end
        nodalfieldlist=sort(unique(TheFieldSplit_ni));
		newfieldrevision=1;
        if length(nodalfieldlist)==2
            if nodalfieldlist(1)==1 && nodalfieldlist(2)==2
				newfieldrevision=3;
            elseif nodalfieldlist(1)==1 && nodalfieldlist(2)==3
				newfieldrevision=2;
            end
        elseif length(nodalfieldlist)==3
            fprintf('%s',['Field split error, ignoring 1904092154' char(10)]);
            pause
            1;
        end
		if newfieldrevision>1
			for sp=1:length(CONNECT)
				if TheFieldSplit{sp}(nni)==1
                    TheFieldSplit{sp}(nni)=newfieldrevision;
					Nmatrix(i,sp,newfieldrevision)=Nmatrix(i,sp,1);
					Nmatrix(i,sp,1)=0;
					dNxmatrix(i,sp,newfieldrevision)=dNxmatrix(i,sp,1);
					dNxmatrix(i,sp,1)=0;
					dNymatrix(i,sp,newfieldrevision)=dNymatrix(i,sp,1);
					dNymatrix(i,sp,1)=0;
				end
			end
		end
    end
	for sp=1:length(CONNECT)
		niSize=size(CONNECTpn,2); %size of list of sp for a certain ni
		for nsp=1:size(CONNECTpn,2)
			if CONNECTpn(i,nsp)<1
				niSize=nsp-1;
				break;
			end
		end
		TheFieldSplit_ni=zeros(1,niSize) %A row of TheFieldSplit for a certain ni
		for nsp=1:niSize
			nni=0;
			sp=CONNECTpn(i,nsp);
			for nni=1:length(CONNECT{sp});
				if CONNECT{sp}(nni)==i;
					break;
				end
			end
			TheFieldSplit_ni(1,nsp)=TheFieldSplit{sp}(nni);
		end
		if max(TheFieldSplit_ni)==2
			Nmatrixtop(:,sp)=NmatrixAll(:,sp);
		elseif max(TheFieldSplit_ni)==3
			Nmatrixbot(:,sp)=NmatrixAll(:,sp);
		end
    end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [TheFieldSplit,Nmatrix,dNxmatrix,dNymatrix,NmatrixAll] = SplitFieldMulti(spSizes,LOC,x_sp,CONNECT,CONNECTpn,x_crack,CONNECT_crack,CONNECTpn_crack,Nmatrix,dNxmatrix,dNymatrix,t_time)
	NmatrixAll=Nmatrix;
	numberofcrackpaths=length(x_crack);
	numberoffields=3^numberofcrackpaths;
	if numberoffields>1
        Nmatrix(1,1,numberoffields)=0;
        dNxmatrix(1,1,numberoffields)=0;
        dNymatrix(1,1,numberoffields)=0;
    end
	TheFieldSplit=cell(1,lengthCONNECT);
	for sp=1:lengthCONNECT
		TheFieldSplit{sp}=zeros(1,spSizes(sp));
	end
	TheFieldSplitBase3=cell(1,lengthCONNECT);
	for sp=1:lengthCONNECT
		TheFieldSplitBase3{sp}=zeros(spSizes(sp),numberofcrackpaths);
	end
	
	%for SuspectedNodeCounter=1:length(CONNECTpn_crack)
	Area=zeros(4,1);
	for icrackpath=1:numberofcrackpaths %not to get confused with numberofcrackpaths, icrackpath is the moving number, from 1 to numberofcrackpaths
		for sp=1:length(CONNECT)
			for ni=1:length(CONNECT{sp})
				Field2Counter=0;
				Field3Counter=0;
				for crack_p_counter=1:(size(x_crack{icrackpath},1)-1)
					i=CONNECT{sp}(ni);
					x1=x_sp(sp,:);
					x2=LOC(i,:);
					x3=x_crack{icrackpath}(crack_p_counter,:);
					x4=x_crack{icrackpath}(crack_p_counter+1,:);
					Area(1)=TriangleArea(x1,x2,x3);
					Area(2)=TriangleArea(x1,x2,x4);
					Area(3)=TriangleArea(x3,x4,x1);
					Area(4)=TriangleArea(x3,x4,x2);
					if Area(1)<0 && Area(2)>=0 && Area(3)>=0 && Area(4)<0
						Field2Counter=Field2Counter+1;
					elseif Area(1)>=0 && Area(2)<0 && Area(3)<0 && Area(4)>=0
						%{
						if sp==220 && ni==8 && CloseEnough(x1(1),58.740308582876274101636226987466,1e-5,2)
							1;
							plot(x1(1),x1(2),'o','DisplayName','particle')
							hold on
							plot(x2(1),x2(2),'o','DisplayName','node')
							plot(x3(1),x3(2),'o','DisplayName','crackbefore')
							plot(x4(1),x4(2),'o','DisplayName','crackafter')
							legend show
							hold off
							1;
						end
						%}
						Field3Counter=Field3Counter+1;
					end
				end
				if Field2Counter>0 && Field3Counter>0
					%{
					try
						asdf(-pi);
					catch exc
						disp('Field Split Error!');
						getReport(exc,'extended');
						pause;
						1;
					end
					%}
					1;
					Field23Min=min([Field2Counter Field3Counter]);
					Field2Counter=Field2Counter-Field23Min;
					Field3Counter=Field3Counter-Field23Min;
					1;
				end
				if mod(Field2Counter,2)>0
				%{
					TheFieldSplit(i,sp)=2*icrackpath;
					Nmatrix(i,sp,2*icrackpath)=Nmatrix(i,sp,1);
					Nmatrix(i,sp,1)=0;
					dNxmatrix(i,sp,2*icrackpath)=dNxmatrix(i,sp,1);
					dNxmatrix(i,sp,1)=0;
					dNymatrix(i,sp,2*icrackpath)=dNymatrix(i,sp,1);
					dNymatrix(i,sp,1)=0;
				%}
					TheFieldSplitBase3{sp}(ni,icrackpath)=2;
				elseif mod(Field3Counter,2)>0
				%{
					TheFieldSplit(i,sp)=2*icrackpath+1;
					Nmatrix(i,sp,2*icrackpath+1)=Nmatrix(i,sp,1);
					Nmatrix(i,sp,1)=0;
					dNxmatrix(i,sp,2*icrackpath+1)=dNxmatrix(i,sp,1);
					dNxmatrix(i,sp,1)=0;
					dNymatrix(i,sp,2*icrackpath+1)=dNymatrix(i,sp,1);
					dNymatrix(i,sp,1)=0;
				%}
					TheFieldSplitBase3{sp}(ni,icrackpath)=3;
				end
			end
		end
		
		for i=1:size(CONNECTpn,1)
			CONNECTpnLength=0;
			for j=1:size(CONNECTpn,2);
				if CONNECTpn(i,j)>0
					CONNECTpnLength=CONNECTpnLength+1;
				else
					break;
				end
			end
			nodalfieldlist=sort(unique(TheFieldSplitBase3(i,CONNECTpn(i,1:CONNECTpnLength),icrackpath)));
			newfieldrevision=1;
			if length(nodalfieldlist)==2
				if nodalfieldlist(1)==1 && nodalfieldlist(2)==2
					newfieldrevision=3;
				elseif nodalfieldlist(1)==1 && nodalfieldlist(2)==3
					newfieldrevision=2;
				end
			elseif length(nodalfieldlist)==3
				fprintf('%s',['Field split error! (code 1904012104)' char(10)]);
				pause
				1;
			end
			if newfieldrevision>1
				for nsp=1:CONNECTpnLength
					if TheFieldSplitBase3(i,CONNECTpn(i,nsp),icrackpath)==1
						TheFieldSplitBase3(i,CONNECTpn(i,nsp),icrackpath)=newfieldrevision;
					end
				end
			end
		end

		%{
		for i=1:size(CONNECTpn,1)
			nodalfieldlist=sort(unique(TheFieldSplit(i,:)));
			newfieldrevision=1;
			if length(nodalfieldlist)==2
				if nodalfieldlist(1)==1 && nodalfieldlist(2)==2
					newfieldrevision=3;
				elseif nodalfieldlist(1)==1 && nodalfieldlist(2)==3
					newfieldrevision=2;
				end
			elseif length(nodalfieldlist)==3
				disp('Field split error, ignoring')
				%pause
				1;
			end
			if newfieldrevision>1
				for sp=1:length(CONNECT)
					if TheFieldSplit(i,sp)==1
						TheFieldSplit(i,sp)=newfieldrevision;
						Nmatrix(i,sp,newfieldrevision)=Nmatrix(i,sp,1);
						Nmatrix(i,sp,1)=0;
						dNxmatrix(i,sp,newfieldrevision)=dNxmatrix(i,sp,1);
						dNxmatrix(i,sp,1)=0;
						dNymatrix(i,sp,newfieldrevision)=dNymatrix(i,sp,1);
						dNymatrix(i,sp,1)=0;
					end
				end
			end
		end
		%}
	end
	for i=1:size(TheFieldSplitBase3,1)
		for sp=1:size(TheFieldSplitBase3,2)
			TheFieldSplit(i,sp)=BaseNtoDec(TheFieldSplitBase3(i,sp,:),1,3);
		end
	end
	for i=1:size(TheFieldSplit,1)
		for sp=1:size(TheFieldSplit,2)
			if TheFieldSplit(i,sp)==1
			else
				if TheFieldSplit(i,sp)==9
					1;
				end
				Nmatrix(i,sp,TheFieldSplit(i,sp))=Nmatrix(i,sp,1);
				Nmatrix(i,sp,1)=0;
				
				dNxmatrix(i,sp,TheFieldSplit(i,sp))=dNxmatrix(i,sp,1);
				dNxmatrix(i,sp,1)=0;
				
				dNymatrix(i,sp,TheFieldSplit(i,sp))=dNymatrix(i,sp,1);
				dNymatrix(i,sp,1)=0;
			end
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [TheFieldSplit] = SplitFieldMultiOptimized(LOC,x_sp,CONNECT,CONNECTpn,x_crack,t_time,le)
	numberofcrackpaths=length(x_crack);
	numberoffields=3^numberofcrackpaths;
	trajectory1=0;
	trajectory2=0;

	TheFieldSplit=ones(size(CONNECTpn,1),length(CONNECT));
	TheFieldSplitBase3_old=ones(size(CONNECTpn,1),length(CONNECT),numberofcrackpaths);
	%SplitSourceSplitBase3=zeros(size(CONNECTpn,1),length(CONNECT),numberofcrackpaths);
	
	Area=zeros(4,1);
	for icrackpath=1:numberofcrackpaths %not to get confused with numberofcrackpaths, icrackpath is the moving number, from 1 to numberofcrackpaths
		for sp=1:length(CONNECT)
			for ni=1:length(CONNECT{sp})
				Field2Counter=0;
				Field3Counter=0;
				for crack_p_counter=1:(size(x_crack{icrackpath},1)-1)
					i=CONNECT{sp}(ni);
					x1=x_sp(sp,:);
					x2=LOC(i,:);
					x3=x_crack{icrackpath}(crack_p_counter,:);
					x4=x_crack{icrackpath}(crack_p_counter+1,:);
					Area(1)=TriangleArea(x1,x2,x3);
					Area(2)=TriangleArea(x1,x2,x4);
					Area(3)=TriangleArea(x3,x4,x1);
					Area(4)=TriangleArea(x3,x4,x2);
					if Area(1)<0 && Area(2)>=0 && Area(3)>=0 && Area(4)<0
						Field2Counter=Field2Counter+1;
					elseif Area(1)>=0 && Area(2)<0 && Area(3)<0 && Area(4)>=0
						Field3Counter=Field3Counter+1;
					end
				end
				if Field2Counter>0 && Field3Counter>0
					Field23Min=min([Field2Counter Field3Counter]);
					Field2Counter=Field2Counter-Field23Min;
					Field3Counter=Field3Counter-Field23Min;
				end
				if mod(Field2Counter,2)>0
					TheFieldSplitBase3_old(i,sp,icrackpath)=2;
					%SplitSourceSplitBase3(i,sp,icrackpath)=crack_p_counter;
				elseif mod(Field3Counter,2)>0
					TheFieldSplitBase3_old(i,sp,icrackpath)=3;
					%SplitSourceSplitBase3(i,sp,icrackpath)=crack_p_counter;
				end
			end
		end
		
		for i=1:size(CONNECTpn,1)
			CONNECTpnLength=0;
			for j=1:size(CONNECTpn,2);
				if CONNECTpn(i,j)>0
					CONNECTpnLength=CONNECTpnLength+1;
				else
					break;
				end
			end
			nodalfieldlist=sort(unique(TheFieldSplitBase3_old(i,CONNECTpn(i,1:CONNECTpnLength),icrackpath)));
			newfieldrevision=1;
			if length(nodalfieldlist)==3
				fprintf('%s',['Field split error, applying fix! (code 1904012106)' char(10)]);
				%pause
				1;
				problematicnsp=[];
				for nsp=1:CONNECTpnLength
					if TheFieldSplitBase3_old(i,CONNECTpn(i,nsp),icrackpath)>1
						problematicnsp=[problematicnsp nsp];
					end
                end
				TheFieldSplitBase3_old=TheFieldSplitBase3_old;
				for fixmode=1:3
					% extending the crack
					%fixmode=1: x_crack{npid}(size(x_crack{npid},1),:) extension by le(1)
					%fixmode=2: x_crack{npid}(0,:) extension by le(1)
					%fixmode=3: both extensions
					if fixmode==1
						x_crack_modified=x_crack{icrackpath};
						cracksize=size(x_crack_modified,1);
						trajectory=reliableatan(x_crack{icrackpath}(cracksize,1)-x_crack{icrackpath}(cracksize-1,1),x_crack{icrackpath}(cracksize,2)-x_crack{icrackpath}(cracksize-1,2));
						x_crack_modified(cracksize,1)=x_crack{icrackpath}(cracksize,1)+le(1)*cos(trajectory);
						x_crack_modified(cracksize,2)=x_crack{icrackpath}(cracksize,2)+le(1)*sin(trajectory);
					elseif fixmode==2
						x_crack_modified=x_crack{icrackpath};
						cracksize=size(x_crack_modified,1);
						trajectory=reliableatan(x_crack{icrackpath}(1,1)-x_crack{icrackpath}(2,1),x_crack{icrackpath}(1,2)-x_crack{icrackpath}(2,2));
						x_crack_modified(1,1)=x_crack{icrackpath}(1,1)+le(1)*cos(trajectory);
						x_crack_modified(1,2)=x_crack{icrackpath}(1,2)+le(1)*sin(trajectory);
					elseif fixmode==3
						x_crack_modified=x_crack{icrackpath};
						cracksize=size(x_crack_modified,1);
						trajectory1=reliableatan(x_crack{icrackpath}(cracksize,1)-x_crack{icrackpath}(cracksize-1,1),x_crack{icrackpath}(cracksize,2)-x_crack{icrackpath}(cracksize-1,2));
						x_crack_modified(cracksize,1)=x_crack{icrackpath}(cracksize,1)+le(1)*cos(trajectory1);
						x_crack_modified(cracksize,2)=x_crack{icrackpath}(cracksize,2)+le(1)*sin(trajectory1);
						trajectory2=reliableatan(x_crack{icrackpath}(1,1)-x_crack{icrackpath}(2,1),x_crack{icrackpath}(1,2)-x_crack{icrackpath}(2,2));
						x_crack_modified(1,1)=x_crack{icrackpath}(1,1)+le(1)*cos(trajectory2);
						x_crack_modified(1,2)=x_crack{icrackpath}(1,2)+le(1)*sin(trajectory2);
					end
					% extending the crack finished
					
					% revising bad mapping
					for nsp=1:length(problematicnsp)
						Field2Counter=0;
						Field3Counter=0;
                        sp=CONNECTpn(i,problematicnsp(nsp));
                        TheFieldSplitBase3_old(i,sp,icrackpath)=1;
						for crack_p_counter=1:(size(x_crack_modified,1)-1)
							x1=x_sp(sp,:);
							x2=LOC(i,:);
							x3=x_crack_modified(crack_p_counter,:);
							x4=x_crack_modified(crack_p_counter+1,:);
							Area(1)=TriangleArea(x1,x2,x3);
							Area(2)=TriangleArea(x1,x2,x4);
							Area(3)=TriangleArea(x3,x4,x1);
							Area(4)=TriangleArea(x3,x4,x2);
							if Area(1)<0 && Area(2)>=0 && Area(3)>=0 && Area(4)<0
								Field2Counter=Field2Counter+1;
                                %close gcf;
                                %plot(LOC(i,1),LOC(i,2),'o','DisplayName','Node');
                                %hold on
                                %plot(x_sp(sp,1),x_sp(sp,2),'o','DisplayName','Particle');
                                %plot(x_crack_modified(:,1),x_crack_modified(:,2),'-','DisplayName','Crack Whole');
                                %plot(x_crack_modified(crack_p_counter:crack_p_counter+1,1),x_crack_modified(crack_p_counter:crack_p_counter+1,2),'-o','DisplayName','Crack Interest');
                                %daspect([1 1 1]);
                                %legend show
                                %title(['above, particle=' num2str(sp) ', node=' num2str(i)]);
                                %1;
							elseif Area(1)>=0 && Area(2)<0 && Area(3)<0 && Area(4)>=0
								Field3Counter=Field3Counter+1;
                                %close gcf;
                                %plot(LOC(i,1),LOC(i,2),'o','DisplayName','Node');
                                %hold on
                                %plot(x_sp(sp,1),x_sp(sp,2),'o','DisplayName','Particle');
                                %plot(x_crack_modified(:,1),x_crack_modified(:,2),'-','DisplayName','Crack Whole');
                                %plot(x_crack_modified(crack_p_counter:crack_p_counter+1,1),x_crack_modified(crack_p_counter:crack_p_counter+1,2),'-o','DisplayName','Crack Interest');
                                %daspect([1 1 1]);
                                %legend show
                                %title(['below, particle=' num2str(sp) ', node=' num2str(i)]);
                                %1;
							end
						end
						if Field2Counter>0 && Field3Counter>0
							Field23Min=min([Field2Counter Field3Counter]);
							Field2Counter=Field2Counter-Field23Min;
							Field3Counter=Field3Counter-Field23Min;
						end
						if mod(Field2Counter,2)>0
							TheFieldSplitBase3_old(i,sp,icrackpath)=2;
							%SplitSourceSplitBase3(i,sp,icrackpath)=crack_p_counter;
						elseif mod(Field3Counter,2)>0
							TheFieldSplitBase3_old(i,sp,icrackpath)=3;
							%SplitSourceSplitBase3(i,sp,icrackpath)=crack_p_counter;
						end
					end
					% mapping revision done

					% checking if revision is successful
					nodalfieldlist=sort(unique(TheFieldSplitBase3_old(i,CONNECTpn(i,1:CONNECTpnLength),icrackpath)));
					if length(nodalfieldlist)==3
						fprintf('%s',['fix attempt number ' int2txt(fixmode) ' failed' char(10)]);
						TheFieldSplitBase3_old=TheFieldSplitBase3_old;
						if fixmode==3
							fprintf('%s',['code 1904172033' char(10)]);
							pause
							1;
						end
					elseif length(nodalfieldlist)==2
						fprintf('%s',['fix attempt number ' int2txt(fixmode) ' successful' char(10)]);
						break;
					elseif length(nodalfieldlist)==1
						fprintf('%s',['fix attempt number ' int2txt(fixmode) ' broke separation (code 1904172022)' char(10)]);
						pause
						1;
					end
					% done checking if revision is successful
				end	
			end
			if length(nodalfieldlist)==2
				if nodalfieldlist(1)==1 && nodalfieldlist(2)==2
					newfieldrevision=3;
				elseif nodalfieldlist(1)==1 && nodalfieldlist(2)==3
					newfieldrevision=2;
				end
			end
			if newfieldrevision>1
				for nsp=1:CONNECTpnLength
					if TheFieldSplitBase3_old(i,CONNECTpn(i,nsp),icrackpath)==1
						TheFieldSplitBase3_old(i,CONNECTpn(i,nsp),icrackpath)=newfieldrevision;
					end
				end
			end
		end
	end
	for i=1:size(TheFieldSplitBase3_old,1)
		for sp=1:size(TheFieldSplitBase3_old,2)
			TheFieldSplit(i,sp)=BaseNtoDec(TheFieldSplitBase3_old(i,sp,:),1,3);
		end
	end
	%{
	UniqueFields=unique(TheFieldSplit);
	for i=length(UniqueFields):-1:1
		UniqueFieldsInv(UniqueFields(i))=i;
	end
	for i=1:size(TheFieldSplitBase3_old,1)
		for sp=1:size(TheFieldSplitBase3_old,2)
			TheFieldSplit(i,sp)=UniqueFieldsInv(TheFieldSplit(i,sp));
			if TheFieldSplit(i,sp)==0
				disp('FieldSplitZero! 1904151633');
			end
		end
	end
	%}
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [TheFieldSplitBase3_ni,TheFieldSplitBase3_sp,spSizes] = SplitFieldMultiOptimized2(LOC,x_sp,CONNECT,CONNECTpn,x_crack,t_time,le)
	trajectory=0;
	numberofcrackpaths=x_crack.npaths;
	numberoffields=3^numberofcrackpaths;
	
	%TheFieldSplit=ones(size(CONNECTpn,1),length(CONNECT)); %<-- doesnt seem necessary
	%fprintf('%s',['amarker #186' char(10)]);
	%TheFieldSplitBase3_ni=zeros(size(CONNECTpn,1),length(CONNECT),numberofcrackpaths);
	%TheFieldSplitBase3_ni=ones(size(CONNECTpn,1),length(CONNECT),numberofcrackpaths); %<-- shit's right here???
	%SplitSourceSplitBase3=zeros(length(CONNECTpn),length(CONNECT),numberofcrackpaths);
	
	%new TheFieldSplitBase3_ni structure: {ni}(nsp,icrackpath) ni: number of nodes; nsp: the connected particles only based on CONNECTpn, icrackpath: the crack number
	niCount=length(CONNECTpn.nrparticles);
	spCount=length(CONNECT);
	niSizes=CONNECTpn.nrparticles;
	spSizes=zeros(1,spCount);
	for sp=1:spCount
		spSizes(sp)=length(CONNECT{sp});
	end
	maxspSizes=max(spSizes);
	maxniSizes=max(niSizes);
	TheFieldSplitBase3_ni=zeros(niCount,maxniSizes,numberofcrackpaths);
	TheFieldSplitBase3_sp=zeros(maxspSizes,spCount,numberofcrackpaths);
	%TheFieldSplitBase3_sp=cell(1,spCount);
	%{
	maxspSize=max(spSizes);
	for sp=1:spCount
		TheFieldSplitBase3_sp{sp}=zeros(length(CONNECT{sp}),numberofcrackpaths);
		%TheFieldSplitBase3_sp{sp}=zeros(maxspSize,numberofcrackpaths);
		%TheFieldSplitBase3_sp{sp}=zeros(spSizes(sp),numberofcrackpaths);
	end
	TheFieldSplitBase3_sp{1}(1,1)=1; %algorithm test
	%}
	Area=zeros(4,1);%fprintf('%s',['amarker #189' char(10)]);
	LOC_CONNECT=cell(1,spCount);
	for sp=1:spCount
		LOC_CONNECT{sp}=LOC(CONNECT{sp},:);
	end
	for icrackpath=1:numberofcrackpaths %not to get confused with numberofcrackpaths, icrackpath is the moving number, from 1 to numberofcrackpaths
%{
%switchable1 
		try
			parfor sp=1:length(CONNECT)
				TheFieldSplitBase3_ni(:,sp,icrackpath)=SplitFieldMultiOptimized2_parforred(LOC_CONNECT{sp},x_sp(sp,:),CONNECT{sp},niCount,x_crack.center(1:x_crack.nparticles(icrackpath),:,icrackpath),t_time);
			end
		catch
%}
%switchable1
			
			parfor ni=1:niCount
            %for ni=1:niCount
				%TheFieldSplitBase3_ni(ni (all nodes),nsp (particle numbers attached to the nodes),icrackpath)
				TheFieldSplitBase3_ni(ni,:,icrackpath)=SplitFieldMultiOptimized2_parforred_ni(x_sp,x_crack.center(1:x_crack.nparticles(icrackpath),:,icrackpath),t_time,niSizes(ni),CONNECTpn.values(ni,1:CONNECTpn.nrparticles(ni)),LOC(ni,:),maxniSizes);
			end
			%{
			parfor sp=1:spCount
				%TheFieldSplitBase3_sp{sp}(:,icrackpath)=SplitFieldMultiOptimized2_parforred_sp(x_sp(sp,:),x_crack.center(1:x_crack.nparticles(icrackpath),:,icrackpath),t_time,spSizes(sp),CONNECT{sp},LOC);
				TheFieldSplitBase3_sp(:,sp,icrackpath)=SplitFieldMultiOptimized2_parforred_sp(x_sp(sp,:),x_crack.center(1:x_crack.nparticles(icrackpath),:,icrackpath),t_time,spSizes(sp),CONNECT{sp},LOC,maxspSizes);
			end
			%}
			
%{
%switchable1
		end
%}
%switchable1
		for i=1:niCount
			%{
			CONNECTpnLength=0;
			for j=1:CONNECTpnLength;
				if CONNECTpn(i,j)>0
					CONNECTpnLength=CONNECTpnLength+1;
				else
					break;
				end
			end
			%}
			nodalfieldlist=sort(unique(transpose(TheFieldSplitBase3_ni(i,1:niSizes(i),icrackpath))));
			newfieldrevision=1;
			if length(nodalfieldlist)==3
				fprintf('%s',['Field split error, applying fix! (code 1904012106)' char(10)]);
				%pause
				1;
				problematicnsp=zeros(1,maxniSizes);
				coder.varsize('problematicnsp');
				problematicnsp=zeros(1,0);
				for nsp=1:niSizes(i)
					if TheFieldSplitBase3_ni(i,nsp,icrackpath)>1
						problematicnsp=[problematicnsp nsp];
					end
				end
				TheFieldSplitBase3_old_i=TheFieldSplitBase3_ni(i,:,icrackpath);
				for fixmode=1:3
					% extending the crack
					%fixmode=1: x_crack.center{npid}(size(x_crack{npid},1),:) extension by le(1)
					%fixmode=2: x_crack{npid}(0,:) extension by le(1)
					%fixmode=3: both extensions
					x_crack_modified=x_crack.center(1:x_crack.nparticles(icrackpath),:,icrackpath);
					cracksize=size(x_crack_modified,1);
					if fixmode==1
						trajectory=reliableatan(x_crack.center(cracksize,1,icrackpath)-x_crack.center(cracksize-1,1,icrackpath),x_crack.center(cracksize,2,icrackpath)-x_crack.center(cracksize-1,2,icrackpath));
						x_crack_modified(cracksize,1)=x_crack.center(cracksize,1,icrackpath)+2*le(1)*cos(trajectory);
						x_crack_modified(cracksize,2)=x_crack.center(cracksize,2,icrackpath)+2*le(1)*sin(trajectory);
					elseif fixmode==2
						trajectory=reliableatan(x_crack.center(1,1,icrackpath)-x_crack.center(2,1,icrackpath),x_crack.center(1,2,icrackpath)-x_crack.center(2,2,icrackpath));
						x_crack_modified(1,1)=x_crack.center(1,1,icrackpath)+2*le(1)*cos(trajectory);
						x_crack_modified(1,2)=x_crack.center(1,2,icrackpath)+2*le(1)*sin(trajectory);
					elseif fixmode==3
						trajectory1=reliableatan(x_crack.center(cracksize,1,icrackpath)-x_crack.center(cracksize-1,1,icrackpath),x_crack.center(cracksize,2,icrackpath)-x_crack.center(cracksize-1,2,icrackpath));
						x_crack_modified(cracksize,1)=x_crack.center(cracksize,1,icrackpath)+2*le(1)*cos(trajectory1);
						x_crack_modified(cracksize,2)=x_crack.center(cracksize,2,icrackpath)+2*le(1)*sin(trajectory1);
						trajectory2=reliableatan(x_crack.center(1,1,icrackpath)-x_crack.center(2,1,icrackpath),x_crack.center(1,2,icrackpath)-x_crack.center(2,2,icrackpath));
						x_crack_modified(1,1)=x_crack.center(1,1,icrackpath)+2*le(1)*cos(trajectory2);
						x_crack_modified(1,2)=x_crack.center(1,2,icrackpath)+2*le(1)*sin(trajectory2);
					end
					% extending the crack finished
                    %{
                    close gcf;
                    plot(LOC(i,1),LOC(i,2),'+','DisplayName','Node');
                    hold on
                    for nsp=1:niSizes(i)
                        sp=CONNECTpn(i,nsp);
                        if TheFieldSplitBase3_ni{i}(nsp,icrackpath)==1
                            plot(x_sp(sp,1),x_sp(sp,2),'x','Color','Red','HandleVisibility','Off');
                        elseif TheFieldSplitBase3_ni{i}(nsp,icrackpath)==2
                            plot(x_sp(sp,1),x_sp(sp,2),'x','Color','Green','HandleVisibility','Off');
                        elseif TheFieldSplitBase3_ni{i}(nsp,icrackpath)==3
                            plot(x_sp(sp,1),x_sp(sp,2),'x','Color','Blue','HandleVisibility','Off');
                        end
                    end
                    plot(x_crack_modified(:,1),x_crack_modified(:,2),'-','DisplayName','Crack Whole');
                    daspect([1 1 1]);
                    legend show
                    title(['above, particle=' num2str(sp) ', node=' num2str(i)]);
                    1;
                    %}
					% revising bad mapping
					for nsp_problematic=1:length(problematicnsp)
						Field2Counter=0;
						Field3Counter=0;
                        nsp=problematicnsp(nsp_problematic);
                        sp=CONNECTpn.values(i,nsp);
                        TheFieldSplitBase3_ni(i,nsp,icrackpath)=1;
						for crack_p_counter=1:(size(x_crack_modified,1)-1)
							x1=x_sp(sp,:);
							x2=LOC(i,:);
							x3=x_crack_modified(crack_p_counter,:);
							x4=x_crack_modified(crack_p_counter+1,:);
							Area(1)=TriangleArea(x1,x2,x3);
							Area(2)=TriangleArea(x1,x2,x4);
							Area(3)=TriangleArea(x3,x4,x1);
							Area(4)=TriangleArea(x3,x4,x2);
							if Area(1)<0 && Area(2)>=0 && Area(3)>=0 && Area(4)<0
								Field2Counter=Field2Counter+1;
                                %{
                                close gcf;
                                plot(LOC(i,1),LOC(i,2),'+','DisplayName','Node');
                                hold on
                                plot(x_sp(sp,1),x_sp(sp,2),'x','DisplayName','Particle');
                                plot(x_crack_modified(:,1),x_crack_modified(:,2),'-','DisplayName','Crack Whole');
                                plot(x_crack_modified(crack_p_counter:crack_p_counter+1,1),x_crack_modified(crack_p_counter:crack_p_counter+1,2),'-o','DisplayName','Crack Interest');
                                daspect([1 1 1]);
                                legend show
                                title(['above, particle=' num2str(sp) ', node=' num2str(i)]);
                                1;
                                %}
							elseif Area(1)>=0 && Area(2)<0 && Area(3)<0 && Area(4)>=0
								Field3Counter=Field3Counter+1;
                                %{
                                close gcf;
                                plot(LOC(i,1),LOC(i,2),'+','DisplayName','Node');
                                hold on
                                plot(x_sp(sp,1),x_sp(sp,2),'x','DisplayName','Particle');
                                plot(x_crack_modified(:,1),x_crack_modified(:,2),'-','DisplayName','Crack Whole');
                                plot(x_crack_modified(crack_p_counter:crack_p_counter+1,1),x_crack_modified(crack_p_counter:crack_p_counter+1,2),'-o','DisplayName','Crack Interest');
                                daspect([1 1 1]);
                                legend show
                                title(['below, particle=' num2str(sp) ', node=' num2str(i)]);
                                1;
                                %}
							end
						end
						if Field2Counter>0 && Field3Counter>0
							Field23Min=min([Field2Counter Field3Counter]);
							Field2Counter=Field2Counter-Field23Min;
							Field3Counter=Field3Counter-Field23Min;
						end
						if mod(Field2Counter,2)>0
							TheFieldSplitBase3_ni(i,nsp,icrackpath)=2;
							%SplitSourceSplitBase3(i,sp,icrackpath)=crack_p_counter;
						elseif mod(Field3Counter,2)>0
							TheFieldSplitBase3_ni(i,nsp,icrackpath)=3;
							%SplitSourceSplitBase3(i,sp,icrackpath)=crack_p_counter;
						end
					end
					% mapping revision done
					
					% checking if revision is successful
					nodalfieldlist=zeros(4,1);
					coder.varsize('nodalfieldlist');
					nodalfieldlist=sort(unique(transpose(TheFieldSplitBase3_ni(i,1:niSizes(i),icrackpath))));
					if length(nodalfieldlist)==3
						fprintf('%s',['fix attempt number ' int2txt(fixmode) ' failed' char(10)]);
						TheFieldSplitBase3_ni(i,:,icrackpath)=TheFieldSplitBase3_old_i;
						if fixmode==3
							fprintf('%s',['code 1904172033' char(10)]);
							pause
							1;
						end
					elseif length(nodalfieldlist)==2
						fprintf('%s',['fix attempt number ' int2txt(fixmode) ' successful' char(10)]);
						break;
					elseif length(nodalfieldlist)==1
						fprintf('%s',['fix attempt number ' int2txt(fixmode) ' broke separation (code 1904172022)' char(10)]);
						pause
						1;
					end
					% done checking if revision is successful
				end
			end
			%{
			if length(nodalfieldlist)==2
				if nodalfieldlist(1)==1 && nodalfieldlist(2)==2
					newfieldrevision=3;
				elseif nodalfieldlist(1)==1 && nodalfieldlist(2)==3
					newfieldrevision=2;
				end
			end
			if newfieldrevision>1
				for nsp=1:niSizes(i)
					if TheFieldSplitBase3_ni(i,nsp,icrackpath)==1
						TheFieldSplitBase3_ni(i,nsp,icrackpath)=newfieldrevision;
					end
				end
			end
			%}
		end
	end
	
	nroCounter=zeros(1,spCount);
	for io=1:niCount %io: moving number (i) of n(o)de
		for nrsp=1:niSizes(io)
			sp=CONNECTpn.values(io,nrsp);
			nroCounter(sp)=nroCounter(sp)+1;
			for j=1:numberofcrackpaths
				TheFieldSplitBase3_sp(nroCounter(sp),sp,j)=TheFieldSplitBase3_ni(io,nrsp,j);
			end
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [TheFieldSplitBase3] = SplitFieldMultiOptimized2_parforred_sp(x_sp,x_crack,t_time,spSizes,CONNECT,LOC,maxspSizes)
	Area=zeros(1,4);
	TheFieldSplitBase3=ones(max(spSizes),1,1);
	x1=x_sp;
	for nni=1:spSizes
		ni=CONNECT(nni);
		Field2Counter=0;
		Field3Counter=0;
		x2=LOC(ni,:);
		for crack_p_counter=1:(size(x_crack,1)-1)
			x3=x_crack(crack_p_counter,:);
			x4=x_crack(crack_p_counter+1,:);
			Area(1)=TriangleArea(x1,x2,x3);
			Area(2)=TriangleArea(x1,x2,x4);
			Area(3)=TriangleArea(x3,x4,x1);
			Area(4)=TriangleArea(x3,x4,x2);
			if Area(1)<0 && Area(2)>=0 && Area(3)>=0 && Area(4)<0
				Field2Counter=Field2Counter+1;
			elseif Area(1)>=0 && Area(2)<0 && Area(3)<0 && Area(4)>=0
				Field3Counter=Field3Counter+1;
			end
		end
		if Field2Counter>0 && Field3Counter>0
			Field23Min=min([Field2Counter Field3Counter]);
			Field2Counter=Field2Counter-Field23Min;
			Field3Counter=Field3Counter-Field23Min;
		end
		if mod(Field2Counter,2)>0
			TheFieldSplitBase3(nni,1,1)=2;
			%SplitSourceSplitBase3(i,sp,icrackpath)=crack_p_counter;
		elseif mod(Field3Counter,2)>0
			TheFieldSplitBase3(nni,1,1)=3;
			%SplitSourceSplitBase3(i,sp,icrackpath)=crack_p_counter;
		end
	end
	for nni=spSizes+1:maxspSizes
		TheFieldSplitBase3(nni,1,1)=0;
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [TheFieldSplitBase3_old] = SplitFieldMultiOptimized2_parforred(x_sp,x_crack,t_time,niSizes,CONNECTpn,LOC)
	Area=zeros(1,4);
	TheFieldSplitBase3_old=ones(niSizes,1);
	for nsp=1:niSizes
		sp=CONNECTpn(1,nsp);
		Field2Counter=0;
		Field3Counter=0;
		x1=x_sp(sp,:); %particle position
		x2=LOC(1,:); %node position
		for crack_p_counter=1:(size(x_crack,1)-1)
			x3=x_crack(crack_p_counter,:);
			x4=x_crack(crack_p_counter+1,:);
			Area(1)=TriangleArea(x1,x2,x3);
			Area(2)=TriangleArea(x1,x2,x4);
			Area(3)=TriangleArea(x3,x4,x1);
			Area(4)=TriangleArea(x3,x4,x2);
			if Area(1)<0 && Area(2)>=0 && Area(3)>=0 && Area(4)<0
				Field2Counter=Field2Counter+1;
			elseif Area(1)>=0 && Area(2)<0 && Area(3)<0 && Area(4)>=0
				Field3Counter=Field3Counter+1;
			end
		end
		if Field2Counter>0 && Field3Counter>0
			Field23Min=min([Field2Counter Field3Counter]);
			Field2Counter=Field2Counter-Field23Min;
			Field3Counter=Field3Counter-Field23Min;
		end
		if mod(Field2Counter,2)>0
			TheFieldSplitBase3_old(nsp,1)=2;
			%SplitSourceSplitBase3(i,sp,icrackpath)=crack_p_counter;
		elseif mod(Field3Counter,2)>0
			TheFieldSplitBase3_old(nsp,1)=3;
			%SplitSourceSplitBase3(i,sp,icrackpath)=crack_p_counter;
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [TheFieldSplitBase3_ni] = SplitFieldMultiOptimized2_parforred_ni(x_sp,x_crack,t_time,niSizes,CONNECTpn,LOC,maxniSizes)
	Area=zeros(1,4);
	TheFieldSplitBase3_ni=ones(maxniSizes,1,1);
	for nsp=1:niSizes
		sp=CONNECTpn(1,nsp);
		Field2Counter=0;
		Field3Counter=0;
		x1=x_sp(sp,:); %particle position
		x2=LOC(1,:); %node position
		for crack_p_counter=1:(size(x_crack,1)-1)
			x3=x_crack(crack_p_counter,:);
			x4=x_crack(crack_p_counter+1,:);
			Area(1)=TriangleArea(x1,x2,x3);
			Area(2)=TriangleArea(x1,x2,x4);
			Area(3)=TriangleArea(x3,x4,x1);
			Area(4)=TriangleArea(x3,x4,x2);
			if Area(1)<0 && Area(2)>=0 && Area(3)>=0 && Area(4)<0
				Field2Counter=Field2Counter+1;
			elseif Area(1)>=0 && Area(2)<0 && Area(3)<0 && Area(4)>=0
				Field3Counter=Field3Counter+1;
			end
		end
		if Field2Counter>0 && Field3Counter>0
			Field23Min=min([Field2Counter Field3Counter]);
			Field2Counter=Field2Counter-Field23Min;
			Field3Counter=Field3Counter-Field23Min;
		end
		if mod(Field2Counter,2)>0
			TheFieldSplitBase3_ni(nsp,1,1)=2;
			%SplitSourceSplitBase3(i,sp,icrackpath)=crack_p_counter;
		elseif mod(Field3Counter,2)>0
			TheFieldSplitBase3_ni(nsp,1,1)=3;
			%SplitSourceSplitBase3(i,sp,icrackpath)=crack_p_counter;
		end
	end
	for nsp=niSizes+1:maxniSizes
		TheFieldSplitBase3_ni(nsp,1,1)=0;
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [TheFieldSplit,Nmatrix,dNxmatrix,dNymatrix,NmatrixAll] = SplitFieldMulti_crack(LOC,x_sp,CONNECT,CONNECTpn,x_crack,CONNECT_crack,CONNECTpn_crack,Nmatrix,dNxmatrix,dNymatrix,t_time,currentcrackpathnum,cracktoporbot)
	%fill in cracktoporbot=1 for crack, cracktoporbot=2 for top, and cracktoporbot=3 for bot
	NmatrixAll=Nmatrix;
	numberofcrackpaths=length(x_crack);
	numberoffields=3^numberofcrackpaths;
	if numberoffields>1
        Nmatrix(1,1,numberoffields)=0;
        dNxmatrix(1,1,numberoffields)=0;
        dNymatrix(1,1,numberoffields)=0;
    end
	TheFieldSplit=ones(size(CONNECTpn,1),length(CONNECT));
	TheFieldSplitBase3_old=ones(size(CONNECTpn,1),length(CONNECT),numberofcrackpaths);
	
	%for SuspectedNodeCounter=1:length(CONNECTpn_crack)
	Area=zeros(4,1);
	for icrackpath=1:numberofcrackpaths %not to get confused with numberofcrackpaths, icrackpath is the moving number, from 1 to numberofcrackpaths
		for sp=1:length(CONNECT)
			for ni=1:length(CONNECT{sp})
				if icrackpath==currentcrackpathnum
                    i=CONNECT{sp}(ni);
					TheFieldSplitBase3_old(i,sp,icrackpath)=cracktoporbot;
				else
					Field2Counter=0;
					Field3Counter=0;
					for crack_p_counter=1:(size(x_crack{icrackpath},1)-1)
						i=CONNECT{sp}(ni);
						x1=x_sp(sp,:);
						x2=LOC(i,:);
						x3=x_crack{icrackpath}(crack_p_counter,:);
						x4=x_crack{icrackpath}(crack_p_counter+1,:);
						Area(1)=TriangleArea(x1,x2,x3);
						Area(2)=TriangleArea(x1,x2,x4);
						Area(3)=TriangleArea(x3,x4,x1);
						Area(4)=TriangleArea(x3,x4,x2);
						if Area(1)<0 && Area(2)>=0 && Area(3)>=0 && Area(4)<0
							Field2Counter=Field2Counter+1;
						elseif Area(1)>=0 && Area(2)<0 && Area(3)<0 && Area(4)>=0
							%{
							if sp==220 && ni==8 && CloseEnough(x1(1),58.740308582876274101636226987466,1e-5,2)
								1;
								plot(x1(1),x1(2),'o','DisplayName','particle')
								hold on
								plot(x2(1),x2(2),'o','DisplayName','node')
								plot(x3(1),x3(2),'o','DisplayName','crackbefore')
								plot(x4(1),x4(2),'o','DisplayName','crackafter')
								legend show
								hold off
								1;
							end
							%}
							Field3Counter=Field3Counter+1;
						end
					end
					if Field2Counter>0 && Field3Counter>0
						%{
						try
							asdf(-pi);
						catch exc
							disp('Field Split Error!');
							getReport(exc,'extended');
							pause;
							1;
						end
						%}
						1;
						Field23Min=min([Field2Counter Field3Counter]);
						Field2Counter=Field2Counter-Field23Min;
						Field3Counter=Field3Counter-Field23Min;
						1;
					end
					if mod(Field2Counter,2)>0
					%{
						TheFieldSplit(i,sp)=2*icrackpath;
						Nmatrix(i,sp,2*icrackpath)=Nmatrix(i,sp,1);
						Nmatrix(i,sp,1)=0;
						dNxmatrix(i,sp,2*icrackpath)=dNxmatrix(i,sp,1);
						dNxmatrix(i,sp,1)=0;
						dNymatrix(i,sp,2*icrackpath)=dNymatrix(i,sp,1);
						dNymatrix(i,sp,1)=0;
					%}
						TheFieldSplitBase3_old(i,sp,icrackpath)=2;
					elseif mod(Field3Counter,2)>0
					%{
						TheFieldSplit(i,sp)=2*icrackpath+1;
						Nmatrix(i,sp,2*icrackpath+1)=Nmatrix(i,sp,1);
						Nmatrix(i,sp,1)=0;
						dNxmatrix(i,sp,2*icrackpath+1)=dNxmatrix(i,sp,1);
						dNxmatrix(i,sp,1)=0;
						dNymatrix(i,sp,2*icrackpath+1)=dNymatrix(i,sp,1);
						dNymatrix(i,sp,1)=0;
					%}
						TheFieldSplitBase3_old(i,sp,icrackpath)=3;
					end
				end
			end
		end
		
		for i=1:size(CONNECTpn,1)
			CONNECTpnLength=0;
			for j=1:size(CONNECTpn,2);
				if CONNECTpn(i,j)>0
					CONNECTpnLength=CONNECTpnLength+1;
				else
					break;
				end
			end

			nodalfieldlist=sort(unique(TheFieldSplitBase3_old(i,CONNECTpn(i,1:CONNECTpnLength),icrackpath)));
			newfieldrevision=1;
			if length(nodalfieldlist)==2
				if nodalfieldlist(1)==1 && nodalfieldlist(2)==2
					newfieldrevision=3;
				elseif nodalfieldlist(1)==1 && nodalfieldlist(2)==3
					newfieldrevision=2;
				end
			elseif length(nodalfieldlist)==3
				fprintf('%s',['Field split error! (code 1904012104)' char(10)]);
				pause
				1;
			end
			if newfieldrevision>1
				for nsp=1:CONNECTpnLength
					if TheFieldSplitBase3_old(i,CONNECTpn(i,nsp),icrackpath)==1
						TheFieldSplitBase3_old(i,CONNECTpn(i,nsp),icrackpath)=newfieldrevision;
					end
				end
			end
		end

		%{
		for i=1:size(CONNECTpn,1)
			nodalfieldlist=sort(unique(TheFieldSplit(i,:)));
			newfieldrevision=1;
			if length(nodalfieldlist)==2
				if nodalfieldlist(1)==1 && nodalfieldlist(2)==2
					newfieldrevision=3;
				elseif nodalfieldlist(1)==1 && nodalfieldlist(2)==3
					newfieldrevision=2;
				end
			elseif length(nodalfieldlist)==3
				disp('Field split error, ignoring')
				%pause
				1;
			end
			if newfieldrevision>1
				for sp=1:length(CONNECT)
					if TheFieldSplit(i,sp)==1
						TheFieldSplit(i,sp)=newfieldrevision;
						Nmatrix(i,sp,newfieldrevision)=Nmatrix(i,sp,1);
						Nmatrix(i,sp,1)=0;
						dNxmatrix(i,sp,newfieldrevision)=dNxmatrix(i,sp,1);
						dNxmatrix(i,sp,1)=0;
						dNymatrix(i,sp,newfieldrevision)=dNymatrix(i,sp,1);
						dNymatrix(i,sp,1)=0;
					end
				end
			end
		end
		%}
	end
	for i=1:size(TheFieldSplitBase3_old,1)
		for sp=1:size(TheFieldSplitBase3_old,2)
			TheFieldSplit(i,sp)=BaseNtoDec(TheFieldSplitBase3_old(i,sp,:),1,3);
		end
	end
	for i=1:size(TheFieldSplit,1)
		for sp=1:size(TheFieldSplit,2)
			if TheFieldSplit(i,sp)==1
			else
				if TheFieldSplit(i,sp)==9
					1;
				end
				Nmatrix(i,sp,TheFieldSplit(i,sp))=Nmatrix(i,sp,1);
				Nmatrix(i,sp,1)=0;
				
				dNxmatrix(i,sp,TheFieldSplit(i,sp))=dNxmatrix(i,sp,1);
				dNxmatrix(i,sp,1)=0;
				
				dNymatrix(i,sp,TheFieldSplit(i,sp))=dNymatrix(i,sp,1);
				dNymatrix(i,sp,1)=0;
			end
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [TheFieldSplit] = SplitFieldMulti_crackoptimized(LOC,x_sp,CONNECT,CONNECTpn,x_crack,currentcrackpathnum,cracktoporbot)
	%fill in cracktoporbot=1 for crack, cracktoporbot=2 for top, and cracktoporbot=3 for bot
	
	numberofcrackpaths=length(x_crack);
	numberoffields=3^numberofcrackpaths;
	
	TheFieldSplit=ones(size(CONNECTpn,1),length(CONNECT));
	TheFieldSplitBase3_old=ones(size(CONNECTpn,1),length(CONNECT),numberofcrackpaths);
	
	Area=zeros(4,1);
	for icrackpath=1:numberofcrackpaths %not to get confused with numberofcrackpaths, icrackpath is the moving number, from 1 to numberofcrackpaths
		for sp=1:length(CONNECT)
			for ni=1:length(CONNECT{sp})
				if icrackpath==currentcrackpathnum
                    i=CONNECT{sp}(ni);
					TheFieldSplitBase3_old(i,sp,icrackpath)=cracktoporbot;
				else
					Field2Counter=0;
					Field3Counter=0;
					for crack_p_counter=1:(size(x_crack{icrackpath},1)-1)
						i=CONNECT{sp}(ni);
						x1=x_sp(sp,:);
						x2=LOC(i,:);
						x3=x_crack{icrackpath}(crack_p_counter,:);
						x4=x_crack{icrackpath}(crack_p_counter+1,:);
						Area(1)=TriangleArea(x1,x2,x3);
						Area(2)=TriangleArea(x1,x2,x4);
						Area(3)=TriangleArea(x3,x4,x1);
						Area(4)=TriangleArea(x3,x4,x2);
						if Area(1)<0 && Area(2)>=0 && Area(3)>=0 && Area(4)<0
							Field2Counter=Field2Counter+1;
						elseif Area(1)>=0 && Area(2)<0 && Area(3)<0 && Area(4)>=0
							Field3Counter=Field3Counter+1;
						end
					end
					if Field2Counter>0 && Field3Counter>0
						1;
						Field23Min=min([Field2Counter Field3Counter]);
						Field2Counter=Field2Counter-Field23Min;
						Field3Counter=Field3Counter-Field23Min;
						1;
					end
					if mod(Field2Counter,2)>0
						TheFieldSplitBase3_old(i,sp,icrackpath)=2;
					elseif mod(Field3Counter,2)>0
						TheFieldSplitBase3_old(i,sp,icrackpath)=3;
					end
				end
			end
		end
		
		for i=1:size(CONNECTpn,1)
			CONNECTpnLength=0;
			for j=1:size(CONNECTpn,2);
				if CONNECTpn(i,j)>0
					CONNECTpnLength=CONNECTpnLength+1;
				else
					break;
				end
			end
			nodalfieldlist=sort(unique(TheFieldSplitBase3_old(i,CONNECTpn(i,1:CONNECTpnLength),icrackpath)));
			newfieldrevision=1;
			if length(nodalfieldlist)==2
				if nodalfieldlist(1)==1 && nodalfieldlist(2)==2
					newfieldrevision=3;
				elseif nodalfieldlist(1)==1 && nodalfieldlist(2)==3
					newfieldrevision=2;
				end
			elseif length(nodalfieldlist)==3
				fprintf('%s',['Field split error! (code 1904012105)' char(10)]);
				pause
				1;
			end
			if newfieldrevision>1
				for nsp=1:CONNECTpnLength
					if TheFieldSplitBase3_old(i,CONNECTpn(i,nsp),icrackpath)==1
						TheFieldSplitBase3_old(i,CONNECTpn(i,nsp),icrackpath)=newfieldrevision;
					end
				end
			end
		end
	end
	for i=1:size(TheFieldSplitBase3_old,1)
		for sp=1:size(TheFieldSplitBase3_old,2)
			TheFieldSplit(i,sp)=BaseNtoDec(TheFieldSplitBase3_old(i,sp,:),1,3);
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [TheFieldSplitBase3_old] = SplitFieldMulti_crackoptimized2(LOC,x_sp,CONNECT,CONNECTpn,x_crack,currentcrackpathnum,cracktoporbot,le)
	%fill in cracktoporbot=1 for crack, cracktoporbot=2 for top, and cracktoporbot=3 for bot
	
	numberofcrackpaths=x_crack.npaths;
	numberoffields=3^numberofcrackpaths;
	
	TheFieldSplit=ones(size(CONNECTpn,1),length(CONNECT));
	TheFieldSplitBase3_old=ones(size(CONNECTpn,1),length(CONNECT),numberofcrackpaths);
	
	Area=zeros(4,1);
	for icrackpath=1:numberofcrackpaths %not to get confused with numberofcrackpaths, icrackpath is the moving number, from 1 to numberofcrackpaths
		for sp=1:length(CONNECT)
			for ni=1:length(CONNECT{sp})
                i=CONNECT{sp}(ni);
				if icrackpath==currentcrackpathnum
					TheFieldSplitBase3_old(i,sp,icrackpath)=cracktoporbot;
				else
					Field2Counter=0;
					Field3Counter=0;
					for crack_p_counter=1:(x_crack.nparticles(icrackpath)-1)
						x1=x_sp(sp,:);
						x2=LOC(i,:);
						x3=x_crack.center(crack_p_counter,:,icrackpath);
						x4=x_crack.center(crack_p_counter+1,:,icrackpath);
						Area(1)=TriangleArea(x1,x2,x3);
						Area(2)=TriangleArea(x1,x2,x4);
						Area(3)=TriangleArea(x3,x4,x1);
						Area(4)=TriangleArea(x3,x4,x2);
						if Area(1)<0 && Area(2)>=0 && Area(3)>=0 && Area(4)<0
							Field2Counter=Field2Counter+1;
						elseif Area(1)>=0 && Area(2)<0 && Area(3)<0 && Area(4)>=0
							Field3Counter=Field3Counter+1;
						end
					end
					if Field2Counter>0 && Field3Counter>0
						1;
						Field23Min=min([Field2Counter Field3Counter]);
						Field2Counter=Field2Counter-Field23Min;
						Field3Counter=Field3Counter-Field23Min;
						1;
					end
					if mod(Field2Counter,2)>0
						TheFieldSplitBase3_old(i,sp,icrackpath)=2;
					elseif mod(Field3Counter,2)>0
						TheFieldSplitBase3_old(i,sp,icrackpath)=3;
					end
				end
			end
		end
		
		for i=1:size(CONNECTpn,1)
			CONNECTpnLength=0;
			for j=1:size(CONNECTpn,2);
				if CONNECTpn(i,j)>0
					CONNECTpnLength=CONNECTpnLength+1;
				else
					break;
				end
			end
			nodalfieldlist=sort(unique(TheFieldSplitBase3_old(i,CONNECTpn(i,1:CONNECTpnLength),icrackpath)));
			newfieldrevision=1;
			if length(nodalfieldlist)==3
				fprintf('%s',['Field split error, applying fix! (code 1904012106)' char(10)]);
				%pause
				1;
				problematicnsp=zeros(1,0);
				for nsp=1:CONNECTpnLength
					if TheFieldSplitBase3_old(i,CONNECTpn(i,nsp),icrackpath)>1
						problematicnsp=[problematicnsp nsp];
					end
                end
				TheFieldSplitBase3_old=TheFieldSplitBase3_old;
				x_crack_modified=x_crack.center(1:x_crack.nparticles(icrackpath),:,icrackpath);
				for fixmode=1:3
					% extending the crack
					%fixmode=1: x_crack.center(x_crack.nparticles(npid),:,npid) extension by le(1)
					%fixmode=2: x_crack(0,:,npid) extension by le(1)
					%fixmode=3: both extensions
					if fixmode==1
						x_crack_modified=x_crack.center(1:x_crack.nparticles(icrackpath),:,icrackpath);
						cracksize=size(x_crack_modified,1);
						trajectory=reliableatan(x_crack.center(cracksize,1,icrackpath)-x_crack.center(cracksize-1,1,icrackpath),x_crack.center(cracksize,2,icrackpath)-x_crack.center(cracksize-1,2,icrackpath));
						x_crack_modified(cracksize,1)=x_crack.center(cracksize,1,icrackpath)+le(1)*cos(trajectory);
						x_crack_modified(cracksize,2)=x_crack.center(cracksize,2,icrackpath)+le(1)*sin(trajectory);
					elseif fixmode==2
						x_crack_modified=x_crack.center(1:x_crack.nparticles(icrackpath),:,icrackpath);
						cracksize=size(x_crack_modified,1);
						trajectory=reliableatan(x_crack.center(1,1,icrackpath)-x_crack.center(2,1,icrackpath),x_crack.center(1,2,icrackpath)-x_crack.center(2,2,icrackpath));
						x_crack_modified(1,1)=x_crack.center(1,1,icrackpath)+le(1)*cos(trajectory);
						x_crack_modified(1,2)=x_crack.center(1,2,icrackpath)+le(1)*sin(trajectory);
					elseif fixmode==3
						x_crack_modified=x_crack.center(1:x_crack.nparticles(icrackpath),:,icrackpath);
						cracksize=size(x_crack_modified,1);
						trajectory1=reliableatan(x_crack.center(cracksize,1,icrackpath)-x_crack.center(cracksize-1,1,icrackpath),x_crack.center(cracksize,2,icrackpath)-x_crack.center(cracksize-1,2,icrackpath));
						x_crack_modified(cracksize,1)=x_crack.center(cracksize,1,icrackpath)+le(1)*cos(trajectory1);
						x_crack_modified(cracksize,2)=x_crack.center(cracksize,2,icrackpath)+le(1)*sin(trajectory1);
						trajectory2=reliableatan(x_crack.center(1,1,icrackpath)-x_crack.center(2,1,icrackpath),x_crack.center(1,2,icrackpath)-x_crack.center(2,2,icrackpath));
						x_crack_modified(1,1)=x_crack.center(1,1,icrackpath)+le(1)*cos(trajectory2);
						x_crack_modified(1,2)=x_crack.center(1,2,icrackpath)+le(1)*sin(trajectory2);
					end
					% extending the crack finished
					
					% revising bad mapping
					for nsp=1:length(problematicnsp)
						Field2Counter=0;
						Field3Counter=0;
                        sp=CONNECTpn(i,problematicnsp(nsp));
                        TheFieldSplitBase3_old(i,sp,icrackpath)=1;
						for crack_p_counter=1:(size(x_crack_modified,1)-1)
							x1=x_sp(sp,:);
							x2=LOC(i,:);
							x3=x_crack_modified(crack_p_counter,:);
							x4=x_crack_modified(crack_p_counter+1,:);
							Area(1)=TriangleArea(x1,x2,x3);
							Area(2)=TriangleArea(x1,x2,x4);
							Area(3)=TriangleArea(x3,x4,x1);
							Area(4)=TriangleArea(x3,x4,x2);
							if Area(1)<0 && Area(2)>=0 && Area(3)>=0 && Area(4)<0
								Field2Counter=Field2Counter+1;
                                %close gcf;
                                %plot(LOC(i,1),LOC(i,2),'o','DisplayName','Node');
                                %hold on
                                %plot(x_sp(sp,1),x_sp(sp,2),'o','DisplayName','Particle');
                                %plot(x_crack_modified(:,1),x_crack_modified(:,2),'-','DisplayName','Crack Whole');
                                %plot(x_crack_modified(crack_p_counter:crack_p_counter+1,1),x_crack_modified(crack_p_counter:crack_p_counter+1,2),'-o','DisplayName','Crack Interest');
                                %daspect([1 1 1]);
                                %legend show
                                %title(['above, particle=' num2str(sp) ', node=' num2str(i)]);
                                %1;
							elseif Area(1)>=0 && Area(2)<0 && Area(3)<0 && Area(4)>=0
								Field3Counter=Field3Counter+1;
                                %close gcf;
                                %plot(LOC(i,1),LOC(i,2),'o','DisplayName','Node');
                                %hold on
                                %plot(x_sp(sp,1),x_sp(sp,2),'o','DisplayName','Particle');
                                %plot(x_crack_modified(:,1),x_crack_modified(:,2),'-','DisplayName','Crack Whole');
                                %plot(x_crack_modified(crack_p_counter:crack_p_counter+1,1),x_crack_modified(crack_p_counter:crack_p_counter+1,2),'-o','DisplayName','Crack Interest');
                                %daspect([1 1 1]);
                                %legend show
                                %title(['below, particle=' num2str(sp) ', node=' num2str(i)]);
                                %1;
							end
						end
						if Field2Counter>0 && Field3Counter>0
							Field23Min=min([Field2Counter Field3Counter]);
							Field2Counter=Field2Counter-Field23Min;
							Field3Counter=Field3Counter-Field23Min;
						end
						if mod(Field2Counter,2)>0
							TheFieldSplitBase3_old(i,sp,icrackpath)=2;
							%SplitSourceSplitBase3(i,sp,icrackpath)=crack_p_counter;
						elseif mod(Field3Counter,2)>0
							TheFieldSplitBase3_old(i,sp,icrackpath)=3;
							%SplitSourceSplitBase3(i,sp,icrackpath)=crack_p_counter;
						end
					end
					% mapping revision done

					% checking if revision is successful
					nodalfieldlist=sort(unique(TheFieldSplitBase3_old(i,CONNECTpn(i,1:CONNECTpnLength),icrackpath)));
					if length(nodalfieldlist)==3
						fprintf('%s',['fix attempt number ' int2txt(fixmode) ' failed' char(10)]);
						TheFieldSplitBase3_old=TheFieldSplitBase3_old;
						if fixmode==3
							fprintf('%s',['code 1904172033' char(10)]);
							pause
							1;
						end
					elseif length(nodalfieldlist)==2
						fprintf('%s',['fix attempt number ' int2txt(fixmode) ' successful' char(10)]);
						break;
					elseif length(nodalfieldlist)==1
						fprintf('%s',['fix attempt number ' int2txt(fixmode) ' broke separation (code 1904172022)' char(10)]);
						pause
						1;
					end
					% done checking if revision is successful
				end	
			end
			if length(nodalfieldlist)==2
				if nodalfieldlist(1)==1 && nodalfieldlist(2)==2
					newfieldrevision=3;
				elseif nodalfieldlist(1)==1 && nodalfieldlist(2)==3
					newfieldrevision=2;
				end
			end
			if newfieldrevision>1
				for nsp=1:CONNECTpnLength
					if TheFieldSplitBase3_old(i,CONNECTpn(i,nsp),icrackpath)==1
						TheFieldSplitBase3_old(i,CONNECTpn(i,nsp),icrackpath)=newfieldrevision;
					end
				end
			end
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [TheFieldSplitBase3_sp] = SplitFieldMulti_crackoptimized2_nocell(LOC,x_sp,CONNECT_crack_topbot,CONNECTpn_crack_topbot,x_crack,currentcrackpathnum,cracktoporbot,le)
	%fill in cracktoporbot=1 for crack, cracktoporbot=2 for top, and cracktoporbot=3 for bot
	%currentcrackpathnum: for the crack particles, for the positions
	%icrackpath: for the crack lines, for the separation
	irsp_outloop=1; %basically irsp but different to stop coder whining
	
	spSizes=CONNECT_crack_topbot.nrnodes(currentcrackpathnum,:);
	noCount=size(CONNECTpn_crack_topbot.values,1);
	spCount=x_crack.nparticles(currentcrackpathnum);
	maxspSizes=max(spSizes);
	numberofcrackpaths=x_crack.npaths;
	numberoffields=3^numberofcrackpaths;
	
	%TheFieldSplit=ones(maxspSizes,x_crack.nparticles(currentcrackpathnum));
	TheFieldSplitBase3_sp=ones(maxspSizes,x_crack.nparticles(currentcrackpathnum),numberofcrackpaths);
	TheFieldSplitBase3_ni=ones(noCount,CONNECTpn_crack_topbot.maxnrparticles,numberofcrackpaths);
	x_sp=zeros(1,2);
	deltax=zeros(1,2);
	
	Area=zeros(4,1);
	for icrackpath=1:numberofcrackpaths %not to get confused with numberofcrackpaths, icrackpath is the moving number, from 1 to numberofcrackpaths
		for io=1:noCount
			for irsp=1:CONNECTpn_crack_topbot.nrparticles(currentcrackpathnum,io)
                sp=CONNECTpn_crack_topbot.values(io,irsp,currentcrackpathnum);
				if icrackpath==currentcrackpathnum
					pathbefore=zeros(1,2);
					pathafter=zeros(1,2);
					if sp>1 %for before
						deltax=x_crack.center(sp,:,currentcrackpathnum)-x_crack.center(sp-1,:,currentcrackpathnum);
						pathbefore=deltax/sqrt(dot(deltax,deltax));
					end
					if sp<x_crack.nparticles(currentcrackpathnum)
						deltax=x_crack.center(sp+1,:,currentcrackpathnum)-x_crack.center(sp,:,currentcrackpathnum);
						pathafter=deltax/sqrt(dot(deltax,deltax));
					end
					pathsummed=pathbefore+pathafter;
					pathangleaverage=reliableatan(pathsummed(1),pathsummed(2));
					if cracktoporbot==2
						pathangledrift=pathangleaverage+pi/2;
					elseif cracktoporbot==3
						pathangledrift=pathangleaverage-pi/2;
					else
						pathangledrift=pathangleaverage;
					end
					x_sp=x_crack.center(sp,:,currentcrackpathnum)+(le(1)/10000)*[cos(pathangledrift) sin(pathangledrift)];
				elseif cracktoporbot==2
					x_sp=x_crack.top(sp,:,currentcrackpathnum);
				elseif cracktoporbot==3
					x_sp=x_crack.bot(sp,:,currentcrackpathnum);
				else
					x_sp=x_crack.center(sp,:,currentcrackpathnum);
				end
				Field2Counter=0;
				Field3Counter=0;
				for crack_p_counter=1:(x_crack.nparticles(icrackpath)-1)
					x1=x_sp;
					x2=LOC(io,:);
					x3=x_crack.center(crack_p_counter,:,icrackpath);
					x4=x_crack.center(crack_p_counter+1,:,icrackpath);
					Area(1)=TriangleArea(x1,x2,x3);
					Area(2)=TriangleArea(x1,x2,x4);
					Area(3)=TriangleArea(x3,x4,x1);
					Area(4)=TriangleArea(x3,x4,x2);
					if Area(1)<0 && Area(2)>=0 && Area(3)>=0 && Area(4)<0
						Field2Counter=Field2Counter+1;
					elseif Area(1)>=0 && Area(2)<0 && Area(3)<0 && Area(4)>=0
						Field3Counter=Field3Counter+1;
					end
				end
				if Field2Counter>0 && Field3Counter>0
					1;
					Field23Min=min([Field2Counter Field3Counter]);
					Field2Counter=Field2Counter-Field23Min;
					Field3Counter=Field3Counter-Field23Min;
					1;
				end
				if mod(Field2Counter,2)>0
					TheFieldSplitBase3_ni(io,irsp,icrackpath)=2;
				elseif mod(Field3Counter,2)>0
					TheFieldSplitBase3_ni(io,irsp,icrackpath)=3;
                end
                %{
                if sp==5 && cracktoporbot==2
                    io
                    TheFieldSplitBase3_ni(io,irsp,icrackpath)
                    LOC(io,:)
                    1;
                end
                %}
			end
		end
		
		for io=1:noCount
			%for irsp=1:CONNECTpn_crack_topbot.nrparticles(icrack,io,icrackpath)
			nodalfieldlist=sort(unique(TheFieldSplitBase3_ni(io,1:CONNECTpn_crack_topbot.nrparticles(currentcrackpathnum,io),icrackpath)));
			newfieldrevision=1;
			if length(nodalfieldlist)==3
				fprintf('%s',['Field split error, applying fix! (code 1904012106)' char(10)]);
				%pause
				1;
				problematicnsp=zeros(1,CONNECTpn_crack_topbot.maxnrparticles);
				coder.varsize('problematicnsp');
				problematicnsp=zeros(1,0);
				for irsp=1:CONNECTpn_crack_topbot.nrparticles(currentcrackpathnum,io);
					if TheFieldSplitBase3_ni(io,irsp,icrackpath)>1
						problematicnsp=[problematicnsp irsp];
					end
				end
				TheFieldSplitBase3_old_io=TheFieldSplitBase3_ni(io,:,icrackpath);
				x_crack_modified=x_crack.center(1:x_crack.nparticles(icrackpath),:,icrackpath);
				for fixmode=1:3
					% extending the crack
					%fixmode=1: x_crack.center(x_crack.nparticles(npid),:,npid) extension by le(1)
					%fixmode=2: x_crack(0,:,npid) extension by le(1)
					%fixmode=3: both extensions
					if fixmode==1
						x_crack_modified=x_crack.center(1:x_crack.nparticles(icrackpath),:,icrackpath);
						cracksize=size(x_crack_modified,1);
						trajectory=reliableatan(x_crack.center(cracksize,1,icrackpath)-x_crack.center(cracksize-1,1,icrackpath),x_crack.center(cracksize,2,icrackpath)-x_crack.center(cracksize-1,2,icrackpath));
						x_crack_modified(cracksize,1)=x_crack.center(cracksize,1,icrackpath)+2*le(1)*cos(trajectory);
						x_crack_modified(cracksize,2)=x_crack.center(cracksize,2,icrackpath)+2*le(1)*sin(trajectory);
					elseif fixmode==2
						x_crack_modified=x_crack.center(1:x_crack.nparticles(icrackpath),:,icrackpath);
						cracksize=size(x_crack_modified,1);
						trajectory=reliableatan(x_crack.center(1,1,icrackpath)-x_crack.center(2,1,icrackpath),x_crack.center(1,2,icrackpath)-x_crack.center(2,2,icrackpath));
						x_crack_modified(1,1)=x_crack.center(1,1,icrackpath)+2*le(1)*cos(trajectory);
						x_crack_modified(1,2)=x_crack.center(1,2,icrackpath)+2*le(1)*sin(trajectory);
					elseif fixmode==3
						x_crack_modified=x_crack.center(1:x_crack.nparticles(icrackpath),:,icrackpath);
						cracksize=size(x_crack_modified,1);
						trajectory1=reliableatan(x_crack.center(cracksize,1,icrackpath)-x_crack.center(cracksize-1,1,icrackpath),x_crack.center(cracksize,2,icrackpath)-x_crack.center(cracksize-1,2,icrackpath));
						x_crack_modified(cracksize,1)=x_crack.center(cracksize,1,icrackpath)+2*le(1)*cos(trajectory1);
						x_crack_modified(cracksize,2)=x_crack.center(cracksize,2,icrackpath)+2*le(1)*sin(trajectory1);
						trajectory2=reliableatan(x_crack.center(1,1,icrackpath)-x_crack.center(2,1,icrackpath),x_crack.center(1,2,icrackpath)-x_crack.center(2,2,icrackpath));
						x_crack_modified(1,1)=x_crack.center(1,1,icrackpath)+2*le(1)*cos(trajectory2);
						x_crack_modified(1,2)=x_crack.center(1,2,icrackpath)+2*le(1)*sin(trajectory2);
					end
					% extending the crack finished
					
					% revising bad mapping
					for iproblematicnsp=1:length(problematicnsp)
						Field2Counter=0;
						Field3Counter=0;
						irsp_outloop=problematicnsp(iproblematicnsp);
						sp=CONNECTpn_crack_topbot.values(io,problematicnsp(iproblematicnsp),currentcrackpathnum);
						if icrackpath==currentcrackpathnum
							pathbefore=zeros(1,2);
							pathafter=zeros(1,2);
							if sp>1 %for before
								deltax=x_crack.center(sp,:,currentcrackpathnum)-x_crack.center(sp-1,:,currentcrackpathnum);
								pathbefore=deltax/sqrt(dot(deltax,deltax));
							end
							if sp<x_crack.nparticles(currentcrackpathnum)
								deltax=x_crack.center(sp+1,:,currentcrackpathnum)-x_crack.center(sp,:,currentcrackpathnum);
								pathafter=deltax/sqrt(dot(deltax,deltax));
							end
							pathsummed=pathbefore+pathafter;
							pathangleaverage=reliableatan(pathsummed(1),pathsummed(2));
							if cracktoporbot==2
								pathangledrift=pathangleaverage+pi/2;
							elseif cracktoporbot==3
								pathangledrift=pathangleaverage-pi/2;
							else
								pathangledrift=pathangleaverage;
							end
							x_sp=x_crack.center(sp,:,currentcrackpathnum)+(le(1)/10000)*[cos(pathangledrift) sin(pathangledrift)];
						elseif cracktoporbot==2
							x_sp=x_crack.top(sp,:,currentcrackpathnum);
						elseif cracktoporbot==3
							x_sp=x_crack.bot(sp,:,currentcrackpathnum);
						else
							x_sp=x_crack.center(sp,:,currentcrackpathnum);
						end
						TheFieldSplitBase3_ni(io,irsp_outloop,icrackpath)=1;
						for crack_p_counter=1:(size(x_crack_modified,1)-1)
							x1=x_sp;
							x2=LOC(io,:);
							x3=x_crack_modified(crack_p_counter,:);
							x4=x_crack_modified(crack_p_counter+1,:);
							Area(1)=TriangleArea(x1,x2,x3);
							Area(2)=TriangleArea(x1,x2,x4);
							Area(3)=TriangleArea(x3,x4,x1);
							Area(4)=TriangleArea(x3,x4,x2);
							if Area(1)<0 && Area(2)>=0 && Area(3)>=0 && Area(4)<0
								Field2Counter=Field2Counter+1;
                                %close gcf;
                                %plot(LOC(io,1),LOC(io,2),'o','DisplayName','Node');
                                %hold on
                                %plot(x_sp(sp,1),x_sp(sp,2),'o','DisplayName','Particle');
                                %plot(x_crack_modified(:,1),x_crack_modified(:,2),'-','DisplayName','Crack Whole');
                                %plot(x_crack_modified(crack_p_counter:crack_p_counter+1,1),x_crack_modified(crack_p_counter:crack_p_counter+1,2),'-o','DisplayName','Crack Interest');
                                %daspect([1 1 1]);
                                %legend show
                                %title(['above, particle=' num2str(sp) ', node=' num2str(io)]);
                                %1;
							elseif Area(1)>=0 && Area(2)<0 && Area(3)<0 && Area(4)>=0
								Field3Counter=Field3Counter+1;
                                %close gcf;
                                %plot(LOC(io,1),LOC(io,2),'o','DisplayName','Node');
                                %hold on
                                %plot(x_sp(sp,1),x_sp(sp,2),'o','DisplayName','Particle');
                                %plot(x_crack_modified(:,1),x_crack_modified(:,2),'-','DisplayName','Crack Whole');
                                %plot(x_crack_modified(crack_p_counter:crack_p_counter+1,1),x_crack_modified(crack_p_counter:crack_p_counter+1,2),'-o','DisplayName','Crack Interest');
                                %daspect([1 1 1]);
                                %legend show
                                %title(['below, particle=' num2str(sp) ', node=' num2str(io)]);
                                %1;
							end
						end
						if Field2Counter>0 && Field3Counter>0
							Field23Min=min([Field2Counter Field3Counter]);
							Field2Counter=Field2Counter-Field23Min;
							Field3Counter=Field3Counter-Field23Min;
						end
						if mod(Field2Counter,2)>0
							TheFieldSplitBase3_ni(io,irsp_outloop,icrackpath)=2;
							%SplitSourceSplitBase3(io,sp,icrackpath)=crack_p_counter;
						elseif mod(Field3Counter,2)>0
							TheFieldSplitBase3_ni(io,irsp_outloop,icrackpath)=3;
							%SplitSourceSplitBase3(io,sp,icrackpath)=crack_p_counter;
						end
					end
					% mapping revision done
					
					% checking if revision is successful
					nodalfieldlist=sort(unique(TheFieldSplitBase3_ni(io,1:CONNECTpn_crack_topbot.nrparticles(currentcrackpathnum,io),icrackpath)));
					if length(nodalfieldlist)==3
						fprintf('%s',['fix attempt number ' int2txt(fixmode) ' failed' char(10)]);
						TheFieldSplitBase3_ni(irsp_outloop,:,icrackpath)=TheFieldSplitBase3_old_io;
						if fixmode==3
							fprintf('%s',['code 1904172033' char(10)]);
							pause
							1;
						end
					elseif length(nodalfieldlist)==2
						fprintf('%s',['fix attempt number ' int2txt(fixmode) ' successful' char(10)]);
						break;
					elseif length(nodalfieldlist)==1
						fprintf('%s',['fix attempt number ' int2txt(fixmode) ' broke separation (code 1904172022)' char(10)]);
						pause;
						1;
					end
					% done checking if revision is successful
				end	
			end
			%{
			if length(nodalfieldlist)==2
				if nodalfieldlist(1)==1 && nodalfieldlist(2)==2
					newfieldrevision=3;
				elseif nodalfieldlist(1)==1 && nodalfieldlist(2)==3
					newfieldrevision=2;
				end
			end
			if newfieldrevision>1
				for irsp=1:CONNECTpn_crack_topbot.nrparticles(currentcrackpathnum,io)
					if TheFieldSplitBase3_ni(io,irsp,icrackpath)==1
						TheFieldSplitBase3_ni(io,irsp,icrackpath)=newfieldrevision;
					end
				end
			end
			%}
		end
	end
	%nroCounter=zeros(1,spCount);
	iro=1;
	for io=1:noCount %io: moving number (i) of n(o)de
		for nrsp=1:CONNECTpn_crack_topbot.nrparticles(currentcrackpathnum,io);
			sp=CONNECTpn_crack_topbot.values(io,nrsp,currentcrackpathnum);
            for iro_seek=1:4
                if CONNECT_crack_topbot.values(sp,iro_seek,currentcrackpathnum)==io
                    iro=iro_seek;
                    break;
                end
            end
			%nroCounter(sp)=nroCounter(sp)+1;
			for j=1:numberofcrackpaths
				TheFieldSplitBase3_sp(iro,sp,j)=TheFieldSplitBase3_ni(io,nrsp,j);
			end
		end
    end
    1;
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function DecOut=BaseNtoDec(inputarray,startnum,endnum)
    DecOut=startnum;
    inputarraylength=length(inputarray);
    for i=inputarraylength:-1:1
        DecOut=DecOut+(inputarray(i)-startnum)*(endnum+1-startnum)^(inputarraylength-i);
    end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [CrossDir,RelativeLocation]=FindCrossing(x1,x2,x3,x4)
	%CrossDir=0:no crossing; 1:cross from above; 2:cross from below
	CrossDir=0;
	RelativeLocation=0;
	Area=zeros(1,4);
	Area(1)=TriangleArea(x1,x2,x3);
	Area(2)=TriangleArea(x1,x2,x4);
	Area(3)=TriangleArea(x3,x4,x1);
	Area(4)=TriangleArea(x3,x4,x2);
	if Area(1)<0 && Area(2)>=0 && Area(3)>=0 && Area(4)<0
		CrossDir=1;
		RelativeLocation=Area(3)/(Area(3)-Area(4));
	elseif Area(1)>=0 && Area(2)<0 && Area(3)<0 && Area(4)>=0
		CrossDir=2;
		RelativeLocation=Area(3)/(Area(3)-Area(4));
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function Area = TriangleArea(x1,x2,x3)
	Area=x1(1)*(x2(2)-x3(2))+x2(1)*(x3(2)-x1(2))+x3(1)*(x1(2)-x2(2));
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [nmass_si,nmomentum_si,niforce_si,neforce_si,traction_si,pforce_si,ncforce_si,L_si]=Interpolate_Particle_To_Grid_WithPredeterminedVelocity2(NODES,nodeCount,CONNECT,le,N,dN,spCount,b_sp,A_sp,t_sp,ptraction_sp,v_ssp,s_sp,m_sp,pforce_sp,Nmatrix,dNxmatrix,dNymatrix,ncforce_cracktop,ncforce_crackbot,Nmatrix_cracktop,Nmatrix_crackbot,TheFieldSplit,CasetoRun,CONNECTpn)
	%% Interpolation from particle to grid task
	% Node variables
	fieldnumber=size(Nmatrix,3);
	nmass_si=zeros(size(Nmatrix,1),fieldnumber);
	nmomentum_si=zeros(size(Nmatrix,1),2,fieldnumber);
	for field=fieldnumber:-1:1
		nmass_si(:,field)                = Nmatrix(:,:,field)*m_sp;                         % Nodal Mass
		nmomentum_si(:,1,field)       = Nmatrix(:,:,field)*(m_sp.*v_ssp(:,1));           % Nodal Momentum in X direction
		nmomentum_si(:,2,field)       = Nmatrix(:,:,field)*(m_sp.*v_ssp(:,2));           % Nodal Momentum in Y direction
	end
	niforce_si              = zeros(nodeCount,2,fieldnumber);                   % Nodal Internal force
	neforce_si              = zeros(nodeCount,2,fieldnumber);                   % Nodal External force
	traction_si             = zeros(nodeCount,2,fieldnumber);                   % Nodal Traction
	pforce_si               = zeros(nodeCount,2,fieldnumber);                   % Nodal Extra Particle force
	L_si                    = zeros(nodeCount,2,2,fieldnumber);
	pforce_si               = zeros(nodeCount,2,fieldnumber);                   % Nodal traction
	SSPtophalf_sp           = zeros(spCount,2);
	SSPbothalf_sp           = zeros(spCount,2);

	ncforce_si              = zeros(nodeCount,2,fieldnumber);                   % Nodal crack force

	if CasetoRun==84 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124 || CasetoRun==117 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110 || CasetoRun==96 || CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89 || CasetoRun==85 %multicrack nodal force deactivated for now
	else
		ncforce_si(:,:,2)    = Nmatrix_cracktop*ncforce_cracktop;
		ncforce_si(:,:,3)    = Nmatrix_crackbot*ncforce_crackbot;
	end

	%{
	ncforce_si(:,1,2)    = Nmatrix_cracktop*ncforce_cracktop(:,1);
	ncforce_si(:,2,2)    = Nmatrix_cracktop*ncforce_cracktop(:,2);
	ncforce_si(:,1,3)    = Nmatrix_crackbot*ncforce_crackbot(:,1);
	ncforce_si(:,2,3)    = Nmatrix_crackbot*ncforce_crackbot(:,2);
	%}

	for i=1:nodeCount
		niSize=size(CONNECTpn,2); %size of list of sp for a certain ni
		for nsp=1:size(CONNECTpn,2)
			if CONNECTpn(i,nsp)<1
				niSize=nsp-1;
				break;
			end
		end
		TheFieldSplit_ni=zeros(1,niSize) %A row of TheFieldSplit for a certain ni
		for nsp=1:niSize
			nni=0;
			sp=CONNECTpn(i,nsp);
			for nni=1:length(CONNECT{sp});
				if CONNECT{sp}(nni)==i;
					break;
				end
			end
			TheFieldSplit_ni(1,nsp)=TheFieldSplit{sp}(nni);
		end
		if unique(TheFieldSplit_ni(1,:))==1
			ncforce_si(i,:,1)=ncforce_si(i,:,2)+ncforce_si(i,:,3);
			ncforce_si(i,:,2)=[0 0];
			ncforce_si(i,:,3)=[0 0];
		end
	end

	for sp=1:spCount %originally parfor
		SSPtophalf_sp(sp,:)=[s_sp(sp,1) s_sp(sp,3)];
		SSPbothalf_sp(sp,:)=[s_sp(sp,3) s_sp(sp,2)];
	end

	for field=1:fieldnumber
		niforce_si(:,1,field)        = -((dNxmatrix(:,:,field)*(A_sp.*t_sp.*SSPtophalf_sp(:,1)))+(dNymatrix(:,:,field)*(A_sp.*t_sp.*SSPtophalf_sp(:,2)))) ;%- 0.07*v_ssp(sp,:); %damping
		niforce_si(:,2,field)        = -((dNxmatrix(:,:,field)*(A_sp.*t_sp.*SSPbothalf_sp(:,1)))+(dNymatrix(:,:,field)*(A_sp.*t_sp.*SSPbothalf_sp(:,2)))) ;%- 0.07*v_ssp(sp,:); %damping
	end

	for field=1:fieldnumber
		L_si(:,1,1,field)=dNxmatrix(:,:,field)*v_ssp(:,1);
		L_si(:,1,2,field)=dNymatrix(:,:,field)*v_ssp(:,1);
		L_si(:,2,1,field)=dNxmatrix(:,:,field)*v_ssp(:,2);
		L_si(:,2,2,field)=dNymatrix(:,:,field)*v_ssp(:,2);

		neforce_si(:,1,field)         = Nmatrix(:,:,field)*((ones(spCount,1)*b_sp(1)).*m_sp);
		neforce_si(:,2,field)         = Nmatrix(:,:,field)*((ones(spCount,1)*b_sp(2)).*m_sp);
		pforce_si(:,1,field)       = Nmatrix(:,:,field)*pforce_sp(:,1);
		pforce_si(:,2,field)       = Nmatrix(:,:,field)*pforce_sp(:,2);

		traction_si(:,1,field)       = Nmatrix(:,:,field)*(A_sp.*t_sp.*ptraction_sp(:,1)/le(2));
		traction_si(:,2,field)       = Nmatrix(:,:,field)*(A_sp.*t_sp.*ptraction_sp(:,2)/le(1)); 

	end

	%{
	 for sp=1:spCount
	 % Build stress tensor
	 %SSP = [s_sp(sp,1) s_sp(sp,3);s_sp(sp,3) s_sp(sp,2)];
	 
	 for j=1:NODES(sp)
		 npid                           = CONNECT{sp}(j);
		 
			  if N{sp}(j)==0
			 continue
			  end
		 
	 % Mass bn m 
	 %nmass_si(npid)            = nmass_si(npid) + m_sp(sp)*N{sp}(j);
	 
	 % Momentumlp(1,1)lp(1,1)lp(1,1)
	 %nmomentum_si(npid,:)      = nmomentum_si(npid,:) + m_sp(sp)*v_ssp(sp,:)*N{sp}(j);
	 
	 % Internal forces
	 %niforce_si(npid,:)        = niforce_si(npid,:) - (A_sp(sp)*t_sp(sp)*SSP*dN{sp}(:,j))' ;%- 0.07*v_ssp(sp,:); %damping
	%{
	 if niforce_si(npid,1)~=0
		 disp(['niforce_si(' num2str(npid) ',:)=[' num2str(niforce_si(npid,1)) ',' num2str(niforce_si(npid,2)) '];sp=' num2str(sp) ';npid=' num2str(npid) ';N{' num2str(sp) '}(j)=' num2str(N{sp}(j)) ';A_sp(' num2str(sp) ')=' num2str(A_sp(sp)) ';SSP=[' num2str(SSP(1,1)) ' ' num2str(SSP(1,2)) ';' num2str(SSP(2,1)) ' ' num2str(SSP(2,2)) '];dN{' num2str(sp) '}(:,' num2str(j) ')=[' num2str(dN{sp}(1,j)) ' ' num2str(dN{sp}(2,j)) ']']);
		 dummy=sum(niforce_si);
		 disp(['sum(niforce_si)=[' num2str(dummy(1)) ',' num2str(dummy(2)) '];']); 
		 1;
	 end
	%}
	%for p=1:2
	%    for q=1:2
	%        L_si(npid,p,q)=L_si(npid,p,q)+v_ssp(sp,p)*dN{sp}(q,j);
	%    end
	%end
	 % External forces
	%neforce_si(npid,:)         = neforce_si(npid,:) + b_sp*m_sp(sp)*N{sp}(j);

	 % Extra particle forces
	%pforce_si(npid,:)          = pforce_si(npid,:) + pforce_sp(sp,:)*N{sp}(j);

	% Traction
	%  traction_si(npid,:)       = traction_si(npid,:) + A_sp(sp)*ptraction_sp(sp,:)*N{sp}(j)/le(1,1)/le(1,2);
	 %traction_si(npid,1)       = traction_si(npid,1) + A_sp(sp)*t_sp(sp)*ptraction_sp(sp,1)*N{sp}(j)/le(2);
	 %traction_si(npid,2)       = traction_si(npid,2) + A_sp(sp)*t_sp(sp)*ptraction_sp(sp,2)*N{sp}(j)/le(1); 
	 end 
	 end
	%}
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [mEfactor_si,x0_si,x_si,deltarideal_si,LW_si_comb,EW_si_comb,nmass_si,nmomentum_si,niforce_si,neforce_si,traction_si,pforce_si,ncforce_si,s_si,s_si_comb,u_si,u_si_comb,v_si,uncrackable_si,uncrackable_si_comb,L_si]=Interpolate_Particle_To_Grid_WithPredeterminedVelocity2_optimized(LOC,N_crack,CONNECT_crack,NODES_crack,TheFieldSplit_cracktop,TheFieldSplit_crackbot,x_crack,deltarideal_sp,NODES,nodeCount,CONNECT,le,N,dN,spCount,b_sp,A_sp,t_sp,ptraction_sp,v_ssp,s_sp,m_sp,pforce_sp,TheFieldSplit,CasetoRun,fieldnumber,x_sp,x_spo,uncrackable_sp,LWStatus,EWStatus,Efactor_sp)
	%% Interpolation from particle to grid task
	% Node variables
	%grid mapping
	niforce_si              = zeros(nodeCount,2,fieldnumber);                   % Nodal Internal force
	neforce_si              = zeros(nodeCount,2,fieldnumber);                   % Nodal External force
	traction_si             = zeros(nodeCount,2,fieldnumber);                   % Nodal Traction
	pforce_si               = zeros(nodeCount,2,fieldnumber);                   % Nodal Extra Particle force
	L_si                    = zeros(nodeCount,2,2,fieldnumber);
	pforce_si               = zeros(nodeCount,2,fieldnumber);                   % Nodal traction
	ncforce_si              = zeros(nodeCount,2,fieldnumber);                   % Nodal crack force
    nmass_si                = zeros(nodeCount,fieldnumber);
	nmass_si_comb           = zeros(nodeCount,1);
    nmomentum_si            = zeros(nodeCount,2,fieldnumber);
	deltarideal_si          = zeros(nodeCount,fieldnumber);
	x0_si                   = zeros(nodeCount,2,fieldnumber);
	x_si                    = zeros(nodeCount,2,fieldnumber);
		
	ms_si                    = zeros(nodeCount,3,fieldnumber);
	mu_si                    = zeros(nodeCount,2,fieldnumber);
	ms_si_comb               = zeros(nodeCount,3);
	mu_si_comb               = zeros(nodeCount,2);
	mLW_si                    = zeros(nodeCount,fieldnumber);
	mLW_si_comb               = zeros(nodeCount,1);
	mEW_si                    = zeros(nodeCount,fieldnumber);
	mEW_si_comb               = zeros(nodeCount,1);
	mdeltarideal_si           = zeros(nodeCount,fieldnumber);
	mx0_si                    = zeros(nodeCount,2,fieldnumber);
	mx_si                     = zeros(nodeCount,2,fieldnumber);
	Efactor_si                = zeros(nodeCount,fieldnumber);
	mEfactor_si               = zeros(nodeCount,fieldnumber);
	

	
	muncrackable_si=zeros(nodeCount,fieldnumber);
	uncrackable_si=zeros(nodeCount,fieldnumber);
	uncrackable_si_comb=zeros(nodeCount,1);
	
	s_si                    = zeros(nodeCount,3,fieldnumber);
	u_si                    = zeros(nodeCount,2,fieldnumber);
	v_si                    = zeros(nodeCount,2,fieldnumber);
	LW_si                   = zeros(nodeCount,fieldnumber);
	LW_si_comb              = zeros(nodeCount,1);
	EW_si                   = zeros(nodeCount,fieldnumber);
	EW_si_comb              = zeros(nodeCount,1);
	s_si_comb               = zeros(nodeCount,3);
	u_si_comb               = zeros(nodeCount,2);
	u_sp                    = zeros(spCount,2);
	
	parfor sp=1:spCount
		for dim=1:2
			u_sp(sp,dim)=x_sp(sp,dim)-x_spo(sp,dim);
		end
	end
	
	for sp=1:spCount
		% Build stress tensor
		SSP = [s_sp(sp,1) s_sp(sp,3);s_sp(sp,3) s_sp(sp,2)];

		for j=1:NODES(sp)
			npid                           = CONNECT{sp}(j);

			if N{sp}(j)==0
				continue
			end

			% Mass bn m 
			nmass_si(npid,TheFieldSplit(j,sp))            = nmass_si(npid,TheFieldSplit(j,sp)) + m_sp(sp)*N{sp}(j);

			% Momentumlp(1,1)lp(1,1)lp(1,1)
			nmomentum_si(npid,:,TheFieldSplit(j,sp))      = nmomentum_si(npid,:,TheFieldSplit(j,sp)) + m_sp(sp)*v_ssp(sp,:)*N{sp}(j);

			% Internal forces
			niforce_si(npid,:,TheFieldSplit(j,sp))        = niforce_si(npid,:,TheFieldSplit(j,sp)) - (A_sp(sp)*t_sp(sp)*SSP*dN{sp}(:,j))' ;%- 0.07*v_ssp(sp,:); %damping
			for p=1:2
				for q=1:2
					L_si(npid,p,q,TheFieldSplit(j,sp))    = L_si(npid,p,q,TheFieldSplit(j,sp))+v_ssp(sp,p)*dN{sp}(q,j);
				end
			end
			% External forces
			neforce_si(npid,:,TheFieldSplit(j,sp))         = neforce_si(npid,:,TheFieldSplit(j,sp)) + b_sp*m_sp(sp)*N{sp}(j);

			% Extra particle forces
			pforce_si(npid,:,TheFieldSplit(j,sp))          = pforce_si(npid,:,TheFieldSplit(j,sp)) + pforce_sp(sp,:)*N{sp}(j);

			% Traction
			%traction_si(npid,:)       = traction_si(npid,:) + A_sp(sp)*ptraction_sp(sp,:)*N{sp}(j)/le(1,1)/le(1,2);
			traction_si(npid,1,TheFieldSplit(j,sp))       = traction_si(npid,1,TheFieldSplit(j,sp)) + A_sp(sp)*t_sp(sp)*ptraction_sp(sp,1)*N{sp}(j)/le(2);
			traction_si(npid,2,TheFieldSplit(j,sp))       = traction_si(npid,2,TheFieldSplit(j,sp)) + A_sp(sp)*t_sp(sp)*ptraction_sp(sp,2)*N{sp}(j)/le(1);
			if CasetoRun==174
				mEfactor_si(npid,TheFieldSplit(j,sp))=mEfactor_si(npid,TheFieldSplit(j,sp))+Efactor_sp(sp)*m_sp(sp)*N{sp}(j);
			end
			if CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152
                muncrackable_si(npid,TheFieldSplit(j,sp))=muncrackable_si(npid,TheFieldSplit(j,sp))+m_sp(sp)*uncrackable_sp(sp)*N{sp}(j);
				mdeltarideal_si(npid,TheFieldSplit(j,sp))=mdeltarideal_si(npid,TheFieldSplit(j,sp))+m_sp(sp)*deltarideal_sp(sp)*N{sp}(j);
				for dim=1:2
					mx0_si(npid,dim,TheFieldSplit(j,sp))=mx0_si(npid,dim,TheFieldSplit(j,sp))+m_sp(sp)*x_spo(sp,dim)*N{sp}(j);
					mx_si(npid,dim,TheFieldSplit(j,sp))=mx_si(npid,dim,TheFieldSplit(j,sp))+m_sp(sp)*x_sp(sp,dim)*N{sp}(j);
				end
			elseif CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==190 || CasetoRun==187
                muncrackable_si(npid,TheFieldSplit(j,sp))=muncrackable_si(npid,TheFieldSplit(j,sp))+m_sp(sp)*uncrackable_sp(sp)*N{sp}(j);
            else
                muncrackable_si(npid,TheFieldSplit(j,sp))=0;
				mdeltarideal_si(npid,TheFieldSplit(j,sp))=0;
				for dim=1:2
					mx0_si(npid,dim,TheFieldSplit(j,sp))=0;
					mx_si(npid,dim,TheFieldSplit(j,sp))=0;
				end
            end
			ms_si(npid,:,TheFieldSplit(j,sp))=ms_si(npid,:,TheFieldSplit(j,sp))+m_sp(sp)*s_sp(sp,:)*N{sp}(j);
			
			mu_si(npid,:,TheFieldSplit(j,sp))=mu_si(npid,:,TheFieldSplit(j,sp))+m_sp(sp)*u_sp(sp,:)*N{sp}(j);
			
			if CasetoRun==124
				mLW_si_comb(npid)=mLW_si_comb(npid)+m_sp(sp)*LWStatus(sp)*N{sp}(j);
				mEW_si_comb(npid)=mEW_si_comb(npid)+m_sp(sp)*EWStatus(sp)*N{sp}(j);
			end
		end
	end
	
	for icrackpath=1:x_crack.npaths
	if x_crack.cohesivepath(icrackpath)==1
		for iparticle=1:x_crack.nparticles(icrackpath)
		if x_crack.cohesivepoint(iparticle,icrackpath)==1
			for iro=1:NODES_crack.top(icrackpath,iparticle)
				io=CONNECT_crack.top.values(iparticle,iro,icrackpath);
				igridlayer=TheFieldSplit_cracktop{icrackpath}(iro,iparticle);
				for idim=1:2
					ncforce_si(io,idim,igridlayer)=ncforce_si(io,idim,igridlayer)+x_crack.force.top(iparticle,idim,icrackpath)*N_crack.top(1,iro,iparticle,icrackpath);
				end
			end
			for iro=1:NODES_crack.bot(icrackpath,iparticle)
				io=CONNECT_crack.bot.values(iparticle,iro,icrackpath);
				igridlayer=TheFieldSplit_crackbot{icrackpath}(iro,iparticle);
				for idim=1:2
					ncforce_si(io,idim,igridlayer)=ncforce_si(io,idim,igridlayer)+x_crack.force.bot(iparticle,idim,icrackpath)*N_crack.bot(1,iro,iparticle,icrackpath);
				end
			end
			end
		end
		end
	end
	
	parfor io=1:nodeCount
		nmass_si_comb(io)=sum(nmass_si(io,:));
	end
	parfor io=1:nodeCount
		if nmass_si_comb(io)>0
			for dim=1:3
				s_si_comb(io,dim)=sum(ms_si(io,dim,:))/nmass_si_comb(io);
				%tempmarker1
			end
		end
	end
	parfor io=1:nodeCount	
		if nmass_si_comb(io)>0
			for dim=1:2
				u_si_comb(io,dim)=sum(mu_si(io,dim,:))/nmass_si_comb(io);
			end
		end
	end
	parfor io=1:nodeCount
		for ifield=1:fieldnumber
			if nmass_si(io,ifield)>0
				for dim=1:2
					u_si(io,dim,ifield)=mu_si(io,dim,ifield)/nmass_si(io,ifield);
				end
			end
		end
	end
	parfor io=1:nodeCount
		for ifield=1:fieldnumber
			if nmass_si(io,ifield)>0
				for dim=1:2
					v_si(io,dim,ifield)=nmomentum_si(io,dim,ifield)/nmass_si(io,ifield);
				end
			end
		end
	end
	parfor io=1:nodeCount
		for ifield=1:fieldnumber
			if nmass_si(io,ifield)>0
				for dim=1:3
					s_si(io,dim,ifield)=ms_si(io,dim,ifield)/nmass_si(io,ifield);
				end
			end
		end
	end
	parfor io=1:nodeCount
		for ifield=1:fieldnumber
			if nmass_si(io,ifield)>0
				uncrackable_si(io,ifield)=muncrackable_si(io,ifield)/nmass_si(io,ifield);
			end
		end
	end
	parfor io=1:nodeCount
		for ifield=1:fieldnumber
			if nmass_si(io,ifield)>0
				deltarideal_si(io,ifield)=mdeltarideal_si(io,ifield)/nmass_si(io,ifield);
			end
		end
	end
	parfor io=1:nodeCount
		for ifield=1:fieldnumber
			if nmass_si(io,ifield)>0
				for dim=1:2
					x_si(io,dim,ifield)=mx_si(io,dim,ifield)/nmass_si(io,ifield);
				end
			end
		end
	end
	parfor io=1:nodeCount
		for ifield=1:fieldnumber
			if nmass_si(io,ifield)>0
				for dim=1:2
					x0_si(io,dim,ifield)=mx0_si(io,dim,ifield)/nmass_si(io,ifield);
				end
			end
		end
	end

	for io=1:nodeCount	
		if nmass_si_comb(io)>0
			uncrackable_si_comb(io,1)=sum(muncrackable_si(io,:))/nmass_si_comb(io);
		end
	end
	for io=1:nodeCount
		if nmass_si_comb(io)>0
			LW_si_comb(io,1)=mLW_si_comb(io,1)/nmass_si_comb(io);
		end
	end
	for io=1:nodeCount
		if nmass_si_comb(io)>0
			EW_si_comb(io,1)=mEW_si_comb(io,1)/nmass_si_comb(io);
		end
	end
	for io=1:nodeCount
		if nmass_si_comb(io)>0
			EW_si_comb(io,1)=mEW_si_comb(io,1)/nmass_si_comb(io);
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [N,dN,CONNECT,spElems,mspoints,NODES,Nmatrix,dNxmatrix,dNymatrix] = Compute_Interpolator_CPDI_var(spCount,cellCount,x_sp,le_c,NN,LOC,r1_sp,r2_sp,A_sp,LOCX,LOCY)
	
    spElems        = zeros(spCount,1);
    N              = cell(1,spCount);
    dN             = cell(1,spCount);
    CONNECT        = cell(1,spCount);
	NODES          = zeros(1,spCount);
    siCount=NN(1)*NN(2);
    Nmatrix=zeros(siCount,spCount);
    dNxmatrix=zeros(siCount,spCount);
    dNymatrix=zeros(siCount,spCount);
	%spElems=zeros(1,spCount)
	
%{
%switchable1
	try
		parfor sp=1:spCount
			[N{sp},dN{sp},CONNECT{sp},spElems(sp),NODES(sp),Nmatrixrow,dNxmatrixrow,dNymatrixrow] = ...
				Compute_Interpolator_CPDI_parforred(x_sp(sp,:),le,NN,LOC,r1_sp(sp,:),r2_sp(sp,:),A_sp(sp,:),siCount);
			Nmatrix(:,sp)=Nmatrixrow;
			dNxmatrix(:,sp)=dNxmatrixrow;
			dNymatrix(:,sp)=dNymatrixrow;
		end
	catch
		fprintf('%s',['parforred Compute_Interpolator_CPDI_parforred failed, switching to regular for!' char(10)]);
%}
%switchable1
		for sp=1:spCount
			[N{sp},dN{sp},CONNECT{sp},spElems(sp),NODES(sp),Nmatrixrow,dNxmatrixrow,dNymatrixrow] = ...
				Compute_Interpolator_CPDI_parforred(x_sp(sp,:),le,NN,LOC,r1_sp(sp,:),r2_sp(sp,:),A_sp(sp,:),siCount);
			Nmatrix(:,sp)=Nmatrixrow;
			dNxmatrix(:,sp)=dNxmatrixrow;
			dNymatrix(:,sp)=dNymatrixrow;
		end
%{
%switchable1
	end
%}
%switchable1
	
	
    for c =1:cellCount
        id_sp = find(spElems==c);
        mspoints{c}=id_sp;
    end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [N,dN,CONNECT,spElems,NODES,Nmatrixrow,dNxmatrixrow,dNymatrixrow] = ...
    Compute_Interpolator_CPDI_parforred_var(x_sp,le_c,LOC,r1_sp,r2_sp,A_sp,siCount,LOCX,LOCY)

    CONNECT_TEMP   = zeros(1,16);
    spElems_corner = zeros(1,4);
    x_corner{4}      = zeros(1,2);
    x_corner{3}      = zeros(1,2);
    x_corner{2}      = zeros(1,2);
    x_corner{1}      = zeros(1,2);
    Nmatrixrow     = zeros(siCount,1);
    dNxmatrixrow   = zeros(siCount,1);
    dNymatrixrow   = zeros(siCount,1);


    x_corner{1}(1,:) = x_sp(1,:) - r1_sp(1,:) - r2_sp(1,:);      % Position of corner 1
    x_corner{2}(1,:) = x_sp(1,:) + r1_sp(1,:) - r2_sp(1,:);
    x_corner{3}(1,:) = x_sp(1,:) + r1_sp(1,:) + r2_sp(1,:);
    x_corner{4}(1,:) = x_sp(1,:) - r1_sp(1,:) + r2_sp(1,:);

    %spElems(1) = ceil(x_sp(1,1)/le(1))+(NN(1)-1)*(fix(x_sp(1,2)/le(2)));   % compute vector store index elements                           
    
    spElems=identifycellsandnodes(x_sp,LOCX,LOCY,[],[],[1 0 0 0]);

    %spElems_corner(1,1) = ceil(x_corner{1}(1,1)/le(1))+(NN(1)-1)*(fix(x_corner{1}(1,2)/le(2)));                        
    %spElems_corner(1,2) = ceil(x_corner{2}(1,1)/le(1))+(NN(1)-1)*(fix(x_corner{2}(1,2)/le(2)));                        
    %spElems_corner(1,3) = ceil(x_corner{3}(1,1)/le(1))+(NN(1)-1)*(fix(x_corner{3}(1,2)/le(2)));
    %spElems_corner(1,4) = ceil(x_corner{4}(1,1)/le(1))+(NN(1)-1)*(fix(x_corner{4}(1,2)/le(2)));

    for i=1:4
        [spElems_corner(1,i), CONNECT_TEMP(1,((i-1)*4+1):(i*4))] = identifycellsandnodes(x_corner{i},LOCX,LOCY,[],[],[1 1 0 0]);
    end
    
    CONNECT=unique(CONNECT_TEMP(1,:));    % Store nodes interacting with corners
	NODES=zeros(1,1);
    NODES(1)=length(CONNECT);         % Store number of interacting nodes
	dN=zeros(2,NODES(1));

    N1 = zeros(1,NODES(1));   % Shape function of corner 1 for 16 nodes
    N2 = zeros(1,NODES(1));
    N3 = zeros(1,NODES(1));
    N4 = zeros(1,NODES(1));
    N_local = zeros(1,NODES(1));

    for i=1:NODES(1)
        [N1(i),~,~] = linearshape(x_corner{1}(1,:),LOC(CONNECT(i),:),le_c(spElems_corner(1,1),1),le_c(spElems_corner(1,1),2));
        [N2(i),~,~] = linearshape(x_corner{2}(1,:),LOC(CONNECT(i),:),le_c(spElems_corner(1,2),1),le_c(spElems_corner(1,2),2));
        [N3(i),~,~] = linearshape(x_corner{3}(1,:),LOC(CONNECT(i),:),le_c(spElems_corner(1,3),1),le_c(spElems_corner(1,3),2));
        [N4(i),~,~] = linearshape(x_corner{4}(1,:),LOC(CONNECT(i),:),le_c(spElems_corner(1,4),1),le_c(spElems_corner(1,4),2));
        N_local(i)  = 0.25*(N1(i)+N2(i)+N3(i)+N4(i));
    end

    N = N_local;

    % Build matrix of gradient of shape function 
    w1 = [r1_sp(1,2)-r2_sp(1,2) r2_sp(1,1)-r1_sp(1,1)];
    w2 = [r1_sp(1,2)+r2_sp(1,2) -r2_sp(1,1)-r1_sp(1,1)];

    for i=1:NODES(1)      
        dN(1,i)     = 1/A_sp(1)*((N1(i)-N3(i))*w1(1) + (N2(i)-N4(i))*w2(1));
        dN(2,i)     = 1/A_sp(1)*((N1(i)-N3(i))*w1(2) + (N2(i)-N4(i))*w2(2));
    end

    for i=1:NODES(1)
        Nmatrixrow(CONNECT(i),1)=N(i);
        dNxmatrixrow(CONNECT(i),1)=dN(1,i);
        dNymatrixrow(CONNECT(i),1)=dN(2,i);
    end
	
	
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [N,dN,CONNECT,spElems,mspoints,NODES,Nmatrix,dNxmatrix,dNymatrix,CONNECTpn] = Compute_Interpolator_CPDI(spCount,cellCount,x_sp,le,NN,LOC,r1_sp,r2_sp,A_sp,t_sp)
    spElems        = zeros(spCount,1);
    N              = cell(1,spCount);
    dN             = cell(1,spCount);
    CONNECT        = cell(1,spCount);
	NODES          = zeros(1,spCount);
    siCount=NN(1)*NN(2);
    CONNECTpn=cell(1,siCount);
    Nmatrix=zeros(siCount,spCount);
    dNxmatrix=zeros(siCount,spCount);
    dNymatrix=zeros(siCount,spCount);
%{
%switchable1
    try
        parfor sp=1:spCount
            [N{sp},dN{sp},CONNECT{sp},spElems(sp),NODES(sp),Nmatrixrow,dNxmatrixrow,dNymatrixrow] = ...
                Compute_Interpolator_CPDI_parforred(x_sp(sp,:),le,NN,LOC,r1_sp(sp,:),r2_sp(sp,:),A_sp(sp,:),siCount);
            Nmatrix(:,sp)=Nmatrixrow;
            dNxmatrix(:,sp)=dNxmatrixrow;
            dNymatrix(:,sp)=dNymatrixrow;
        end
    catch
        fprintf('%s',['parfor failed inside Compute_Interpolator_CPID, switching to regular for' char(10)]);
%}
%switchable1
        for sp=1:spCount
            [N{sp},dN{sp},CONNECT{sp},spElems(sp),NODES(sp),Nmatrixrow,dNxmatrixrow,dNymatrixrow] = ...
                Compute_Interpolator_CPDI_parforred(x_sp(sp,:),le,NN,LOC,r1_sp(sp,:),r2_sp(sp,:),A_sp(sp,:),siCount);
            Nmatrix(:,sp)=Nmatrixrow;
            dNxmatrix(:,sp)=dNxmatrixrow;
            dNymatrix(:,sp)=dNymatrixrow;
        end
%{
%switchable1
    end
%}
%switchable1
    for sp=1:spCount
        for i=1:length(CONNECT{sp})
            CONNECTpn{CONNECT{sp}(i)}=[CONNECTpn{CONNECT{sp}(i)} sp];
        end
    end
	
	
    for c =1:cellCount
        id_sp = find(spElems==c);
        mspoints{c}=id_sp;
    end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [N0] = Compute_Interpolator_CPDI_optimized_N0(spCount,cellCount,x_sp,le,NN,LOC,r1_sp,r2_sp,A_sp,t_sp,nvelo_skip,Npnskip)
	[DUMMY1,DUMMY2,DUMMY3,DUMMY4,DUMMY5,DUMMY6,CONNECTpn,Npn] = Compute_Interpolator_CPDI_optimized(spCount,cellCount,x_sp,le,NN,LOC,r1_sp,r2_sp,A_sp,t_sp,nvelo_skip,Npnskip);
	
	N0.CONNECTpn.values=zeros(size(CONNECTpn.values));
	N0.CONNECTpn.nrparticles=zeros(size(CONNECTpn.nrparticles));
	N0.Npn.values=zeros(size(Npn.values));
	N0.Npn.nrparticles=zeros(size(Npn.nrparticles));
	
	N0.CONNECTpn.values=CONNECTpn.values;
	N0.CONNECTpn.nrparticles=CONNECTpn.nrparticles;
	N0.Npn.values=Npn.values;
	N0.Npn.nrparticles=Npn.nrparticles;
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [N,dN,CONNECT,spElems,mspoints,NODES,CONNECTpn,Npn] = Compute_Interpolator_CPDI_optimized(spCount,cellCount,x_sp,le,NN,LOC,r1_sp,r2_sp,A_sp,t_sp,nvelo_skip,Npnskip)
    spElems        = zeros(spCount,1);
    N              = cell(1,spCount);
    dN             = cell(1,spCount);
    CONNECT        = cell(1,spCount);
	NODES          = zeros(1,spCount);
    siCount=NN(1)*NN(2);
%{
%switchable1
    try
        parfor sp=1:spCount
            [N{sp},dN{sp},CONNECT{sp},spElems(sp),NODES(sp),Nmatrixrow] = ...
                Compute_Interpolator_CPDI_parforred_optimized(x_sp(sp,:),le,NN,LOC,r1_sp(sp,:),r2_sp(sp,:),A_sp(sp,:),siCount);
            Nmatrix(:,sp)=Nmatrixrow;
        end
    catch
        fprintf('%s',['parfor failed inside Compute_Interpolator_CPID, switching to regular for' char(10)]);
%}
%switchable1
		fprintf('%s',['marker #645' char(10)]);
        parfor sp=1:spCount
            [N{sp},dN{sp},CONNECT{sp},spElems(sp),NODES(sp)] = ...
                Compute_Interpolator_CPDI_parforred_optimized(x_sp(sp,:),le,NN,LOC,r1_sp(sp,:),r2_sp(sp,:),A_sp(sp,:),siCount);
        end
		fprintf('%s',['marker #646' char(10)]);
%{
%switchable1
    end
%}
%switchable1
	if nvelo_skip==1
		CONNECTpn.values=zeros(siCount,2);
		CONNECTpn.nrparticles=zeros(1,siCount);
		Npn.values=zeros(siCount,2);
		Npn.nparticles=zeros(1,siCount);
		%might cause problems with Coder?
	else
		CONNECTpn_temp_sizes=zeros(1,siCount);
		for sp=1:spCount
			for i=1:length(CONNECT{sp})
				CONNECTpn_temp_sizes(CONNECT{sp}(i))=CONNECTpn_temp_sizes(CONNECT{sp}(i))+1;
			end
		end
		
		CONNECTpnMaxSize=1;
		for i=1:length(CONNECTpn_temp_sizes)
			if CONNECTpn_temp_sizes(i)>CONNECTpnMaxSize
				CONNECTpnMaxSize=CONNECTpn_temp_sizes(i);
			end
		end
		CONNECTpn_temp=zeros(siCount,CONNECTpnMaxSize);
		Npn_temp=zeros(siCount,CONNECTpnMaxSize);
		%{
		for i=1:size(CONNECTpn_temp,1)
			if CONNECTpn_temp_sizes(i)==0
				CONNECTpn_temp{i}=zeros(1,1);
			else
				CONNECTpn_temp{i}=zeros(1,CONNECTpn_temp_sizes(i));
			end
		end
		for i=1:size(CONNECTpn_temp,1)
			CONNECTpn_temp{i}=zeros(1,CONNECTpnMaxSize);
		end
		%}
		CONNECTpn_Counter=zeros(1,siCount);
		for sp=1:spCount
			for i=1:length(CONNECT{sp})
				CONNECTpn_Counter(CONNECT{sp}(i))=CONNECTpn_Counter(CONNECT{sp}(i))+1;
				CONNECTpn_temp(CONNECT{sp}(i),CONNECTpn_Counter(CONNECT{sp}(i)))=sp;
				if Npnskip==0
					Npn_temp(CONNECT{sp}(i),CONNECTpn_Counter(CONNECT{sp}(i)))=N{sp}(i);
				end
			end
		end
		CONNECTpn.nrparticles=zeros(1,siCount);
		CONNECTpn.values=zeros(siCount,CONNECTpnMaxSize);
		CONNECTpn.nrparticles=CONNECTpn_temp_sizes;
		CONNECTpn.values=CONNECTpn_temp;
		
		Npn.nrparticles=zeros(1,siCount);
		Npn.values=zeros(siCount,CONNECTpnMaxSize);
		Npn.nrparticles=CONNECTpn_temp_sizes;
		Npn.values=Npn_temp;
	end
	mspoints=cell(1,cellCount);
    for c =1:cellCount
        id_sp = find(spElems==c);
        mspoints{c}=id_sp;
    end
	fprintf('%s',['marker #647' char(10)]);
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [N,dN,CONNECT,spElems,NODES,Nmatrixrow,dNxmatrixrow,dNymatrixrow] = ...
    Compute_Interpolator_CPDI_parforred(x_sp,le,NN,LOC,r1_sp,r2_sp,A_sp,siCount)
	
    CONNECT_TEMP   = zeros(1,16);
    spElems_corner = zeros(1,4);
    x_corner1      = zeros(1,2);
    x_corner2      = zeros(1,2);
    x_corner3      = zeros(1,2);
    x_corner4      = zeros(1,2);
    Nmatrixrow     = zeros(siCount,1);
    dNxmatrixrow   = zeros(siCount,1);
    dNymatrixrow   = zeros(siCount,1);
	spElems        = zeros(1,1);
	NODES          = zeros(1,1);
	
	
    x_corner1(1,:) = x_sp(1,:) - r1_sp(1,:) - r2_sp(1,:);      % Position of corner 1
    x_corner2(1,:) = x_sp(1,:) + r1_sp(1,:) - r2_sp(1,:);
    x_corner3(1,:) = x_sp(1,:) + r1_sp(1,:) + r2_sp(1,:);
    x_corner4(1,:) = x_sp(1,:) - r1_sp(1,:) + r2_sp(1,:);
	
    spElems(1) = ceil(x_sp(1,1)/le(1))+(NN(1)-1)*(fix(x_sp(1,2)/le(2)));   % compute vector store index elements                           
	
    spElems_corner(1,1) = ceil(x_corner1(1,1)/le(1))+(NN(1)-1)*(fix(x_corner1(1,2)/le(2)));                        
    spElems_corner(1,2) = ceil(x_corner2(1,1)/le(1))+(NN(1)-1)*(fix(x_corner2(1,2)/le(2)));                        
    spElems_corner(1,3) = ceil(x_corner3(1,1)/le(1))+(NN(1)-1)*(fix(x_corner3(1,2)/le(2)));
    spElems_corner(1,4) = ceil(x_corner4(1,1)/le(1))+(NN(1)-1)*(fix(x_corner4(1,2)/le(2)));
	
    CONNECT_TEMP(1,1)  = spElems_corner(1,1) + myfloor((spElems_corner(1,1)-1)/(NN(1)-1));
    CONNECT_TEMP(1,2)  = CONNECT_TEMP(1,1) + 1;
    CONNECT_TEMP(1,3)  = CONNECT_TEMP(1,2) + NN(1);
    CONNECT_TEMP(1,4)  = CONNECT_TEMP(1,1) + NN(1);
	
    CONNECT_TEMP(1,5)  = spElems_corner(1,2) + myfloor((spElems_corner(1,2)-1)/(NN(1)-1));
    CONNECT_TEMP(1,6)  = CONNECT_TEMP(1,5) + 1;
    CONNECT_TEMP(1,7)  = CONNECT_TEMP(1,6) + NN(1);
    CONNECT_TEMP(1,8)  = CONNECT_TEMP(1,5) + NN(1); 
	
    CONNECT_TEMP(1,9)  = spElems_corner(1,3) + myfloor((spElems_corner(1,3)-1)/(NN(1)-1));
    CONNECT_TEMP(1,10) = CONNECT_TEMP(1,9) + 1;
    CONNECT_TEMP(1,11) = CONNECT_TEMP(1,10) + NN(1);
    CONNECT_TEMP(1,12) = CONNECT_TEMP(1,9) + NN(1); 
	
    CONNECT_TEMP(1,13) = spElems_corner(1,4) + myfloor((spElems_corner(1,4)-1)/(NN(1)-1));
    CONNECT_TEMP(1,14) = CONNECT_TEMP(1,13) + 1;
    CONNECT_TEMP(1,15) = CONNECT_TEMP(1,14) + NN(1);
    CONNECT_TEMP(1,16) = CONNECT_TEMP(1,13) + NN(1);
	
    CONNECT=unique(CONNECT_TEMP(1,:));    % Store nodes interacting with corners
    NODES(1)=length(CONNECT);         % Store number of interacting nodes
	dN=zeros(2,NODES(1));
	
    N1 = zeros(1,NODES(1));   % Shape function of corner 1 for 16 nodes
    N2 = zeros(1,NODES(1));
    N3 = zeros(1,NODES(1));
    N4 = zeros(1,NODES(1));
    N_local = zeros(1,NODES(1));
	
    for i=1:NODES(1)
        [N1(i),~,~] = linearshape(x_corner1(1,:),LOC(CONNECT(i),:),le(1,1),le(1,2));
        [N2(i),~,~] = linearshape(x_corner2(1,:),LOC(CONNECT(i),:),le(1,1),le(1,2));
        [N3(i),~,~] = linearshape(x_corner3(1,:),LOC(CONNECT(i),:),le(1,1),le(1,2));
        [N4(i),~,~] = linearshape(x_corner4(1,:),LOC(CONNECT(i),:),le(1,1),le(1,2));
        N_local(i)  = 0.25*(N1(i)+N2(i)+N3(i)+N4(i));
    end
	
    N = N_local;
	
    % Build matrix of gradient of shape function 
    w1 = [r1_sp(1,2)-r2_sp(1,2) r2_sp(1,1)-r1_sp(1,1)];
    w2 = [r1_sp(1,2)+r2_sp(1,2) -r2_sp(1,1)-r1_sp(1,1)];
	
    for i=1:NODES(1)      
        dN(1,i)     = 1/A_sp(1)*((N1(i)-N3(i))*w1(1) + (N2(i)-N4(i))*w2(1));
        dN(2,i)     = 1/A_sp(1)*((N1(i)-N3(i))*w1(2) + (N2(i)-N4(i))*w2(2));
    end
	
    for i=1:NODES(1)
        Nmatrixrow(CONNECT(i),1)=N(i);
        dNxmatrixrow(CONNECT(i),1)=dN(1,i);
        dNymatrixrow(CONNECT(i),1)=dN(2,i);
    end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [N,dN,CONNECT,spElems,NODES] = Compute_Interpolator_CPDI_parforred_optimized(x_sp,le,NN,LOC,r1_sp,r2_sp,A_sp,siCount)
 
    CONNECT_TEMP   = zeros(1,16);
    spElems_corner = zeros(1,4);
    x_corner1      = zeros(1,2);
    x_corner2      = zeros(1,2);
    x_corner3      = zeros(1,2);
    x_corner4      = zeros(1,2);
    dNxmatrixrow   = zeros(siCount,1);
    dNymatrixrow   = zeros(siCount,1);
	spElems        = zeros(1,1);
	NODES          = zeros(1,1);


    x_corner1(1,:) = x_sp(1,:) - r1_sp(1,:) - r2_sp(1,:);      % Position of corner 1
    x_corner2(1,:) = x_sp(1,:) + r1_sp(1,:) - r2_sp(1,:);
    x_corner3(1,:) = x_sp(1,:) + r1_sp(1,:) + r2_sp(1,:);
    x_corner4(1,:) = x_sp(1,:) - r1_sp(1,:) + r2_sp(1,:);

    spElems(1) = ceil(x_sp(1,1)/le(1))+(NN(1)-1)*(fix(x_sp(1,2)/le(2)));   % compute vector store index elements                           

    spElems_corner(1,1) = ceil(x_corner1(1,1)/le(1))+(NN(1)-1)*(fix(x_corner1(1,2)/le(2)));                        
    spElems_corner(1,2) = ceil(x_corner2(1,1)/le(1))+(NN(1)-1)*(fix(x_corner2(1,2)/le(2)));                        
    spElems_corner(1,3) = ceil(x_corner3(1,1)/le(1))+(NN(1)-1)*(fix(x_corner3(1,2)/le(2)));
    spElems_corner(1,4) = ceil(x_corner4(1,1)/le(1))+(NN(1)-1)*(fix(x_corner4(1,2)/le(2)));

    CONNECT_TEMP(1,1)  = spElems_corner(1,1) + myfloor((spElems_corner(1,1)-1)/(NN(1)-1));
    CONNECT_TEMP(1,2)  = CONNECT_TEMP(1,1) + 1;
    CONNECT_TEMP(1,3)  = CONNECT_TEMP(1,2) + NN(1);
    CONNECT_TEMP(1,4)  = CONNECT_TEMP(1,1) + NN(1);

    CONNECT_TEMP(1,5)  = spElems_corner(1,2) + myfloor((spElems_corner(1,2)-1)/(NN(1)-1));
    CONNECT_TEMP(1,6)  = CONNECT_TEMP(1,5) + 1;
    CONNECT_TEMP(1,7)  = CONNECT_TEMP(1,6) + NN(1);
    CONNECT_TEMP(1,8)  = CONNECT_TEMP(1,5) + NN(1); 

    CONNECT_TEMP(1,9)  = spElems_corner(1,3) + myfloor((spElems_corner(1,3)-1)/(NN(1)-1));
    CONNECT_TEMP(1,10) = CONNECT_TEMP(1,9) + 1;
    CONNECT_TEMP(1,11) = CONNECT_TEMP(1,10) + NN(1);
    CONNECT_TEMP(1,12) = CONNECT_TEMP(1,9) + NN(1); 

    CONNECT_TEMP(1,13) = spElems_corner(1,4) + myfloor((spElems_corner(1,4)-1)/(NN(1)-1));
    CONNECT_TEMP(1,14) = CONNECT_TEMP(1,13) + 1;
    CONNECT_TEMP(1,15) = CONNECT_TEMP(1,14) + NN(1);
    CONNECT_TEMP(1,16) = CONNECT_TEMP(1,13) + NN(1);

    CONNECT=unique(CONNECT_TEMP(1,:));    % Store nodes interacting with corners
    NODES(1)=length(CONNECT);         % Store number of interacting nodes
	dN=zeros(2,NODES(1));
	
    N1 = zeros(1,NODES(1));   % Shape function of corner 1 for 16 nodes
    N2 = zeros(1,NODES(1));
    N3 = zeros(1,NODES(1));
    N4 = zeros(1,NODES(1));
    N_local = zeros(1,NODES(1));

    for i=1:NODES(1)
        [N1(i),~,~] = linearshape(x_corner1(1,:),LOC(CONNECT(i),:),le(1,1),le(1,2));
        [N2(i),~,~] = linearshape(x_corner2(1,:),LOC(CONNECT(i),:),le(1,1),le(1,2));
        [N3(i),~,~] = linearshape(x_corner3(1,:),LOC(CONNECT(i),:),le(1,1),le(1,2));
        [N4(i),~,~] = linearshape(x_corner4(1,:),LOC(CONNECT(i),:),le(1,1),le(1,2));
        N_local(i)  = 0.25*(N1(i)+N2(i)+N3(i)+N4(i));
    end

    N = N_local;

    % Build matrix of gradient of shape function 
    w1 = [r1_sp(1,2)-r2_sp(1,2) r2_sp(1,1)-r1_sp(1,1)];
    w2 = [r1_sp(1,2)+r2_sp(1,2) -r2_sp(1,1)-r1_sp(1,1)];

    for i=1:NODES(1)      
        dN(1,i)     = 1/A_sp(1)*((N1(i)-N3(i))*w1(1) + (N2(i)-N4(i))*w2(1));
        dN(2,i)     = 1/A_sp(1)*((N1(i)-N3(i))*w1(2) + (N2(i)-N4(i))*w2(2));
    end

end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [N,dN,CONNECT,spElems,mspoints,NODES,Nmatrix,dNxmatrix,dNymatrix,CONNECTpn] = Compute_Interpolator_MPM(spCount,cellCount,x_sp,le,NN,LOC,r1_sp,r2_sp,A_sp,t_sp)
    spElems        = zeros(spCount,1);
    N              = cell(1,spCount);
    dN             = cell(1,spCount);
    CONNECT        = cell(1,spCount);
	NODES          = zeros(1,spCount);
    siCount=NN(1)*NN(2);
    CONNECTpn=cell(1,siCount);
    Nmatrix=zeros(siCount,spCount);
    dNxmatrix=zeros(siCount,spCount);
    dNymatrix=zeros(siCount,spCount);

%{
%switchable1
    try
        parfor sp=1:spCount
            [N{sp},dN{sp},CONNECT{sp},spElems(sp),NODES(sp),Nmatrixrow,dNxmatrixrow,dNymatrixrow] = Compute_Interpolator_MPM_parforred(x_sp(sp,:),le,NN,LOC,r1_sp(sp,:),r2_sp(sp,:),A_sp(sp,:),siCount);
            Nmatrix(:,sp)=Nmatrixrow;
            dNxmatrix(:,sp)=dNxmatrixrow;
            dNymatrix(:,sp)=dNymatrixrow;
        end
    catch
        fprintf('%s',['parfor failed inside Compute_Interpolator_MPM, switching to regular for' char(10)]);
%}
%switchable1
        for sp=1:spCount
            [N{sp},dN{sp},CONNECT{sp},spElems(sp),NODES(sp),Nmatrixrow,dNxmatrixrow,dNymatrixrow] = Compute_Interpolator_MPM_parforred(x_sp(sp,:),le,NN,LOC,r1_sp(sp,:),r2_sp(sp,:),A_sp(sp,:),siCount);
            Nmatrix(:,sp)=Nmatrixrow;
            dNxmatrix(:,sp)=dNxmatrixrow;
            dNymatrix(:,sp)=dNymatrixrow;
        end
%{
%switchable1
    end        
%}
%switchable1
    for sp=1:spCount
        for i=1:length(CONNECT{sp})
            CONNECTpn{CONNECT{sp}(i)}=[CONNECTpn{CONNECT{sp}(i)} sp];
        end
    end

    for c =1:cellCount
        id_sp = find(spElems==c);
        mspoints{c}=id_sp;
    end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [N_crack,dN_crack,CONNECT_crack,spElems_crack,NODES_crack,CONNECTpn_crack] = Compute_Interpolator_MPM_CrackParticleNoCell_topbotonly(x_crack,le,NN,LOC)
	maxnsp=size(x_crack.center,1);
	
	spElems_crack.top=zeros(x_crack.npaths,maxnsp);
	N_crack.top=zeros(1,4,maxnsp,x_crack.npaths);
	dN_crack.top=zeros(2,4,maxnsp,x_crack.npaths);
	NODES_crack.top=zeros(x_crack.npaths,maxnsp);
	CONNECT_crack.top.values=zeros(maxnsp,4,x_crack.npaths);
	CONNECT_crack.top.nrnodes=zeros(x_crack.npaths,maxnsp);
	CONNECT_crack.top.nparticles=zeros(x_crack.npaths);
	CONNECT_crack.top.npaths=zeros(1,1);
	CONNECT_crack.top.npaths=x_crack.npaths;
	
	spElems_crack.bot=zeros(x_crack.npaths,maxnsp);
	N_crack.bot=zeros(1,4,maxnsp,x_crack.npaths);
	dN_crack.bot=zeros(2,4,maxnsp,x_crack.npaths);
	NODES_crack.bot=zeros(x_crack.npaths,maxnsp);
	CONNECT_crack.bot.values=zeros(maxnsp,4,x_crack.npaths);
	CONNECT_crack.bot.nrnodes=zeros(x_crack.npaths,maxnsp);
	CONNECT_crack.bot.nparticles=zeros(x_crack.npaths);
	CONNECT_crack.bot.npaths=zeros(1,1);
	CONNECT_crack.bot.npaths=x_crack.npaths;
	
	max_x_crack_sizes=FindMaxVal(x_crack.nparticles);
	
    siCount=NN(1)*NN(2);
	CONNECTpn_crack_dummy.top.nrparticles=zeros(x_crack.npaths,siCount);
	CONNECTpn_crack_dummy.bot.nrparticles=zeros(x_crack.npaths,siCount);
	CONNECTpn_crack_dummy.top.maxnrparticles=zeros(1,1);
	CONNECTpn_crack_dummy.bot.maxnrparticles=zeros(1,1);
	%{
	CONNECTpn_crack.top.values=zeros(siCount,1,x_crack.npaths);
	coder.varsize('CONNECTpn_crack.top.values',[siCount max_x_crack_sizes x_crack.npaths]);
	CONNECTpn_crack.bot.values=zeros(siCount,1,x_crack.npaths);
	coder.varsize('CONNECTpn_crack.bot.values',[siCount max_x_crack_sizes x_crack.npaths]);
	%}
	
	for icrackpath=1:x_crack.npaths
		for sp=1:x_crack.nparticles(icrackpath)
			[N_crack.top(:,:,sp,icrackpath),dN_crack.top(:,:,sp,icrackpath),CONNECT_crack.top.values(sp,:,icrackpath),spElems_crack.top(icrackpath,sp),NODES_crack.top(icrackpath,sp)] = Compute_Interpolator_MPM_CrackParticleNoCellparforred(x_crack.top(sp,:,icrackpath),le,NN,LOC);
			[N_crack.bot(:,:,sp,icrackpath),dN_crack.bot(:,:,sp,icrackpath),CONNECT_crack.bot.values(sp,:,icrackpath),spElems_crack.bot(icrackpath,sp),NODES_crack.bot(icrackpath,sp)] = Compute_Interpolator_MPM_CrackParticleNoCellparforred(x_crack.bot(sp,:,icrackpath),le,NN,LOC);
		end
		CONNECT_crack.top.nparticles(icrackpath)=x_crack.nparticles(icrackpath);
		CONNECT_crack.bot.nparticles(icrackpath)=x_crack.nparticles(icrackpath);
	end
	CONNECT_crack.top.nrnodes=NODES_crack.top;
	CONNECT_crack.bot.nrnodes=NODES_crack.bot;
	
	
	for icrackpath=1:x_crack.npaths
		for sp=1:x_crack.nparticles(icrackpath)
			for i=1:4
				CONNECTpn_crack_dummy.top.nrparticles(icrackpath,CONNECT_crack.top.values(sp,i,icrackpath))=CONNECTpn_crack_dummy.top.nrparticles(icrackpath,CONNECT_crack.top.values(sp,i,icrackpath))+1;
				CONNECTpn_crack_dummy.bot.nrparticles(icrackpath,CONNECT_crack.bot.values(sp,i,icrackpath))=CONNECTpn_crack_dummy.bot.nrparticles(icrackpath,CONNECT_crack.bot.values(sp,i,icrackpath))+1;
			end
		end
	end
	
	CONNECTpn_crack_dummy.top.maxnrparticles=FindMaxValMatrix(CONNECTpn_crack_dummy.top.nrparticles);
	CONNECTpn_crack_dummy.bot.maxnrparticles=FindMaxValMatrix(CONNECTpn_crack_dummy.bot.nrparticles);
	
	CONNECTpn_crack.top.nrparticles=zeros(x_crack.npaths,siCount);
	CONNECTpn_crack.bot.nrparticles=zeros(x_crack.npaths,siCount);
	CONNECTpn_crack.top.maxnrparticles=zeros(1,1);
	CONNECTpn_crack.bot.maxnrparticles=zeros(1,1);
	CONNECTpn_crack.top.values=zeros(siCount,CONNECTpn_crack_dummy.top.maxnrparticles,x_crack.npaths);
	CONNECTpn_crack.bot.values=zeros(siCount,CONNECTpn_crack_dummy.bot.maxnrparticles,x_crack.npaths);
	
	CONNECTpn_crack.top.nrparticles=CONNECTpn_crack_dummy.top.nrparticles;
	CONNECTpn_crack.bot.nrparticles=CONNECTpn_crack_dummy.bot.nrparticles;
	CONNECTpn_crack.top.maxnrparticles=CONNECTpn_crack_dummy.top.maxnrparticles;
	CONNECTpn_crack.bot.maxnrparticles=CONNECTpn_crack_dummy.bot.maxnrparticles;
	
	CONNECTpn_crack.top.npaths=zeros(1,1);
	CONNECTpn_crack.bot.npaths=zeros(1,1);
	
	
	for icrackpath=1:x_crack.npaths
		countertop=zeros(1,siCount);
		counterbot=zeros(1,siCount);
		for sp=1:x_crack.nparticles(icrackpath)
			for i=1:4
				countertop(1,CONNECT_crack.top.values(sp,i,icrackpath))=countertop(1,CONNECT_crack.top.values(sp,i,icrackpath))+1;
				CONNECTpn_crack.top.values(CONNECT_crack.top.values(sp,i,icrackpath),countertop(1,CONNECT_crack.top.values(sp,i,icrackpath)),icrackpath)=sp;
				
				counterbot(1,CONNECT_crack.bot.values(sp,i,icrackpath))=counterbot(1,CONNECT_crack.bot.values(sp,i,icrackpath))+1;
				CONNECTpn_crack.bot.values(CONNECT_crack.bot.values(sp,i,icrackpath),counterbot(1,CONNECT_crack.bot.values(sp,i,icrackpath)),icrackpath)=sp;
			end
		end
	end
	
	CONNECTpn_crack.top.npaths=x_crack.npaths;
	CONNECTpn_crack.bot.npaths=x_crack.npaths;
	
end

%function [N_crack,dN_crack,CONNECT_crack,spElems_crack,NODES_crack,CONNECTpn_crack] = Compute_Interpolator_MPM_CrackParticleNoCell(x_crack,le,NN,LOC)
function [N_crack,dN_crack,CONNECT_crack,spElems_crack,NODES_crack,CONNECTpn_crack] = Compute_Interpolator_MPM_CrackParticleNoCell(t_time,x_crack,le,NN,LOC)
	maxnsp=size(x_crack.center,1);
	
	spElems_crack.top=zeros(x_crack.npaths,maxnsp);%if t_time>0.01770;fprintf('%s',['marker #802' char(10)]);end;
	N_crack.top=zeros(1,4,maxnsp,x_crack.npaths);%if t_time>0.01770;fprintf('%s',['marker #803' char(10)]);end;
	dN_crack.top=zeros(2,4,maxnsp,x_crack.npaths);%if t_time>0.01770;fprintf('%s',['marker #804' char(10)]);end;
	NODES_crack.top=zeros(x_crack.npaths,maxnsp);%if t_time>0.01770;fprintf('%s',['marker #805' char(10)]);end;
	CONNECT_crack.top.values=zeros(maxnsp,4,x_crack.npaths);%if t_time>0.01770;fprintf('%s',['marker #806' char(10)]);end;
	CONNECT_crack.top.nrnodes=zeros(x_crack.npaths,maxnsp);%if t_time>0.01770;fprintf('%s',['marker #807' char(10)]);end;
	CONNECT_crack.top.nparticles=zeros(x_crack.npaths);%if t_time>0.01770;fprintf('%s',['marker #808' char(10)]);end;
	CONNECT_crack.top.npaths=zeros(1,1);%if t_time>0.01770;fprintf('%s',['marker #809' char(10)]);end;
	CONNECT_crack.top.npaths=x_crack.npaths;%if t_time>0.01770;fprintf('%s',['marker #810' char(10)]);end;
	
	spElems_crack.bot=zeros(x_crack.npaths,maxnsp);%if t_time>0.01770;fprintf('%s',['marker #811' char(10)]);end;
	N_crack.bot=zeros(1,4,maxnsp,x_crack.npaths);%if t_time>0.01770;fprintf('%s',['marker #812' char(10)]);end;
	dN_crack.bot=zeros(2,4,maxnsp,x_crack.npaths);%if t_time>0.01770;fprintf('%s',['marker #813' char(10)]);end;
	NODES_crack.bot=zeros(x_crack.npaths,maxnsp);%if t_time>0.01770;fprintf('%s',['marker #814' char(10)]);end;
	CONNECT_crack.bot.values=zeros(maxnsp,4,x_crack.npaths);%if t_time>0.01770;fprintf('%s',['marker #815' char(10)]);end;
	CONNECT_crack.bot.nrnodes=zeros(x_crack.npaths,maxnsp);%if t_time>0.01770;fprintf('%s',['marker #816' char(10)]);end;
	CONNECT_crack.bot.nparticles=zeros(x_crack.npaths);%if t_time>0.01770;fprintf('%s',['marker #817' char(10)]);end;
	CONNECT_crack.bot.npaths=zeros(1,1);%if t_time>0.01770;fprintf('%s',['marker #818' char(10)]);end;
	CONNECT_crack.bot.npaths=x_crack.npaths;%if t_time>0.01770;fprintf('%s',['marker #819' char(10)]);end;
	
	spElems_crack.center=zeros(x_crack.npaths,maxnsp);%if t_time>0.01770;fprintf('%s',['marker #820' char(10)]);end;
	N_crack.center=zeros(1,4,maxnsp,x_crack.npaths);%if t_time>0.01770;fprintf('%s',['marker #821' char(10)]);end;
	dN_crack.center=zeros(2,4,maxnsp,x_crack.npaths);%if t_time>0.01770;fprintf('%s',['marker #822' char(10)]);end;
	NODES_crack.center=zeros(x_crack.npaths,maxnsp);%if t_time>0.01770;fprintf('%s',['marker #823' char(10)]);end;
	CONNECT_crack.center.values=zeros(maxnsp,4,x_crack.npaths);%if t_time>0.01770;fprintf('%s',['marker #824' char(10)]);end;
	CONNECT_crack.center.nrnodes=zeros(x_crack.npaths,maxnsp);%if t_time>0.01770;fprintf('%s',['marker #825' char(10)]);end;
	CONNECT_crack.center.nparticles=zeros(x_crack.npaths);%if t_time>0.01770;fprintf('%s',['marker #826' char(10)]);end;
	CONNECT_crack.center.npaths=zeros(1,1);%if t_time>0.01770;fprintf('%s',['marker #827' char(10)]);end;
	CONNECT_crack.center.npaths=x_crack.npaths;%if t_time>0.01770;fprintf('%s',['marker #828' char(10)]);end;
		
	max_x_crack_sizes=FindMaxVal(x_crack.nparticles);%if t_time>0.01770;fprintf('%s',['marker #829' char(10)]);end;
	
	N_crack.gauss=zeros(1,4,x_crack.gauss.npoints,x_crack.npaths,2); %dimension (only 1), i associated node, igausspoint, ipath,itip
	dN_crack.gauss=zeros(2,4,x_crack.gauss.npoints,x_crack.npaths,2); %dimension (2 of them), i associated node, igausspoint, ipath,itip
	NODES_crack.gauss=zeros(x_crack.npaths,x_crack.gauss.npoints,2); %ipath, igausspoint,itip
	CONNECT_crack.gauss=zeros(x_crack.gauss.npoints,4,x_crack.npaths,2); %igausspoint, i associated node, ipath, itip
	spElems_crack.gauss=zeros(x_crack.npaths,x_crack.gauss.npoints,2); %ipath, igausspoint, itip
	
    siCount=NN(1)*NN(2);%if t_time>0.01770;fprintf('%s',['marker #830' char(10)]);end;
	CONNECTpn_crack_dummy.top.nrparticles=zeros(x_crack.npaths,siCount);%if t_time>0.01770;fprintf('%s',['marker #831' char(10)]);end;
	CONNECTpn_crack_dummy.bot.nrparticles=zeros(x_crack.npaths,siCount);%if t_time>0.01770;fprintf('%s',['marker #832' char(10)]);end;
	CONNECTpn_crack_dummy.center.nrparticles=zeros(x_crack.npaths,siCount);%if t_time>0.01770;fprintf('%s',['marker #833' char(10)]);end;
	CONNECTpn_crack_dummy.top.maxnrparticles=zeros(1,1);%if t_time>0.01770;fprintf('%s',['marker #834' char(10)]);end;
	CONNECTpn_crack_dummy.bot.maxnrparticles=zeros(1,1);%if t_time>0.01770;fprintf('%s',['marker #835' char(10)]);end;
	CONNECTpn_crack_dummy.center.maxnrparticles=zeros(1,1);%if t_time>0.01770;fprintf('%s',['marker #836' char(10)]);end;
	%{
	CONNECTpn_crack.top.values=zeros(siCount,1,x_crack.npaths);
	coder.varsize('CONNECTpn_crack.top.values',[siCount max_x_crack_sizes x_crack.npaths]);
	CONNECTpn_crack.bot.values=zeros(siCount,1,x_crack.npaths);
	coder.varsize('CONNECTpn_crack.bot.values',[siCount max_x_crack_sizes x_crack.npaths]);
	%}
	
	for icrackpath=1:x_crack.npaths
		for sp=1:x_crack.nparticles(icrackpath)
			[N_crack.top(:,:,sp,icrackpath),dN_crack.top(:,:,sp,icrackpath),CONNECT_crack.top.values(sp,:,icrackpath),spElems_crack.top(icrackpath,sp),NODES_crack.top(icrackpath,sp)] = Compute_Interpolator_MPM_CrackParticleNoCellparforred(x_crack.top(sp,:,icrackpath),le,NN,LOC);%if t_time>0.01770;fprintf('%s',['marker #837' char(10)]);end;
			[N_crack.bot(:,:,sp,icrackpath),dN_crack.bot(:,:,sp,icrackpath),CONNECT_crack.bot.values(sp,:,icrackpath),spElems_crack.bot(icrackpath,sp),NODES_crack.bot(icrackpath,sp)] = Compute_Interpolator_MPM_CrackParticleNoCellparforred(x_crack.bot(sp,:,icrackpath),le,NN,LOC);%if t_time>0.01770;fprintf('%s',['marker #838' char(10)]);end;
			[N_crack.center(:,:,sp,icrackpath),dN_crack.center(:,:,sp,icrackpath),CONNECT_crack.center.values(sp,:,icrackpath),spElems_crack.center(icrackpath,sp),NODES_crack.center(icrackpath,sp)] = Compute_Interpolator_MPM_CrackParticleNoCellparforred(x_crack.center(sp,:,icrackpath),le,NN,LOC);%if t_time>0.01770;fprintf('%s',['marker #839' char(10)]);end;
		end
		CONNECT_crack.top.nparticles(icrackpath)=x_crack.nparticles(icrackpath);%if t_time>0.01770;fprintf('%s',['marker #840' char(10)]);end;
		CONNECT_crack.bot.nparticles(icrackpath)=x_crack.nparticles(icrackpath);%if t_time>0.01770;fprintf('%s',['marker #841' char(10)]);end;
		CONNECT_crack.center.nparticles(icrackpath)=x_crack.nparticles(icrackpath);%if t_time>0.01770;fprintf('%s',['marker #842' char(10)]);end;
	end
	CONNECT_crack.top.nrnodes=NODES_crack.top;%if t_time>0.01770;fprintf('%s',['marker #843' char(10)]);end;
	CONNECT_crack.bot.nrnodes=NODES_crack.bot;%if t_time>0.01770;fprintf('%s',['marker #844' char(10)]);end;
	CONNECT_crack.center.nrnodes=NODES_crack.center;%if t_time>0.01770;fprintf('%s',['marker #845' char(10)]);end;
	
	for icrackpath=1:x_crack.npaths
		for itip=1:2
			for igausspoint=1:x_crack.gauss.npoints
				[N_crack.gauss(:,:,igausspoint,icrackpath,itip),dN_crack.gauss(:,:,igausspoint,icrackpath,itip),CONNECT_crack.gauss(igausspoint,:,icrackpath,itip),spElems_crack.gauss(icrackpath,igausspoint,itip),NODES_crack.gauss(icrackpath,igausspoint,itip)] = Compute_Interpolator_MPM_CrackParticleNoCellparforred(x_crack.gauss.locs(igausspoint,:,icrackpath,itip),le,NN,LOC);%if t_time>0.01770;fprintf('%s',['marker #846' char(10)]);end;
			end
		end
	end
	
	for icrackpath=1:x_crack.npaths
		for sp=1:x_crack.nparticles(icrackpath)
			for i=1:4
				%if t_time>0.01770;fprintf('%s',['icrackpath=' int2txt(icrackpath) '; sp=' int2txt(sp) '; i=' int2txt(i)  char(10)]);end;
				%if t_time>0.01770;fprintf('%s',['CONNECT_crack.top.values(' int2txt(sp) ',' int2txt(i) ',' int2txt(icrackpath) ')=' int2txt(CONNECT_crack.top.values(sp,i,icrackpath)) char(10)]);end;
				CONNECTpn_crack_dummy.top.nrparticles(icrackpath,CONNECT_crack.top.values(sp,i,icrackpath))=CONNECTpn_crack_dummy.top.nrparticles(icrackpath,CONNECT_crack.top.values(sp,i,icrackpath))+1;%if t_time>0.01770;fprintf('%s',['marker #847' char(10)]);end;
				CONNECTpn_crack_dummy.bot.nrparticles(icrackpath,CONNECT_crack.bot.values(sp,i,icrackpath))=CONNECTpn_crack_dummy.bot.nrparticles(icrackpath,CONNECT_crack.bot.values(sp,i,icrackpath))+1;%if t_time>0.01770;fprintf('%s',['marker #848' char(10)]);end;
				CONNECTpn_crack_dummy.center.nrparticles(icrackpath,CONNECT_crack.center.values(sp,i,icrackpath))=CONNECTpn_crack_dummy.center.nrparticles(icrackpath,CONNECT_crack.center.values(sp,i,icrackpath))+1;%if t_time>0.01770;fprintf('%s',['marker #849' char(10)]);end;
			end
		end
	end
	
	
	%if t_time>0.01770;fprintf('%s',['marker #883' char(10)]);end;
	if t_time>0.01770
		for icrackpath=1:x_crack.npaths
			%if t_time>0.01770;fprintf('%s',['marker #884' char(10)]);end;
			for sp=1:x_crack.nparticles(icrackpath)
				%if t_time>0.01770;fprintf('%s',['marker #885' char(10)]);end;
				for i=1:4
					%if t_time>0.01770;fprintf('%s',['icrackpath=' int2txt(icrackpath) '; sp=' int2txt(sp) '; i=' int2txt(i)  char(10)]);end
					%if t_time>0.01770;fprintf('%s',['CONNECT_crack.top.values(' int2txt(sp) ',' int2txt(i) ',' int2txt(icrackpath) '))' '=' int2txt(CONNECT_crack.top.values(sp,i,icrackpath)) char(10)]);end
					%fprintf('%s',['CONNECTpn_crack_dummy.top.nrparticles(' int2txt(icrackpath) ',' int2txt(CONNECT_crack.top.values(sp,i,icrackpath)) ')=' int2txt(CONNECTpn_crack_dummy.top.nrparticles(icrackpath,CONNECT_crack.top.values(sp,i,icrackpath))) char(10)]);
				end
			end
		end
	end
	CONNECTpn_crack_dummy.top.maxnrparticles=FindMaxValMatrix(CONNECTpn_crack_dummy.top.nrparticles);%if t_time>0.01770;fprintf('%s',['marker #850' char(10)]);end;
	CONNECTpn_crack_dummy.bot.maxnrparticles=FindMaxValMatrix(CONNECTpn_crack_dummy.bot.nrparticles);%if t_time>0.01770;fprintf('%s',['marker #851' char(10)]);end;
	CONNECTpn_crack_dummy.center.maxnrparticles=FindMaxValMatrix(CONNECTpn_crack_dummy.center.nrparticles);%if t_time>0.01770;fprintf('%s',['marker #852' char(10)]);end;
	
	CONNECTpn_crack.top.nrparticles=zeros(x_crack.npaths,siCount);%if t_time>0.01770;fprintf('%s',['marker #853' char(10)]);end;
	CONNECTpn_crack.bot.nrparticles=zeros(x_crack.npaths,siCount);%if t_time>0.01770;fprintf('%s',['marker #854' char(10)]);end;
	CONNECTpn_crack.center.nrparticles=zeros(x_crack.npaths,siCount);%if t_time>0.01770;fprintf('%s',['marker #855' char(10)]);end;
	CONNECTpn_crack.top.maxnrparticles=zeros(1,1);%if t_time>0.01770;fprintf('%s',['marker #856' char(10)]);end;
	CONNECTpn_crack.bot.maxnrparticles=zeros(1,1);%if t_time>0.01770;fprintf('%s',['marker #857' char(10)]);end;
	CONNECTpn_crack.center.maxnrparticles=zeros(1,1);%if t_time>0.01770;fprintf('%s',['marker #858' char(10)]);end;
	CONNECTpn_crack.top.values=zeros(siCount,CONNECTpn_crack_dummy.top.maxnrparticles,x_crack.npaths);%if t_time>0.01770;fprintf('%s',['marker #859' char(10)]);end;
	CONNECTpn_crack.bot.values=zeros(siCount,CONNECTpn_crack_dummy.bot.maxnrparticles,x_crack.npaths);%if t_time>0.01770;fprintf('%s',['marker #860' char(10)]);end;
	CONNECTpn_crack.center.values=zeros(siCount,CONNECTpn_crack_dummy.center.maxnrparticles,x_crack.npaths);%if t_time>0.01770;fprintf('%s',['marker #861' char(10)]);end;
	
	CONNECTpn_crack.top.nrparticles=CONNECTpn_crack_dummy.top.nrparticles;%if t_time>0.01770;fprintf('%s',['marker #862' char(10)]);end;
	CONNECTpn_crack.bot.nrparticles=CONNECTpn_crack_dummy.bot.nrparticles;%if t_time>0.01770;fprintf('%s',['marker #863' char(10)]);end;
	CONNECTpn_crack.center.nrparticles=CONNECTpn_crack_dummy.center.nrparticles;%if t_time>0.01770;fprintf('%s',['marker #864' char(10)]);end;
	CONNECTpn_crack.top.maxnrparticles=CONNECTpn_crack_dummy.top.maxnrparticles;%if t_time>0.01770;fprintf('%s',['marker #865' char(10)]);end;
	CONNECTpn_crack.bot.maxnrparticles=CONNECTpn_crack_dummy.bot.maxnrparticles;%if t_time>0.01770;fprintf('%s',['marker #866' char(10)]);end;
	CONNECTpn_crack.center.maxnrparticles=CONNECTpn_crack_dummy.center.maxnrparticles;%if t_time>0.01770;fprintf('%s',['marker #867' char(10)]);end;
	
	CONNECTpn_crack.top.npaths=zeros(1,1);%if t_time>0.01770;fprintf('%s',['marker #868' char(10)]);end;
	CONNECTpn_crack.bot.npaths=zeros(1,1);%if t_time>0.01770;fprintf('%s',['marker #869' char(10)]);end;
	CONNECTpn_crack.center.npaths=zeros(1,1);%if t_time>0.01770;fprintf('%s',['marker #870' char(10)]);end;
	
	
	for icrackpath=1:x_crack.npaths
		countertop=zeros(1,siCount);%if t_time>0.01770;fprintf('%s',['marker #871' char(10)]);end;
		counterbot=zeros(1,siCount);%if t_time>0.01770;fprintf('%s',['marker #872' char(10)]);end;
		countercenter=zeros(1,siCount);%if t_time>0.01770;fprintf('%s',['marker #873' char(10)]);end;
		for sp=1:x_crack.nparticles(icrackpath)
			for i=1:4
				countertop(1,CONNECT_crack.top.values(sp,i,icrackpath))=countertop(1,CONNECT_crack.top.values(sp,i,icrackpath))+1;%if t_time>0.01770;fprintf('%s',['marker #874' char(10)]);end;
				CONNECTpn_crack.top.values(CONNECT_crack.top.values(sp,i,icrackpath),countertop(1,CONNECT_crack.top.values(sp,i,icrackpath)),icrackpath)=sp;%if t_time>0.01770;fprintf('%s',['marker #875' char(10)]);end;
				
				counterbot(1,CONNECT_crack.bot.values(sp,i,icrackpath))=counterbot(1,CONNECT_crack.bot.values(sp,i,icrackpath))+1;%if t_time>0.01770;fprintf('%s',['marker #876' char(10)]);end;
				CONNECTpn_crack.bot.values(CONNECT_crack.bot.values(sp,i,icrackpath),counterbot(1,CONNECT_crack.bot.values(sp,i,icrackpath)),icrackpath)=sp;%if t_time>0.01770;fprintf('%s',['marker #877' char(10)]);end;
				
				countercenter(1,CONNECT_crack.center.values(sp,i,icrackpath))=countercenter(1,CONNECT_crack.center.values(sp,i,icrackpath))+1;%if t_time>0.01770;fprintf('%s',['marker #878' char(10)]);end;
				CONNECTpn_crack.center.values(CONNECT_crack.center.values(sp,i,icrackpath),countercenter(1,CONNECT_crack.center.values(sp,i,icrackpath)),icrackpath)=sp;%if t_time>0.01770;fprintf('%s',['marker #879' char(10)]);end;
			end
		end
	end
	
	CONNECTpn_crack.top.npaths=x_crack.npaths;%if t_time>0.01770;fprintf('%s',['marker #880' char(10)]);end;
	CONNECTpn_crack.bot.npaths=x_crack.npaths;%if t_time>0.01770;fprintf('%s',['marker #881' char(10)]);end;
	CONNECTpn_crack.center.npaths=x_crack.npaths;%if t_time>0.01770;fprintf('%s',['marker #882' char(10)]);end;
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [N,dN,CONNECT,spElems,mspoints,NODES,Nmatrix,CONNECTpn] = Compute_Interpolator_MPM_optimized(spCount,cellCount,x_sp,le,NN,LOC,r1_sp,r2_sp,A_sp,t_sp)
    spElems        = zeros(spCount,1);
    N              = cell(1,spCount);
    dN             = cell(1,spCount);
    CONNECT        = cell(1,spCount);
	NODES          = zeros(1,spCount);
    siCount=NN(1)*NN(2);
    CONNECTpn=cell(1,siCount);
    Nmatrix=zeros(siCount,spCount);
	
%{
%switchable1
    try
        parfor sp=1:spCount
            [N{sp},dN{sp},CONNECT{sp},spElems(sp),NODES(sp),Nmatrixrow] = Compute_Interpolator_MPM_parforred(x_sp(sp,:),le,NN,LOC,r1_sp(sp,:),r2_sp(sp,:),A_sp(sp,:),siCount);
            Nmatrix(:,sp)=Nmatrixrow;
        end
    catch
        fprintf('%s',['parfor failed inside Compute_Interpolator_MPM, switching to regular for' char(10)]);
%}
%switchable1
        for sp=1:spCount
            [N{sp},dN{sp},CONNECT{sp},spElems(sp),NODES(sp),Nmatrixrow] = Compute_Interpolator_MPM_parforred(x_sp(sp,:),le,NN,LOC,r1_sp(sp,:),r2_sp(sp,:),A_sp(sp,:),siCount);
            Nmatrix(:,sp)=Nmatrixrow;
        end
%{
%switchable1
    end        
%}
%switchable1
	CONNECTpnSizes=zeros(1,siCount);
    for sp=1:spCount
        for i=1:length(CONNECT{sp})
            CONNECTpnSizes(CONNECT{sp}(i))=CONNECTpnSizes(CONNECT{sp}(i))+1;
        end
    end
	
	CONNECTpnMaxSize=1;
	for i=1:length(CONNECTpnSizes)
		if CONNECTpnSizes(i)>CONNECTpnMaxSize
			CONNECTpnMaxSize=CONNECTpnSizes(i);
		end
	end
	
	CONNECTpn=zeros(siCount,CONNECTpnMaxSize);
	
%{	
    for sp=1:spCount
        for i=1:length(CONNECT{sp})
            CONNECTpn{CONNECT{sp}(i)}=[CONNECTpn{CONNECT{sp}(i)} sp];
        end
    end
%}
	CONNECTpnCounter=zeros(1,siCount);
    for sp=1:spCount
        for i=1:length(CONNECT{sp})
			CONNECTpnCounter(CONNECT{sp}(i))=CONNECTpnCounter(CONNECT{sp}(i))+1;
            CONNECTpn(i,CONNECTpnCounter(CONNECT{sp}(i)))=sp;
        end
    end
	
	mspoints=cell(1,cellCount);
    for c =1:cellCount
        id_sp = find(spElems==c);
        mspoints{c}=id_sp;
    end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [N,dN,CONNECT,pElems,NODES,Nmatrixrow,dNxmatrixrow,dNymatrixrow] = Compute_Interpolator_MPM_parforred(x_sp,le,NN,LOC,r1_sp,r2_sp,A_sp,siCount)
	
	pElems         = zeros(1,1);                             % index of elements where stores particles
	CONNECT_TEMP    = zeros(1,4);                            % node 1=leftdown 2=righdown 3=rightup 4= leftup
	NODES           = 4 * ones(1,1);                         % Number of interation nodes for each particle
	N_local         = zeros(1,4);                            % Value of shape function
	dN_local        = zeros(1,8);                            % Value of gradient of shape function
	p=1;
	Nmatrixrow     = zeros(siCount,1);
	dNxmatrixrow   = zeros(siCount,1);
	dNymatrixrow   = zeros(siCount,1);
	
	N=zeros(1,NODES(p));
	dN=zeros(2,NODES(p));
	
	pElems(p) = ceil(x_sp(p,1)/le(1))+(NN(1)-1)*(fix(x_sp(p,2)/le(2)));   % compute vector store index elements                           
	
	CONNECT_TEMP(p,1) = pElems(p) + myfloor((pElems(p)-1)/(NN(1)-1));
	CONNECT_TEMP(p,2) = CONNECT_TEMP(p,1)+1; 
	CONNECT_TEMP(p,3) = CONNECT_TEMP(p,2)+NN(1); 
	CONNECT_TEMP(p,4) = CONNECT_TEMP(p,1)+NN(1);
	CONNECT        = [CONNECT_TEMP(p,1) CONNECT_TEMP(p,2) CONNECT_TEMP(p,3) CONNECT_TEMP(p,4)];
	 
	[N_local(p,1),dN_local(p,1),dN_local(p,5)]=linearshape(x_sp(p,1:2),LOC(CONNECT_TEMP(p,1),:),le(1,1),le(1,2));
	[N_local(p,2),dN_local(p,2),dN_local(p,6)]=linearshape(x_sp(p,1:2),LOC(CONNECT_TEMP(p,2),:),le(1,1),le(1,2));
	[N_local(p,3),dN_local(p,3),dN_local(p,7)]=linearshape(x_sp(p,1:2),LOC(CONNECT_TEMP(p,3),:),le(1,1),le(1,2));
	[N_local(p,4),dN_local(p,4),dN_local(p,8)]=linearshape(x_sp(p,1:2),LOC(CONNECT_TEMP(p,4),:),le(1,1),le(1,2));
	
	% Build matrix of gradient of shape function of 4 nodes of the cell which
	% contain the particles
	% dG((sp-1)*4+[1:4],:) = [dN(sp,1) dN(sp,5);dN(sp,2) dN(sp,6);dN(sp,3) dN(sp,7);dN(sp,4) dN(sp,8)];
	
	for i = 1:NODES(p)
		N(i) = N_local(p,i);    
		dN(1,i) = dN_local(p,i);
		dN(2,i) = dN_local(p,i+4);
	end
	 
	for i=1:NODES(1)
		Nmatrixrow(CONNECT(i),1)=N(i);
		dNxmatrixrow(CONNECT(i),1)=dN(1,i);
		dNymatrixrow(CONNECT(i),1)=dN(2,i);
	end
end

function [N,dN,CONNECT,pElems,NODES] = Compute_Interpolator_MPM_CrackParticleNoCellparforred(x_sp,le,NN,LOC)
	
	pElems         = zeros(1,1);                             % index of elements where stores particles
	CONNECT_TEMP    = zeros(1,4);                            % node 1=leftdown 2=righdown 3=rightup 4= leftup
	NODES           = 4 * ones(1,1);                         % Number of interation nodes for each particle
	N_local         = zeros(1,4);                            % Value of shape function
	dN_local        = zeros(1,8);                            % Value of gradient of shape function
	p=1;
	
	N=zeros(1,NODES(p));
	dN=zeros(2,NODES(p));
	
	pElems(p) = ceil(x_sp(p,1)/le(1))+(NN(1)-1)*(fix(x_sp(p,2)/le(2)));   % compute vector store index elements                           
	
	CONNECT_TEMP(p,1) = pElems(p) + myfloor((pElems(p)-1)/(NN(1)-1));
	CONNECT_TEMP(p,2) = CONNECT_TEMP(p,1)+1; 
	CONNECT_TEMP(p,3) = CONNECT_TEMP(p,2)+NN(1); 
	CONNECT_TEMP(p,4) = CONNECT_TEMP(p,1)+NN(1);
	CONNECT        = [CONNECT_TEMP(p,1) CONNECT_TEMP(p,2) CONNECT_TEMP(p,3) CONNECT_TEMP(p,4)];
	 
	[N_local(p,1),dN_local(p,1),dN_local(p,5)]=linearshape(x_sp(p,1:2),LOC(CONNECT_TEMP(p,1),:),le(1,1),le(1,2));
	[N_local(p,2),dN_local(p,2),dN_local(p,6)]=linearshape(x_sp(p,1:2),LOC(CONNECT_TEMP(p,2),:),le(1,1),le(1,2));
	[N_local(p,3),dN_local(p,3),dN_local(p,7)]=linearshape(x_sp(p,1:2),LOC(CONNECT_TEMP(p,3),:),le(1,1),le(1,2));
	[N_local(p,4),dN_local(p,4),dN_local(p,8)]=linearshape(x_sp(p,1:2),LOC(CONNECT_TEMP(p,4),:),le(1,1),le(1,2));
	
	% Build matrix of gradient of shape function of 4 nodes of the cell which
	% contain the particles
	% dG((sp-1)*4+[1:4],:) = [dN(sp,1) dN(sp,5);dN(sp,2) dN(sp,6);dN(sp,3) dN(sp,7);dN(sp,4) dN(sp,8)];
	
	for i = 1:NODES(p)
		N(i) = N_local(p,i);    
		dN(1,i) = dN_local(p,i);
		dN(2,i) = dN_local(p,i+4);
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [N,dN,CONNECT,pElems,NODES,Nmatrixrow] = Compute_Interpolator_MPM_parforred_optimized(x_sp,le,NN,LOC,r1_sp,r2_sp,A_sp,siCount)
	
	pElems         = zeros(1,1);                             % index of elements where stores particles
	CONNECT_TEMP    = zeros(1,4);                            % node 1=leftdown 2=righdown 3=rightup 4= leftup
	NODES           = 4 * ones(1,1);                         % Number of interation nodes for each particle
	N_local         = zeros(1,4);                            % Value of shape function
	dN_local        = zeros(1,8);                            % Value of gradient of shape function
	p=1;
	Nmatrixrow     = zeros(siCount,1);
	N              = zeros(1,NODES(p));
	dN             = zeros(2,NODES(p));
	
	pElems(p) = ceil(x_sp(p,1)/le(1))+(NN(1)-1)*(fix(x_sp(p,2)/le(2)));   % compute vector store index elements                           
	
	CONNECT_TEMP(p,1) = pElems(p) + myfloor((pElems(p)-1)/(NN(1)-1));
	CONNECT_TEMP(p,2) = CONNECT_TEMP(p,1)+1; 
	CONNECT_TEMP(p,3) = CONNECT_TEMP(p,2)+NN(1); 
	CONNECT_TEMP(p,4) = CONNECT_TEMP(p,1)+NN(1);
	CONNECT        = [CONNECT_TEMP(p,1) CONNECT_TEMP(p,2) CONNECT_TEMP(p,3) CONNECT_TEMP(p,4)];
	
	[N_local(p,1),dN_local(p,1),dN_local(p,5)]=linearshape(x_sp(p,1:2),LOC(CONNECT_TEMP(p,1),:),le(1,1),le(1,2));
	[N_local(p,2),dN_local(p,2),dN_local(p,6)]=linearshape(x_sp(p,1:2),LOC(CONNECT_TEMP(p,2),:),le(1,1),le(1,2));
	[N_local(p,3),dN_local(p,3),dN_local(p,7)]=linearshape(x_sp(p,1:2),LOC(CONNECT_TEMP(p,3),:),le(1,1),le(1,2));
	[N_local(p,4),dN_local(p,4),dN_local(p,8)]=linearshape(x_sp(p,1:2),LOC(CONNECT_TEMP(p,4),:),le(1,1),le(1,2));
	
	% Build matrix of gradient of shape function of 4 nodes of the cell which
	% contain the particles
	% dG((sp-1)*4+[1:4],:) = [dN(sp,1) dN(sp,5);dN(sp,2) dN(sp,6);dN(sp,3) dN(sp,7);dN(sp,4) dN(sp,8)];
	
	for i = 1:NODES(p)
		N(i) = N_local(p,i);    
		dN(1,i) = dN_local(p,i);
		dN(2,i) = dN_local(p,i+4);
	end
	
	for i=1:NODES(1)
		Nmatrixrow(CONNECT(i),1)=N(i);
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [N,dN,CONNECT,spElems,mspoints,NODES] = Compute_Interpolator_CPDI_regularloop(spCount,cellCount,x_sp,le,NN,LOC,r1_sp,r2_sp,A_sp,t_sp)
	
	CONNECT_TEMP   = zeros(spCount,16);
	spElems_corner = zeros(spCount,4);
	spElems        = zeros(spCount,1);
	x_corner1      = zeros(spCount,2);
	x_corner2      = zeros(spCount,2);
	x_corner3      = zeros(spCount,2);
	x_corner4      = zeros(spCount,2);
	NODES          = zeros(1,spCount);
	
	for sp=1:spCount
		x_corner1(sp,:) = x_sp(sp,:) - r1_sp(sp,:) - r2_sp(sp,:);      % Position of corner 1
		x_corner2(sp,:) = x_sp(sp,:) + r1_sp(sp,:) - r2_sp(sp,:);
		x_corner3(sp,:) = x_sp(sp,:) + r1_sp(sp,:) + r2_sp(sp,:);
		x_corner4(sp,:) = x_sp(sp,:) - r1_sp(sp,:) + r2_sp(sp,:);
	end
	
	for sp = 1:spCount
		spElems(sp) = ceil(x_sp(sp,1)/le(1))+(NN(1)-1)*(fix(x_sp(sp,2)/le(2)));   % compute vector store index elements                           
		
		spElems_corner(sp,1) = ceil(x_corner1(sp,1)/le(1))+(NN(1)-1)*(fix(x_corner1(sp,2)/le(2)));
		spElems_corner(sp,2) = ceil(x_corner2(sp,1)/le(1))+(NN(1)-1)*(fix(x_corner2(sp,2)/le(2)));
		spElems_corner(sp,3) = ceil(x_corner3(sp,1)/le(1))+(NN(1)-1)*(fix(x_corner3(sp,2)/le(2)));
		spElems_corner(sp,4) = ceil(x_corner4(sp,1)/le(1))+(NN(1)-1)*(fix(x_corner4(sp,2)/le(2)));
		
		CONNECT_TEMP(sp,1)  = spElems_corner(sp,1) + myfloor((spElems_corner(sp,1)-1)/(NN(1)-1));
		CONNECT_TEMP(sp,2)  = CONNECT_TEMP(sp,1) + 1;
		CONNECT_TEMP(sp,3)  = CONNECT_TEMP(sp,2) + NN(1);
		CONNECT_TEMP(sp,4)  = CONNECT_TEMP(sp,1) + NN(1);
		
		CONNECT_TEMP(sp,5)  = spElems_corner(sp,2) + myfloor((spElems_corner(sp,2)-1)/(NN(1)-1));
		CONNECT_TEMP(sp,6)  = CONNECT_TEMP(sp,5) + 1;
		CONNECT_TEMP(sp,7)  = CONNECT_TEMP(sp,6) + NN(1);
		CONNECT_TEMP(sp,8)  = CONNECT_TEMP(sp,5) + NN(1); 
		
		CONNECT_TEMP(sp,9)  = spElems_corner(sp,3) + myfloor((spElems_corner(sp,3)-1)/(NN(1)-1));
		CONNECT_TEMP(sp,10) = CONNECT_TEMP(sp,9) + 1;
		CONNECT_TEMP(sp,11) = CONNECT_TEMP(sp,10) + NN(1);
		CONNECT_TEMP(sp,12) = CONNECT_TEMP(sp,9) + NN(1); 
		
		CONNECT_TEMP(sp,13) = spElems_corner(sp,4) + myfloor((spElems_corner(sp,4)-1)/(NN(1)-1));
		CONNECT_TEMP(sp,14) = CONNECT_TEMP(sp,13) + 1;
		CONNECT_TEMP(sp,15) = CONNECT_TEMP(sp,14) + NN(1);
		CONNECT_TEMP(sp,16) = CONNECT_TEMP(sp,13) + NN(1);
		
		CONNECT{sp}=unique(CONNECT_TEMP(sp,:));    % Store nodes interacting with corners
		NODES(sp)=length(CONNECT{sp});         % Store number of interacting nodes
		
		N1 = zeros(1,NODES(sp));   % Shape function of corner 1 for 16 nodes
		N2 = zeros(1,NODES(sp));
		N3 = zeros(1,NODES(sp));
		N4 = zeros(1,NODES(sp));
		N_local = zeros(1,NODES(sp));
		
		for i=1:NODES(sp)
			[N1(i),~,~] = linearshape(x_corner1(sp,:),LOC(CONNECT{sp}(i),:),le(1,1),le(1,2));
			[N2(i),~,~] = linearshape(x_corner2(sp,:),LOC(CONNECT{sp}(i),:),le(1,1),le(1,2));
			[N3(i),~,~] = linearshape(x_corner3(sp,:),LOC(CONNECT{sp}(i),:),le(1,1),le(1,2));
			[N4(i),~,~] = linearshape(x_corner4(sp,:),LOC(CONNECT{sp}(i),:),le(1,1),le(1,2));
			N_local(i)  = 0.25*(N1(i)+N2(i)+N3(i)+N4(i));
		end
		
		N{sp} = N_local;
		
		% Build matrix of gradient of shape function 
		w1 = [r1_sp(sp,2)-r2_sp(sp,2) r2_sp(sp,1)-r1_sp(sp,1)];
		w2 = [r1_sp(sp,2)+r2_sp(sp,2) -r2_sp(sp,1)-r1_sp(sp,1)];
		
		for i=1:NODES(sp)      
			dN{sp}(1,i)     = 1/A_sp(sp)*((N1(i)-N3(i))*w1(1) + (N2(i)-N4(i))*w2(1));
			dN{sp}(2,i)     = 1/A_sp(sp)*((N1(i)-N3(i))*w1(2) + (N2(i)-N4(i))*w2(2));
		end
	end
	
	for c =1:cellCount
		id_sp = find(spElems==c);
		mspoints{c}=id_sp;
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

%{
%switchable2
function PrintResults_parfor(le_base,switcher,TimeStampedName,videofps,tt,ttstart,DispPump,CModel,LOC,le,d_sp,e_sp,v_ssp,spCount,niCount,E_acc,TLD,plotignore,matmodel,lp,layer,CasetoRun,orientationoffset,xdirletter,ydirletter,x_spo, ...
    ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit,thetacrackrtl,refinementfactor, frameskip)

%{
    if switcher==1
        switcher=17;
    elseif switcher==2
        switcher=20;
    elseif switcher==3
        switcher=26;
    elseif switcher==4
        switcher=29;
    elseif switcher==5
        switcher=13;
    elseif switcher==6
        switcher=43;
    end
%}
%{
    if switcher==1
        switcher=48;
    elseif switcher==2
        switcher=49;
    elseif switcher==3
        switcher=50;
    elseif switcher==4
        switcher=51;
    end
%}  
    if CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==61 || CasetoRun==62 || CasetoRun==63
        if switcher==1
            %switcher=52;
            switcher=-99;
        elseif switcher==2
            switcher=53;
        else
            switcher=-99;
        end
    elseif CasetoRun==64 || CasetoRun==66 || CasetoRun==69 || CasetoRun==67 || CasetoRun==68 || CasetoRun==71 || CasetoRun==72 || CasetoRun==65 || CasetoRun==70
        if switcher==1
            switcher=54; %smax_var (with crack)
        elseif switcher==2
            switcher=55; %smax_var_nc (no crack)
        elseif switcher==3
            switcher=10; %uy
		elseif switcher==4
			switcher=45; %ux
		else
			switcher=-1;
        end
    elseif CasetoRun==73
        if switcher==1
            switcher=56; %crack_dirs
        elseif switcher==2
            switcher=10; %s_max
        elseif switcher==3
            switcher=9; %s_min
		elseif switcher==4
			switcher=-1; %nada
		else
			switcher=-1;
        end
	elseif CasetoRun==74 || CasetoRun==78 || CasetoRun==81 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==83 || CasetoRun==77
        if switcher==1
            switcher=57; %crack_dirs_nnairn
        elseif switcher==2
            switcher=54; %s_max_var
        elseif switcher==3
            switcher=9; %s_min_without
		elseif switcher==4
			switcher=-1; %nada
		else
			switcher=-1;
        end
	elseif CasetoRun==84 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110 || CasetoRun==96 || CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89 || CasetoRun==85
        if switcher==1
			switcher=55;
		elseif switcher==2
			switcher=61;
		elseif switcher==3
			switcher=60; %crack_dirs_nnairn multi
		elseif switcher==4
			switcher=62; %minimum principal stress with cracks
		elseif switcher>=5 && switcher<=11
			switcher=switcher+10;
		else
			switcher=-1;
		end
	elseif CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==120 || CasetoRun==117
        if switcher==1
			switcher=63; %s_max with traction plots
		elseif switcher==2
			switcher=61;
		elseif switcher==3
			switcher=60; %crack_dirs_nnairn multi
		elseif switcher==4
			switcher=62; %minimum principal stress with cracks
		elseif switcher>=5 && switcher<=11
			switcher=switcher+10;
		else
			switcher=-1;
		end
	elseif CasetoRun==121
		if switcher==1
			switcher=67; %s_max with traction plots
		elseif switcher==2
			switcher=61;
		elseif switcher==3
			switcher=60; %crack_dirs_nnairn multi
		elseif switcher==4
			switcher=62; %minimum principal stress with cracks
		elseif switcher>=5 && switcher<=11
			switcher=switcher+10;
		else
			switcher=-1;
		end
	elseif CasetoRun==123 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==132 || CasetoRun==131 || CasetoRun==130
        if switcher==1
			switcher=68; %s_max with crack paths
		elseif switcher==2
			switcher=70; %s_si_max_K1 with crack paths
		elseif switcher==3
			switcher=71; %s_x with crack paths
		elseif switcher==4
			switcher=-1*61; %crack_dirs_nnairn multi
		elseif switcher==5
			switcher=-1*62; %minimum principal stress with cracks
		elseif switcher>=6 && switcher<=12
			%switcher=switcher+10;
		else
			switcher=-1*66;
			switcher=-1;
		end
	elseif CasetoRun==124
        if switcher==1
			switcher=75; %u_sp_y with crack paths
		elseif switcher==2
			switcher=68; %s_max with crack paths
		elseif switcher==3
			switcher=71; %s_x with crack paths
		elseif switcher==4
			switcher=-1*61; %crack_dirs_nnairn multi
		elseif switcher==5
			switcher=-1*62; %minimum principal stress with cracks
		elseif switcher>=6 && switcher<=12
			%switcher=switcher+10;
		else
			switcher=-1*66;
			switcher=-1;
		end
	elseif CasetoRun==133 || CasetoRun==135 || CasetoRun==134 || CasetoRun==129 || CasetoRun==138
		if switcher==1
			switcher=72; %s_si_max with propdir
		elseif switcher==2
			switcher=73; %s_si_min with propdir
		elseif switcher==3
			switcher=63; %s_x with crack paths with pforce too
		elseif switcher==13
			switcher=-68; %s_max with crack paths
		elseif switcher==4
			switcher=-1*61; %crack_dirs_nnairn multi
		elseif switcher==5
			switcher=-1*62; %minimum principal stress with cracks
		elseif switcher>=6 && switcher<=12
			%switcher=switcher+10;
		else
			switcher=-1*66;
			switcher=-1;
		end
	elseif CasetoRun==184
		if switcher==1
			switcher=78;
		elseif switcher==2
			switcher=61;
		elseif switcher==3
			switcher=76;
		else
			switcher=-1;
		end	
	elseif CasetoRun==191
		if switcher==1
			switcher=85;
		elseif switcher==2
			switcher=83;
		elseif switcher==3
			switcher=78;
		elseif switcher==4
			switcher=61;
		elseif switcher==5
			switcher=84;
		else
			switcher=-1;
		end	
	elseif CasetoRun==192
		if switcher==1
			switcher=78;
		elseif switcher==2
			switcher=61;
		elseif switcher==3
			switcher=83;
		elseif switcher==4
			switcher=81;
		elseif switcher==5
			switcher=84;
		else
			switcher=-1;
		end	
	elseif CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==189
		if switcher==1
			switcher=83;
		elseif switcher==2
			switcher=81;
		elseif switcher==3
			switcher=84;
		elseif switcher==4
			switcher=78;
		elseif switcher==5
			switcher=61;
		else
			switcher=-1;
		end	
	elseif CasetoRun==185
		if switcher==1
			switcher=79;
		elseif switcher==2
			switcher=78;
		elseif switcher==3
			switcher=61;
		elseif switcher==4
			switcher=76;
		else
			switcher=-1;
		end	
	elseif CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169
		if switcher==1
			switcher=61;
		elseif switcher==2
			switcher=68;
		elseif switcher==3
			switcher=76;
		else
			switcher=-1;
		end
	elseif CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==166 || CasetoRun==165
		if switcher==1
			switcher=68;
		elseif switcher==2
			switcher=61;
		else
			switcher=-1;
		end
	elseif CasetoRun==139 || CasetoRun==136 || CasetoRun==140 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==118 || CasetoRun==173 || CasetoRun==151
		if switcher==1
			switcher=68; %s_si_max with nodal
		elseif switcher==2
			switcher=-73; %s_si_min with propdir
		elseif switcher==3
			switcher=-63; %s_x with crack paths with pforce too
		elseif switcher==13
			switcher=-68; %s_max with crack paths
		elseif switcher==4
			switcher=-1*61; %crack_dirs_nnairn multi
		elseif switcher==5
			switcher=-1*62; %minimum principal stress with cracks
		elseif switcher>=6 && switcher<=12
			%switcher=switcher+10;
		else
			switcher=-1*66;
			switcher=-1;
		end
	elseif CasetoRun==144 || CasetoRun==146
		if switcher==1
			switcher=74; %v_x
		elseif switcher==2
			switcher=68; %s_si_max with nodal
		elseif switcher==3
			switcher=-63; %s_x with crack paths with pforce too
		elseif switcher==13
			switcher=-68; %s_max with crack paths
		elseif switcher==4
			switcher=-1*61; %crack_dirs_nnairn multi
		elseif switcher==5
			switcher=-1*62; %minimum principal stress with cracks
		elseif switcher>=6 && switcher<=12
			%switcher=switcher+10;
		else
			switcher=-1*66;
			switcher=-1;
		end
	elseif CasetoRun==148 || CasetoRun==149 || CasetoRun==147
		if switcher==1
			switcher=61; %s_max_multiline
		elseif switcher==2
			switcher=68; %s_si_max with nodal
		elseif switcher==3
			switcher=-63; %s_x with crack paths with pforce too
		elseif switcher==13
			switcher=-68; %s_max with crack paths
		elseif switcher==4
			switcher=-1*61; %crack_dirs_nnairn multi
		elseif switcher==5
			switcher=-1*62; %minimum principal stress with cracks
		elseif switcher>=6 && switcher<=12
			%switcher=switcher+10;
		else
			switcher=-1*66;
			switcher=-1;
		end
	elseif CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161
		if switcher==1
			switcher=61; %s_max_multiline
		elseif switcher==2
			switcher=74; %s_sp_velocity
		elseif switcher==3
			switcher=63; %pforce plot
		elseif switcher==13
			switcher=-68; %s_max with crack paths
		elseif switcher==4
			switcher=-1*61; %crack_dirs_nnairn multi
		elseif switcher==5
			switcher=-1*62; %minimum principal stress with cracks
		elseif switcher>=6 && switcher<=12
			%switcher=switcher+10;
		else
			switcher=-1*66;
			switcher=-1;
		end
    else
        if switcher==1
    %switcher=13: constant scaling max epl shear
    %switcher=43: variable scaling max epl shear
    %switcher=41: load-disp
            switcher=43;
        elseif switcher==2
            %switcher=48; %uy
            switcher=41;
        elseif switcher==3
            %switcher=49; %sx or s1
            switcher=13;
        elseif switcher==4
            %switcher=50; %sy or s2
        elseif switcher==5
            %switcher=51; %deformed
        end
    end
    
    disp(['Start Plotting Switcher #' num2str(switcher)]);
    climit=[];
    if switcher==40
        VideoName           = 'e_pl_max';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);

        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            if length(CModel) == length('Wood_Schmidt17')
                if CModel == 'Wood_Schmidt17'
                    %if exist('climitse')==0
                    %    climitse=[];
                    %end
                    [PlotImage,e_pl_sp_max,~]=Plot_Final2_principalclimit(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,e_pl_sp,climit,1,0);
                    if length(climit)==0
                        climit(1)=min(cutvector(e_pl_sp_max,0,plotignore));
                        climit(2)=max(cutvector(e_pl_sp_max,0,plotignore));
                    else
                        climit(1)=min(climit(1),min(cutvector(e_pl_sp_max,0,plotignore)));
                        climit(2)=max(climit(2),max(cutvector(e_pl_sp_max,0,plotignore)));
                    end
                end
            end
            %if exist('climitss')==0
            %    climitss=[];
            %end
        end
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            if length(CModel) == length('Wood_Schmidt17')
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,e_pl_sp_max,~]=Plot_Final2_principalclimit(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,e_pl_sp,climit,1,1);
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                    saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                    frame = getframe(PlotImage);
                    writeVideo(writerObj,frame);
                    close(PlotImage);
                end
            end
            %if exist('climitss')==0
            %    climitss=[];
            %end
        end
        close(writerObj);
    elseif switcher==52
        VideoName           = 'e_pl_shear_ovl';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);

        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            if length(CModel) == length('Wood_Schmidt17')
                if CModel == 'Wood_Schmidt17'
                    %if exist('climitse')==0
                    %    climitse=[];
                    %end
                    [PlotImage,DUMMY,DUMMY,e_pl_sp_shear]=Plot_Final2_principalclimit_ovl(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,e_pl_sp,climit,3,0,plotignore);
                    if length(climit)==0
                        climit(1)=min(cutvector(e_pl_sp_shear,0,plotignore));
                        climit(2)=max(cutvector(e_pl_sp_shear,0,plotignore));
                    else
                        climit(1)=min(climit(1),min(cutvector(e_pl_sp_shear,0,plotignore)));
                        climit(2)=max(climit(2),max(cutvector(e_pl_sp_shear,0,plotignore)));
                    end
                end
            end
            %if exist('climitss')==0
            %    climitss=[];
            %end
        end
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            if length(CModel) == length('Wood_Schmidt17')
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,DUMMY,DUMMY,e_pl_sp_shear]=Plot_Final2_principalclimit_ovl(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,e_pl_sp,climit,3,1,plotignore);
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                    eval(['cd ' TimeStampedName]);
                    eval(['cd ' VideoName]);
                    eval(['export_fig ' 'tt=' num2str(i) 'd=' num2str(DispPump) '.png' ' -transparent']);
                    cd ..
                    cd ..
                    export_fig  -transparent
                    frame = getframe(PlotImage);
                    writeVideo(writerObj,frame);
                    close(PlotImage);
                end
            end
            %if exist('climitss')==0
            %    climitss=[];
            %end
        end
        close(writerObj);

    elseif switcher==0 % here here
        if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==17
            VideoName           = 's2perlayer';
            mkdir([TimeStampedName '\\' VideoName]);
            writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
            writerObj.FrameRate = videofps;    % number of frame per second
            open(writerObj);

            for i=ttstart:tt
				load([TimeStampedName '\\' num2str(i) '.mat']);
				if i==ttstart
					x_sp_1=x_sp;
				end
                for j=1:size(layer,1)
                    y_layer(i,j)=x_sp_1(layer(1,j),2);
                    s_summed(i,j)=0;
                    for k=1:size(layer,2)
                        s_summed(i,j)=s_summed(i,j)+s_sp(layer(j,k),2);
                    end
                end
            end
            s_min=min([0 min(min(s_summed))]);
            s_max=max([0 max(max(s_summed))]);
            for i=ttstart:tt
				load([TimeStampedName '\\' num2str(i) '.mat']);
                PlotImage=figure;
                set(PlotImage,'visible','off');
                plot(s_summed(i,:),y_layer(i,:));
                hold on
                plot(s_min,y_layer(i,1));
                plot(s_max,y_layer(i,1));
                xlabel('s2 (MPa)');
                ylabel('Particle Position (mm)');
                title('Summed layer Y-stress');
                saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                frame=getframe(PlotImage);
                writeVideo(writerObj,frame);
                hold off
                close(PlotImage);
            end
            close(writerObj);
        elseif CasetoRun==4
        elseif CasetoRun==5 || CasetoRun==6
        elseif CasetoRun==7
            VideoName           = 's2perlayer';
            mkdir([TimeStampedName '\\' VideoName]);
            writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
            writerObj.FrameRate = videofps;    % number of frame per second
            open(writerObj);

            for i=ttstart:tt
				load([TimeStampedName '\\' num2str(i) '.mat']);
				if i==ttstart
					x_sp_1=x_sp;
				end
                for j=1:size(layer,1)
                    y_layer(i,j)=x_sp_1(layer(1,j),2);
                    s_summed(i,j)=0;
                    for k=1:size(layer,2)
                        s_summed(i,j)=s_summed(i,j)+s_sp(layer(j,k),2);
                    end
                end
            end
            s_min=min([0 min(min(s_summed))]);
            s_max=max([0 max(max(s_summed))]);
            for i=ttstart:tt
				load([TimeStampedName '\\' num2str(i) '.mat']);
                PlotImage=figure;
                set(PlotImage,'visible','off');
                plot(s_summed(i,:),y_layer(i,:));
                hold on
                plot(s_min,y_layer(i,1));
                plot(s_max,y_layer(i,1));
                xlabel('s2 (MPa)');
                ylabel('Particle Position (mm)');
                title('Summed layer Y-stress');
                %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                frame=getframe(PlotImage);
                writeVideo(writerObj,frame);
                hold off
                close(PlotImage);
            end
            close(writerObj);
        elseif CasetoRun==8 || CasetoRun==9
        elseif CasetoRun==10
            VideoName           = 's2perlayer';
            mkdir([TimeStampedName '\\' VideoName]);
            writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
            writerObj.FrameRate = videofps;    % number of frame per second
            open(writerObj);

            for i=ttstart:tt
				load([TimeStampedName '\\' num2str(i) '.mat']);
				if i==ttstart
					x_sp_1=x_sp;
				end
                for j=1:size(layer,1)
                    y_layer(i,j)=x_sp_1(layer(1,j),2);
                    s_summed(i,j)=0;
                    for k=1:size(layer,2)
                        s_summed(i,j)=s_summed(i,j)+s_sp(layer(j,k),2);
                    end
                end
            end
            s_min=min([0 min(min(s_summed))]);
            s_max=max([0 max(max(s_summed))]);
            for i=ttstart:tt
				load([TimeStampedName '\\' num2str(i) '.mat']);
                PlotImage=figure;
                set(PlotImage,'visible','off');
                plot(s_summed(i,:),y_layer(i,:));
                hold on
                plot(s_min,y_layer(i,1));
                plot(s_max,y_layer(i,1));
                xlabel('s2 (MPa)');
                ylabel('Particle Position (mm)');
                title('Summed layer Y-stress');
                %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                frame=getframe(PlotImage);
                writeVideo(writerObj,frame);
                hold off
                close(PlotImage);
            end
            close(writerObj);
        elseif CasetoRun==11
        elseif CasetoRun==12 || CasetoRun==16 || CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44
        elseif CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==15 || CasetoRun==14
        end

   elseif switcher==35
        VideoName           = 'deformed';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);

        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    %if exist('climitse')==0
                    %    climitse=[];
                    %end
                    PlotImage=Plot_Current(x_sp,LOC,orientationoffset,xdirletter,ydirletter,lp,le,F_sp);
                    %climitserec=[climitserec;climitse];
                    saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                    frame = getframe(PlotImage);
                    writeVideo(writerObj,frame);
                    close(PlotImage);
                end
            end
            %if exist('climitss')==0
            %    climitss=[];
            %end
        end
        close(writerObj);
        
   elseif switcher==56
        VideoName           = 'crackdir';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);

        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    %if exist('climitse')==0
                    %    climitse=[];
                    %end
                    PlotImage=Plot_CrackDir(x_sp,LOC,orientationoffset,xdirletter,ydirletter,lp,le,F_sp,thetacrack);
                    %climitserec=[climitserec;climitse];
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                    saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                    frame = getframe(PlotImage);
                    writeVideo(writerObj,frame);
                    close(PlotImage);
                end
            end
            %if exist('climitss')==0
            %    climitss=[];
            %end
        end
        close(writerObj);
	elseif switcher==57
        VideoName           = 'crackdirnairn';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);
		
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    %if exist('climitse')==0
                    %    climitse=[];
                    %end
                    PlotImage=Plot_CrackDirNairn(x_sp,LOC,orientationoffset,xdirletter,ydirletter,lp,le,F_sp,thetacrack,x_crack,x_cracktop,x_crackbot);
                    %climitserec=[climitserec;climitse];
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                    saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                    frame = getframe(PlotImage);
                    writeVideo(writerObj,frame);
                    close(PlotImage);
                end
            end
            %if exist('climitss')==0
            %    climitss=[];
            %end
        end
        close(writerObj);

	elseif switcher==59
        VideoName           = 'crackdirnairn_multi';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);

        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    %if exist('climitse')==0
                    %    climitse=[];
                    %end
                    PlotImage=Plot_CrackDirNairn_multi(x_sp,LOC,orientationoffset,xdirletter,ydirletter,lp,le,F_sp,thetacrack,x_crack,x_cracktop,x_crackbot);
                    %climitserec=[climitserec;climitse];
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                    saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                    frame = getframe(PlotImage);
                    writeVideo(writerObj,frame);
                    close(PlotImage);
                end
            end
            %if exist('climitss')==0
            %    climitss=[];
            %end
        end
        close(writerObj);
	elseif switcher==60
        VideoName           = 'crackdirnairn_multilines';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);

        for i=ttstart:tt
%{
%switchable1
			load([TimeStampedName '\\' num2str(i) '.mat']);        
%}
%switchable1
%[
%switchable1
			x_sp=loadmatrixfloat([TimeStampedName '-Slave-' int2txt(tt) '' '-' 'x_sp' '.txt']);
			F_sp=loadcellmatrixfloat([TimeStampedName '-Slave-' int2txt(tt) '' '-' 'F_sp' '.txt']);
			thetacrack=loadmatrixfloat([TimeStampedName '-Slave-' int2txt(tt) '' '-' 'thetacrack' '.txt']);
			x_crack=loadcellmatrixfloat([TimeStampedName '-Slave-' int2txt(tt) '' '-' 'x_crack' '.txt']);
			x_cracktop=loadcellmatrixfloat([TimeStampedName '-Slave-' int2txt(tt) '' '-' 'x_cracktop' '.txt']);
			x_crackbot=loadcellmatrixfloat([TimeStampedName '-Slave-' int2txt(tt) '' '-' 'x_crackbot' '.txt']);
			DispPump=loadsinglefloat([TimeStampedName '-Slave-' int2txt(tt) '' '-' 'DispPump' '.txt']);
			t_time=loadsinglefloat([TimeStampedName '-Slave-' int2txt(tt) '' '-' 't_time' '.txt']);
%]
%switchable1
			
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    %if exist('climitse')==0
                    %    climitse=[];
                    %end
                    PlotImage=Plot_CrackDirNairn_multilines(x_sp,LOC,orientationoffset,xdirletter,ydirletter,lp,le,F_sp,thetacrack,x_crack,x_cracktop,x_crackbot,CasetoRun);
                    %climitserec=[climitserec;climitse];
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                    saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                    frame = getframe(PlotImage);
                    writeVideo(writerObj,frame);
                    close(PlotImage);
                end
            end
            %if exist('climitss')==0
            %    climitss=[];
            %end
        end
        close(writerObj);
	elseif switcher==36
        VideoName           = 'e_pl_min';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);

        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    if exist('climit')==0
                        climit=[];
                    end
                    [PlotImage,DUMMY,e_pl_sp_min,~]=Plot_Final2_principalclimit(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,e_pl_sp,climit,2,0);
                    if length(climit)==0
                        climit(1)=min(cutvector(e_pl_sp_min,0,plotignore));
                        climit(2)=max(cutvector(e_pl_sp_min,0,plotignore));
                    else
                        climit(1)=min(climit(1),min(cutvector(e_pl_sp_min,0,plotignore)));
                        climit(2)=max(climit(2),max(cutvector(e_pl_sp_min,0,plotignore)));
                    end
                end
            end
        end
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            if length(CModel) == length('Wood_Schmidt17')
                if CModel == 'Wood_Schmidt17'
                    %climitserec=[climitserec;climitse];
                    [PlotImage,DUMMY,e_pl_sp_min,~]=Plot_Final2_principalclimit(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,e_pl_sp,climit,2,1);
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                    saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                    frame = getframe(PlotImage);
                    writeVideo(writerObj,frame);
                    close(PlotImage);
                end
            end
            %if exist('climitss')==0
            %    climitss=[];
            %end
        end
        close(writerObj);
    
    elseif switcher==37
        VideoName           = 'e_el_min';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);
		
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    if exist('climit')==0
                        climit=[];
                    end
                    e_el_sp=e_t_global_big(:,[1 2 4])-e_pl_sp;
                    [PlotImage,DUMMY,e_pl_sp_min,~]=Plot_Final2_principalclimit(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,e_el_sp,climit,2,0);
                    if length(climit)==0
                        climit(1)=min(cutvector(e_pl_sp_min,0,plotignore));
                        climit(2)=max(cutvector(e_pl_sp_min,0,plotignore));
                    else
                        climit(1)=min(climit(1),min(cutvector(e_pl_sp_min,0,plotignore)));
                        climit(2)=max(climit(2),max(cutvector(e_pl_sp_min,0,plotignore)));
                    end
                    %climitserec=[climitserec;climitse];
                end
            end
        end
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    e_el_sp=e_t_global_big(:,[1 2 4])-e_pl_sp;
                    [PlotImage,DUMMY,e_pl_sp_min,~]=Plot_Final2_principalclimit(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,e_el_sp,climit,2,1);
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                    saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                    frame = getframe(PlotImage);
                    writeVideo(writerObj,frame);
                    close(PlotImage);
                end
            end
            %if exist('climitss')==0
            %    climitss=[];
            %end
        end
        close(writerObj);
    elseif switcher==38
        VideoName           = 'e_el_max';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);

        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    if exist('climit')==0
                        climit=[];
                    end
                    e_el_sp=e_t_global_big(:,[1 2 4])-e_pl_sp;
                    [PlotImage,e_pl_sp_max,~]=Plot_Final2_principalclimit(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,e_el_sp,climit,1,0);
                    if length(climit)==0
                        climit(1)=min(cutvector(e_pl_sp_max,0,plotignore));
                        climit(2)=max(cutvector(e_pl_sp_max,0,plotignore));
                    else
                        climit(1)=min(climit(1),min(cutvector(e_pl_sp_max,0,plotignore)));
                        climit(2)=max(climit(2),max(cutvector(e_pl_sp_max,0,plotignore)));
                    end
                    %climitserec=[climitserec;climitse];
                end
            end
        end
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    e_el_sp=e_t_global_big(:,[1 2 4])-e_pl_sp;
                    [PlotImage,e_pl_sp_max,~]=Plot_Final2_principalclimit(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,e_el_sp,climit,1,1);
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                    saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                    frame = getframe(PlotImage);
                    writeVideo(writerObj,frame);
                    close(PlotImage);
                end
            end
            %if exist('climitss')==0
            %    climitss=[];
            %end
        end
        close(writerObj);
    
    elseif switcher==13
        VideoName           = 'e_pl_shear';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);

        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    if exist('climit')==0
                        climit=[];
                    end
                    [PlotImage,DUMMY,DUMMY,e_pl_sp_shear]=Plot_Final2_principalclimit(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,e_pl_sp,climit,3,0);
                    if length(climit)==0
                        climit(1)=min(cutvector(e_pl_sp_shear,0,plotignore));
                        climit(2)=max(cutvector(e_pl_sp_shear,0,plotignore));
                    else
                        climit(1)=min(climit(1),min(cutvector(e_pl_sp_shear,0,plotignore)));
                        climit(2)=max(climit(2),max(cutvector(e_pl_sp_shear,0,plotignore)));
                    end
                end
            end
        end
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,DUMMY,DUMMY,e_pl_sp_shear]=Plot_Final2_principalclimit(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,e_pl_sp,climit,3,1);
                    %climitserec=[climitserec;climitse];
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                    saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                    frame = getframe(PlotImage);
                    writeVideo(writerObj,frame);
                    close(PlotImage);
                end
            end
            %if exist('climitss')==0
            %    climitss=[];
            %end
        end
        close(writerObj);
    
    elseif switcher==53
        VideoName           = 'e_pl_shear_report';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);
        if CasetoRun==61 || CasetoRun==62 || CasetoRun==63
            tt=min([tt 120]);
        end
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    if exist('climit')==0
                        climit=[];
                    end
                    [PlotImage,DUMMY,DUMMY,e_pl_sp_shear]=Plot_Final2_principalclimit_report(matmodel,CasetoRun,t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,e_pl_sp,climit,3,0);
                    if length(climit)==0
                        climit(1)=min(cutvector(e_pl_sp_shear,0,plotignore));
                        climit(2)=max(cutvector(e_pl_sp_shear,0,plotignore));
                    else
                        climit(1)=min(climit(1),min(cutvector(e_pl_sp_shear,0,plotignore)));
                        climit(2)=max(climit(2),max(cutvector(e_pl_sp_shear,0,plotignore)));
                    end
                end
            end
        end
        if CasetoRun==61 || CasetoRun==62 || CasetoRun==63
            climit(1)=0;
            climit(2)=0.18;
        end
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,DUMMY,DUMMY,e_pl_sp_shear]=Plot_Final2_principalclimit_report(matmodel,CasetoRun,t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,e_pl_sp,climit,3,1);
                    %climitserec=[climitserec;climitse];
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                    saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                    frame = getframe(PlotImage);
                    writeVideo(writerObj,frame);
                    close(PlotImage);
                end
            end
            %if exist('climitss')==0
            %    climitss=[];
            %end
        end
        close(writerObj);
    
    elseif switcher==43
        VideoName           = 'e_pl_shear2';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);

        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    if exist('climit')==0
                        climit=[];
                    end
                    %[PlotImage,DUMMY,DUMMY,e_pl_sp_shear]=Plot_Final2_principalclimit(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,e_pl_sp,climit,3,0);
                    [PlotImage,DUMMY,DUMMY,e_pl_sp_shear]=Plot_Final2_principalclimit(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,e_pl_sp,climit,3,1);
                    %climitserec=[climitserec;climitse];
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                    saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                    frame = getframe(PlotImage);
                    writeVideo(writerObj,frame);
                    close(PlotImage);
                    if length(climit)==0
                        climit(1)=min(cutvector(e_pl_sp_shear,0,plotignore));
                        climit(2)=max(cutvector(e_pl_sp_shear,0,plotignore));
                    else
                        climit(1)=min(climit(1),min(cutvector(e_pl_sp_shear,0,plotignore)));
                        climit(2)=max(climit(2),max(cutvector(e_pl_sp_shear,0,plotignore)));
                    end
                end
            end
        end
        close(writerObj);
    
    elseif switcher==54
        VideoName           = 's_max_var';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);

        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,s_sp_max,~]=Plot_Final2_principalclimit_directions_crack(x_sp,x_crack,x_cracktop,x_crackbot,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,1,lp,plotignore,1);
                    if length(climit)==0
                        climit(1)=min(cutvector(s_sp_max,0,plotignore));
                        climit(2)=max(cutvector(s_sp_max,0,plotignore));
                    else
                        climit(1)=min(climit(1),min(cutvector(s_sp_max,0,plotignore)));
                        climit(2)=max(climit(2),max(cutvector(s_sp_max,0,plotignore)));
                    end
%{
                end
            end
        end
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,s_sp_max,~]=Plot_Final2_principalclimit_directions(x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,1,lp,plotignore,1);
%}
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                    saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                    frame = getframe(PlotImage);
                    writeVideo(writerObj,frame);
                    close(PlotImage);
                end
            end
        end
        
        close(writerObj);
    
    elseif switcher==58
        VideoName           = 's_max_multi';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);
		
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,s_sp_max,~]=Plot_Final2_principalclimit_directions_crackmulti(x_sp,x_crack,x_cracktop,x_crackbot,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,1,lp,plotignore,1,CasetoRun);
                    if length(climit)==0
                        climit(1)=min(cutvector(s_sp_max,0,plotignore));
                        climit(2)=max(cutvector(s_sp_max,0,plotignore));
                    else
                        climit(1)=min(climit(1),min(cutvector(s_sp_max,0,plotignore)));
                        climit(2)=max(climit(2),max(cutvector(s_sp_max,0,plotignore)));
                    end
				%{
                end
            end
        end
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,s_sp_max,~]=Plot_Final2_principalclimit_directions(x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,1,lp,plotignore,1);
				%}
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                    saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                    frame = getframe(PlotImage);
                    writeVideo(writerObj,frame);
                    close(PlotImage);
                end
            end
        end
        
        close(writerObj);
    
    elseif switcher==61
        VideoName           = 's_max_multiline';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);
		
        for i=ttstart:9999
%{
%switchable1
			load([TimeStampedName '\\' num2str(i) '.mat']);
%}
%switchable1
%[
%switchable1
			tt=loadsinglelong([TimeStampedName '-Master-' 'tt' '.txt']);
			if i>tt
				break;
			elseif mod(i-1,frameskip+1)>0
				continue;
			end
			x_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'x_sp' '-' int2txt(i) '.txt']);
			F_sp=loadcellmatrixfloat([TimeStampedName '-Slave-' 'F_sp' '-' int2txt(i) '.txt']);
			thetacrack=loadmatrixfloat([TimeStampedName '-Slave-' 'thetacrack' '-' int2txt(i) '.txt']);
			x_crack=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crack' '-' int2txt(i) '.txt']);
			x_cracktop=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_cracktop' '-' int2txt(i) '.txt']);
			x_crackbot=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crackbot' '-' int2txt(i) '.txt']);
			DispPump=loadsinglefloat([TimeStampedName '-Slave-' 'DispPump' '-' int2txt(i) '.txt']);
			t_time=loadsinglefloat([TimeStampedName '-Slave-' 't_time' '-' int2txt(i) '.txt']);
			s_sp=loadmatrixfloat([TimeStampedName '-Slave-' 's_sp' '-' int2txt(i) '.txt']);
			v_ssp=loadmatrixfloat([TimeStampedName '-Slave-' 'v_ssp' '-' int2txt(i) '.txt']);
			r1_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r1_sp' '-' int2txt(i) '.txt']);
			r2_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r2_sp' '-' int2txt(i) '.txt']);
			E_acc=loadmatrixfloat([TimeStampedName '-Slave-' 'E_acc' '-' int2txt(i) '.txt']);
%]
%switchable1			
			
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,s_sp_max,~]=Plot_Final2_principalclimit_directions_crackmultiline(le_base,x_sp,x_crack,x_cracktop,x_crackbot,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,1,lp,plotignore,1,CasetoRun,refinementfactor);
                    if length(climit)==0
                        climit(1)=min(cutvector(s_sp_max,0,plotignore));
                        climit(2)=max(cutvector(s_sp_max,0,plotignore));
                    else
                        climit(1)=min(climit(1),min(cutvector(s_sp_max,0,plotignore)));
                        climit(2)=max(climit(2),max(cutvector(s_sp_max,0,plotignore)));
                    end
%{
                end
            end
        end
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,s_sp_max,~]=Plot_Final2_principalclimit_directions(x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,1,lp,plotignore,1);
%}
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                    saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                    frame = getframe(PlotImage);
                    writeVideo(writerObj,frame);
                    close(PlotImage);
                end
            end
        end
        
        close(writerObj);

	elseif switcher==78
		VideoName           = 'cohesive';
		mkdir([TimeStampedName '\\' VideoName]);
		writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
		writerObj.FrameRate = videofps;    % number of frame per second
		open(writerObj);
		
		%{
		for i=ttstart:9999
			tt=loadsinglelong([TimeStampedName '-Master-' 'tt' '.txt']);
			if i>tt
				break;
			elseif mod(i-1,frameskip+1)>0
				continue;
			end
			x_crack_abs_force=loadmatrixfloat([TimeStampedName '-Slave-' 'x_crack_bridge_absforce' '-' int2txt(i) '.txt']);
			if length(CModel) == length('Wood_Schmidt17');
				if CModel == 'Wood_Schmidt17'
					if length(climit)==0
						climit(1)=min(min(x_crack_abs_force));
						climit(2)=max(max(x_crack_abs_force));
					else
						climit(1)=min(climit(1),min(min(x_crack_abs_force)));
						climit(2)=max(climit(2),max(max(x_crack_abs_force)));
					end
				end
			end
		end
		%}
		for i=ttstart:9999
%{
%switchable1
			load([TimeStampedName '\\' num2str(i) '.mat']);
%}
%switchable1
%[
%switchable1
			tt=loadsinglelong([TimeStampedName '-Master-' 'tt' '.txt']);
			if i>tt
				break;
			elseif mod(i-1,frameskip+1)>0
				continue;
			end
			x_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'x_sp' '-' int2txt(i) '.txt']);
			
			
			x_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'x_sp' '-' int2txt(i) '.txt']);
			F_sp=loadcellmatrixfloat([TimeStampedName '-Slave-' 'F_sp' '-' int2txt(i) '.txt']);
			thetacrack=loadmatrixfloat([TimeStampedName '-Slave-' 'thetacrack' '-' int2txt(i) '.txt']);
			x_crack=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crack' '-' int2txt(i) '.txt']);
			x_cracktop=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_cracktop' '-' int2txt(i) '.txt']);
			x_crackbot=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crackbot' '-' int2txt(i) '.txt']);
			DispPump=loadsinglefloat([TimeStampedName '-Slave-' 'DispPump' '-' int2txt(i) '.txt']);
			t_time=loadsinglefloat([TimeStampedName '-Slave-' 't_time' '-' int2txt(i) '.txt']);
			s_sp=loadmatrixfloat([TimeStampedName '-Slave-' 's_sp' '-' int2txt(i) '.txt']);
			v_ssp=loadmatrixfloat([TimeStampedName '-Slave-' 'v_ssp' '-' int2txt(i) '.txt']);
			r1_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r1_sp' '-' int2txt(i) '.txt']);
			r2_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r2_sp' '-' int2txt(i) '.txt']);
			E_acc=loadmatrixfloat([TimeStampedName '-Slave-' 'E_acc' '-' int2txt(i) '.txt']);
			x_crack_abs_force=loadmatrixfloat([TimeStampedName '-Slave-' 'x_crack_bridge_absforce' '-' int2txt(i) '.txt']);
%]
%switchable1			
			
			if length(CModel) == length('Wood_Schmidt17');
				if CModel == 'Wood_Schmidt17'
					[PlotImage]=Plot_Cohesive(le_base,x_crack_abs_force,x_sp,x_crack,x_cracktop,x_crackbot,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,1,lp,plotignore,1,CasetoRun,refinementfactor);
					if length(climit)==0
						climit(1)=min(min(x_crack_abs_force));
						climit(2)=max(max(x_crack_abs_force));
					else
						climit(1)=min(climit(1),min(min(x_crack_abs_force)));
						climit(2)=max(climit(2),max(max(x_crack_abs_force)));
					end

					%saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
					saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
					frame = getframe(PlotImage);
					writeVideo(writerObj,frame);
					close(PlotImage);
				end
			end
		end
		
		close(writerObj);
	
	elseif switcher==85
		VideoName           = 'sequence';
		mkdir([TimeStampedName '\\' VideoName]);
		writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
		writerObj.FrameRate = videofps;    % number of frame per second
		open(writerObj);
		
		%{
		for i=ttstart:9999
			tt=loadsinglelong([TimeStampedName '-Master-' 'tt' '.txt']);
			if i>tt
				break;
			elseif mod(i-1,frameskip+1)>0
				continue;
			end
			x_crack_abs_force=loadmatrixfloat([TimeStampedName '-Slave-' 'x_crack_bridge_absforce' '-' int2txt(i) '.txt']);
			if length(CModel) == length('Wood_Schmidt17');
				if CModel == 'Wood_Schmidt17'
					if length(climit)==0
						climit(1)=min(min(x_crack_abs_force));
						climit(2)=max(max(x_crack_abs_force));
					else
						climit(1)=min(climit(1),min(min(x_crack_abs_force)));
						climit(2)=max(climit(2),max(max(x_crack_abs_force)));
					end
				end
			end
		end
		%}
		for i=ttstart:9999
%{
%switchable1
			load([TimeStampedName '\\' num2str(i) '.mat']);
%}
%switchable1
%[
%switchable1
			tt=loadsinglelong([TimeStampedName '-Master-' 'tt' '.txt']);
			if i>tt
				break;
			%elseif mod(i-1,frameskip+1)>0
			%	continue;
			end
			x_crack_sequence_tipreg=loadmatrixfloat([TimeStampedName '-Slave-' 'x_crack_sequence_tipreg' '-' int2txt(i) '.txt']);
			x_crack_sequence_merge=loadmatrixfloat([TimeStampedName '-Slave-' 'x_crack_sequence_merge' '-' int2txt(i) '.txt']);
			if sum(sum(x_crack_sequence_tipreg))+sum(sum(x_crack_sequence_merge))>0
			else
				continue;
			end
			
			
			x_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'x_sp' '-' int2txt(i) '.txt']);
			
			
			x_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'x_sp' '-' int2txt(i) '.txt']);
			F_sp=loadcellmatrixfloat([TimeStampedName '-Slave-' 'F_sp' '-' int2txt(i) '.txt']);
			thetacrack=loadmatrixfloat([TimeStampedName '-Slave-' 'thetacrack' '-' int2txt(i) '.txt']);
			x_crack=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crack' '-' int2txt(i) '.txt']);
			x_cracktop=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_cracktop' '-' int2txt(i) '.txt']);
			x_crackbot=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crackbot' '-' int2txt(i) '.txt']);
			DispPump=loadsinglefloat([TimeStampedName '-Slave-' 'DispPump' '-' int2txt(i) '.txt']);
			t_time=loadsinglefloat([TimeStampedName '-Slave-' 't_time' '-' int2txt(i) '.txt']);
			s_sp=loadmatrixfloat([TimeStampedName '-Slave-' 's_sp' '-' int2txt(i) '.txt']);
			v_ssp=loadmatrixfloat([TimeStampedName '-Slave-' 'v_ssp' '-' int2txt(i) '.txt']);
			r1_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r1_sp' '-' int2txt(i) '.txt']);
			r2_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r2_sp' '-' int2txt(i) '.txt']);
			E_acc=loadmatrixfloat([TimeStampedName '-Slave-' 'E_acc' '-' int2txt(i) '.txt']);
			x_crack_abs_force=loadmatrixfloat([TimeStampedName '-Slave-' 'x_crack_bridge_absforce' '-' int2txt(i) '.txt']);
			x_crack_nparticles=loadmatrixfloat([TimeStampedName '-Slave-' 'x_crack_nparticles' '-' int2txt(i) '.txt']);
			
%]
%switchable1			
			
			if length(CModel) == length('Wood_Schmidt17');
				if CModel == 'Wood_Schmidt17'
					[PlotImage]=Plot_Sequence(x_crack_sequence_merge,x_crack_sequence_tipreg,x_crack_nparticles,le_base,x_crack_abs_force,x_sp,x_crack,x_cracktop,x_crackbot,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,1,lp,plotignore,1,CasetoRun,refinementfactor);
					if length(climit)==0
						climit(1)=min(min(x_crack_abs_force));
						climit(2)=max(max(x_crack_abs_force));
					else
						climit(1)=min(climit(1),min(min(x_crack_abs_force)));
						climit(2)=max(climit(2),max(max(x_crack_abs_force)));
					end

					%saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
					saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
					frame = getframe(PlotImage);
					writeVideo(writerObj,frame);
					close(PlotImage);
				end
			end
		end
		
		close(writerObj);
	
	elseif switcher==79
		VideoName           = 'cohesive_inelastic';
		mkdir([TimeStampedName '\\' VideoName]);
		writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
		writerObj.FrameRate = videofps;    % number of frame per second
		open(writerObj);
		%{
		for i=ttstart:9999
			tt=loadsinglelong([TimeStampedName '-Master-' 'tt' '.txt']);
			if i>tt
				break;
			elseif mod(i-1,frameskip+1)>0
				continue;
			end
			x_crack_bridge_absdeltaxmaxi=loadmatrixfloat([TimeStampedName '-Slave-' 'x_crack_bridge_absdeltaxmaxi' '-' int2txt(i) '.txt']);
			if length(CModel) == length('Wood_Schmidt17');
				if CModel == 'Wood_Schmidt17'
					if length(climit)==0
						climit(1)=min(min(x_crack_bridge_absdeltaxmaxi));
						climit(2)=max(max(x_crack_bridge_absdeltaxmaxi));
					else
						climit(1)=min(climit(1),min(min(x_crack_bridge_absdeltaxmaxi)));
						climit(2)=max(climit(2),max(max(x_crack_bridge_absdeltaxmaxi)));
					end
				end
			end
		end
		%}
		for i=ttstart:9999
%{
%switchable1
			load([TimeStampedName '\\' num2str(i) '.mat']);
%}
%switchable1
%[
%switchable1
			tt=loadsinglelong([TimeStampedName '-Master-' 'tt' '.txt']);
			if i>tt
				break;
			elseif mod(i-1,frameskip+1)>0
				continue;
			end
			x_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'x_sp' '-' int2txt(i) '.txt']);
			
			
			x_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'x_sp' '-' int2txt(i) '.txt']);
			F_sp=loadcellmatrixfloat([TimeStampedName '-Slave-' 'F_sp' '-' int2txt(i) '.txt']);
			thetacrack=loadmatrixfloat([TimeStampedName '-Slave-' 'thetacrack' '-' int2txt(i) '.txt']);
			x_crack=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crack' '-' int2txt(i) '.txt']);
			x_cracktop=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_cracktop' '-' int2txt(i) '.txt']);
			x_crackbot=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crackbot' '-' int2txt(i) '.txt']);
			DispPump=loadsinglefloat([TimeStampedName '-Slave-' 'DispPump' '-' int2txt(i) '.txt']);
			t_time=loadsinglefloat([TimeStampedName '-Slave-' 't_time' '-' int2txt(i) '.txt']);
			s_sp=loadmatrixfloat([TimeStampedName '-Slave-' 's_sp' '-' int2txt(i) '.txt']);
			v_ssp=loadmatrixfloat([TimeStampedName '-Slave-' 'v_ssp' '-' int2txt(i) '.txt']);
			r1_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r1_sp' '-' int2txt(i) '.txt']);
			r2_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r2_sp' '-' int2txt(i) '.txt']);
			E_acc=loadmatrixfloat([TimeStampedName '-Slave-' 'E_acc' '-' int2txt(i) '.txt']);
			x_crack_abs_force=loadmatrixfloat([TimeStampedName '-Slave-' 'x_crack_bridge_absforce' '-' int2txt(i) '.txt']);
			x_crack_bridge_absdeltaxmaxi=loadmatrixfloat([TimeStampedName '-Slave-' 'x_crack_bridge_absdeltaxmaxi' '-' int2txt(i) '.txt']);
%]
%switchable1			
			
			if length(CModel) == length('Wood_Schmidt17');
				if CModel == 'Wood_Schmidt17'
					[PlotImage]=Plot_Cohesive_dispi(x_crack_abs_force,x_crack_bridge_absdeltaxmaxi,x_sp,x_crack,x_cracktop,x_crackbot,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,1,lp,plotignore,1,CasetoRun,refinementfactor);
					if length(climit)==0
						climit(1)=min(min(x_crack_bridge_absdeltaxmaxi));
						climit(2)=max(max(x_crack_bridge_absdeltaxmaxi));
					else
						climit(1)=min(climit(1),min(min(x_crack_bridge_absdeltaxmaxi)));
						climit(2)=max(climit(2),max(max(x_crack_bridge_absdeltaxmaxi)));
					end

					%saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
					saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
					frame = getframe(PlotImage);
					writeVideo(writerObj,frame);
					close(PlotImage);
				end
			end
		end
		
		close(writerObj);
	
	elseif switcher==80
		VideoName           = 'bridge_absdeltax';
		mkdir([TimeStampedName '\\' VideoName]);
		writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
		writerObj.FrameRate = videofps;    % number of frame per second
		open(writerObj);
		%{
		for i=ttstart:9999
			tt=loadsinglelong([TimeStampedName '-Master-' 'tt' '.txt']);
			if i>tt
				break;
			elseif mod(i-1,frameskip+1)>0
				continue;
			end
			x_crack_bridge_base_absdeltax=loadmatrixfloat([TimeStampedName '-Slave-' 'x_crack_bridge_base_absdeltax' '-' int2txt(i) '.txt']);
			if length(CModel) == length('Wood_Schmidt17');
				if CModel == 'Wood_Schmidt17'
					if length(climit)==0
						climit(1)=min(min(x_crack_bridge_base_absdeltax));
						climit(2)=max(max(x_crack_bridge_base_absdeltax));
					else
						climit(1)=min(climit(1),min(min(x_crack_bridge_base_absdeltax)));
						climit(2)=max(climit(2),max(max(x_crack_bridge_base_absdeltax)));
					end
				end
			end
		end
		%}
		for i=ttstart:9999
%{
%switchable1
			load([TimeStampedName '\\' num2str(i) '.mat']);
%}
%switchable1
%[
%switchable1
			tt=loadsinglelong([TimeStampedName '-Master-' 'tt' '.txt']);
			if i>tt
				break;
			elseif mod(i-1,frameskip+1)>0
				continue;
			end
			x_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'x_sp' '-' int2txt(i) '.txt']);
			
			
			x_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'x_sp' '-' int2txt(i) '.txt']);
			F_sp=loadcellmatrixfloat([TimeStampedName '-Slave-' 'F_sp' '-' int2txt(i) '.txt']);
			thetacrack=loadmatrixfloat([TimeStampedName '-Slave-' 'thetacrack' '-' int2txt(i) '.txt']);
			x_crack=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crack' '-' int2txt(i) '.txt']);
			x_cracktop=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_cracktop' '-' int2txt(i) '.txt']);
			x_crackbot=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crackbot' '-' int2txt(i) '.txt']);
			DispPump=loadsinglefloat([TimeStampedName '-Slave-' 'DispPump' '-' int2txt(i) '.txt']);
			t_time=loadsinglefloat([TimeStampedName '-Slave-' 't_time' '-' int2txt(i) '.txt']);
			s_sp=loadmatrixfloat([TimeStampedName '-Slave-' 's_sp' '-' int2txt(i) '.txt']);
			v_ssp=loadmatrixfloat([TimeStampedName '-Slave-' 'v_ssp' '-' int2txt(i) '.txt']);
			r1_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r1_sp' '-' int2txt(i) '.txt']);
			r2_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r2_sp' '-' int2txt(i) '.txt']);
			E_acc=loadmatrixfloat([TimeStampedName '-Slave-' 'E_acc' '-' int2txt(i) '.txt']);
			x_crack_abs_force=loadmatrixfloat([TimeStampedName '-Slave-' 'x_crack_bridge_absforce' '-' int2txt(i) '.txt']);
			x_crack_bridge_base_absdeltax=loadmatrixfloat([TimeStampedName '-Slave-' 'x_crack_bridge_base_absdeltax' '-' int2txt(i) '.txt']);
%]
%switchable1			
			
			if length(CModel) == length('Wood_Schmidt17');
				if CModel == 'Wood_Schmidt17'
					[PlotImage]=Plot_Cohesive_dispi(x_crack_abs_force,x_crack_bridge_base_absdeltax,x_sp,x_crack,x_cracktop,x_crackbot,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,1,lp,plotignore,1,CasetoRun,refinementfactor);
					if length(climit)==0
						climit(1)=min(min(x_crack_bridge_base_absdeltax));
						climit(2)=max(max(x_crack_bridge_base_absdeltax));
					else
						climit(1)=min(climit(1),min(min(x_crack_bridge_base_absdeltax)));
						climit(2)=max(climit(2),max(max(x_crack_bridge_base_absdeltax)));
					end

					%saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
					saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
					frame = getframe(PlotImage);
					writeVideo(writerObj,frame);
					close(PlotImage);
				end
			end
		end
		
		close(writerObj);
	
	elseif switcher==82
		VideoName           = 'firsttimeactive';
		mkdir([TimeStampedName '\\' VideoName]);
		writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
		writerObj.FrameRate = videofps;    % number of frame per second
		open(writerObj);
		%{
		for i=ttstart:9999
			tt=loadsinglelong([TimeStampedName '-Master-' 'tt' '.txt']);
			if i>tt
				break;
			elseif mod(i-1,frameskip+1)>0
				continue;
			end
			x_crack_bridge_firsttimeactive=loadmatrixfloat([TimeStampedName '-Slave-' 'x_crack_bridge_firsttimeactive' '-' int2txt(i) '.txt']);
			if length(CModel) == length('Wood_Schmidt17');
				if CModel == 'Wood_Schmidt17'
					if length(climit)==0
						climit(1)=min(min(x_crack_bridge_firsttimeactive));
						climit(2)=max(max(x_crack_bridge_firsttimeactive));
					else
						climit(1)=min(climit(1),min(min(x_crack_bridge_firsttimeactive)));
						climit(2)=max(climit(2),max(max(x_crack_bridge_firsttimeactive)));
					end
				end
			end
		end
		%}
		for i=ttstart:9999
%{
%switchable1
			load([TimeStampedName '\\' num2str(i) '.mat']);
%}
%switchable1
%[
%switchable1
			tt=loadsinglelong([TimeStampedName '-Master-' 'tt' '.txt']);
			if i>tt
				break;
			elseif mod(i-1,frameskip+1)>0
				continue;
			end
			x_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'x_sp' '-' int2txt(i) '.txt']);
			
			
			x_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'x_sp' '-' int2txt(i) '.txt']);
			F_sp=loadcellmatrixfloat([TimeStampedName '-Slave-' 'F_sp' '-' int2txt(i) '.txt']);
			thetacrack=loadmatrixfloat([TimeStampedName '-Slave-' 'thetacrack' '-' int2txt(i) '.txt']);
			x_crack=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crack' '-' int2txt(i) '.txt']);
			x_cracktop=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_cracktop' '-' int2txt(i) '.txt']);
			x_crackbot=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crackbot' '-' int2txt(i) '.txt']);
			DispPump=loadsinglefloat([TimeStampedName '-Slave-' 'DispPump' '-' int2txt(i) '.txt']);
			t_time=loadsinglefloat([TimeStampedName '-Slave-' 't_time' '-' int2txt(i) '.txt']);
			s_sp=loadmatrixfloat([TimeStampedName '-Slave-' 's_sp' '-' int2txt(i) '.txt']);
			v_ssp=loadmatrixfloat([TimeStampedName '-Slave-' 'v_ssp' '-' int2txt(i) '.txt']);
			r1_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r1_sp' '-' int2txt(i) '.txt']);
			r2_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r2_sp' '-' int2txt(i) '.txt']);
			E_acc=loadmatrixfloat([TimeStampedName '-Slave-' 'E_acc' '-' int2txt(i) '.txt']);
			x_crack_abs_force=loadmatrixfloat([TimeStampedName '-Slave-' 'x_crack_bridge_absforce' '-' int2txt(i) '.txt']);
			x_crack_bridge_firsttimeactive=loadmatrixfloat([TimeStampedName '-Slave-' 'x_crack_bridge_firsttimeactive' '-' int2txt(i) '.txt']);
%]
%switchable1			
			
			if length(CModel) == length('Wood_Schmidt17');
				if CModel == 'Wood_Schmidt17'
					[PlotImage]=Plot_Cohesive_dispi(x_crack_abs_force,x_crack_bridge_firsttimeactive,x_sp,x_crack,x_cracktop,x_crackbot,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,1,lp,plotignore,1,CasetoRun,refinementfactor);
					if length(climit)==0
						climit(1)=min(min(x_crack_bridge_firsttimeactive));
						climit(2)=max(max(x_crack_bridge_firsttimeactive));
					else
						climit(1)=min(climit(1),min(min(x_crack_bridge_firsttimeactive)));
						climit(2)=max(climit(2),max(max(x_crack_bridge_firsttimeactive)));
					end

					%saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
					saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
					frame = getframe(PlotImage);
					writeVideo(writerObj,frame);
					close(PlotImage);
				end
			end
		end
		
		close(writerObj);
	
	elseif switcher==83
		VideoName           = 'energy';
		mkdir([TimeStampedName '\\' VideoName]);
		writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
		writerObj.FrameRate = videofps;    % number of frame per second
		open(writerObj);
		x_crack_bridge_tt_first=loadsinglelong([TimeStampedName '-Master-' 'x_crack_bridge_tt_first' '.txt']);
		x_crack_bridge_tt_last=loadsinglelong([TimeStampedName '-Master-' 'x_crack_bridge_tt_last' '.txt']);
		%{
		for i=1:9999
			tt=loadsinglelong([TimeStampedName '-Master-' 'tt' '.txt']);
			if i>tt
				break;
			elseif mod(i-1,frameskip+1)>0
				continue;
			end
			x_crack_bridge_base_absdeltax=loadmatrixfloat([TimeStampedName '-Slave-' 'x_crack_bridge_base_absdeltax' '-' int2txt(i) '.txt']);
			if length(CModel) == length('Wood_Schmidt17');
				if CModel == 'Wood_Schmidt17'
					if length(climit)==0
						climit(1)=min(min(x_crack_bridge_base_absdeltax));
						climit(2)=max(max(x_crack_bridge_base_absdeltax));
					else
						climit(1)=min(climit(1),min(min(x_crack_bridge_base_absdeltax)));
						climit(2)=max(climit(2),max(max(x_crack_bridge_base_absdeltax)));
					end
				end
			end
		end
		%}
		for i=1:9999
%{
%switchable1
			load([TimeStampedName '\\' num2str(i) '.mat']);
%}
%switchable1
%[
%switchable1
			tt=loadsinglelong([TimeStampedName '-Master-' 'tt' '.txt']);
			if i>tt
				break;
			end
			energy_kinetic_value=loadsinglefloat([TimeStampedName '-Slave-' 'energy_kinetic_value' '-' int2txt(i) '.txt']);
			energy_strain_value=loadsinglefloat([TimeStampedName '-Slave-' 'energy_strain_value' '-' int2txt(i) '.txt']);
			energy_work_value=loadsinglefloat([TimeStampedName '-Slave-' 'energy_work_value' '-' int2txt(i) '.txt']);
			F_rollerY=loadmatrixfloat([TimeStampedName '-Slave-' 'F_rollerY' '-' int2txt(i) '.txt']);
			DispPump=loadsinglefloat([TimeStampedName '-Slave-' 'DispPump' '-' int2txt(i) '.txt']);
			t_time=loadsinglefloat([TimeStampedName '-Slave-' 't_time' '-' int2txt(i) '.txt']);
			TLD(i,1)=t_time;
			TLD(i,2)=0;
			TLD(i,3)=DispPump;
			energy.work(i)=energy_work_value;
			energy.strain(i)=energy_strain_value;
			energy.kinetic(i)=energy_kinetic_value;
			energy.dissipation(i)=energy_work_value-energy_strain_value-energy_kinetic_value;
%]
%switchable1			
			
		end
		PlotImage=figure;
		set(PlotImage,'visible','off');
		PlotImage=plot(TLD(:,3),energy.work,'DisplayName','BC Work','LineStyle','--');
		hold on
		PlotImage=plot(TLD(:,3),energy.strain,'DisplayName','Strain Energy','LineStyle',':');
		PlotImage=plot(TLD(:,3),energy.kinetic,'DisplayName','Kinetic Energy','LineStyle','-.');
		PlotImage=plot(TLD(:,3),energy.dissipation,'DisplayName','Dissipation');
		PlotImage=plot(TLD(x_crack_bridge_tt_first,3),energy.dissipation(x_crack_bridge_tt_first),'x','DisplayName','First Cohesion');
		PlotImage=plot(TLD(x_crack_bridge_tt_last,3),energy.dissipation(x_crack_bridge_tt_last),'x','DisplayName','Last Cohesion');
		legend show
		xlabel('Displacement (mm)');
		ylabel('Energy (Nmm)');
		saveas(PlotImage,[TimeStampedName '\\' VideoName '\\EnergyCurve.png']);
		close(gcf);
	elseif switcher==84
		VideoName           = 'disp-time';
		mkdir([TimeStampedName '\\' VideoName]);
		writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
		writerObj.FrameRate = videofps;    % number of frame per second
		open(writerObj);
		%{
		for i=1:9999
			tt=loadsinglelong([TimeStampedName '-Master-' 'tt' '.txt']);
			if i>tt
				break;
			elseif mod(i-1,frameskip+1)>0
				continue;
			end
			x_crack_bridge_base_absdeltax=loadmatrixfloat([TimeStampedName '-Slave-' 'x_crack_bridge_base_absdeltax' '-' int2txt(i) '.txt']);
			if length(CModel) == length('Wood_Schmidt17');
				if CModel == 'Wood_Schmidt17'
					if length(climit)==0
						climit(1)=min(min(x_crack_bridge_base_absdeltax));
						climit(2)=max(max(x_crack_bridge_base_absdeltax));
					else
						climit(1)=min(climit(1),min(min(x_crack_bridge_base_absdeltax)));
						climit(2)=max(climit(2),max(max(x_crack_bridge_base_absdeltax)));
					end
				end
			end
		end
		%}
		for i=1:9999
%{
%switchable1
			load([TimeStampedName '\\' num2str(i) '.mat']);
%}
%switchable1
%[
%switchable1
			tt=loadsinglelong([TimeStampedName '-Master-' 'tt' '.txt']);
			if i>tt
				break;
			end
			F_rollerY=loadmatrixfloat([TimeStampedName '-Slave-' 'F_rollerY' '-' int2txt(i) '.txt']);
			DispPump=loadsinglefloat([TimeStampedName '-Slave-' 'DispPump' '-' int2txt(i) '.txt']);
			t_time=loadsinglefloat([TimeStampedName '-Slave-' 't_time' '-' int2txt(i) '.txt']);
			TLD(i,1)=t_time;
			TLD(i,2)=sum(sum(F_rollerY));
			TLD(i,3)=DispPump;
%]
%switchable1			
			
		end
		PlotImage=figure;
		set(PlotImage,'visible','off');
		PlotImage=plot(TLD(:,1),TLD(:,3));
		hold on;
		xlabel('Time (s)');
		ylabel('Displacement (mm)');
		saveas(PlotImage,[TimeStampedName '\\' VideoName '\\LDCurve.png']);
		close(gcf);
	
	elseif switcher==81
		VideoName           = 'load-displacement';
		mkdir([TimeStampedName '\\' VideoName]);
		writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
		writerObj.FrameRate = videofps;    % number of frame per second
		open(writerObj);
		%{
		for i=1:9999
			tt=loadsinglelong([TimeStampedName '-Master-' 'tt' '.txt']);
			if i>tt
				break;
			elseif mod(i-1,frameskip+1)>0
				continue;
			end
			x_crack_bridge_base_absdeltax=loadmatrixfloat([TimeStampedName '-Slave-' 'x_crack_bridge_base_absdeltax' '-' int2txt(i) '.txt']);
			if length(CModel) == length('Wood_Schmidt17');
				if CModel == 'Wood_Schmidt17'
					if length(climit)==0
						climit(1)=min(min(x_crack_bridge_base_absdeltax));
						climit(2)=max(max(x_crack_bridge_base_absdeltax));
					else
						climit(1)=min(climit(1),min(min(x_crack_bridge_base_absdeltax)));
						climit(2)=max(climit(2),max(max(x_crack_bridge_base_absdeltax)));
					end
				end
			end
		end
		%}
		for i=1:9999
%{
%switchable1
			load([TimeStampedName '\\' num2str(i) '.mat']);
%}
%switchable1
%[
%switchable1
			tt=loadsinglelong([TimeStampedName '-Master-' 'tt' '.txt']);
			if i>tt
				break;
			end
			F_rollerY=loadmatrixfloat([TimeStampedName '-Slave-' 'F_rollerY' '-' int2txt(i) '.txt']);
			DispPump=loadsinglefloat([TimeStampedName '-Slave-' 'DispPump' '-' int2txt(i) '.txt']);
			t_time=loadsinglefloat([TimeStampedName '-Slave-' 't_time' '-' int2txt(i) '.txt']);
			TLD(i,1)=t_time;
			TLD(i,2)=sum(sum(F_rollerY));
			TLD(i,3)=DispPump;
%]
%switchable1			
			
		end
		PlotImage=figure;
		set(PlotImage,'visible','off');
		PlotImage=plot(TLD(:,3),TLD(:,2));
		hold on;
		xlabel('Displacement (mm)');
		ylabel('Load (N)');
		saveas(PlotImage,[TimeStampedName '\\' VideoName '\\LDCurve.png']);
		close(gcf);
	
	elseif switcher==68
		VideoName           = 's_max_node_multiline';
		mkdir([TimeStampedName '\\' VideoName]);
		writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
		writerObj.FrameRate = videofps;    % number of frame per second
		open(writerObj);
		
		for i=ttstart:9999
%{
%switchable1
			load([TimeStampedName '\\' num2str(i) '.mat']);
%}
%switchable1
%[
%switchable1			
			tt=loadsinglelong([TimeStampedName '-Master-' 'tt' '.txt']);
			if i>tt
				break;
			elseif mod(i-1,frameskip+1)>0
				continue;
			end
			x_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'x_sp' '-' int2txt(i) '.txt']);
			F_sp=loadcellmatrixfloat([TimeStampedName '-Slave-' 'F_sp' '-' int2txt(i) '.txt']);
			thetacrack=loadmatrixfloat([TimeStampedName '-Slave-' 'thetacrack' '-' int2txt(i) '.txt']);
			x_crack=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crack' '-' int2txt(i) '.txt']);
			x_cracktop=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_cracktop' '-' int2txt(i) '.txt']);
			x_crackbot=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crackbot' '-' int2txt(i) '.txt']);
			DispPump=loadsinglefloat([TimeStampedName '-Slave-' 'DispPump' '-' int2txt(i) '.txt']);
			t_time=loadsinglefloat([TimeStampedName '-Slave-' 't_time' '-' int2txt(i) '.txt']);
			s_si=loadmatrix3float([TimeStampedName '-Slave-' 's_si' '-' int2txt(i) '.txt']);
			%s_si_comb=loadmatrixfloat([TimeStampedName '-Slave-' 's_si_comb' '-' int2txt(i) '.txt']);
			v_ssp=loadmatrixfloat([TimeStampedName '-Slave-' 'v_ssp' '-' int2txt(i) '.txt']);
			r1_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r1_sp' '-' int2txt(i) '.txt']);
			r2_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r2_sp' '-' int2txt(i) '.txt']);
			E_acc=loadmatrixfloat([TimeStampedName '-Slave-' 'E_acc' '-' int2txt(i) '.txt']);
			s_tip_dump=loadmatrixfloat([TimeStampedName '-Slave-' 's_tip_dump' '-' int2txt(i) '.txt']);
			x_tip_dump=loadmatrixfloat([TimeStampedName '-Slave-' 'x_tip_dump' '-' int2txt(i) '.txt']);
%]
%switchable1
			
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,s_si_comb_max,~]=Plot_Final2_principalclimit_directions_node(x_crack,x_cracktop,x_crackbot,[LOC;x_tip_dump],le,d_sp,e_sp,v_ssp,niCount+size(x_tip_dump,1),r1_sp,r2_sp,E_acc,[s_si(:,:,1);s_tip_dump],climit,1,1,CasetoRun,refinementfactor);
                    %if length(climit)==0
                    %    climit(1)=min(s_si_comb_max);
                    %    climit(2)=max(s_si_comb_max);
                    %else
                    %    climit(1)=min(climit(1),min(s_si_comb_max));
                    %    climit(2)=max(climit(2),max(s_si_comb_max));
                    %end
%{
                end
            end
		end
		for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,s_sp_max,~]=Plot_Final2_principalclimit_directions(x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,1,lp,plotignore,1);
%}
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                    saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                    frame = getframe(PlotImage);
                    writeVideo(writerObj,frame);
                    close(PlotImage);
                end
            end
		end
		
		close(writerObj);
	elseif switcher==76
		VideoName           = 's_max_node_comb_multiline';
		mkdir([TimeStampedName '\\' VideoName]);
		writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
		writerObj.FrameRate = videofps;    % number of frame per second
		open(writerObj);
		
		for i=ttstart:9999
%{
%switchable1
			load([TimeStampedName '\\' num2str(i) '.mat']);
%}
%switchable1
%[
%switchable1			
			tt=loadsinglelong([TimeStampedName '-Master-' 'tt' '.txt']);
			if i>tt
				break;
			elseif mod(i-1,frameskip+1)>0
				continue;
			end
			x_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'x_sp' '-' int2txt(i) '.txt']);
			F_sp=loadcellmatrixfloat([TimeStampedName '-Slave-' 'F_sp' '-' int2txt(i) '.txt']);
			thetacrack=loadmatrixfloat([TimeStampedName '-Slave-' 'thetacrack' '-' int2txt(i) '.txt']);
			x_crack=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crack' '-' int2txt(i) '.txt']);
			x_cracktop=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_cracktop' '-' int2txt(i) '.txt']);
			x_crackbot=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crackbot' '-' int2txt(i) '.txt']);
			DispPump=loadsinglefloat([TimeStampedName '-Slave-' 'DispPump' '-' int2txt(i) '.txt']);
			t_time=loadsinglefloat([TimeStampedName '-Slave-' 't_time' '-' int2txt(i) '.txt']);
			%s_si=loadmatrix3float([TimeStampedName '-Slave-' 's_si' '-' int2txt(i) '.txt']);
			s_si_comb=loadmatrixfloat([TimeStampedName '-Slave-' 's_si_comb' '-' int2txt(i) '.txt']);
			v_ssp=loadmatrixfloat([TimeStampedName '-Slave-' 'v_ssp' '-' int2txt(i) '.txt']);
			r1_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r1_sp' '-' int2txt(i) '.txt']);
			r2_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r2_sp' '-' int2txt(i) '.txt']);
			E_acc=loadmatrixfloat([TimeStampedName '-Slave-' 'E_acc' '-' int2txt(i) '.txt']);
			s_tip_dump=loadmatrixfloat([TimeStampedName '-Slave-' 's_tip_dump' '-' int2txt(i) '.txt']);
			x_tip_dump=loadmatrixfloat([TimeStampedName '-Slave-' 'x_tip_dump' '-' int2txt(i) '.txt']);
%]
%switchable1
			
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,s_si_comb_max,~]=Plot_Final2_principalclimit_directions_node(x_crack,x_cracktop,x_crackbot,[LOC;x_tip_dump],le,d_sp,e_sp,v_ssp,niCount+size(x_tip_dump,1),r1_sp,r2_sp,E_acc,[s_si_comb;s_tip_dump],climit,1,1,CasetoRun,refinementfactor);
                    %if length(climit)==0
                    %    climit(1)=min(s_si_comb_max);
                    %    climit(2)=max(s_si_comb_max);
                    %else
                    %    climit(1)=min(climit(1),min(s_si_comb_max));
                    %    climit(2)=max(climit(2),max(s_si_comb_max));
                    %end
%{
                end
            end
		end
		for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,s_sp_max,~]=Plot_Final2_principalclimit_directions(x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,1,lp,plotignore,1);
%}
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                    saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                    frame = getframe(PlotImage);
                    writeVideo(writerObj,frame);
                    close(PlotImage);
                end
            end
		end
		
		close(writerObj);
	elseif switcher==72
		VideoName           = 's_max_node_proppath';
		mkdir([TimeStampedName '\\' VideoName]);
		writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
		writerObj.FrameRate = videofps;    % number of frame per second
		open(writerObj);
		
		for i=ttstart:9999
%{
%switchable1
			load([TimeStampedName '\\' num2str(i) '.mat']);
%}
%switchable1
%[
%switchable1			
			tt=loadsinglelong([TimeStampedName '-Master-' 'tt' '.txt']);
			if i>tt
				break;
			elseif mod(i-1,frameskip+1)>0
				continue;
			end
			x_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'x_sp' '-' int2txt(i) '.txt']);
			F_sp=loadcellmatrixfloat([TimeStampedName '-Slave-' 'F_sp' '-' int2txt(i) '.txt']);
			thetacrack=loadmatrixfloat([TimeStampedName '-Slave-' 'thetacrack' '-' int2txt(i) '.txt']);
			x_crack=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crack' '-' int2txt(i) '.txt']);
			x_cracktop=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_cracktop' '-' int2txt(i) '.txt']);
			x_crackbot=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crackbot' '-' int2txt(i) '.txt']);
			DispPump=loadsinglefloat([TimeStampedName '-Slave-' 'DispPump' '-' int2txt(i) '.txt']);
			t_time=loadsinglefloat([TimeStampedName '-Slave-' 't_time' '-' int2txt(i) '.txt']);
			%s_si=loadmatrix3float([TimeStampedName '-Slave-' 's_si' '-' int2txt(i) '.txt']);
			s_si_comb=loadmatrixfloat([TimeStampedName '-Slave-' 's_si_comb' '-' int2txt(i) '.txt']);
			v_ssp=loadmatrixfloat([TimeStampedName '-Slave-' 'v_ssp' '-' int2txt(i) '.txt']);
			r1_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r1_sp' '-' int2txt(i) '.txt']);
			r2_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r2_sp' '-' int2txt(i) '.txt']);
			E_acc=loadmatrixfloat([TimeStampedName '-Slave-' 'E_acc' '-' int2txt(i) '.txt']);
			s_tip_dump=loadmatrixfloat([TimeStampedName '-Slave-' 's_tip_dump' '-' int2txt(i) '.txt']);
			x_tip_dump=loadmatrixfloat([TimeStampedName '-Slave-' 'x_tip_dump' '-' int2txt(i) '.txt']);
			r_propdirweighted_dump=loadmatrixfloat([TimeStampedName '-Slave-' 'r_propdirweighted_dump' '-' int2txt(i) '.txt']);
%]
%switchable1
			
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,s_si_comb_max,~]=Plot_principaldirs_node_proppath(x_crack,x_cracktop,x_crackbot,[LOC;x_tip_dump],le,d_sp,e_sp,v_ssp,niCount+size(x_tip_dump,1),r1_sp,r2_sp,E_acc,[s_si_comb;s_tip_dump],climit,1,1,CasetoRun,refinementfactor,x_tip_dump,r_propdirweighted_dump);
                    %if length(climit)==0
                    %    climit(1)=min(s_si_comb_max);
                    %    climit(2)=max(s_si_comb_max);
                    %else
                    %    climit(1)=min(climit(1),min(s_si_comb_max));
                    %    climit(2)=max(climit(2),max(s_si_comb_max));
                    %end
%{
                end
            end
		end
		for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,s_sp_max,~]=Plot_Final2_principalclimit_directions(x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,1,lp,plotignore,1);
%}
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                    saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                    frame = getframe(PlotImage);
                    writeVideo(writerObj,frame);
                    close(PlotImage);
                end
            end
		end
		
		close(writerObj);
	elseif switcher==73
		VideoName           = 's_min_node_proppath';
		mkdir([TimeStampedName '\\' VideoName]);
		writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
		writerObj.FrameRate = videofps;    % number of frame per second
		open(writerObj);
		
		for i=ttstart:9999
%{
%switchable1
			load([TimeStampedName '\\' num2str(i) '.mat']);
%}
%switchable1
%[
%switchable1			
			tt=loadsinglelong([TimeStampedName '-Master-' 'tt' '.txt']);
			if i>tt
				break;
			elseif mod(i-1,frameskip+1)>0
				continue;
			end
			x_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'x_sp' '-' int2txt(i) '.txt']);
			F_sp=loadcellmatrixfloat([TimeStampedName '-Slave-' 'F_sp' '-' int2txt(i) '.txt']);
			thetacrack=loadmatrixfloat([TimeStampedName '-Slave-' 'thetacrack' '-' int2txt(i) '.txt']);
			x_crack=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crack' '-' int2txt(i) '.txt']);
			x_cracktop=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_cracktop' '-' int2txt(i) '.txt']);
			x_crackbot=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crackbot' '-' int2txt(i) '.txt']);
			DispPump=loadsinglefloat([TimeStampedName '-Slave-' 'DispPump' '-' int2txt(i) '.txt']);
			t_time=loadsinglefloat([TimeStampedName '-Slave-' 't_time' '-' int2txt(i) '.txt']);
			%s_si=loadmatrix3float([TimeStampedName '-Slave-' 's_si' '-' int2txt(i) '.txt']);
			s_si_comb=loadmatrixfloat([TimeStampedName '-Slave-' 's_si_comb' '-' int2txt(i) '.txt']);
			v_ssp=loadmatrixfloat([TimeStampedName '-Slave-' 'v_ssp' '-' int2txt(i) '.txt']);
			r1_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r1_sp' '-' int2txt(i) '.txt']);
			r2_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r2_sp' '-' int2txt(i) '.txt']);
			E_acc=loadmatrixfloat([TimeStampedName '-Slave-' 'E_acc' '-' int2txt(i) '.txt']);
			s_tip_dump=loadmatrixfloat([TimeStampedName '-Slave-' 's_tip_dump' '-' int2txt(i) '.txt']);
			x_tip_dump=loadmatrixfloat([TimeStampedName '-Slave-' 'x_tip_dump' '-' int2txt(i) '.txt']);
			r_propdirweighted_dump=loadmatrixfloat([TimeStampedName '-Slave-' 'r_propdirweighted_dump' '-' int2txt(i) '.txt']);
%]
%switchable1
			
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,DUMMY2,s_si_comb_min,~]=Plot_principaldirs_node_proppath(x_crack,x_cracktop,x_crackbot,[LOC;x_tip_dump],le,d_sp,e_sp,v_ssp,niCount+size(x_tip_dump,1),r1_sp,r2_sp,E_acc,[s_si_comb;s_tip_dump],climit,2,1,CasetoRun,refinementfactor,x_tip_dump,r_propdirweighted_dump);
                    %if length(climit)==0
                    %    climit(1)=min(s_si_comb_min);
                    %    climit(2)=max(s_si_comb_min);
                    %else
                    %    climit(1)=min(climit(1),min(s_si_comb_min));
                    %    climit(2)=max(climit(2),max(s_si_comb_min));
                    %end
%{
                end
            end
		end
		for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,s_sp_max,~]=Plot_Final2_principalclimit_directions(x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,1,lp,plotignore,1);
%}
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                    saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                    frame = getframe(PlotImage);
                    writeVideo(writerObj,frame);
                    close(PlotImage);
                end
            end
		end
		
		close(writerObj);
	elseif switcher==71
		VideoName           = 's_si_x';
		mkdir([TimeStampedName '\\' VideoName]);
		writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
		writerObj.FrameRate = videofps;    % number of frame per second
		open(writerObj);
		
		for i=ttstart:9999
%{
%switchable1
			load([TimeStampedName '\\' num2str(i) '.mat']);
%}
%switchable1
%[
%switchable1			
			tt=loadsinglelong([TimeStampedName '-Master-' 'tt' '.txt']);
			if i>tt
				break;
			elseif mod(i-1,frameskip+1)>0
				continue;
			end
			x_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'x_sp' '-' int2txt(i) '.txt']);
			F_sp=loadcellmatrixfloat([TimeStampedName '-Slave-' 'F_sp' '-' int2txt(i) '.txt']);
			thetacrack=loadmatrixfloat([TimeStampedName '-Slave-' 'thetacrack' '-' int2txt(i) '.txt']);
			x_crack=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crack' '-' int2txt(i) '.txt']);
			x_cracktop=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_cracktop' '-' int2txt(i) '.txt']);
			x_crackbot=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crackbot' '-' int2txt(i) '.txt']);
			DispPump=loadsinglefloat([TimeStampedName '-Slave-' 'DispPump' '-' int2txt(i) '.txt']);
			t_time=loadsinglefloat([TimeStampedName '-Slave-' 't_time' '-' int2txt(i) '.txt']);
			%s_si=loadmatrix3float([TimeStampedName '-Slave-' 's_si' '-' int2txt(i) '.txt']);
			s_si_comb=loadmatrixfloat([TimeStampedName '-Slave-' 's_si_comb' '-' int2txt(i) '.txt']);
			v_ssp=loadmatrixfloat([TimeStampedName '-Slave-' 'v_ssp' '-' int2txt(i) '.txt']);
			r1_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r1_sp' '-' int2txt(i) '.txt']);
			r2_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r2_sp' '-' int2txt(i) '.txt']);
			E_acc=loadmatrixfloat([TimeStampedName '-Slave-' 'E_acc' '-' int2txt(i) '.txt']);
			s_tip_dump=loadmatrixfloat([TimeStampedName '-Slave-' 's_tip_dump' '-' int2txt(i) '.txt']);
			x_tip_dump=loadmatrixfloat([TimeStampedName '-Slave-' 'x_tip_dump' '-' int2txt(i) '.txt']);
%]
%switchable1
			
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,s_si_x,~]=Plot_Final2_xyz_node(x_crack,x_cracktop,x_crackbot,[LOC;x_tip_dump],le,d_sp,e_sp,v_ssp,niCount+size(x_tip_dump,1),r1_sp,r2_sp,E_acc,[s_si_comb;s_tip_dump],climit,1,1,CasetoRun,refinementfactor);
                    %if length(climit)==0
                    %    climit(1)=min(s_si_x);
                    %    climit(2)=max(s_si_x);
                    %else
                    %    climit(1)=min(climit(1),min(s_si_x));
                    %    climit(2)=max(climit(2),max(s_si_x));
                    %end
%{
                end
            end
		end
		for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,s_sp_max,~]=Plot_Final2_principalclimit_directions(x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,1,lp,plotignore,1);
%}
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                    saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                    frame = getframe(PlotImage);
                    writeVideo(writerObj,frame);
                    close(PlotImage);
                end
            end
		end
		
		close(writerObj);
	elseif switcher==74
		VideoName           = 'v_sp_x';
		mkdir([TimeStampedName '\\' VideoName]);
		writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
		writerObj.FrameRate = videofps;    % number of frame per second
		open(writerObj);
		
		for i=ttstart:9999
%{
%switchable1
			load([TimeStampedName '\\' num2str(i) '.mat']);
%}
%switchable1
%[
%switchable1			
			tt=loadsinglelong([TimeStampedName '-Master-' 'tt' '.txt']);
			if i>tt
				break;
			elseif mod(i-1,frameskip+1)>0
				continue;
			end
			x_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'x_sp' '-' int2txt(i) '.txt']);
			F_sp=loadcellmatrixfloat([TimeStampedName '-Slave-' 'F_sp' '-' int2txt(i) '.txt']);
			thetacrack=loadmatrixfloat([TimeStampedName '-Slave-' 'thetacrack' '-' int2txt(i) '.txt']);
			x_crack=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crack' '-' int2txt(i) '.txt']);
			x_cracktop=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_cracktop' '-' int2txt(i) '.txt']);
			x_crackbot=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crackbot' '-' int2txt(i) '.txt']);
			DispPump=loadsinglefloat([TimeStampedName '-Slave-' 'DispPump' '-' int2txt(i) '.txt']);
			t_time=loadsinglefloat([TimeStampedName '-Slave-' 't_time' '-' int2txt(i) '.txt']);
			%s_si=loadmatrix3float([TimeStampedName '-Slave-' 's_si' '-' int2txt(i) '.txt']);
			s_si_comb=loadmatrixfloat([TimeStampedName '-Slave-' 's_si_comb' '-' int2txt(i) '.txt']);
			v_ssp=loadmatrixfloat([TimeStampedName '-Slave-' 'v_ssp' '-' int2txt(i) '.txt']);
			r1_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r1_sp' '-' int2txt(i) '.txt']);
			r2_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r2_sp' '-' int2txt(i) '.txt']);
			E_acc=loadmatrixfloat([TimeStampedName '-Slave-' 'E_acc' '-' int2txt(i) '.txt']);
			s_tip_dump=loadmatrixfloat([TimeStampedName '-Slave-' 's_tip_dump' '-' int2txt(i) '.txt']);
			x_tip_dump=loadmatrixfloat([TimeStampedName '-Slave-' 'x_tip_dump' '-' int2txt(i) '.txt']);
%]
%switchable1
			
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,s_si_x,~]=Plot_Final2_xyz_particle(x_crack,x_cracktop,x_crackbot,x_sp,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,v_ssp,climit,1,1,CasetoRun,refinementfactor);
                    %if length(climit)==0
                    %    climit(1)=min(s_si_x);
                    %    climit(2)=max(s_si_x);
                    %else
                    %    climit(1)=min(climit(1),min(s_si_x));
                    %    climit(2)=max(climit(2),max(s_si_x));
                    %end
%{
                end
            end
		end
		for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,s_sp_max,~]=Plot_Final2_principalclimit_directions(x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,1,lp,plotignore,1);
%}
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                    saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                    frame = getframe(PlotImage);
                    writeVideo(writerObj,frame);
                    close(PlotImage);
                end
            end
		end
		
		close(writerObj);
	elseif switcher==75
		VideoName           = 'u_sp_y';
		mkdir([TimeStampedName '\\' VideoName]);
		writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
		writerObj.FrameRate = videofps;    % number of frame per second
		open(writerObj);
		
		for i=ttstart:9999
%{
%switchable1
			load([TimeStampedName '\\' num2str(i) '.mat']);
%}
%switchable1
%[
%switchable1			
			tt=loadsinglelong([TimeStampedName '-Master-' 'tt' '.txt']);
			if i>tt
				break;
			elseif mod(i-1,frameskip+1)>0
				continue;
			end
			x_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'x_sp' '-' int2txt(i) '.txt']);
			F_sp=loadcellmatrixfloat([TimeStampedName '-Slave-' 'F_sp' '-' int2txt(i) '.txt']);
			thetacrack=loadmatrixfloat([TimeStampedName '-Slave-' 'thetacrack' '-' int2txt(i) '.txt']);
			x_crack=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crack' '-' int2txt(i) '.txt']);
			x_cracktop=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_cracktop' '-' int2txt(i) '.txt']);
			x_crackbot=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crackbot' '-' int2txt(i) '.txt']);
			DispPump=loadsinglefloat([TimeStampedName '-Slave-' 'DispPump' '-' int2txt(i) '.txt']);
			t_time=loadsinglefloat([TimeStampedName '-Slave-' 't_time' '-' int2txt(i) '.txt']);
			%s_si=loadmatrix3float([TimeStampedName '-Slave-' 's_si' '-' int2txt(i) '.txt']);
			s_si_comb=loadmatrixfloat([TimeStampedName '-Slave-' 's_si_comb' '-' int2txt(i) '.txt']);
			v_ssp=loadmatrixfloat([TimeStampedName '-Slave-' 'v_ssp' '-' int2txt(i) '.txt']);
			r1_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r1_sp' '-' int2txt(i) '.txt']);
			r2_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r2_sp' '-' int2txt(i) '.txt']);
			E_acc=loadmatrixfloat([TimeStampedName '-Slave-' 'E_acc' '-' int2txt(i) '.txt']);
			s_tip_dump=loadmatrixfloat([TimeStampedName '-Slave-' 's_tip_dump' '-' int2txt(i) '.txt']);
			x_tip_dump=loadmatrixfloat([TimeStampedName '-Slave-' 'x_tip_dump' '-' int2txt(i) '.txt']);
			u_sp=x_sp-x_spo;
%]
%switchable1
			
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,s_si_x,~]=Plot_Final2_xyz_particle(x_crack,x_cracktop,x_crackbot,x_sp,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,u_sp,climit,2,1,CasetoRun,refinementfactor);
                    %if length(climit)==0
                    %    climit(1)=min(s_si_x);
                    %    climit(2)=max(s_si_x);
                    %else
                    %    climit(1)=min(climit(1),min(s_si_x));
                    %    climit(2)=max(climit(2),max(s_si_x));
                    %end
%{
                end
            end
		end
		for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,s_sp_max,~]=Plot_Final2_principalclimit_directions(x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,1,lp,plotignore,1);
%}
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                    saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                    frame = getframe(PlotImage);
                    writeVideo(writerObj,frame);
                    close(PlotImage);
                end
            end
		end
		
		close(writerObj);
	elseif switcher==77
		VideoName           = 'u_sp_x';
		mkdir([TimeStampedName '\\' VideoName]);
		writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
		writerObj.FrameRate = videofps;    % number of frame per second
		open(writerObj);
		
		for i=ttstart:9999
%{
%switchable1
			load([TimeStampedName '\\' num2str(i) '.mat']);
%}
%switchable1
%[
%switchable1			
			tt=loadsinglelong([TimeStampedName '-Master-' 'tt' '.txt']);
			if i>tt
				break;
			elseif mod(i-1,frameskip+1)>0
				continue;
			end
			x_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'x_sp' '-' int2txt(i) '.txt']);
			F_sp=loadcellmatrixfloat([TimeStampedName '-Slave-' 'F_sp' '-' int2txt(i) '.txt']);
			thetacrack=loadmatrixfloat([TimeStampedName '-Slave-' 'thetacrack' '-' int2txt(i) '.txt']);
			x_crack=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crack' '-' int2txt(i) '.txt']);
			x_cracktop=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_cracktop' '-' int2txt(i) '.txt']);
			x_crackbot=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crackbot' '-' int2txt(i) '.txt']);
			DispPump=loadsinglefloat([TimeStampedName '-Slave-' 'DispPump' '-' int2txt(i) '.txt']);
			t_time=loadsinglefloat([TimeStampedName '-Slave-' 't_time' '-' int2txt(i) '.txt']);
			%s_si=loadmatrix3float([TimeStampedName '-Slave-' 's_si' '-' int2txt(i) '.txt']);
			s_si_comb=loadmatrixfloat([TimeStampedName '-Slave-' 's_si_comb' '-' int2txt(i) '.txt']);
			v_ssp=loadmatrixfloat([TimeStampedName '-Slave-' 'v_ssp' '-' int2txt(i) '.txt']);
			r1_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r1_sp' '-' int2txt(i) '.txt']);
			r2_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r2_sp' '-' int2txt(i) '.txt']);
			E_acc=loadmatrixfloat([TimeStampedName '-Slave-' 'E_acc' '-' int2txt(i) '.txt']);
			s_tip_dump=loadmatrixfloat([TimeStampedName '-Slave-' 's_tip_dump' '-' int2txt(i) '.txt']);
			x_tip_dump=loadmatrixfloat([TimeStampedName '-Slave-' 'x_tip_dump' '-' int2txt(i) '.txt']);
			u_sp=x_sp-x_spo;
%]
%switchable1
			
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,s_si_x,~]=Plot_Final2_xyz_particle(x_crack,x_cracktop,x_crackbot,x_sp,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,u_sp,climit,1,1,CasetoRun,refinementfactor);
                    %if length(climit)==0
                    %    climit(1)=min(s_si_x);
                    %    climit(2)=max(s_si_x);
                    %else
                    %    climit(1)=min(climit(1),min(s_si_x));
                    %    climit(2)=max(climit(2),max(s_si_x));
                    %end
%{
                end
            end
		end
		for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,s_sp_max,~]=Plot_Final2_principalclimit_directions(x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,1,lp,plotignore,1);
%}
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                    saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                    frame = getframe(PlotImage);
                    writeVideo(writerObj,frame);
                    close(PlotImage);
                end
            end
		end
		
		close(writerObj);
	elseif switcher==69
		VideoName           = 's_max_gauss_multiline';
		mkdir([TimeStampedName '\\' VideoName]);
		writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
		writerObj.FrameRate = videofps;    % number of frame per second
		open(writerObj);
		
		for i=ttstart:9999
%{
%switchable1
			load([TimeStampedName '\\' num2str(i) '.mat']);
%}
%switchable1
%[
%switchable1			
			tt=loadsinglelong([TimeStampedName '-Master-' 'tt' '.txt']);
			if i>tt
				break;
			end
			x_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'x_sp' '-' int2txt(i) '.txt']);
			F_sp=loadcellmatrixfloat([TimeStampedName '-Slave-' 'F_sp' '-' int2txt(i) '.txt']);
			thetacrack=loadmatrixfloat([TimeStampedName '-Slave-' 'thetacrack' '-' int2txt(i) '.txt']);
			x_crack=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crack' '-' int2txt(i) '.txt']);
			x_cracktop=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_cracktop' '-' int2txt(i) '.txt']);
			x_crackbot=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crackbot' '-' int2txt(i) '.txt']);
			DispPump=loadsinglefloat([TimeStampedName '-Slave-' 'DispPump' '-' int2txt(i) '.txt']);
			t_time=loadsinglefloat([TimeStampedName '-Slave-' 't_time' '-' int2txt(i) '.txt']);
			%s_si=loadmatrix3float([TimeStampedName '-Slave-' 's_si' '-' int2txt(i) '.txt']);
			%s_si_comb=loadmatrixfloat([TimeStampedName '-Slave-' 's_si_comb' '-' int2txt(i) '.txt']);
			v_ssp=loadmatrixfloat([TimeStampedName '-Slave-' 'v_ssp' '-' int2txt(i) '.txt']);
			r1_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r1_sp' '-' int2txt(i) '.txt']);
			r2_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r2_sp' '-' int2txt(i) '.txt']);
			E_acc=loadmatrixfloat([TimeStampedName '-Slave-' 'E_acc' '-' int2txt(i) '.txt']);
			s_tip_dump=loadmatrixfloat([TimeStampedName '-Slave-' 's_tip_dump' '-' int2txt(i) '.txt']);
			x_tip_dump=loadmatrixfloat([TimeStampedName '-Slave-' 'x_tip_dump' '-' int2txt(i) '.txt']);
			s_gauss_dump=loadmatrixfloat([TimeStampedName '-Slave-' 's_gauss_dump' '-' int2txt(i) '.txt']);
			x_gauss_dump=loadmatrixfloat([TimeStampedName '-Slave-' 'x_gauss_dump' '-' int2txt(i) '.txt']);
%]
%switchable1
			
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,s_si_comb_max,~]=Plot_Final2_principalclimit_directions_node(x_crack,x_cracktop,x_crackbot,[x_gauss_dump;x_tip_dump],le,d_sp,e_sp,v_ssp,size(x_gauss_dump,1)+size(x_tip_dump,1),r1_sp,r2_sp,E_acc,[s_gauss_dump;s_tip_dump],climit,1,1,CasetoRun,refinementfactor);
                    %if length(climit)==0
                    %    climit(1)=min(s_si_comb_max);
                    %    climit(2)=max(s_si_comb_max);
                    %else
                    %    climit(1)=min(climit(1),min(s_si_comb_max));
                    %    climit(2)=max(climit(2),max(s_si_comb_max));
                    %end
%{
                end
            end
		end
		for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,s_sp_max,~]=Plot_Final2_principalclimit_directions(x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,1,lp,plotignore,1);
%}
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                    saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                    frame = getframe(PlotImage);
                    writeVideo(writerObj,frame);
                    close(PlotImage);
                end
            end
		end
		
		close(writerObj);
	elseif switcher==70
		VideoName           = 's_si_K1';
		mkdir([TimeStampedName '\\' VideoName]);
		writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
		writerObj.FrameRate = videofps;    % number of frame per second
		open(writerObj);
		
		for i=ttstart:9999
%{
%switchable1
			load([TimeStampedName '\\' num2str(i) '.mat']);
%}
%switchable1
%[
%switchable1			
			tt=loadsinglelong([TimeStampedName '-Master-' 'tt' '.txt']);
			if i>tt
				break;
			end
			x_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'x_sp' '-' int2txt(i) '.txt']);
			F_sp=loadcellmatrixfloat([TimeStampedName '-Slave-' 'F_sp' '-' int2txt(i) '.txt']);
			thetacrack=loadmatrixfloat([TimeStampedName '-Slave-' 'thetacrack' '-' int2txt(i) '.txt']);
			x_crack=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crack' '-' int2txt(i) '.txt']);
			x_cracktop=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_cracktop' '-' int2txt(i) '.txt']);
			x_crackbot=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crackbot' '-' int2txt(i) '.txt']);
			DispPump=loadsinglefloat([TimeStampedName '-Slave-' 'DispPump' '-' int2txt(i) '.txt']);
			t_time=loadsinglefloat([TimeStampedName '-Slave-' 't_time' '-' int2txt(i) '.txt']);
			%s_si=loadmatrix3float([TimeStampedName '-Slave-' 's_si' '-' int2txt(i) '.txt']);
			s_si_K1=loadmatrixfloat([TimeStampedName '-Slave-' 's_si_K1' '-' int2txt(i) '.txt']);
			v_ssp=loadmatrixfloat([TimeStampedName '-Slave-' 'v_ssp' '-' int2txt(i) '.txt']);
			r1_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r1_sp' '-' int2txt(i) '.txt']);
			r2_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r2_sp' '-' int2txt(i) '.txt']);
			E_acc=loadmatrixfloat([TimeStampedName '-Slave-' 'E_acc' '-' int2txt(i) '.txt']);
			s_tip_K1_dump=loadmatrixfloat([TimeStampedName '-Slave-' 's_tip_K1_dump' '-' int2txt(i) '.txt']);
			x_tip_dump=loadmatrixfloat([TimeStampedName '-Slave-' 'x_tip_dump' '-' int2txt(i) '.txt']);
%]
%switchable1
			
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,s_si_comb_max,~]=Plot_Final2_principalclimit_directions_node(x_crack,x_cracktop,x_crackbot,[LOC;x_tip_dump],le,d_sp,e_sp,v_ssp,niCount+size(x_tip_dump,1),r1_sp,r2_sp,E_acc,[s_si_K1;s_tip_K1_dump],climit,1,1,CasetoRun,refinementfactor);
                    %if length(climit)==0
                    %    climit(1)=min(s_si_comb_max);
                    %    climit(2)=max(s_si_comb_max);
                    %else
                    %    climit(1)=min(climit(1),min(s_si_comb_max));
                    %    climit(2)=max(climit(2),max(s_si_comb_max));
                    %end
%{
                end
            end
		end
		for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,s_sp_max,~]=Plot_Final2_principalclimit_directions(x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,1,lp,plotignore,1);
%}
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                    saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                    frame = getframe(PlotImage);
                    writeVideo(writerObj,frame);
                    close(PlotImage);
                end
            end
		end
		
		close(writerObj);
	elseif switcher==62
		VideoName           = 's_min_multiline';
		mkdir([TimeStampedName '\\' VideoName]);
		writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
		writerObj.FrameRate = videofps;    % number of frame per second
		open(writerObj);
		
		for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
			if length(CModel) == length('Wood_Schmidt17');
				if CModel == 'Wood_Schmidt17'
					[PlotImage,DUMMY,s_sp_min,~]=Plot_Final2_principalclimit_directions_crackmultiline(le_base,x_sp,x_crack,x_cracktop,x_crackbot,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,2,lp,plotignore,1,CasetoRun);
					if length(climit)==0
						climit(1)=min(cutvector(s_sp_min,0,plotignore));
						climit(2)=max(cutvector(s_sp_min,0,plotignore));
					else
						climit(1)=min(climit(1),min(cutvector(s_sp_min,0,plotignore)));
						climit(2)=max(climit(2),max(cutvector(s_sp_min,0,plotignore)));
					end
%{
                end
            end
		end
		for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
			if length(CModel) == length('Wood_Schmidt17');
				if CModel == 'Wood_Schmidt17'
					[PlotImage,s_sp_max,~]=Plot_Final2_principalclimit_directions(x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,1,lp,plotignore,1);
%}
					%saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
					saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
					frame = getframe(PlotImage);
					writeVideo(writerObj,frame);
					close(PlotImage);
				end
			end
		end
		
		close(writerObj);
	elseif switcher==63
        VideoName           = 's_max_pforce';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);
		
        for i=ttstart:9999
%{
%switchable1
			load([TimeStampedName '\\' num2str(i) '.mat']);
%}
%switchable1
%[
%switchable1
			tt=loadsinglelong([TimeStampedName '-Master-' 'tt' '.txt']);
			if i>tt
				break;
			elseif mod(i-1,frameskip+1)>0
				continue;
			end
			x_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'x_sp' '-' int2txt(i) '.txt']);
			F_sp=loadcellmatrixfloat([TimeStampedName '-Slave-' 'F_sp' '-' int2txt(i) '.txt']);
			thetacrack=loadmatrixfloat([TimeStampedName '-Slave-' 'thetacrack' '-' int2txt(i) '.txt']);
			x_crack=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crack' '-' int2txt(i) '.txt']);
			x_cracktop=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_cracktop' '-' int2txt(i) '.txt']);
			x_crackbot=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crackbot' '-' int2txt(i) '.txt']);
			DispPump=loadsinglefloat([TimeStampedName '-Slave-' 'DispPump' '-' int2txt(i) '.txt']);
			t_time=loadsinglefloat([TimeStampedName '-Slave-' 't_time' '-' int2txt(i) '.txt']);
			s_sp=loadmatrixfloat([TimeStampedName '-Slave-' 's_sp' '-' int2txt(i) '.txt']);
			v_ssp=loadmatrixfloat([TimeStampedName '-Slave-' 'v_ssp' '-' int2txt(i) '.txt']);
			r1_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r1_sp' '-' int2txt(i) '.txt']);
			r2_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r2_sp' '-' int2txt(i) '.txt']);
			E_acc=loadmatrixfloat([TimeStampedName '-Slave-' 'E_acc' '-' int2txt(i) '.txt']);
			pforce_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'pforce_sp' '-' int2txt(i) '.txt']);
%]
%switchable1	
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,s_sp_max,~]=Plot_principal_crackmulti_pforce(x_sp,x_crack,x_cracktop,x_crackbot,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,1,lp,plotignore,1,CasetoRun,pforce_sp);
                    if length(climit)==0
                        climit(1)=min(cutvector(s_sp_max,0,plotignore));
                        climit(2)=max(cutvector(s_sp_max,0,plotignore));
                    else
                        climit(1)=min(climit(1),min(cutvector(s_sp_max,0,plotignore)));
                        climit(2)=max(climit(2),max(cutvector(s_sp_max,0,plotignore)));
                    end
%{
                end
            end
        end
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,s_sp_max,~]=Plot_Final2_principalclimit_directions(x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,1,lp,plotignore,1);
%}
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                    saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                    frame = getframe(PlotImage);
                    writeVideo(writerObj,frame);
                    close(PlotImage);
                end
            end
        end
        
        close(writerObj);
	
	elseif switcher==67
        VideoName           = 's_max_ntforce_si';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);
		
        for i=ttstart:tt
			%disp(['Loading ' TimeStampedName '\\' num2str(i) '.mat']);
			%load([TimeStampedName '\\' num2str(i) '.mat']);
			
			x_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'x_sp' '-' int2txt(i) '.txt']);
			F_sp=loadcellmatrixfloat([TimeStampedName '-Slave-' 'F_sp' '-' int2txt(i) '.txt']);
			thetacrack=loadmatrixfloat([TimeStampedName '-Slave-' 'thetacrack' '-' int2txt(i) '.txt']);
			x_crack=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crack' '-' int2txt(i) '.txt']);
			x_cracktop=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_cracktop' '-' int2txt(i) '.txt']);
			x_crackbot=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crackbot' '-' int2txt(i) '.txt']);
			DispPump=loadsinglefloat([TimeStampedName '-Slave-' 'DispPump' '-' int2txt(i) '.txt']);
			t_time=loadsinglefloat([TimeStampedName '-Slave-' 't_time' '-' int2txt(i) '.txt']);
			v_ssp=loadmatrixfloat([TimeStampedName '-Slave-' 'v_ssp' '-' int2txt(i) '.txt']);
			r1_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r1_sp' '-' int2txt(i) '.txt']);
			r2_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r2_sp' '-' int2txt(i) '.txt']);
			E_acc=loadmatrixfloat([TimeStampedName '-Slave-' 'E_acc' '-' int2txt(i) '.txt']);
			s_sp=loadmatrixfloat([TimeStampedName '-Slave-' 's_sp' '-' int2txt(i) '.txt']);
			ntforce_si=loadmatrixfloat([TimeStampedName '-Slave-' 'ntforce_si' '-' int2txt(i) '.txt']);
			
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,s_sp_max,~]=Plot_principal_crackmulti_ntforce(x_sp,x_crack,x_cracktop,x_crackbot,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,1,lp,plotignore,1,CasetoRun,ntforce_si);
                    if length(climit)==0
                        climit(1)=min(cutvector(s_sp_max,0,plotignore));
                        climit(2)=max(cutvector(s_sp_max,0,plotignore));
                    else
                        climit(1)=min(climit(1),min(cutvector(s_sp_max,0,plotignore)));
                        climit(2)=max(climit(2),max(cutvector(s_sp_max,0,plotignore)));
                    end
%{
                end
            end
        end
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,s_sp_max,~]=Plot_Final2_principalclimit_directions(x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,1,lp,plotignore,1);
%}
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                    saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                    frame = getframe(PlotImage);
                    writeVideo(writerObj,frame);
                    close(PlotImage);
                end
            end
        end
        
        close(writerObj);
	
    elseif switcher==55
        VideoName           = 's_max_var_nc';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);

        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,s_sp_max,~]=Plot_Final2_principalclimit_directions(x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,1,lp,plotignore,1,CasetoRun);
                    if length(climit)==0
                        climit(1)=min(cutvector(s_sp_max,0,plotignore));
                        climit(2)=max(cutvector(s_sp_max,0,plotignore));
                    else
                        climit(1)=min(climit(1),min(cutvector(s_sp_max,0,plotignore)));
                        climit(2)=max(climit(2),max(cutvector(s_sp_max,0,plotignore)));
                    end
%{
                end
            end
        end
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,s_sp_max,~]=Plot_Final2_principalclimit_directions(x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,1,lp,plotignore,1);
%}
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                    saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                    frame = getframe(PlotImage);
                    writeVideo(writerObj,frame);
                    close(PlotImage);
                end
            end
        end
        
        close(writerObj);
    
    elseif switcher==10
        VideoName           = 's_max';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);

        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,s_sp_max,~]=Plot_Final2_principalclimit_directions(x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,1,lp,plotignore,0,CasetoRun);
                    if length(climit)==0
                        climit(1)=min(cutvector(s_sp_max,0,plotignore));
                        climit(2)=max(cutvector(s_sp_max,0,plotignore));
                    else
                        climit(1)=min(climit(1),min(cutvector(s_sp_max,0,plotignore)));
                        climit(2)=max(climit(2),max(cutvector(s_sp_max,0,plotignore)));
                    end
                end
            end
        end
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,s_sp_max,~]=Plot_Final2_principalclimit_directions(x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,1,lp,plotignore,1,CasetoRun);
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                    saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                    frame = getframe(PlotImage);
                    writeVideo(writerObj,frame);
                    close(PlotImage);
                end
            end
        end
        
        close(writerObj);
    
    elseif switcher==22
        VideoName           = 's_shr';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);

        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,DUMMY,DUMMY2,s_sp_shr]=Plot_Final2_principalclimit_directions(x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,3,lp,plotignore,0,CasetoRun);
                    if length(climit)==0
                        climit(1)=min(cutvector(s_sp_shr,0,plotignore));
                        climit(2)=max(cutvector(s_sp_shr,0,plotignore));
                    else
                        climit(1)=min(climit(1),min(cutvector(s_sp_shr,0,plotignore)));
                        climit(2)=max(climit(2),max(cutvector(s_sp_shr,0,plotignore)));
                    end
                end
            end
        end
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,DUMMY,DUMMY2,s_sp_shr]=Plot_Final2_principalclimit_directions(x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,3,lp,plotignore,1,CasetoRun);
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                    saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                    frame = getframe(PlotImage);
                    writeVideo(writerObj,frame);
                    close(PlotImage);
                end
            end
        end
        close(writerObj);
    
    elseif switcher==9
        VideoName           = 's_min';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);

        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,DUMMY,s_sp_min,~]=Plot_Final2_principalclimit_directions(x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,2,lp,plotignore,0,CasetoRun);
                    if length(climit)==0
                        climit(1)=min(cutvector(s_sp_min,0,plotignore));
                        climit(2)=max(cutvector(s_sp_min,0,plotignore));
                    else
                        climit(1)=min(climit(1),min(cutvector(s_sp_min,0,plotignore)));
                        climit(2)=max(climit(2),max(cutvector(s_sp_min,0,plotignore)));
                    end
                end
            end
        end
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,DUMMY,s_sp_min,~]=Plot_Final2_principalclimit_directions(x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,2,lp,plotignore,1,CasetoRun);
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                    saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                    frame = getframe(PlotImage);
                    writeVideo(writerObj,frame);
                    close(PlotImage);
                end
            end
        end
        close(writerObj);
    
    elseif switcher==42
        VideoName           = 's1';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            %climit=[-11 8];
            %[PlotImage]=Plot_Final2_regularclimit(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp(:,1),climit,plotignore,0);
            if length(climit)==0
                climit(1)=min(cutvector(s_sp(:,1),0,plotignore));
                climit(2)=max(cutvector(s_sp(:,1),0,plotignore));
            else
                climit(1)=min(climit(1),min(cutvector(s_sp(:,1),0,plotignore)));
                climit(2)=max(climit(2),max(cutvector(s_sp(:,1),0,plotignore)));
            end                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        end
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            [PlotImage]=Plot_Final2_regularclimit(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp(:,1),climit,plotignore);
            %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
            saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
            frame = getframe(PlotImage);
            writeVideo(writerObj,frame);
            close(PlotImage);
        end
        close(writerObj);

    elseif switcher==1
        VideoName           = 'evaltimes';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);
        for i=ttstart:tt
            evaltimes_accummulated=zeros(spCount,1);
			load([TimeStampedName '\\' num2str(i) '.mat']);
            if length(climit)==0
                climit(1)=min(cutvector(evaltimes_accummulated,0,plotignore));
                climit(2)=max(cutvector(evaltimes_accummulated,0,plotignore));
            else
                climit(1)=min(climit(1),min(cutvector(evaltimes_accummulated,0,plotignore)));
                climit(2)=max(climit(2),max(cutvector(evaltimes_accummulated,0,plotignore)));
            end
            [PlotImage]=Plot_Final2_regularclimit(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,evaltimes_accummulated,climit,plotignore);
            %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
            saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
            frame = getframe(PlotImage);
            writeVideo(writerObj,frame);
            close(PlotImage);
        end
        close(writerObj);
        
    elseif switcher==45
        VideoName           = 'ux';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        direction           = 1;
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            u_sp=x_sp(:,direction)-x_spo(:,direction);
            if length(climit)==0
                climit(1)=min(cutvector(u_sp,0,plotignore));
                climit(2)=max(cutvector(u_sp,0,plotignore));
            else
                climit(1)=min(climit(1),min(cutvector(u_sp,0,plotignore)));
                climit(2)=max(climit(2),max(cutvector(u_sp,0,plotignore)));
            end
            [PlotImage]=Plot_Final2_regularclimit(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,u_sp,climit,plotignore);
            %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
            saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
            frame = getframe(PlotImage);
            writeVideo(writerObj,frame);
            close(PlotImage);
        end
        close(writerObj);
    elseif switcher==64 || switcher==65 || switcher==66
		direction           = switcher-63;
		
		if direction==1
			VideoName           = ['ux_multiline'];
		elseif direction==2
			VideoName           = ['uy_multiline'];
		elseif direction==3
			VideoName           = ['um_multiline'];
		end
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            u_sp_all=x_sp-x_spo;
			if direction<3
				u_sp=u_sp_all(:,direction);
			else
				for isp=1:spCount
					u_sp(isp,1)=sqrt(dot(u_sp_all(isp,:),u_sp_all(isp,:)));
				end
			end
            if length(climit)==0
                climit(1)=min(cutvector(u_sp,0,plotignore));
                climit(2)=max(cutvector(u_sp,0,plotignore));
            else
                climit(1)=min(climit(1),min(cutvector(u_sp,0,plotignore)));
                climit(2)=max(climit(2),max(cutvector(u_sp,0,plotignore)));
            end
            [PlotImage]=Plot_Final2_regularclimit_multiline(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,u_sp,climit,plotignore);
            %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
            saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
            frame = getframe(PlotImage);
            writeVideo(writerObj,frame);
            close(PlotImage);
        end
        close(writerObj);
    elseif switcher==46
        VideoName           = 'uy';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        direction           = 2;
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            u_sp=x_sp(:,direction)-x_spo(:,direction);
            if length(climit)==0
                climit(1)=min(cutvector(u_sp,0,plotignore));
                climit(2)=max(cutvector(u_sp,0,plotignore));
            else
                climit(1)=min(climit(1),min(cutvector(u_sp,0,plotignore)));
                climit(2)=max(climit(2),max(cutvector(u_sp,0,plotignore)));
            end
            [PlotImage]=Plot_Final2_regularclimit(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,u_sp,climit,plotignore);
            %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
            saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
            frame = getframe(PlotImage);
            writeVideo(writerObj,frame);
            close(PlotImage);
        end
        close(writerObj);

    elseif switcher==31
        VideoName           = 's12';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            %climit=[-11 8];
            %[PlotImage]=Plot_Final2_regularclimit(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp(:,1),climit,plotignore,0);
            if length(climit)==0
                climit(1)=min(cutvector(s_sp(:,3),0,plotignore));
                climit(2)=max(cutvector(s_sp(:,3),0,plotignore));
            else
                climit(1)=min(climit(1),min(cutvector(s_sp(:,3),0,plotignore)));
                climit(2)=max(climit(2),max(cutvector(s_sp(:,3),0,plotignore)));
            end
        end
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            [PlotImage]=Plot_Final2_regularclimit(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp(:,3),climit,plotignore);
            %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
            saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
            frame = getframe(PlotImage);
            writeVideo(writerObj,frame);
            close(PlotImage);
        end
        close(writerObj);

        
    elseif switcher==44
        VideoName           = 'fmax';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            [PlotImage]=Plot_Final2_f_plot(t_time,tt,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,plotignore,f_final_vect,alphahp);
            %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
            saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
            frame = getframe(PlotImage);
            writeVideo(writerObj,frame);
            close(PlotImage);
        end
        close(writerObj);

        
    elseif switcher==2 || switcher==3 || switcher==4 || switcher==5 || switcher==6 || switcher==7 || switcher==8
        surface=switcher-1;
        VideoName           = ['alpha_' num2str(surface)];
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            if length(climit)==0
                climit(1)=min(cutvector(alphahp(:,surface),0,plotignore));
                climit(2)=max(cutvector(alphahp(:,surface),0,plotignore));
            else
                climit(1)=min(climit(1),min(cutvector(alphahp(:,surface),0,plotignore)));
                climit(2)=max(climit(2),max(cutvector(alphahp(:,surface),0,plotignore)));
            end                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        end
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            [PlotImage]=Plot_Final2_alpha(climit,x_sp,LOC,spCount,r1_sp,r2_sp,plotignore,alphahp,surface);
            %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
            saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
            frame = getframe(PlotImage);
            writeVideo(writerObj,frame);
            close(PlotImage);
        end
        close(writerObj);

        
    elseif switcher==24 || switcher==25 || switcher==26 || switcher==27 || switcher==28 || switcher==29 || switcher==30
        surface=switcher-23;
        VideoName           = ['q_' num2str(surface)];
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);
        qtoprint=zeros(spCount,tt);        
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            for sp=1:spCount
                if plotignore(sp)
                    continue;
                end
                [qtemp,~]=qandDfromalpha2(alphahp(sp,:),ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit);
                qtoprint(sp,i)=qtemp(surface);
            end
            if length(climit)==0
                climit(1)=min(cutvector(qtoprint(:,i),0,plotignore));
                climit(2)=max(cutvector(qtoprint(:,i),0,plotignore));
            else
                climit(1)=min(climit(1),min(cutvector(qtoprint(:,i),0,plotignore)));
                climit(2)=max(climit(2),max(cutvector(qtoprint(:,i),0,plotignore)));
            end                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
%        end
%        for i=ttstart:tt
%			load([TimeStampedName '\\' num2str(i) '.mat']);
            [PlotImage]=Plot_Final2_regularclimit(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,qtoprint(:,i),climit,plotignore);
            %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
            saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
            frame = getframe(PlotImage);
            writeVideo(writerObj,frame);
            close(PlotImage);
        end
        close(writerObj);

        
    elseif switcher==14
        VideoName           = 's2';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            if length(climit)==0
                climit(1)=min(cutvector(s_sp(:,2),0,plotignore));
                climit(2)=max(cutvector(s_sp(:,2),0,plotignore));
            else
                climit(1)=min(climit(1),min(cutvector(s_sp(:,2),0,plotignore)));
                climit(2)=max(climit(2),max(cutvector(s_sp(:,2),0,plotignore)));
            end                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        end
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            [PlotImage]=Plot_Final2_regularclimit(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp(:,2),climit,plotignore);
            %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
            saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
            frame = getframe(PlotImage);
            writeVideo(writerObj,frame);
            close(PlotImage);
        end
        close(writerObj);

    elseif switcher==39
        VideoName           = 's2d';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            if length(climit)==0
                climit(1)=min(cutvector(s_sp(:,2),0,plotignore));
                climit(2)=max(cutvector(s_sp(:,2),0,plotignore));
            else
                climit(1)=min(climit(1),min(cutvector(s_sp(:,2),0,plotignore)));
                climit(2)=max(climit(2),max(cutvector(s_sp(:,2),0,plotignore)));
            end                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
            [PlotImage]=Plot_Final2_regularclimit(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp(:,2),climit,plotignore);
            %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
            saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
            frame = getframe(PlotImage);
            writeVideo(writerObj,frame);
            close(PlotImage);
        end
        close(writerObj);

    elseif switcher==15 || switcher==16 || switcher==17 || switcher==18 || switcher==19 || switcher==20 || switcher==21
        surface=switcher-14;
        VideoName           = ['f_' num2str(surface)];
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            if length(climit)==0
                climit(1)=min(cutvector(f_final_vect(:,surface),0,plotignore));
                climit(2)=max(cutvector(f_final_vect(:,surface),0,plotignore));
            else
                climit(1)=min(climit(1),min(cutvector(f_final_vect(:,surface),0,plotignore)));
                climit(2)=max(climit(2),max(cutvector(f_final_vect(:,surface),0,plotignore)));
            end

%        end
%        for i=ttstart:tt
%			load([TimeStampedName '\\' num2str(i) '.mat']);
            [PlotImage]=Plot_Final2_regularclimit(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,f_final_vect(:,surface),climit,plotignore);
            %climitsfrec=[climitsfrec;climitsf];
            %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
            saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
            frame = getframe(PlotImage);
            writeVideo(writerObj,frame);
            close(PlotImage);
        end
        close(writerObj);

    elseif switcher==41

        xmax=max(-TLD(:,3));
        xmin=min(-TLD(:,3));
        ymax=max(-TLD(:,2));
        ymin=min(-TLD(:,2));
        TLDmaxsize=size(TLD,1);
        
        VideoName           = 'load-disp';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);
        if CasetoRun==5
            tt=min(tt,2399);
        end
        for i=ttstart:tt
            PlotImage=figure;
            set(PlotImage,'visible','off');
            if CasetoRun==5
                plot(-TLD(1:i,3),-TLD(1:i,2));
            else
                plot(TLD(1:i,3),TLD(1:i,2));
            end
            hold on
            plot(xmax,ymax);
            plot(xmin,ymax);
            plot(xmax,ymin);
            plot(xmin,ymin);
            xlabel('Displacement (mm)');
            ylabel('Load (N)');
            if CasetoRun==5
            else
                title('Load vs Displacement Curve');
            end
            
            set(gca,'FontSize',20)
            %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
            saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) '.png']);
            frame=getframe(PlotImage);
            writeVideo(writerObj,frame);
            hold off
            close(PlotImage);
        end
        close(writerObj);
   
    
    elseif switcher==47

        mkdir([TimeStampedName '\\schedule']);
        %writerObj           = VideoWriter([TimeStampedName '\\schedule.avi']);
        %writerObj.FrameRate = videofps;    % number of frame per second
        %open(writerObj);
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            if i==ttstart
                xupperlimit=stackvars(size(stackvars,1),2);
            else
                xupperlimit=max(xupperlimit,stackvars(size(stackvars,1),2));
            end
            for j=1:size(stackvars,1)
                if stackvars(j,2)==0
                    stackvars(j,3)=stackvars(size(stackvars,1),2)/1000;
                else
                    stackvars(j,3)=0;
                end
            end
            PlotImage=figure;
			set(PlotImage,'visible','off');
            hold on;
            set(PlotImage,'Position',[0 0 720 1280]);
            title(['tt=' num2str(i) ', t_time=' char(vpa(t_time))]);
            %xlim([0 xupperlimit]);
            
            BarProfile=barh(stackvars,'stacked');
            set(BarProfile,{'FaceColor'},{'none';'k';'r'},'EdgeColor','none','BarWidth',1);
            %set(BarProfile,'BarWidth',1);
            saveas(PlotImage,[TimeStampedName '\\schedule\\tt=' num2str(i) ', t_time=' char(vpa(t_time)) '.png']);
            %%saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
            %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
            %frame = getframe(PlotImage);
            %writeVideo(writerObj,frame);
            hold off;
            close(PlotImage);
        end
        %close(writerObj);
   
    
    elseif switcher==11
        VideoName           = 'sr';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            if length(climit)==0
                climit(1)=min(cutvector(sigma_local_big(:,1),0,plotignore));
                climit(2)=max(cutvector(sigma_local_big(:,1),0,plotignore));
            else
                climit(1)=min(climit(1),min(cutvector(sigma_local_big(:,1),0,plotignore)));
                climit(2)=max(climit(2),max(cutvector(sigma_local_big(:,1),0,plotignore)));
            end                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
            %climitssrec=[climitssrec;climitss];
        end
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            [PlotImage]=Plot_Final2_regularclimit(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,sigma_local_big(:,1),climit,plotignore);
            %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
            saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
            frame = getframe(PlotImage);
            writeVideo(writerObj,frame);
            close(PlotImage);
        end
        close(writerObj);
   
    elseif switcher==32
        VideoName           = 'srt';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            if length(climit)==0
                climit(1)=min(cutvector(sigma_local_big(:,4),0,plotignore));
                climit(2)=max(cutvector(sigma_local_big(:,4),0,plotignore));
            else
                climit(1)=min(climit(1),min(cutvector(sigma_local_big(:,4),0,plotignore)));
                climit(2)=max(climit(2),max(cutvector(sigma_local_big(:,4),0,plotignore)));
            end                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
            %climitssrec=[climitssrec;climitss];
        end
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            [PlotImage]=Plot_Final2_regularclimit(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,sigma_local_big(:,4),climit,plotignore);
            %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
            saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
            frame = getframe(PlotImage);
            writeVideo(writerObj,frame);
            close(PlotImage);
        end
        close(writerObj);
   
    elseif switcher==33
        VideoName           = 'stl';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            if length(climit)==0
                climit(1)=min(cutvector(sigma_local_big(:,5),0,plotignore));
                climit(2)=max(cutvector(sigma_local_big(:,5),0,plotignore));
            else
                climit(1)=min(climit(1),min(cutvector(sigma_local_big(:,5),0,plotignore)));
                climit(2)=max(climit(2),max(cutvector(sigma_local_big(:,5),0,plotignore)));
            end                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
            %climitssrec=[climitssrec;climitss];
        end
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            [PlotImage]=Plot_Final2_regularclimit(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,sigma_local_big(:,5),climit,plotignore);
            %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
            saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
            frame = getframe(PlotImage);
            writeVideo(writerObj,frame);
            close(PlotImage);
        end
        close(writerObj);
   
    elseif switcher==34
        VideoName           = 'srl';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            if length(climit)==0
                climit(1)=min(cutvector(sigma_local_big(:,6),0,plotignore));
                climit(2)=max(cutvector(sigma_local_big(:,6),0,plotignore));
            else
                climit(1)=min(climit(1),min(cutvector(sigma_local_big(:,6),0,plotignore)));
                climit(2)=max(climit(2),max(cutvector(sigma_local_big(:,6),0,plotignore)));
            end                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
            %climitssrec=[climitssrec;climitss];
        end
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            [PlotImage]=Plot_Final2_regularclimit(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,sigma_local_big(:,6),climit,plotignore);
            %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
            saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
            frame = getframe(PlotImage);
            writeVideo(writerObj,frame);
            close(PlotImage);
        end
        close(writerObj);
   
    
    elseif switcher==23
        VideoName           = 'st';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            if length(climit)==0
                climit(1)=min(cutvector(sigma_local_big(:,2),0,plotignore));
                climit(2)=max(cutvector(sigma_local_big(:,2),0,plotignore));
            else
                climit(1)=min(climit(1),min(cutvector(sigma_local_big(:,2),0,plotignore)));
                climit(2)=max(climit(2),max(cutvector(sigma_local_big(:,2),0,plotignore)));
            end
        end
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            [PlotImage]=Plot_Final2_regularclimit(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,sigma_local_big(:,2),climit,plotignore);
            %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
            saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
            frame = getframe(PlotImage);
            writeVideo(writerObj,frame);
            close(PlotImage);


            %if exist('climitsf')==0
            %    climitsf=[];
            %end
        end
        close(writerObj);
    
   
    
    elseif switcher==12
        VideoName           = 'sl';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            if length(climit)==0
                climit(1)=min(cutvector(sigma_local_big(:,3),0,plotignore));
                climit(2)=max(cutvector(sigma_local_big(:,3),0,plotignore));
            else
                climit(1)=min(climit(1),min(cutvector(sigma_local_big(:,3),0,plotignore)));
                climit(2)=max(climit(2),max(cutvector(sigma_local_big(:,3),0,plotignore)));
            end
        end
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            [PlotImage]=Plot_Final2_regularclimit(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,sigma_local_big(:,3),climit,plotignore);
            %climitssrec=[climitssrec;climitss];
            %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
            saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
            frame = getframe(PlotImage);
            writeVideo(writerObj,frame);
            close(PlotImage);


            %if exist('climitsf')==0
            %    climitsf=[];
            %end
        end
        close(writerObj);
    elseif switcher==48
        %stress x black and white
        VideoName           = 's1_bw';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);
        if CasetoRun==5
            tt=min(tt,2399);
        end
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            %climit=[-11 8];
            if length(climit)==0
                climit(1)=min(cutvector(s_sp(:,1),0,plotignore));
                climit(2)=max(cutvector(s_sp(:,1),0,plotignore));
            else
                climit(1)=min(climit(1),min(cutvector(s_sp(:,1),0,plotignore)));
                climit(2)=max(climit(2),max(cutvector(s_sp(:,1),0,plotignore)));
            end                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        end
        if CasetoRun==5
            tt=min(tt,2399);
        end
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            [PlotImage]=Plot_Final2_regularclimit_black(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp(:,1),climit,plotignore,CasetoRun);
            %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
            saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
            frame = getframe(PlotImage);
            writeVideo(writerObj,frame);
            close(PlotImage);
        end
        close(writerObj);

    elseif switcher==49
        %stress y black and white
        VideoName           = 's2_bw';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);
        if CasetoRun==5
            tt=min(tt,2399);
        end
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            if length(climit)==0
                climit(1)=min(cutvector(s_sp(:,2),0,plotignore));
                climit(2)=max(cutvector(s_sp(:,2),0,plotignore));
            else
                climit(1)=min(climit(1),min(cutvector(s_sp(:,2),0,plotignore)));
                climit(2)=max(climit(2),max(cutvector(s_sp(:,2),0,plotignore)));
            end                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        end
        if CasetoRun==5
            tt=min(tt,2399);
        end
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            if CasetoRun==10
                climit(1)=-3.8;
                climit(2)=3.8;
            end
            [PlotImage]=Plot_Final2_regularclimit_black(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp(:,2),climit,plotignore,CasetoRun);
            %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
            saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
            frame = getframe(PlotImage);
            writeVideo(writerObj,frame);
            close(PlotImage);
        end
        close(writerObj);

    elseif switcher==50
        %min princ plastic strain 
        VideoName           = 's_min_bw';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);

        if CasetoRun==5
            tt=min(tt,2399);
        end
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);        
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,DUMMY,s_sp_min,~]=Plot_Final2_principalclimit_directions_black(x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,2,lp,plotignore,0,CasetoRun);
                    if length(climit)==0
                        climit(1)=min(cutvector(s_sp_min,0,plotignore));
                        climit(2)=max(cutvector(s_sp_min,0,plotignore));
                    else
                        climit(1)=min(climit(1),min(cutvector(s_sp_min,0,plotignore)));
                        climit(2)=max(climit(2),max(cutvector(s_sp_min,0,plotignore)));
                    end
                end
            end
        end
        if CasetoRun==5
            tt=min(tt,2399);
        end
        for i=ttstart:tt
            load([TimeStampedName '\\' num2str(i) '.mat']);
            if length(CModel) == length('Wood_Schmidt17');
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,DUMMY,s_sp_min,~]=Plot_Final2_principalclimit_directions_black(x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,s_sp,climit,2,lp,plotignore,1,CasetoRun);
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                    saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                    frame = getframe(PlotImage);
                    writeVideo(writerObj,frame);
                    close(PlotImage);
                end
            end
        end
        close(writerObj);
    
    elseif switcher==51
        VideoName           = 'e_pl_max_bw';
        mkdir([TimeStampedName '\\' VideoName]);
        writerObj           = VideoWriter([TimeStampedName '\\' VideoName '.avi']);
        writerObj.FrameRate = videofps;    % number of frame per second
        open(writerObj);

        if CasetoRun==5
            tt=min(tt,2399);
        end
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            if length(CModel) == length('Wood_Schmidt17')
                if CModel == 'Wood_Schmidt17'
                    %if exist('climitse')==0
                    %    climitse=[];
                    %end
                    if CasetoRun==10
                        climit(1)=0;
                        climit(2)=0.21;
                    end
                    [PlotImage,e_pl_sp_max,~]=Plot_Final2_principalclimit_black(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,e_pl_sp,climit,1,plotignore,0,CasetoRun);
                    if length(climit)==0
                        climit(1)=min(cutvector(e_pl_sp_max,0,plotignore));
                        climit(2)=max(cutvector(e_pl_sp_max,0,plotignore));
                    else
                        climit(1)=min(climit(1),min(cutvector(e_pl_sp_max,0,plotignore)));
                        climit(2)=max(climit(2),max(cutvector(e_pl_sp_max,0,plotignore)));
                    end
                end
            end
        end
        if CasetoRun==5
            tt=min(tt,2399);
        end
        for i=ttstart:tt
			load([TimeStampedName '\\' num2str(i) '.mat']);
            if length(CModel) == length('Wood_Schmidt17')
                if CModel == 'Wood_Schmidt17'
                    [PlotImage,e_pl_sp_max,~]=Plot_Final2_principalclimit_black(t_time,i,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,e_pl_sp,climit,1,plotignore,1,CasetoRun);
                    %saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.emf']);
                    saveas(PlotImage,[TimeStampedName '\\' VideoName '\\tt=' num2str(i) ',d=' num2str(DispPump) ',t_time=' char(vpa(t_time)) '.png']);
                    frame = getframe(PlotImage);
                    writeVideo(writerObj,frame);
                    close(PlotImage);
                end
            end
            %if exist('climitss')==0
            %    climitss=[];
            %end
        end
        close(writerObj);
    else
        disp('switcher error!')
    end
    
    % End of Printing TLD Video
    close all
    disp(['Done Plotting Switcher #' num2str(switcher)]);

end
%}
%switchable2

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [s_sp,e_pl,sigma_global_big,e_t_global_big,e_pl_global_big,alpha_out,f_final_vect,surfacewithfmax,sigma_local_big,AbeforeQ_rtl,evaltimes,thetacrackrtl,justcracked,Qacoustic,h,Ktangent_global,Ktangent_global_2D,Ktangent_global_tens,Ktangent_global_tens_2D,activesurfacelist,lambdamin,thetamin]= ...
    Wood_Schmidt17(dESP,sigma_global_big,e_t_global_big,e_pl_global_big,alpha_in,xdirletter,ydirletter,zdirletter,xydirletter,yzdirletter,xzdirletter,ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,Grt,Gtl,Grl,nurt,nutl,nurl,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit,CasetoRun,t_time,dt,spid,Debugging,thetacrackrtl,dudx_rtl)
	%start function of Wood_Schmidt17
	
	% move efficient than version 16
	%function [outputArg1,outputArg2] = Wood_Schmidt(inputArg1,inputArg2)
	%SCHMIDT Summary of this function goes here
	%   Detailed explanation goes here
	%{
	Voigt's Notation direction:
	1: r
	2: t
	3: l
	4: rt
	5: tl
	6: rl
	
	Failure surfaces:
	1: r tension
	2: r compression
	3: t tension
	4: t compression
	5: l tension
	6: l compression
	7: shear
	
	%}
	
	evaltimes=0;
	step=1;
	
	deltaepsilonglobal=zeros(6,1);
	deltaepsilonglobal(1,1)=real(dESP(1,1));
	deltaepsilonglobal(2,1)=real(dESP(2,2));
	deltaepsilonglobal(3,1)=0;
	deltaepsilonglobal(4,1)=real(dESP(1,2));
	deltaepsilonglobal(5,1)=0;
	deltaepsilonglobal(6,1)=0;
	
	if dESP(1,2)>0
	end
	
	xdir=RTLtranslator(xdirletter);
	ydir=RTLtranslator(ydirletter);
	zdir=RTLtranslator(zdirletter);
	xydir=RTLtranslator(xydirletter);
	yzdir=RTLtranslator(yzdirletter);
	xzdir=RTLtranslator(xzdirletter);

	dirglobal=[xdir ydir zdir xydir yzdir xzdir];

	if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==21 || CasetoRun==17
		planestressmod=1;
	elseif CasetoRun==4
		planestressmod=1;
	elseif CasetoRun==5 || CasetoRun==6
		planestressmod=0;
	elseif CasetoRun==7
		planestressmod=1;
	elseif CasetoRun==8 || CasetoRun==9
		planestressmod=0;
	elseif CasetoRun==10
		planestressmod=1;
	elseif CasetoRun==11
		planestressmod=1;
	elseif CasetoRun==12 || CasetoRun==16 || CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44
		%planestressmod=0;
		%planestressmod=1; %turns out it's plane STRAIN all along, let's do plane STRESS now.
		planestressmod=0; %plane stress is being done, need PLANE STRAIN for more correctness.
	elseif CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==15 || CasetoRun==14
		%planestressmod=0; %note it's plane strain unlinke CasetoRun==11
		%planestressmod=1; %turns out it's plane STRAIN all along, let's do plane STRESS now.
		planestressmod=0; %plane stress is being done, need PLANE STRAIN for more correctness.
    elseif CasetoRun==73 || CasetoRun==74 || CasetoRun==78 || CasetoRun==81 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==83 || CasetoRun==84 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124 || CasetoRun==117 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110 || CasetoRun==96 || CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89 || CasetoRun==85 || CasetoRun==77
        planestressmod=0;
    elseif CasetoRun==-99
        planestressmod=0;
	end
	
	nsurface=length(alpha_in); %to stop coder whining
	nstressvect=length(sigma_global_big); %to stop coder whining
	
	deltaepsilon=zeros(nstressvect,1);
	deltaepsilon(xdir,1)=deltaepsilonglobal(1);
	deltaepsilon(ydir,1)=deltaepsilonglobal(2);
	deltaepsilon(zdir,1)=deltaepsilonglobal(3);
	deltaepsilon(xydir,1)=deltaepsilonglobal(4);
	deltaepsilon(yzdir,1)=deltaepsilonglobal(5);
	deltaepsilon(xzdir,1)=deltaepsilonglobal(6);
	
	epsilonp=zeros(nstressvect,1);
	epsilonp(xdir,1)=e_pl_global_big(1);
	epsilonp(ydir,1)=e_pl_global_big(2);
	epsilonp(zdir,1)=e_pl_global_big(3);
	epsilonp(xydir,1)=e_pl_global_big(4);
	epsilonp(yzdir,1)=e_pl_global_big(5);
	epsilonp(xzdir,1)=e_pl_global_big(6);
	
	epsilont=zeros(nstressvect,1);
	epsilont(xdir,1)=e_t_global_big(1);
	epsilont(ydir,1)=e_t_global_big(2);
	epsilont(zdir,1)=e_t_global_big(3);
	epsilont(xydir,1)=e_t_global_big(4);
	epsilont(yzdir,1)=e_t_global_big(5);
	epsilont(xzdir,1)=e_t_global_big(6);
	
	sigma0=zeros(nstressvect,1);
	sigma0(xdir,1)=sigma_global_big(1);
	sigma0(ydir,1)=sigma_global_big(2);
	sigma0(zdir,1)=sigma_global_big(3);
	sigma0(xydir,1)=sigma_global_big(4);
	sigma0(yzdir,1)=sigma_global_big(5);
	sigma0(xzdir,1)=sigma_global_big(6);
	
	q=zeros(1,nsurface);
	qtest=zeros(1,nsurface);
	
	sigma=cell(1,3);
	sigma{1}=zeros(nstressvect,1);
	sigma{2}=zeros(nstressvect,1);
	sigma{3}=zeros(nstressvect,1);
	alphahp=cell(1,3);
	alphahp{1}=zeros(1,nsurface);
	alphahp{2}=zeros(1,nsurface);
	alphahp{3}=zeros(1,nsurface);
	
	ftrial=cell(1,nsurface);
	coder.varsize('ftrial');
	fprev=cell(1,nsurface);
	coder.varsize('fprev');
	fimplicitstart=cell(1,nsurface);
	coder.varsize('fimplicitstart');
	fimplicitstarttrial=cell(1,nsurface);
	coder.varsize('fimplicitstarttrial');
	f_final=cell(1,nsurface);
	f1trial=cell(1,nsurface);
	f10=cell(1,nsurface);
	f2trial=cell(1,nsurface);
	f20=cell(1,nsurface);
	dfdsigma=cell(1,nsurface);
	dfdq=cell(1,nsurface);
	dfdqchosen=cell(1,nsurface);
	d2fdsigma2=cell(1,nsurface);
	d2fdsigmadq=cell(1,nsurface);
	d2fdq2=cell(1,nsurface);
	for i=1:nsurface
		ftrial{i}=0;
		fprev{i}=0;
		fimplicitstart{i}=0;
		fimplicitstarttrial{i}=0;
		f_final{i}=0;
		f1trial{i}=0;
		f10{i}=0;
		f2trial{i}=0;
		f20{i}=0;
		dfdsigma{i}=zeros(nstressvect,1);
		dfdq{i}=zeros(nsurface,1);
		dfdqchosen{i}=zeros(nsurface,1);
		d2fdsigma2{i}=zeros(nstressvect,nstressvect);
		d2fdsigmadq{i}=zeros(nstressvect,nsurface);
		d2fdq2{i}=zeros(nsurface,nsurface);
	end
	for i=1:nstressvect
		sigma{1}(i,1)=sigma0(i,1);
	end
	
	chosensurface=0;
	chosensurface1=0;
	chosensurface2=0;
	justcracked=0;
	surfacehistory=zeros(1,nsurface);
	A1=0;
	A2=0;
	B=0;
	sigmaimplicitstart=zeros(nstressvect,1);
	sigmaimplicitstarttrial=zeros(nstressvect,1);
	sigmawidened=zeros(nstressvect,1);
	sigmaimp=zeros(nstressvect,1);
	sigmaimpn=zeros(nstressvect,1);
	deltalambda1ok=0;
	deltalambda2ok=0;
	alphafactchosen=0;
	deltaalpha1=0;
	deltaalpha2=0;
	deltaalphataken=0;
	deltalambdanice=0;
	deltalambdaguess=0;
	deltagamma=0;
	deltagamma1=0;
	deltagamma2=0;
	alphawidened=zeros(1,nsurface);
	alphaimplicitstart=zeros(1,nsurface);
	alphaimpn=zeros(1,nsurface);
	alphaimp=zeros(1,nsurface);
	q=zeros(1,nsurface);
	dqdalpha=zeros(1,nsurface);
	d2qdalpha2=zeros(1,nsurface);	
	qfordeltaT=0;
	last5surfaces=zeros(5,2);
	
	
	Comp=[1/Er -nurt/Et -nurl/El 0 0 0;
		-nurt/Et 1/Et -nutl/El 0 0 0;
		-nurl/El -nutl/El 1/El 0 0 0;
		0 0 0 1/Grt 0 0;
		0 0 0 0 1/Gtl 0;
		0 0 0 0 0 1/Grl];

	%{
	sigmarr=sigmatrial(1);
	sigmatt=sigmatrial(2);
	sigmall=sigmatrial(3);
	sigmart=sigmatrial(4);
	sigmatl=sigmatrial(5);
	sigmarl=sigmatrial(6);
	%}    
	
	%{
	for i=1:7
		deltagamma(i)=0;
	end
	%}
		
	C=Comp^-1;
	Cplanestrain=C;
	if planestressmod==1
		C=MatCondensor(Cplanestrain,[zdir yzdir xzdir]);
	elseif planestressmod==2
		C=MatCondensor(Cplanestrain,[ydir zdir xydir yzdir xzdir]);
	end
	%{
	if planestressmod
		C=zeros(6,6);
		for i=1:6
			if i==zdir|i==yzdir|i==xzdir
				continue;
			end
			if planestressmod==2
				if i==ydir|i==xydir
					continue;
				end
			end
			for j=1:6
				if j==zdir|j==yzdir|j==xzdir
					continue;
				end
				if planestressmod==2
					if j==ydir|j==xydir
						continue;
					end
				end
				C(i,j)=Cplanestrain(i,j);
			end
		end
	end
	%}
	
	%sigmastep(:,1)=transpose([0 0 0 0 0 0]);
	
	%sigmatrial{1}=zeros(6,1);
	
	%q{1}=transpose([0 0 0 0 0 0 0]);
	for j=1:length(alphahp)
		for i=1:nsurface
			alphahp{j}(i)=alpha_in(i);
		end
	end
	
	NormLimit=1e-5;
	%fstep=zeros(7,1);
	hardeningsurfaces=[1 2 3 4 5 6 7];
	%hardeningsurfaces=[1 3];
	
	q=[0 0 0 0 0 0 0];
	dqdalpha=[0 0 0 0 0 0 0];
	d2qdalpha2=[0 0 0 0 0 0 0];

	[q,~]=qandDfromalpha2(alphahp{1},ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit);
	sigmatrial=sigma{1}+C*deltaepsilon;
	evaltimes=evaltimes+2;
	[ftrial,~,~]=Wood_Schmidt_EvalSigmaEff(sigmatrial,q,hardeningsurfaces,[1 0 0 0 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);
	[fprev,~,~]=Wood_Schmidt_EvalSigmaEff(sigma{1},q,hardeningsurfaces,[1 0 0 0 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);
	elastic=1;
	if t_time>=3.2395443013820597322194316802779-dt/2 && t_time<=3.2395443013820597322194316802779+dt/2 && (spid==17 || spid==17)
		1;
	end
	%surfaceallpositiveproblem=zeros(7,1);
	%surfacevalallpositiveproblem=zeros(7,1);
	
	alphafact=zeros(1,7);
	for i=1:7
		if ftrial{i}>0 && ftrial{i}>fprev{i}
			alphafact(i)=(fprev{i}/(fprev{i}-ftrial{i}));
			elastic=0;
		else
			if ftrial{i}>0
				%disp(['Warning for spid=' num2str(spid) ': ftrial{' num2str(i) '}>0 but <fprev{' num2str(i) '}, special treatment is assumed']);
				%disp('Press any key to continue');
				%pause;
				alphafact(i)=-fprev{i};
				elastic=0;
				1;
			else
				alphafact(i)=1;
			end
		end
	end
	%if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==21 || CasetoRun==17
	%elseif CasetoRun==4
	%    elastic=1; %forces the system to remain elastic
	%end
	% force elastic here
	%if CasetoRun==4
	%    elastic=1;
	%end
	%if CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==15 || CasetoRun==14
	%    elastic=1;
	%end
	Rimp=zeros(8,1);
	if Debugging.Active && CloseEnough(t_time,Debugging.Time,1e-5,2) && spid==Debugging.Particle
        1;
    end
	if elastic
		substepiter=1;
		sigma{2}=sigmatrial;
		alphahp{2}=alphahp{2};
		substepiter=2;
	else
		alphafactchosen=min(alphafact);
		for i=1:7
			if alphafactchosen==alphafact(i)
				chosensurface=i;
				break;
			end
		end
		alphafactchosen=max(0,alphafactchosen);
		sigma{2}=sigma{1}+alphafactchosen*C*deltaepsilon;
		alphahp{2}=alphahp{1};
		deltaepsilone=(1-alphafactchosen)*deltaepsilon;
		deltasigmae=(1-alphafactchosen)*C*deltaepsilon;
		T=0;
		deltaT=1;
		substepiter=2;
		last5surfaces=zeros(5,2);
		consistentmultisurfaceconfirmed=0;
		implicithasfailed=0;
		stoprepeater=0;
		implicitsubstepfactor=10;
		implicitsubstepnumber=0;
		while substepiter<inf
			if deltaT<1e-4
				1;
			end
			if Debugging.Active && CloseEnough(t_time,Debugging.Time,1e-5,2) && spid==Debugging.Particle
				1;
				if substepiter>=2
					disp('plastic');
					substepiter;
					alphahp{2};
					stoprepeater=stoprepeater+1;
					stoprepeater;
					1;
					if consistentmultisurfaceconfirmed==1
						1;
					end
					if stoprepeater>=Debugging.DesignatedStopRepeater
						1;
					end
				end
			end
			
			if min(alphahp{2})<0
				fprintf('%s',['alphahp < zero found!' char(10)]);
				1;
				pause
				1;
			end
			if T==1
				[qtest,~]=qandDfromalpha2(alphahp{2},ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit);
				evaltimes=evaltimes+1;
				[ftest,~]=Wood_Schmidt_EvalSigmaEff(sigma{2},qtest,[1 2 3 4 5 6 7],[1 0 0 0 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);
				if CellMax(ftest)<NormLimit
					break
				else
					implicithasfailed=1;
					1;
				end
			elseif T>1
				fprintf('%s',['T>1' char(10)]);
				pause
			end
			deltaT=min(deltaT,1-T);
			sigma1=sigma{2};
			alpha1=alphahp{2};
			sigma1trial=sigma1+deltasigmae*deltaT;
			if consistentmultisurfaceconfirmed==1 && implicithasfailed==0
				if implicitsubstepnumber==0
					%disp('Implicit is a go!')
				end
				alphaimpn=alpha1;                
				alphaimp=alphaimpn;
				sigmaimpn=sigma1trial;
				%sigmaimp=transpose([0 0 0 0 0 0]);
				[q,dqdalpha,~]=qandDfromalpha2(alphaimpn,ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit);
				evaltimes=evaltimes+1;
				[f,dfdsigma,dfdqchosen,d2fdsigma2,~]=Wood_Schmidt_EvalSigmaEff(sigmaimpn,q,[chosensurface1 chosensurface2],[0 1 0 0 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);
				
				deltagamma1startreference=transpose(dfdsigma{chosensurface1})*sigma1trial/(transpose(dfdsigma{chosensurface1})*C*dfdsigma{chosensurface1});
				deltagamma2startreference=transpose(dfdsigma{chosensurface2})*sigma1trial/(transpose(dfdsigma{chosensurface2})*C*dfdsigma{chosensurface2});

				deltagamma1=deltagamma1startreference;
				deltagamma2=deltagamma2startreference;
				
				sigmaimp=sigma1trial-C*(deltagamma1*dfdsigma{chosensurface1}+deltagamma2*dfdsigma{chosensurface2});
				
				alphaimp(chosensurface1)=alphaimpn(chosensurface1)+deltagamma1;
				alphaimp(chosensurface2)=alphaimpn(chosensurface2)+deltagamma2;
				alphaerrortracker=zeros(1,16);
				for alphaiteration=1:99999
					if alphaiteration==40
						implicithasfailed=1;
						break;
					end
					[q,dqdalpha,~]=qandDfromalpha2(alphaimp,ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit);
					imperrortracker=zeros(1,16);
					for impiteration=1:100
						if impiteration==20
							implicithasfailed=1;
							break;
						end
						evaltimes=evaltimes+1;
						[f,dfdsigma,dfdqchosen,d2fdsigma2,~]=Wood_Schmidt_EvalSigmaEff(sigmaimp,q,[chosensurface1 chosensurface2],[1 1 0 1 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);
						Rimp(1:6,1)=sigmaimp-sigmaimpn+C*(deltagamma1*dfdsigma{chosensurface1}+deltagamma2*dfdsigma{chosensurface2});
						%Rimp(7,1)=alphaimp(chosensurface1)-alphaimpn(chosensurface1)-deltagamma1;
						%Rimp(8,1)=alphaimp(chosensurface2)-alphaimpn(chosensurface2)-deltagamma2;
						Rimp(7,1)=f{chosensurface1};
						Rimp(8,1)=f{chosensurface2};
						Err=sqrt(dot(Rimp,Rimp));
						for i=15:-1:1
							imperrortracker(i+1)=imperrortracker(i);
						end
						imperrortracker(1)=Err;
						if Err<NormLimit
							break
						end
						if impiteration>=16
							m=ManualLinReg([1:16],log(imperrortracker));
							if m<0
							%if imperrortracker(1)>sum(imperrortracker(2:5))/4;
								%disp('no error improvement, implicit newton terminated');
								implicithasfailed=1;
								break;
							end
						end
						J=zeros(8,8);
						J(1:6,1:6)=eye(6,6)+C*(deltagamma1*d2fdsigma2{chosensurface1}+deltagamma2*d2fdsigma2{chosensurface2});
						J(1:6,7)=C*dfdsigma{chosensurface1};
						J(1:6,8)=C*dfdsigma{chosensurface2};
						%J(7,7)=1;
						%J(8,8)=1;
						%J(7,9)=-1;
						%J(8,10)=-1;
						J(7,1:6)=transpose(dfdsigma{chosensurface1});
						J(8,1:6)=transpose(dfdsigma{chosensurface2});
						%J(9,7)=dqdalpha(chosensurface1);
						%J(10,8)=dqdalpha(chosensurface2);
						if rcond(J)<1e-15
							implicithasfailed=1;
							break;
						end
						deltaX=-(J^-1)*Rimp;
						sigmaimp=sigmaimp+deltaX(1:6,1);
						%alphaimp(chosensurface1)=alphaimp(chosensurface1)+deltaX(7,1);
						%alphaimp(chosensurface2)=alphaimp(chosensurface2)+deltaX(8,1);
						deltagamma1=deltagamma1+deltaX(7,1);
						deltagamma2=deltagamma2+deltaX(8,1);
						%if deltagamma1<0
							%{
							deltagamma1startreference=deltagamma1startreference*2;
							deltagamma1=deltagamma1startreference;
							sigmaimp=sigma1trial-C*(deltagamma1*dfdsigma{chosensurface1}+deltagamma2*dfdsigma{chosensurface2});
							alphaimp(chosensurface1)=alphaimpn(chosensurface1)+deltagamma1;
							%}
							%implicithasfailed=1;
							%break;
						%end
						%if deltagamma2<0
							%{
							deltagamma2startreference=deltagamma2startreference*2;
							deltagamma2=deltagamma2startreference;
							sigmaimp=sigma1trial-C*(deltagamma1*dfdsigma{chosensurface1}+deltagamma2*dfdsigma{chosensurface2});
							alphaimp(chosensurface2)=alphaimpn(chosensurface2)+deltagamma2;
							%}
							%implicithasfailed=1;
							%break;
						%end
						%{
						[q,dqdalpha,d2qdalpha2]=qandDfromalpha2(alphaimp);
						[f,dfdsigma,dfdqchosen,d2fdsigma2,~]=Wood_Schmidt_EvalSigmaEff(sigmaimp,q,chosensurface,[1 1 1 1 0 0]);
						Rimp(1:6,1)=-epsilonpimp+epsilonpimpn+deltagamma*dfdsigma{chosensurface};
						Rimp(7,1)=-alphaimp(chosensurface)+alphaimpn(chosensurface)+deltagamma;
						if impiteration>1 & sqrt(dot(Rimp,Rimp))<NormLimit & f{chosensurface}<NormLimit
							break
						end
						Ainv=zeros(7,7);
						Ainv(1:6,1:6)=(C^-1)+deltagamma*d2fdsigma2{chosensurface};
						Ainv(7,7)=-(1/dqdalpha(chosensurface));
						Aimp=Ainv^-1;
						delta2gamma=(f{chosensurface}-[transpose(dfdsigma{chosensurface}) 1]*Aimp*Rimp)/([transpose(dfdsigma{chosensurface}) 1]*Aimp*[dfdsigma{chosensurface};1]);
						deltaepsilondeltaalpha=[C^-1 zeros(6,1);zeros(1,6) -(1/dqdalpha(chosensurface))]*Aimp*(Rimp+delta2gamma*[dfdsigma{chosensurface};1]);
						epsilonpimp=epsilonpimp+deltaepsilondeltaalpha(1:6);
						alphaimp(chosensurface)=alphaimp(chosensurface)+deltaepsilondeltaalpha(7);
						deltagamma=deltagamma+delta2gamma;
						%}
					end
					if implicithasfailed==1
						break;
					end
					alphaimp1new=alphaimpn(chosensurface1)+deltagamma1;
					alphaimp2new=alphaimpn(chosensurface2)+deltagamma2;
					alphaerror=sqrt((alphaimp(chosensurface1)-alphaimp1new)^2+(alphaimp(chosensurface2)-alphaimp2new)^2);
					for i=15:-1:1
						alphaerrortracker(i+1)=alphaerrortracker(i);
					end
					alphaerrortracker(1)=alphaerror;
					alphaimp(chosensurface1)=alphaimp1new;
					alphaimp(chosensurface2)=alphaimp2new;
					if alphaerror<NormLimit
						break;
					end
					if alphaiteration>=16
						m=ManualLinReg([1:16],log(alphaerrortracker));
						if m<0
						%if alphaerrortracker(1)>alphaerrortracker(5)
							%disp('no error improvement, alpha iteration terminated');
							implicithasfailed=1;
							break;
						end
					end
				end
				if implicithasfailed==1
					if implicitsubstepnumber<=4
						%disp('Implicit Didnt converge, substepping');
						deltaT=min(deltaT/implicitsubstepfactor,1-T);
						implicithasfailed=0;
						implicitsubstepnumber=implicitsubstepnumber+1;
					else
						%disp('Implicit Didnt converge, switching back');
						implicithasfailed=1;
					end
					continue;
				end
				sigma{3}=sigmaimp;
				alphahp{3}=alphaimp;
				if deltagamma1>min(0,-alphaimp(chosensurface1)*NormLimit) && deltagamma2>min(0,-alphaimp(chosensurface2)*NormLimit)
					substepiter=substepiter+1;
					sigma{2}=sigma{3};
					alphahp{2}=alphahp{3};
					T=T+deltaT;
					deltaT=min(1-T,deltaT*min(1.5,10^(implicitsubstepnumber)));
					implicitsubstepnumber=implicitsubstepnumber-(log(1.5)/log(10));
				else
					%disp('deltagamma less than zero!')
					if implicitsubstepnumber<=4
						%disp('Implicit Didnt converge, substepping');
						deltaT=min(deltaT/implicitsubstepfactor,1-T);
						implicithasfailed=0;
						implicitsubstepnumber=implicitsubstepnumber+1;
					else
						%disp('Implicit Didnt converge, switching back')
						implicithasfailed=1;
					end
					1;
				end
				continue;
			end
			[q,dqdalpha,d2qdalpha2]=qandDfromalpha2(alpha1,ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit);
			evaltimes=evaltimes+2;
			[f10,~]=Wood_Schmidt_EvalSigmaEff(sigma1,q,[1 2 3 4 5 6 7],[1 0 0 0 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);
			[f1trial,~]=Wood_Schmidt_EvalSigmaEff(sigma1trial,q,[1 2 3 4 5 6 7],[1 0 0 0 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);
			elastic=1;
			for i=1:7
				if f1trial{i}>0 && f1trial{i}>f10{i}
					alphafact(i)=(f10{i}/(f10{i}-f1trial{i}));
					elastic=0;
				else
					if f1trial{i}>0
						%disp(['Warning for spid=' num2str(spid) ': f1trial{' num2str(i) '}>0 but <f10{' num2str(i) '}, special treatment is assumed']);
						%disp('Press any key to continue');
						%pause;
						alphafact(i)=-f10{i};
						elastic=0;
						1;
					else
						alphafact(i)=1;
					end
				end
			end
			if elastic
				%disp('Turns Out to be Elastic on deltalambda1');
				deltalambda1=0;
				deltalambdanice=0;
				deltasigmanice=0;
				sigma{3}=sigma1trial;
				T=T+deltaT;
				alphahp{3}=alphahp{2};
				substepiter=substepiter+1;
				sigma{2}=sigma{3}; %packaged with substepiter++
				alphahp{2}=alphahp{3}; %packaged with substepiter++
				qfordeltaT=2;
				deltaT=deltaT*qfordeltaT;
				continue;
			else
				alphafactchosen=min(alphafact);
				if alphafactchosen~=1
					for i=1:7
						if alphafactchosen==alphafact(i)
							chosensurface=i;
						end
					end
				end
				alphafactchosen=max(0,alphafactchosen);
				evaltimes=evaltimes+1;
				[DUMMY,dfdsigma,dfdqchosen,d2fdsigma2,~]=Wood_Schmidt_EvalSigmaEff(sigma1,q,chosensurface,[0 1 1 1 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);
				A1=-dfdqchosen{chosensurface}(chosensurface)*dqdalpha(chosensurface);
				%A1=-dfdqchosen{chosensurface}(chosensurface)*dqdalpha(chosensurface)*([1 1 1 1 1 1])*dfdsigma{chosensurface};
				B=transpose(dfdsigma{chosensurface})*C*dfdsigma{chosensurface};
				%deltalambda1=(transpose(dfdsigma{chosensurface})*deltasigmae*deltaT+max(0,(2*deltaT/(1-T))*f10{chosensurface}))/(A1+B);
				deltalambda1=(transpose(dfdsigma{chosensurface})*deltasigmae*deltaT)/(A1+B);
				deltalambdanice=f10{chosensurface}/(A1+B);
				deltasigmanice=-C*deltalambdanice*dfdsigma{chosensurface};
				chosensurface1=chosensurface;
			end
			%recalculating dfdsigma and dfdq
			
			%end of recalculating dfdsigma and dfdq
			
			%deltalambdadrift=f10{chosensurface};
			%deltalambda1=(transpose(dfdsigma{chosensurface})*deltasigmae*deltaT+max(0,deltaT*fprev{chosensurface}))/(A1+B);
			deltalambda1ok=1;
			if deltalambda1<0
				%disp('deltalambda1<0!')
				if A1+B<0
					%disp('A<B!')
					%deltaTbackup=deltaT;
					%deltaT=0;
					%printvector(substepiter,'substepiter');
					%printvector(chosensurface,'chosensurface');
					%printvector(alphafactchosen,'alphafactchosen');
					%printvector(sigma{2},'sigma{2}');
					%printvector(alphahp{2},'alphahp{2}');
					%uisave;
					Aq1=0.5*transpose(C*dfdsigma{chosensurface})*(d2fdsigma2{chosensurface})*(C*dfdsigma{chosensurface})+0.5*d2qdalpha2(chosensurface);
					%Bq1=dqdalpha(chosensurface)-transpose(dfdsigma{chosensurface})*C*dfdsigma{chosensurface}-transpose(C*dfdsigma{chosensurface})*d2fdsigma2{chosensurface}*(deltasigmae*deltaT);
					%Cq1=transpose(dfdsigma{chosensurface})*deltasigmae*deltaT+max(0,(2*deltaT/(1-T))*f10{chosensurface})+0.5*transpose(deltasigmae*deltaT)*d2fdsigma2{chosensurface}*(deltasigmae*deltaT);
					%Cq1=transpose(dfdsigma{chosensurface})*deltasigmae*deltaT+max(0,deltaT*fprev{chosensurface})+0.5*transpose(deltasigmae*deltaT)*d2fdsigma2{chosensurface}*(deltasigmae*deltaT);
					Pq1=(-transpose(C*dfdsigma{chosensurface})*d2fdsigma2{chosensurface}*deltasigmae)^2+(-2*transpose(C*dfdsigma{chosensurface})*d2fdsigma2{chosensurface}*C*dfdsigma{chosensurface}-2*d2qdalpha2(chosensurface))*(1/2)*transpose(deltasigmae)*d2fdsigma2{chosensurface}*deltasigmae;
					Qq1=2*transpose(C*dfdsigma{chosensurface})*d2fdsigma2{chosensurface}*deltasigmae*(transpose(dfdsigma{chosensurface})*C*dfdsigma{chosensurface}-dqdalpha(chosensurface))+(-2*transpose(C*dfdsigma{chosensurface})*d2fdsigma2{chosensurface}*C*dfdsigma{chosensurface}-2*d2qdalpha2(chosensurface))*transpose(dfdsigma{chosensurface})*deltasigmae;
					Rq1=(-transpose(dfdsigma{chosensurface})*C*dfdsigma{chosensurface}+dqdalpha(chosensurface))^2+(-2*transpose(C*dfdsigma{chosensurface})*d2fdsigma2{chosensurface}*C*dfdsigma{chosensurface}-2*d2qdalpha2(chosensurface))*f10{chosensurface};
					if Rq1<=0
						deltalambda1=0;
					else
						Kq1=-(Pq1/(2*sqrt(Rq1))-Qq1^2/(8*Rq1*sqrt(Rq1)))/(2*Aq1);
						Lq1a=(transpose(C*dfdsigma{chosensurface})*d2fdsigma2{chosensurface}*deltasigmae-Qq1/(2*sqrt(Rq1)))/(2*Aq1);
						Lq1b=(transpose(C*dfdsigma{chosensurface})*d2fdsigma2{chosensurface}*deltasigmae+Qq1/(2*sqrt(Rq1)))/(2*Aq1);
						Lq1=max(Lq1a,Lq1b);
						Mq1=(transpose(dfdsigma{chosensurface})*C*dfdsigma{chosensurface}-dqdalpha(chosensurface)-sqrt(Rq1))/(2*Aq1);
						%deltalambda1=(-Bq1-sqrt(Bq1^2-4*Aq1*Cq1))/(2*Aq1);
						%deltalambda1=Kq1*deltaT^2+Lq1*deltaT+Mq1;
						%deltalambda1=Kq1*deltaT^2+Lq1*deltaT+(200*deltaT/(1-T))*Mq1;
						%deltalambda1=Kq1*deltaT^2+Lq1*deltaT;
						deltalambda1=Lq1*deltaT;
						if deltalambda1<0
							deltalambda1=0;
						end
					end
					%deltalambdadrift=Mq1;
					%disp('deltalambda1 not ok');
					deltalambda1ok=0;
				else
					deltalambda1=0;
				end
			end
			
			%intermediate for calculating alphahp nice
			deltasigma1=deltasigmae*deltaT-deltalambda1*C*dfdsigma{chosensurface};
			deltaalpha1=[0 0 0 0 0 0 0];
			deltaalpha1(chosensurface)=deltalambda1;
			% start of deltalambdaok
			%if deltalambda1ok
			sigma2=sigma1+deltasigma1;
			alpha2=alpha1+deltaalpha1;
			[q,dqdalpha,d2qdalpha2]=qandDfromalpha2(alpha2,ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit);
			evaltimes=evaltimes+1;
			[f20,~]=Wood_Schmidt_EvalSigmaEff(sigma2,q,[1 2 3 4 5 6 7],[1 0 0 0 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);
			%alphanice=f20{chosensurface}/f10{chosensurface};
			%deltalambda1=deltalambda1+alphanice*deltalambdadrift;
			%deltasigmanice=-deltalambdadrift*C*dfdsigma{chosensurface}
			%end of intermediate for calculating alphahp nice
			
			%deltasigma1=deltasigmae*deltaT-deltalambda1*C*dfdsigma{chosensurface};
			%deltaalpha1=[0 0 0 0 0 0 0];
			%deltaalpha1(chosensurface)=deltalambda1;
			% start of deltalambdaok
			%if deltalambda1ok
			%sigma2=sigma1+deltasigma1;%+alphanice*deltasigmanice;
			%alpha2=alpha1+deltaalpha1;%+alphanice*deltalambdadrift;
			%[q,dqdalpha,d2qdalpha2]=qandDfromalpha2(alpha2);
			%[f20,dfdsigma,dfdqchosen,~]=Wood_Schmidt_EvalSigmaEff(sigma2,q,[1 2 3 4 5 6 7],[1 0 0 0 0 0]);
			sigma2trial=sigma2+deltasigmae*deltaT;
			evaltimes=evaltimes+1;
			[f2trial,~]=Wood_Schmidt_EvalSigmaEff(sigma2trial,q,[1 2 3 4 5 6 7],[1 0 0 0 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);
			elastic=1;
			for i=1:7
				if f2trial{i}>0 && f2trial{i}>f20{i}
					alphafact(i)=(f20{i}/(f20{i}-f2trial{i}));
					elastic=0;
				else
					if f2trial{i}>0
						%disp(['Warning for spid=' num2str(spid) ': f2trial{' num2str(i) '}>0 but <f20{' num2str(i) '}, special treatment is assumed']);
						%disp('Press any key to continue');
						%pause;
						alphafact(i)=-f20{i};
						elastic=0;
						1;
					else
						alphafact(i)=1;
					end
				end
				
			end
			if elastic
				%disp('Turns Out to be Elastic on deltalambda2');
				deltalambda2=0;
			else
				alphafactchosen=min(alphafact);
				if alphafactchosen~=1
					for i=1:7
						if alphafactchosen==alphafact(i)
							chosensurface=i;
						end
					end
				end
				if implicithasfailed && deltaT<1e-3
					chosensurface=chosensurface1;
				end
				alphafactchosen=max(0,alphafactchosen);
				evaltimes=evaltimes+1;
				[DUMMY,dfdsigma,dfdqchosen,d2fdsigma2,~]=Wood_Schmidt_EvalSigmaEff(sigma2,q,chosensurface,[0 1 1 1 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);
				A2=-dfdqchosen{chosensurface}(chosensurface)*dqdalpha(chosensurface);
				%A2=-dfdqchosen{chosensurface}(chosensurface)*dqdalpha(chosensurface)*([1 1 1 1 1 1])*dfdsigma{chosensurface};
				B=transpose(dfdsigma{chosensurface})*C*dfdsigma{chosensurface};
				%deltalambda2=(transpose(dfdsigma{chosensurface})*deltasigmae*deltaT+max(0,(2*deltaT/(1-T))*f20{chosensurface}))/(A2+B);
				deltalambda2=(transpose(dfdsigma{chosensurface})*deltasigmae*deltaT)/(A2+B);
				%deltalambda2=(transpose(dfdsigma{chosensurface})*deltasigmae*deltaT+max(0,deltaT*fprev{chosensurface}))/(A2+B);
				chosensurface2=chosensurface;
			end
			deltalambda2ok=1;


			if deltalambda2<0
				%disp('deltalambda2<0!')
				if A2+B<0
					%printvector(substepiter,'substepiter');
					%printvector(chosensurface,'chosensurface');
					%printvector(alphafactchosen,'alphafactchosen');
					%printvector(sigma{2},'sigma{2}');
					%printvector(alphahp{2},'alphahp{2}');
					Aq2=0.5*transpose(C*dfdsigma{chosensurface})*(d2fdsigma2{chosensurface})*(C*dfdsigma{chosensurface})+0.5*d2qdalpha2(chosensurface);
					%Bq2=dqdalpha(chosensurface)-transpose(dfdsigma{chosensurface})*C*dfdsigma{chosensurface}-transpose(C*dfdsigma{chosensurface})*d2fdsigma2{chosensurface}*(deltasigmae*deltaT);
					%Cq2=transpose(dfdsigma{chosensurface})*deltasigmae*deltaT+max(0,(2*deltaT/(1-T))*f20{chosensurface})+0.5*transpose(deltasigmae*deltaT)*d2fdsigma2{chosensurface}*(deltasigmae*deltaT);
					%Cq2=transpose(dfdsigma{chosensurface})*deltasigmae*deltaT+max(0,deltaT*fprev{chosensurface})+0.5*transpose(deltasigmae*deltaT)*d2fdsigma2{chosensurface}*(deltasigmae*deltaT);
					Pq2=(-transpose(C*dfdsigma{chosensurface})*d2fdsigma2{chosensurface}*deltasigmae)^2+(-2*transpose(C*dfdsigma{chosensurface})*d2fdsigma2{chosensurface}*C*dfdsigma{chosensurface}-2*d2qdalpha2(chosensurface))*(1/2)*transpose(deltasigmae)*d2fdsigma2{chosensurface}*deltasigmae;
					Qq2=2*transpose(C*dfdsigma{chosensurface})*d2fdsigma2{chosensurface}*deltasigmae*(transpose(dfdsigma{chosensurface})*C*dfdsigma{chosensurface}-dqdalpha(chosensurface))+(-2*transpose(C*dfdsigma{chosensurface})*d2fdsigma2{chosensurface}*C*dfdsigma{chosensurface}-2*d2qdalpha2(chosensurface))*transpose(dfdsigma{chosensurface})*deltasigmae;
					Rq2=(-transpose(dfdsigma{chosensurface})*C*dfdsigma{chosensurface}+dqdalpha(chosensurface))^2+(-2*transpose(C*dfdsigma{chosensurface})*d2fdsigma2{chosensurface}*C*dfdsigma{chosensurface}-2*d2qdalpha2(chosensurface))*f20{chosensurface};
					if Rq2<=0
						deltalambda2=0;
					else
						Kq2=-(Pq2/(2*sqrt(Rq2))-Qq2^2/(8*Rq2*sqrt(Rq2)))/(2*Aq2);
						Lq2a=(transpose(C*dfdsigma{chosensurface})*d2fdsigma2{chosensurface}*deltasigmae-Qq2/(2*sqrt(Rq2)))/(2*Aq2);
						Lq2b=(transpose(C*dfdsigma{chosensurface})*d2fdsigma2{chosensurface}*deltasigmae+Qq2/(2*sqrt(Rq2)))/(2*Aq2);
						Lq2=max(Lq2a,Lq2b);
						Mq2=(transpose(dfdsigma{chosensurface})*C*dfdsigma{chosensurface}-dqdalpha(chosensurface)-sqrt(Rq2))/(2*Aq2);
						%deltalambda1=(-Bq1-sqrt(Bq1^2-4*Aq2*Cq2))/(2*Aq2);
						%deltalambda1=Kq2*deltaT^2+Lq2*deltaT+Mq2;
						%deltalambda2=Kq2*deltaT^2+Lq2*deltaT+(200*deltaT/(1-T))*Mq2;
						%deltalambda2=Kq2*deltaT^2+Lq2*deltaT;
						%deltalambda2ok=0;
						deltalambda2=Lq2*deltaT;
						if deltalambda2<0
							deltalambda2=0;
						end
					end
					%disp('deltalambda2 not ok');
					deltalambda2ok=0;
					%uisave;
				else
					deltalambda2=0;
				end
			end
			%if deltalambda2ok
			deltasigma2=deltasigmae*deltaT-deltalambda2*C*dfdsigma{chosensurface};
			deltaalpha2=[0 0 0 0 0 0 0];
			deltaalpha2(chosensurface)=deltalambda2;%+alphanice*deltalambdadrift;
			E=0.5*(-deltasigma1+deltasigma2);
			
			sigma{3}=sigma{2}+0.5*(deltasigma1+deltasigma2);
			if deltalambda1ok && deltalambda2ok && (deltaT>0 || deltalambdanice>0)
				sigma{3}=sigma{3}+deltasigmanice;
				R=sqrt(dot(E,E))/sqrt(dot(sigma{3},sigma{3}));
			else
				sigmaimplicitstart=sigma{3};
				R=sqrt(dot(E,E))/sqrt(dot(sigma{3}+deltasigmanice,sigma{3}+deltasigmanice));
			end
			
			surfacehistory(chosensurface1)=1;
			surfacehistory(chosensurface2)=1;

			%{
			if sqrt(dot(deltasigmanice,deltasigmanice))>1;
				1;
			end
			%}
			
			%end
			%else
			%    sigma{3}=sigma{2}+deltasigma1;
			%    R=0;
			%end
				
			% end of delta lambda OK
			
			if R>NormLimit
				qfordeltaT=max(0.8*sqrt(NormLimit/R),0.1);
				deltaT=deltaT*qfordeltaT;
				%disp(['deltaT reduced to ' num2str(deltaT)]);
			else
				T=T+deltaT;
				if deltalambda1ok & deltalambda2ok && (deltaT>0 || deltalambdanice>0)
				%if deltalambda1ok
					deltaalphataken=0.5*(deltaalpha1+deltaalpha2);
					alphahp{3}=alphahp{2}+deltaalphataken;
					deltalambdanice=max([deltalambdanice -deltaalphataken(chosensurface1)]);
					alphahp{3}(chosensurface1)=alphahp{3}(chosensurface1)+deltalambdanice;
				%else
				%    alphahp{3}=alphahp{2}+(deltaalpha1);
				%end
				else
					alphaimplicitstart=alphahp{2}+0.5*(deltaalpha1+deltaalpha2);
					[q,~]=qandDfromalpha2(alphaimplicitstart,ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit);
					evaltimes=evaltimes+1;
					[fimplicitstart,~]=Wood_Schmidt_EvalSigmaEff(sigmaimplicitstart,q,[1 2 3 4 5 6 7],[1 0 0 0 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);

					sigmaimplicitstarttrial=sigmaimplicitstart+deltasigmae*deltaT;
					evaltimes=evaltimes+1;
					[fimplicitstarttrial,~]=Wood_Schmidt_EvalSigmaEff(sigmaimplicitstarttrial,q,[1 2 3 4 5 6 7],[1 0 0 0 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);
					for i=1:7
						if fimplicitstarttrial{i}<=0
							alphafact(i)=1;
						else
							alphafact(i)=(fimplicitstart{i}/(fimplicitstart{i}-fimplicitstarttrial{i}));
							if alphafact(i)>1
								alphafact(i)=-fimplicitstarttrial{i};
							end
						end
					end
					if chosensurface1==chosensurface2
						chosensurface=chosensurface1;
					elseif deltalambda1ok==0 && deltalambda2ok==1
						chosensurface=chosensurface1;
					elseif deltalambda1ok==1 && deltalambda2ok==0
						chosensurface=chosensurface2;
					else
						alphafactchosen=min(alphafact);
						if alphafactchosen~=1
							for i=1:7
								if alphafactchosen==alphafact(i)
									chosensurface=i;
								end
							end
						end
					end
					surfacehistory(chosensurface)=1;
					%{
					if chosensurface1==chosensurface2
						chosensurface=chosensurface1;
					else
						if deltalambda1ok==0 & deltalambda2ok==0
							disp('warning: ambiguous choice of chosensurface for implicit correction');
							uisave;
							chosensurface=chosensurface2;
						elseif deltalambda1ok==0
							chosensurface=chosensurface1;
						elseif deltalambda2ok==0
							chosensurface=chosensurface2;
						else
							disp('unexpected error here');
							uisave;
						end
					end
					%}
					1;
					% start of deltalambda guess (alphahp-widening)
					if CellMax(fimplicitstart)>0
						[q,dqdalpha,d2qdalpha2]=qandDfromalpha2(alphaimplicitstart,ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit);
						evaltimes=evaltimes+1;
						[fimplicitstart,dfdsigma,dfdqchosen,~]=Wood_Schmidt_EvalSigmaEff(sigmaimplicitstart,q,chosensurface,[1 1 1 0 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);
						if deltaT==0
							deltalambdaguess=1.1*transpose(dfdsigma{chosensurface})*deltaepsilone*(NormLimit^2)/(transpose(dfdsigma{chosensurface})*dfdsigma{chosensurface});
						else
							deltalambdaguess=1.1*transpose(dfdsigma{chosensurface})*deltaepsilone*deltaT/(transpose(dfdsigma{chosensurface})*dfdsigma{chosensurface});
						end
						if deltalambdaguess<=0
							%disp('deltalambdaguess<0!')
							if deltaT==0
								deltalambdaguess=-0.1*transpose(dfdsigma{chosensurface})*deltaepsilone*(NormLimit^2)/(transpose(dfdsigma{chosensurface})*dfdsigma{chosensurface});
							else
								deltalambdaguess=-0.1*transpose(dfdsigma{chosensurface})*deltaepsilone*deltaT/(transpose(dfdsigma{chosensurface})*dfdsigma{chosensurface});
							end
							%deltalambdaguess=-0.1*transpose(dfdsigma{chosensurface})*deltaepsilone*deltaT/(transpose(dfdsigma{chosensurface})*dfdsigma{chosensurface});
						end
						for wideningiteration=1:99999
							alphawidened=alphaimplicitstart;
							alphawidened(chosensurface)=alphaimplicitstart(chosensurface)+deltalambdaguess;
							sigmawidened=sigmaimplicitstart-C*deltalambdaguess*dfdsigma{chosensurface};
							[q,dqdalpha,d2qdalpha2]=qandDfromalpha2(alphawidened,ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit);
							evaltimes=evaltimes+1;
							[fimplicitstart,dfdsigma,~]=Wood_Schmidt_EvalSigmaEff(sigmawidened,q,chosensurface,[1 1 0 0 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);
							if fimplicitstart{chosensurface}<0
								break
							else
								deltalambdaguess=deltalambdaguess*1.1;
							end
						end
						
						% end of deltalambda guess
					end
					
					% start of implicit iteration
					%{
					epsilontimp=epsilont+T*deltaepsilon;
					epsiloneimp=(C^-1)*sigmaimplicitstart;
					epsilonpimpn=epsilontimp-epsiloneimp;
					epsilonpimp=epsilontimp-epsiloneimp;
					%}
					alphaimpn=alphaimplicitstart;                
					alphaimp=alphawidened;
					sigmaimpn=sigmaimplicitstart;
					sigmaimp=sigmawidened;
					deltagamma=0;
					for impiteration=1:99999
						[q,dqdalpha,~]=qandDfromalpha2(alphaimp,ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit);
						evaltimes=evaltimes+1;
						[f,dfdsigma,dfdqchosen,d2fdsigma2,~]=Wood_Schmidt_EvalSigmaEff(sigmaimp,q,chosensurface,[1 1 0 1 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);
						Rimp(1:6,1)=sigmaimp-sigmaimpn+C*deltagamma*dfdsigma{chosensurface};
						Rimp(7,1)=alphaimp(chosensurface)-alphaimpn(chosensurface)-deltagamma;
						Rimp(8,1)=f{chosensurface};
						Err=sqrt(dot(Rimp,Rimp));
						if Err<NormLimit
							break
						end
						J=zeros(8,8);
						J(1:6,1:6)=eye(6,6)+C*deltagamma*d2fdsigma2{chosensurface};
						J(1:6,8)=C*dfdsigma{chosensurface};
						J(7,7)=1;
						J(7,8)=-1;
						J(8,1:6)=transpose(dfdsigma{chosensurface});
						J(8,7)=dqdalpha(chosensurface);
						deltaX=-(J^-1)*Rimp;
						sigmaimp=sigmaimp+deltaX(1:6,1);
						alphaimp(chosensurface)=alphaimp(chosensurface)+deltaX(7,1);
						deltagamma=deltagamma+deltaX(8,1);
						%{
						[q,dqdalpha,d2qdalpha2]=qandDfromalpha2(alphaimp);
						[f,dfdsigma,dfdqchosen,d2fdsigma2,~]=Wood_Schmidt_EvalSigmaEff(sigmaimp,q,chosensurface,[1 1 1 1 0 0]);
						Rimp(1:6,1)=-epsilonpimp+epsilonpimpn+deltagamma*dfdsigma{chosensurface};
						Rimp(7,1)=-alphaimp(chosensurface)+alphaimpn(chosensurface)+deltagamma;
						if impiteration>1 & sqrt(dot(Rimp,Rimp))<NormLimit & f{chosensurface}<NormLimit
							break
						end
						Ainv=zeros(7,7);
						Ainv(1:6,1:6)=(C^-1)+deltagamma*d2fdsigma2{chosensurface};
						Ainv(7,7)=-(1/dqdalpha(chosensurface));
						Aimp=Ainv^-1;
						delta2gamma=(f{chosensurface}-[transpose(dfdsigma{chosensurface}) 1]*Aimp*Rimp)/([transpose(dfdsigma{chosensurface}) 1]*Aimp*[dfdsigma{chosensurface};1]);
						deltaepsilondeltaalpha=[C^-1 zeros(6,1);zeros(1,6) -(1/dqdalpha(chosensurface))]*Aimp*(Rimp+delta2gamma*[dfdsigma{chosensurface};1]);
						epsilonpimp=epsilonpimp+deltaepsilondeltaalpha(1:6);
						alphaimp(chosensurface)=alphaimp(chosensurface)+deltaepsilondeltaalpha(7);
						deltagamma=deltagamma+delta2gamma;
						%}
					end
					sigma{3}=sigmaimp;
					alphahp{3}=alphaimp;

					% end of implicit iteration
				end
				substepiter=substepiter+1;
				sigma{2}=sigma{3}; %packaged with substepiter++
				alphahp{2}=alphahp{3}; %packaged with substepiter++
				%if deltalambda1ok
					qfordeltaT=min(0.8*sqrt(NormLimit/R),2);
					deltaT=deltaT*qfordeltaT;
				%else
				%    deltaT=deltaTbackup;
				%end
			end
			if chosensurface1>0 && chosensurface2>0 && chosensurface1~=chosensurface2
				for i=size(last5surfaces,1):-1:2
					last5surfaces(i,:)=last5surfaces(i-1,:);
				end
				if chosensurface1<chosensurface2
					last5surfaces(1,1)=chosensurface1;
					last5surfaces(1,2)=chosensurface2;
				else
					last5surfaces(1,1)=chosensurface2;
					last5surfaces(1,2)=chosensurface1;
				end
				%disp(['different surfaces carried out, ' num2str(chosensurface1) ' and ' num2str(chosensurface2) ', deltaT=' num2str(deltaT)]);
				consistentmultisurfaceconfirmed=1;
				for i=2:size(last5surfaces,1)
					if last5surfaces(1,1)~=last5surfaces(i,1) || last5surfaces(1,2)~=last5surfaces(i,2)
						consistentmultisurfaceconfirmed=0;
						break;
					end
				end
			end
			%{
			implicitsubstepnumber=0;
			implicithasfailed=0;
			%}
			if consistentmultisurfaceconfirmed==1 && implicithasfailed==0
				deltaT=1-T;
			end
		end
	end
		
	1;
	
	%hardeningsurfacesoriginal=hardeningsurfaces;
	
	%iteration=0;
	%{
	substepnum=10;
	deltaepsilonsubstep=deltaepsilon/substepnum;
	
	
	for substepiter=1:substepnum
		%deltaepsilon=transpose([1*sin(step/100*2*pi) 1*cos(step/100*2*pi) 1/100*step 1*sin(step/100*2*pi) 1*cos(step/100*2*pi) 1/100*step])/1000;
		[q,Dcut]=qandDfromalpha(alphahp{2},hardeningsurfaces);
		sigmatrial=sigma{2}+C*deltaepsilonsubstep;
		evaltimes=evaltimes+2;
		[ftrial,~,~]=Wood_Schmidt_EvalSigmaHardening(sigmatrial,q,hardeningsurfaces);
		[fprev,~,~]=Wood_Schmidt_EvalSigmaHardening(sigma{2},q,hardeningsurfaces);
		elastic=1;
		for i=1:7
			if ftrial{i}<=0
				alphafact(i)=1;
			%elseif fprev{i}<=0 & ftrial{i}>0
			%    alphafact(i)=(fprev{i}/(fprev{i}-ftrial{i}));
			%else
			%    alphafact(i)=0;
			else
				alphafact(i)=(fprev{i}/(fprev{i}-ftrial{i}));
				elastic=0;
			end
		end
		if elastic
			sigma{3}=sigmatrial;
			alphahp{3}=alphahp{2};
		else
			alphafactchosen=min(alphafact);
			for i=1:7
				if alphafactchosen==alphafact(i)
					chosensurface=i;
					break;
				end
			end
			alphafactchosen=max(0,alphafactchosen);
			sigmaalpha=sigma{2}+(sigmatrial-sigma{2})*alphafactchosen;
			[q,Dchosen]=qandDfromalpha(alphahp{2},chosensurface);
			[DUMMY,dfdsigma,dfdqchosen,~]=Wood_Schmidt_EvalSigmaHardening(sigmaalpha,q,chosensurface);
			A=dfdqchosen{chosensurface}*Dchosen;
			deltaepsilonsubstepalpha=deltaepsilonsubstep*(1-alphafactchosen);
			deltalambda=transpose(dfdsigma{chosensurface})*C/(A+transpose(dfdsigma{chosensurface})*C*dfdsigma{chosensurface})*deltaepsilonsubstepalpha;
			if deltalambda<0
				disp('deltalambda<0!')
				printvector(substepiter,'substepiter');
				printvector(chosensurface,'chosensurface');
				printvector(alphafactchosen,'alphafactchosen');
				printvector(sigma{2},'sigma{2}');
				printvector(alphahp{2},'alphahp{2}');
				pause
			end
			Cp=C*dfdsigma{chosensurface}*transpose(dfdsigma{chosensurface})*C/(A+transpose(dfdsigma{chosensurface})*C*dfdsigma{chosensurface});
			Cep=C-Cp;
			alphahp{3}=alphahp{2};
			alphahp{3}(chosensurface)=alphahp{2}(chosensurface)+deltalambda;
			sigma{3}=sigmaalpha+Cep*deltaepsilonsubstepalpha;
		end
	end
	%}
	[q,~]=qandDfromalpha2(alphahp{2},ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit);
	evaltimes=evaltimes+1;
	[f_final,~]=Wood_Schmidt_EvalSigmaEff(sigma{2},q,[1 2 3 4 5 6 7],[1 0 0 0 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);
	[f_maxfinal,surfacewithfmax]=CellMax(f_final);
	f_final_vect=zeros(1,7);
	for i=1:7
		f_final_vect(i)=f_final{i};
	end
	epsilone=Comp*sigma{2};
	epsilont=epsilont+deltaepsilon;
	epsilonp=epsilont-epsilone;
	epsilonp_planestrain=epsilonp;
	if planestressmod
		epsilonp=zeros(6,1);
		for i=1:6
			if i==zdir||i==yzdir||i==xzdir
				continue;
			end
			if planestressmod==2
				if i==ydir||i==xydir
					continue;
				end
			end
			epsilonp(i,1)=epsilonp_planestrain(i,1);
		end
	end
	epsilont=epsilone+epsilonp;

	1;

	%{
	disp('From Previous Step')
	printvector(sigma0,'sigma');
	printvector(epsilonp{step},'epsilonp')
	printvector(epsilont{step}-epsilonp{step},'epsilone');
	printvector(epsilont{step},'epsilont');
	printvector(alphahp{step},'alphahp');
	print11cell(fprev,'f');
	disp(' ')
	printvector(deltaepsilon,'applying deltaepsilon');

	for i=1:7
		if ftrial{i}>0
			elastic=0;
			suspectedsurfaces=[suspectedsurfaces i];
		end
	end
	if elastic
		for i=1:6
			sigma(i,1)=sigmatrial(i);
			%sigmastep(i,step+1)=sigmatrial(i);
		end
		for i=1:7
			fstep(i,step+1)=ftrial{i};
		end
	else
		activesurface=suspectedsurfaces;
		for shediter=1:length(suspectedsurfaces)
			for i=1:length(activesurface)
				reversedactivesurface(1+length(activesurface)-i)=activesurface(i);
			end
			%activesurface=reversedactivesurface;
			sigma=sigmatrial;
			deltagamma=[];
			for i=1:length(activesurface)
				deltagamma(i)=0;
			end
			%start of iteration
			%hardeningsurfaces=[];
			
			
			[q,Dcut]=qandDfromalpha(alphahp{step+1},hardeningsurfaces);
			[f, dfdsigma, dfdqcut, d2fdsigma2, d2fdsigmadqcut, d2fdq2cut]=Wood_Schmidt_EvalSigmaHardening(sigma,q,hardeningsurfaces);
			%q=[ 0.33427665424966501728221146549913, -0.0077191419876790618273584205447933, 0, -0.0077191419876790618273584205447933, 0, -0.10020040080160320641282565130261, -0.0077191419876790618273584205447933];
			%q=[ 0.95, -0.0077191419876790618273584205447933, 0, -0.0077191419876790618273584205447933, 0, -0.10020040080160320641282565130261, -0.0077191419876790618273584205447933];
			%sigma=transpose([0 0 0 0 0 0])
			%sigma=sigma-C*(dfdsigma{1}*0.0037143167443528112177386635295306);
			disp(' ')
			disp('Guess #1, assuming all elastic, deltaepsilone=deltaepsilon')
			
			
	%start of wojtek print
	
	printvector(sigma,'sigma')
	printvector(epsilonp{step+1},'epsilonp')
	printvector(epsilont{step+1}-epsilonp{step+1},'epsilone')
	printvector(epsilont{step+1},'epsilont')
	printvector(alphahp{step+1},'alphahp',activesurface)
	print11cell(f,'f',activesurface)

	%end of wojtek print
			disp(' ');
			disp('Guess #2, assuming all plastic, deltaeisplonp=deltaepsilon');
			
	
			for i=1:length(activesurface)
				%deltagamma(alphaiter)=transpose(deltaepsilon)*dfdsigma{1}/(transpose(dfdsigma{1})*dfdsigma{1});
				deltagamma(i)=f{activesurface(i)}/(transpose(C*dfdsigma{activesurface(i)})*dfdsigma{activesurface(i)});
				alphahp{step+1}(activesurface(i))=alphahp{step}(activesurface(i))+deltagamma(i);
				disp(['best guess of deltaalpha for ' surfacenumtoname(activesurface(i)) ' (surface #' num2str(activesurface(i)) ') = ' num2str(alphahp{step+1}(activesurface(i)))]);
			end

			%start of backforthloop
			for backforthloop=1:999
				%start of alphaexpansion loop
				disp(' ');
				disp(' ');
				disp(['trial #' num2str(backforthloop)]);
				for alphaiter=1:length(activesurface)
					disp([' ']);
					disp(['active surface ' num2str(alphaiter) '/' num2str(length(activesurface)) ' : ' surfacenumtoname(activesurface(alphaiter)) ' (#' num2str(activesurface(alphaiter)) ')']);
					if f{activesurface(alphaiter)}<=0
						disp(' ')
						disp(['f{' num2str(activesurface(alphaiter)) '} already less than zero'])
						disp(['sticking with alphahp(' num2str(activesurface(alphaiter)) ')=' num2str(alphahp{step+1}(activesurface(alphaiter)))]);
						continue
					end
					
					disp(' ')
					%disp(['trial #' num2str(alphaguesstry2)]);
					alphaguesstry2=[];
					alphahp{step+1}(activesurface(alphaiter))=alphahp{step}(activesurface(alphaiter))+deltagamma(alphaiter);
					[q,~]=qandDfromalpha(alphahp{step+1},hardeningsurfaces);
					deltaepsilonp=transpose([0 0 0 0 0 0]);
					for i=1:length(activesurface)
						deltaepsilonp=deltaepsilonp+deltagamma(i)*dfdsigma{activesurface(i)};
					end
					epsilonp{step+1}=epsilonp{step}+deltaepsilonp;
					sigma=sigmatrial-C*deltaepsilonp;
					[f,dfdsigma]=Wood_Schmidt_EvalSigmaHardening(sigma,q,hardeningsurfaces);

					%start of wojtek print

					printvector(sigma,'sigma')
					printvector(epsilonp{step+1},'epsilonp')
					printvector(epsilont{step+1}-epsilonp{step+1},'epsilone')
					printvector(epsilont{step+1},'epsilont')
					printvector(alphahp{step+1},'alphahp',activesurface)
					print11cell(f,'f',activesurface)


					%end of wojtek print

					if f{(activesurface(alphaiter))}<0
						disp(' ')
						disp(['take alphahp(' num2str(activesurface(alphaiter)) ')=' num2str(alphahp{step+1}(activesurface(alphaiter)))]);
						break
					else
						deltagamma(alphaiter)=deltagamma(alphaiter)*1.2;
						disp(['multiplying deltaalpha of surface ' num2str(alphaiter) '/' num2str(length(activesurface)) ' by 1.2'])
						alphahp{step+1}(activesurface(alphaiter))=alphahp{step}(activesurface(alphaiter))+deltagamma(alphaiter);
						printvector(alphahp{step+1},'alphahp',activesurface)
					end
				end        
				%end of alphahp expansion loop
				alphaexpansionbreaksignal=1;
				for i=1:length(activesurface)
					if f{activesurface(i)}>0
						alphaexpansionbreaksignal=0;
					end
				end
				if alphaexpansionbreaksignal==1
					disp('all f are < 0');
					break
				end
			end
			%end of backforthloop
			%sigma=transpose([0 0 0 0 0 0]);
			disp(' ')
			texttodisplay=['starting newton-rhapson from guess #2, initial sigma=['];
			for i=1:length(sigma);
				if i>1
					texttodisplay=[texttodisplay ','];
				end
				texttodisplay=[texttodisplay num2str(sigma(i))];
			end
			texttodisplay=[texttodisplay ']'];
			disp(texttodisplay);
			deltagamma=zeros(1,length(activesurface));
			alphahp{step+1}=alphahp{step};
			[q,~]=qandDfromalpha(alphahp{step+1},hardeningsurfaces);
			for iteration=1:999
				if step==94
				end
				[f, dfdsigma, dfdqcut, d2fdsigma2, d2fdsigmadqcut, d2fdq2cut]=Wood_Schmidt_EvalSigmaHardening(sigma,q,hardeningsurfaces);
				sigmadeltagammadfdsigmadfdq=zeros(6+length(hardeningsurfaces),1);
				for i=1:length(activesurface)
					sigmadeltagammadfdsigmadfdq=sigmadeltagammadfdsigmadfdq+deltagamma(i)*[dfdsigma{activesurface(i)};dfdqcut{activesurface(i)}];
				end
				epsilonandalphavector=[-epsilonp{step+1}+epsilonp{step}];
				for i=1:length(hardeningsurfaces)
					epsilonandalphavector=[epsilonandalphavector;-alphahp{step+1}(hardeningsurfaces(i))+alphahp{step}(hardeningsurfaces(i))];
				end
				R=epsilonandalphavector+sigmadeltagammadfdsigmadfdq;
				BigR=[R];
				for i=1:length(activesurface);
					BigR=[BigR;f{activesurface(i)}];
				end
				Norm=sqrt(dot(BigR,BigR));
				%disp(['Norm=' num2str(Norm)]);
				if length(activesurface)>1
				end
				Cep=Cepcalc(C,deltagamma,dfdsigma,d2fdsigma2,activesurface);
				if Norm<NormLimit
					break
				end
				%Calculating A
				sigmadeltagammad2fdsigma2dsigmadqdqdsigmadq2=zeros(length(epsilonandalphavector),length(epsilonandalphavector));
				for i=1:length(activesurface)
					sigmadeltagammad2fdsigma2dsigmadqdqdsigmadq2=sigmadeltagammad2fdsigma2dsigmadqdqdsigmadq2+deltagamma(i)*[d2fdsigma2{activesurface(i)} d2fdsigmadqcut{activesurface(i)};transpose(d2fdsigmadqcut{activesurface(i)}) d2fdq2cut{activesurface(i)}];
				end
				Ainv=[C^-1 zeros(6,length(hardeningsurfaces));zeros(length(hardeningsurfaces),6) Dcut^-1]+sigmadeltagammad2fdsigma2dsigmadqdqdsigmadq2;
				A=Ainv^-1;
				Gdown=[];
				Gup=[];
				if step==30
				end
				for alphaindex=1:length(activesurface)
					for beta=1:length(activesurface)
						Gdown(alphaindex,beta)=transpose([dfdsigma{activesurface(alphaindex)};dfdqcut{activesurface(alphaindex)}])*A*[dfdsigma{activesurface(beta)};dfdqcut{activesurface(beta)}];
						%Gup(alphaindex,beta)=1/Gdown(alphaindex,beta);
					end
				end
				Gup=Gdown^-1;
				delta2gamma=[];
				for alphaindex=1:length(activesurface)
					delta2gamma(alphaindex)=0;
					for beta=1:length(activesurface)
						delta2gamma(alphaindex)=delta2gamma(alphaindex)+Gup(alphaindex,beta)*(f{activesurface(beta)}-transpose([dfdsigma{activesurface(beta)};dfdqcut{activesurface(beta)}])*A*R);
					end
				end
				if delta2gamma>0 & iteration==1
					if length(activesurface)==1
						if activesurface==[1];
						end
					end
				end
				deltagamma=deltagamma+delta2gamma;
				shedsignal=0;
				newactivesurface=[];
				%{
				for i=1:length(deltagamma)
					if deltagamma(i)<0
						shedsignal=1;
					else
						newactivesurface=[newactivesurface activesurface(i)];
					end
				end
				if shedsignal==1
					activesurface=newactivesurface;
					break
				end
				%}
				sigmadelta2gammadfdsigmadfdq=zeros(length(epsilonandalphavector),1);
				for beta=1:length(activesurface)
					sigmadelta2gammadfdsigmadfdq=sigmadelta2gammadfdsigmadfdq+delta2gamma(beta)*[dfdsigma{activesurface(beta)};dfdqcut{activesurface(beta)}];
				end
				deltaepsilonpdeltaalpha=[C^-1 zeros(6,length(hardeningsurfaces));zeros(length(hardeningsurfaces),6) Dcut^-1]*A*(R+sigmadelta2gammadfdsigmadfdq);
				deltaepsilonp=deltaepsilonpdeltaalpha(1:6);
				epsilonp{step+1}=epsilonp{step+1}+deltaepsilonp;
				epsilone=epsilont{step+1}-epsilonp{step+1};
				deltaalpha=zeros(7,1);
				for i=1:length(hardeningsurfaces)
					deltaalpha(hardeningsurfaces(i))=deltaepsilonpdeltaalpha(6+i);
					alphahp{step+1}(hardeningsurfaces(i))=alphahp{step+1}(hardeningsurfaces(i))+deltaalpha(hardeningsurfaces(i));
				end
				if iteration==1
					%alphahp{step+1}(1)=alphahp{step}(1)+deltagamma(1);
				end
				%hardeningsurfaces=hardeningsurfacesoriginal;
				
				
	
				
				[q,Dcut]=qandDfromalpha(alphahp{step+1},hardeningsurfaces);
				sigma=C*epsilone;
				
				%start of wojtek display
				disp(' ')
				
		texttodisplay=['step=' num2str(step+1) '; '];
		texttodisplay=[texttodisplay 'iteration=' num2str(iteration) '; '];
		texttodisplay=[texttodisplay 'deltaepsilonmag=' num2str(sqrt(dot(deltaepsilon,deltaepsilon))*100) '%; '];
			disp(texttodisplay)
		texttodisplay=[];
		
		printvector(sigma,'sigma')
		if elastic==0
			printvector(activesurface,'activesurface')
			print11cell(f,'f',activesurface);
			printvector(deltagamma,'deltagamma')
			
		end
		printvector(epsilonp{step+1},'epsilonp')
		printvector(epsilont{step+1}-epsilonp{step+1},'epsilone')
		printvector(epsilont{step+1},'epsilont')
		printvector(alphahp{step+1},'alphahp',activesurface)
				%end of wojtek display
			end
			if shedsignal==1
				continue
			end
			%end of iteration
			breaksignal=1;
			newactivesurface=activesurface;
			%{
			newactivesurface=[];
			for i=1:length(deltagamma)
				if deltagamma(i)<0
					breaksignal=0;
				else
					newactivesurface=[newactivesurface activesurface(i)];
				end
			end
			%}
			if breaksignal
				for i=1:6
					%sigmastep(i,step+1)=sigma(i);
				end
				for i=1:7
					fstep(i,step+1)=f{i};
				end
				break
			else
				activesurface=newactivesurface;
				if length(activesurface)==0
					disp('All Surfaces Shedded, Didnt Converge');
					pause;
				end
			end
		end
	end
	%}
	
	sigma_global_big(1)=sigma{2}(xdir);
	sigma_global_big(2)=sigma{2}(ydir);
	sigma_global_big(3)=sigma{2}(zdir);
	sigma_global_big(4)=sigma{2}(xydir);
	sigma_global_big(5)=sigma{2}(yzdir);
	sigma_global_big(6)=sigma{2}(xzdir);

	sigma_local_big=sigma{2};
	s_sp=zeros(1,3);
	s_sp(1)=sigma_global_big(1);
	s_sp(2)=sigma_global_big(2);
	s_sp(3)=sigma_global_big(4);
	%fprintf('%s',['inside, s_sp(1,1)=' float2scitxt(6,s_sp(1,1)) char(10)]);
	
	e_t_global_big(1)=epsilont(xdir);
	e_t_global_big(2)=epsilont(ydir);
	e_t_global_big(3)=epsilont(zdir);
	e_t_global_big(4)=epsilont(xydir);
	e_t_global_big(5)=epsilont(yzdir);
	e_t_global_big(6)=epsilont(xzdir);


	e_pl_global_big(1)=epsilonp(xdir);
	e_pl_global_big(2)=epsilonp(ydir);
	e_pl_global_big(3)=epsilonp(zdir);
	e_pl_global_big(4)=epsilonp(xydir);
	e_pl_global_big(5)=epsilonp(yzdir);
	e_pl_global_big(6)=epsilonp(xzdir);
	
	e_pl=zeros(1,3);
	e_pl(1)=e_pl_global_big(1);
	e_pl(2)=e_pl_global_big(2);
	e_pl(3)=e_pl_global_big(4);

	alpha_out=alphahp{2};

	%start Calculating tangent stiffness matrix
	if (isnan(thetacrackrtl) || isinf(thetacrackrtl)) && max(alpha_out)>0
		activesurfacelist=zeros(1,0);
		for i=1:length(surfacehistory)
			if surfacehistory(i)==1
				activesurfacelist=[activesurfacelist i];
			end
		end

		if length(activesurfacelist)==0
			Ktangent_local=C;
		else
			[q,dqdalpha,~]=qandDfromalpha2(alpha_out,ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit);

			dqdalphamat=zeros(length(activesurfacelist));
			for i=1:length(activesurfacelist)
				dqdalphamat(i,i)=dqdalpha(activesurfacelist(i));
			end

			dfdsigmamat=zeros(length(sigma_local_big),length(activesurfacelist));
			[~, dfdsigma,~]=Wood_Schmidt_EvalSigmaEff(sigma_local_big,q,activesurfacelist,[1 1 0 0 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);

			for i=1:length(sigma_local_big)
				for j=1:length(activesurfacelist)
					dfdsigmamat(i,j)=dfdsigma{activesurfacelist(j)}(i);
				end
			end

			Ktangent_local=C*(eye(length(sigma_local_big))-dfdsigmamat*(transpose(dfdsigmamat)*C*dfdsigmamat-dqdalphamat)^(-1)*transpose(dfdsigmamat)*C);
		end
		Ktangent_global=zeros(size(Ktangent_local));
		for i=1:length(dirglobal)
			for j=1:length(dirglobal)
				Ktangent_global(i,j)=Ktangent_local(dirglobal(i),dirglobal(j));
			end
		end

		reductiondesignatorvoight=[1 2 4];

		Ktangent_global_2D=zeros(length(reductiondesignatorvoight),length(reductiondesignatorvoight));

		for i=1:length(reductiondesignatorvoight)
			for j=1:length(reductiondesignatorvoight)
				Ktangent_global_2D(i,j)=Ktangent_global(reductiondesignatorvoight(i),reductiondesignatorvoight(j));
			end
		end
		
		voigt=cell(1,6);
		tensor=cell(3,3,3,3);
		
		voigt{1}=[1 1];
		voigt{2}=[2 2];
		voigt{3}=[3 3];
		voigt{4}=[1 2];
		voigt{5}=[2 3];
		voigt{6}=[1 3];

		for i=1:6
			for j=1:6
				tensor{voigt{i}(1),voigt{i}(2),voigt{j}(1),voigt{j}(2)}=[i j];
				tensor{voigt{i}(1),voigt{i}(2),voigt{j}(2),voigt{j}(1)}=[i j];
				tensor{voigt{i}(2),voigt{i}(1),voigt{j}(1),voigt{j}(2)}=[i j];
				tensor{voigt{i}(2),voigt{i}(1),voigt{j}(2),voigt{j}(1)}=[i j];
			end
		end

		Ktangent_global_tens=zeros(3,3,3,3);
		for i=1:3
			for j=1:3
				for k=1:3
					for l=1:3
						Ktangent_global_tens(i,j,k,l)=Ktangent_global(tensor{i,j,k,l}(1),tensor{i,j,k,l}(2));
					end
				end
			end
		end

		
		reductiondesignatortensor=[1 2];
		Ktangent_global_tens_2D=zeros(length(reductiondesignatortensor),length(reductiondesignatortensor),length(reductiondesignatortensor),length(reductiondesignatortensor));

		for i=1:length(reductiondesignatortensor)
			for j=1:length(reductiondesignatortensor)
				for k=1:length(reductiondesignatortensor)
					for l=1:length(reductiondesignatortensor)
						Ktangent_global_tens_2D(i,j,k,l)=Ktangent_global_tens(reductiondesignatortensor(i),reductiondesignatortensor(j),reductiondesignatortensor(k),reductiondesignatortensor(l));
					end
				end
			end
		end
		
		s_sp_tens_2D=zeros(2,2);
		s_sp_tens_2D(1,1)=s_sp(1);
		s_sp_tens_2D(2,2)=s_sp(2);
		s_sp_tens_2D(1,2)=s_sp(3);
		s_sp_tens_2D(2,1)=s_sp(3);
		
		sigmacrosseye=zeros(2,2,2,2); %it's 2D mkay?
		eyecrosser=eye(2);
		
		for i=1:2
			for j=1:2
				for k=1:2
					for l=1:2
						sigmacrosseye(i,j,k,l)=s_sp_tens_2D(i,j)*eyecrosser(k,l);
					end
				end
			end
		end
		
		AbeforeQ_rtl=Ktangent_global_tens_2D+sigmacrosseye;
		
		lambdamin=inf;
		thetamin=NaN;
		ntestedangle=36*1*1*1;
		lambda1=zeros(ntestedangle,1);
		lambda2=zeros(ntestedangle,1);
		theta=zeros(ntestedangle,1);
		n=zeros(2,1);
		h=zeros(2,2,ntestedangle); %1st index: direction; 2nd index: which lambda; 3rd index: which angle
		Qacoustic=zeros(2,2,ntestedangle);
		for i=1:ntestedangle
			if CasetoRun==81
				theta(i)=i/ntestedangle*pi;
			else
				theta(i)=i/ntestedangle*2*pi; %change your checked angle here!
			end
			n(1)=cos(theta(i));
			n(2)=sin(theta(i));
			for m=1:2
				for nn=1:2
					for o=1:2
						for p=1:2
							Qacoustic(nn,o,i)=Qacoustic(nn,o,i)+n(m)*AbeforeQ_rtl(m,nn,o,p)*n(p);
						end
					end
				end
			end
			[h_eig,lambda_eig]=eig(Qacoustic(:,:,i));
			h(:,:,i)=real(h_eig);
			lambda1(i)=real(lambda_eig(1,1));
			lambda2(i)=real(lambda_eig(2,2));
			%{
			lambda1(i)=(AbeforeQ_rtl(1,1,1,1)*n(1)^2)/2 + (AbeforeQ_rtl(1,2,2,1)*n(1)^2)/2 + (AbeforeQ_rtl(2,1,1,2)*n(2)^2)/2 + (AbeforeQ_rtl(2,2,2,2)*n(2)^2)/2 - (AbeforeQ_rtl(1,1,1,1)^2*n(1)^4 + AbeforeQ_rtl(1,2,2,1)^2*n(1)^4 + AbeforeQ_rtl(2,1,1,2)^2*n(2)^4 + AbeforeQ_rtl(2,2,2,2)^2*n(2)^4 + AbeforeQ_rtl(1,1,1,2)^2*n(1)^2*n(2)^2 + AbeforeQ_rtl(1,2,2,2)^2*n(1)^2*n(2)^2 + AbeforeQ_rtl(2,1,1,1)^2*n(1)^2*n(2)^2 + AbeforeQ_rtl(2,2,2,1)^2*n(1)^2*n(2)^2 - 2*AbeforeQ_rtl(1,1,1,1)*AbeforeQ_rtl(1,2,2,1)*n(1)^4 + 4*AbeforeQ_rtl(1,1,2,1)*AbeforeQ_rtl(1,2,1,1)*n(1)^4 - 2*AbeforeQ_rtl(2,1,1,2)*AbeforeQ_rtl(2,2,2,2)*n(2)^4 + 4*AbeforeQ_rtl(2,1,2,2)*AbeforeQ_rtl(2,2,1,2)*n(2)^4 + 2*AbeforeQ_rtl(1,1,1,1)*AbeforeQ_rtl(1,1,1,2)*n(1)^3*n(2) - 2*AbeforeQ_rtl(1,1,1,1)*AbeforeQ_rtl(1,2,2,2)*n(1)^3*n(2) - 2*AbeforeQ_rtl(1,1,1,2)*AbeforeQ_rtl(1,2,2,1)*n(1)^3*n(2) + 4*AbeforeQ_rtl(1,1,2,1)*AbeforeQ_rtl(1,2,1,2)*n(1)^3*n(2) + 4*AbeforeQ_rtl(1,1,2,2)*AbeforeQ_rtl(1,2,1,1)*n(1)^3*n(2) + 2*AbeforeQ_rtl(1,2,2,1)*AbeforeQ_rtl(1,2,2,2)*n(1)^3*n(2) + 2*AbeforeQ_rtl(1,1,1,1)*AbeforeQ_rtl(2,1,1,1)*n(1)^3*n(2) + 2*AbeforeQ_rtl(1,1,1,2)*AbeforeQ_rtl(2,1,1,2)*n(1)*n(2)^3 - 2*AbeforeQ_rtl(1,1,1,1)*AbeforeQ_rtl(2,2,2,1)*n(1)^3*n(2) + 4*AbeforeQ_rtl(1,1,2,1)*AbeforeQ_rtl(2,2,1,1)*n(1)^3*n(2) + 4*AbeforeQ_rtl(1,2,1,1)*AbeforeQ_rtl(2,1,2,1)*n(1)^3*n(2) - 2*AbeforeQ_rtl(1,2,2,1)*AbeforeQ_rtl(2,1,1,1)*n(1)^3*n(2) - 2*AbeforeQ_rtl(1,1,1,2)*AbeforeQ_rtl(2,2,2,2)*n(1)*n(2)^3 + 4*AbeforeQ_rtl(1,1,2,2)*AbeforeQ_rtl(2,2,1,2)*n(1)*n(2)^3 + 4*AbeforeQ_rtl(1,2,1,2)*AbeforeQ_rtl(2,1,2,2)*n(1)*n(2)^3 - 2*AbeforeQ_rtl(1,2,2,2)*AbeforeQ_rtl(2,1,1,2)*n(1)*n(2)^3 + 2*AbeforeQ_rtl(1,2,2,1)*AbeforeQ_rtl(2,2,2,1)*n(1)^3*n(2) + 2*AbeforeQ_rtl(1,2,2,2)*AbeforeQ_rtl(2,2,2,2)*n(1)*n(2)^3 + 2*AbeforeQ_rtl(2,1,1,1)*AbeforeQ_rtl(2,1,1,2)*n(1)*n(2)^3 - 2*AbeforeQ_rtl(2,1,1,1)*AbeforeQ_rtl(2,2,2,2)*n(1)*n(2)^3 - 2*AbeforeQ_rtl(2,1,1,2)*AbeforeQ_rtl(2,2,2,1)*n(1)*n(2)^3 + 4*AbeforeQ_rtl(2,1,2,1)*AbeforeQ_rtl(2,2,1,2)*n(1)*n(2)^3 + 4*AbeforeQ_rtl(2,1,2,2)*AbeforeQ_rtl(2,2,1,1)*n(1)*n(2)^3 + 2*AbeforeQ_rtl(2,2,2,1)*AbeforeQ_rtl(2,2,2,2)*n(1)*n(2)^3 - 2*AbeforeQ_rtl(1,1,1,2)*AbeforeQ_rtl(1,2,2,2)*n(1)^2*n(2)^2 + 4*AbeforeQ_rtl(1,1,2,2)*AbeforeQ_rtl(1,2,1,2)*n(1)^2*n(2)^2 + 2*AbeforeQ_rtl(1,1,1,1)*AbeforeQ_rtl(2,1,1,2)*n(1)^2*n(2)^2 + 2*AbeforeQ_rtl(1,1,1,2)*AbeforeQ_rtl(2,1,1,1)*n(1)^2*n(2)^2 - 2*AbeforeQ_rtl(1,1,1,1)*AbeforeQ_rtl(2,2,2,2)*n(1)^2*n(2)^2 - 2*AbeforeQ_rtl(1,1,1,2)*AbeforeQ_rtl(2,2,2,1)*n(1)^2*n(2)^2 + 4*AbeforeQ_rtl(1,1,2,1)*AbeforeQ_rtl(2,2,1,2)*n(1)^2*n(2)^2 + 4*AbeforeQ_rtl(1,1,2,2)*AbeforeQ_rtl(2,2,1,1)*n(1)^2*n(2)^2 + 4*AbeforeQ_rtl(1,2,1,1)*AbeforeQ_rtl(2,1,2,2)*n(1)^2*n(2)^2 + 4*AbeforeQ_rtl(1,2,1,2)*AbeforeQ_rtl(2,1,2,1)*n(1)^2*n(2)^2 - 2*AbeforeQ_rtl(1,2,2,1)*AbeforeQ_rtl(2,1,1,2)*n(1)^2*n(2)^2 - 2*AbeforeQ_rtl(1,2,2,2)*AbeforeQ_rtl(2,1,1,1)*n(1)^2*n(2)^2 + 2*AbeforeQ_rtl(1,2,2,1)*AbeforeQ_rtl(2,2,2,2)*n(1)^2*n(2)^2 + 2*AbeforeQ_rtl(1,2,2,2)*AbeforeQ_rtl(2,2,2,1)*n(1)^2*n(2)^2 - 2*AbeforeQ_rtl(2,1,1,1)*AbeforeQ_rtl(2,2,2,1)*n(1)^2*n(2)^2 + 4*AbeforeQ_rtl(2,1,2,1)*AbeforeQ_rtl(2,2,1,1)*n(1)^2*n(2)^2)^(1/2)/2 + (AbeforeQ_rtl(1,1,1,2)*n(1)*n(2))/2 + (AbeforeQ_rtl(1,2,2,2)*n(1)*n(2))/2 + (AbeforeQ_rtl(2,1,1,1)*n(1)*n(2))/2 + (AbeforeQ_rtl(2,2,2,1)*n(1)*n(2))/2;
			lambda2(i)=(AbeforeQ_rtl(1,1,1,1)*n(1)^2)/2 + (AbeforeQ_rtl(1,2,2,1)*n(1)^2)/2 + (AbeforeQ_rtl(2,1,1,2)*n(2)^2)/2 + (AbeforeQ_rtl(2,2,2,2)*n(2)^2)/2 + (AbeforeQ_rtl(1,1,1,1)^2*n(1)^4 + AbeforeQ_rtl(1,2,2,1)^2*n(1)^4 + AbeforeQ_rtl(2,1,1,2)^2*n(2)^4 + AbeforeQ_rtl(2,2,2,2)^2*n(2)^4 + AbeforeQ_rtl(1,1,1,2)^2*n(1)^2*n(2)^2 + AbeforeQ_rtl(1,2,2,2)^2*n(1)^2*n(2)^2 + AbeforeQ_rtl(2,1,1,1)^2*n(1)^2*n(2)^2 + AbeforeQ_rtl(2,2,2,1)^2*n(1)^2*n(2)^2 - 2*AbeforeQ_rtl(1,1,1,1)*AbeforeQ_rtl(1,2,2,1)*n(1)^4 + 4*AbeforeQ_rtl(1,1,2,1)*AbeforeQ_rtl(1,2,1,1)*n(1)^4 - 2*AbeforeQ_rtl(2,1,1,2)*AbeforeQ_rtl(2,2,2,2)*n(2)^4 + 4*AbeforeQ_rtl(2,1,2,2)*AbeforeQ_rtl(2,2,1,2)*n(2)^4 + 2*AbeforeQ_rtl(1,1,1,1)*AbeforeQ_rtl(1,1,1,2)*n(1)^3*n(2) - 2*AbeforeQ_rtl(1,1,1,1)*AbeforeQ_rtl(1,2,2,2)*n(1)^3*n(2) - 2*AbeforeQ_rtl(1,1,1,2)*AbeforeQ_rtl(1,2,2,1)*n(1)^3*n(2) + 4*AbeforeQ_rtl(1,1,2,1)*AbeforeQ_rtl(1,2,1,2)*n(1)^3*n(2) + 4*AbeforeQ_rtl(1,1,2,2)*AbeforeQ_rtl(1,2,1,1)*n(1)^3*n(2) + 2*AbeforeQ_rtl(1,2,2,1)*AbeforeQ_rtl(1,2,2,2)*n(1)^3*n(2) + 2*AbeforeQ_rtl(1,1,1,1)*AbeforeQ_rtl(2,1,1,1)*n(1)^3*n(2) + 2*AbeforeQ_rtl(1,1,1,2)*AbeforeQ_rtl(2,1,1,2)*n(1)*n(2)^3 - 2*AbeforeQ_rtl(1,1,1,1)*AbeforeQ_rtl(2,2,2,1)*n(1)^3*n(2) + 4*AbeforeQ_rtl(1,1,2,1)*AbeforeQ_rtl(2,2,1,1)*n(1)^3*n(2) + 4*AbeforeQ_rtl(1,2,1,1)*AbeforeQ_rtl(2,1,2,1)*n(1)^3*n(2) - 2*AbeforeQ_rtl(1,2,2,1)*AbeforeQ_rtl(2,1,1,1)*n(1)^3*n(2) - 2*AbeforeQ_rtl(1,1,1,2)*AbeforeQ_rtl(2,2,2,2)*n(1)*n(2)^3 + 4*AbeforeQ_rtl(1,1,2,2)*AbeforeQ_rtl(2,2,1,2)*n(1)*n(2)^3 + 4*AbeforeQ_rtl(1,2,1,2)*AbeforeQ_rtl(2,1,2,2)*n(1)*n(2)^3 - 2*AbeforeQ_rtl(1,2,2,2)*AbeforeQ_rtl(2,1,1,2)*n(1)*n(2)^3 + 2*AbeforeQ_rtl(1,2,2,1)*AbeforeQ_rtl(2,2,2,1)*n(1)^3*n(2) + 2*AbeforeQ_rtl(1,2,2,2)*AbeforeQ_rtl(2,2,2,2)*n(1)*n(2)^3 + 2*AbeforeQ_rtl(2,1,1,1)*AbeforeQ_rtl(2,1,1,2)*n(1)*n(2)^3 - 2*AbeforeQ_rtl(2,1,1,1)*AbeforeQ_rtl(2,2,2,2)*n(1)*n(2)^3 - 2*AbeforeQ_rtl(2,1,1,2)*AbeforeQ_rtl(2,2,2,1)*n(1)*n(2)^3 + 4*AbeforeQ_rtl(2,1,2,1)*AbeforeQ_rtl(2,2,1,2)*n(1)*n(2)^3 + 4*AbeforeQ_rtl(2,1,2,2)*AbeforeQ_rtl(2,2,1,1)*n(1)*n(2)^3 + 2*AbeforeQ_rtl(2,2,2,1)*AbeforeQ_rtl(2,2,2,2)*n(1)*n(2)^3 - 2*AbeforeQ_rtl(1,1,1,2)*AbeforeQ_rtl(1,2,2,2)*n(1)^2*n(2)^2 + 4*AbeforeQ_rtl(1,1,2,2)*AbeforeQ_rtl(1,2,1,2)*n(1)^2*n(2)^2 + 2*AbeforeQ_rtl(1,1,1,1)*AbeforeQ_rtl(2,1,1,2)*n(1)^2*n(2)^2 + 2*AbeforeQ_rtl(1,1,1,2)*AbeforeQ_rtl(2,1,1,1)*n(1)^2*n(2)^2 - 2*AbeforeQ_rtl(1,1,1,1)*AbeforeQ_rtl(2,2,2,2)*n(1)^2*n(2)^2 - 2*AbeforeQ_rtl(1,1,1,2)*AbeforeQ_rtl(2,2,2,1)*n(1)^2*n(2)^2 + 4*AbeforeQ_rtl(1,1,2,1)*AbeforeQ_rtl(2,2,1,2)*n(1)^2*n(2)^2 + 4*AbeforeQ_rtl(1,1,2,2)*AbeforeQ_rtl(2,2,1,1)*n(1)^2*n(2)^2 + 4*AbeforeQ_rtl(1,2,1,1)*AbeforeQ_rtl(2,1,2,2)*n(1)^2*n(2)^2 + 4*AbeforeQ_rtl(1,2,1,2)*AbeforeQ_rtl(2,1,2,1)*n(1)^2*n(2)^2 - 2*AbeforeQ_rtl(1,2,2,1)*AbeforeQ_rtl(2,1,1,2)*n(1)^2*n(2)^2 - 2*AbeforeQ_rtl(1,2,2,2)*AbeforeQ_rtl(2,1,1,1)*n(1)^2*n(2)^2 + 2*AbeforeQ_rtl(1,2,2,1)*AbeforeQ_rtl(2,2,2,2)*n(1)^2*n(2)^2 + 2*AbeforeQ_rtl(1,2,2,2)*AbeforeQ_rtl(2,2,2,1)*n(1)^2*n(2)^2 - 2*AbeforeQ_rtl(2,1,1,1)*AbeforeQ_rtl(2,2,2,1)*n(1)^2*n(2)^2 + 4*AbeforeQ_rtl(2,1,2,1)*AbeforeQ_rtl(2,2,1,1)*n(1)^2*n(2)^2)^(1/2)/2 + (AbeforeQ_rtl(1,1,1,2)*n(1)*n(2))/2 + (AbeforeQ_rtl(1,2,2,2)*n(1)*n(2))/2 + (AbeforeQ_rtl(2,1,1,1)*n(1)*n(2))/2 + (AbeforeQ_rtl(2,2,2,1)*n(1)*n(2))/2;
			%}
			
			%if min([lambda1 lambda2])<lambdamin
			%	lambdamin=min([lambda1 lambda2]);
			%	thetamin=theta;
			%end
		end
		lambdamin=min([lambda1;lambda2]);
		if length(lambdamin)>1
			fprintf('%s',['length(lamdabmin)>1!' char(10)]);
			pause;
			1;
		end
		if lambdamin>0
			thetacrackrtl=NaN;
		else
			localminima1index=zeros(1,0);
			localminima2index=zeros(1,0);
			for i=1:ntestedangle
				if lambda1(i)<0 && lambda1(i)<=lambda1(mod((i-1)-1,ntestedangle)+1) && lambda1(i)<=lambda1(mod((i+1)-1,ntestedangle)+1)
					localminima1index=[localminima1index i];
				end
				if lambda2(i)<0 && lambda2(i)<=lambda2(mod((i-1)-1,ntestedangle)+1) && lambda2(i)<=lambda2(mod((i+1)-1,ntestedangle)+1)
					localminima2index=[localminima2index i];
				end
			end
			nldudxhl=zeros(length(localminima1index)+length(localminima2index),1);
			h_localminima=zeros(2,length(localminima1index)+length(localminima2index));
			for i=1:length(localminima1index)
				n(1)=cos(theta(localminima1index(i)));
				n(2)=sin(theta(localminima1index(i)));
				nldudxhl(i)=real(transpose(n)*dudx_rtl*h(:,1,localminima1index(i)));
				h_localminima(:,i)=h(:,1,localminima1index(i));
			end
			for i=1:length(localminima2index)
				n(1)=cos(theta(localminima2index(i)));
				n(2)=sin(theta(localminima2index(i)));
				nldudxhl(i+length(localminima1index))=real(transpose(n)*dudx_rtl*h(:,2,localminima2index(i)));
				h_localminima(:,i+length(localminima1index))=h(:,2,localminima2index(i));
            end
            localminimaindex=[localminima1index localminima2index];
			FindMaxnldudxhl=FindMax(nldudxhl); %I put FindMax(nldudxhl) to a variable FindMaxnldudxhl as I need to call it twice. Better to save the result rather than calling the function twice.
			crackindex=localminimaindex(FindMaxnldudxhl);
			thetamin=theta(crackindex);
			h_crackdecision=zeros(size(h_localminima,1),1);
			h_crackdecision(:,1)=h_localminima(:,FindMaxnldudxhl);
			thetacrackrtl=mod(thetamin+pi/2+pi/2,pi)-pi/2;
			justcracked=1;
            1;
		end
	else
		Ktangent_global=zeros(6,6);
		Ktangent_global_2D=[];
		Ktangent_global_tens=[];
		Ktangent_global_tens_2D=[];
		activesurfacelist=[];
		AbeforeQ_rtl=zeros(2,2,2,2);
		lambdamin=[];
		thetamin=[];
		Qacoustic=zeros(2,2,36*1*1*1);
		h=zeros(2,2,36*1*1*1);
	end
	
	
	%end Calculating tangent stiffness matrix
	
	%{
	disp(' ')
		texttodisplay=['step=' num2str(step+1) '; '];
		texttodisplay=[texttodisplay 'iteration=' num2str(iteration) '; '];
		texttodisplay=[texttodisplay 'deltaepsilonmag=' num2str(sqrt(dot(deltaepsilon,deltaepsilon))*100) '%; '];
			disp(texttodisplay)
		
		printvector(sigma,'sigma')
		if elastic==0
			printvector(activesurface,'activesurface')
			print11cell(f,'f',activesurface)
		end
		printvector(deltagamma,'deltagamma')
		printvector(epsilonp{step+1},'epsilonp')
		printvector(epsilont{step+1}-epsilonp{step+1},'epsilone')
		printvector(epsilont{step+1},'epsilont')
		if elastic
			printvector(alphahp{step+1},'alphahp')
		else
			printvector(alphahp{step+1},'alphahp',activesurface)
		end
			
	%}
	%end function of Wood_Schmidt17
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [s_sp,e_pl,sigma_global_big,e_t_global_big,e_pl_global_big,alpha_out,f_final_vect,surfacewithfmax,sigma_local_big,AbeforeQ_rtl,evaltimes,thetacrackrtl,justcracked,Qacoustic,h,Ktangent_global,Ktangent_global_2D,Ktangent_global_tens,Ktangent_global_tens_2D,activesurfacelist,lambdamin,thetamin]= ...
    Wood_Schmidt17_memorymess(dESP,sigma_global_big,e_t_global_big,e_pl_global_big,alpha_in,xdirletter,ydirletter,zdirletter,xydirletter,yzdirletter,xzdirletter,ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,Grt,Gtl,Grl,nurt,nutl,nurl,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit,CasetoRun,t_time,dt,spid,Debugging,thetacrackrtl,dudx_rtl)
	%start function of Wood_Schmidt17
	
	% move efficient than version 16
	%function [outputArg1,outputArg2] = Wood_Schmidt(inputArg1,inputArg2)
	%SCHMIDT Summary of this function goes here
	%   Detailed explanation goes here
	%{
	Voigt's Notation direction:
	1: r
	2: t
	3: l
	4: rt
	5: tl
	6: rl
	
	Failure surfaces:
	1: r tension
	2: r compression
	3: t tension
	4: t compression
	5: l tension
	6: l compression
	7: shear
	
	%}
	
	evaltimes=0;
	step=1;
	
	deltaepsilonglobal=zeros(6,1);
	deltaepsilonglobal(1,1)=real(dESP(1,1));
	deltaepsilonglobal(2,1)=real(dESP(2,2));
	deltaepsilonglobal(3,1)=0;
	deltaepsilonglobal(4,1)=real(dESP(1,2));
	deltaepsilonglobal(5,1)=0;
	deltaepsilonglobal(6,1)=0;

	if dESP(1,2)>0
	end

	xdir=RTLtranslator(xdirletter);
	ydir=RTLtranslator(ydirletter);
	zdir=RTLtranslator(zdirletter);
	xydir=RTLtranslator(xydirletter);
	yzdir=RTLtranslator(yzdirletter);
	xzdir=RTLtranslator(xzdirletter);

	dirglobal=[xdir ydir zdir xydir yzdir xzdir];

	if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==21 || CasetoRun==17
		planestressmod=1;
	elseif CasetoRun==4
		planestressmod=1;
	elseif CasetoRun==5 || CasetoRun==6
		planestressmod=0;
	elseif CasetoRun==7
		planestressmod=1;
	elseif CasetoRun==8 || CasetoRun==9
		planestressmod=0;
	elseif CasetoRun==10
		planestressmod=1;
	elseif CasetoRun==11
		planestressmod=1;
	elseif CasetoRun==12 || CasetoRun==16 || CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44
		%planestressmod=0;
		%planestressmod=1; %turns out it's plane STRAIN all along, let's do plane STRESS now.
		planestressmod=0; %plane stress is being done, need PLANE STRAIN for more correctness.
	elseif CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==15 || CasetoRun==14
		%planestressmod=0; %note it's plane strain unlinke CasetoRun==11
		%planestressmod=1; %turns out it's plane STRAIN all along, let's do plane STRESS now.
		planestressmod=0; %plane stress is being done, need PLANE STRAIN for more correctness.
    elseif CasetoRun==73 || CasetoRun==74 || CasetoRun==78 || CasetoRun==81 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==83 || CasetoRun==84 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124 || CasetoRun==117 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110 || CasetoRun==96 || CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89 || CasetoRun==85 || CasetoRun==77
        planestressmod=0;
    elseif CasetoRun==-99
        planestressmod=0;
	end
	
	nsurface=length(alpha_in); %to stop coder whining
	nstressvect=length(sigma_global_big); %to stop coder whining
	
	deltaepsilon=zeros(nstressvect,1);
	deltaepsilon(xdir,1)=deltaepsilonglobal(1);
	deltaepsilon(ydir,1)=deltaepsilonglobal(2);
	deltaepsilon(zdir,1)=deltaepsilonglobal(3);
	deltaepsilon(xydir,1)=deltaepsilonglobal(4);
	deltaepsilon(yzdir,1)=deltaepsilonglobal(5);
	deltaepsilon(xzdir,1)=deltaepsilonglobal(6);
	
	epsilonp=zeros(nstressvect,1);
	epsilonp(xdir,1)=e_pl_global_big(1);
	epsilonp(ydir,1)=e_pl_global_big(2);
	epsilonp(zdir,1)=e_pl_global_big(3);
	epsilonp(xydir,1)=e_pl_global_big(4);
	epsilonp(yzdir,1)=e_pl_global_big(5);
	epsilonp(xzdir,1)=e_pl_global_big(6);
	
	epsilont=zeros(nstressvect,1);
	epsilont(xdir,1)=e_t_global_big(1);
	epsilont(ydir,1)=e_t_global_big(2);
	epsilont(zdir,1)=e_t_global_big(3);
	epsilont(xydir,1)=e_t_global_big(4);
	epsilont(yzdir,1)=e_t_global_big(5);
	epsilont(xzdir,1)=e_t_global_big(6);
	
	sigma0=zeros(nstressvect,1);
	sigma0(xdir,1)=sigma_global_big(1);
	sigma0(ydir,1)=sigma_global_big(2);
	sigma0(zdir,1)=sigma_global_big(3);
	sigma0(xydir,1)=sigma_global_big(4);
	sigma0(yzdir,1)=sigma_global_big(5);
	sigma0(xzdir,1)=sigma_global_big(6);
	
	q=zeros(1,nsurface);
	qtest=zeros(1,nsurface);
	
	sigma=cell(1,1);
	coder.varsize('sigma');
	sigma{1}=zeros(nstressvect,1);
	alphahp=cell(1,1);
	coder.varsize('alphahp');
	for i=1:length(alphahp)
		alphahp{i}=zeros(1,nsurface);
	end
	ftrial=cell(1,nsurface);
	coder.varsize('ftrial');
	fprev=cell(1,nsurface);
	coder.varsize('fprev');
	fimplicitstart=cell(1,nsurface);
	coder.varsize('fimplicitstart');
	fimplicitstarttrial=cell(1,nsurface);
	coder.varsize('fimplicitstarttrial');
	f_final=cell(1,nsurface);
	f1trial=cell(1,nsurface);
	f10=cell(1,nsurface);
	f2trial=cell(1,nsurface);
	f20=cell(1,nsurface);
	dfdsigma=cell(1,nsurface);
	dfdq=cell(1,nsurface);
	dfdqchosen=cell(1,nsurface);
	d2fdsigma2=cell(1,nsurface);
	d2fdsigmadq=cell(1,nsurface);
	d2fdq2=cell(1,nsurface);
	for i=1:nsurface
		ftrial{i}=0;
		fprev{i}=0;
		fimplicitstart{i}=0;
		fimplicitstarttrial{i}=0;
		f_final{i}=0;
		f1trial{i}=0;
		f10{i}=0;
		f2trial{i}=0;
		f20{i}=0;
		dfdsigma{i}=zeros(nstressvect,1);
		dfdq{i}=zeros(nsurface,1);
		dfdqchosen{i}=zeros(nsurface,1);
		d2fdsigma2{i}=zeros(nstressvect,nstressvect);
		d2fdsigmadq{i}=zeros(nstressvect,nsurface);
		d2fdq2{i}=zeros(nsurface,nsurface);
	end
	for i=1:nstressvect
		sigma{1}(i,1)=sigma0(i,1);
	end
	
	chosensurface=0;
	chosensurface1=0;
	chosensurface2=0;
	justcracked=0;
	surfacehistory=zeros(1,nsurface);
	A1=0;
	A2=0;
	B=0;
	sigmaimplicitstart=zeros(nstressvect,1);
	sigmaimplicitstarttrial=zeros(nstressvect,1);
	sigmawidened=zeros(nstressvect,1);
	sigmaimp=zeros(nstressvect,1);
	sigmaimpn=zeros(nstressvect,1);
	deltalambda1ok=0;
	deltalambda2ok=0;
	alphafactchosen=0;
	deltaalpha1=0;
	deltaalpha2=0;
	deltaalphataken=0;
	deltalambdanice=0;
	deltalambdaguess=0;
	deltagamma=0;
	deltagamma1=0;
	deltagamma2=0;
	alphawidened=zeros(1,nsurface);
	alphaimplicitstart=zeros(1,nsurface);
	alphaimpn=zeros(1,nsurface);
	alphaimp=zeros(1,nsurface);
	q=zeros(1,nsurface);
	dqdalpha=zeros(1,nsurface);
	d2qdalpha2=zeros(1,nsurface);	
	qfordeltaT=0;
	last5surfaces=zeros(5,2);
	
	
	Comp=[1/Er -nurt/Et -nurl/El 0 0 0;
		-nurt/Et 1/Et -nutl/El 0 0 0;
		-nurl/El -nutl/El 1/El 0 0 0;
		0 0 0 1/Grt 0 0;
		0 0 0 0 1/Gtl 0;
		0 0 0 0 0 1/Grl];

	%{
	sigmarr=sigmatrial(1);
	sigmatt=sigmatrial(2);
	sigmall=sigmatrial(3);
	sigmart=sigmatrial(4);
	sigmatl=sigmatrial(5);
	sigmarl=sigmatrial(6);
	%}    
	
	%{
	for i=1:7
		deltagamma(i)=0;
	end
	%}
		
	C=Comp^-1;
	Cplanestrain=C;
	if planestressmod==1
		C=MatCondensor(Cplanestrain,[zdir yzdir xzdir]);
	elseif planestressmod==2
		C=MatCondensor(Cplanestrain,[ydir zdir xydir yzdir xzdir]);
	end
	%{
	if planestressmod
		C=zeros(6,6);
		for i=1:6
			if i==zdir|i==yzdir|i==xzdir
				continue;
			end
			if planestressmod==2
				if i==ydir|i==xydir
					continue;
				end
			end
			for j=1:6
				if j==zdir|j==yzdir|j==xzdir
					continue;
				end
				if planestressmod==2
					if j==ydir|j==xydir
						continue;
					end
				end
				C(i,j)=Cplanestrain(i,j);
			end
		end
	end
	%}
	
	%sigmastep(:,1)=transpose([0 0 0 0 0 0]);
	
	%sigmatrial{1}=zeros(6,1);
	
	%q{1}=transpose([0 0 0 0 0 0 0]);
	for j=1:length(alphahp)
		for i=1:nsurface
			alphahp{j}(i)=alpha_in(i);
		end
	end
	
	NormLimit=1e-5;
	%fstep=zeros(7,1);
	hardeningsurfaces=[1 2 3 4 5 6 7];
	%hardeningsurfaces=[1 3];
	
	q=[0 0 0 0 0 0 0];
	dqdalpha=[0 0 0 0 0 0 0];
	d2qdalpha2=[0 0 0 0 0 0 0];

	[q,~]=qandDfromalpha2(alphahp{1},ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit);
	sigmatrial=sigma{1}+C*deltaepsilon;
	evaltimes=evaltimes+2;
	[ftrial,~,~]=Wood_Schmidt_EvalSigmaEff(sigmatrial,q,hardeningsurfaces,[1 0 0 0 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);
	[fprev,~,~]=Wood_Schmidt_EvalSigmaEff(sigma{1},q,hardeningsurfaces,[1 0 0 0 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);
	elastic=1;
	if t_time>=3.2395443013820597322194316802779-dt/2 && t_time<=3.2395443013820597322194316802779+dt/2 && (spid==17 || spid==17)
		1;
	end
	%surfaceallpositiveproblem=zeros(7,1);
	%surfacevalallpositiveproblem=zeros(7,1);
	
	alphafact=zeros(1,7);
	for i=1:7
		if ftrial{i}>0 && ftrial{i}>fprev{i}
			alphafact(i)=(fprev{i}/(fprev{i}-ftrial{i}));
			elastic=0;
		else
			if ftrial{i}>0
				%disp(['Warning for spid=' num2str(spid) ': ftrial{' num2str(i) '}>0 but <fprev{' num2str(i) '}, special treatment is assumed']);
				%disp('Press any key to continue');
				%pause;
				alphafact(i)=-fprev{i};
				elastic=0;
				1;
			else
				alphafact(i)=1;
			end
		end
	end
	%if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==21 || CasetoRun==17
	%elseif CasetoRun==4
	%    elastic=1; %forces the system to remain elastic
	%end
	% force elastic here
	%if CasetoRun==4
	%    elastic=1;
	%end
	%if CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==15 || CasetoRun==14
	%    elastic=1;
	%end
	Rimp=zeros(8,1);
	if Debugging.Active && CloseEnough(t_time,Debugging.Time,1e-5,2) && spid==Debugging.Particle
        1;
    end
	if elastic
		substepiter=1;
		sigma{substepiter+1}=sigmatrial;
		alphahp{substepiter+1}=alphahp{substepiter};
		substepiter=2;
	else
		alphafactchosen=min(alphafact);
		for i=1:7
			if alphafactchosen==alphafact(i)
				chosensurface=i;
				break;
			end
		end
		alphafactchosen=max(0,alphafactchosen);
		sigma{2}=sigma{1}+alphafactchosen*C*deltaepsilon;
		alphahp{2}=alphahp{1};
		deltaepsilone=(1-alphafactchosen)*deltaepsilon;
		deltasigmae=(1-alphafactchosen)*C*deltaepsilon;
		T=0;
		deltaT=1;
		substepiter=2;
		last5surfaces=zeros(5,2);
		consistentmultisurfaceconfirmed=0;
		implicithasfailed=0;
		stoprepeater=0;
		implicitsubstepfactor=10;
		implicitsubstepnumber=0;
		while substepiter<inf
			if deltaT<1e-4
				1;
			end
			if Debugging.Active && CloseEnough(t_time,Debugging.Time,1e-5,2) && spid==Debugging.Particle
				1;
				if substepiter>=2
					substepiter
					alphahp{substepiter}
					stoprepeater=stoprepeater+1;
					stoprepeater
					1;
					if consistentmultisurfaceconfirmed==1
						1;
					end
					if stoprepeater>=Debugging.DesignatedStopRepeater
						1;
					end
				end
			end
			
			if min(alphahp{substepiter})<0
				fprintf('%s',['alphahp < zero found!' char(10)]);
				1;
				pause
				1;
			end
			if T==1
				[qtest,~]=qandDfromalpha2(alphahp{substepiter},ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit);
				evaltimes=evaltimes+1;
				[ftest,~]=Wood_Schmidt_EvalSigmaEff(sigma{substepiter},qtest,[1 2 3 4 5 6 7],[1 0 0 0 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);
				if CellMax(ftest)<NormLimit
					break
				else
					implicithasfailed=1;
					1;
				end
			elseif T>1
				fprintf('%s',['T>1' char(10)]);
				pause
			end
			deltaT=min(deltaT,1-T);
			sigma1=sigma{substepiter};
			alpha1=alphahp{substepiter};
			sigma1trial=sigma1+deltasigmae*deltaT;
			if consistentmultisurfaceconfirmed==1 && implicithasfailed==0
				if implicitsubstepnumber==0
					%disp('Implicit is a go!')
				end
				alphaimpn=alpha1;                
				alphaimp=alphaimpn;
				sigmaimpn=sigma1trial;
				%sigmaimp=transpose([0 0 0 0 0 0]);
				[q,dqdalpha,~]=qandDfromalpha2(alphaimpn,ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit);
				evaltimes=evaltimes+1;
				[f,dfdsigma,dfdqchosen,d2fdsigma2,~]=Wood_Schmidt_EvalSigmaEff(sigmaimpn,q,[chosensurface1 chosensurface2],[0 1 0 0 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);
				
				deltagamma1startreference=transpose(dfdsigma{chosensurface1})*sigma1trial/(transpose(dfdsigma{chosensurface1})*C*dfdsigma{chosensurface1});
				deltagamma2startreference=transpose(dfdsigma{chosensurface2})*sigma1trial/(transpose(dfdsigma{chosensurface2})*C*dfdsigma{chosensurface2});

				deltagamma1=deltagamma1startreference;
				deltagamma2=deltagamma2startreference;
				
				sigmaimp=sigma1trial-C*(deltagamma1*dfdsigma{chosensurface1}+deltagamma2*dfdsigma{chosensurface2});
				
				alphaimp(chosensurface1)=alphaimpn(chosensurface1)+deltagamma1;
				alphaimp(chosensurface2)=alphaimpn(chosensurface2)+deltagamma2;
				alphaerrortracker=zeros(1,16);
				for alphaiteration=1:99999
					if alphaiteration==40
						implicithasfailed=1;
						break;
					end
					[q,dqdalpha,~]=qandDfromalpha2(alphaimp,ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit);
					imperrortracker=zeros(1,16);
					for impiteration=1:100
						if impiteration==20
							implicithasfailed=1;
							break;
						end
						evaltimes=evaltimes+1;
						[f,dfdsigma,dfdqchosen,d2fdsigma2,~]=Wood_Schmidt_EvalSigmaEff(sigmaimp,q,[chosensurface1 chosensurface2],[1 1 0 1 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);
						Rimp(1:6,1)=sigmaimp-sigmaimpn+C*(deltagamma1*dfdsigma{chosensurface1}+deltagamma2*dfdsigma{chosensurface2});
						%Rimp(7,1)=alphaimp(chosensurface1)-alphaimpn(chosensurface1)-deltagamma1;
						%Rimp(8,1)=alphaimp(chosensurface2)-alphaimpn(chosensurface2)-deltagamma2;
						Rimp(7,1)=f{chosensurface1};
						Rimp(8,1)=f{chosensurface2};
						Err=sqrt(dot(Rimp,Rimp));
						for i=15:-1:1
							imperrortracker(i+1)=imperrortracker(i);
						end
						imperrortracker(1)=Err;
						if Err<NormLimit
							break
						end
						if impiteration>=16
							m=ManualLinReg([1:16],log(imperrortracker));
							if m<0
							%if imperrortracker(1)>sum(imperrortracker(2:5))/4;
								%disp('no error improvement, implicit newton terminated');
								implicithasfailed=1;
								break;
							end
						end
						J=zeros(8,8);
						J(1:6,1:6)=eye(6,6)+C*(deltagamma1*d2fdsigma2{chosensurface1}+deltagamma2*d2fdsigma2{chosensurface2});
						J(1:6,7)=C*dfdsigma{chosensurface1};
						J(1:6,8)=C*dfdsigma{chosensurface2};
						%J(7,7)=1;
						%J(8,8)=1;
						%J(7,9)=-1;
						%J(8,10)=-1;
						J(7,1:6)=transpose(dfdsigma{chosensurface1});
						J(8,1:6)=transpose(dfdsigma{chosensurface2});
						%J(9,7)=dqdalpha(chosensurface1);
						%J(10,8)=dqdalpha(chosensurface2);
						if rcond(J)<1e-15
							implicithasfailed=1;
							break;
						end
						deltaX=-(J^-1)*Rimp;
						sigmaimp=sigmaimp+deltaX(1:6,1);
						%alphaimp(chosensurface1)=alphaimp(chosensurface1)+deltaX(7,1);
						%alphaimp(chosensurface2)=alphaimp(chosensurface2)+deltaX(8,1);
						deltagamma1=deltagamma1+deltaX(7,1);
						deltagamma2=deltagamma2+deltaX(8,1);
						%if deltagamma1<0
							%{
							deltagamma1startreference=deltagamma1startreference*2;
							deltagamma1=deltagamma1startreference;
							sigmaimp=sigma1trial-C*(deltagamma1*dfdsigma{chosensurface1}+deltagamma2*dfdsigma{chosensurface2});
							alphaimp(chosensurface1)=alphaimpn(chosensurface1)+deltagamma1;
							%}
							%implicithasfailed=1;
							%break;
						%end
						%if deltagamma2<0
							%{
							deltagamma2startreference=deltagamma2startreference*2;
							deltagamma2=deltagamma2startreference;
							sigmaimp=sigma1trial-C*(deltagamma1*dfdsigma{chosensurface1}+deltagamma2*dfdsigma{chosensurface2});
							alphaimp(chosensurface2)=alphaimpn(chosensurface2)+deltagamma2;
							%}
							%implicithasfailed=1;
							%break;
						%end
						%{
						[q,dqdalpha,d2qdalpha2]=qandDfromalpha2(alphaimp);
						[f,dfdsigma,dfdqchosen,d2fdsigma2,~]=Wood_Schmidt_EvalSigmaEff(sigmaimp,q,chosensurface,[1 1 1 1 0 0]);
						Rimp(1:6,1)=-epsilonpimp+epsilonpimpn+deltagamma*dfdsigma{chosensurface};
						Rimp(7,1)=-alphaimp(chosensurface)+alphaimpn(chosensurface)+deltagamma;
						if impiteration>1 & sqrt(dot(Rimp,Rimp))<NormLimit & f{chosensurface}<NormLimit
							break
						end
						Ainv=zeros(7,7);
						Ainv(1:6,1:6)=(C^-1)+deltagamma*d2fdsigma2{chosensurface};
						Ainv(7,7)=-(1/dqdalpha(chosensurface));
						Aimp=Ainv^-1;
						delta2gamma=(f{chosensurface}-[transpose(dfdsigma{chosensurface}) 1]*Aimp*Rimp)/([transpose(dfdsigma{chosensurface}) 1]*Aimp*[dfdsigma{chosensurface};1]);
						deltaepsilondeltaalpha=[C^-1 zeros(6,1);zeros(1,6) -(1/dqdalpha(chosensurface))]*Aimp*(Rimp+delta2gamma*[dfdsigma{chosensurface};1]);
						epsilonpimp=epsilonpimp+deltaepsilondeltaalpha(1:6);
						alphaimp(chosensurface)=alphaimp(chosensurface)+deltaepsilondeltaalpha(7);
						deltagamma=deltagamma+delta2gamma;
						%}
					end
					if implicithasfailed==1
						break;
					end
					alphaimp1new=alphaimpn(chosensurface1)+deltagamma1;
					alphaimp2new=alphaimpn(chosensurface2)+deltagamma2;
					alphaerror=sqrt((alphaimp(chosensurface1)-alphaimp1new)^2+(alphaimp(chosensurface2)-alphaimp2new)^2);
					for i=15:-1:1
						alphaerrortracker(i+1)=alphaerrortracker(i);
					end
					alphaerrortracker(1)=alphaerror;
					alphaimp(chosensurface1)=alphaimp1new;
					alphaimp(chosensurface2)=alphaimp2new;
					if alphaerror<NormLimit
						break;
					end
					if alphaiteration>=16
						m=ManualLinReg([1:16],log(alphaerrortracker));
						if m<0
						%if alphaerrortracker(1)>alphaerrortracker(5)
							%disp('no error improvement, alpha iteration terminated');
							implicithasfailed=1;
							break;
						end
					end
				end
				if implicithasfailed==1
					if implicitsubstepnumber<=4
						%disp('Implicit Didnt converge, substepping');
						deltaT=min(deltaT/implicitsubstepfactor,1-T);
						implicithasfailed=0;
						implicitsubstepnumber=implicitsubstepnumber+1;
					else
						%disp('Implicit Didnt converge, switching back');
						implicithasfailed=1;
					end
					continue;
				end
				sigma{substepiter+1}=sigmaimp;
				alphahp{substepiter+1}=alphaimp;
				if deltagamma1>min(0,-alphaimp(chosensurface1)*NormLimit) && deltagamma2>min(0,-alphaimp(chosensurface2)*NormLimit)
					substepiter=substepiter+1;
					T=T+deltaT;
					deltaT=min(1-T,deltaT*min(1.5,10^(implicitsubstepnumber)));
					implicitsubstepnumber=implicitsubstepnumber-(log(1.5)/log(10));
				else
					%disp('deltagamma less than zero!')
					if implicitsubstepnumber<=4
						%disp('Implicit Didnt converge, substepping');
						deltaT=min(deltaT/implicitsubstepfactor,1-T);
						implicithasfailed=0;
						implicitsubstepnumber=implicitsubstepnumber+1;
					else
						%disp('Implicit Didnt converge, switching back')
						implicithasfailed=1;
					end
					1;
				end
				continue;
			end
			[q,dqdalpha,d2qdalpha2]=qandDfromalpha2(alpha1,ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit);
			evaltimes=evaltimes+2;
			[f10,~]=Wood_Schmidt_EvalSigmaEff(sigma1,q,[1 2 3 4 5 6 7],[1 0 0 0 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);
			[f1trial,~]=Wood_Schmidt_EvalSigmaEff(sigma1trial,q,[1 2 3 4 5 6 7],[1 0 0 0 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);
			elastic=1;
			for i=1:7
				if f1trial{i}>0 && f1trial{i}>f10{i}
					alphafact(i)=(f10{i}/(f10{i}-f1trial{i}));
					elastic=0;
				else
					if f1trial{i}>0
						%disp(['Warning for spid=' num2str(spid) ': f1trial{' num2str(i) '}>0 but <f10{' num2str(i) '}, special treatment is assumed']);
						%disp('Press any key to continue');
						%pause;
						alphafact(i)=-f10{i};
						elastic=0;
						1;
					else
						alphafact(i)=1;
					end
				end
			end
			if elastic
				%disp('Turns Out to be Elastic on deltalambda1');
				deltalambda1=0;
				deltalambdanice=0;
				deltasigmanice=0;
				sigma{substepiter+1}=sigma1trial;
				T=T+deltaT;
				alphahp{substepiter+1}=alphahp{substepiter};
				substepiter=substepiter+1;
				qfordeltaT=2;
				deltaT=deltaT*qfordeltaT;
				continue;
			else
				alphafactchosen=min(alphafact);
				if alphafactchosen~=1
					for i=1:7
						if alphafactchosen==alphafact(i)
							chosensurface=i;
						end
					end
				end
				alphafactchosen=max(0,alphafactchosen);
				evaltimes=evaltimes+1;
				[DUMMY,dfdsigma,dfdqchosen,d2fdsigma2,~]=Wood_Schmidt_EvalSigmaEff(sigma1,q,chosensurface,[0 1 1 1 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);
				A1=-dfdqchosen{chosensurface}(chosensurface)*dqdalpha(chosensurface);
				%A1=-dfdqchosen{chosensurface}(chosensurface)*dqdalpha(chosensurface)*([1 1 1 1 1 1])*dfdsigma{chosensurface};
				B=transpose(dfdsigma{chosensurface})*C*dfdsigma{chosensurface};
				%deltalambda1=(transpose(dfdsigma{chosensurface})*deltasigmae*deltaT+max(0,(2*deltaT/(1-T))*f10{chosensurface}))/(A1+B);
				deltalambda1=(transpose(dfdsigma{chosensurface})*deltasigmae*deltaT)/(A1+B);
				deltalambdanice=f10{chosensurface}/(A1+B);
				deltasigmanice=-C*deltalambdanice*dfdsigma{chosensurface};
				chosensurface1=chosensurface;
			end
			%recalculating dfdsigma and dfdq
			
			%end of recalculating dfdsigma and dfdq
			
			%deltalambdadrift=f10{chosensurface};
			%deltalambda1=(transpose(dfdsigma{chosensurface})*deltasigmae*deltaT+max(0,deltaT*fprev{chosensurface}))/(A1+B);
			deltalambda1ok=1;
			if deltalambda1<0
				%disp('deltalambda1<0!')
				if A1+B<0
					%disp('A<B!')
					%deltaTbackup=deltaT;
					%deltaT=0;
					%printvector(substepiter,'substepiter');
					%printvector(chosensurface,'chosensurface');
					%printvector(alphafactchosen,'alphafactchosen');
					%printvector(sigma{substepiter},'sigma{substepiter}');
					%printvector(alphahp{substepiter},'alphahp{substepiter}');
					%uisave;
					Aq1=0.5*transpose(C*dfdsigma{chosensurface})*(d2fdsigma2{chosensurface})*(C*dfdsigma{chosensurface})+0.5*d2qdalpha2(chosensurface);
					%Bq1=dqdalpha(chosensurface)-transpose(dfdsigma{chosensurface})*C*dfdsigma{chosensurface}-transpose(C*dfdsigma{chosensurface})*d2fdsigma2{chosensurface}*(deltasigmae*deltaT);
					%Cq1=transpose(dfdsigma{chosensurface})*deltasigmae*deltaT+max(0,(2*deltaT/(1-T))*f10{chosensurface})+0.5*transpose(deltasigmae*deltaT)*d2fdsigma2{chosensurface}*(deltasigmae*deltaT);
					%Cq1=transpose(dfdsigma{chosensurface})*deltasigmae*deltaT+max(0,deltaT*fprev{chosensurface})+0.5*transpose(deltasigmae*deltaT)*d2fdsigma2{chosensurface}*(deltasigmae*deltaT);
					Pq1=(-transpose(C*dfdsigma{chosensurface})*d2fdsigma2{chosensurface}*deltasigmae)^2+(-2*transpose(C*dfdsigma{chosensurface})*d2fdsigma2{chosensurface}*C*dfdsigma{chosensurface}-2*d2qdalpha2(chosensurface))*(1/2)*transpose(deltasigmae)*d2fdsigma2{chosensurface}*deltasigmae;
					Qq1=2*transpose(C*dfdsigma{chosensurface})*d2fdsigma2{chosensurface}*deltasigmae*(transpose(dfdsigma{chosensurface})*C*dfdsigma{chosensurface}-dqdalpha(chosensurface))+(-2*transpose(C*dfdsigma{chosensurface})*d2fdsigma2{chosensurface}*C*dfdsigma{chosensurface}-2*d2qdalpha2(chosensurface))*transpose(dfdsigma{chosensurface})*deltasigmae;
					Rq1=(-transpose(dfdsigma{chosensurface})*C*dfdsigma{chosensurface}+dqdalpha(chosensurface))^2+(-2*transpose(C*dfdsigma{chosensurface})*d2fdsigma2{chosensurface}*C*dfdsigma{chosensurface}-2*d2qdalpha2(chosensurface))*f10{chosensurface};
					if Rq1<=0
						deltalambda1=0;
					else
						Kq1=-(Pq1/(2*sqrt(Rq1))-Qq1^2/(8*Rq1*sqrt(Rq1)))/(2*Aq1);
						Lq1a=(transpose(C*dfdsigma{chosensurface})*d2fdsigma2{chosensurface}*deltasigmae-Qq1/(2*sqrt(Rq1)))/(2*Aq1);
						Lq1b=(transpose(C*dfdsigma{chosensurface})*d2fdsigma2{chosensurface}*deltasigmae+Qq1/(2*sqrt(Rq1)))/(2*Aq1);
						Lq1=max(Lq1a,Lq1b);
						Mq1=(transpose(dfdsigma{chosensurface})*C*dfdsigma{chosensurface}-dqdalpha(chosensurface)-sqrt(Rq1))/(2*Aq1);
						%deltalambda1=(-Bq1-sqrt(Bq1^2-4*Aq1*Cq1))/(2*Aq1);
						%deltalambda1=Kq1*deltaT^2+Lq1*deltaT+Mq1;
						%deltalambda1=Kq1*deltaT^2+Lq1*deltaT+(200*deltaT/(1-T))*Mq1;
						%deltalambda1=Kq1*deltaT^2+Lq1*deltaT;
						deltalambda1=Lq1*deltaT;
						if deltalambda1<0
							deltalambda1=0;
						end
					end
					%deltalambdadrift=Mq1;
					%disp('deltalambda1 not ok');
					deltalambda1ok=0;
				else
					deltalambda1=0;
				end
			end
			
			%intermediate for calculating alphahp nice
			deltasigma1=deltasigmae*deltaT-deltalambda1*C*dfdsigma{chosensurface};
			deltaalpha1=[0 0 0 0 0 0 0];
			deltaalpha1(chosensurface)=deltalambda1;
			% start of deltalambdaok
			%if deltalambda1ok
			sigma2=sigma1+deltasigma1;
			alpha2=alpha1+deltaalpha1;
			[q,dqdalpha,d2qdalpha2]=qandDfromalpha2(alpha2,ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit);
			evaltimes=evaltimes+1;
			[f20,~]=Wood_Schmidt_EvalSigmaEff(sigma2,q,[1 2 3 4 5 6 7],[1 0 0 0 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);
			%alphanice=f20{chosensurface}/f10{chosensurface};
			%deltalambda1=deltalambda1+alphanice*deltalambdadrift;
			%deltasigmanice=-deltalambdadrift*C*dfdsigma{chosensurface}
			%end of intermediate for calculating alphahp nice
			
			%deltasigma1=deltasigmae*deltaT-deltalambda1*C*dfdsigma{chosensurface};
			%deltaalpha1=[0 0 0 0 0 0 0];
			%deltaalpha1(chosensurface)=deltalambda1;
			% start of deltalambdaok
			%if deltalambda1ok
			%sigma2=sigma1+deltasigma1;%+alphanice*deltasigmanice;
			%alpha2=alpha1+deltaalpha1;%+alphanice*deltalambdadrift;
			%[q,dqdalpha,d2qdalpha2]=qandDfromalpha2(alpha2);
			%[f20,dfdsigma,dfdqchosen,~]=Wood_Schmidt_EvalSigmaEff(sigma2,q,[1 2 3 4 5 6 7],[1 0 0 0 0 0]);
			sigma2trial=sigma2+deltasigmae*deltaT;
			evaltimes=evaltimes+1;
			[f2trial,~]=Wood_Schmidt_EvalSigmaEff(sigma2trial,q,[1 2 3 4 5 6 7],[1 0 0 0 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);
			elastic=1;
			for i=1:7
				if f2trial{i}>0 && f2trial{i}>f20{i}
					alphafact(i)=(f20{i}/(f20{i}-f2trial{i}));
					elastic=0;
				else
					if f2trial{i}>0
						%disp(['Warning for spid=' num2str(spid) ': f2trial{' num2str(i) '}>0 but <f20{' num2str(i) '}, special treatment is assumed']);
						%disp('Press any key to continue');
						%pause;
						alphafact(i)=-f20{i};
						elastic=0;
						1;
					else
						alphafact(i)=1;
					end
				end
				
			end
			if elastic
				%disp('Turns Out to be Elastic on deltalambda2');
				deltalambda2=0;
			else
				alphafactchosen=min(alphafact);
				if alphafactchosen~=1
					for i=1:7
						if alphafactchosen==alphafact(i)
							chosensurface=i;
						end
					end
				end
				if implicithasfailed && deltaT<1e-3
					chosensurface=chosensurface1;
				end
				alphafactchosen=max(0,alphafactchosen);
				evaltimes=evaltimes+1;
				[DUMMY,dfdsigma,dfdqchosen,d2fdsigma2,~]=Wood_Schmidt_EvalSigmaEff(sigma2,q,chosensurface,[0 1 1 1 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);
				A2=-dfdqchosen{chosensurface}(chosensurface)*dqdalpha(chosensurface);
				%A2=-dfdqchosen{chosensurface}(chosensurface)*dqdalpha(chosensurface)*([1 1 1 1 1 1])*dfdsigma{chosensurface};
				B=transpose(dfdsigma{chosensurface})*C*dfdsigma{chosensurface};
				%deltalambda2=(transpose(dfdsigma{chosensurface})*deltasigmae*deltaT+max(0,(2*deltaT/(1-T))*f20{chosensurface}))/(A2+B);
				deltalambda2=(transpose(dfdsigma{chosensurface})*deltasigmae*deltaT)/(A2+B);
				%deltalambda2=(transpose(dfdsigma{chosensurface})*deltasigmae*deltaT+max(0,deltaT*fprev{chosensurface}))/(A2+B);
				chosensurface2=chosensurface;
			end
			deltalambda2ok=1;


			if deltalambda2<0
				%disp('deltalambda2<0!')
				if A2+B<0
					%printvector(substepiter,'substepiter');
					%printvector(chosensurface,'chosensurface');
					%printvector(alphafactchosen,'alphafactchosen');
					%printvector(sigma{substepiter},'sigma{substepiter}');
					%printvector(alphahp{substepiter},'alphahp{substepiter}');
					Aq2=0.5*transpose(C*dfdsigma{chosensurface})*(d2fdsigma2{chosensurface})*(C*dfdsigma{chosensurface})+0.5*d2qdalpha2(chosensurface);
					%Bq2=dqdalpha(chosensurface)-transpose(dfdsigma{chosensurface})*C*dfdsigma{chosensurface}-transpose(C*dfdsigma{chosensurface})*d2fdsigma2{chosensurface}*(deltasigmae*deltaT);
					%Cq2=transpose(dfdsigma{chosensurface})*deltasigmae*deltaT+max(0,(2*deltaT/(1-T))*f20{chosensurface})+0.5*transpose(deltasigmae*deltaT)*d2fdsigma2{chosensurface}*(deltasigmae*deltaT);
					%Cq2=transpose(dfdsigma{chosensurface})*deltasigmae*deltaT+max(0,deltaT*fprev{chosensurface})+0.5*transpose(deltasigmae*deltaT)*d2fdsigma2{chosensurface}*(deltasigmae*deltaT);
					Pq2=(-transpose(C*dfdsigma{chosensurface})*d2fdsigma2{chosensurface}*deltasigmae)^2+(-2*transpose(C*dfdsigma{chosensurface})*d2fdsigma2{chosensurface}*C*dfdsigma{chosensurface}-2*d2qdalpha2(chosensurface))*(1/2)*transpose(deltasigmae)*d2fdsigma2{chosensurface}*deltasigmae;
					Qq2=2*transpose(C*dfdsigma{chosensurface})*d2fdsigma2{chosensurface}*deltasigmae*(transpose(dfdsigma{chosensurface})*C*dfdsigma{chosensurface}-dqdalpha(chosensurface))+(-2*transpose(C*dfdsigma{chosensurface})*d2fdsigma2{chosensurface}*C*dfdsigma{chosensurface}-2*d2qdalpha2(chosensurface))*transpose(dfdsigma{chosensurface})*deltasigmae;
					Rq2=(-transpose(dfdsigma{chosensurface})*C*dfdsigma{chosensurface}+dqdalpha(chosensurface))^2+(-2*transpose(C*dfdsigma{chosensurface})*d2fdsigma2{chosensurface}*C*dfdsigma{chosensurface}-2*d2qdalpha2(chosensurface))*f20{chosensurface};
					if Rq2<=0
						deltalambda2=0;
					else
						Kq2=-(Pq2/(2*sqrt(Rq2))-Qq2^2/(8*Rq2*sqrt(Rq2)))/(2*Aq2);
						Lq2a=(transpose(C*dfdsigma{chosensurface})*d2fdsigma2{chosensurface}*deltasigmae-Qq2/(2*sqrt(Rq2)))/(2*Aq2);
						Lq2b=(transpose(C*dfdsigma{chosensurface})*d2fdsigma2{chosensurface}*deltasigmae+Qq2/(2*sqrt(Rq2)))/(2*Aq2);
						Lq2=max(Lq2a,Lq2b);
						Mq2=(transpose(dfdsigma{chosensurface})*C*dfdsigma{chosensurface}-dqdalpha(chosensurface)-sqrt(Rq2))/(2*Aq2);
						%deltalambda1=(-Bq1-sqrt(Bq1^2-4*Aq2*Cq2))/(2*Aq2);
						%deltalambda1=Kq2*deltaT^2+Lq2*deltaT+Mq2;
						%deltalambda2=Kq2*deltaT^2+Lq2*deltaT+(200*deltaT/(1-T))*Mq2;
						%deltalambda2=Kq2*deltaT^2+Lq2*deltaT;
						%deltalambda2ok=0;
						deltalambda2=Lq2*deltaT;
						if deltalambda2<0
							deltalambda2=0;
						end
					end
					%disp('deltalambda2 not ok');
					deltalambda2ok=0;
					%uisave;
				else
					deltalambda2=0;
				end
			end
			%if deltalambda2ok
			deltasigma2=deltasigmae*deltaT-deltalambda2*C*dfdsigma{chosensurface};
			deltaalpha2=[0 0 0 0 0 0 0];
			deltaalpha2(chosensurface)=deltalambda2;%+alphanice*deltalambdadrift;
			E=0.5*(-deltasigma1+deltasigma2);
			
			sigma{substepiter+1}=sigma{substepiter}+0.5*(deltasigma1+deltasigma2);
			if deltalambda1ok && deltalambda2ok && (deltaT>0 || deltalambdanice>0)
				sigma{substepiter+1}=sigma{substepiter+1}+deltasigmanice;
				R=sqrt(dot(E,E))/sqrt(dot(sigma{substepiter+1},sigma{substepiter+1}));
			else
				sigmaimplicitstart=sigma{substepiter+1};
				R=sqrt(dot(E,E))/sqrt(dot(sigma{substepiter+1}+deltasigmanice,sigma{substepiter+1}+deltasigmanice));
			end
			
			surfacehistory(chosensurface1)=1;
			surfacehistory(chosensurface2)=1;

			%{
			if sqrt(dot(deltasigmanice,deltasigmanice))>1;
				1;
			end
			%}
			
			%end
			%else
			%    sigma{substepiter+1}=sigma{substepiter}+deltasigma1;
			%    R=0;
			%end
				
			% end of delta lambda OK
			
			if R>NormLimit
				qfordeltaT=max(0.8*sqrt(NormLimit/R),0.1);
				deltaT=deltaT*qfordeltaT;
				%disp(['deltaT reduced to ' num2str(deltaT)]);
			else
				T=T+deltaT;
				if deltalambda1ok & deltalambda2ok && (deltaT>0 || deltalambdanice>0)
				%if deltalambda1ok
					deltaalphataken=0.5*(deltaalpha1+deltaalpha2);
					alphahp{substepiter+1}=alphahp{substepiter}+deltaalphataken;
					deltalambdanice=max([deltalambdanice -deltaalphataken(chosensurface1)]);
					alphahp{substepiter+1}(chosensurface1)=alphahp{substepiter+1}(chosensurface1)+deltalambdanice;
				%else
				%    alphahp{substepiter+1}=alphahp{substepiter}+(deltaalpha1);
				%end
				else
					alphaimplicitstart=alphahp{substepiter}+0.5*(deltaalpha1+deltaalpha2);
					[q,~]=qandDfromalpha2(alphaimplicitstart,ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit);
					evaltimes=evaltimes+1;
					[fimplicitstart,~]=Wood_Schmidt_EvalSigmaEff(sigmaimplicitstart,q,[1 2 3 4 5 6 7],[1 0 0 0 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);

					sigmaimplicitstarttrial=sigmaimplicitstart+deltasigmae*deltaT;
					evaltimes=evaltimes+1;
					[fimplicitstarttrial,~]=Wood_Schmidt_EvalSigmaEff(sigmaimplicitstarttrial,q,[1 2 3 4 5 6 7],[1 0 0 0 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);
					for i=1:7
						if fimplicitstarttrial{i}<=0
							alphafact(i)=1;
						else
							alphafact(i)=(fimplicitstart{i}/(fimplicitstart{i}-fimplicitstarttrial{i}));
							if alphafact(i)>1
								alphafact(i)=-fimplicitstarttrial{i};
							end
						end
					end
					if chosensurface1==chosensurface2
						chosensurface=chosensurface1;
					elseif deltalambda1ok==0 && deltalambda2ok==1
						chosensurface=chosensurface1;
					elseif deltalambda1ok==1 && deltalambda2ok==0
						chosensurface=chosensurface2;
					else
						alphafactchosen=min(alphafact);
						if alphafactchosen~=1
							for i=1:7
								if alphafactchosen==alphafact(i)
									chosensurface=i;
								end
							end
						end
					end
					surfacehistory(chosensurface)=1;
					%{
					if chosensurface1==chosensurface2
						chosensurface=chosensurface1;
					else
						if deltalambda1ok==0 & deltalambda2ok==0
							disp('warning: ambiguous choice of chosensurface for implicit correction');
							uisave;
							chosensurface=chosensurface2;
						elseif deltalambda1ok==0
							chosensurface=chosensurface1;
						elseif deltalambda2ok==0
							chosensurface=chosensurface2;
						else
							disp('unexpected error here');
							uisave;
						end
					end
					%}
					1;
					% start of deltalambda guess (alphahp-widening)
					if CellMax(fimplicitstart)>0
						[q,dqdalpha,d2qdalpha2]=qandDfromalpha2(alphaimplicitstart,ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit);
						evaltimes=evaltimes+1;
						[fimplicitstart,dfdsigma,dfdqchosen,~]=Wood_Schmidt_EvalSigmaEff(sigmaimplicitstart,q,chosensurface,[1 1 1 0 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);
						if deltaT==0
							deltalambdaguess=1.1*transpose(dfdsigma{chosensurface})*deltaepsilone*(NormLimit^2)/(transpose(dfdsigma{chosensurface})*dfdsigma{chosensurface});
						else
							deltalambdaguess=1.1*transpose(dfdsigma{chosensurface})*deltaepsilone*deltaT/(transpose(dfdsigma{chosensurface})*dfdsigma{chosensurface});
						end
						if deltalambdaguess<=0
							%disp('deltalambdaguess<0!')
							if deltaT==0
								deltalambdaguess=-0.1*transpose(dfdsigma{chosensurface})*deltaepsilone*(NormLimit^2)/(transpose(dfdsigma{chosensurface})*dfdsigma{chosensurface});
							else
								deltalambdaguess=-0.1*transpose(dfdsigma{chosensurface})*deltaepsilone*deltaT/(transpose(dfdsigma{chosensurface})*dfdsigma{chosensurface});
							end
							%deltalambdaguess=-0.1*transpose(dfdsigma{chosensurface})*deltaepsilone*deltaT/(transpose(dfdsigma{chosensurface})*dfdsigma{chosensurface});
						end
						for wideningiteration=1:99999
							alphawidened=alphaimplicitstart;
							alphawidened(chosensurface)=alphaimplicitstart(chosensurface)+deltalambdaguess;
							sigmawidened=sigmaimplicitstart-C*deltalambdaguess*dfdsigma{chosensurface};
							[q,dqdalpha,d2qdalpha2]=qandDfromalpha2(alphawidened,ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit);
							evaltimes=evaltimes+1;
							[fimplicitstart,dfdsigma,~]=Wood_Schmidt_EvalSigmaEff(sigmawidened,q,chosensurface,[1 1 0 0 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);
							if fimplicitstart{chosensurface}<0
								break
							else
								deltalambdaguess=deltalambdaguess*1.1;
							end
						end
						
						% end of deltalambda guess
					end
					
					% start of implicit iteration
					%{
					epsilontimp=epsilont+T*deltaepsilon;
					epsiloneimp=(C^-1)*sigmaimplicitstart;
					epsilonpimpn=epsilontimp-epsiloneimp;
					epsilonpimp=epsilontimp-epsiloneimp;
					%}
					alphaimpn=alphaimplicitstart;                
					alphaimp=alphawidened;
					sigmaimpn=sigmaimplicitstart;
					sigmaimp=sigmawidened;
					deltagamma=0;
					for impiteration=1:99999
						[q,dqdalpha,~]=qandDfromalpha2(alphaimp,ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit);
						evaltimes=evaltimes+1;
						[f,dfdsigma,dfdqchosen,d2fdsigma2,~]=Wood_Schmidt_EvalSigmaEff(sigmaimp,q,chosensurface,[1 1 0 1 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);
						Rimp(1:6,1)=sigmaimp-sigmaimpn+C*deltagamma*dfdsigma{chosensurface};
						Rimp(7,1)=alphaimp(chosensurface)-alphaimpn(chosensurface)-deltagamma;
						Rimp(8,1)=f{chosensurface};
						Err=sqrt(dot(Rimp,Rimp));
						if Err<NormLimit
							break
						end
						J=zeros(8,8);
						J(1:6,1:6)=eye(6,6)+C*deltagamma*d2fdsigma2{chosensurface};
						J(1:6,8)=C*dfdsigma{chosensurface};
						J(7,7)=1;
						J(7,8)=-1;
						J(8,1:6)=transpose(dfdsigma{chosensurface});
						J(8,7)=dqdalpha(chosensurface);
						deltaX=-(J^-1)*Rimp;
						sigmaimp=sigmaimp+deltaX(1:6,1);
						alphaimp(chosensurface)=alphaimp(chosensurface)+deltaX(7,1);
						deltagamma=deltagamma+deltaX(8,1);
						%{
						[q,dqdalpha,d2qdalpha2]=qandDfromalpha2(alphaimp);
						[f,dfdsigma,dfdqchosen,d2fdsigma2,~]=Wood_Schmidt_EvalSigmaEff(sigmaimp,q,chosensurface,[1 1 1 1 0 0]);
						Rimp(1:6,1)=-epsilonpimp+epsilonpimpn+deltagamma*dfdsigma{chosensurface};
						Rimp(7,1)=-alphaimp(chosensurface)+alphaimpn(chosensurface)+deltagamma;
						if impiteration>1 & sqrt(dot(Rimp,Rimp))<NormLimit & f{chosensurface}<NormLimit
							break
						end
						Ainv=zeros(7,7);
						Ainv(1:6,1:6)=(C^-1)+deltagamma*d2fdsigma2{chosensurface};
						Ainv(7,7)=-(1/dqdalpha(chosensurface));
						Aimp=Ainv^-1;
						delta2gamma=(f{chosensurface}-[transpose(dfdsigma{chosensurface}) 1]*Aimp*Rimp)/([transpose(dfdsigma{chosensurface}) 1]*Aimp*[dfdsigma{chosensurface};1]);
						deltaepsilondeltaalpha=[C^-1 zeros(6,1);zeros(1,6) -(1/dqdalpha(chosensurface))]*Aimp*(Rimp+delta2gamma*[dfdsigma{chosensurface};1]);
						epsilonpimp=epsilonpimp+deltaepsilondeltaalpha(1:6);
						alphaimp(chosensurface)=alphaimp(chosensurface)+deltaepsilondeltaalpha(7);
						deltagamma=deltagamma+delta2gamma;
						%}
					end
					sigma{substepiter+1}=sigmaimp;
					alphahp{substepiter+1}=alphaimp;

					% end of implicit iteration
				end
				substepiter=substepiter+1;
				%if deltalambda1ok
					qfordeltaT=min(0.8*sqrt(NormLimit/R),2);
					deltaT=deltaT*qfordeltaT;
				%else
				%    deltaT=deltaTbackup;
				%end
			end
			if chosensurface1>0 && chosensurface2>0 && chosensurface1~=chosensurface2
				for i=size(last5surfaces,1):-1:2
					last5surfaces(i,:)=last5surfaces(i-1,:);
				end
				if chosensurface1<chosensurface2
					last5surfaces(1,1)=chosensurface1;
					last5surfaces(1,2)=chosensurface2;
				else
					last5surfaces(1,1)=chosensurface2;
					last5surfaces(1,2)=chosensurface1;
				end
				%disp(['different surfaces carried out, ' num2str(chosensurface1) ' and ' num2str(chosensurface2) ', deltaT=' num2str(deltaT)]);
				consistentmultisurfaceconfirmed=1;
				for i=2:size(last5surfaces,1)
					if last5surfaces(1,1)~=last5surfaces(i,1) || last5surfaces(1,2)~=last5surfaces(i,2)
						consistentmultisurfaceconfirmed=0;
						break;
					end
				end
			end
			%{
			implicitsubstepnumber=0;
			implicithasfailed=0;
			%}
			if consistentmultisurfaceconfirmed==1 && implicithasfailed==0
				deltaT=1-T;
			end
		end
	end
		
	1;
	
	%hardeningsurfacesoriginal=hardeningsurfaces;
	
	%iteration=0;
	%{
	substepnum=10;
	deltaepsilonsubstep=deltaepsilon/substepnum;
	
	
	for substepiter=1:substepnum
		%deltaepsilon=transpose([1*sin(step/100*2*pi) 1*cos(step/100*2*pi) 1/100*step 1*sin(step/100*2*pi) 1*cos(step/100*2*pi) 1/100*step])/1000;
		[q,Dcut]=qandDfromalpha(alphahp{substepiter},hardeningsurfaces);
		sigmatrial=sigma{substepiter}+C*deltaepsilonsubstep;
		evaltimes=evaltimes+2;
		[ftrial,~,~]=Wood_Schmidt_EvalSigmaHardening(sigmatrial,q,hardeningsurfaces);
		[fprev,~,~]=Wood_Schmidt_EvalSigmaHardening(sigma{substepiter},q,hardeningsurfaces);
		elastic=1;
		for i=1:7
			if ftrial{i}<=0
				alphafact(i)=1;
			%elseif fprev{i}<=0 & ftrial{i}>0
			%    alphafact(i)=(fprev{i}/(fprev{i}-ftrial{i}));
			%else
			%    alphafact(i)=0;
			else
				alphafact(i)=(fprev{i}/(fprev{i}-ftrial{i}));
				elastic=0;
			end
		end
		if elastic
			sigma{substepiter+1}=sigmatrial;
			alphahp{substepiter+1}=alphahp{substepiter};
		else
			alphafactchosen=min(alphafact);
			for i=1:7
				if alphafactchosen==alphafact(i)
					chosensurface=i;
					break;
				end
			end
			alphafactchosen=max(0,alphafactchosen);
			sigmaalpha=sigma{substepiter}+(sigmatrial-sigma{substepiter})*alphafactchosen;
			[q,Dchosen]=qandDfromalpha(alphahp{substepiter},chosensurface);
			[DUMMY,dfdsigma,dfdqchosen,~]=Wood_Schmidt_EvalSigmaHardening(sigmaalpha,q,chosensurface);
			A=dfdqchosen{chosensurface}*Dchosen;
			deltaepsilonsubstepalpha=deltaepsilonsubstep*(1-alphafactchosen);
			deltalambda=transpose(dfdsigma{chosensurface})*C/(A+transpose(dfdsigma{chosensurface})*C*dfdsigma{chosensurface})*deltaepsilonsubstepalpha;
			if deltalambda<0
				disp('deltalambda<0!')
				printvector(substepiter,'substepiter');
				printvector(chosensurface,'chosensurface');
				printvector(alphafactchosen,'alphafactchosen');
				printvector(sigma{substepiter},'sigma{substepiter}');
				printvector(alphahp{substepiter},'alphahp{substepiter}');
				pause
			end
			Cp=C*dfdsigma{chosensurface}*transpose(dfdsigma{chosensurface})*C/(A+transpose(dfdsigma{chosensurface})*C*dfdsigma{chosensurface});
			Cep=C-Cp;
			alphahp{substepiter+1}=alphahp{substepiter};
			alphahp{substepiter+1}(chosensurface)=alphahp{substepiter}(chosensurface)+deltalambda;
			sigma{substepiter+1}=sigmaalpha+Cep*deltaepsilonsubstepalpha;
		end
	end
	%}
	[q,~]=qandDfromalpha2(alphahp{substepiter},ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit);
	evaltimes=evaltimes+1;
	[f_final,~]=Wood_Schmidt_EvalSigmaEff(sigma{substepiter},q,[1 2 3 4 5 6 7],[1 0 0 0 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);
	[f_maxfinal,surfacewithfmax]=CellMax(f_final);
	f_final_vect=zeros(1,7);
	for i=1:7
		f_final_vect(i)=f_final{i};
	end
	epsilone=Comp*sigma{substepiter};
	epsilont=epsilont+deltaepsilon;
	epsilonp=epsilont-epsilone;
	epsilonp_planestrain=epsilonp;
	if planestressmod
		epsilonp=zeros(6,1);
		for i=1:6
			if i==zdir||i==yzdir||i==xzdir
				continue;
			end
			if planestressmod==2
				if i==ydir||i==xydir
					continue;
				end
			end
			epsilonp(i,1)=epsilonp_planestrain(i,1);
		end
	end
	epsilont=epsilone+epsilonp;

	1;

	%{
	disp('From Previous Step')
	printvector(sigma0,'sigma');
	printvector(epsilonp{step},'epsilonp')
	printvector(epsilont{step}-epsilonp{step},'epsilone');
	printvector(epsilont{step},'epsilont');
	printvector(alphahp{step},'alphahp');
	print11cell(fprev,'f');
	disp(' ')
	printvector(deltaepsilon,'applying deltaepsilon');

	for i=1:7
		if ftrial{i}>0
			elastic=0;
			suspectedsurfaces=[suspectedsurfaces i];
		end
	end
	if elastic
		for i=1:6
			sigma(i,1)=sigmatrial(i);
			%sigmastep(i,step+1)=sigmatrial(i);
		end
		for i=1:7
			fstep(i,step+1)=ftrial{i};
		end
	else
		activesurface=suspectedsurfaces;
		for shediter=1:length(suspectedsurfaces)
			for i=1:length(activesurface)
				reversedactivesurface(1+length(activesurface)-i)=activesurface(i);
			end
			%activesurface=reversedactivesurface;
			sigma=sigmatrial;
			deltagamma=[];
			for i=1:length(activesurface)
				deltagamma(i)=0;
			end
			%start of iteration
			%hardeningsurfaces=[];
			
			
			[q,Dcut]=qandDfromalpha(alphahp{step+1},hardeningsurfaces);
			[f, dfdsigma, dfdqcut, d2fdsigma2, d2fdsigmadqcut, d2fdq2cut]=Wood_Schmidt_EvalSigmaHardening(sigma,q,hardeningsurfaces);
			%q=[ 0.33427665424966501728221146549913, -0.0077191419876790618273584205447933, 0, -0.0077191419876790618273584205447933, 0, -0.10020040080160320641282565130261, -0.0077191419876790618273584205447933];
			%q=[ 0.95, -0.0077191419876790618273584205447933, 0, -0.0077191419876790618273584205447933, 0, -0.10020040080160320641282565130261, -0.0077191419876790618273584205447933];
			%sigma=transpose([0 0 0 0 0 0])
			%sigma=sigma-C*(dfdsigma{1}*0.0037143167443528112177386635295306);
			disp(' ')
			disp('Guess #1, assuming all elastic, deltaepsilone=deltaepsilon')
			
			
	%start of wojtek print
	
	printvector(sigma,'sigma')
	printvector(epsilonp{step+1},'epsilonp')
	printvector(epsilont{step+1}-epsilonp{step+1},'epsilone')
	printvector(epsilont{step+1},'epsilont')
	printvector(alphahp{step+1},'alphahp',activesurface)
	print11cell(f,'f',activesurface)

	%end of wojtek print
			disp(' ');
			disp('Guess #2, assuming all plastic, deltaeisplonp=deltaepsilon');
			
	
			for i=1:length(activesurface)
				%deltagamma(alphaiter)=transpose(deltaepsilon)*dfdsigma{1}/(transpose(dfdsigma{1})*dfdsigma{1});
				deltagamma(i)=f{activesurface(i)}/(transpose(C*dfdsigma{activesurface(i)})*dfdsigma{activesurface(i)});
				alphahp{step+1}(activesurface(i))=alphahp{step}(activesurface(i))+deltagamma(i);
				disp(['best guess of deltaalpha for ' surfacenumtoname(activesurface(i)) ' (surface #' num2str(activesurface(i)) ') = ' num2str(alphahp{step+1}(activesurface(i)))]);
			end

			%start of backforthloop
			for backforthloop=1:999
				%start of alphaexpansion loop
				disp(' ');
				disp(' ');
				disp(['trial #' num2str(backforthloop)]);
				for alphaiter=1:length(activesurface)
					disp([' ']);
					disp(['active surface ' num2str(alphaiter) '/' num2str(length(activesurface)) ' : ' surfacenumtoname(activesurface(alphaiter)) ' (#' num2str(activesurface(alphaiter)) ')']);
					if f{activesurface(alphaiter)}<=0
						disp(' ')
						disp(['f{' num2str(activesurface(alphaiter)) '} already less than zero'])
						disp(['sticking with alphahp(' num2str(activesurface(alphaiter)) ')=' num2str(alphahp{step+1}(activesurface(alphaiter)))]);
						continue
					end
					
					disp(' ')
					%disp(['trial #' num2str(alphaguesstry2)]);
					alphaguesstry2=[];
					alphahp{step+1}(activesurface(alphaiter))=alphahp{step}(activesurface(alphaiter))+deltagamma(alphaiter);
					[q,~]=qandDfromalpha(alphahp{step+1},hardeningsurfaces);
					deltaepsilonp=transpose([0 0 0 0 0 0]);
					for i=1:length(activesurface)
						deltaepsilonp=deltaepsilonp+deltagamma(i)*dfdsigma{activesurface(i)};
					end
					epsilonp{step+1}=epsilonp{step}+deltaepsilonp;
					sigma=sigmatrial-C*deltaepsilonp;
					[f,dfdsigma]=Wood_Schmidt_EvalSigmaHardening(sigma,q,hardeningsurfaces);

					%start of wojtek print

					printvector(sigma,'sigma')
					printvector(epsilonp{step+1},'epsilonp')
					printvector(epsilont{step+1}-epsilonp{step+1},'epsilone')
					printvector(epsilont{step+1},'epsilont')
					printvector(alphahp{step+1},'alphahp',activesurface)
					print11cell(f,'f',activesurface)


					%end of wojtek print

					if f{(activesurface(alphaiter))}<0
						disp(' ')
						disp(['take alphahp(' num2str(activesurface(alphaiter)) ')=' num2str(alphahp{step+1}(activesurface(alphaiter)))]);
						break
					else
						deltagamma(alphaiter)=deltagamma(alphaiter)*1.2;
						disp(['multiplying deltaalpha of surface ' num2str(alphaiter) '/' num2str(length(activesurface)) ' by 1.2'])
						alphahp{step+1}(activesurface(alphaiter))=alphahp{step}(activesurface(alphaiter))+deltagamma(alphaiter);
						printvector(alphahp{step+1},'alphahp',activesurface)
					end
				end        
				%end of alphahp expansion loop
				alphaexpansionbreaksignal=1;
				for i=1:length(activesurface)
					if f{activesurface(i)}>0
						alphaexpansionbreaksignal=0;
					end
				end
				if alphaexpansionbreaksignal==1
					disp('all f are < 0');
					break
				end
			end
			%end of backforthloop
			%sigma=transpose([0 0 0 0 0 0]);
			disp(' ')
			texttodisplay=['starting newton-rhapson from guess #2, initial sigma=['];
			for i=1:length(sigma);
				if i>1
					texttodisplay=[texttodisplay ','];
				end
				texttodisplay=[texttodisplay num2str(sigma(i))];
			end
			texttodisplay=[texttodisplay ']'];
			disp(texttodisplay);
			deltagamma=zeros(1,length(activesurface));
			alphahp{step+1}=alphahp{step};
			[q,~]=qandDfromalpha(alphahp{step+1},hardeningsurfaces);
			for iteration=1:999
				if step==94
				end
				[f, dfdsigma, dfdqcut, d2fdsigma2, d2fdsigmadqcut, d2fdq2cut]=Wood_Schmidt_EvalSigmaHardening(sigma,q,hardeningsurfaces);
				sigmadeltagammadfdsigmadfdq=zeros(6+length(hardeningsurfaces),1);
				for i=1:length(activesurface)
					sigmadeltagammadfdsigmadfdq=sigmadeltagammadfdsigmadfdq+deltagamma(i)*[dfdsigma{activesurface(i)};dfdqcut{activesurface(i)}];
				end
				epsilonandalphavector=[-epsilonp{step+1}+epsilonp{step}];
				for i=1:length(hardeningsurfaces)
					epsilonandalphavector=[epsilonandalphavector;-alphahp{step+1}(hardeningsurfaces(i))+alphahp{step}(hardeningsurfaces(i))];
				end
				R=epsilonandalphavector+sigmadeltagammadfdsigmadfdq;
				BigR=[R];
				for i=1:length(activesurface);
					BigR=[BigR;f{activesurface(i)}];
				end
				Norm=sqrt(dot(BigR,BigR));
				%disp(['Norm=' num2str(Norm)]);
				if length(activesurface)>1
				end
				Cep=Cepcalc(C,deltagamma,dfdsigma,d2fdsigma2,activesurface);
				if Norm<NormLimit
					break
				end
				%Calculating A
				sigmadeltagammad2fdsigma2dsigmadqdqdsigmadq2=zeros(length(epsilonandalphavector),length(epsilonandalphavector));
				for i=1:length(activesurface)
					sigmadeltagammad2fdsigma2dsigmadqdqdsigmadq2=sigmadeltagammad2fdsigma2dsigmadqdqdsigmadq2+deltagamma(i)*[d2fdsigma2{activesurface(i)} d2fdsigmadqcut{activesurface(i)};transpose(d2fdsigmadqcut{activesurface(i)}) d2fdq2cut{activesurface(i)}];
				end
				Ainv=[C^-1 zeros(6,length(hardeningsurfaces));zeros(length(hardeningsurfaces),6) Dcut^-1]+sigmadeltagammad2fdsigma2dsigmadqdqdsigmadq2;
				A=Ainv^-1;
				Gdown=[];
				Gup=[];
				if step==30
				end
				for alphaindex=1:length(activesurface)
					for beta=1:length(activesurface)
						Gdown(alphaindex,beta)=transpose([dfdsigma{activesurface(alphaindex)};dfdqcut{activesurface(alphaindex)}])*A*[dfdsigma{activesurface(beta)};dfdqcut{activesurface(beta)}];
						%Gup(alphaindex,beta)=1/Gdown(alphaindex,beta);
					end
				end
				Gup=Gdown^-1;
				delta2gamma=[];
				for alphaindex=1:length(activesurface)
					delta2gamma(alphaindex)=0;
					for beta=1:length(activesurface)
						delta2gamma(alphaindex)=delta2gamma(alphaindex)+Gup(alphaindex,beta)*(f{activesurface(beta)}-transpose([dfdsigma{activesurface(beta)};dfdqcut{activesurface(beta)}])*A*R);
					end
				end
				if delta2gamma>0 & iteration==1
					if length(activesurface)==1
						if activesurface==[1];
						end
					end
				end
				deltagamma=deltagamma+delta2gamma;
				shedsignal=0;
				newactivesurface=[];
				%{
				for i=1:length(deltagamma)
					if deltagamma(i)<0
						shedsignal=1;
					else
						newactivesurface=[newactivesurface activesurface(i)];
					end
				end
				if shedsignal==1
					activesurface=newactivesurface;
					break
				end
				%}
				sigmadelta2gammadfdsigmadfdq=zeros(length(epsilonandalphavector),1);
				for beta=1:length(activesurface)
					sigmadelta2gammadfdsigmadfdq=sigmadelta2gammadfdsigmadfdq+delta2gamma(beta)*[dfdsigma{activesurface(beta)};dfdqcut{activesurface(beta)}];
				end
				deltaepsilonpdeltaalpha=[C^-1 zeros(6,length(hardeningsurfaces));zeros(length(hardeningsurfaces),6) Dcut^-1]*A*(R+sigmadelta2gammadfdsigmadfdq);
				deltaepsilonp=deltaepsilonpdeltaalpha(1:6);
				epsilonp{step+1}=epsilonp{step+1}+deltaepsilonp;
				epsilone=epsilont{step+1}-epsilonp{step+1};
				deltaalpha=zeros(7,1);
				for i=1:length(hardeningsurfaces)
					deltaalpha(hardeningsurfaces(i))=deltaepsilonpdeltaalpha(6+i);
					alphahp{step+1}(hardeningsurfaces(i))=alphahp{step+1}(hardeningsurfaces(i))+deltaalpha(hardeningsurfaces(i));
				end
				if iteration==1
					%alphahp{step+1}(1)=alphahp{step}(1)+deltagamma(1);
				end
				%hardeningsurfaces=hardeningsurfacesoriginal;
				
				
	
				
				[q,Dcut]=qandDfromalpha(alphahp{step+1},hardeningsurfaces);
				sigma=C*epsilone;
				
				%start of wojtek display
				disp(' ')
				
		texttodisplay=['step=' num2str(step+1) '; '];
		texttodisplay=[texttodisplay 'iteration=' num2str(iteration) '; '];
		texttodisplay=[texttodisplay 'deltaepsilonmag=' num2str(sqrt(dot(deltaepsilon,deltaepsilon))*100) '%; '];
			disp(texttodisplay)
		texttodisplay=[];
		
		printvector(sigma,'sigma')
		if elastic==0
			printvector(activesurface,'activesurface')
			print11cell(f,'f',activesurface);
			printvector(deltagamma,'deltagamma')
			
		end
		printvector(epsilonp{step+1},'epsilonp')
		printvector(epsilont{step+1}-epsilonp{step+1},'epsilone')
		printvector(epsilont{step+1},'epsilont')
		printvector(alphahp{step+1},'alphahp',activesurface)
				%end of wojtek display
			end
			if shedsignal==1
				continue
			end
			%end of iteration
			breaksignal=1;
			newactivesurface=activesurface;
			%{
			newactivesurface=[];
			for i=1:length(deltagamma)
				if deltagamma(i)<0
					breaksignal=0;
				else
					newactivesurface=[newactivesurface activesurface(i)];
				end
			end
			%}
			if breaksignal
				for i=1:6
					%sigmastep(i,step+1)=sigma(i);
				end
				for i=1:7
					fstep(i,step+1)=f{i};
				end
				break
			else
				activesurface=newactivesurface;
				if length(activesurface)==0
					disp('All Surfaces Shedded, Didnt Converge');
					pause;
				end
			end
		end
	end
	%}
	
	sigma_global_big(1)=sigma{substepiter}(xdir);
	sigma_global_big(2)=sigma{substepiter}(ydir);
	sigma_global_big(3)=sigma{substepiter}(zdir);
	sigma_global_big(4)=sigma{substepiter}(xydir);
	sigma_global_big(5)=sigma{substepiter}(yzdir);
	sigma_global_big(6)=sigma{substepiter}(xzdir);

	sigma_local_big=sigma{substepiter};
	
	s_sp=zeros(1,3);
	s_sp(1)=sigma_global_big(1);
	s_sp(2)=sigma_global_big(2);
	s_sp(3)=sigma_global_big(4);

	e_t_global_big(1)=epsilont(xdir);
	e_t_global_big(2)=epsilont(ydir);
	e_t_global_big(3)=epsilont(zdir);
	e_t_global_big(4)=epsilont(xydir);
	e_t_global_big(5)=epsilont(yzdir);
	e_t_global_big(6)=epsilont(xzdir);


	e_pl_global_big(1)=epsilonp(xdir);
	e_pl_global_big(2)=epsilonp(ydir);
	e_pl_global_big(3)=epsilonp(zdir);
	e_pl_global_big(4)=epsilonp(xydir);
	e_pl_global_big(5)=epsilonp(yzdir);
	e_pl_global_big(6)=epsilonp(xzdir);
	
	e_pl=zeros(1,3);
	e_pl(1)=e_pl_global_big(1);
	e_pl(2)=e_pl_global_big(2);
	e_pl(3)=e_pl_global_big(4);

	alpha_out=alphahp{substepiter};

	%start Calculating tangent stiffness matrix
	if (isnan(thetacrackrtl) || isinf(thetacrackrtl)) && max(alpha_out)>0
		activesurfacelist=zeros(1,0);
		for i=1:length(surfacehistory)
			if surfacehistory(i)==1
				activesurfacelist=[activesurfacelist i];
			end
		end

		if length(activesurfacelist)==0
			Ktangent_local=C;
		else
			[q,dqdalpha,~]=qandDfromalpha2(alpha_out,ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit);

			dqdalphamat=zeros(length(activesurfacelist));
			for i=1:length(activesurfacelist)
				dqdalphamat(i,i)=dqdalpha(activesurfacelist(i));
			end

			dfdsigmamat=zeros(length(sigma_local_big),length(activesurfacelist));
			[~, dfdsigma,~]=Wood_Schmidt_EvalSigmaEff(sigma_local_big,q,activesurfacelist,[1 1 0 0 0 0],ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun);

			for i=1:length(sigma_local_big)
				for j=1:length(activesurfacelist)
					dfdsigmamat(i,j)=dfdsigma{activesurfacelist(j)}(i);
				end
			end

			Ktangent_local=C*(eye(length(sigma_local_big))-dfdsigmamat*(transpose(dfdsigmamat)*C*dfdsigmamat-dqdalphamat)^(-1)*transpose(dfdsigmamat)*C);
		end
		Ktangent_global=zeros(size(Ktangent_local));
		for i=1:length(dirglobal)
			for j=1:length(dirglobal)
				Ktangent_global(i,j)=Ktangent_local(dirglobal(i),dirglobal(j));
			end
		end

		reductiondesignatorvoight=[1 2 4];

		Ktangent_global_2D=zeros(length(reductiondesignatorvoight),length(reductiondesignatorvoight));

		for i=1:length(reductiondesignatorvoight)
			for j=1:length(reductiondesignatorvoight)
				Ktangent_global_2D(i,j)=Ktangent_global(reductiondesignatorvoight(i),reductiondesignatorvoight(j));
			end
		end
		
		voigt=cell(1,6);
		tensor=cell(3,3,3,3);
		
		voigt{1}=[1 1];
		voigt{2}=[2 2];
		voigt{3}=[3 3];
		voigt{4}=[1 2];
		voigt{5}=[2 3];
		voigt{6}=[1 3];

		for i=1:6
			for j=1:6
				tensor{voigt{i}(1),voigt{i}(2),voigt{j}(1),voigt{j}(2)}=[i j];
				tensor{voigt{i}(1),voigt{i}(2),voigt{j}(2),voigt{j}(1)}=[i j];
				tensor{voigt{i}(2),voigt{i}(1),voigt{j}(1),voigt{j}(2)}=[i j];
				tensor{voigt{i}(2),voigt{i}(1),voigt{j}(2),voigt{j}(1)}=[i j];
			end
		end

		Ktangent_global_tens=zeros(3,3,3,3);
		for i=1:3
			for j=1:3
				for k=1:3
					for l=1:3
						Ktangent_global_tens(i,j,k,l)=Ktangent_global(tensor{i,j,k,l}(1),tensor{i,j,k,l}(2));
					end
				end
			end
		end

		
		reductiondesignatortensor=[1 2];
		Ktangent_global_tens_2D=zeros(length(reductiondesignatortensor),length(reductiondesignatortensor),length(reductiondesignatortensor),length(reductiondesignatortensor));

		for i=1:length(reductiondesignatortensor)
			for j=1:length(reductiondesignatortensor)
				for k=1:length(reductiondesignatortensor)
					for l=1:length(reductiondesignatortensor)
						Ktangent_global_tens_2D(i,j,k,l)=Ktangent_global_tens(reductiondesignatortensor(i),reductiondesignatortensor(j),reductiondesignatortensor(k),reductiondesignatortensor(l));
					end
				end
			end
		end
		
		s_sp_tens_2D=zeros(2,2);
		s_sp_tens_2D(1,1)=s_sp(1);
		s_sp_tens_2D(2,2)=s_sp(2);
		s_sp_tens_2D(1,2)=s_sp(3);
		s_sp_tens_2D(2,1)=s_sp(3);
		
		sigmacrosseye=zeros(2,2,2,2); %it's 2D mkay?
		eyecrosser=eye(2);
		
		for i=1:2
			for j=1:2
				for k=1:2
					for l=1:2
						sigmacrosseye(i,j,k,l)=s_sp_tens_2D(i,j)*eyecrosser(k,l);
					end
				end
			end
		end
		
		AbeforeQ_rtl=Ktangent_global_tens_2D+sigmacrosseye;
		
		lambdamin=inf;
		thetamin=NaN;
		ntestedangle=36*1*1*1;
		lambda1=zeros(ntestedangle,1);
		lambda2=zeros(ntestedangle,1);
		theta=zeros(ntestedangle,1);
		n=zeros(2,1);
		h=zeros(2,2,ntestedangle); %1st index: direction; 2nd index: which lambda; 3rd index: which angle
		Qacoustic=zeros(2,2,ntestedangle);
		for i=1:ntestedangle
			if CasetoRun==81
				theta(i)=i/ntestedangle*pi;
			else
				theta(i)=i/ntestedangle*2*pi; %change your checked angle here!
			end
			n(1)=cos(theta(i));
			n(2)=sin(theta(i));
			for m=1:2
				for nn=1:2
					for o=1:2
						for p=1:2
							Qacoustic(nn,o,i)=Qacoustic(nn,o,i)+n(m)*AbeforeQ_rtl(m,nn,o,p)*n(p);
						end
					end
				end
			end
			[h_eig,lambda_eig]=eig(Qacoustic(:,:,i));
			h(:,:,i)=real(h_eig);
			lambda1(i)=real(lambda_eig(1,1));
			lambda2(i)=real(lambda_eig(2,2));
			%{
			lambda1(i)=(AbeforeQ_rtl(1,1,1,1)*n(1)^2)/2 + (AbeforeQ_rtl(1,2,2,1)*n(1)^2)/2 + (AbeforeQ_rtl(2,1,1,2)*n(2)^2)/2 + (AbeforeQ_rtl(2,2,2,2)*n(2)^2)/2 - (AbeforeQ_rtl(1,1,1,1)^2*n(1)^4 + AbeforeQ_rtl(1,2,2,1)^2*n(1)^4 + AbeforeQ_rtl(2,1,1,2)^2*n(2)^4 + AbeforeQ_rtl(2,2,2,2)^2*n(2)^4 + AbeforeQ_rtl(1,1,1,2)^2*n(1)^2*n(2)^2 + AbeforeQ_rtl(1,2,2,2)^2*n(1)^2*n(2)^2 + AbeforeQ_rtl(2,1,1,1)^2*n(1)^2*n(2)^2 + AbeforeQ_rtl(2,2,2,1)^2*n(1)^2*n(2)^2 - 2*AbeforeQ_rtl(1,1,1,1)*AbeforeQ_rtl(1,2,2,1)*n(1)^4 + 4*AbeforeQ_rtl(1,1,2,1)*AbeforeQ_rtl(1,2,1,1)*n(1)^4 - 2*AbeforeQ_rtl(2,1,1,2)*AbeforeQ_rtl(2,2,2,2)*n(2)^4 + 4*AbeforeQ_rtl(2,1,2,2)*AbeforeQ_rtl(2,2,1,2)*n(2)^4 + 2*AbeforeQ_rtl(1,1,1,1)*AbeforeQ_rtl(1,1,1,2)*n(1)^3*n(2) - 2*AbeforeQ_rtl(1,1,1,1)*AbeforeQ_rtl(1,2,2,2)*n(1)^3*n(2) - 2*AbeforeQ_rtl(1,1,1,2)*AbeforeQ_rtl(1,2,2,1)*n(1)^3*n(2) + 4*AbeforeQ_rtl(1,1,2,1)*AbeforeQ_rtl(1,2,1,2)*n(1)^3*n(2) + 4*AbeforeQ_rtl(1,1,2,2)*AbeforeQ_rtl(1,2,1,1)*n(1)^3*n(2) + 2*AbeforeQ_rtl(1,2,2,1)*AbeforeQ_rtl(1,2,2,2)*n(1)^3*n(2) + 2*AbeforeQ_rtl(1,1,1,1)*AbeforeQ_rtl(2,1,1,1)*n(1)^3*n(2) + 2*AbeforeQ_rtl(1,1,1,2)*AbeforeQ_rtl(2,1,1,2)*n(1)*n(2)^3 - 2*AbeforeQ_rtl(1,1,1,1)*AbeforeQ_rtl(2,2,2,1)*n(1)^3*n(2) + 4*AbeforeQ_rtl(1,1,2,1)*AbeforeQ_rtl(2,2,1,1)*n(1)^3*n(2) + 4*AbeforeQ_rtl(1,2,1,1)*AbeforeQ_rtl(2,1,2,1)*n(1)^3*n(2) - 2*AbeforeQ_rtl(1,2,2,1)*AbeforeQ_rtl(2,1,1,1)*n(1)^3*n(2) - 2*AbeforeQ_rtl(1,1,1,2)*AbeforeQ_rtl(2,2,2,2)*n(1)*n(2)^3 + 4*AbeforeQ_rtl(1,1,2,2)*AbeforeQ_rtl(2,2,1,2)*n(1)*n(2)^3 + 4*AbeforeQ_rtl(1,2,1,2)*AbeforeQ_rtl(2,1,2,2)*n(1)*n(2)^3 - 2*AbeforeQ_rtl(1,2,2,2)*AbeforeQ_rtl(2,1,1,2)*n(1)*n(2)^3 + 2*AbeforeQ_rtl(1,2,2,1)*AbeforeQ_rtl(2,2,2,1)*n(1)^3*n(2) + 2*AbeforeQ_rtl(1,2,2,2)*AbeforeQ_rtl(2,2,2,2)*n(1)*n(2)^3 + 2*AbeforeQ_rtl(2,1,1,1)*AbeforeQ_rtl(2,1,1,2)*n(1)*n(2)^3 - 2*AbeforeQ_rtl(2,1,1,1)*AbeforeQ_rtl(2,2,2,2)*n(1)*n(2)^3 - 2*AbeforeQ_rtl(2,1,1,2)*AbeforeQ_rtl(2,2,2,1)*n(1)*n(2)^3 + 4*AbeforeQ_rtl(2,1,2,1)*AbeforeQ_rtl(2,2,1,2)*n(1)*n(2)^3 + 4*AbeforeQ_rtl(2,1,2,2)*AbeforeQ_rtl(2,2,1,1)*n(1)*n(2)^3 + 2*AbeforeQ_rtl(2,2,2,1)*AbeforeQ_rtl(2,2,2,2)*n(1)*n(2)^3 - 2*AbeforeQ_rtl(1,1,1,2)*AbeforeQ_rtl(1,2,2,2)*n(1)^2*n(2)^2 + 4*AbeforeQ_rtl(1,1,2,2)*AbeforeQ_rtl(1,2,1,2)*n(1)^2*n(2)^2 + 2*AbeforeQ_rtl(1,1,1,1)*AbeforeQ_rtl(2,1,1,2)*n(1)^2*n(2)^2 + 2*AbeforeQ_rtl(1,1,1,2)*AbeforeQ_rtl(2,1,1,1)*n(1)^2*n(2)^2 - 2*AbeforeQ_rtl(1,1,1,1)*AbeforeQ_rtl(2,2,2,2)*n(1)^2*n(2)^2 - 2*AbeforeQ_rtl(1,1,1,2)*AbeforeQ_rtl(2,2,2,1)*n(1)^2*n(2)^2 + 4*AbeforeQ_rtl(1,1,2,1)*AbeforeQ_rtl(2,2,1,2)*n(1)^2*n(2)^2 + 4*AbeforeQ_rtl(1,1,2,2)*AbeforeQ_rtl(2,2,1,1)*n(1)^2*n(2)^2 + 4*AbeforeQ_rtl(1,2,1,1)*AbeforeQ_rtl(2,1,2,2)*n(1)^2*n(2)^2 + 4*AbeforeQ_rtl(1,2,1,2)*AbeforeQ_rtl(2,1,2,1)*n(1)^2*n(2)^2 - 2*AbeforeQ_rtl(1,2,2,1)*AbeforeQ_rtl(2,1,1,2)*n(1)^2*n(2)^2 - 2*AbeforeQ_rtl(1,2,2,2)*AbeforeQ_rtl(2,1,1,1)*n(1)^2*n(2)^2 + 2*AbeforeQ_rtl(1,2,2,1)*AbeforeQ_rtl(2,2,2,2)*n(1)^2*n(2)^2 + 2*AbeforeQ_rtl(1,2,2,2)*AbeforeQ_rtl(2,2,2,1)*n(1)^2*n(2)^2 - 2*AbeforeQ_rtl(2,1,1,1)*AbeforeQ_rtl(2,2,2,1)*n(1)^2*n(2)^2 + 4*AbeforeQ_rtl(2,1,2,1)*AbeforeQ_rtl(2,2,1,1)*n(1)^2*n(2)^2)^(1/2)/2 + (AbeforeQ_rtl(1,1,1,2)*n(1)*n(2))/2 + (AbeforeQ_rtl(1,2,2,2)*n(1)*n(2))/2 + (AbeforeQ_rtl(2,1,1,1)*n(1)*n(2))/2 + (AbeforeQ_rtl(2,2,2,1)*n(1)*n(2))/2;
			lambda2(i)=(AbeforeQ_rtl(1,1,1,1)*n(1)^2)/2 + (AbeforeQ_rtl(1,2,2,1)*n(1)^2)/2 + (AbeforeQ_rtl(2,1,1,2)*n(2)^2)/2 + (AbeforeQ_rtl(2,2,2,2)*n(2)^2)/2 + (AbeforeQ_rtl(1,1,1,1)^2*n(1)^4 + AbeforeQ_rtl(1,2,2,1)^2*n(1)^4 + AbeforeQ_rtl(2,1,1,2)^2*n(2)^4 + AbeforeQ_rtl(2,2,2,2)^2*n(2)^4 + AbeforeQ_rtl(1,1,1,2)^2*n(1)^2*n(2)^2 + AbeforeQ_rtl(1,2,2,2)^2*n(1)^2*n(2)^2 + AbeforeQ_rtl(2,1,1,1)^2*n(1)^2*n(2)^2 + AbeforeQ_rtl(2,2,2,1)^2*n(1)^2*n(2)^2 - 2*AbeforeQ_rtl(1,1,1,1)*AbeforeQ_rtl(1,2,2,1)*n(1)^4 + 4*AbeforeQ_rtl(1,1,2,1)*AbeforeQ_rtl(1,2,1,1)*n(1)^4 - 2*AbeforeQ_rtl(2,1,1,2)*AbeforeQ_rtl(2,2,2,2)*n(2)^4 + 4*AbeforeQ_rtl(2,1,2,2)*AbeforeQ_rtl(2,2,1,2)*n(2)^4 + 2*AbeforeQ_rtl(1,1,1,1)*AbeforeQ_rtl(1,1,1,2)*n(1)^3*n(2) - 2*AbeforeQ_rtl(1,1,1,1)*AbeforeQ_rtl(1,2,2,2)*n(1)^3*n(2) - 2*AbeforeQ_rtl(1,1,1,2)*AbeforeQ_rtl(1,2,2,1)*n(1)^3*n(2) + 4*AbeforeQ_rtl(1,1,2,1)*AbeforeQ_rtl(1,2,1,2)*n(1)^3*n(2) + 4*AbeforeQ_rtl(1,1,2,2)*AbeforeQ_rtl(1,2,1,1)*n(1)^3*n(2) + 2*AbeforeQ_rtl(1,2,2,1)*AbeforeQ_rtl(1,2,2,2)*n(1)^3*n(2) + 2*AbeforeQ_rtl(1,1,1,1)*AbeforeQ_rtl(2,1,1,1)*n(1)^3*n(2) + 2*AbeforeQ_rtl(1,1,1,2)*AbeforeQ_rtl(2,1,1,2)*n(1)*n(2)^3 - 2*AbeforeQ_rtl(1,1,1,1)*AbeforeQ_rtl(2,2,2,1)*n(1)^3*n(2) + 4*AbeforeQ_rtl(1,1,2,1)*AbeforeQ_rtl(2,2,1,1)*n(1)^3*n(2) + 4*AbeforeQ_rtl(1,2,1,1)*AbeforeQ_rtl(2,1,2,1)*n(1)^3*n(2) - 2*AbeforeQ_rtl(1,2,2,1)*AbeforeQ_rtl(2,1,1,1)*n(1)^3*n(2) - 2*AbeforeQ_rtl(1,1,1,2)*AbeforeQ_rtl(2,2,2,2)*n(1)*n(2)^3 + 4*AbeforeQ_rtl(1,1,2,2)*AbeforeQ_rtl(2,2,1,2)*n(1)*n(2)^3 + 4*AbeforeQ_rtl(1,2,1,2)*AbeforeQ_rtl(2,1,2,2)*n(1)*n(2)^3 - 2*AbeforeQ_rtl(1,2,2,2)*AbeforeQ_rtl(2,1,1,2)*n(1)*n(2)^3 + 2*AbeforeQ_rtl(1,2,2,1)*AbeforeQ_rtl(2,2,2,1)*n(1)^3*n(2) + 2*AbeforeQ_rtl(1,2,2,2)*AbeforeQ_rtl(2,2,2,2)*n(1)*n(2)^3 + 2*AbeforeQ_rtl(2,1,1,1)*AbeforeQ_rtl(2,1,1,2)*n(1)*n(2)^3 - 2*AbeforeQ_rtl(2,1,1,1)*AbeforeQ_rtl(2,2,2,2)*n(1)*n(2)^3 - 2*AbeforeQ_rtl(2,1,1,2)*AbeforeQ_rtl(2,2,2,1)*n(1)*n(2)^3 + 4*AbeforeQ_rtl(2,1,2,1)*AbeforeQ_rtl(2,2,1,2)*n(1)*n(2)^3 + 4*AbeforeQ_rtl(2,1,2,2)*AbeforeQ_rtl(2,2,1,1)*n(1)*n(2)^3 + 2*AbeforeQ_rtl(2,2,2,1)*AbeforeQ_rtl(2,2,2,2)*n(1)*n(2)^3 - 2*AbeforeQ_rtl(1,1,1,2)*AbeforeQ_rtl(1,2,2,2)*n(1)^2*n(2)^2 + 4*AbeforeQ_rtl(1,1,2,2)*AbeforeQ_rtl(1,2,1,2)*n(1)^2*n(2)^2 + 2*AbeforeQ_rtl(1,1,1,1)*AbeforeQ_rtl(2,1,1,2)*n(1)^2*n(2)^2 + 2*AbeforeQ_rtl(1,1,1,2)*AbeforeQ_rtl(2,1,1,1)*n(1)^2*n(2)^2 - 2*AbeforeQ_rtl(1,1,1,1)*AbeforeQ_rtl(2,2,2,2)*n(1)^2*n(2)^2 - 2*AbeforeQ_rtl(1,1,1,2)*AbeforeQ_rtl(2,2,2,1)*n(1)^2*n(2)^2 + 4*AbeforeQ_rtl(1,1,2,1)*AbeforeQ_rtl(2,2,1,2)*n(1)^2*n(2)^2 + 4*AbeforeQ_rtl(1,1,2,2)*AbeforeQ_rtl(2,2,1,1)*n(1)^2*n(2)^2 + 4*AbeforeQ_rtl(1,2,1,1)*AbeforeQ_rtl(2,1,2,2)*n(1)^2*n(2)^2 + 4*AbeforeQ_rtl(1,2,1,2)*AbeforeQ_rtl(2,1,2,1)*n(1)^2*n(2)^2 - 2*AbeforeQ_rtl(1,2,2,1)*AbeforeQ_rtl(2,1,1,2)*n(1)^2*n(2)^2 - 2*AbeforeQ_rtl(1,2,2,2)*AbeforeQ_rtl(2,1,1,1)*n(1)^2*n(2)^2 + 2*AbeforeQ_rtl(1,2,2,1)*AbeforeQ_rtl(2,2,2,2)*n(1)^2*n(2)^2 + 2*AbeforeQ_rtl(1,2,2,2)*AbeforeQ_rtl(2,2,2,1)*n(1)^2*n(2)^2 - 2*AbeforeQ_rtl(2,1,1,1)*AbeforeQ_rtl(2,2,2,1)*n(1)^2*n(2)^2 + 4*AbeforeQ_rtl(2,1,2,1)*AbeforeQ_rtl(2,2,1,1)*n(1)^2*n(2)^2)^(1/2)/2 + (AbeforeQ_rtl(1,1,1,2)*n(1)*n(2))/2 + (AbeforeQ_rtl(1,2,2,2)*n(1)*n(2))/2 + (AbeforeQ_rtl(2,1,1,1)*n(1)*n(2))/2 + (AbeforeQ_rtl(2,2,2,1)*n(1)*n(2))/2;
			%}
			
			%if min([lambda1 lambda2])<lambdamin
			%	lambdamin=min([lambda1 lambda2]);
			%	thetamin=theta;
			%end
		end
		lambdamin=min([lambda1;lambda2]);
		if length(lambdamin)>1
			fprintf('%s',['length(lamdabmin)>1!' char(10)]);
			pause;
			1;
		end
		if lambdamin>0
			thetacrackrtl=NaN;
		else
			localminima1index=zeros(1,0);
			localminima2index=zeros(1,0);
			for i=1:ntestedangle
				if lambda1(i)<0 && lambda1(i)<=lambda1(mod((i-1)-1,ntestedangle)+1) && lambda1(i)<=lambda1(mod((i+1)-1,ntestedangle)+1)
					localminima1index=[localminima1index i];
				end
				if lambda2(i)<0 && lambda2(i)<=lambda2(mod((i-1)-1,ntestedangle)+1) && lambda2(i)<=lambda2(mod((i+1)-1,ntestedangle)+1)
					localminima2index=[localminima2index i];
				end
			end
			nldudxhl=zeros(length(localminima1index)+length(localminima2index),1);
			h_localminima=zeros(2,length(localminima1index)+length(localminima2index));
			for i=1:length(localminima1index)
				n(1)=cos(theta(localminima1index(i)));
				n(2)=sin(theta(localminima1index(i)));
				nldudxhl(i)=real(transpose(n)*dudx_rtl*h(:,1,localminima1index(i)));
				h_localminima(:,i)=h(:,1,localminima1index(i));
			end
			for i=1:length(localminima2index)
				n(1)=cos(theta(localminima2index(i)));
				n(2)=sin(theta(localminima2index(i)));
				nldudxhl(i+length(localminima1index))=real(transpose(n)*dudx_rtl*h(:,2,localminima2index(i)));
				h_localminima(:,i+length(localminima1index))=h(:,2,localminima2index(i));
            end
            localminimaindex=[localminima1index localminima2index];
			FindMaxnldudxhl=FindMax(nldudxhl); %I put FindMax(nldudxhl) to a variable FindMaxnldudxhl as I need to call it twice. Better to save the result rather than calling the function twice.
			crackindex=localminimaindex(FindMaxnldudxhl);
			thetamin=theta(crackindex);
			h_crackdecision=zeros(size(h_localminima,1),1);
			h_crackdecision(:,1)=h_localminima(:,FindMaxnldudxhl);
			thetacrackrtl=mod(thetamin+pi/2+pi/2,pi)-pi/2;
			justcracked=1;
            1;
		end
	else
		Ktangent_global=zeros(6,6);
		Ktangent_global_2D=[];
		Ktangent_global_tens=[];
		Ktangent_global_tens_2D=[];
		activesurfacelist=[];
		AbeforeQ_rtl=zeros(2,2,2,2);
		lambdamin=[];
		thetamin=[];
		Qacoustic=zeros(2,2,36*1*1*1);
		h=zeros(2,2,36*1*1*1);
	end
	
	
	%end Calculating tangent stiffness matrix
	
	%{
	disp(' ')
		texttodisplay=['step=' num2str(step+1) '; '];
		texttodisplay=[texttodisplay 'iteration=' num2str(iteration) '; '];
		texttodisplay=[texttodisplay 'deltaepsilonmag=' num2str(sqrt(dot(deltaepsilon,deltaepsilon))*100) '%; '];
			disp(texttodisplay)
		
		printvector(sigma,'sigma')
		if elastic==0
			printvector(activesurface,'activesurface')
			print11cell(f,'f',activesurface)
		end
		printvector(deltagamma,'deltagamma')
		printvector(epsilonp{step+1},'epsilonp')
		printvector(epsilont{step+1}-epsilonp{step+1},'epsilone')
		printvector(epsilont{step+1},'epsilont')
		if elastic
			printvector(alphahp{step+1},'alphahp')
		else
			printvector(alphahp{step+1},'alphahp',activesurface)
		end
			
	%}
	%end function of Wood_Schmidt17
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function MatOut=MatCondensor(MatIn,CondensedIndex)
    ThrowSwitch=zeros(1,size(MatIn,1));
    for i=1:length(CondensedIndex);
        ThrowSwitch(CondensedIndex(i))=1;
    end
    UncondensedIndex=zeros(1,size(MatIn,1)-length(CondensedIndex));
    icount=1;
    for i=1:length(ThrowSwitch);
        if ThrowSwitch
            continue;
        end
        UncondensedIndex(icount)=i;
        icount=icount+1;
    end
    TopLeft=zeros(size(MatIn,1)-length(CondensedIndex));
    TopRight=zeros(size(MatIn,1)-length(CondensedIndex),length(CondensedIndex));
    BottomLeft=zeros(length(CondensedIndex),size(MatIn,2)-length(CondensedIndex));
    BottomRight=zeros(length(CondensedIndex),length(CondensedIndex));
    for i=1:length(UncondensedIndex)
        for j=1:length(UncondensedIndex)
            TopLeft(i,j)=MatIn(UncondensedIndex(i),UncondensedIndex(j));
        end
        for j=1:length(CondensedIndex)
            TopRight(i,j)=MatIn(UncondensedIndex(i),CondensedIndex(j));
        end
    end
    for i=1:length(CondensedIndex)
        for j=1:length(UncondensedIndex)
            BottomLeft(i,j)=MatIn(CondensedIndex(i),UncondensedIndex(j));
        end
        for j=1:length(CondensedIndex)
            BottomRight(i,j)=MatIn(CondensedIndex(i),CondensedIndex(j));
        end
    end
    MatNew=TopLeft-TopRight*(BottomRight^-1)*BottomLeft;
    MatOut=zeros(size(MatIn,1));
    for i=1:length(UncondensedIndex)
        for j=1:length(UncondensedIndex)
            MatOut(UncondensedIndex(i),UncondensedIndex(j))=MatNew(i,j);
        end
    end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function MatOut=MatCondensor_old201807031046(MatIn,CondensedIndex)
    MatCurrent=MatIn;
    for IndexIter=1:length(CondensedIndex)
        MatCut=zeros(size(MatCurrent,1));
        ReductorComponentA=zeros(size(MatCut,1),1);
        ReductorComponentB=zeros(1,size(MatCut,1));
        for i=1:size(MatCurrent,1)
            if i==CondensedIndex(IndexIter)
                continue;
            end
            ReductorComponentA(i,1)=MatCurrent(i,CondensedIndex(IndexIter));
            ReductorComponentB(i)=MatCurrent(CondensedIndex(IndexIter),i);
            for j=1:size(MatCurrent,2)
                if j==CondensedIndex(IndexIter)
                    continue;
                end
                MatCut(i,j)=MatCurrent(i,j);
            end
        end
        MatCurrent=MatCut-1/MatCurrent(CondensedIndex(IndexIter),CondensedIndex(IndexIter))*ReductorComponentA*ReductorComponentB;
    end
    MatOut=MatCurrent;
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [LOC,LOCC,cellCount,nodeCount]=Grid_Generation(NN,le)
	%% Generate the structured grid

	% Input
	% NN(1): number of nodes in X direction
	% NN(2): number of nodes in Y direction
	% le(1): element size in X direction
	% le(2): element size in X direction

	% Output
	% nodeCount: total number of nodes
	% cellCount: total number of elements
	% LOC(n,1:2): localtion coordinate of node "n" in x(1) and y(2) direction
	% LOCC(e,1:2): localtion coordinate of element centroid "e" in x(1) and y(2) direction

	%% Grid generation
	cellCount               = (NN(1)-1)*(NN(2)-1);              % number of elements
	nodeCount               = NN(1)*NN(2);                      % number of nodes
	LOC                     = zeros(NN(1)*NN(2),2);             % zero matrix of all nodal coordinate

	LOCX                    = [0:NN(1)-1]'*le(1);               % Location of all nodes in X direction
	LOCY                    = [0:NN(2)-1]'*le(2);               % Location of all nodes in Y direction
	
	LOCC                    = zeros(cellCount,2);
	LOCCX                   = [0:(NN(1)-1)-1]'*le(1)+le(1)/2;   % Location of cells in X direction
	LOCCY                   = [0:(NN(2)-1)-1]'*le(2)+le(2)/2;   % Location of cells in X direction

	for i=1:NN(2)
		LOC((1+NN(1)*(i-1)):(NN(1)*(i-1)+NN(1)),1) = LOCX;      % generate the X node position in LOC
	end

	for i=1:NN(2)
		LOC((NN(1)*(i-1))+1:NN(1)*i,2) = LOCY(i);               % generate the Y node position in LOC
	end

	for i=1:NN(2)-1
		LOCC((1+(NN(1)-1)*(i-1)):((NN(1)-1)*(i-1)+(NN(1)-1)),1) = LOCCX;        % generate the X element position in LOCC
	end

	for i=1:NN(2)-1
		LOCC(((NN(1)-1)*(i-1))+1:(NN(1)-1)*i,2) = LOCCY(i);                     % generate the Y element position in LOCC
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [LOC,LOCC,cellCount,nodeCount,LOCX,LOCY,le_c]=Grid_Generation_var(NN,le_x,le_y)
	%% Generate the structured grid
	
	% Input
	% NN(1): number of nodes in X direction
	% NN(2): number of nodes in Y direction
	% le(1): element size in X direction
	% le(2): element size in X direction
	
	% Output
	% nodeCount: total number of nodes
	% cellCount: total number of elements
	% LOC(n,1:2): localtion coordinate of node "n" in x(1) and y(2) direction
	% LOCC(e,1:2): localtion coordinate of element centroid "e" in x(1) and y(2) direction
	
	%% Grid generation
	cellCount               = (NN(1)-1)*(NN(2)-1);              % number of elements
	nodeCount               = NN(1)*NN(2);                      % number of nodes
	LOC                     = zeros(NN(1)*NN(2),2);             % zero matrix of all nodal coordinate
	LOCC                    = zeros(cellCount,2);
	le_c                    = zeros(cellCount,2);
	LOCX                    = zeros(NN(1),1);
	LOCY                    = zeros(NN(2),1);
	LOCCX                   = zeros(NN(1)-1,1);
	LOCCY                   = zeros(NN(2)-1,1);
	
	LOCX(1)=0;
	LOCY(1)=0;
	
	for i=1:NN(1)-1
		LOCX(i+1)=LOCX(i)+le_x(i);          % Location of all nodes in X direction
		LOCCX(i)=LOCX(i)+le_x(i)/2;         % Location of cells in X direction
	end
	
	for i=1:NN(2)-1
		LOCY(i+1)=LOCY(i)+le_y(i);          % Location of all nodes in Y direction
		LOCCY(i)=LOCY(i)+le_y(i)/2;         % Location of cells in Y direction
	end
	
	for i=1:NN(2)
		LOC((1+NN(1)*(i-1)):(NN(1)*(i-1)+NN(1)),1) = LOCX;      % generate the X node position in LOC
	end
	
	for i=1:NN(2)
		LOC((NN(1)*(i-1))+1:NN(1)*i,2) = LOCY(i);               % generate the Y node position in LOC
	end
	
	for i=1:NN(2)-1
		LOCC((1+(NN(1)-1)*(i-1)):((NN(1)-1)*(i-1)+(NN(1)-1)),1) = LOCCX;        % generate the X element position in LOCC
	end
	
	for i=1:NN(2)-1
		LOCC(((NN(1)-1)*(i-1))+1:(NN(1)-1)*i,2) = LOCCY(i);                     % generate the Y element position in LOCC
	end
	
	
	for i=1:length(le_y)
		for j=1:length(le_x)
			le_c((i-1)*length(le_x)+j,1)=le_x(j);
			le_c((i-1)*length(le_x)+j,2)=le_y(i);
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [nfbcx,nfbcy,fbcx,fbcy]=Compute_Boundary_Nodes(nodeCount,LOC,x_max,x_min,y_max,y_min)
	% Input
	% nodeCount: total number of nodes
	% LOC(n,1:2): localtion coordinate of node "n" in x(1) and y(2) direction

	% Output
	% nfbcx: number of boundary nodes in X direction
	% nfbcy: number of boundary nodes in Y direction
	% fbcx: index of all boundary nodes in X direction
	% fbcy: index of all boundary nodes in Y direction


	nfbcx                   = 0              ;  % initial number of fixed nodes in x direction
	nfbcy                   = 0              ;  % initial number of fixed nodes in y direction
	fbcx = zeros(1,0); fbcy = zeros(1,0);       % vector store the index of boundary nodes

	for n=1:nodeCount
		if LOC(n,1)<=x_min || LOC(n,1)>=x_max
			nfbcx = nfbcx+1;
			fbcx = [fbcx n];
		end
	end

	for n=1:nodeCount
		if LOC(n,2)<=y_min || LOC(n,2)>=y_max
			nfbcy = nfbcy+1;
			fbcy = [fbcy n];
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%{
%switchable1
function initial_figure = Plot_Initial_var(x_sp,LOC,LOCX,LOCY,orientationoffset,xdirletter,ydirletter,lp)
    initial_figure=figure;
    plot(x_sp(:,1),x_sp(:,2),'o');
    hold on
    daspect([1 1 1]);
    lp_take=sum(sum(lp))/(size(lp,1)*size(lp,2));
    for i=1:length(orientationoffset)
        if length(xdirletter{i})==1 && xdirletter{i}=='t'
        elseif length(ydirletter{i})==1 && ydirletter{i}=='t'
            orientationoffset(i)=orientationoffset(i)+pi/2;
        else
            continue
        end
        xstart=x_sp(i,1)-lp_take*sqrt(2)/2*cos(orientationoffset(i));
        xend=x_sp(i,1)+lp_take*sqrt(2)/2*cos(orientationoffset(i));
        ystart=x_sp(i,2)-lp_take*sqrt(2)/2*sin(orientationoffset(i));
        yend=x_sp(i,2)+lp_take*sqrt(2)/2*sin(orientationoffset(i));
        plot([xstart xend],[ystart yend],'color','red');
    end
    title('initial condition');
    grid on
    axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
    set(gca,'xtick',LOCX);
    set(gca,'ytick',LOCY);
    % set(gca,'XTickLabel',[]);
    % set(gca,'YTickLabel',[]);
    hold off
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function initial_figure = Plot_Initial_linehighlighted2(x_sp,LOC,le,orientationoffset,xdirletter,ydirletter,lp)
	initial_figure=figure;
	hold on
	daspect([1 1 1]);
	lp_take=max(lp);
	for i=1:length(orientationoffset)
		if length(xdirletter{i})==1 && xdirletter{i}=='l'
			LineColor='red';
			CircColor='green';
		elseif length(ydirletter{i})==1 && ydirletter{i}=='l'
			LineColor='red';
			CircColor='green';
			orientationoffset(i)=orientationoffset(i)+pi/2;
		elseif length(xdirletter{i})==1 && xdirletter{i}=='t'
			LineColor='black';
			CircColor='black';
		elseif length(ydirletter{i})==1 && ydirletter{i}=='t'
			LineColor='black';
			CircColor='black';
			orientationoffset(i)=orientationoffset(i)+pi/2;
		else
			plot(x_sp(i,1),x_sp(i,2),'o','Color','Blue');
			continue;
		end
		plot(x_sp(i,1),x_sp(i,2),'o','Color',CircColor);
		xstart=x_sp(i,1)-lp_take*sqrt(2)/2*cos(orientationoffset(i));
		xend=x_sp(i,1)+lp_take*sqrt(2)/2*cos(orientationoffset(i));
		ystart=x_sp(i,2)-lp_take*sqrt(2)/2*sin(orientationoffset(i));
		yend=x_sp(i,2)+lp_take*sqrt(2)/2*sin(orientationoffset(i));
		plot([xstart xend],[ystart yend],'color',LineColor);
	end
	title('initial condition');
	grid on
	axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
	set(gca,'xtick',[0:le(1):max(LOC(:,1))]);
	set(gca,'ytick',[0:le(2):max(LOC(:,2))]);
	% set(gca,'XTickLabel',[]);
	% set(gca,'YTickLabel',[]);
	hold off
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function initial_figure = Plot_Initial_squishy2(x_sp,LOC,le,orientationoffset,xdirletter,ydirletter,lp,matmodel)
	initial_figure=figure;
	hold on
	daspect([1 1 1]);
	lp_take=max(lp);
	for i=1:length(orientationoffset)
		if length(xdirletter{i})==1 && xdirletter{i}=='l'
		elseif length(ydirletter{i})==1 && ydirletter{i}=='l'
			orientationoffset(i)=orientationoffset(i)+pi/2;
		elseif length(xdirletter{i})==1 && xdirletter{i}=='t'
		elseif length(ydirletter{i})==1 && ydirletter{i}=='t'
			orientationoffset(i)=orientationoffset(i)+pi/2;
		else
			if matmodel(i)==2
				plot(x_sp(i,1),x_sp(i,2),'o','Color','Blue');
			elseif matmodel(i)==3
				plot(x_sp(i,1),x_sp(i,2),'o','Color','Cyan');
			end
			continue;
		end
		plot(x_sp(i,1),x_sp(i,2),'o','Color','Green');
		xstart=x_sp(i,1)-lp_take*sqrt(2)/2*cos(orientationoffset(i));
		xend=x_sp(i,1)+lp_take*sqrt(2)/2*cos(orientationoffset(i));
		ystart=x_sp(i,2)-lp_take*sqrt(2)/2*sin(orientationoffset(i));
		yend=x_sp(i,2)+lp_take*sqrt(2)/2*sin(orientationoffset(i));
		plot([xstart xend],[ystart yend],'color','red');
	end
	grid on
	axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
	set(gca,'xtick',[0:inf:max(LOC(:,1))])
	set(gca,'ytick',[0:inf:max(LOC(:,2))])
	set(initial_figure,'Position',[2560 0 1000 1600]);
	set(gca,'color','none')
	% set(gca,'XTickLabel',[]);
	% set(gca,'YTickLabel',[]);
	hold off
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function initial_figure = Plot_Initial_squishy(x_sp,LOC,le,orientationoffset,xdirletter,ydirletter,lp,matmodel)
	initial_figure=figure;
	hold on
	daspect([1 1 1]);
	lp_take=max(lp);
	for i=1:length(orientationoffset)
		if length(xdirletter{i})==1 && xdirletter{i}=='l'
		elseif length(ydirletter{i})==1 && ydirletter{i}=='l'
			orientationoffset(i)=orientationoffset(i)+pi/2;
		elseif length(xdirletter{i})==1 && xdirletter{i}=='t'
		elseif length(ydirletter{i})==1 && ydirletter{i}=='t'
			orientationoffset(i)=orientationoffset(i)+pi/2;
		else
			if matmodel(i)==2
				plot(x_sp(i,1),x_sp(i,2),'o','Color','Blue');
			elseif matmodel(i)==3
				plot(x_sp(i,1),x_sp(i,2),'o','Color','Cyan');
			end
			continue;
		end
		plot(x_sp(i,1),x_sp(i,2),'o','Color','Green');
		xstart=x_sp(i,1)-lp_take*sqrt(2)/2*cos(orientationoffset(i));
		xend=x_sp(i,1)+lp_take*sqrt(2)/2*cos(orientationoffset(i));
		ystart=x_sp(i,2)-lp_take*sqrt(2)/2*sin(orientationoffset(i));
		yend=x_sp(i,2)+lp_take*sqrt(2)/2*sin(orientationoffset(i));
		plot([xstart xend],[ystart yend],'color','red');
	end
	title('initial condition');
	grid on
	axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
	set(gca,'xtick',[0:le(1):max(LOC(:,1))]);
	set(gca,'ytick',[0:le(2):max(LOC(:,2))]);
	% set(gca,'XTickLabel',[]);
	% set(gca,'YTickLabel',[]);
	hold off
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function initial_figure = Plot_Initial_linehighlighted(x_sp,LOC,le,orientationoffset,xdirletter,ydirletter,lp)
	initial_figure=figure;
	hold on
	daspect([1 1 1]);
	lp_take=max(lp);
	for i=1:length(orientationoffset)
		if length(xdirletter{i})==1 && xdirletter{i}=='l'
		elseif length(ydirletter{i})==1 && ydirletter{i}=='l'
			orientationoffset(i)=orientationoffset(i)+pi/2;
		elseif length(xdirletter{i})==1 && xdirletter{i}=='t'
		elseif length(ydirletter{i})==1 && ydirletter{i}=='t'
			orientationoffset(i)=orientationoffset(i)+pi/2;
		else
			plot(x_sp(i,1),x_sp(i,2),'o','Color','Blue');
			continue;
		end
		plot(x_sp(i,1),x_sp(i,2),'o','Color','Green');
		xstart=x_sp(i,1)-lp_take*sqrt(2)/2*cos(orientationoffset(i));
		xend=x_sp(i,1)+lp_take*sqrt(2)/2*cos(orientationoffset(i));
		ystart=x_sp(i,2)-lp_take*sqrt(2)/2*sin(orientationoffset(i));
		yend=x_sp(i,2)+lp_take*sqrt(2)/2*sin(orientationoffset(i));
		plot([xstart xend],[ystart yend],'color','red');
	end
	title('initial condition');
	grid on
	axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
	set(gca,'xtick',[0:le(1):max(LOC(:,1))]);
	set(gca,'ytick',[0:le(2):max(LOC(:,2))]);
	% set(gca,'XTickLabel',[]);
	% set(gca,'YTickLabel',[]);
	hold off
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function initial_figure = Plot_Initial(x_sp,LOC,le,orientationoffset,xdirletter,ydirletter,lp)
	initial_figure=figure;
	plot(x_sp(:,1),x_sp(:,2),'o');
	hold on
	daspect([1 1 1]);
	lp_take=max(lp);
	for i=1:length(orientationoffset)
		if length(xdirletter{i})==1 && xdirletter{i}=='l'
		elseif length(ydirletter{i})==1 && ydirletter{i}=='l'
			orientationoffset(i)=orientationoffset(i)+pi/2;
		elseif length(xdirletter{i})==1 && xdirletter{i}=='t'
		elseif length(ydirletter{i})==1 && ydirletter{i}=='t'
			orientationoffset(i)=orientationoffset(i)+pi/2;
		else
			continue;
		end
		xstart=x_sp(i,1)-lp_take*sqrt(2)/2*cos(orientationoffset(i));
		xend=x_sp(i,1)+lp_take*sqrt(2)/2*cos(orientationoffset(i));
		ystart=x_sp(i,2)-lp_take*sqrt(2)/2*sin(orientationoffset(i));
		yend=x_sp(i,2)+lp_take*sqrt(2)/2*sin(orientationoffset(i));
		plot([xstart xend],[ystart yend],'color','red');
	end
	title('initial condition');
	grid on
	axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
	set(gca,'xtick',[0:le(1):max(LOC(:,1))]);
	set(gca,'ytick',[0:le(2):max(LOC(:,2))]);
	% set(gca,'XTickLabel',[]);
	% set(gca,'YTickLabel',[]);
	hold off
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function initial_figure = Plot_Initial_crackmulti(x_sp,LOC,le,orientationoffset,xdirletter,ydirletter,lp,x_crack,CasetoRun)
	initial_figure=figure;
	plot(x_sp(:,1),x_sp(:,2),'o');
	hold on
	daspect([1 1 1]);
	lp_take=max(lp);
	for i=1:length(orientationoffset)
		if length(xdirletter{i})==1 && xdirletter{i}=='l'
		elseif length(ydirletter{i})==1 && ydirletter{i}=='l'
			orientationoffset(i)=orientationoffset(i)+pi/2;
		elseif length(xdirletter{i})==1 && xdirletter{i}=='t'
		elseif length(ydirletter{i})==1 && ydirletter{i}=='t'
			orientationoffset(i)=orientationoffset(i)+pi/2;
		else
			continue;
		end
		xstart=x_sp(i,1)-lp_take*sqrt(2)/2*cos(orientationoffset(i));
		xend=x_sp(i,1)+lp_take*sqrt(2)/2*cos(orientationoffset(i));
		ystart=x_sp(i,2)-lp_take*sqrt(2)/2*sin(orientationoffset(i));
		yend=x_sp(i,2)+lp_take*sqrt(2)/2*sin(orientationoffset(i));
		plot([xstart xend],[ystart yend],'color','red');
	end
	%{
	for i=1:length(x_crack)
		if CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124
			plot(x_crack{i}(:,1),x_crack{i}(:,2),'-','Color','Black','LineWidth',2);
		else
			plot(x_crack{i}(:,1),x_crack{i}(:,2),'-o','Color','Green');
		end
	end
	%}
	for ipath=1:x_crack.npaths
        if ipath==1
    		plot(x_crack.center(1:x_crack.nparticles(ipath),1,ipath),x_crack.center(1:x_crack.nparticles(ipath),2,ipath),'displayname','Initial Crack','color','black','LineWidth',2)
        else
            plot(x_crack.center(1:x_crack.nparticles(ipath),1,ipath),x_crack.center(1:x_crack.nparticles(ipath),2,ipath),'HandleVisibility','off','color','black','LineWidth',2)
        end
	end
	title('initial condition');
	grid on
	axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
	set(gca,'xtick',[0:le(1):max(LOC(:,1))]);
	set(gca,'ytick',[0:le(2):max(LOC(:,2))]);
	% set(gca,'XTickLabel',[]);
	% set(gca,'YTickLabel',[]);
	hold off
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function initial_figure = Plot_Initial_crackmulti_r_sp(r1_sp,r2_sp,x_sp,LOC,le,orientationoffset,xdirletter,ydirletter,lp,x_crack,CasetoRun)
	initial_figure=figure;
	plot(x_sp(:,1),x_sp(:,2),'o');
	hold on
	daspect([1 1 1]);
	lp_take=max(lp);
	for i=1:length(orientationoffset)
		if length(xdirletter{i})==1 && xdirletter{i}=='l'
		elseif length(ydirletter{i})==1 && ydirletter{i}=='l'
			orientationoffset(i)=orientationoffset(i)+pi/2;
		elseif length(xdirletter{i})==1 && xdirletter{i}=='t'
		elseif length(ydirletter{i})==1 && ydirletter{i}=='t'
			orientationoffset(i)=orientationoffset(i)+pi/2;
		else
			continue;
		end
		xstart=x_sp(i,1)-lp_take*sqrt(2)/2*cos(orientationoffset(i));
		xend=x_sp(i,1)+lp_take*sqrt(2)/2*cos(orientationoffset(i));
		ystart=x_sp(i,2)-lp_take*sqrt(2)/2*sin(orientationoffset(i));
		yend=x_sp(i,2)+lp_take*sqrt(2)/2*sin(orientationoffset(i));
		plot([xstart xend],[ystart yend],'color','red');
	end
	spCount=length(orientationoffset);
	%{
	for i=1:length(x_crack)
		if CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124
			plot(x_crack{i}(:,1),x_crack{i}(:,2),'-','Color','Black','LineWidth',2);
		else
			plot(x_crack{i}(:,1),x_crack{i}(:,2),'-o','Color','Green');
		end
	end
	%}
	for ipath=1:x_crack.npaths
        if ipath==1
    		plot(x_crack.center(1:x_crack.nparticles(ipath),1,ipath),x_crack.center(1:x_crack.nparticles(ipath),2,ipath),'displayname','Initial Crack','color','black','LineWidth',2)
        else
            plot(x_crack.center(1:x_crack.nparticles(ipath),1,ipath),x_crack.center(1:x_crack.nparticles(ipath),2,ipath),'HandleVisibility','off','color','black','LineWidth',2)
        end
	end
	x_corner1              = zeros(spCount,2);
	x_corner2              = zeros(spCount,2);
	x_corner3              = zeros(spCount,2);
	x_corner4              = zeros(spCount,2);
	
	for sp=1:spCount
		x_corner1(sp,:) = x_sp(sp,:) - r1_sp(sp,:) - r2_sp(sp,:);      % Position of corner 1
		x_corner2(sp,:) = x_sp(sp,:) + r1_sp(sp,:) - r2_sp(sp,:);
		x_corner3(sp,:) = x_sp(sp,:) + r1_sp(sp,:) + r2_sp(sp,:);
		x_corner4(sp,:) = x_sp(sp,:) - r1_sp(sp,:) + r2_sp(sp,:);
	end
	for sp=1:spCount
		x_cor = [x_corner1(sp,1) x_corner2(sp,1) x_corner3(sp,1) x_corner4(sp,1) x_corner1(sp,1)];
		y_cor = [x_corner1(sp,2) x_corner2(sp,2) x_corner3(sp,2) x_corner4(sp,2) x_corner1(sp,2)];
		plot(x_cor,y_cor,'r')
	end



	title('initial condition');
	grid on
	axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
	set(gca,'xtick',[0:le(1):max(LOC(:,1))]);
	set(gca,'ytick',[0:le(2):max(LOC(:,2))]);
	% set(gca,'XTickLabel',[]);
	% set(gca,'YTickLabel',[]);
	hold off
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function initial_figure = Plot_Initial_sp(x_sp,LOC,le,orientationoffset,xdirletter,ydirletter,lp)
	initial_figure=figure;
	plot(x_sp(:,1),x_sp(:,2),'o');
	hold on
	daspect([1 1 1]);
	lp_take=max(lp);
	for i=1:length(orientationoffset)
		if length(xdirletter{i})==1 && xdirletter{i}=='l'
		elseif length(ydirletter{i})==1 && ydirletter{i}=='l'
			orientationoffset(i)=orientationoffset(i)+pi/2;
		elseif length(xdirletter{i})==1 && xdirletter{i}=='t'
		elseif length(ydirletter{i})==1 && ydirletter{i}=='t'
			orientationoffset(i)=orientationoffset(i)+pi/2;
		else
			continue;
		end
		xstart=x_sp(i,1)-lp_take*sqrt(2)/2*cos(orientationoffset(i));
		xend=x_sp(i,1)+lp_take*sqrt(2)/2*cos(orientationoffset(i));
		ystart=x_sp(i,2)-lp_take*sqrt(2)/2*sin(orientationoffset(i));
		yend=x_sp(i,2)+lp_take*sqrt(2)/2*sin(orientationoffset(i));
		plot([xstart xend],[ystart yend],'color','red');
	end
	title('initial condition');
	grid on
	axis([0,max(LOC(:,1)),0,156]);
	set(gca,'xtick',[0:le(1):max(LOC(:,1))]);
	set(gca,'ytick',[0:le(2):156]);
	% set(gca,'XTickLabel',[]);
	% set(gca,'YTickLabel',[]);
	hold off
end
%}
%switchable1
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [N,dN1,dN2]=linearshape(xp,xn,Lx,Ly)


if abs(xp(1)-xn(1))<Lx 
    
    Nx = 1-abs(xp(1)-xn(1))/Lx;    
    dNx = -sign(xp(1)-xn(1))/Lx;
else
    Nx = 0;
    dNx = 0;
end

if abs(xp(2)-xn(2))<Ly 
    Ny = 1-abs(xp(2)-xn(2))/Ly;     
    dNy = -sign(xp(2)-xn(2))/Ly;
else
    Ny = 0;
    dNy = 0;
end


    N = Nx*Ny;
    dN1 = dNx*Ny;
    dN2 = Nx*dNy;
   
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [x_crack,x_cracktop,x_crackbot] = UpdateCrackPosition2(x_crack,x_cracktop,x_crackbot,nmass_si,nmomentum_si,Nmatrix_crack,Nmatrix_cracktop,Nmatrix_crackbot,dt,Nmatrix,v_ssp_out,m_sp,nfbcx,nfbcy,fbcx,fbcy)
	
	Nmatrixtop=Nmatrix(:,:,1)+Nmatrix(:,:,2);
	Nmatrixbot=Nmatrix(:,:,1)+Nmatrix(:,:,3);
	%nmatrixtop/nmatrixbot: for mapping variables from real particles to background grid appropriate for calculating velocity for updating top/bottom crack particle positions
	
	nmass_si_comb=zeros(size(nmass_si,1));
	nmass_si_top=zeros(size(nmass_si,1));
	nmass_si_bot=zeros(size(nmass_si,1));
	
	v_si_comb=zeros(size(nmass_si,1),2);
	v_si_top=zeros(size(nmass_si,1),2);
	v_si_bot=zeros(size(nmass_si,1),2);
	
	nmomentum_si_top=zeros(size(Nmatrixtop,1),2);
	nmomentum_si_bot=zeros(size(Nmatrixbot,1),2);
	nmomentum_si_top(:,1)=Nmatrixtop*(v_ssp_out(:,1).*m_sp(:,1));
	nmomentum_si_top(:,2)=Nmatrixtop*(v_ssp_out(:,2).*m_sp(:,1));
	nmomentum_si_bot(:,1)=Nmatrixbot*(v_ssp_out(:,1).*m_sp(:,1));
	nmomentum_si_bot(:,2)=Nmatrixbot*(v_ssp_out(:,2).*m_sp(:,1));
	
	[nmomentum_si]  = Boundary_Dirichlet(nfbcx,nfbcy,fbcx,fbcy,nmomentum_si); % Boundary condition for nodal force
	[nmomentum_si_top]  = Boundary_Dirichlet(nfbcx,nfbcy,fbcx,fbcy,nmomentum_si_top); % Boundary condition for nodal force
	[nmomentum_si_bot]  = Boundary_Dirichlet(nfbcx,nfbcy,fbcx,fbcy,nmomentum_si_bot); % Boundary condition for nodal force
	
	nmass_si_top=Nmatrixtop*m_sp;
	nmass_si_bot=Nmatrixbot*m_sp;
	
	
	for i=1:size(nmass_si,1);
		nmass_si_comb(i)=sum(nmass_si(i,:));
		%nmass_si_top(i)=nmass_si(i,2);
		%nmass_si_bot(i)=nmass_si(i,3);
		
		if nmass_si_comb(i)>0
			v_si_comb(i,1)=sum(nmomentum_si(i,1,:))/nmass_si_comb(i);
			v_si_comb(i,2)=sum(nmomentum_si(i,2,:))/nmass_si_comb(i);
		end
		
		if nmass_si_top(i)>0
			v_si_top(i,1)=nmomentum_si_top(i,1)/nmass_si_top(i);
			v_si_top(i,2)=nmomentum_si_top(i,2)/nmass_si_top(i);
		end
		
		if nmass_si_bot(i)>0
			v_si_bot(i,1)=nmomentum_si_bot(i,1)/nmass_si_bot(i);
			v_si_bot(i,2)=nmomentum_si_bot(i,2)/nmass_si_bot(i);
		end
	end
	
	v_crack=transpose(Nmatrix_crack)*v_si_comb;
	v_cracktop=transpose(Nmatrix_cracktop)*v_si_top;
	v_crackbot=transpose(Nmatrix_crackbot)*v_si_bot;
	
	x_crack=x_crack+dt*v_crack;
	x_cracktop=x_cracktop+dt*v_cracktop;
	x_crackbot=x_crackbot+dt*v_crackbot;
	
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [x_sp] = UpdateCrackPosition_multi(Nmatrix,NmatrixAll,dt,nmass_si,nmomentum_si,x_sp)
	%Nmatrix,NmatrixAll,CONNECTpn,NODES,dt,CONNECT,N,spCount,nmass_si,nforce_si,nmomentum_si,x_spo,v_ssp,x_sp,NodeswithPredXVel,NodeswithPredXVel2,NodeswithPredYVel,NodeswithPredYVel2,PredXVel,PredXVel2,PredYVel,PredYVel2
	fieldnumber=size(Nmatrix,3);

	a_si=zeros(size(nmass_si,1),2,fieldnumber);
	v_si=zeros(size(nmass_si,1),2,fieldnumber);

	for field=1:fieldnumber
	%	try
	%		parfor i=1:size(nmass_si,1)
	%			if nmass_si(i,field)==0
	%			else
	%				a_si(i,:,field)=nforce_si(i,:,field)/nmass_si(i,field);
	%				v_si(i,:,field)=nmomentum_si(i,:,field)/nmass_si(i,field);
	%			end
	%		end
	%	catch
	%		disp('Update_Particle_Position_WithPredVel2 a_si v_si parfor failed!');
	%		disp('Rolling back to regular for');
			for i=1:size(nmass_si,1)
				if nmass_si(i,field)==0
				else
%					a_si(i,:,field)=nforce_si(i,:,field)/nmass_si(i,field);
					v_si(i,:,field)=nmomentum_si(i,:,field)/nmass_si(i,field);
				end
			end
	%	end
	end

	for field=1:fieldnumber
		for direction=1:2
			if field==1
				x_sp(:,direction)=x_sp(:,direction)+dt*transpose(NmatrixAll(:,:))*(v_si(:,direction,field));
			else
				x_sp(:,direction)=x_sp(:,direction)+dt*transpose(Nmatrix(:,:,field))*(v_si(:,direction,field));
			end
		end
	end

	%{
	v_ssp_free=v_ssp;

	for ni=1:length(NodeswithPredXVel)
		i=NodeswithPredXVel(ni);
		for nsp=1:length(CONNECTpn{i})
			sp=CONNECTpn{i}(nsp);
			v_ssp(sp,1)=v_ssp(sp,1)+NmatrixAll(i,sp)*(PredXVel - v_ssp_free(sp,1));
		end
	end
	
	for ni=1:length(NodeswithPredXVel2)
		i=NodeswithPredXVel2(ni);
		for nsp=1:length(CONNECTpn{i})
			sp=CONNECTpn{i}(nsp);
			v_ssp(sp,1)=v_ssp(sp,1)+NmatrixAll(i,sp)*(PredXVel2 - v_ssp_free(sp,1));
		end
	end

	for ni=1:length(NodeswithPredYVel)
		i=NodeswithPredYVel(ni);
		for nsp=1:length(CONNECTpn{i})
			sp=CONNECTpn{i}(nsp);
			v_ssp(sp,2)=v_ssp(sp,2)+NmatrixAll(i,sp)*(PredYVel - v_ssp_free(sp,2));
		end
	end

	for ni=1:length(NodeswithPredYVel2)
		i=NodeswithPredYVel2(ni);
		for nsp=1:length(CONNECTpn{i})
			sp=CONNECTpn{i}(nsp);
			v_ssp(sp,2)=v_ssp(sp,2)+NmatrixAll(i,sp)*(PredYVel2 - v_ssp_free(sp,2));
		end
	end
	%}
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [x_sp] = UpdateCrackPosition_multioptimized(N,NODES,CONNECT,dt,nmass_si,nmomentum_si,x_sp,TheFieldSplit)
	spCount=size(x_sp,1);
	x_sp_temp=zeros(1,2);
	
	
	for sp = 1:spCount
		for j = 1:NODES(1,sp)
			
			npid                           = CONNECT{sp}(j);
			if nmass_si(npid,TheFieldSplit(npid,sp))==0
				continue;
			end
			
			
			for i=1:2
				x_sp_temp(1,i)                       = x_sp(sp,i) + nmomentum_si(npid,i,TheFieldSplit(npid,sp))*N{sp}(j)*dt/nmass_si(npid,TheFieldSplit(npid,sp));
			end
			
			for i=1:2
				x_sp(sp,i)=x_sp_temp(1,i);
			end
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [x_crack] = UpdateCrackPosition_multioptimized_topandbot(m_sp,N_crack,NODES_crack,CONNECT_crack,dt,nmass_si,nmomentum_si,x_crack,TheFieldSplit_cracktop,TheFieldSplit_crackbot,CasetoRun)
	dx_sp=zeros(1,2);
	sigmaN=0;
	
	
	follow.list.top=zeros(size(x_crack.center,1),size(x_crack.center,3)); %icrackparticle,icrackpath
	follow.list.bot=zeros(size(x_crack.center,1),size(x_crack.center,3)); %icrackparticle,icrackpath
	follow.distance.top=zeros(size(x_crack.center,1),2,size(x_crack.center,3)); %icrackparticle,dimension,icrackpath
	follow.distance.bot=zeros(size(x_crack.center,1),2,size(x_crack.center,3));%icrackparticle,dimension,icrackpath
	follow.distance.mag=zeros(1,1);
	follow.angle=zeros(1,1);

	
	for icrackpath=1:x_crack.npaths
		for sp = 1:x_crack.nparticles(icrackpath)
			follow.list.top(sp,icrackpath)=1;
			for j = 1:4
				npid                           = CONNECT_crack.top.values(sp,j,icrackpath);
				%low mass filter
				if nmass_si(npid,TheFieldSplit_cracktop{icrackpath}(j,sp))>0.0001*m_sp(1)
					follow.list.top(sp,icrackpath)=0;
					break;
				end
			end
		end
	end
	for icrackpath=1:x_crack.npaths
		for sp = 1:x_crack.nparticles(icrackpath)
			follow.list.bot(sp,icrackpath)=1;
			for j = 1:4
				npid                           = CONNECT_crack.bot.values(sp,j,icrackpath);
				%low mass filter
				if nmass_si(npid,TheFieldSplit_crackbot{icrackpath}(j,sp))>0.0001*m_sp(1)
					follow.list.bot(sp,icrackpath)=0;
					break;
				end
			end
		end
	end
	for icrackpath=1:x_crack.npaths
		for sp = floor(x_crack.nparticles(icrackpath)/2):-1:1
			if follow.list.top(sp,icrackpath)==1
				follow.distance.top(sp,:,icrackpath)=x_crack.top(sp,:,icrackpath)-x_crack.top(sp+1,:,icrackpath);
			end
			if follow.list.bot(sp,icrackpath)==1
				follow.distance.bot(sp,:,icrackpath)=x_crack.bot(sp,:,icrackpath)-x_crack.bot(sp+1,:,icrackpath);
			end
		end
		for sp = floor(x_crack.nparticles(icrackpath)/2)+1:x_crack.nparticles(icrackpath)
			if follow.list.top(sp,icrackpath)==1
				follow.distance.top(sp,:,icrackpath)=x_crack.top(sp,:,icrackpath)-x_crack.top(sp-1,:,icrackpath);
			end
			if follow.list.bot(sp,icrackpath)==1
				follow.distance.bot(sp,:,icrackpath)=x_crack.bot(sp,:,icrackpath)-x_crack.bot(sp-1,:,icrackpath);
			end
		end
	end
	
	for icrackpath=1:x_crack.npaths
		for sp = 1:x_crack.nparticles(icrackpath)
			dx_sp=zeros(1,2);
			sigmaN=0;
			for j = 1:4
				
				npid                           = CONNECT_crack.top.values(sp,j,icrackpath);
				%low mass filter
				if nmass_si(npid,TheFieldSplit_cracktop{icrackpath}(j,sp))<0.0001*m_sp(1)
					continue;
				end
				
				sigmaN=sigmaN+N_crack.top(1,j,sp,icrackpath);
				for i=1:2
					dx_sp(1,i)=dx_sp(1,i)+nmomentum_si(npid,i,TheFieldSplit_cracktop{icrackpath}(j,sp))*N_crack.top(1,j,sp,icrackpath)*dt/nmass_si(npid,TheFieldSplit_cracktop{icrackpath}(j,sp));
				end
			end
			%Nscale crack
			if sigmaN>0
				for i=1:2
					%x_crack.top(sp,i,icrackpath)=x_crack.top(sp,i,icrackpath)+dx_sp(1,i)/sigmaN;
					x_crack.top(sp,i,icrackpath)=x_crack.top(sp,i,icrackpath)+dx_sp(1,i);
				end
			end
			

			dx_sp=zeros(1,2);
			sigmaN=0;
			for j = 1:4
				
				npid                           = CONNECT_crack.bot.values(sp,j,icrackpath);
				if nmass_si(npid,TheFieldSplit_crackbot{icrackpath}(j,sp))<0.0001*m_sp(1)
					continue;
				end
				
				sigmaN=sigmaN+N_crack.bot(1,j,sp,icrackpath);
				for i=1:2
					dx_sp(1,i)=dx_sp(1,i)+nmomentum_si(npid,i,TheFieldSplit_crackbot{icrackpath}(j,sp))*N_crack.bot(1,j,sp,icrackpath)*dt/nmass_si(npid,TheFieldSplit_crackbot{icrackpath}(j,sp));
				end
			end
			if sigmaN>0
				for i=1:2
					%x_crack.bot(sp,i,icrackpath)=x_crack.bot(sp,i,icrackpath)+dx_sp(1,i)/sigmaN;
					x_crack.bot(sp,i,icrackpath)=x_crack.bot(sp,i,icrackpath)+dx_sp(1,i);
				end
			end
		end
	end
	
	for icrackpath=1:x_crack.npaths
        if CasetoRun==172 || CasetoRun==174 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189
			if x_crack.terminatedprop(icrackpath,2)==0 %tip=1: highest particle index, tip=2: lowest particle index
            for sp = floor(x_crack.nparticles(icrackpath)/2):-1:1
                if follow.list.top(sp,icrackpath)==1
                    follow.distance.mag=sqrt(dot(follow.distance.top(sp,:,icrackpath),follow.distance.top(sp,:,icrackpath)));
                    follow.angle=reliableatan(x_crack.top(sp+1,1,icrackpath)-x_crack.top(sp+2,1,icrackpath),x_crack.top(sp+1,2,icrackpath)-x_crack.top(sp+2,2,icrackpath));
                    x_crack.top(sp,1,icrackpath)=x_crack.top(sp+1,1,icrackpath)+follow.distance.mag*cos(follow.angle);
                    x_crack.top(sp,2,icrackpath)=x_crack.top(sp+1,2,icrackpath)+follow.distance.mag*sin(follow.angle);
				end
                if follow.list.bot(sp,icrackpath)==1
                    follow.distance.mag=sqrt(dot(follow.distance.bot(sp,:,icrackpath),follow.distance.bot(sp,:,icrackpath)));
                    follow.angle=reliableatan(x_crack.bot(sp+1,1,icrackpath)-x_crack.bot(sp+2,1,icrackpath),x_crack.bot(sp+1,2,icrackpath)-x_crack.bot(sp+2,2,icrackpath));
                    x_crack.bot(sp,1,icrackpath)=x_crack.bot(sp+1,1,icrackpath)+follow.distance.mag*cos(follow.angle);
                    x_crack.bot(sp,2,icrackpath)=x_crack.bot(sp+1,2,icrackpath)+follow.distance.mag*sin(follow.angle);
                end
            end
			end
			if x_crack.terminatedprop(icrackpath,1)==0
            for sp = floor(x_crack.nparticles(icrackpath)/2)+1:x_crack.nparticles(icrackpath)
                if follow.list.top(sp,icrackpath)==1
                    follow.distance.mag=sqrt(dot(follow.distance.top(sp,:,icrackpath),follow.distance.top(sp,:,icrackpath)));
                    follow.angle=reliableatan(x_crack.top(sp-1,1,icrackpath)-x_crack.top(sp-2,1,icrackpath),x_crack.top(sp-1,2,icrackpath)-x_crack.top(sp-2,2,icrackpath));
                    x_crack.top(sp,1,icrackpath)=x_crack.top(sp-1,1,icrackpath)+follow.distance.mag*cos(follow.angle);
                    x_crack.top(sp,2,icrackpath)=x_crack.top(sp-1,2,icrackpath)+follow.distance.mag*sin(follow.angle);
				end
                if follow.list.bot(sp,icrackpath)==1
                    follow.distance.mag=sqrt(dot(follow.distance.bot(sp,:,icrackpath),follow.distance.bot(sp,:,icrackpath)));
                    follow.angle=reliableatan(x_crack.bot(sp-1,1,icrackpath)-x_crack.bot(sp-2,1,icrackpath),x_crack.bot(sp-1,2,icrackpath)-x_crack.bot(sp-2,2,icrackpath));
                    x_crack.bot(sp,1,icrackpath)=x_crack.bot(sp-1,1,icrackpath)+follow.distance.mag*cos(follow.angle);
                    x_crack.bot(sp,2,icrackpath)=x_crack.bot(sp-1,2,icrackpath)+follow.distance.mag*sin(follow.angle);
                end
            end
			end
        end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [x_sp] = UpdateCrackPosition_multioptimized_fail(Nmatrix,dt,nmass_si,nmomentum_si,x_sp,TheFieldSplit)
	fieldnumber=max(max(TheFieldSplit));
	a_si=zeros(size(nmass_si,1),2,fieldnumber);
	v_si=zeros(size(nmass_si,1),2,fieldnumber);
	for field=1:fieldnumber
		for i=1:size(nmass_si,1)
			if nmass_si(i,field)==0
			else
				v_si(i,:,field)=nmomentum_si(i,:,field)/nmass_si(i,field);
			end
		end
	end
	for field=1:fieldnumber
		if nmass_si(i,field)==0
			for direction=1:2
				x_sp(:,direction)=x_sp(:,direction)+dt*transpose(Nmatrix)*(nmomentum_si(:,direction,field)./nmass_si(:,field));
			end
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [x_crack,x_cracktop,x_crackbot] = UpdateCrackPosition(x_crack,x_cracktop,x_crackbot,nmass_si,nmomentum_si,Nmatrix_crack,Nmatrix_cracktop,Nmatrix_crackbot,dt,Nmatrixtop,Nmatrixbot,v_ssp_out,m_sp)
	
	nmass_si_comb=zeros(size(nmass_si,1));
	nmass_si_top=zeros(size(nmass_si,1));
	nmass_si_bot=zeros(size(nmass_si,1));
	
	v_si_comb=zeros(size(nmass_si,1),2);
	v_si_top=zeros(size(nmass_si,1),2);
	v_si_bot=zeros(size(nmass_si,1),2);
	
	nmomentum_si_top=zeros(size(Nmatrixtop,1),2);
	nmomentum_si_bot=zeros(size(Nmatrixbot,1),2);
	nmomentum_si_top(:,1)=Nmatrixtop*(v_ssp_out(:,1).*m_sp(:,1));
	nmomentum_si_top(:,2)=Nmatrixtop*(v_ssp_out(:,2).*m_sp(:,1));
	nmomentum_si_bot(:,1)=Nmatrixbot*(v_ssp_out(:,1).*m_sp(:,1));
	nmomentum_si_bot(:,2)=Nmatrixbot*(v_ssp_out(:,2).*m_sp(:,1));
	
	
	nmass_si_top=Nmatrixtop*m_sp;
	nmass_si_bot=Nmatrixbot*m_sp;
	
	
	for i=1:size(nmass_si,1);
		nmass_si_comb(i)=sum(nmass_si(i,:));
		%nmass_si_top(i)=nmass_si(i,2);
		%nmass_si_bot(i)=nmass_si(i,3);
		
		if nmass_si_comb(i)>0
			v_si_comb(i,1)=sum(nmomentum_si(i,1,:))/nmass_si_comb(i);
			v_si_comb(i,2)=sum(nmomentum_si(i,2,:))/nmass_si_comb(i);
		end
		
		if nmass_si_top(i)>0
			v_si_top(i,1)=nmomentum_si_top(i,1)/nmass_si_top(i);
			v_si_top(i,2)=nmomentum_si_top(i,2)/nmass_si_top(i);
		end
		
		if nmass_si_bot(i)>0
			v_si_bot(i,1)=nmomentum_si_bot(i,1)/nmass_si_bot(i);
			v_si_bot(i,2)=nmomentum_si_bot(i,2)/nmass_si_bot(i);
		end
	end
	
	v_crack=transpose(Nmatrix_crack)*v_si_comb;
	v_cracktop=transpose(Nmatrix_cracktop)*v_si_top;
	v_crackbot=transpose(Nmatrix_crackbot)*v_si_bot;
	
	x_crack=x_crack+dt*v_crack;
	x_cracktop=x_cracktop+dt*v_cracktop;
	x_crackbot=x_crackbot+dt*v_crackbot;
	
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [v_ssp,x_sp] = Update_Particle_Position_WithPredVel2(Nmatrix,CONNECTpn,NODES,dt,CONNECT,N,spCount,nmass_si,nforce_si,nmomentum_si,x_spo,v_ssp,x_sp,NodeswithPredXVel,NodeswithPredXVel2,NodeswithPredYVel,NodeswithPredYVel2,PredXVel,PredXVel2,PredYVel,PredYVel2,fieldnumber)
	%v_ssp=v_ssp*(0.5^(1/1000)); %damping

	a_si=zeros(length(nmass_si),2,fieldnumber);
	v_si=zeros(length(nmass_si),2,fieldnumber);

	for field=1:fieldnumber
%{
%switchable1
		try
			parfor i=1:size(nmass_si,1)
				if nmass_si(i,field)==0
				else
					a_si(i,:,field)=nforce_si(i,:,field)/nmass_si(i,field);
					v_si(i,:,field)=nmomentum_si(i,:,field)/nmass_si(i,field);
				end
			end
		catch
			fprintf('%s',['Update_Particle_Position_WithPredVel2 a_si v_si parfor failed!' char(10)]);
			fprintf('%s',['Rolling back to regular for' char(10)]);
%}
%switchable1
			for i=1:size(nmass_si,1)
				if nmass_si(i,field)==0
				else
					a_si(i,:,field)=nforce_si(i,:,field)/nmass_si(i,field);
					v_si(i,:,field)=nmomentum_si(i,:,field)/nmass_si(i,field);
				end
			end
%{
%switchable1
		end
%}
%switchable1
	end

	for field=1:fieldnumber
		for direction=1:2
			v_ssp(:,direction)=v_ssp(:,direction)+dt*transpose(Nmatrix(:,:,field))*(a_si(:,direction,field));
			x_sp(:,direction)=x_sp(:,direction)+dt*transpose(Nmatrix(:,:,field))*(v_si(:,direction,field));
		end
	end

	%{
	for sp = 1:spCount
		 for j = 1:NODES(sp)
			 npid                           = CONNECT{sp}(j);
			  if nmass_si(npid)==0
				continue
			  end
			  %{
			  NodeisPredXVel=0;
			  for k=1:length(NodeswithPredXVel)
				 if npid==NodeswithPredXVel(k)
					 NodeisPredXVel=1;
					 break
				 end
			 end
			  NodeisPredXVel2=0;
			  for k=1:length(NodeswithPredXVel2)
				 if npid==NodeswithPredXVel2(k)
					 NodeisPredXVel2=1;
					 break
				 end
			 end
			  NodeisPredYVel=0;          
			  for k=1:length(NodeswithPredYVel)
				 if npid==NodeswithPredYVel(k)
					 NodeisPredYVel=1;
					 break
				 end
			  end
			  NodeisPredYVel2=0;
			  for k=1:length(NodeswithPredYVel2)
				 if npid==NodeswithPredYVel2(k)
					 NodeisPredYVel2=1;
					 break
				 end
			  end
			  %}
			  %if NodeisPredXVel==0
				 v_ssp(sp,1)                  = v_ssp(sp,1) + dt * N{sp}(j) * (nforce_si(npid,1)/nmass_si(npid));%*(0.5^(1/1000)); %damping
			 %else
			 %    v_ssp(sp,1)                  = v_ssp(sp,1) + N{sp}(j)*(PredXVel - v_ssp(sp,1));
			 %end
			 
			  %if NodeisPredXVel2==0
				 v_ssp(sp,1)                  = v_ssp(sp,1) + dt * N{sp}(j) * (nforce_si(npid,1)/nmass_si(npid));%*(0.5^(1/1000)); %damping
			 %else
			 %    v_ssp(sp,1)                  = v_ssp(sp,1) + N{sp}(j)*(PredXVel2 - v_ssp(sp,1));
			 %end
			 
			 %if NodeisPredYVel==0
				 v_ssp(sp,2)                      = v_ssp(sp,2) + dt * N{sp}(j) * (nforce_si(npid,2)/nmass_si(npid));%*(0.5^(1/1000)); %damping
			 %else
			 %    v_ssp(sp,2)                  = v_ssp(sp,2) + N{sp}(j)*(PredYVel - v_ssp(sp,2));
			 %end
			 
			 %if NodeisPredYVel2==0
			 %    v_ssp(sp,2)                      = v_ssp(sp,2) + dt * N{sp}(j) * (nforce_si(npid,2)/nmass_si(npid));%*(0.5^(1/1000)); %damping
			 %else
			 %    v_ssp(sp,2)                  = v_ssp(sp,2) + N{sp}(j)*(PredYVel2 - v_ssp(sp,2));
			 %end
			 %v_ssp(sp,2)                      = v_ssp(sp,2) + dt * N{sp}(j) * (nforce_si(npid,2)/nmass_si(npid));
			 
			 x_sp(sp,:)                       = x_sp(sp,:) + nmomentum_si(npid,:)*N{sp}(j)*dt/ nmass_si(npid);
		 end   
	end
	%}

	v_ssp_free=v_ssp;

	for ni=1:length(NodeswithPredXVel)
		i=NodeswithPredXVel(ni);
		CONNECTpnLength=0;
		for j=1:size(CONNECTpn,2);
			if CONNECTpn(i,j)>0
				CONNECTpnLength=CONNECTpnLength+1;
			else
				break;
			end
		end
		for nsp=1:CONNECTpnLength
			sp=CONNECTpn{i}(nsp);
			v_ssp(sp,1)=v_ssp(sp,1)+sum(Nmatrix(i,sp,:))*(PredXVel - v_ssp_free(sp,1));
		end
	end
	
	for ni=1:length(NodeswithPredXVel2)
		i=NodeswithPredXVel2(ni);
		CONNECTpnLength=0;
		for j=1:size(CONNECTpn,2);
			if CONNECTpn(i,j)>0
				CONNECTpnLength=CONNECTpnLength+1;
			else
				break;
			end
		end
		for nsp=1:CONNECTpnLength
			sp=CONNECTpn(i,nsp);
			v_ssp(sp,1)=v_ssp(sp,1)+sum(Nmatrix(i,sp,:))*(PredXVel2 - v_ssp_free(sp,1));
		end
	end
	
	for ni=1:length(NodeswithPredYVel)
		i=NodeswithPredYVel(ni);
		CONNECTpnLength=0;
		for j=1:size(CONNECTpn,2);
			if CONNECTpn(i,j)>0
				CONNECTpnLength=CONNECTpnLength+1;
			else
				break;
			end
		end
		for nsp=1:CONNECTpnLength
			sp=CONNECTpn(i,nsp);
			v_ssp(sp,2)=v_ssp(sp,2)+sum(Nmatrix(i,sp,:))*(PredYVel - v_ssp_free(sp,2));
		end
	end

	for ni=1:length(NodeswithPredYVel2)
		i=NodeswithPredYVel2(ni);
		CONNECTpnLength=0;
		for j=1:size(CONNECTpn,2);
			if CONNECTpn(i,j)>0
				CONNECTpnLength=CONNECTpnLength+1;
			else
				break;
			end
		end
		for nsp=1:CONNECTpnLength
			sp=CONNECTpn(i,nsp);
			v_ssp(sp,2)=v_ssp(sp,2)+sum(Nmatrix(i,sp,:))*(PredYVel2 - v_ssp_free(sp,2));
		end
	end


end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [v_ssp,x_sp] = Update_Prtcl_Posn_WPredVOR_optmzd(PredVelVect,CONNECTpn,NODES,dt,CONNECT,N,spCount,nmass_si,nforce_si,nmomentum_si,x_spo,v_ssp,x_sp,NodeswithPredXVel,NodeswithPredXVel2,NodeswithPredYVel,NodeswithPredYVel2,PredXVel,PredXVel2,PredYVel,PredYVel2,TheFieldSplit,fieldnumber,spSizes,CasetoRun)

	%v_ssp=v_ssp*(0.5^(1/1000)); %damping
	
	%fieldnumber=max(max(TheFieldSplit));
	
	% keeping the original code incase parfor fails
	%{
	for sp = 1:spCount
		for j = 1:NODES(sp)
			npid                           = CONNECT{sp}(j);
			if nmass_si(npid,TheFieldSplit(npid,sp))==0
				continue;
			end
			v_ssp(sp,:)                  = v_ssp(sp,:) + dt * N{sp}(j) * (nforce_si(npid,:,TheFieldSplit(npid,sp))/nmass_si(npid,TheFieldSplit(npid,sp)));%*(0.5^(1/1000)); %damping

			x_sp(sp,:)                       = x_sp(sp,:) + nmomentum_si(npid,:,TheFieldSplit(npid,sp))*N{sp}(j)*dt/nmass_si(npid,TheFieldSplit(npid,sp));
		end   
	end
	%}
	
	v_ssp_before=v_ssp;
	x_sp_before=x_sp;
%{
%switchable1
	try
		parfor sp = 1:spCount
			[v_ssp(sp,:),x_sp(sp,:)]=Update_Prtcl_Posn_WPredVOR_optmzd_prfrd(NODES(sp),dt,CONNECT{sp},N{sp},nmass_si,nforce_si,nmomentum_si,v_ssp(sp,:),x_sp(sp,:),TheFieldSplit(:,sp));
		end
	catch
		v_ssp=v_ssp_before;
		x_sp=x_sp_before;
%}
%switchable1
		parfor sp = 1:spCount
        %for sp = 1:spCount
			[v_ssp(sp,:),x_sp(sp,:)]=Update_Prtcl_Posn_WPredVOR_optmzd_prfrd(NODES(sp),dt,CONNECT{sp},N{sp},nmass_si,nforce_si,nmomentum_si,v_ssp(sp,:),x_sp(sp,:),TheFieldSplit(1:spSizes(sp),sp));
		end
%{
%switchable1
	end
%}
%switchable1
	
	%124 PredVel sp Protocol
	v_ssp_free=v_ssp;
	if CasetoRun==124 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189
		
		for ni=1:PredVelVect.nX
			i=PredVelVect.XNodes(ni);
			if i==59
				1;
			end
			for nsp=1:CONNECTpn.nrparticles(i)
				%nni=0;
				sp=CONNECTpn.values(i,nsp);
				% you're iterating over ni,nsp with CONNECTpn, but N runs on sp,nni. so you need nni, hence the loop below
				for nni=1:length(CONNECT{sp});
					if CONNECT{sp}(nni)==i;
						if TheFieldSplit(nni,sp)==1
							v_ssp(sp,1)=v_ssp(sp,1)+PredVelVect.XPhase(ni)*N{sp}(nni)*(PredVelVect.XVel(ni) - v_ssp_free(sp,1));
						end
						break;
					end
				end
			end
		end

		for ni=1:PredVelVect.nY
			i=PredVelVect.YNodes(ni);
			for nsp=1:CONNECTpn.nrparticles(i)
				%nni=0;
				sp=CONNECTpn.values(i,nsp);
				for nni=1:length(CONNECT{sp});
					if CONNECT{sp}(nni)==i;
						if TheFieldSplit(nni,sp)==1
							v_ssp(sp,2)=v_ssp(sp,2)+PredVelVect.YPhase(ni)*N{sp}(nni)*(PredVelVect.YVel(ni) - v_ssp_free(sp,2));
						end
						break;
					end
				end
			end
		end
		
		
	elseif CasetoRun==183
	else
		for ni=1:length(NodeswithPredXVel)
			i=NodeswithPredXVel(ni);
			if i==59
				1;
			end
			for nsp=1:CONNECTpn.nrparticles(i)
				%nni=0;
				sp=CONNECTpn.values(i,nsp);
				% you're iterating over ni,nsp with CONNECTpn, but N runs on sp,nni. so you need nni, hence the loop below
				for nni=1:length(CONNECT{sp});
					if CONNECT{sp}(nni)==i;
						if TheFieldSplit(nni,sp)==1
							v_ssp(sp,1)=v_ssp(sp,1)+N{sp}(nni)*(PredXVel - v_ssp_free(sp,1));
						end
						break;
					end
				end
			end
		end
		
		for ni=1:length(NodeswithPredXVel2)
			i=NodeswithPredXVel2(ni);
			for nsp=1:CONNECTpn.nrparticles(i)
				%nni=0;
				sp=CONNECTpn.values(i,nsp);
				for nni=1:length(CONNECT{sp});
					if CONNECT{sp}(nni)==i;
						if TheFieldSplit(nni,sp)==1
							v_ssp(sp,1)=v_ssp(sp,1)+N{sp}(nni)*(PredXVel2 - v_ssp_free(sp,1));
						end
						break;
					end
				end
			end
		end

		for ni=1:length(NodeswithPredYVel)
			i=NodeswithPredYVel(ni);
			for nsp=1:CONNECTpn.nrparticles(i)
				%nni=0;
				sp=CONNECTpn.values(i,nsp);
				for nni=1:length(CONNECT{sp});
					if CONNECT{sp}(nni)==i;
						if TheFieldSplit(nni,sp)==1
							v_ssp(sp,2)=v_ssp(sp,2)+N{sp}(nni)*(PredYVel - v_ssp_free(sp,2));
						end
						break;
					end
				end
			end
		end

		for ni=1:length(NodeswithPredYVel2)
			i=NodeswithPredYVel2(ni);
			for nsp=1:CONNECTpn.nrparticles(i)
				%nni=0;
				sp=CONNECTpn.values(i,nsp);
				for nni=1:length(CONNECT{sp});
					if CONNECT{sp}(nni)==i;
						if TheFieldSplit(nni,sp)==1
							v_ssp(sp,2)=v_ssp(sp,2)+N{sp}(nni)*(PredYVel2 - v_ssp_free(sp,2));
						end
						break;
					end
				end
			end
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [v_ssp,x_sp] = Update_Prtcl_Posn_WPredVOR_optmzd_prfrd(NODES,dt,CONNECT,N,nmass_si,nforce_si,nmomentum_si,v_ssp,x_sp,TheFieldSplit)
	
	for j = 1:NODES
		npid                           = CONNECT(j);
		if nmass_si(npid,TheFieldSplit(j))==0
			continue;
		end
		v_ssp(1,:)                  = v_ssp(1,:) + dt * N(j) * (nforce_si(npid,:,TheFieldSplit(j))/nmass_si(npid,TheFieldSplit(j)));%*(0.5^(1/1000)); %damping

		x_sp(1,:)                       = x_sp(1,:) + nmomentum_si(npid,:,TheFieldSplit(j))*N(j)*dt/nmass_si(npid,TheFieldSplit(j));
	end   
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [v_ssp,x_sp] = Update_Particle_Position_WithPredVel2_optimized(ParticleswithPredYVel,ParticlePredYVel,Nmatrix,CONNECTpn,NODES,dt,CONNECT,N,spCount,nmass_si,nforce_si,nmomentum_si,x_spo,v_ssp,x_sp,NodeswithPredXVel,NodeswithPredYVel,NodeswithPredYVel2,PredXVel,PredYVel,PredYVel2,TheFieldSplit)
	
	%v_ssp=v_ssp*(0.5^(1/1000)); %damping
	
	fieldnumber=max(max(TheFieldSplit));
	
	a_si=zeros(length(nmass_si),2,fieldnumber);
	v_si=zeros(length(nmass_si),2,fieldnumber);
	
	
	for sp = 1:spCount
		for j = 1:NODES(sp)
			npid                           = CONNECT{sp}(j);
			if nmass_si(npid,TheFieldSplit(npid,sp))==0
				continue;
			end
			v_ssp(sp,:)                  = v_ssp(sp,:) + dt * N{sp}(j) * (nforce_si(npid,:,TheFieldSplit(npid,sp))/nmass_si(npid,TheFieldSplit(npid,sp)));%*(0.5^(1/1000)); %damping
		end   
	end
	npredvelsp=length(ParticleswithPredYVel);
	v_ssp_out=[];
	for ipredvelsp=1:npredvelsp
		sp=ParticleswithPredYVel(ipredvelsp);
		pyforcedispctrl=zeros(1,2);
		pyforcedispctrl(1)=0;
		pyforcedispctrl(2)=1;
		for iteration=1:9999
			v_ssp_temp=v_ssp;
			nforcedispctrl_si=zeros(size(nforce_si));
			if iteration>2
				pyforcedispctrl=VectorInsertion(pyforcedispctrl,iteration,pyforcedispctrl(iteration-1)+(pyforcedispctrl(iteration-1)-pyforcedispctrl(iteration-2))/(v_ssp_out(iteration-1)-v_ssp_out(iteration-2))*(ParticlePredYVel(ipredvelsp)-v_ssp_out(iteration-1)));
			end
			for ni=1:length(CONNECT{ParticleswithPredYVel(ipredvelsp)})
				npid=CONNECT{ParticleswithPredYVel(ipredvelsp)}(ni);
				nforcedispctrl_si(npid,2,TheFieldSplit(npid,ParticleswithPredYVel(ipredvelsp)))=nforcedispctrl_si(npid,2,TheFieldSplit(npid,ParticleswithPredYVel(ipredvelsp)))+pyforcedispctrl(iteration)*Nmatrix(npid,ParticleswithPredYVel(ipredvelsp));
				CONNECTpnLength=0;
				for j=1:size(CONNECTpn,2);
					if CONNECTpn(npid,j)>0
						CONNECTpnLength=CONNECTpnLength+1;
					else
						break;
					end
				end
				for nsp=1:CONNECTpnLength
					sp=CONNECTpn(npid,nsp);
					if nmass_si(npid,TheFieldSplit(npid,sp))==0
						continue;
					end
					v_ssp_temp(sp,:)                  = v_ssp_temp(sp,:) + dt * Nmatrix(npid,sp) * (nforcedispctrl_si(npid,:,TheFieldSplit(npid,sp))/nmass_si(npid,TheFieldSplit(npid,sp)));%*(0.5^(1/1000)); %damping
				end
			end
			v_ssp_out=VectorInsertion(v_ssp_out,iteration,v_ssp_temp(ParticleswithPredYVel(ipredvelsp),2));
			if abs(v_ssp_out(iteration)-ParticlePredYVel(ipredvelsp))<1e-9
				v_ssp=v_ssp_temp;
				nmomentum_si=nmomentum_si+nforcedispctrl_si*dt;
				break;
			end
		end
	end
	
	for sp = 1:spCount
		for j = 1:NODES(sp)
			npid                           = CONNECT{sp}(j);
			if nmass_si(npid,TheFieldSplit(npid,sp))==0
				continue;
			end
			x_sp(sp,:)                       = x_sp(sp,:) + nmomentum_si(npid,:,TheFieldSplit(npid,sp))*N{sp}(j)*dt/nmass_si(npid,TheFieldSplit(npid,sp));
		end   
	end
	
	v_ssp_free=v_ssp;
	
	for ni=1:length(NodeswithPredXVel)
		i=NodeswithPredXVel(ni);
		CONNECTpnLength=0;
		for j=1:size(CONNECTpn,2)
			if CONNECTpn(i,j)>0
				CONNECTpnLength=CONNECTpnLength+1;
			else
				break;
			end
		end
		for nsp=1:length(CONNECTpn{i})
			sp=CONNECTpn(i,nsp);
			v_ssp(sp,1)=v_ssp(sp,1)+sum(Nmatrix(i,sp))*(PredXVel - v_ssp_free(sp,1));
		end
	end
	
	for ni=1:length(NodeswithPredYVel)
		i=NodeswithPredYVel(ni);
		CONNECTpnLength=0;
		for j=1:size(CONNECTpn,2)
			if CONNECTpn(i,j)>0
				CONNECTpnLength=CONNECTpnLength+1;
			else
				break;
			end
		end
		for nsp=1:CONNECTpnLength
			sp=CONNECTpn(i,nsp);
			v_ssp(sp,2)=v_ssp(sp,2)+sum(Nmatrix(i,sp))*(PredYVel - v_ssp_free(sp,2));
		end
	end
	
	for ni=1:length(NodeswithPredYVel2)
		i=NodeswithPredYVel2(ni);
		CONNECTpnLength=0;
		for j=1:size(CONNECTpn,2)
			if CONNECTpn(i,j)>0
				CONNECTpnLength=CONNECTpnLength+1;
			else
				break;
			end
		end
		for nsp=1:CONNECTpnLength
			sp=CONNECTpn(i,nsp);
			v_ssp(sp,2)=v_ssp(sp,2)+sum(Nmatrix(i,sp))*(PredYVel2 - v_ssp_free(sp,2));
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [v_ssp,x_sp] = Update_Particle_Position_WithPredVel3_optimized(ParticleswithPredYVel,ParticlePredYVel,Nmatrix,CONNECTpn,NODES,dt,CONNECT,N,spCount,nmass_si,nforce_si,nmomentum_si,x_spo,v_ssp,x_sp,NodeswithPredXVel,NodeswithPredYVel,NodeswithPredYVel2,PredXVel,PredYVel,PredYVel2,TheFieldSplit)

	%v_ssp=v_ssp*(0.5^(1/1000)); %damping
	
	fieldnumber=max(max(TheFieldSplit));
	
	a_si=zeros(length(nmass_si),2,fieldnumber);
	v_si=zeros(length(nmass_si),2,fieldnumber);

	for sp = 1:spCount
		for j = 1:NODES(sp)
			npid                           = CONNECT{sp}(j);
			if nmass_si(npid,TheFieldSplit(npid,sp))==0
				continue;
			end
			v_ssp(sp,:)                  = v_ssp(sp,:) + dt * N{sp}(j) * (nforce_si(npid,:,TheFieldSplit(npid,sp))/nmass_si(npid,TheFieldSplit(npid,sp)));%*(0.5^(1/1000)); %damping
		end   
	end
	v_ssp_free=v_ssp;
    nmomentum_si_trial=nmomentum_si;
	
	npredvelsp=length(ParticleswithPredYVel);
	deltavp=[];
	v_ssp_out=[];
	
	for ipredvelsp=1:npredvelsp
		sigmaNsquare=0;
		sp=ParticleswithPredYVel(ipredvelsp);
		
		% sigmaNsquare needs to be calculated for determining the imposed deltavp
		for ni=1:length(CONNECT{sp})
			sigmaNsquare=sigmaNsquare+N{sp}(ni)^2;
        end
        tolerance=1e-3;
        for iteration=1:999
            v_ssp_trial=v_ssp;
            sp=ParticleswithPredYVel(ipredvelsp);
            if iteration==1
				deltavp=VectorInsertion(deltavp,iteration,(ParticlePredYVel(ipredvelsp)-v_ssp_free(sp,2))/sigmaNsquare);
            elseif iteration==2
				deltavp=VectorInsertion(deltavp,iteration,deltavp(iteration-1)*2+tolerance);
            else
				deltavp=VectorInsertion(deltavp,iteration,deltavp(iteration-1)+(deltavp(iteration-2)-deltavp(iteration-1))/(v_ssp_out(iteration-2)-v_ssp_out(iteration-1))*(ParticlePredYVel(ipredvelsp)-v_ssp_out(iteration-1)));
            end

            % spreading deltavp to PredYVel of nodes
            PredYVelFromParticle=zeros(length(CONNECT{sp}),1);
            for ni=1:length(CONNECT{sp})
                i=CONNECT{sp}(ni);
                if nmass_si(i,TheFieldSplit(i,sp))==0
                    continue;
                end
                PredYVelFromParticle(ni)=nmomentum_si(i,2,TheFieldSplit(i,sp))/nmass_si(i,TheFieldSplit(i,sp))+N{sp}(ni)*deltavp(iteration);
                nmomentum_si_trial(i,2,TheFieldSplit(i,sp))=PredYVelFromParticle(ni)*nmass_si(i,TheFieldSplit(i,sp));
            end

            % mapping back the spread 
            Nsum=0;%debugging disp control
            for ni=1:length(CONNECT{ParticleswithPredYVel(ipredvelsp)})
                i=CONNECT{ParticleswithPredYVel(ipredvelsp)}(ni);
				CONNECTpnLength=0;
				for j=1:size(CONNECTpn,2)
					if CONNECTpn(i,j)>0
						CONNECTpnLength=CONNECTpnLength+1;
					else
						break;
					end
				end
                for nsp=1:CONNECTpnLength
                    sp=CONNECTpn(i,nsp);
                    v_ssp_trial(sp,2)=v_ssp_trial(sp,2)+sum(Nmatrix(i,sp))*(PredYVelFromParticle(ni) - v_ssp_free(sp,2));
                end
            end
			v_ssp_out=VectorInsertion(v_ssp_out,iteration,v_ssp_trial(ParticleswithPredYVel(ipredvelsp),2));
            if abs(v_ssp_out(iteration)-ParticlePredYVel(ipredvelsp))<tolerance
                v_ssp=v_ssp_trial;
                nmomentum_si=nmomentum_si_trial;
                break;
            end
        end
        
		v_ssp_free=v_ssp;
	end
	
	for sp = 1:spCount
		for j = 1:NODES(sp)
			npid                           = CONNECT{sp}(j);
			if nmass_si(npid,TheFieldSplit(npid,sp))==0
				continue;
			end
			x_sp(sp,:)                       = x_sp(sp,:) + nmomentum_si(npid,:,TheFieldSplit(npid,sp))*N{sp}(j)*dt/nmass_si(npid,TheFieldSplit(npid,sp));
		end   
	end
	
	
	for ni=1:length(NodeswithPredXVel)
		i=NodeswithPredXVel(ni);
		CONNECTpnLength=0;
		for j=1:size(CONNECTpn,2)
			if CONNECTpn(i,j)>0
				CONNECTpnLength=CONNECTpnLength+1;
			else
				break;
			end
		end
		for nsp=1:CONNECTpnLength
			sp=CONNECTpn(i,nsp);
			v_ssp(sp,1)=v_ssp(sp,1)+sum(Nmatrix(i,sp))*(PredXVel - v_ssp_free(sp,1));
		end
	end

	for ni=1:length(NodeswithPredYVel)
		i=NodeswithPredYVel(ni);
		CONNECTpnLength=0;
		for j=1:size(CONNECTpn,2)
			if CONNECTpn(i,j)>0
				CONNECTpnLength=CONNECTpnLength+1;
			else
				break;
			end
		end
		for nsp=1:CONNECTpnLength
			sp=CONNECTpn(i,nsp);
			v_ssp(sp,2)=v_ssp(sp,2)+sum(Nmatrix(i,sp))*(PredYVel - v_ssp_free(sp,2));
		end
	end

	for ni=1:length(NodeswithPredYVel2)
		i=NodeswithPredYVel2(ni);
		CONNECTpnLength=0;
		for j=1:size(CONNECTpn,2)
			if CONNECTpn(i,j)>0
				CONNECTpnLength=CONNECTpnLength+1;
			else
				break;
			end
		end
		for nsp=1:CONNECTpnLength
			sp=CONNECTpn(i,nsp);
			v_ssp(sp,2)=v_ssp(sp,2)+sum(Nmatrix(i,sp))*(PredYVel2 - v_ssp_free(sp,2));
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [v_ssp,x_sp] = Update_Particle_Position_WithPredVel2_optimized_failed(Nmatrix,CONNECTpn,NODES,dt,CONNECT,N,spCount,nmass_si,nforce_si,nmomentum_si,x_spo,v_ssp,x_sp,NodeswithPredXVel,NodeswithPredYVel,NodeswithPredYVel2,PredXVel,PredYVel,PredYVel2,TheFieldSplit)
	%v_ssp=v_ssp*(0.5^(1/1000)); %damping

	fieldnumber=size(Nmatrix,3);

	a_si=zeros(length(nmass_si),2,fieldnumber);
	v_si=zeros(length(nmass_si),2,fieldnumber);
%{
	for field=1:fieldnumber
		try
			parfor i=1:size(nmass_si,1)
				if nmass_si(i,field)==0
				else
					a_si(i,:,field)=nforce_si(i,:,field)/nmass_si(i,field);
					v_si(i,:,field)=nmomentum_si(i,:,field)/nmass_si(i,field);
				end
			end
		catch
			disp('Update_Particle_Position_WithPredVel2 a_si v_si parfor failed!');
			disp('Rolling back to regular for');
			for i=1:size(nmass_si,1)
				if nmass_si(i,field)==0
				else
					a_si(i,:,field)=nforce_si(i,:,field)/nmass_si(i,field);
					v_si(i,:,field)=nmomentum_si(i,:,field)/nmass_si(i,field);
				end
			end
		end
	end

	for field=1:fieldnumber
		for direction=1:2
			v_ssp(:,direction)=v_ssp(:,direction)+dt*transpose(Nmatrix(:,:,field))*(a_si(:,direction,field));
			x_sp(:,direction)=x_sp(:,direction)+dt*transpose(Nmatrix(:,:,field))*(v_si(:,direction,field));
		end
	end
%}
	
	for sp = 1:spCount
		 for j = 1:NODES(sp)
			 npid                           = CONNECT{sp}(j);
			  if nmass_si(npid,TheFieldSplit(npid,sp))==0
				continue;
			  end
			  %{
			  NodeisPredXVel=0;
			  for k=1:length(NodeswithPredXVel)
				 if npid==NodeswithPredXVel(k)
					 NodeisPredXVel=1;
					 break
				 end
			 end
			  NodeisPredYVel=0;          
			  for k=1:length(NodeswithPredYVel)
				 if npid==NodeswithPredYVel(k)
					 NodeisPredYVel=1;
					 break
				 end
			  end
			  NodeisPredYVel2=0;
			  for k=1:length(NodeswithPredYVel2)
				 if npid==NodeswithPredYVel2(k)
					 NodeisPredYVel2=1;
					 break
				 end
			  end
			  %}
			  %if NodeisPredXVel==0
				 v_ssp(sp,1)                  = v_ssp(sp,1) + dt * Nmatrix(npid,sp,TheFieldSplit(npid,sp)) * (nforce_si(npid,1,TheFieldSplit(npid,sp))/nmass_si(npid,TheFieldSplit(npid,sp)));%*(0.5^(1/1000)); %damping
			 %else
			 %    v_ssp(sp,1)                  = v_ssp(sp,1) + N{sp}(j)*(PredXVel - v_ssp(sp,1));
			 %end
			 
			 %if NodeisPredYVel==0
				 v_ssp(sp,2)                      = v_ssp(sp,2) + dt * Nmatrix(npid,sp,TheFieldSplit(npid,sp)) * (nforce_si(npid,2,TheFieldSplit(npid,sp))/nmass_si(npid,TheFieldSplit(npid,sp)));%*(0.5^(1/1000)); %damping
			 %else
			 %    v_ssp(sp,2)                  = v_ssp(sp,2) + N{sp}(j)*(PredYVel - v_ssp(sp,2));
			 %end
			 
			 %if NodeisPredYVel2==0
			 %    v_ssp(sp,2)                      = v_ssp(sp,2) + dt * N{sp}(j) * (nforce_si(npid,2)/nmass_si(npid));%*(0.5^(1/1000)); %damping
			 %else
			 %    v_ssp(sp,2)                  = v_ssp(sp,2) + N{sp}(j)*(PredYVel2 - v_ssp(sp,2));
			 %end
			 %v_ssp(sp,2)                      = v_ssp(sp,2) + dt * N{sp}(j) * (nforce_si(npid,2)/nmass_si(npid));
			 
			 x_sp(sp,:)                       = x_sp(sp,:) + nmomentum_si(npid,:,TheFieldSplit(npid,sp))*Nmatrix(npid,sp,TheFieldSplit(npid,sp))*dt/ nmass_si(npid,TheFieldSplit(npid,sp));
		 end   
	end
	

	v_ssp_free=v_ssp;

	for ni=1:length(NodeswithPredXVel)
		i=NodeswithPredXVel(ni);
		CONNECTpnLength=0;
		for j=1:size(CONNECTpn,2)
			if CONNECTpn(i,j)>0
				CONNECTpnLength=CONNECTpnLength+1;
			else
				break;
			end
		end
		for nsp=1:CONNECTpnLength
			sp=CONNECTpn(i,nsp);
			v_ssp(sp,1)=v_ssp(sp,1)+sum(Nmatrix(i,sp,:))*(PredXVel - v_ssp_free(sp,1));
		end
	end

	for ni=1:length(NodeswithPredYVel)
		i=NodeswithPredYVel(ni);
		CONNECTpnLength=0;
		for j=1:size(CONNECTpn,2)
			if CONNECTpn(i,j)>0
				CONNECTpnLength=CONNECTpnLength+1;
			else
				break;
			end
		end
		for nsp=1:CONNECTpnLength
			sp=CONNECTpn(i,nsp);
			v_ssp(sp,2)=v_ssp(sp,2)+sum(Nmatrix(i,sp,:))*(PredYVel - v_ssp_free(sp,2));
		end
	end

	for ni=1:length(NodeswithPredYVel2)
		i=NodeswithPredYVel2(ni);
		CONNECTpnLength=0;
		for j=1:size(CONNECTpn,2)
			if CONNECTpn(i,j)>0
				CONNECTpnLength=CONNECTpnLength+1;
			else
				break;
			end
		end
		for nsp=1:CONNECTpnLength
			sp=CONNECTpn(i,nsp);
			v_ssp(sp,2)=v_ssp(sp,2)+sum(Nmatrix(i,sp,:))*(PredYVel2 - v_ssp_free(sp,2));
		end
	end


end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [nvelo_si,L_si] = Interpolate_velocity_back(NODES,nodeCount,spCount,CONNECT,m_sp,v_ssp,N,dN,nmass_si,Nmatrix,dNxmatrix,dNymatrix)
	fieldnumber=size(Nmatrix,3);

	%% Interpolation from particle to grid task
	% Node variables

	 nvelo_si                = zeros(nodeCount,2,fieldnumber);                   % Nodal Velocity
	 nmomentum_si            = zeros(nodeCount,2,fieldnumber);                   % Nodal Momentum
	 L_si                    = zeros(nodeCount,2,2,fieldnumber);

	for field=fieldnumber:-1:1
		nmass_si(:,field)                = Nmatrix(:,:,field)*m_sp;                         % Nodal Mass
		nmomentum_si(:,1,field)       = Nmatrix(:,:,field)*(m_sp.*v_ssp(:,1));           % Nodal Momentum in X direction
		nmomentum_si(:,2,field)       = Nmatrix(:,:,field)*(m_sp.*v_ssp(:,2));           % Nodal Momentum in Y direction
		L_si(:,1,1,field)=dNxmatrix(:,:,field)*v_ssp(:,1);
		L_si(:,1,2,field)=dNymatrix(:,:,field)*v_ssp(:,1);
		L_si(:,2,1,field)=dNxmatrix(:,:,field)*v_ssp(:,2);
		L_si(:,2,2,field)=dNymatrix(:,:,field)*v_ssp(:,2);
	end
	 
	 for field=1:fieldnumber
%{
%switchable1
		try
			parfor i=1:size(nmass_si,1)
				if nmass_si(i,field)==0
				else
					nvelo_si(i,:,field)=nmomentum_si(i,:,field)/nmass_si(i,field);
				end
			end
		catch
			fprintf('%s',['Update_Particle_Position_WithPredVel2 a_si v_si parfor failed!' char(10)]);
			fprintf('%s',['Rolling back to regular for' char(10)]);
%}
%switchable1
			for i=1:size(nmass_si,1)
				if nmass_si(i,field)==0
				else
					nvelo_si(i,:,field)=nmomentum_si(i,:,field)/nmass_si(i,field);
				end
			end
%{
%switchable1
		end
%}
%switchable1
	end

	 
	 % Momentum
	 %{
	 for sp = 1:spCount
		 for j = 1:NODES(sp)
			 npid                  = CONNECT{sp}(j);
			 nmomentum_si(npid,:)  = nmomentum_si(npid,:) + m_sp(sp)*v_ssp(sp,:)*N{sp}(j);

	%{
	if v_ssp(sp,1)*N{sp}(j)~=0|v_ssp(sp,2)*N{sp}(j)~=0
		texttodisplay=[];
		texttodisplay=[texttodisplay 'sp=' num2str(sp)];
		texttodisplay=[texttodisplay '; npid=' num2str(npid)];
		texttodisplay=[texttodisplay '; j=' num2str(j)];
		texttodisplay=[texttodisplay '; v_ssp(sp,1)=' num2str(v_ssp(sp,1))];
		texttodisplay=[texttodisplay '; N{sp}(j)=' num2str(N{sp}(j))];
		texttodisplay=[texttodisplay '; v_ssp(sp,1)*N{sp}(j)=' num2str(v_ssp(sp,1)*N{sp}(j))];
		texttodisplay=[texttodisplay '; nmomentum_si(npid,1)=' num2str(nmomentum_si(npid,1))];
		disp(texttodisplay);
	1;
	end
	%}
			 
			for p=1:2
				for q=1:2
					L_si(npid,p,q)=L_si(npid,p,q)+v_ssp(sp,p)*dN{sp}(q,j);
				end
			end
		 end
	 end
	 
	 % Velocity
	  for sp = 1:spCount
	 for j = 1:NODES(sp)
		 npid                      = CONNECT{sp}(j);
				  if nmass_si(npid)==0
					continue
				  end 
				  
	nvelo_si(npid,:)               = nmomentum_si(npid,:)/nmass_si(npid); 
	%{
	if nvelo_si(npid,1)~=0|nvelo_si(npid,2)~=0
		texttodisplay=[];
		texttodisplay=[texttodisplay 'npid=' num2str(npid)];
		texttodisplay=[texttodisplay '; nmomentum_si(npid,:)=[' num2str(nmomentum_si(npid,1)) ',' num2str(nmomentum_si(npid,2)) ']'];
		texttodisplay=[texttodisplay '; nmass_si(npid)=' num2str(nmass_si(npid))];
		texttodisplay=[texttodisplay '; nvelo_si(npid,:)=[' num2str(nvelo_si(npid,1)) ',' num2str(nvelo_si(npid,2)) ']'];
		disp(texttodisplay);
		1;
	end
	%}
	 end
	  end
	 %}
	1;
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [nvelo_si] = Interpolate_velocity_back_optimized(NODES,nodeCount,spCount,CONNECT,m_sp,v_ssp,N,dN,nmass_si,TheFieldSplit,fieldnumber)

	%% Interpolation from particle to grid task
	% Node variables
 
	 nvelo_si                = zeros(nodeCount,2,fieldnumber);                   % Nodal Velocity
	 nmomentum_si            = zeros(nodeCount,2,fieldnumber);                   % Nodal Momentum
	% L_si                    = zeros(nodeCount,2,2,fieldnumber);

	 % Momentum
	
	for sp = 1:spCount
		for j = 1:NODES(sp)
			npid                  = CONNECT{sp}(j);
			nmomentum_si(npid,:,TheFieldSplit(j,sp))  = nmomentum_si(npid,:,TheFieldSplit(j,sp)) + m_sp(sp)*v_ssp(sp,:)*N{sp}(j);
%{
			for p=1:2
				for q=1:2
					L_si(npid,p,q,TheFieldSplit{sp}(j))=L_si(npid,p,q,TheFieldSplit{sp}(j))+v_ssp(sp,p)*dN{sp}(q,j);
				end
			end
%}
		end
	end

	% Velocity
	for sp = 1:spCount
		for j = 1:NODES(sp)
			npid                      = CONNECT{sp}(j);
			if nmass_si(npid,TheFieldSplit(j,sp))==0
				continue
			end 
			nvelo_si(npid,:,TheFieldSplit(j,sp))               = nmomentum_si(npid,:,TheFieldSplit(j,sp))/nmass_si(npid,TheFieldSplit(j,sp)); 
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [nvelo_si] = Interpolate_velocity_back_optimized_msp(NODES,nodeCount,spCount,CONNECT,m_sp,v_ssp,N,dN,TheFieldSplit,fieldnumber)

	%% Interpolation from particle to grid task
	% Node variables
 
	 nvelo_si                = zeros(nodeCount,2,fieldnumber);                   % Nodal Velocity
	 nmomentum_si            = zeros(nodeCount,2,fieldnumber);                   % Nodal Momentum
	 nmass_si                = zeros(nodeCount,fieldnumber);
	% L_si                    = zeros(nodeCount,2,2,fieldnumber);

	 % Momentum
	
	for sp = 1:spCount
		for j = 1:NODES(sp)
			npid                  = CONNECT{sp}(j);
			nmomentum_si(npid,:,TheFieldSplit(j,sp))  = nmomentum_si(npid,:,TheFieldSplit(j,sp)) + m_sp(sp)*v_ssp(sp,:)*N{sp}(j);
			nmass_si(npid,TheFieldSplit(j,sp))=nmass_si(npid,TheFieldSplit(j,sp))+m_sp(sp)*N{sp}(j);
			%nmomentum_si(npid,:,1)  = nmomentum_si(npid,:,1) + m_sp(sp)*v_ssp(sp,:)*N{sp}(j);
			%nmass_si(npid,1)=nmass_si(npid,1)+m_sp(sp)*N{sp}(j);
%{
			for p=1:2
				for q=1:2
					L_si(npid,p,q,TheFieldSplit{sp}(j))=L_si(npid,p,q,TheFieldSplit{sp}(j))+v_ssp(sp,p)*dN{sp}(q,j);
				end
			end
%}
		end
	end

	% Velocity
	for sp = 1:spCount
		for j = 1:NODES(sp)
			npid                      = CONNECT{sp}(j);
			if nmass_si(npid,TheFieldSplit(j,sp))==0
			%if nmass_si(npid,1)==0
				continue
			end 
			nvelo_si(npid,:,TheFieldSplit(j,sp))               = nmomentum_si(npid,:,TheFieldSplit(j,sp))/nmass_si(npid,TheFieldSplit(j,sp)); 
			%nvelo_si(npid,:,1)               = nmomentum_si(npid,:,1)/nmass_si(npid,1); 
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [data]=Boundary_Dirichlet(nfbcx,nfbcy,fbcx,fbcy,data)
	for i=1:nfbcx
		data(fbcx(i),1,1)     = 0;
	end

	for i=1:nfbcy
		data(fbcy(i),2,1)     = 0;
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [F_sp,A_sp,t_sp,s_sp,p_sp,E_acc,e_pl_sp,sigma_global_big,e_t_global_big,e_pl_global_big,alphahp,f_final_vect,surfacewithfmax,sigma_local_big,evaltimes,stackvars,duration,dudx_sp,W_sp,thetacrackrtl,thetacrack,justcracked,Qacoustic,h,RQ,QbackRback,AbeforeQ_rtl] = ...
    Update_Stress_par(CModel,NODES,dt,cellCount,mspoints,CONNECT,nvelo_si,dN,E,nu,F_sp,A_spo,t_spo,m_sp,s_sp,p_sp,A_sp,t_sp,E_acc,epsilonshrinkdot_sp,epsilonshrinkdotx_sp,epsilonshrinkdoty_sp,e_pl_sp,sigma_global_big,e_t_global_big,e_pl_global_big,alphahp,xdirletter,ydirletter,zdirletter,xydirletter,yzdirletter,xzdirletter,ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,Grt,Gtl,Grl,nurt,nutl,nurl,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit,CasetoRun,troubleshotparticles,matmodel,weakeningfactor_sp,orientationoffset,Rdisplayedparticles,t_time,Debugging,Nmatrix,dNxmatrix,dNymatrix,spCount,dudx_sp,W_sp,thetacrackrtl)
	% Calculate stress for solid phase
	fieldnumber=size(Nmatrix,3);

	L_sp_vect=zeros(spCount,2,2);
	dudx_matrix=zeros(2,2,spCount);
	for field=fieldnumber:-1:1
		L_sp_vect(:,1,1)=L_sp_vect(:,1,1)+transpose(dNxmatrix(:,:,field))*nvelo_si(:,1,field);
		L_sp_vect(:,1,2)=L_sp_vect(:,1,2)+transpose(dNymatrix(:,:,field))*nvelo_si(:,1,field);
		L_sp_vect(:,2,1)=L_sp_vect(:,2,1)+transpose(dNxmatrix(:,:,field))*nvelo_si(:,2,field);
		L_sp_vect(:,2,2)=L_sp_vect(:,2,2)+transpose(dNymatrix(:,:,field))*nvelo_si(:,2,field);
	end
		
	for c=1:cellCount
		mpts = mspoints{c};
		
		for sp = 1:length(mpts)
			spid = mpts(sp);
			L_sp{spid} = [L_sp_vect(spid,1,1) L_sp_vect(spid,1,2) ; L_sp_vect(spid,2,1) L_sp_vect(spid,2,2)];
		
	%		for j=1:NODES(spid)
	%				  if dN{spid}(j)==0
	%				 continue
	%				  end
	%					npid = CONNECT{spid}(j);
	%					L_sp{spid} = L_sp{spid} + (nvelo_si(npid,:)'*dN{spid}(:,j)');
	 %       end
			%ESP_prev=[e_t_global_big(spid,1) e_t_global_big(spid,4);e_t_global_big(spid,4) e_t_global_big(spid,2)];

			dESP{spid} = ((L_sp{spid} + L_sp{spid}')/2-([epsilonshrinkdot_sp(spid)+epsilonshrinkdotx_sp(spid) 0;0 epsilonshrinkdot_sp(spid)+epsilonshrinkdoty_sp(spid)]))*dt; 
		   % if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==21 || CasetoRun==17
		   %     W{spid}=(L_sp{spid} - L_sp{spid}')/2;
		   %     s_sp_prev(spid,1)=sigma_global_big(spid,1);
		   %     s_sp_prev(spid,2)=sigma_global_big(spid,2);
		   %     s_sp_prev(spid,3)=sigma_global_big(spid,4);
		   % end
			
			F_sp{spid} = (eye(2,2)+L_sp{spid}*dt)*F_sp{spid};
			%dESP{spid} = transpose(F_sp{spid})*dESP{spid}*F_sp{spid};
			%deltaF=L_sp{spid}*dt*F_sp{spid};
			J{spid} = det(F_sp{spid});
			A_sp(spid)=A_spo(spid)*J{spid};
			
			t_sp(spid)=t_spo(spid)*exp(e_t_global_big(spid,3));

			p_sp(spid) = m_sp(spid)/(A_sp(spid)*t_sp(spid));
			%ESP_now=1/2*(transpose(F_sp{spid})*F_sp{spid}-eye(2));
			%dESP{spid} = ESP_now-ESP_prev;
			%dESP{spid}=1/2*(deltaF*transpose(F_sp{spid})+F_sp{spid}*transpose(deltaF));
			%dESP{spid}=1/2*(deltaF+transpose(deltaF)+transpose(deltaF)*deltaF);
			
			%{
			dudx_sp(spid,1)=dudx_sp(spid,1)+L_sp{spid}(1,1)*dt;
			dudx_sp(spid,2)=dudx_sp(spid,2)+L_sp{spid}(1,2)*dt;
			dudx_sp(spid,3)=dudx_sp(spid,3)+L_sp{spid}(2,1)*dt;
			dudx_sp(spid,4)=dudx_sp(spid,4)+L_sp{spid}(2,2)*dt;
			%}
			
			dudx_matrix(:,:,spid)=eye(2)-(F_sp{spid}^(-1));
			dudx_sp(spid,1)=dudx_matrix(1,1,spid);
			dudx_sp(spid,2)=dudx_matrix(1,2,spid);
			dudx_sp(spid,3)=dudx_matrix(2,1,spid);
			dudx_sp(spid,4)=dudx_matrix(2,2,spid);
		end      
	end
	evaltimes=zeros(length(dESP),1);
	for i=1:length(Rdisplayedparticles)
		Rback=poldecomp(F_sp{Rdisplayedparticles(i)},0);
		R=transpose(Rback);
		Q=[cos(orientationoffset(Rdisplayedparticles(i))) sin(orientationoffset(Rdisplayedparticles(i))); -sin(orientationoffset(Rdisplayedparticles(i))) cos(orientationoffset(Rdisplayedparticles(i)))];
		%Qback=[cos(-orientationoffset(Rdisplayedparticles(i))) sin(-orientationoffset(Rdisplayedparticles(i))); -sin(-orientationoffset(Rdisplayedparticles(i))) cos(-orientationoffset(Rdisplayedparticles(i)))];
		RQ=R*Q;
		thetarotateall=asin(RQ(1,2));
		thetarotateoriginal=asin(Q(1,2));
		fprintf('%s',[PrintMatrixVectorized(RQ,['RQ{' float2txt(5,Rdisplayedparticles(i)) '}'],0) '; theta=' float2txt(5,thetarotateall*180/pi) ' deg; thetaoriginal=' float2txt(5,thetarotateoriginal*180/pi) ' deg' char(10)]);
	end
	
	f_final_vect=zeros(size(alphahp));
	surfacewithfmax=zeros(size(E_acc));
	sigma_local_big=zeros(size(sigma_global_big));
    AbeforeQ_rtl=zeros(2,2,2,2,length(dESP));
	parforstarttime=[];
	
	
	if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==21 || CasetoRun==17 || CasetoRun==11 || CasetoRun==12 || CasetoRun==16 || CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44 || CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==15 || CasetoRun==14 || CasetoRun==5 || CasetoRun==6 || CasetoRun==10 || CasetoRun==64 || CasetoRun==66 || CasetoRun==69 || CasetoRun==67 || CasetoRun==68 || CasetoRun==71 || CasetoRun==72 || CasetoRun==73 || CasetoRun==74 || CasetoRun==78 || CasetoRun==81 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==83 || CasetoRun==84 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124 || CasetoRun==117 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110 || CasetoRun==96 || CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89 || CasetoRun==85 || CasetoRun==77 || CasetoRun==65 || CasetoRun==70
		if s_sp(3,1)<-5.95
			1;
		end
		
		switcherconfirmer=zeros(1,length(dESP));
		thetacrack=zeros(1,length(dESP));
		
		s_sp_store=s_sp;
		sigma_global_big_store=sigma_global_big;
		e_t_global_big_store=e_t_global_big;
		e_pl_global_big_store=e_pl_global_big;
		alphahp_store=alphahp;
		thetacrackrtl_store=thetacrackrtl;
		
		stackvars=zeros(length(dESP)+1,2);
		justcracked=zeros(length(dESP),1);
		Qacoustic=cell(1,length(dESP));
		h=cell(1,length(dESP));
		RQ=zeros(2,2,length(dESP));
		QbackRback=zeros(2,2,length(dESP));
		duration=zeros(1,length(dESP));
		
%{
%switchable1
		try
			if Debugging.Active && CloseEnough(t_time,Debugging.Time,1e-5,2)
				asdf(-pi);
			end
			
			parforstarttime=clockallsec;
			parfor spid=1:length(dESP) %originally parfor
				[s_sp(spid,:),e_pl_sp(spid,:),sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:),f_final_vect(spid,:),surfacewithfmax(spid),sigma_local_big(spid,:),E_acc(spid),switcherconfirmer(spid),evaltimes(spid),stackvars(spid,:),duration(spid),thetacrackrtl(spid),thetacrack(spid),justcracked(spid),Qacoustic{spid},h{spid},RQ(:,:,spid),QbackRback(:,:,spid),AbeforeQ_rtl(:,:,:,:,spid)]= ... 
					Matmodel_parforred_confirmer(F_sp{spid},matmodel(spid),dESP{spid},s_sp(spid,:),E,nu,sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:),xdirletter{spid},ydirletter{spid},zdirletter{spid},xydirletter{spid},yzdirletter{spid},xzdirletter{spid},ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,Grt,Gtl,Grl,nurt,nutl,nurl,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit,CasetoRun,weakeningfactor_sp(spid),orientationoffset(spid),switcherconfirmer(spid),t_time,dt,spid,Debugging,parforstarttime,thetacrackrtl(spid),dudx_matrix(:,:,spid),Efactor_sp(spid));   
			end
		catch		
			s_sp=s_sp_store;
			sigma_global_big=sigma_global_big_store;
			e_t_global_big=e_t_global_big_store;
			e_pl_global_big=e_pl_global_big_store;
			alphahp=alphahp_store;
			thetacrackrtl=thetacrackrtl_store;
			
			fprintf('%s',['that parfor random error again!' char(10)]);
			printvector(switcherconfirmer,'switcherconfirmer');
			fprintf('%s',['# of done particles = ' num2str(sum(switcherconfirmer)) char(10)]);
			switcherconfirmer=zeros(1,length(dESP));
			parforstarttime=clockallsec;
%}
%switchable1
			for spid=1:length(dESP)
				[s_sp(spid,:),e_pl_sp(spid,:),sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:),f_final_vect(spid,:),surfacewithfmax(spid),sigma_local_big(spid,:),E_acc(spid),switcherconfirmer(spid),evaltimes(spid),stackvars(spid,:),duration(spid),thetacrackrtl(spid),thetacrack(spid),justcracked(spid),Qacoustic{spid},h{spid},RQ(:,:,spid),QbackRback(:,:,spid),AbeforeQ_rtl(:,:,:,:,spid)]= ... 
					Matmodel_parforred_confirmer(F_sp{spid},matmodel(spid),dESP{spid},s_sp(spid,:),E,nu,sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:),xdirletter{spid},ydirletter{spid},zdirletter{spid},xydirletter{spid},yzdirletter{spid},xzdirletter{spid},ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,Grt,Gtl,Grl,nurt,nutl,nurl,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit,CasetoRun,weakeningfactor_sp(spid),orientationoffset(spid),switcherconfirmer(spid),t_time,dt,spid,Debugging,parforstarttime,thetacrackrtl(spid),dudx_matrix(:,:,spid),Efactor_sp(spid));   
			end
%{
%switchable1
			fprintf('%s',['regular for alternative successful!' char(10)]);
			printvector(switcherconfirmer,'switcherconfirmer');
			1;
		end
		stackvars(length(dESP)+1,2)=max(stackvars(:,1)+stackvars(:,2));
		stackvars(length(dESP)+1,1)=0;
		1==1;
		if 1==0
			h = barh(stackvars,'stacked');
			set(h,{'FaceColor'},{'w';'k'},'EdgeColor','none');
		end
%}
%switchable1
	elseif CasetoRun==4
		parfor spid=1:length(dESP)
			switch CModel
				case 'Neo_Hookean_Elastic'
					[s_sp(spid,:)]=Neo_Hookean_elastic(F_sp{spid},J{spid},E,nu);
				case 'Linear_Elastic'
					[s_sp(spid,:)]=Linear_elastic(dESP{spid},s_sp(spid,:),E,nu);
					f_final_vect(spid,:)=zeros(1,7);
					surfacewithfmax(spid)=0;
				case 'Mises'
					[s_sp(spid,:)]=Von_Mises(dESP{spid},s_sp(spid,:),E,nu,30);
				case 'Mises_Softening'
					[s_sp(spid,:),E_acc(spid),e_pl_sp(spid,:)]=Von_Mises_Softening(dESP{spid},s_sp(spid,:),E,nu,30,E_acc(spid),e_pl_sp(spid,:));
				case 'Wood_Schmidt5'
					[s_sp(spid,:),e_pl_sp(spid,:)]=Wood_Schmidt5(dESP{spid},s_sp(spid,:),e_pl_sp(spid,:));
					E_acc(spid)=0;
				case 'Wood_Schmidt15'
					[s_sp(spid,:),e_pl_sp(spid,:),sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:)]=Wood_Schmidt15_function(dESP{spid},sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:));
					E_acc(spid)=0;
				case 'Wood_Schmidt16'
					[s_sp(spid,:),e_pl_sp(spid,:),sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:)]=Wood_Schmidt16(dESP{spid},sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:));
					E_acc(spid)=0;
				case 'Wood_Schmidt17'
					[s_sp(spid,:),e_pl_sp(spid,: ),sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:),f_final_vect(spid,:),surfacewithfmax(spid),sigma_local_big(spid,:)]= ...
						Wood_Schmidt17(dESP{spid},sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:),xdirletter{spid},ydirletter{spid},zdirletter{spid},xydirletter{spid},yzdirletter{spid},xzdirletter{spid},ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,Grt,Gtl,Grl,nurt,nutl,nurl,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit,CasetoRun);
					E_acc(spid)=0;
			end    
		end
	%elseif CasetoRun==5 || CasetoRun==6
	%    f_final_vect=zeros(size(alphahp));
	%    surfacewithfmax=zeros(size(E_acc));
	%    sigma_local_big=zeros(size(sigma_global_big));
	%    parfor spid=1:length(dESP) %originally parfor
	%        [s_sp(spid,:),e_pl_sp(spid,:),sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:),f_final_vect(spid,:),surfacewithfmax(spid),sigma_local_big(spid,:),E_acc(spid)]= ... 
	%            Matmodel_parforred(F_sp{spid},matmodel(spid),dESP{spid},s_sp(spid,:),E,nu,sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:),xdirletter{spid},ydirletter{spid},zdirletter{spid},xydirletter{spid},yzdirletter{spid},xzdirletter{spid},ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,Grt,Gtl,Grl,nurt,nutl,nurl,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit,CasetoRun,weakeningfactor_sp(spid),orientationoffset(spid));   
	%    end
	elseif CasetoRun==7
		if s_sp(3,1)<-5.95
			1;
		end
		f_final_vect=zeros(size(alphahp));
		surfacewithfmax=zeros(size(E_acc));
		sigma_local_big=zeros(size(sigma_global_big));
		parfor spid=1:length(dESP) %originally parfor
			[s_sp(spid,:),e_pl_sp(spid,:),sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:),f_final_vect(spid,:),surfacewithfmax(spid),sigma_local_big(spid,:),E_acc(spid),AbeforeQ_rtl(:,:,:,:,spid)]= ... 
				Matmodel_parforred(F_sp{spid},matmodel(spid),dESP{spid},s_sp(spid,:),E,nu,sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:),xdirletter{spid},ydirletter{spid},zdirletter{spid},xydirletter{spid},yzdirletter{spid},xzdirletter{spid},ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,Grt,Gtl,Grl,nurt,nutl,nurl,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit,CasetoRun,weakeningfactor_sp(spid),orientationoffset(spid));   
		end
	elseif CasetoRun==8 || CasetoRun==9
		f_final_vect=zeros(size(alphahp));
		surfacewithfmax=zeros(size(E_acc));
		sigma_local_big=zeros(size(sigma_global_big));
		parfor spid=1:length(dESP) %originally parfor
			[s_sp(spid,:),e_pl_sp(spid,:),sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:),f_final_vect(spid,:),surfacewithfmax(spid),sigma_local_big(spid,:),E_acc(spid),AbeforeQ_rtl(:,:,:,:,spid)]= ... 
				Matmodel_parforred(F_sp{spid},matmodel(spid),dESP{spid},s_sp(spid,:),E,nu,sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:),xdirletter{spid},ydirletter{spid},zdirletter{spid},xydirletter{spid},yzdirletter{spid},xzdirletter{spid},ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,Grt,Gtl,Grl,nurt,nutl,nurl,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit,CasetoRun,weakeningfactor_sp(spid),orientationoffset(spid));   
		end
	%{    
	elseif CasetoRun==10
		if s_sp(3,1)<-5.95
			1;
		end
		f_final_vect=zeros(size(alphahp));
		surfacewithfmax=zeros(size(E_acc));
		sigma_local_big=zeros(size(sigma_global_big));
		parfor spid=1:length(dESP) %originally parfor
			[s_sp(spid,:),e_pl_sp(spid,:),sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:),f_final_vect(spid,:),surfacewithfmax(spid),sigma_local_big(spid,:),E_acc(spid)]= ... 
				Matmodel_parforred(F_sp{spid},matmodel(spid),dESP{spid},s_sp(spid,:),E,nu,sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:),xdirletter{spid},ydirletter{spid},zdirletter{spid},xydirletter{spid},yzdirletter{spid},xzdirletter{spid},ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,Grt,Gtl,Grl,nurt,nutl,nurl,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit,CasetoRun,weakeningfactor_sp(spid),orientationoffset(spid));   
		end
		%}
	end
	for sp=1:spCount
		dW_sp=sum(sum([s_sp(sp,1) s_sp(sp,3);s_sp(sp,3) s_sp(sp,2)].*dESP{sp}));
		W_sp(sp)=W_sp(sp)+dW_sp;
	end
	%{
	for spid=1:length(dESP)
	%    if spid==troubleshotparticles(1) | spid==troubleshotparticles(2)
	%        if e_pl_sp(troubleshotparticles(1),1)<-1e-10 | e_pl_sp(troubleshotparticles(2),1)<-1e-10
	%            1;
	%        end
	%    end
		newSSP=(1/J{spid})*F_sp{spid}*[s_sp(spid,1) s_sp(spid,3);s_sp(spid,3) s_sp(spid,2)]*transpose(F_sp{spid});
		s_sp(spid,1)=newSSP(1,1);
		s_sp(spid,2)=newSSP(2,2);
		s_sp(spid,3)=newSSP(1,2);
	end
	%}
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [sse_sp,F_sp,A_sp,t_sp,s_sp,p_sp,E_acc,e_pl_sp,sigma_global_big,e_t_global_big,e_pl_global_big,alphahp,f_final_vect,surfacewithfmax,sigma_local_big,evaltimes,stackvars,duration,dudx_sp,W_sp,thetacrackrtl,thetacrack,justcracked,Qacoustic,h,RQ,QbackRback,AbeforeQ_rtl] = ...
    Update_Stress_par_optimized(CModel,NODES,dt,cellCount,mspoints,CONNECT,nvelo_si,dN,E,nu,F_sp,A_spo,t_spo,m_sp,s_sp,p_sp,A_sp,t_sp,E_acc,epsilonshrinkdot_sp,epsilonshrinkdotx_sp,epsilonshrinkdoty_sp,e_pl_sp,sigma_global_big,e_t_global_big,e_pl_global_big,alphahp,xdirletter,ydirletter,zdirletter,xydirletter,yzdirletter,xzdirletter,ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,Grt,Gtl,Grl,nurt,nutl,nurl,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit,CasetoRun,troubleshotparticles,matmodel,weakeningfactor_sp,orientationoffset,Rdisplayedparticles,t_time,Debugging,spCount,dudx_sp,W_sp,thetacrackrtl,TheFieldSplit,fieldnumber,Efactor_sp)
	% Calculate stress for solid phase
	L_sp=cell(1,spCount);
	dudx_matrix=zeros(2,2,spCount);
	duration=zeros(1,spCount);
	sse_sp=zeros(1,spCount); %specific (volume) elastic strain energy
	
	dESP=cell(1,spCount);
	J=cell(1,spCount);

	for i=1:spCount
		L_sp{i}=zeros(2,2);
		J{i}=0;
		dESP{i}=zeros(2,2);
	end
	
	
	for c=1:cellCount
		mpts = mspoints{c};
		
		for sp = 1:length(mpts)
			spid = mpts(sp);
			%L_sp{spid} = [L_sp_vect(spid,1,1) L_sp_vect(spid,1,2) ; L_sp_vect(spid,2,1) L_sp_vect(spid,2,2)];
			L_sp{spid} = zeros(2,2);
			for j=1:NODES(spid)
				if dN{spid}(1,j)==0 && dN{spid}(2,j)==0
					continue
				end
				npid = CONNECT{spid}(j);
                L_sp{spid} = L_sp{spid} + (nvelo_si(npid,:,TheFieldSplit(j,spid))'*dN{spid}(:,j)');
            end
			%ESP_prev=[e_t_global_big(spid,1) e_t_global_big(spid,4);e_t_global_big(spid,4) e_t_global_big(spid,2)];
			dESP{spid} = ((L_sp{spid} + L_sp{spid}')/2-([epsilonshrinkdot_sp(spid)+epsilonshrinkdotx_sp(spid) 0;0 epsilonshrinkdot_sp(spid)+epsilonshrinkdoty_sp(spid)]))*dt; 
		    % if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==21 || CasetoRun==17
		    %    W{spid}=(L_sp{spid} - L_sp{spid}')/2;
		    %    s_sp_prev(spid,1)=sigma_global_big(spid,1);
		    %    s_sp_prev(spid,2)=sigma_global_big(spid,2);
		    %    s_sp_prev(spid,3)=sigma_global_big(spid,4);
		    %end
			
			F_sp{spid} = (eye(2,2)+L_sp{spid}*dt)*F_sp{spid};
			%dESP{spid} = transpose(F_sp{spid})*dESP{spid}*F_sp{spid};
			%deltaF=L_sp{spid}*dt*F_sp{spid};
			J{spid} = det(F_sp{spid});
			A_sp(spid)=A_spo(spid)*J{spid};
			
			t_sp(spid)=t_spo(spid)*exp(e_t_global_big(spid,3));

			p_sp(spid) = m_sp(spid)/(A_sp(spid)*t_sp(spid));
			%ESP_now=1/2*(transpose(F_sp{spid})*F_sp{spid}-eye(2));
			%dESP{spid} = ESP_now-ESP_prev;
			%dESP{spid}=1/2*(deltaF*transpose(F_sp{spid})+F_sp{spid}*transpose(deltaF));
			%dESP{spid}=1/2*(deltaF+transpose(deltaF)+transpose(deltaF)*deltaF);
			
			%{
			dudx_sp(spid,1)=dudx_sp(spid,1)+L_sp{spid}(1,1)*dt;
			dudx_sp(spid,2)=dudx_sp(spid,2)+L_sp{spid}(1,2)*dt;
			dudx_sp(spid,3)=dudx_sp(spid,3)+L_sp{spid}(2,1)*dt;
			dudx_sp(spid,4)=dudx_sp(spid,4)+L_sp{spid}(2,2)*dt;
			%}
			
			
			dudx_matrix(:,:,spid)=eye(2)-(F_sp{spid}^(-1));
			dudx_sp(spid,1)=dudx_matrix(1,1,spid);
			dudx_sp(spid,2)=dudx_matrix(1,2,spid);
			dudx_sp(spid,3)=dudx_matrix(2,1,spid);
			dudx_sp(spid,4)=dudx_matrix(2,2,spid);
		end      
	end
	evaltimes=zeros(length(dESP),1);
	for i=1:length(Rdisplayedparticles)
		Rback=poldecomp(F_sp{Rdisplayedparticles(i)},0);
		R=transpose(Rback);
		Q=[cos(orientationoffset(Rdisplayedparticles(i))) sin(orientationoffset(Rdisplayedparticles(i))); -sin(orientationoffset(Rdisplayedparticles(i))) cos(orientationoffset(Rdisplayedparticles(i)))];
		%Qback=[cos(-orientationoffset(Rdisplayedparticles(i))) sin(-orientationoffset(Rdisplayedparticles(i))); -sin(-orientationoffset(Rdisplayedparticles(i))) cos(-orientationoffset(Rdisplayedparticles(i)))];
		RQ=R*Q;
		thetarotateall=asin(RQ(1,2));
		thetarotateoriginal=asin(Q(1,2));
		fprintf('%s',[PrintMatrixVectorized(RQ,['RQ{' float2txt(5,Rdisplayedparticles(i)) '}'],0) '; theta=' float2txt(5,thetarotateall*180/pi) ' deg; thetaoriginal=' float2txt(5,thetarotateoriginal*180/pi) ' deg' char(10)]);
	end
	
	f_final_vect=zeros(size(alphahp));
	surfacewithfmax=zeros(size(E_acc));
	sigma_local_big=zeros(size(sigma_global_big));
    AbeforeQ_rtl=zeros(2,2,2,2,length(dESP));
	
	if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==21 || CasetoRun==17 || CasetoRun==11 || CasetoRun==12 || CasetoRun==16 || CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44 || CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==15 || CasetoRun==14 || CasetoRun==5 || CasetoRun==6 || CasetoRun==10 || CasetoRun==64 || CasetoRun==66 || CasetoRun==69 || CasetoRun==67 || CasetoRun==68 || CasetoRun==71 || CasetoRun==72 || CasetoRun==73 || CasetoRun==74 || CasetoRun==78 || CasetoRun==81 || CasetoRun==79 || CasetoRun==80 || CasetoRun==82 || CasetoRun==83 || CasetoRun==84 || CasetoRun==88 || CasetoRun==98 || CasetoRun==100 || CasetoRun==101 || CasetoRun==109 || CasetoRun==105 || CasetoRun==102 || CasetoRun==106 || CasetoRun==107 || CasetoRun==103 || CasetoRun==104 || CasetoRun==108 || CasetoRun==114 || CasetoRun==111 || CasetoRun==115 || CasetoRun==116 || CasetoRun==119 || CasetoRun==137 || CasetoRun==122 || CasetoRun==121 || CasetoRun==120 || CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124 || CasetoRun==117 || CasetoRun==113 || CasetoRun==112 || CasetoRun==110 || CasetoRun==96 || CasetoRun==86 || CasetoRun==87 || CasetoRun==91 || CasetoRun==95 || CasetoRun==97 || CasetoRun==99 || CasetoRun==92 || CasetoRun==94 || CasetoRun==93 || CasetoRun==90 || CasetoRun==89 || CasetoRun==85 || CasetoRun==77 || CasetoRun==65 || CasetoRun==70
		if s_sp(3,1)<-5.95
			1;
		end
		
		switcherconfirmer=zeros(1,length(dESP));
		thetacrack=zeros(1,length(dESP));
		
		s_sp_store=s_sp;
		sigma_global_big_store=sigma_global_big;
		e_t_global_big_store=e_t_global_big;
		e_pl_global_big_store=e_pl_global_big;
		alphahp_store=alphahp;
		thetacrackrtl_store=thetacrackrtl;
		stackvars=zeros(length(dESP)+1,2);
		justcracked=zeros(length(dESP),1);
		Qacoustic=cell(1,spCount);
		Qacoustic{1}=zeros(2,2,36*1*1*1); %for debugging crashing coder purpose delete this later
		for i=1:spCount
			Qacoustic{i}=zeros(2,2,36*1*1*1); %ntestedangle is 36*1*1*1, see at 15638
		end
		h=cell(1,length(dESP));
		RQ=zeros(2,2,length(dESP));
		QbackRback=zeros(2,2,length(dESP));
%{
%switchable1
		try
			if Debugging.Active && CloseEnough(t_time,Debugging.Time,1e-5,2)
				asdf(-pi);
            end
			parforstarttime=clockallsec;
			parfor spid=1:length(dESP) %originally parfor
				[s_sp(spid,:),e_pl_sp(spid,:),sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:),f_final_vect(spid,:),surfacewithfmax(spid),sigma_local_big(spid,:),E_acc(spid),switcherconfirmer(spid),evaltimes(spid),stackvars(spid,:),duration(spid),thetacrackrtl(spid),thetacrack(spid),justcracked(spid),Qacoustic{spid},h{spid},RQ(:,:,spid),QbackRback(:,:,spid),AbeforeQ_rtl(:,:,:,:,spid)]= ... 
					Matmodel_parforred_confirmer(F_sp{spid},matmodel(spid),dESP{spid},s_sp(spid,:),E,nu,sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:),xdirletter{spid},ydirletter{spid},zdirletter{spid},xydirletter{spid},yzdirletter{spid},xzdirletter{spid},ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,Grt,Gtl,Grl,nurt,nutl,nurl,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit,CasetoRun,weakeningfactor_sp(spid),orientationoffset(spid),switcherconfirmer(spid),t_time,dt,spid,Debugging,parforstarttime,thetacrackrtl(spid),dudx_matrix(:,:,spid),Efactor_sp(spid));   
			end
		catch		
			s_sp=s_sp_store;
			sigma_global_big=sigma_global_big_store;
			e_t_global_big=e_t_global_big_store;
			e_pl_global_big=e_pl_global_big_store;
			alphahp=alphahp_store;
			thetacrackrtl=thetacrackrtl_store;
			
			fprintf('%s',['that parfor random error again!' char(10)]);
			printvector(switcherconfirmer,'switcherconfirmer');
			fprintf('%s',['# of done particles = ' int2txt(sum(switcherconfirmer)) char(10)]);
			switcherconfirmer=zeros(1,length(dESP));
			parforstarttime=clockallsec;
if CloseEnough(t_time,0.00073950997288745197975889933417193,1e-5,2)
    1;
end
%}
%switchable1

%[
%switchable1
		parforstarttime=0;
%]
%switchable1
            parfor spid=1:length(dESP) %used to be parfor
				[sse_sp(spid),s_sp(spid,:),e_pl_sp(spid,:),sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:),f_final_vect(spid,:),surfacewithfmax(spid),sigma_local_big(spid,:),E_acc(spid),switcherconfirmer(spid),evaltimes(spid),stackvars(spid,:),duration(spid),thetacrackrtl(spid),thetacrack(spid),justcracked(spid),Qacoustic{spid},h{spid},RQ(:,:,spid),QbackRback(:,:,spid),AbeforeQ_rtl(:,:,:,:,spid)]= ... 
					Matmodel_parforred_confirmer(F_sp{spid},matmodel(spid),dESP{spid},s_sp(spid,:),E,nu,sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:),xdirletter{spid},ydirletter{spid},zdirletter{spid},xydirletter{spid},yzdirletter{spid},xzdirletter{spid},ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,Grt,Gtl,Grl,nurt,nutl,nurl,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit,CasetoRun,weakeningfactor_sp(spid),orientationoffset(spid),switcherconfirmer(spid),t_time,dt,spid,Debugging,parforstarttime,thetacrackrtl(spid),dudx_matrix(:,:,spid),Efactor_sp(spid));
			end
			%tempmarker2
		
%{
%switchable1
			fprintf('%s',['regular for alternative successful!' char(10)]);
			printvector(switcherconfirmer,'switcherconfirmer');
			1;
		end
		stackvars(length(dESP)+1,2)=max(stackvars(:,1)+stackvars(:,2));
		stackvars(length(dESP)+1,1)=0;
if CloseEnough(t_time,0.00073950997288745197975889933417193,1e-5,2)
    1;
end	

		1==1;
		if 1==0
			h = barh(stackvars,'stacked');
			set(h,{'FaceColor'},{'w';'k'},'EdgeColor','none');
		end
%}
%switchable1
	elseif CasetoRun==4
		parfor spid=1:length(dESP)
			switch CModel
				case 'Neo_Hookean_Elastic'
					[s_sp(spid,:)]=Neo_Hookean_elastic(F_sp{spid},J{spid},E,nu);
				case 'Linear_Elastic'
					[s_sp(spid,:)]=Linear_elastic(dESP{spid},s_sp(spid,:),E,nu);
					f_final_vect(spid,:)=zeros(1,7);
					surfacewithfmax(spid)=0;
				case 'Mises'
					[s_sp(spid,:)]=Von_Mises(dESP{spid},s_sp(spid,:),E,nu,30);
				case 'Mises_Softening'
					[s_sp(spid,:),E_acc(spid),e_pl_sp(spid,:)]=Von_Mises_Softening(dESP{spid},s_sp(spid,:),E,nu,30,E_acc(spid),e_pl_sp(spid,:));
				case 'Wood_Schmidt5'
					[s_sp(spid,:),e_pl_sp(spid,:)]=Wood_Schmidt5(dESP{spid},s_sp(spid,:),e_pl_sp(spid,:));
					E_acc(spid)=0;
				case 'Wood_Schmidt15'
					[s_sp(spid,:),e_pl_sp(spid,:),sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:)]=Wood_Schmidt15_function(dESP{spid},sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:));
					E_acc(spid)=0;
				case 'Wood_Schmidt16'
					[s_sp(spid,:),e_pl_sp(spid,:),sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:)]=Wood_Schmidt16(dESP{spid},sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:));
					E_acc(spid)=0;
				case 'Wood_Schmidt17'
					[s_sp(spid,:),e_pl_sp(spid,: ),sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:),f_final_vect(spid,:),surfacewithfmax(spid),sigma_local_big(spid,:),AbeforeQ_rtl(:,:,:,:,spid)]= ...
						Wood_Schmidt17(dESP{spid},sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:),xdirletter{spid},ydirletter{spid},zdirletter{spid},xydirletter{spid},yzdirletter{spid},xzdirletter{spid},ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,Grt,Gtl,Grl,nurt,nutl,nurl,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit,CasetoRun);

					E_acc(spid)=0;
			end    
		end
	%elseif CasetoRun==5 || CasetoRun==6
	%    f_final_vect=zeros(size(alphahp));
	%    surfacewithfmax=zeros(size(E_acc));
	%    sigma_local_big=zeros(size(sigma_global_big));
	%    parfor spid=1:length(dESP) %originally parfor
	%        [s_sp(spid,:),e_pl_sp(spid,:),sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:),f_final_vect(spid,:),surfacewithfmax(spid),sigma_local_big(spid,:),E_acc(spid)]= ... 
	%            Matmodel_parforred(F_sp{spid},matmodel(spid),dESP{spid},s_sp(spid,:),E,nu,sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:),xdirletter{spid},ydirletter{spid},zdirletter{spid},xydirletter{spid},yzdirletter{spid},xzdirletter{spid},ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,Grt,Gtl,Grl,nurt,nutl,nurl,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit,CasetoRun,weakeningfactor_sp(spid),orientationoffset(spid));   
	%    end
	elseif CasetoRun==7
		if s_sp(3,1)<-5.95
			1;
		end
		f_final_vect=zeros(size(alphahp));
		surfacewithfmax=zeros(size(E_acc));
		sigma_local_big=zeros(size(sigma_global_big));
		parfor spid=1:length(dESP) %originally parfor
			[s_sp(spid,:),e_pl_sp(spid,:),sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:),f_final_vect(spid,:),surfacewithfmax(spid),sigma_local_big(spid,:),E_acc(spid),AbeforeQ_rtl(:,:,:,:,spid)]= ... 
				Matmodel_parforred(F_sp{spid},matmodel(spid),dESP{spid},s_sp(spid,:),E,nu,sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:),xdirletter{spid},ydirletter{spid},zdirletter{spid},xydirletter{spid},yzdirletter{spid},xzdirletter{spid},ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,Grt,Gtl,Grl,nurt,nutl,nurl,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit,CasetoRun,weakeningfactor_sp(spid),orientationoffset(spid));   
		end
	elseif CasetoRun==8 || CasetoRun==9
		f_final_vect=zeros(size(alphahp));
		surfacewithfmax=zeros(size(E_acc));
		sigma_local_big=zeros(size(sigma_global_big));
		parfor spid=1:length(dESP) %originally parfor
			[s_sp(spid,:),e_pl_sp(spid,:),sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:),f_final_vect(spid,:),surfacewithfmax(spid),sigma_local_big(spid,:),E_acc(spid),AbeforeQ_rtl(:,:,:,:,spid)]= ... 
				Matmodel_parforred(F_sp{spid},matmodel(spid),dESP{spid},s_sp(spid,:),E,nu,sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:),xdirletter{spid},ydirletter{spid},zdirletter{spid},xydirletter{spid},yzdirletter{spid},xzdirletter{spid},ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,Grt,Gtl,Grl,nurt,nutl,nurl,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit,CasetoRun,weakeningfactor_sp(spid),orientationoffset(spid));   
		end
	%{    
	elseif CasetoRun==10
		if s_sp(3,1)<-5.95
			1;
		end
		f_final_vect=zeros(size(alphahp));
		surfacewithfmax=zeros(size(E_acc));
		sigma_local_big=zeros(size(sigma_global_big));
		parfor spid=1:length(dESP) %originally parfor
			[s_sp(spid,:),e_pl_sp(spid,:),sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:),f_final_vect(spid,:),surfacewithfmax(spid),sigma_local_big(spid,:),E_acc(spid)]= ... 
				Matmodel_parforred(F_sp{spid},matmodel(spid),dESP{spid},s_sp(spid,:),E,nu,sigma_global_big(spid,:),e_t_global_big(spid,:),e_pl_global_big(spid,:),alphahp(spid,:),xdirletter{spid},ydirletter{spid},zdirletter{spid},xydirletter{spid},yzdirletter{spid},xzdirletter{spid},ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,Grt,Gtl,Grl,nurt,nutl,nurl,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit,CasetoRun,weakeningfactor_sp(spid),orientationoffset(spid));   
		end
		%}
	end
	for sp=1:spCount
		dW_sp=sum(sum([s_sp(sp,1) s_sp(sp,3);s_sp(sp,3) s_sp(sp,2)].*dESP{sp}));
		W_sp(sp)=W_sp(sp)+dW_sp;
	end
	%{
	for spid=1:length(dESP)
	%    if spid==troubleshotparticles(1) | spid==troubleshotparticles(2)
	%        if e_pl_sp(troubleshotparticles(1),1)<-1e-10 | e_pl_sp(troubleshotparticles(2),1)<-1e-10
	%            1;
	%        end
	%    end
		newSSP=(1/J{spid})*F_sp{spid}*[s_sp(spid,1) s_sp(spid,3);s_sp(spid,3) s_sp(spid,2)]*transpose(F_sp{spid});
		s_sp(spid,1)=newSSP(1,1);
		s_sp(spid,2)=newSSP(2,2);
		s_sp(spid,3)=newSSP(1,2);
	end
	%}
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [sse_sp,s_sp,e_pl_sp,sigma_global_big,e_t_global_big,e_pl_global_big,alphahp,f_final_vect,surfacewithfmax,sigma_local_big,E_acc,switcherconfirmer,evaltimes,stackvars,duration,thetacrackrtl,thetacrack,justcracked,Qacoustic,h,RQ,QbackRback,AbeforeQ_rtl]= ... 
    Matmodel_parforred_confirmer(F_sp,matmodel,dESP,s_sp,E,nu,sigma_global_big,e_t_global_big,e_pl_global_big,alphahp,xdirletter,ydirletter,zdirletter,xydirletter,yzdirletter,xzdirletter,ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,Grt,Gtl,Grl,nurt,nutl,nurl,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit,CasetoRun,weakeningfactor_sp,orientationoffset,switcherconfirmer,t_time,dt,spid,Debugging,parforstarttime,thetacrackrtl,dudx_matrix,Efactor_sp)
%{
%switchable1
    matmodelstarttime=clockallsec;
%}
%switchable1
    evaltimes=0;
	%s_sp=zeros(1,3);
	
	surfacewithfmax=zeros(1,1);
	surfacewithfmax(1)=0;
	thetacrack=NaN;
	justcracked=0;
	
	sse_sp=0;
	e_pl_sp=zeros(1,3);
	%e_t_global_big=zeros(1,6);
	%e_pl_global_big=zeros(1,6);
	%alphahp=zeros(1,7);
	sigma_local_big=zeros(1,6);
	E_acc=0;
	Qacoustic=[];
	h=[];
	stackvars=zeros(1,2);
	RQ=eye(2);
	QbackRback=eye(2);
	AbeforeQ_rtl=zeros(2,2,2,2,1);
    %sigma_global_big(1,:)=zeros(1,6);
    f_final_vect=zeros(1,7);
	duration=0;
	
	if CasetoRun==172 || CasetoRun==174
		%turned off for now %NOT
		E=E*Efactor_sp; %Efactor_sp is a scalar here
	end
	
    switch matmodel(1)
        case 1
			thetacrackrtl=NaN;
            Rback=poldecomp(F_sp,0);
            %Rback=eye(2);
            R=transpose(Rback);
            Q=[cos(orientationoffset) sin(orientationoffset); -sin(orientationoffset) cos(orientationoffset)];
            Qback=[cos(-orientationoffset) sin(-orientationoffset); -sin(-orientationoffset) cos(-orientationoffset)];
            RQ=R*Q;
            QbackRback=Qback*Rback;
            dESP=(RQ)*dESP*transpose(RQ);
			dudx_rtl=(RQ)*dudx_matrix*transpose(RQ);
            
            [s_sp(1,:),e_pl_sp(1,:),sigma_global_big(1,:),e_t_global_big(1,:),e_pl_global_big(1,:),alphahp(1,:),f_final_vect(1,:),surfacewithfmax(1),sigma_local_big(1,:),AbeforeQ_rtl(:,:,:,:,1),evaltimes,thetacrackrtl,justcracked,Qacoustic,h,~]= ... 
                Wood_Schmidt17(dESP,sigma_global_big(1,:),e_t_global_big(1,:),e_pl_global_big(1,:),alphahp(1,:),xdirletter,ydirletter,zdirletter,xydirletter,yzdirletter,xzdirletter,ftl*(1-weakeningfactor_sp),ftr*(1-weakeningfactor_sp),ftt*(1-weakeningfactor_sp),fcl*(1-weakeningfactor_sp),fcr*(1-weakeningfactor_sp),fct*(1-weakeningfactor_sp),fvrt*(1-weakeningfactor_sp),fvrl*(1-weakeningfactor_sp),fvtl*(1-weakeningfactor_sp),Er,Et,El,Grt,Gtl,Grl,nurt,nutl,nurl,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit,CasetoRun,t_time,dt,spid,Debugging,thetacrackrtl,dudx_rtl);
            %fprintf('%s',['s_sp(1,1)=' float2scitxt(6,s_sp(1,1)) char(10)]);
			thetacrack=real(thetacrackrtl+reliableatan(RQ(1,1),RQ(1,2)));
			thetacrack=mod(thetacrack+pi/2,pi)-pi/2;
            %dummy=input_codegen('This is Bogus Input, close console!');
            E_acc(1)=0;
            s_sp_mat_backrotated=(QbackRback)*[s_sp(1,1) s_sp(1,3);s_sp(1,3) s_sp(1,2)]*transpose(QbackRback);
            s_sp(1,1)=real(s_sp_mat_backrotated(1,1));
            s_sp(1,2)=real(s_sp_mat_backrotated(2,2));
            s_sp(1,3)=real(s_sp_mat_backrotated(1,2));
        case 2
            s_sp(1,1)=sigma_global_big(1,1);
            s_sp(1,2)=sigma_global_big(1,2);
            s_sp(1,3)=sigma_global_big(1,4);
            [s_sp(1,:)]=Linear_elastic(dESP,s_sp(1,:),E,nu);
			
			thetacrackrtl=NaN;
			thetacrack=NaN;
			justcracked=0;
			
            sigma_global_big(1,1)=s_sp(1,1);
            sigma_global_big(1,2)=s_sp(1,2);
            sigma_global_big(1,4)=s_sp(1,3);
            
        case 3
            thetacrackrtl=NaN;
            thetacrack=NaN;
            justcracked=0;
            s_sp(1,1)=sigma_global_big(1,1);
            s_sp(1,2)=sigma_global_big(1,2);
            s_sp(1,3)=sigma_global_big(1,4);
            %[s_sp(1,:)]=Linear_elastic_orthotropic(dESP,s_sp(1,:),1.5*Er*2,1.5*Er,1.5*Er,nu);
            if CasetoRun==55 || CasetoRun==56 || CasetoRun==57
                [s_sp(1,:)]=Linear_elastic_orthotropic_2(dESP,s_sp(1,:),10*Er,1.5*Er,El,Grt,Grl,Grl,nurt,nurl,nurl);
            elseif CasetoRun==58 || CasetoRun==59 || CasetoRun==60
                [s_sp(1,:)]=Linear_elastic_orthotropic_2(dESP,s_sp(1,:),200*Er,0.001*Er,El,Grt,Grl,Grl,nurt,nurl,nurl);
            elseif CasetoRun==61 || CasetoRun==62 || CasetoRun==63
                [s_sp(1,:)]=Linear_elastic_orthotropic_2(dESP,s_sp(1,:),1.5*Er,1.5*Er/(10^5),El,Grt,Grl,Grl,0,0,0);
            end
            %[s_sp(1,:)]=Linear_elastic(dESP,s_sp(1,:),1.5*Er,nu);
            sigma_global_big(1,1)=s_sp(1,1);
            sigma_global_big(1,2)=s_sp(1,2);
            sigma_global_big(1,4)=s_sp(1,3);
        case 4
			%Late Wood
            if spid==239 && CloseEnough(t_time,0.005842128785810849801729549568563,1e-5,2)
                1;
            end
            s_sp(1,1)=sigma_global_big(1,1);
            s_sp(1,2)=sigma_global_big(1,2);
            s_sp(1,3)=sigma_global_big(1,4);
            [sse_sp,s_sp(1,:)]=Linear_elastic_se(dESP,s_sp(1,:),E,nu);

			steelstrength=0.125;
			sigmamaxprinc=(s_sp(1,1)+s_sp(1,2))/2+sqrt( ((s_sp(1,1)-s_sp(1,2))/2)^2 + (s_sp(1,3))^2 );
			%{
			if sigmamaxprinc>steelstrength
				%disp(sigmamaxprinc);
			end
			%}
			if isnan(thetacrackrtl)
				sigmamaxprinc=(s_sp(1,1)+s_sp(1,2))/2+sqrt( ((s_sp(1,1)-s_sp(1,2))/2)^2 + (s_sp(1,3))^2 );
				%disp(sigmamaxprinc);
				if sigmamaxprinc>steelstrength
					%disp('just cracked!')
					thetacrackrtl=0.5*(pi-reliableatan((s_sp(1,1)-s_sp(1,2))/2,-s_sp(1,3)));
                    thetacrack=thetacrackrtl;
					justcracked=1;
				else
					thetacrack=NaN;
					justcracked=0;
				end
			else
				thetacrack=NaN;
				justcracked=0;
			end
            
            sigma_global_big(1,1)=s_sp(1,1);
            sigma_global_big(1,2)=s_sp(1,2);
            sigma_global_big(1,4)=s_sp(1,3);
        case 5
			%Early Wood
			%tempmarker6
			E_EW=40/1200*E;
            s_sp(1,1)=sigma_global_big(1,1);
            s_sp(1,2)=sigma_global_big(1,2);
            s_sp(1,3)=sigma_global_big(1,4);
            [s_sp(1,:)]=Linear_elastic(dESP,s_sp(1,:),E_EW,nu);

			steelstrength=0.125*sqrt(E_EW/E);
			sigmamaxprinc=(s_sp(1,1)+s_sp(1,2))/2+sqrt( ((s_sp(1,1)-s_sp(1,2))/2)^2 + (s_sp(1,3))^2 );
			%{
			if sigmamaxprinc>steelstrength
				%disp(sigmamaxprinc);
			end
			%}
			if isnan(thetacrackrtl)
				sigmamaxprinc=(s_sp(1,1)+s_sp(1,2))/2+sqrt( ((s_sp(1,1)-s_sp(1,2))/2)^2 + (s_sp(1,3))^2 );
				%disp(sigmamaxprinc);
				if sigmamaxprinc>steelstrength
					%disp('just cracked!')
					thetacrackrtl=0.5*(pi-reliableatan((s_sp(1,1)-s_sp(1,2))/2,-s_sp(1,3)));
                    thetacrack=thetacrackrtl;
					justcracked=1;
				else
					thetacrack=NaN;
					justcracked=0;
				end
			else
				thetacrack=NaN;
				justcracked=0;
			end
            
            sigma_global_big(1,1)=s_sp(1,1);
            sigma_global_big(1,2)=s_sp(1,2);
            sigma_global_big(1,4)=s_sp(1,3);
		case 6
			%hyperelastic
            [s_sp(1,:)]=Neo_Hookean_elastic(F_sp,E,nu);

			thetacrackrtl=NaN;
			thetacrack=NaN;
			justcracked=0;
			
            sigma_global_big(1,1)=s_sp(1,1);
            sigma_global_big(1,2)=s_sp(1,2);
            sigma_global_big(1,4)=s_sp(1,3);
    end
	switcherconfirmer=switcherconfirmer+1;
%{
%switchable1
    matmodelendtime=clockallsec;
    duration=matmodelendtime-matmodelstarttime;
    stackvars(1,1)=matmodelstarttime-parforstarttime;
    stackvars(1,2)=duration;
%}
%switchable1
	QbackRback=real(QbackRback);
	RQ=real(RQ);
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [s_sp,e_pl_sp,sigma_global_big,e_t_global_big,e_pl_global_big,alphahp,f_final_vect,surfacewithfmax,sigma_local_big,E_acc,AbeforeQ_rtl]= ... 
    Matmodel_parforred(F_sp,matmodel,dESP,s_sp,E,nu,sigma_global_big,e_t_global_big,e_pl_global_big,alphahp,xdirletter,ydirletter,zdirletter,xydirletter,yzdirletter,xzdirletter,ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,Grt,Gtl,Grl,nurt,nutl,nurl,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit,CasetoRun,weakeningfactor_sp,orientationoffset)
	% this function is probably INACTIVE
	e_pl_sp=zeros(1,3);
	e_t_global_big=zeros(1,6);
	e_pl_global_big=zeros(1,6);
	alphahp=zeros(1,7);
	sigma_local_big=zeros(1,6);
	E_acc=0;
	surfacewithfmax=zeros(1,1);
	surfacewithfmax(1)=0;
	f_final_vect=zeros(1,7);
	sigma_global_big(1,:)=zeros(1,6);
    sigma_local_big(1,:)=zeros(1,6);
	AbeforeQ_rtl=zeros(2,2,2,2,1);
	
    switch matmodel(1)
        case 1
            Rback=poldecomp(F_sp,0);
            R=transpose(Rback);
            Q=[cos(orientationoffset) sin(orientationoffset); -sin(orientationoffset) cos(orientationoffset)];
            Qback=[cos(-orientationoffset) sin(-orientationoffset); -sin(-orientationoffset) cos(-orientationoffset)];
            RQ=R*Q;
            QbackRback=Qback*Rback;
            dESP=(RQ)*dESP*transpose(RQ);
            [s_sp(1,:),e_pl_sp(1,:),sigma_global_big(1,:),e_t_global_big(1,:),e_pl_global_big(1,:),alphahp(1,:),f_final_vect(1,:),surfacewithfmax(1),sigma_local_big(1,:),AbeforeQ_rtl(:,:,:,:,1)]= ... 
                Wood_Schmidt17(dESP,sigma_global_big(1,:),e_t_global_big(1,:),e_pl_global_big(1,:),alphahp(1,:),xdirletter,ydirletter,zdirletter,xydirletter,yzdirletter,xzdirletter,ftl*(1-weakeningfactor_sp),ftr*(1-weakeningfactor_sp),ftt*(1-weakeningfactor_sp),fcl*(1-weakeningfactor_sp),fcr*(1-weakeningfactor_sp),fct*(1-weakeningfactor_sp),fvrt*(1-weakeningfactor_sp),fvrl*(1-weakeningfactor_sp),fvtl*(1-weakeningfactor_sp),Er,Et,El,Grt,Gtl,Grl,nurt,nutl,nurl,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit,CasetoRun);
            E_acc(1)=0;
            s_sp_mat_backrotated=(QbackRback)*[s_sp(1,1) s_sp(1,3);s_sp(1,3) s_sp(1,2)]*transpose(QbackRback);
            s_sp(1,1)=s_sp_mat_backrotated(1,1);
            s_sp(1,2)=s_sp_mat_backrotated(2,2);
            s_sp(1,3)=s_sp_mat_backrotated(1,2);
        case 2
            s_sp(1,1)=sigma_global_big(1,1);
            s_sp(1,2)=sigma_global_big(1,2);
            s_sp(1,3)=sigma_global_big(1,4);
            [s_sp(1,:)]=Linear_elastic(dESP,s_sp(1,:),E,nu);
            
            sigma_global_big(1,1)=s_sp(1,1);
            sigma_global_big(1,2)=s_sp(1,2);
            sigma_global_big(1,4)=s_sp(1,3);
            
    end    
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [f, dfdsigma, dfdq, d2fdsigma2, d2fdsigmadq, d2fdq2]=Wood_Schmidt_EvalSigmaEff(sigma,q,requestedfaces,requestedoutput,ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,CasetoRun)
requestedfacesarr=[0 0 0 0 0 0 0];
	for i=1:length(requestedfaces)
		requestedfacesarr(requestedfaces(i))=1;
	end
	%requestedoutput: f, dfdsigma, dfdq, d2fdsigma2, d2fdsigmadq, d2fdq2

	sigmarr=sigma(1);
	sigmatt=sigma(2);
	sigmall=sigma(3);
	sigmart=sigma(4);
	sigmatl=sigma(5);
	sigmarl=sigma(6);

	q1=q(1);
	q2=q(2);
	q3=q(3);
	q4=q(4);
	q5=q(5);
	q6=q(6);
	q7=q(7);

	if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==21
		%q7=0;
	elseif CasetoRun==4
		%q1=-1e99;
		%q2=-1e99;
		q3=-1e99;
		q4=-1e99;
		%q5=-1e99;
		%q6=-1e99;
		q7=-1e99;
	elseif CasetoRun==5 || CasetoRun==6
	elseif CasetoRun==7
	elseif CasetoRun==8 || CasetoRun==9
	elseif CasetoRun==10
	elseif CasetoRun==11
	elseif CasetoRun==12 || CasetoRun==16 || CasetoRun==18 || CasetoRun==23 || CasetoRun==38 || CasetoRun==51 || CasetoRun==53 || CasetoRun==50 || CasetoRun==49 || CasetoRun==47 || CasetoRun==46 || CasetoRun==41 || CasetoRun==43 || CasetoRun==44
		%q7=0;
		% direct elastic plastic revoked, parameter adjustment chosen instead
	elseif CasetoRun==13 || CasetoRun==20 || CasetoRun==25 || CasetoRun==57 || CasetoRun==58 || CasetoRun==61 || CasetoRun==32 || CasetoRun==55 || CasetoRun==59 || CasetoRun==62 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63 || CasetoRun==35 || CasetoRun==36 || CasetoRun==37 || CasetoRun==15 || CasetoRun==14
		%q7=0; %note perfect shear plasticity unlike CasetoRun==11
		% direct elastic plastic revoked, parameter adjustment chosen instead
	elseif CasetoRun==17
		q7=0;
	elseif CasetoRun==77
		q1=-1e99;
		q2=-1e99;
		q3=-1e99;
		q4=-1e99;
		q5=-1e99;
		q6=-1e99;
		q7=-1e99;
	end
	
	nsurface=7; %use nsurface instead of the number 7 to satisfy coder whining
	nstressvect=6; %just to be with inline with nsurface
	
	f=cell(1,nsurface);
	dfdsigma=cell(1,nsurface);
	dfdq=cell(1,nsurface);
	d2fdsigma2=cell(1,nsurface);
	d2fdsigmadq=cell(1,nsurface);
	d2fdq2=cell(1,nsurface);
	for i=1:nsurface
		f{i}=0;
		dfdsigma{i}=zeros(nstressvect,1);
		dfdq{i}=zeros(nsurface,1);
		d2fdsigma2{i}=zeros(nstressvect,nstressvect);
		d2fdsigmadq{i}=zeros(nstressvect,nsurface);
		d2fdq2{i}=zeros(nsurface,nsurface);
	end
	
	
	% start sym paste, paste here!
	if requestedfacesarr(1)==1
		if requestedoutput(1)==1
			f{1}=0+q1 + sigmarr/ftr + sigmatt^2/(2*fct^2) + (33*sigmarl^2)/(100*fvrl^2) + sigmart^2/(2*fvrt^2) + (33*sigmatl^2)/(100*fvtl^2) - sigmall^2/(4*fcl*ftl) - 1;
		else
			f{1}=[0];
		end
		if requestedoutput(2)==1
			dfdsigma{1}(1,1)=1/ftr;
			dfdsigma{1}(2,1)=sigmatt/fct^2;
			dfdsigma{1}(3,1)=-sigmall/(2*fcl*ftl);
			dfdsigma{1}(4,1)=sigmart/fvrt^2;
			dfdsigma{1}(5,1)=(33*sigmatl)/(50*fvtl^2);
			dfdsigma{1}(6,1)=(33*sigmarl)/(50*fvrl^2);
		else
			dfdsigma{1}(1,1)=[0];
		end
		if requestedoutput(3)==1
			dfdq{1}(1,1)=1;
			dfdq{1}(2,1)=0;
			dfdq{1}(3,1)=0;
			dfdq{1}(4,1)=0;
			dfdq{1}(5,1)=0;
			dfdq{1}(6,1)=0;
			dfdq{1}(7,1)=0;
		else
			dfdq{1}(1,1)=[0];
		end
		if requestedoutput(4)==1
			d2fdsigma2{1}(1,1)=0;
			d2fdsigma2{1}(1,2)=0;
			d2fdsigma2{1}(1,3)=0;
			d2fdsigma2{1}(1,4)=0;
			d2fdsigma2{1}(1,5)=0;
			d2fdsigma2{1}(1,6)=0;
			d2fdsigma2{1}(2,1)=0;
			d2fdsigma2{1}(2,2)=1/fct^2;
			d2fdsigma2{1}(2,3)=0;
			d2fdsigma2{1}(2,4)=0;
			d2fdsigma2{1}(2,5)=0;
			d2fdsigma2{1}(2,6)=0;
			d2fdsigma2{1}(3,1)=0;
			d2fdsigma2{1}(3,2)=0;
			d2fdsigma2{1}(3,3)=-1/(2*fcl*ftl);
			d2fdsigma2{1}(3,4)=0;
			d2fdsigma2{1}(3,5)=0;
			d2fdsigma2{1}(3,6)=0;
			d2fdsigma2{1}(4,1)=0;
			d2fdsigma2{1}(4,2)=0;
			d2fdsigma2{1}(4,3)=0;
			d2fdsigma2{1}(4,4)=1/fvrt^2;
			d2fdsigma2{1}(4,5)=0;
			d2fdsigma2{1}(4,6)=0;
			d2fdsigma2{1}(5,1)=0;
			d2fdsigma2{1}(5,2)=0;
			d2fdsigma2{1}(5,3)=0;
			d2fdsigma2{1}(5,4)=0;
			d2fdsigma2{1}(5,5)=33/(50*fvtl^2);
			d2fdsigma2{1}(5,6)=0;
			d2fdsigma2{1}(6,1)=0;
			d2fdsigma2{1}(6,2)=0;
			d2fdsigma2{1}(6,3)=0;
			d2fdsigma2{1}(6,4)=0;
			d2fdsigma2{1}(6,5)=0;
			d2fdsigma2{1}(6,6)=33/(50*fvrl^2);
		else
			d2fdsigma2{1}(1,1)=[0];
		end
		if requestedoutput(5)==1
			d2fdsigmadq{1}(1,1)=0;
			d2fdsigmadq{1}(1,2)=0;
			d2fdsigmadq{1}(1,3)=0;
			d2fdsigmadq{1}(1,4)=0;
			d2fdsigmadq{1}(1,5)=0;
			d2fdsigmadq{1}(1,6)=0;
			d2fdsigmadq{1}(1,7)=0;
			d2fdsigmadq{1}(2,1)=0;
			d2fdsigmadq{1}(2,2)=0;
			d2fdsigmadq{1}(2,3)=0;
			d2fdsigmadq{1}(2,4)=0;
			d2fdsigmadq{1}(2,5)=0;
			d2fdsigmadq{1}(2,6)=0;
			d2fdsigmadq{1}(2,7)=0;
			d2fdsigmadq{1}(3,1)=0;
			d2fdsigmadq{1}(3,2)=0;
			d2fdsigmadq{1}(3,3)=0;
			d2fdsigmadq{1}(3,4)=0;
			d2fdsigmadq{1}(3,5)=0;
			d2fdsigmadq{1}(3,6)=0;
			d2fdsigmadq{1}(3,7)=0;
			d2fdsigmadq{1}(4,1)=0;
			d2fdsigmadq{1}(4,2)=0;
			d2fdsigmadq{1}(4,3)=0;
			d2fdsigmadq{1}(4,4)=0;
			d2fdsigmadq{1}(4,5)=0;
			d2fdsigmadq{1}(4,6)=0;
			d2fdsigmadq{1}(4,7)=0;
			d2fdsigmadq{1}(5,1)=0;
			d2fdsigmadq{1}(5,2)=0;
			d2fdsigmadq{1}(5,3)=0;
			d2fdsigmadq{1}(5,4)=0;
			d2fdsigmadq{1}(5,5)=0;
			d2fdsigmadq{1}(5,6)=0;
			d2fdsigmadq{1}(5,7)=0;
			d2fdsigmadq{1}(6,1)=0;
			d2fdsigmadq{1}(6,2)=0;
			d2fdsigmadq{1}(6,3)=0;
			d2fdsigmadq{1}(6,4)=0;
			d2fdsigmadq{1}(6,5)=0;
			d2fdsigmadq{1}(6,6)=0;
			d2fdsigmadq{1}(6,7)=0;
		else
			d2fdsigmadq{1}(1,1)=[0];
		end
		if requestedoutput(6)==1
			d2fdq2{1}(1,1)=0;
			d2fdq2{1}(1,2)=0;
			d2fdq2{1}(1,3)=0;
			d2fdq2{1}(1,4)=0;
			d2fdq2{1}(1,5)=0;
			d2fdq2{1}(1,6)=0;
			d2fdq2{1}(1,7)=0;
			d2fdq2{1}(2,1)=0;
			d2fdq2{1}(2,2)=0;
			d2fdq2{1}(2,3)=0;
			d2fdq2{1}(2,4)=0;
			d2fdq2{1}(2,5)=0;
			d2fdq2{1}(2,6)=0;
			d2fdq2{1}(2,7)=0;
			d2fdq2{1}(3,1)=0;
			d2fdq2{1}(3,2)=0;
			d2fdq2{1}(3,3)=0;
			d2fdq2{1}(3,4)=0;
			d2fdq2{1}(3,5)=0;
			d2fdq2{1}(3,6)=0;
			d2fdq2{1}(3,7)=0;
			d2fdq2{1}(4,1)=0;
			d2fdq2{1}(4,2)=0;
			d2fdq2{1}(4,3)=0;
			d2fdq2{1}(4,4)=0;
			d2fdq2{1}(4,5)=0;
			d2fdq2{1}(4,6)=0;
			d2fdq2{1}(4,7)=0;
			d2fdq2{1}(5,1)=0;
			d2fdq2{1}(5,2)=0;
			d2fdq2{1}(5,3)=0;
			d2fdq2{1}(5,4)=0;
			d2fdq2{1}(5,5)=0;
			d2fdq2{1}(5,6)=0;
			d2fdq2{1}(5,7)=0;
			d2fdq2{1}(6,1)=0;
			d2fdq2{1}(6,2)=0;
			d2fdq2{1}(6,3)=0;
			d2fdq2{1}(6,4)=0;
			d2fdq2{1}(6,5)=0;
			d2fdq2{1}(6,6)=0;
			d2fdq2{1}(6,7)=0;
			d2fdq2{1}(7,1)=0;
			d2fdq2{1}(7,2)=0;
			d2fdq2{1}(7,3)=0;
			d2fdq2{1}(7,4)=0;
			d2fdq2{1}(7,5)=0;
			d2fdq2{1}(7,6)=0;
			d2fdq2{1}(7,7)=0;
		else
			d2fdq2{1}(1)=[0];
		end
		%{
		if requestedoutput(7)==1
		dfdinput{1}(1,1)=sigmall^2/(4*fcl*ftl^2);
		dfdinput{1}(2,1)=-sigmarr/ftr^2;
		dfdinput{1}(3,1)=0;
		dfdinput{1}(4,1)=sigmall^2/(4*fcl^2*ftl);
		dfdinput{1}(5,1)=0;
		dfdinput{1}(6,1)=-sigmatt^2/fct^3;
		dfdinput{1}(7,1)=-sigmart^2/fvrt^3;
		dfdinput{1}(8,1)=-(33*sigmarl^2)/(50*fvrl^3);
		dfdinput{1}(9,1)=-(33*sigmatl^2)/(50*fvtl^3);
		else
		dfdinput{1}(1,1)=[0];
		end
		%}
	end
	if requestedfacesarr(2)==1
		if requestedoutput(1)==1
			f{2}=0+q2 + sigmarr/fcr + (2*sigmatt^2)/(5*fct^2) + (33*sigmarl^2)/(100*fvrl^2) + (2*sigmart^2)/(5*fvrt^2) + (33*sigmatl^2)/(100*fvtl^2) - sigmall^2/(4*fcl*ftl) - 1;
		else
			f{2}=[0];
		end
		if requestedoutput(2)==1
			dfdsigma{2}(1,1)=1/fcr;
			dfdsigma{2}(2,1)=(4*sigmatt)/(5*fct^2);
			dfdsigma{2}(3,1)=-sigmall/(2*fcl*ftl);
			dfdsigma{2}(4,1)=(4*sigmart)/(5*fvrt^2);
			dfdsigma{2}(5,1)=(33*sigmatl)/(50*fvtl^2);
			dfdsigma{2}(6,1)=(33*sigmarl)/(50*fvrl^2);
		else
			dfdsigma{2}(1,1)=[0];
		end
		if requestedoutput(3)==1
			dfdq{2}(1,1)=0;
			dfdq{2}(2,1)=1;
			dfdq{2}(3,1)=0;
			dfdq{2}(4,1)=0;
			dfdq{2}(5,1)=0;
			dfdq{2}(6,1)=0;
			dfdq{2}(7,1)=0;
		else
			dfdq{2}(1,1)=[0];
		end
		if requestedoutput(4)==1
			d2fdsigma2{2}(1,1)=0;
			d2fdsigma2{2}(1,2)=0;
			d2fdsigma2{2}(1,3)=0;
			d2fdsigma2{2}(1,4)=0;
			d2fdsigma2{2}(1,5)=0;
			d2fdsigma2{2}(1,6)=0;
			d2fdsigma2{2}(2,1)=0;
			d2fdsigma2{2}(2,2)=4/(5*fct^2);
			d2fdsigma2{2}(2,3)=0;
			d2fdsigma2{2}(2,4)=0;
			d2fdsigma2{2}(2,5)=0;
			d2fdsigma2{2}(2,6)=0;
			d2fdsigma2{2}(3,1)=0;
			d2fdsigma2{2}(3,2)=0;
			d2fdsigma2{2}(3,3)=-1/(2*fcl*ftl);
			d2fdsigma2{2}(3,4)=0;
			d2fdsigma2{2}(3,5)=0;
			d2fdsigma2{2}(3,6)=0;
			d2fdsigma2{2}(4,1)=0;
			d2fdsigma2{2}(4,2)=0;
			d2fdsigma2{2}(4,3)=0;
			d2fdsigma2{2}(4,4)=4/(5*fvrt^2);
			d2fdsigma2{2}(4,5)=0;
			d2fdsigma2{2}(4,6)=0;
			d2fdsigma2{2}(5,1)=0;
			d2fdsigma2{2}(5,2)=0;
			d2fdsigma2{2}(5,3)=0;
			d2fdsigma2{2}(5,4)=0;
			d2fdsigma2{2}(5,5)=33/(50*fvtl^2);
			d2fdsigma2{2}(5,6)=0;
			d2fdsigma2{2}(6,1)=0;
			d2fdsigma2{2}(6,2)=0;
			d2fdsigma2{2}(6,3)=0;
			d2fdsigma2{2}(6,4)=0;
			d2fdsigma2{2}(6,5)=0;
			d2fdsigma2{2}(6,6)=33/(50*fvrl^2);
		else
			d2fdsigma2{2}(1,1)=[0];
		end
		if requestedoutput(5)==1
			d2fdsigmadq{2}(1,1)=0;
			d2fdsigmadq{2}(1,2)=0;
			d2fdsigmadq{2}(1,3)=0;
			d2fdsigmadq{2}(1,4)=0;
			d2fdsigmadq{2}(1,5)=0;
			d2fdsigmadq{2}(1,6)=0;
			d2fdsigmadq{2}(1,7)=0;
			d2fdsigmadq{2}(2,1)=0;
			d2fdsigmadq{2}(2,2)=0;
			d2fdsigmadq{2}(2,3)=0;
			d2fdsigmadq{2}(2,4)=0;
			d2fdsigmadq{2}(2,5)=0;
			d2fdsigmadq{2}(2,6)=0;
			d2fdsigmadq{2}(2,7)=0;
			d2fdsigmadq{2}(3,1)=0;
			d2fdsigmadq{2}(3,2)=0;
			d2fdsigmadq{2}(3,3)=0;
			d2fdsigmadq{2}(3,4)=0;
			d2fdsigmadq{2}(3,5)=0;
			d2fdsigmadq{2}(3,6)=0;
			d2fdsigmadq{2}(3,7)=0;
			d2fdsigmadq{2}(4,1)=0;
			d2fdsigmadq{2}(4,2)=0;
			d2fdsigmadq{2}(4,3)=0;
			d2fdsigmadq{2}(4,4)=0;
			d2fdsigmadq{2}(4,5)=0;
			d2fdsigmadq{2}(4,6)=0;
			d2fdsigmadq{2}(4,7)=0;
			d2fdsigmadq{2}(5,1)=0;
			d2fdsigmadq{2}(5,2)=0;
			d2fdsigmadq{2}(5,3)=0;
			d2fdsigmadq{2}(5,4)=0;
			d2fdsigmadq{2}(5,5)=0;
			d2fdsigmadq{2}(5,6)=0;
			d2fdsigmadq{2}(5,7)=0;
			d2fdsigmadq{2}(6,1)=0;
			d2fdsigmadq{2}(6,2)=0;
			d2fdsigmadq{2}(6,3)=0;
			d2fdsigmadq{2}(6,4)=0;
			d2fdsigmadq{2}(6,5)=0;
			d2fdsigmadq{2}(6,6)=0;
			d2fdsigmadq{2}(6,7)=0;
		else
			d2fdsigmadq{2}(1,1)=[0];
		end
		if requestedoutput(6)==1
			d2fdq2{2}(1,1)=0;
			d2fdq2{2}(1,2)=0;
			d2fdq2{2}(1,3)=0;
			d2fdq2{2}(1,4)=0;
			d2fdq2{2}(1,5)=0;
			d2fdq2{2}(1,6)=0;
			d2fdq2{2}(1,7)=0;
			d2fdq2{2}(2,1)=0;
			d2fdq2{2}(2,2)=0;
			d2fdq2{2}(2,3)=0;
			d2fdq2{2}(2,4)=0;
			d2fdq2{2}(2,5)=0;
			d2fdq2{2}(2,6)=0;
			d2fdq2{2}(2,7)=0;
			d2fdq2{2}(3,1)=0;
			d2fdq2{2}(3,2)=0;
			d2fdq2{2}(3,3)=0;
			d2fdq2{2}(3,4)=0;
			d2fdq2{2}(3,5)=0;
			d2fdq2{2}(3,6)=0;
			d2fdq2{2}(3,7)=0;
			d2fdq2{2}(4,1)=0;
			d2fdq2{2}(4,2)=0;
			d2fdq2{2}(4,3)=0;
			d2fdq2{2}(4,4)=0;
			d2fdq2{2}(4,5)=0;
			d2fdq2{2}(4,6)=0;
			d2fdq2{2}(4,7)=0;
			d2fdq2{2}(5,1)=0;
			d2fdq2{2}(5,2)=0;
			d2fdq2{2}(5,3)=0;
			d2fdq2{2}(5,4)=0;
			d2fdq2{2}(5,5)=0;
			d2fdq2{2}(5,6)=0;
			d2fdq2{2}(5,7)=0;
			d2fdq2{2}(6,1)=0;
			d2fdq2{2}(6,2)=0;
			d2fdq2{2}(6,3)=0;
			d2fdq2{2}(6,4)=0;
			d2fdq2{2}(6,5)=0;
			d2fdq2{2}(6,6)=0;
			d2fdq2{2}(6,7)=0;
			d2fdq2{2}(7,1)=0;
			d2fdq2{2}(7,2)=0;
			d2fdq2{2}(7,3)=0;
			d2fdq2{2}(7,4)=0;
			d2fdq2{2}(7,5)=0;
			d2fdq2{2}(7,6)=0;
			d2fdq2{2}(7,7)=0;
		else
			d2fdq2{2}(1)=[0];
		end
		%{
		if requestedoutput(7)==1
		dfdinput{2}(1,1)=sigmall^2/(4*fcl*ftl^2);
		dfdinput{2}(2,1)=0;
		dfdinput{2}(3,1)=0;
		dfdinput{2}(4,1)=sigmall^2/(4*fcl^2*ftl);
		dfdinput{2}(5,1)=-sigmarr/fcr^2;
		dfdinput{2}(6,1)=-(4*sigmatt^2)/(5*fct^3);
		dfdinput{2}(7,1)=-(4*sigmart^2)/(5*fvrt^3);
		dfdinput{2}(8,1)=-(33*sigmarl^2)/(50*fvrl^3);
		dfdinput{2}(9,1)=-(33*sigmatl^2)/(50*fvtl^3);
		else
		dfdinput{2}(1,1)=[0];
		end
		%}
	end
	if requestedfacesarr(3)==1
		if requestedoutput(1)==1
			f{3}=0+q3 + sigmatt/ftt + sigmarr^2/(2*fcr^2) + (33*sigmarl^2)/(100*fvrl^2) + (2*sigmart^2)/(5*fvrt^2) + (33*sigmatl^2)/(100*fvtl^2) - sigmall^2/(4*fcl*ftl) - 1;
		else
			f{3}=[0];
		end
		if requestedoutput(2)==1
			dfdsigma{3}(1,1)=sigmarr/fcr^2;
			dfdsigma{3}(2,1)=1/ftt;
			dfdsigma{3}(3,1)=-sigmall/(2*fcl*ftl);
			dfdsigma{3}(4,1)=(4*sigmart)/(5*fvrt^2);
			dfdsigma{3}(5,1)=(33*sigmatl)/(50*fvtl^2);
			dfdsigma{3}(6,1)=(33*sigmarl)/(50*fvrl^2);
		else
			dfdsigma{3}(1,1)=[0];
		end
		if requestedoutput(3)==1
			dfdq{3}(1,1)=0;
			dfdq{3}(2,1)=0;
			dfdq{3}(3,1)=1;
			dfdq{3}(4,1)=0;
			dfdq{3}(5,1)=0;
			dfdq{3}(6,1)=0;
			dfdq{3}(7,1)=0;
		else
			dfdq{3}(1,1)=[0];
		end
		if requestedoutput(4)==1
			d2fdsigma2{3}(1,1)=1/fcr^2;
			d2fdsigma2{3}(1,2)=0;
			d2fdsigma2{3}(1,3)=0;
			d2fdsigma2{3}(1,4)=0;
			d2fdsigma2{3}(1,5)=0;
			d2fdsigma2{3}(1,6)=0;
			d2fdsigma2{3}(2,1)=0;
			d2fdsigma2{3}(2,2)=0;
			d2fdsigma2{3}(2,3)=0;
			d2fdsigma2{3}(2,4)=0;
			d2fdsigma2{3}(2,5)=0;
			d2fdsigma2{3}(2,6)=0;
			d2fdsigma2{3}(3,1)=0;
			d2fdsigma2{3}(3,2)=0;
			d2fdsigma2{3}(3,3)=-1/(2*fcl*ftl);
			d2fdsigma2{3}(3,4)=0;
			d2fdsigma2{3}(3,5)=0;
			d2fdsigma2{3}(3,6)=0;
			d2fdsigma2{3}(4,1)=0;
			d2fdsigma2{3}(4,2)=0;
			d2fdsigma2{3}(4,3)=0;
			d2fdsigma2{3}(4,4)=4/(5*fvrt^2);
			d2fdsigma2{3}(4,5)=0;
			d2fdsigma2{3}(4,6)=0;
			d2fdsigma2{3}(5,1)=0;
			d2fdsigma2{3}(5,2)=0;
			d2fdsigma2{3}(5,3)=0;
			d2fdsigma2{3}(5,4)=0;
			d2fdsigma2{3}(5,5)=33/(50*fvtl^2);
			d2fdsigma2{3}(5,6)=0;
			d2fdsigma2{3}(6,1)=0;
			d2fdsigma2{3}(6,2)=0;
			d2fdsigma2{3}(6,3)=0;
			d2fdsigma2{3}(6,4)=0;
			d2fdsigma2{3}(6,5)=0;
			d2fdsigma2{3}(6,6)=33/(50*fvrl^2);
		else
			d2fdsigma2{3}(1,1)=[0];
		end
		if requestedoutput(5)==1
			d2fdsigmadq{3}(1,1)=0;
			d2fdsigmadq{3}(1,2)=0;
			d2fdsigmadq{3}(1,3)=0;
			d2fdsigmadq{3}(1,4)=0;
			d2fdsigmadq{3}(1,5)=0;
			d2fdsigmadq{3}(1,6)=0;
			d2fdsigmadq{3}(1,7)=0;
			d2fdsigmadq{3}(2,1)=0;
			d2fdsigmadq{3}(2,2)=0;
			d2fdsigmadq{3}(2,3)=0;
			d2fdsigmadq{3}(2,4)=0;
			d2fdsigmadq{3}(2,5)=0;
			d2fdsigmadq{3}(2,6)=0;
			d2fdsigmadq{3}(2,7)=0;
			d2fdsigmadq{3}(3,1)=0;
			d2fdsigmadq{3}(3,2)=0;
			d2fdsigmadq{3}(3,3)=0;
			d2fdsigmadq{3}(3,4)=0;
			d2fdsigmadq{3}(3,5)=0;
			d2fdsigmadq{3}(3,6)=0;
			d2fdsigmadq{3}(3,7)=0;
			d2fdsigmadq{3}(4,1)=0;
			d2fdsigmadq{3}(4,2)=0;
			d2fdsigmadq{3}(4,3)=0;
			d2fdsigmadq{3}(4,4)=0;
			d2fdsigmadq{3}(4,5)=0;
			d2fdsigmadq{3}(4,6)=0;
			d2fdsigmadq{3}(4,7)=0;
			d2fdsigmadq{3}(5,1)=0;
			d2fdsigmadq{3}(5,2)=0;
			d2fdsigmadq{3}(5,3)=0;
			d2fdsigmadq{3}(5,4)=0;
			d2fdsigmadq{3}(5,5)=0;
			d2fdsigmadq{3}(5,6)=0;
			d2fdsigmadq{3}(5,7)=0;
			d2fdsigmadq{3}(6,1)=0;
			d2fdsigmadq{3}(6,2)=0;
			d2fdsigmadq{3}(6,3)=0;
			d2fdsigmadq{3}(6,4)=0;
			d2fdsigmadq{3}(6,5)=0;
			d2fdsigmadq{3}(6,6)=0;
			d2fdsigmadq{3}(6,7)=0;
		else
			d2fdsigmadq{3}(1,1)=[0];
		end
		if requestedoutput(6)==1
			d2fdq2{3}(1,1)=0;
			d2fdq2{3}(1,2)=0;
			d2fdq2{3}(1,3)=0;
			d2fdq2{3}(1,4)=0;
			d2fdq2{3}(1,5)=0;
			d2fdq2{3}(1,6)=0;
			d2fdq2{3}(1,7)=0;
			d2fdq2{3}(2,1)=0;
			d2fdq2{3}(2,2)=0;
			d2fdq2{3}(2,3)=0;
			d2fdq2{3}(2,4)=0;
			d2fdq2{3}(2,5)=0;
			d2fdq2{3}(2,6)=0;
			d2fdq2{3}(2,7)=0;
			d2fdq2{3}(3,1)=0;
			d2fdq2{3}(3,2)=0;
			d2fdq2{3}(3,3)=0;
			d2fdq2{3}(3,4)=0;
			d2fdq2{3}(3,5)=0;
			d2fdq2{3}(3,6)=0;
			d2fdq2{3}(3,7)=0;
			d2fdq2{3}(4,1)=0;
			d2fdq2{3}(4,2)=0;
			d2fdq2{3}(4,3)=0;
			d2fdq2{3}(4,4)=0;
			d2fdq2{3}(4,5)=0;
			d2fdq2{3}(4,6)=0;
			d2fdq2{3}(4,7)=0;
			d2fdq2{3}(5,1)=0;
			d2fdq2{3}(5,2)=0;
			d2fdq2{3}(5,3)=0;
			d2fdq2{3}(5,4)=0;
			d2fdq2{3}(5,5)=0;
			d2fdq2{3}(5,6)=0;
			d2fdq2{3}(5,7)=0;
			d2fdq2{3}(6,1)=0;
			d2fdq2{3}(6,2)=0;
			d2fdq2{3}(6,3)=0;
			d2fdq2{3}(6,4)=0;
			d2fdq2{3}(6,5)=0;
			d2fdq2{3}(6,6)=0;
			d2fdq2{3}(6,7)=0;
			d2fdq2{3}(7,1)=0;
			d2fdq2{3}(7,2)=0;
			d2fdq2{3}(7,3)=0;
			d2fdq2{3}(7,4)=0;
			d2fdq2{3}(7,5)=0;
			d2fdq2{3}(7,6)=0;
			d2fdq2{3}(7,7)=0;
		else
			d2fdq2{3}(1)=[0];
		end
		%{
		if requestedoutput(7)==1
		dfdinput{3}(1,1)=sigmall^2/(4*fcl*ftl^2);
		dfdinput{3}(2,1)=0;
		dfdinput{3}(3,1)=-sigmatt/ftt^2;
		dfdinput{3}(4,1)=sigmall^2/(4*fcl^2*ftl);
		dfdinput{3}(5,1)=-sigmarr^2/fcr^3;
		dfdinput{3}(6,1)=0;
		dfdinput{3}(7,1)=-(4*sigmart^2)/(5*fvrt^3);
		dfdinput{3}(8,1)=-(33*sigmarl^2)/(50*fvrl^3);
		dfdinput{3}(9,1)=-(33*sigmatl^2)/(50*fvtl^3);
		else
		dfdinput{3}(1,1)=[0];
		end
		%}
	end
	if requestedfacesarr(4)==1
		if requestedoutput(1)==1
			f{4}=0+q4 + sigmatt/fct + (2*sigmarr^2)/(5*fcr^2) + (33*sigmarl^2)/(100*fvrl^2) + (2*sigmart^2)/(5*fvrt^2) + (33*sigmatl^2)/(100*fvtl^2) - sigmall^2/(4*fcl*ftl) - 1;
		else
			f{4}=[0];
		end
		if requestedoutput(2)==1
			dfdsigma{4}(1,1)=(4*sigmarr)/(5*fcr^2);
			dfdsigma{4}(2,1)=1/fct;
			dfdsigma{4}(3,1)=-sigmall/(2*fcl*ftl);
			dfdsigma{4}(4,1)=(4*sigmart)/(5*fvrt^2);
			dfdsigma{4}(5,1)=(33*sigmatl)/(50*fvtl^2);
			dfdsigma{4}(6,1)=(33*sigmarl)/(50*fvrl^2);
		else
			dfdsigma{4}(1,1)=[0];
		end
		if requestedoutput(3)==1
			dfdq{4}(1,1)=0;
			dfdq{4}(2,1)=0;
			dfdq{4}(3,1)=0;
			dfdq{4}(4,1)=1;
			dfdq{4}(5,1)=0;
			dfdq{4}(6,1)=0;
			dfdq{4}(7,1)=0;
		else
			dfdq{4}(1,1)=[0];
		end
		if requestedoutput(4)==1
			d2fdsigma2{4}(1,1)=4/(5*fcr^2);
			d2fdsigma2{4}(1,2)=0;
			d2fdsigma2{4}(1,3)=0;
			d2fdsigma2{4}(1,4)=0;
			d2fdsigma2{4}(1,5)=0;
			d2fdsigma2{4}(1,6)=0;
			d2fdsigma2{4}(2,1)=0;
			d2fdsigma2{4}(2,2)=0;
			d2fdsigma2{4}(2,3)=0;
			d2fdsigma2{4}(2,4)=0;
			d2fdsigma2{4}(2,5)=0;
			d2fdsigma2{4}(2,6)=0;
			d2fdsigma2{4}(3,1)=0;
			d2fdsigma2{4}(3,2)=0;
			d2fdsigma2{4}(3,3)=-1/(2*fcl*ftl);
			d2fdsigma2{4}(3,4)=0;
			d2fdsigma2{4}(3,5)=0;
			d2fdsigma2{4}(3,6)=0;
			d2fdsigma2{4}(4,1)=0;
			d2fdsigma2{4}(4,2)=0;
			d2fdsigma2{4}(4,3)=0;
			d2fdsigma2{4}(4,4)=4/(5*fvrt^2);
			d2fdsigma2{4}(4,5)=0;
			d2fdsigma2{4}(4,6)=0;
			d2fdsigma2{4}(5,1)=0;
			d2fdsigma2{4}(5,2)=0;
			d2fdsigma2{4}(5,3)=0;
			d2fdsigma2{4}(5,4)=0;
			d2fdsigma2{4}(5,5)=33/(50*fvtl^2);
			d2fdsigma2{4}(5,6)=0;
			d2fdsigma2{4}(6,1)=0;
			d2fdsigma2{4}(6,2)=0;
			d2fdsigma2{4}(6,3)=0;
			d2fdsigma2{4}(6,4)=0;
			d2fdsigma2{4}(6,5)=0;
			d2fdsigma2{4}(6,6)=33/(50*fvrl^2);
		else
			d2fdsigma2{4}(1,1)=[0];
		end
		if requestedoutput(5)==1
			d2fdsigmadq{4}(1,1)=0;
			d2fdsigmadq{4}(1,2)=0;
			d2fdsigmadq{4}(1,3)=0;
			d2fdsigmadq{4}(1,4)=0;
			d2fdsigmadq{4}(1,5)=0;
			d2fdsigmadq{4}(1,6)=0;
			d2fdsigmadq{4}(1,7)=0;
			d2fdsigmadq{4}(2,1)=0;
			d2fdsigmadq{4}(2,2)=0;
			d2fdsigmadq{4}(2,3)=0;
			d2fdsigmadq{4}(2,4)=0;
			d2fdsigmadq{4}(2,5)=0;
			d2fdsigmadq{4}(2,6)=0;
			d2fdsigmadq{4}(2,7)=0;
			d2fdsigmadq{4}(3,1)=0;
			d2fdsigmadq{4}(3,2)=0;
			d2fdsigmadq{4}(3,3)=0;
			d2fdsigmadq{4}(3,4)=0;
			d2fdsigmadq{4}(3,5)=0;
			d2fdsigmadq{4}(3,6)=0;
			d2fdsigmadq{4}(3,7)=0;
			d2fdsigmadq{4}(4,1)=0;
			d2fdsigmadq{4}(4,2)=0;
			d2fdsigmadq{4}(4,3)=0;
			d2fdsigmadq{4}(4,4)=0;
			d2fdsigmadq{4}(4,5)=0;
			d2fdsigmadq{4}(4,6)=0;
			d2fdsigmadq{4}(4,7)=0;
			d2fdsigmadq{4}(5,1)=0;
			d2fdsigmadq{4}(5,2)=0;
			d2fdsigmadq{4}(5,3)=0;
			d2fdsigmadq{4}(5,4)=0;
			d2fdsigmadq{4}(5,5)=0;
			d2fdsigmadq{4}(5,6)=0;
			d2fdsigmadq{4}(5,7)=0;
			d2fdsigmadq{4}(6,1)=0;
			d2fdsigmadq{4}(6,2)=0;
			d2fdsigmadq{4}(6,3)=0;
			d2fdsigmadq{4}(6,4)=0;
			d2fdsigmadq{4}(6,5)=0;
			d2fdsigmadq{4}(6,6)=0;
			d2fdsigmadq{4}(6,7)=0;
		else
			d2fdsigmadq{4}(1,1)=[0];
		end
		if requestedoutput(6)==1
			d2fdq2{4}(1,1)=0;
			d2fdq2{4}(1,2)=0;
			d2fdq2{4}(1,3)=0;
			d2fdq2{4}(1,4)=0;
			d2fdq2{4}(1,5)=0;
			d2fdq2{4}(1,6)=0;
			d2fdq2{4}(1,7)=0;
			d2fdq2{4}(2,1)=0;
			d2fdq2{4}(2,2)=0;
			d2fdq2{4}(2,3)=0;
			d2fdq2{4}(2,4)=0;
			d2fdq2{4}(2,5)=0;
			d2fdq2{4}(2,6)=0;
			d2fdq2{4}(2,7)=0;
			d2fdq2{4}(3,1)=0;
			d2fdq2{4}(3,2)=0;
			d2fdq2{4}(3,3)=0;
			d2fdq2{4}(3,4)=0;
			d2fdq2{4}(3,5)=0;
			d2fdq2{4}(3,6)=0;
			d2fdq2{4}(3,7)=0;
			d2fdq2{4}(4,1)=0;
			d2fdq2{4}(4,2)=0;
			d2fdq2{4}(4,3)=0;
			d2fdq2{4}(4,4)=0;
			d2fdq2{4}(4,5)=0;
			d2fdq2{4}(4,6)=0;
			d2fdq2{4}(4,7)=0;
			d2fdq2{4}(5,1)=0;
			d2fdq2{4}(5,2)=0;
			d2fdq2{4}(5,3)=0;
			d2fdq2{4}(5,4)=0;
			d2fdq2{4}(5,5)=0;
			d2fdq2{4}(5,6)=0;
			d2fdq2{4}(5,7)=0;
			d2fdq2{4}(6,1)=0;
			d2fdq2{4}(6,2)=0;
			d2fdq2{4}(6,3)=0;
			d2fdq2{4}(6,4)=0;
			d2fdq2{4}(6,5)=0;
			d2fdq2{4}(6,6)=0;
			d2fdq2{4}(6,7)=0;
			d2fdq2{4}(7,1)=0;
			d2fdq2{4}(7,2)=0;
			d2fdq2{4}(7,3)=0;
			d2fdq2{4}(7,4)=0;
			d2fdq2{4}(7,5)=0;
			d2fdq2{4}(7,6)=0;
			d2fdq2{4}(7,7)=0;
		else
			d2fdq2{4}(1)=[0];
		end
		%{
		if requestedoutput(7)==1
		dfdinput{4}(1,1)=sigmall^2/(4*fcl*ftl^2);
		dfdinput{4}(2,1)=0;
		dfdinput{4}(3,1)=0;
		dfdinput{4}(4,1)=sigmall^2/(4*fcl^2*ftl);
		dfdinput{4}(5,1)=-(4*sigmarr^2)/(5*fcr^3);
		dfdinput{4}(6,1)=-sigmatt/fct^2;
		dfdinput{4}(7,1)=-(4*sigmart^2)/(5*fvrt^3);
		dfdinput{4}(8,1)=-(33*sigmarl^2)/(50*fvrl^3);
		dfdinput{4}(9,1)=-(33*sigmatl^2)/(50*fvtl^3);
		else
		dfdinput{4}(1,1)=[0];
		end
		%}
	end
	if requestedfacesarr(5)==1
		if requestedoutput(1)==1
			f{5}=0+q5 + sigmall/ftl + sigmarr^2/(5*fcr^2) + sigmatt^2/(5*fct^2) + sigmarl^2/(10*fvrl^2) + sigmart^2/(10*fvrt^2) + sigmatl^2/(10*fvtl^2) - 1;
		else
			f{5}=[0];
		end
		if requestedoutput(2)==1
			dfdsigma{5}(1,1)=(2*sigmarr)/(5*fcr^2);
			dfdsigma{5}(2,1)=(2*sigmatt)/(5*fct^2);
			dfdsigma{5}(3,1)=1/ftl;
			dfdsigma{5}(4,1)=sigmart/(5*fvrt^2);
			dfdsigma{5}(5,1)=sigmatl/(5*fvtl^2);
			dfdsigma{5}(6,1)=sigmarl/(5*fvrl^2);
		else
			dfdsigma{5}(1,1)=[0];
		end
		if requestedoutput(3)==1
			dfdq{5}(1,1)=0;
			dfdq{5}(2,1)=0;
			dfdq{5}(3,1)=0;
			dfdq{5}(4,1)=0;
			dfdq{5}(5,1)=1;
			dfdq{5}(6,1)=0;
			dfdq{5}(7,1)=0;
		else
			dfdq{5}(1,1)=[0];
		end
		if requestedoutput(4)==1
			d2fdsigma2{5}(1,1)=2/(5*fcr^2);
			d2fdsigma2{5}(1,2)=0;
			d2fdsigma2{5}(1,3)=0;
			d2fdsigma2{5}(1,4)=0;
			d2fdsigma2{5}(1,5)=0;
			d2fdsigma2{5}(1,6)=0;
			d2fdsigma2{5}(2,1)=0;
			d2fdsigma2{5}(2,2)=2/(5*fct^2);
			d2fdsigma2{5}(2,3)=0;
			d2fdsigma2{5}(2,4)=0;
			d2fdsigma2{5}(2,5)=0;
			d2fdsigma2{5}(2,6)=0;
			d2fdsigma2{5}(3,1)=0;
			d2fdsigma2{5}(3,2)=0;
			d2fdsigma2{5}(3,3)=0;
			d2fdsigma2{5}(3,4)=0;
			d2fdsigma2{5}(3,5)=0;
			d2fdsigma2{5}(3,6)=0;
			d2fdsigma2{5}(4,1)=0;
			d2fdsigma2{5}(4,2)=0;
			d2fdsigma2{5}(4,3)=0;
			d2fdsigma2{5}(4,4)=1/(5*fvrt^2);
			d2fdsigma2{5}(4,5)=0;
			d2fdsigma2{5}(4,6)=0;
			d2fdsigma2{5}(5,1)=0;
			d2fdsigma2{5}(5,2)=0;
			d2fdsigma2{5}(5,3)=0;
			d2fdsigma2{5}(5,4)=0;
			d2fdsigma2{5}(5,5)=1/(5*fvtl^2);
			d2fdsigma2{5}(5,6)=0;
			d2fdsigma2{5}(6,1)=0;
			d2fdsigma2{5}(6,2)=0;
			d2fdsigma2{5}(6,3)=0;
			d2fdsigma2{5}(6,4)=0;
			d2fdsigma2{5}(6,5)=0;
			d2fdsigma2{5}(6,6)=1/(5*fvrl^2);
		else
			d2fdsigma2{5}(1,1)=[0];
		end
		if requestedoutput(5)==1
			d2fdsigmadq{5}(1,1)=0;
			d2fdsigmadq{5}(1,2)=0;
			d2fdsigmadq{5}(1,3)=0;
			d2fdsigmadq{5}(1,4)=0;
			d2fdsigmadq{5}(1,5)=0;
			d2fdsigmadq{5}(1,6)=0;
			d2fdsigmadq{5}(1,7)=0;
			d2fdsigmadq{5}(2,1)=0;
			d2fdsigmadq{5}(2,2)=0;
			d2fdsigmadq{5}(2,3)=0;
			d2fdsigmadq{5}(2,4)=0;
			d2fdsigmadq{5}(2,5)=0;
			d2fdsigmadq{5}(2,6)=0;
			d2fdsigmadq{5}(2,7)=0;
			d2fdsigmadq{5}(3,1)=0;
			d2fdsigmadq{5}(3,2)=0;
			d2fdsigmadq{5}(3,3)=0;
			d2fdsigmadq{5}(3,4)=0;
			d2fdsigmadq{5}(3,5)=0;
			d2fdsigmadq{5}(3,6)=0;
			d2fdsigmadq{5}(3,7)=0;
			d2fdsigmadq{5}(4,1)=0;
			d2fdsigmadq{5}(4,2)=0;
			d2fdsigmadq{5}(4,3)=0;
			d2fdsigmadq{5}(4,4)=0;
			d2fdsigmadq{5}(4,5)=0;
			d2fdsigmadq{5}(4,6)=0;
			d2fdsigmadq{5}(4,7)=0;
			d2fdsigmadq{5}(5,1)=0;
			d2fdsigmadq{5}(5,2)=0;
			d2fdsigmadq{5}(5,3)=0;
			d2fdsigmadq{5}(5,4)=0;
			d2fdsigmadq{5}(5,5)=0;
			d2fdsigmadq{5}(5,6)=0;
			d2fdsigmadq{5}(5,7)=0;
			d2fdsigmadq{5}(6,1)=0;
			d2fdsigmadq{5}(6,2)=0;
			d2fdsigmadq{5}(6,3)=0;
			d2fdsigmadq{5}(6,4)=0;
			d2fdsigmadq{5}(6,5)=0;
			d2fdsigmadq{5}(6,6)=0;
			d2fdsigmadq{5}(6,7)=0;
		else
			d2fdsigmadq{5}(1,1)=[0];
		end
		if requestedoutput(6)==1
			d2fdq2{5}(1,1)=0;
			d2fdq2{5}(1,2)=0;
			d2fdq2{5}(1,3)=0;
			d2fdq2{5}(1,4)=0;
			d2fdq2{5}(1,5)=0;
			d2fdq2{5}(1,6)=0;
			d2fdq2{5}(1,7)=0;
			d2fdq2{5}(2,1)=0;
			d2fdq2{5}(2,2)=0;
			d2fdq2{5}(2,3)=0;
			d2fdq2{5}(2,4)=0;
			d2fdq2{5}(2,5)=0;
			d2fdq2{5}(2,6)=0;
			d2fdq2{5}(2,7)=0;
			d2fdq2{5}(3,1)=0;
			d2fdq2{5}(3,2)=0;
			d2fdq2{5}(3,3)=0;
			d2fdq2{5}(3,4)=0;
			d2fdq2{5}(3,5)=0;
			d2fdq2{5}(3,6)=0;
			d2fdq2{5}(3,7)=0;
			d2fdq2{5}(4,1)=0;
			d2fdq2{5}(4,2)=0;
			d2fdq2{5}(4,3)=0;
			d2fdq2{5}(4,4)=0;
			d2fdq2{5}(4,5)=0;
			d2fdq2{5}(4,6)=0;
			d2fdq2{5}(4,7)=0;
			d2fdq2{5}(5,1)=0;
			d2fdq2{5}(5,2)=0;
			d2fdq2{5}(5,3)=0;
			d2fdq2{5}(5,4)=0;
			d2fdq2{5}(5,5)=0;
			d2fdq2{5}(5,6)=0;
			d2fdq2{5}(5,7)=0;
			d2fdq2{5}(6,1)=0;
			d2fdq2{5}(6,2)=0;
			d2fdq2{5}(6,3)=0;
			d2fdq2{5}(6,4)=0;
			d2fdq2{5}(6,5)=0;
			d2fdq2{5}(6,6)=0;
			d2fdq2{5}(6,7)=0;
			d2fdq2{5}(7,1)=0;
			d2fdq2{5}(7,2)=0;
			d2fdq2{5}(7,3)=0;
			d2fdq2{5}(7,4)=0;
			d2fdq2{5}(7,5)=0;
			d2fdq2{5}(7,6)=0;
			d2fdq2{5}(7,7)=0;
		else
			d2fdq2{5}(1)=[0];
		end
		%{
		if requestedoutput(7)==1
		dfdinput{5}(1,1)=-sigmall/ftl^2;
		dfdinput{5}(2,1)=0;
		dfdinput{5}(3,1)=0;
		dfdinput{5}(4,1)=0;
		dfdinput{5}(5,1)=-(2*sigmarr^2)/(5*fcr^3);
		dfdinput{5}(6,1)=-(2*sigmatt^2)/(5*fct^3);
		dfdinput{5}(7,1)=-sigmart^2/(5*fvrt^3);
		dfdinput{5}(8,1)=-sigmarl^2/(5*fvrl^3);
		dfdinput{5}(9,1)=-sigmatl^2/(5*fvtl^3);
		else
		dfdinput{5}(1,1)=[0];
		end
		%}
	end
	if requestedfacesarr(6)==1
		if requestedoutput(1)==1
			f{6}=0+q6 + sigmall/fcl + (33*sigmarr^2)/(100*fcr^2) + (33*sigmatt^2)/(100*fct^2) + sigmarl^2/(4*fvrl^2) + sigmart^2/(4*fvrt^2) + sigmatl^2/(4*fvtl^2) - 1;
		else
			f{6}=[0];
		end
		if requestedoutput(2)==1
			dfdsigma{6}(1,1)=(33*sigmarr)/(50*fcr^2);
			dfdsigma{6}(2,1)=(33*sigmatt)/(50*fct^2);
			dfdsigma{6}(3,1)=1/fcl;
			dfdsigma{6}(4,1)=sigmart/(2*fvrt^2);
			dfdsigma{6}(5,1)=sigmatl/(2*fvtl^2);
			dfdsigma{6}(6,1)=sigmarl/(2*fvrl^2);
		else
			dfdsigma{6}(1,1)=[0];
		end
		if requestedoutput(3)==1
			dfdq{6}(1,1)=0;
			dfdq{6}(2,1)=0;
			dfdq{6}(3,1)=0;
			dfdq{6}(4,1)=0;
			dfdq{6}(5,1)=0;
			dfdq{6}(6,1)=1;
			dfdq{6}(7,1)=0;
		else
			dfdq{6}(1,1)=[0];
		end
		if requestedoutput(4)==1
			d2fdsigma2{6}(1,1)=33/(50*fcr^2);
			d2fdsigma2{6}(1,2)=0;
			d2fdsigma2{6}(1,3)=0;
			d2fdsigma2{6}(1,4)=0;
			d2fdsigma2{6}(1,5)=0;
			d2fdsigma2{6}(1,6)=0;
			d2fdsigma2{6}(2,1)=0;
			d2fdsigma2{6}(2,2)=33/(50*fct^2);
			d2fdsigma2{6}(2,3)=0;
			d2fdsigma2{6}(2,4)=0;
			d2fdsigma2{6}(2,5)=0;
			d2fdsigma2{6}(2,6)=0;
			d2fdsigma2{6}(3,1)=0;
			d2fdsigma2{6}(3,2)=0;
			d2fdsigma2{6}(3,3)=0;
			d2fdsigma2{6}(3,4)=0;
			d2fdsigma2{6}(3,5)=0;
			d2fdsigma2{6}(3,6)=0;
			d2fdsigma2{6}(4,1)=0;
			d2fdsigma2{6}(4,2)=0;
			d2fdsigma2{6}(4,3)=0;
			d2fdsigma2{6}(4,4)=1/(2*fvrt^2);
			d2fdsigma2{6}(4,5)=0;
			d2fdsigma2{6}(4,6)=0;
			d2fdsigma2{6}(5,1)=0;
			d2fdsigma2{6}(5,2)=0;
			d2fdsigma2{6}(5,3)=0;
			d2fdsigma2{6}(5,4)=0;
			d2fdsigma2{6}(5,5)=1/(2*fvtl^2);
			d2fdsigma2{6}(5,6)=0;
			d2fdsigma2{6}(6,1)=0;
			d2fdsigma2{6}(6,2)=0;
			d2fdsigma2{6}(6,3)=0;
			d2fdsigma2{6}(6,4)=0;
			d2fdsigma2{6}(6,5)=0;
			d2fdsigma2{6}(6,6)=1/(2*fvrl^2);
		else
			d2fdsigma2{6}(1,1)=[0];
		end
		if requestedoutput(5)==1
			d2fdsigmadq{6}(1,1)=0;
			d2fdsigmadq{6}(1,2)=0;
			d2fdsigmadq{6}(1,3)=0;
			d2fdsigmadq{6}(1,4)=0;
			d2fdsigmadq{6}(1,5)=0;
			d2fdsigmadq{6}(1,6)=0;
			d2fdsigmadq{6}(1,7)=0;
			d2fdsigmadq{6}(2,1)=0;
			d2fdsigmadq{6}(2,2)=0;
			d2fdsigmadq{6}(2,3)=0;
			d2fdsigmadq{6}(2,4)=0;
			d2fdsigmadq{6}(2,5)=0;
			d2fdsigmadq{6}(2,6)=0;
			d2fdsigmadq{6}(2,7)=0;
			d2fdsigmadq{6}(3,1)=0;
			d2fdsigmadq{6}(3,2)=0;
			d2fdsigmadq{6}(3,3)=0;
			d2fdsigmadq{6}(3,4)=0;
			d2fdsigmadq{6}(3,5)=0;
			d2fdsigmadq{6}(3,6)=0;
			d2fdsigmadq{6}(3,7)=0;
			d2fdsigmadq{6}(4,1)=0;
			d2fdsigmadq{6}(4,2)=0;
			d2fdsigmadq{6}(4,3)=0;
			d2fdsigmadq{6}(4,4)=0;
			d2fdsigmadq{6}(4,5)=0;
			d2fdsigmadq{6}(4,6)=0;
			d2fdsigmadq{6}(4,7)=0;
			d2fdsigmadq{6}(5,1)=0;
			d2fdsigmadq{6}(5,2)=0;
			d2fdsigmadq{6}(5,3)=0;
			d2fdsigmadq{6}(5,4)=0;
			d2fdsigmadq{6}(5,5)=0;
			d2fdsigmadq{6}(5,6)=0;
			d2fdsigmadq{6}(5,7)=0;
			d2fdsigmadq{6}(6,1)=0;
			d2fdsigmadq{6}(6,2)=0;
			d2fdsigmadq{6}(6,3)=0;
			d2fdsigmadq{6}(6,4)=0;
			d2fdsigmadq{6}(6,5)=0;
			d2fdsigmadq{6}(6,6)=0;
			d2fdsigmadq{6}(6,7)=0;
		else
			d2fdsigmadq{6}(1,1)=[0];
		end
		if requestedoutput(6)==1
			d2fdq2{6}(1,1)=0;
			d2fdq2{6}(1,2)=0;
			d2fdq2{6}(1,3)=0;
			d2fdq2{6}(1,4)=0;
			d2fdq2{6}(1,5)=0;
			d2fdq2{6}(1,6)=0;
			d2fdq2{6}(1,7)=0;
			d2fdq2{6}(2,1)=0;
			d2fdq2{6}(2,2)=0;
			d2fdq2{6}(2,3)=0;
			d2fdq2{6}(2,4)=0;
			d2fdq2{6}(2,5)=0;
			d2fdq2{6}(2,6)=0;
			d2fdq2{6}(2,7)=0;
			d2fdq2{6}(3,1)=0;
			d2fdq2{6}(3,2)=0;
			d2fdq2{6}(3,3)=0;
			d2fdq2{6}(3,4)=0;
			d2fdq2{6}(3,5)=0;
			d2fdq2{6}(3,6)=0;
			d2fdq2{6}(3,7)=0;
			d2fdq2{6}(4,1)=0;
			d2fdq2{6}(4,2)=0;
			d2fdq2{6}(4,3)=0;
			d2fdq2{6}(4,4)=0;
			d2fdq2{6}(4,5)=0;
			d2fdq2{6}(4,6)=0;
			d2fdq2{6}(4,7)=0;
			d2fdq2{6}(5,1)=0;
			d2fdq2{6}(5,2)=0;
			d2fdq2{6}(5,3)=0;
			d2fdq2{6}(5,4)=0;
			d2fdq2{6}(5,5)=0;
			d2fdq2{6}(5,6)=0;
			d2fdq2{6}(5,7)=0;
			d2fdq2{6}(6,1)=0;
			d2fdq2{6}(6,2)=0;
			d2fdq2{6}(6,3)=0;
			d2fdq2{6}(6,4)=0;
			d2fdq2{6}(6,5)=0;
			d2fdq2{6}(6,6)=0;
			d2fdq2{6}(6,7)=0;
			d2fdq2{6}(7,1)=0;
			d2fdq2{6}(7,2)=0;
			d2fdq2{6}(7,3)=0;
			d2fdq2{6}(7,4)=0;
			d2fdq2{6}(7,5)=0;
			d2fdq2{6}(7,6)=0;
			d2fdq2{6}(7,7)=0;
		else
			d2fdq2{6}(1)=[0];
		end
		%{
		if requestedoutput(7)==1
		dfdinput{6}(1,1)=0;
		dfdinput{6}(2,1)=0;
		dfdinput{6}(3,1)=0;
		dfdinput{6}(4,1)=-sigmall/fcl^2;
		dfdinput{6}(5,1)=-(33*sigmarr^2)/(50*fcr^3);
		dfdinput{6}(6,1)=-(33*sigmatt^2)/(50*fct^3);
		dfdinput{6}(7,1)=-sigmart^2/(2*fvrt^3);
		dfdinput{6}(8,1)=-sigmarl^2/(2*fvrl^3);
		dfdinput{6}(9,1)=-sigmatl^2/(2*fvtl^3);
		else
		dfdinput{6}(1,1)=[0];
		end
		%}
	end
	if requestedfacesarr(7)==1
		if requestedoutput(1)==1
			f{7}=q7 - sigmall/(20*fcl) - sigmarr/(5*fcr) - sigmatt/(5*fct) + sigmarr^2/(4*fcr^2) + sigmatt^2/(4*fct^2) + sigmarl^2/fvrl^2 + sigmart^2/fvrt^2 + sigmatl^2/fvtl^2 - sigmall^2/(10*fcl*ftl) - 1;
		else
			f{7}=[0];
		end
		if requestedoutput(2)==1
			dfdsigma{7}(1,1)=-(2*fcr - 5*sigmarr)/(10*fcr^2);
			dfdsigma{7}(2,1)=-(2*fct - 5*sigmatt)/(10*fct^2);
			dfdsigma{7}(3,1)=-(ftl + 4*sigmall)/(20*fcl*ftl);
			dfdsigma{7}(4,1)=(2*sigmart)/fvrt^2;
			dfdsigma{7}(5,1)=(2*sigmatl)/fvtl^2;
			dfdsigma{7}(6,1)=(2*sigmarl)/fvrl^2;
		else
			dfdsigma{7}(1,1)=[0];
		end
		if requestedoutput(3)==1
			dfdq{7}(1,1)=0;
			dfdq{7}(2,1)=0;
			dfdq{7}(3,1)=0;
			dfdq{7}(4,1)=0;
			dfdq{7}(5,1)=0;
			dfdq{7}(6,1)=0;
			dfdq{7}(7,1)=1;
		else
			dfdq{7}(1,1)=[0];
		end
		if requestedoutput(4)==1
			d2fdsigma2{7}(1,1)=1/(2*fcr^2);
			d2fdsigma2{7}(1,2)=0;
			d2fdsigma2{7}(1,3)=0;
			d2fdsigma2{7}(1,4)=0;
			d2fdsigma2{7}(1,5)=0;
			d2fdsigma2{7}(1,6)=0;
			d2fdsigma2{7}(2,1)=0;
			d2fdsigma2{7}(2,2)=1/(2*fct^2);
			d2fdsigma2{7}(2,3)=0;
			d2fdsigma2{7}(2,4)=0;
			d2fdsigma2{7}(2,5)=0;
			d2fdsigma2{7}(2,6)=0;
			d2fdsigma2{7}(3,1)=0;
			d2fdsigma2{7}(3,2)=0;
			d2fdsigma2{7}(3,3)=-1/(5*fcl*ftl);
			d2fdsigma2{7}(3,4)=0;
			d2fdsigma2{7}(3,5)=0;
			d2fdsigma2{7}(3,6)=0;
			d2fdsigma2{7}(4,1)=0;
			d2fdsigma2{7}(4,2)=0;
			d2fdsigma2{7}(4,3)=0;
			d2fdsigma2{7}(4,4)=2/fvrt^2;
			d2fdsigma2{7}(4,5)=0;
			d2fdsigma2{7}(4,6)=0;
			d2fdsigma2{7}(5,1)=0;
			d2fdsigma2{7}(5,2)=0;
			d2fdsigma2{7}(5,3)=0;
			d2fdsigma2{7}(5,4)=0;
			d2fdsigma2{7}(5,5)=2/fvtl^2;
			d2fdsigma2{7}(5,6)=0;
			d2fdsigma2{7}(6,1)=0;
			d2fdsigma2{7}(6,2)=0;
			d2fdsigma2{7}(6,3)=0;
			d2fdsigma2{7}(6,4)=0;
			d2fdsigma2{7}(6,5)=0;
			d2fdsigma2{7}(6,6)=2/fvrl^2;
		else
			d2fdsigma2{7}(1,1)=[0];
		end
		if requestedoutput(5)==1
			d2fdsigmadq{7}(1,1)=0;
			d2fdsigmadq{7}(1,2)=0;
			d2fdsigmadq{7}(1,3)=0;
			d2fdsigmadq{7}(1,4)=0;
			d2fdsigmadq{7}(1,5)=0;
			d2fdsigmadq{7}(1,6)=0;
			d2fdsigmadq{7}(1,7)=0;
			d2fdsigmadq{7}(2,1)=0;
			d2fdsigmadq{7}(2,2)=0;
			d2fdsigmadq{7}(2,3)=0;
			d2fdsigmadq{7}(2,4)=0;
			d2fdsigmadq{7}(2,5)=0;
			d2fdsigmadq{7}(2,6)=0;
			d2fdsigmadq{7}(2,7)=0;
			d2fdsigmadq{7}(3,1)=0;
			d2fdsigmadq{7}(3,2)=0;
			d2fdsigmadq{7}(3,3)=0;
			d2fdsigmadq{7}(3,4)=0;
			d2fdsigmadq{7}(3,5)=0;
			d2fdsigmadq{7}(3,6)=0;
			d2fdsigmadq{7}(3,7)=0;
			d2fdsigmadq{7}(4,1)=0;
			d2fdsigmadq{7}(4,2)=0;
			d2fdsigmadq{7}(4,3)=0;
			d2fdsigmadq{7}(4,4)=0;
			d2fdsigmadq{7}(4,5)=0;
			d2fdsigmadq{7}(4,6)=0;
			d2fdsigmadq{7}(4,7)=0;
			d2fdsigmadq{7}(5,1)=0;
			d2fdsigmadq{7}(5,2)=0;
			d2fdsigmadq{7}(5,3)=0;
			d2fdsigmadq{7}(5,4)=0;
			d2fdsigmadq{7}(5,5)=0;
			d2fdsigmadq{7}(5,6)=0;
			d2fdsigmadq{7}(5,7)=0;
			d2fdsigmadq{7}(6,1)=0;
			d2fdsigmadq{7}(6,2)=0;
			d2fdsigmadq{7}(6,3)=0;
			d2fdsigmadq{7}(6,4)=0;
			d2fdsigmadq{7}(6,5)=0;
			d2fdsigmadq{7}(6,6)=0;
			d2fdsigmadq{7}(6,7)=0;
		else
			d2fdsigmadq{7}(1,1)=[0];
		end
		if requestedoutput(6)==1
			d2fdq2{7}(1,1)=0;
			d2fdq2{7}(1,2)=0;
			d2fdq2{7}(1,3)=0;
			d2fdq2{7}(1,4)=0;
			d2fdq2{7}(1,5)=0;
			d2fdq2{7}(1,6)=0;
			d2fdq2{7}(1,7)=0;
			d2fdq2{7}(2,1)=0;
			d2fdq2{7}(2,2)=0;
			d2fdq2{7}(2,3)=0;
			d2fdq2{7}(2,4)=0;
			d2fdq2{7}(2,5)=0;
			d2fdq2{7}(2,6)=0;
			d2fdq2{7}(2,7)=0;
			d2fdq2{7}(3,1)=0;
			d2fdq2{7}(3,2)=0;
			d2fdq2{7}(3,3)=0;
			d2fdq2{7}(3,4)=0;
			d2fdq2{7}(3,5)=0;
			d2fdq2{7}(3,6)=0;
			d2fdq2{7}(3,7)=0;
			d2fdq2{7}(4,1)=0;
			d2fdq2{7}(4,2)=0;
			d2fdq2{7}(4,3)=0;
			d2fdq2{7}(4,4)=0;
			d2fdq2{7}(4,5)=0;
			d2fdq2{7}(4,6)=0;
			d2fdq2{7}(4,7)=0;
			d2fdq2{7}(5,1)=0;
			d2fdq2{7}(5,2)=0;
			d2fdq2{7}(5,3)=0;
			d2fdq2{7}(5,4)=0;
			d2fdq2{7}(5,5)=0;
			d2fdq2{7}(5,6)=0;
			d2fdq2{7}(5,7)=0;
			d2fdq2{7}(6,1)=0;
			d2fdq2{7}(6,2)=0;
			d2fdq2{7}(6,3)=0;
			d2fdq2{7}(6,4)=0;
			d2fdq2{7}(6,5)=0;
			d2fdq2{7}(6,6)=0;
			d2fdq2{7}(6,7)=0;
			d2fdq2{7}(7,1)=0;
			d2fdq2{7}(7,2)=0;
			d2fdq2{7}(7,3)=0;
			d2fdq2{7}(7,4)=0;
			d2fdq2{7}(7,5)=0;
			d2fdq2{7}(7,6)=0;
			d2fdq2{7}(7,7)=0;
		else
			d2fdq2{7}(1)=[0];
		end
		%{
		if requestedoutput(7)==1
		dfdinput{7}(1,1)=sigmall^2/(10*fcl*ftl^2);
		dfdinput{7}(2,1)=0;
		dfdinput{7}(3,1)=0;
		dfdinput{7}(4,1)=(sigmall*(ftl + 2*sigmall))/(20*fcl^2*ftl);
		dfdinput{7}(5,1)=(sigmarr*(2*fcr - 5*sigmarr))/(10*fcr^3);
		dfdinput{7}(6,1)=(sigmatt*(2*fct - 5*sigmatt))/(10*fct^3);
		dfdinput{7}(7,1)=-(2*sigmart^2)/fvrt^3;
		dfdinput{7}(8,1)=-(2*sigmarl^2)/fvrl^3;
		dfdinput{7}(9,1)=-(2*sigmatl^2)/fvtl^3;
		else
		dfdinput{7}(1,1)=[0];
		end
		%}
	end
	
	% end of sym paste
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [q,dqdalpha,d2qdalpha2]=qandDfromalpha2(alphahp,ftl,ftr,ftt,fcl,fcr,fct,fvrt,fvrl,fvtl,Er,Et,El,kappa1,kappa2,kappa3,kappa4,kappa5,kappa6,kappa7,Gftl,Gfcl,Gftr,Gftt,Gfcr,Gfct,GII,Hld,Hrd,Htd,lc,alpha2dnounit,alpha2maxnounit,alpha4dnounit,alpha4maxnounit,alpha6dnounit,alpha6maxnounit,alpha7dnounit,alpha7maxnounit)

q=zeros(1,7);
dqdalpha=zeros(1,7);
d2qdalpha2=zeros(1,7);

alpha1=alphahp(1);
alpha2=alphahp(2);
alpha3=alphahp(3);
alpha4=alphahp(4);
alpha5=alphahp(5);
alpha6=alphahp(6);
alpha7=alphahp(7);


%{
beta0tl=65;
beta0cl=49.9;
beta0tr=4.5;
beta0cr=beta0tr/beta0tl*beta0cl;
beta0tt=beta0tr;
beta0ct=beta0cr;
%}

beta0tl=abs(ftl);
beta0cl=abs(fcl);
beta0tr=abs(ftr);
beta0cr=abs(fcr);
beta0tt=abs(ftt);
beta0ct=abs(fct);

zeta2=Hrd/beta0cr^2;
zeta4=Htd/beta0ct^2;
zeta6=Hld/beta0cl^2;
zeta7=zeta2;


alpha2d=alpha2dnounit*abs(fcr);
alpha2max=alpha2maxnounit*abs(fcr);
alpha4d=alpha4dnounit*abs(fct);
alpha4max=alpha4maxnounit*abs(fct);
alpha6d=alpha6dnounit*abs(fcl);
alpha6max=alpha6maxnounit*abs(fcl);
alpha7d=alpha7dnounit*abs(1/3*(fvrt+fvrl+fvtl));
alpha7max=alpha7maxnounit*abs(1/3*(fvrt+fvrl+fvtl));

% Start of Sym Results, paste here!
q(1)=(exp(-(alpha1*abs(lc))/abs(Gftr)) - 1)*(kappa1 - 1);
if alpha2<=alpha2d
q(2)=(exp(-(alpha2*abs(lc))/abs(Gfcr)) - 1)*(kappa2 - 1);
else
q(2)=(exp(-(alpha2*abs(lc))/abs(Gfcr)) - 1)*(kappa2 - 1) + (zeta2*(alpha2 - alpha2d)^2)/(alpha2 - alpha2max);
end
q(3)=(exp(-(alpha3*abs(lc))/abs(Gftt)) - 1)*(kappa3 - 1);
if alpha4<=alpha4d
q(4)=(exp(-(alpha4*abs(lc))/abs(Gfct)) - 1)*(kappa4 - 1);
else
q(4)=(exp(-(alpha4*abs(lc))/abs(Gfct)) - 1)*(kappa4 - 1) + (zeta4*(alpha4 - alpha4d)^2)/(alpha4 - alpha4max);
end
q(5)=(exp(-(alpha5*abs(lc))/abs(Gftl)) - 1)*(kappa5 - 1);
if alpha6<=alpha6d
q(6)=(exp(-(alpha6*abs(lc))/abs(Gfcl)) - 1)*(kappa6 - 1);
else
q(6)=(exp(-(alpha6*abs(lc))/abs(Gfcl)) - 1)*(kappa6 - 1) + (zeta6*(alpha6 - alpha6d)^2)/(alpha6 - alpha6max);
end
if alpha7<=alpha7d
q(7)=(exp(-(alpha7*abs(lc))/abs(GII)) - 1)*(kappa7 - 1);
else
q(7)=(exp(-(alpha7*abs(lc))/abs(GII)) - 1)*(kappa7 - 1) + (zeta7*(alpha7 - alpha7d)^2)/(alpha7 - alpha7max);
end
dqdalpha(1)=-(exp(-(alpha1*abs(lc))/abs(Gftr))*abs(lc)*(kappa1 - 1))/abs(Gftr);
if alpha2<=alpha2d
dqdalpha(2)=-(exp(-(alpha2*abs(lc))/abs(Gfcr))*abs(lc)*(kappa2 - 1))/abs(Gfcr);
else
dqdalpha(2)=(zeta2*(2*alpha2 - 2*alpha2d))/(alpha2 - alpha2max) - (zeta2*(alpha2 - alpha2d)^2)/(alpha2 - alpha2max)^2 - (exp(-(alpha2*abs(lc))/abs(Gfcr))*abs(lc)*(kappa2 - 1))/abs(Gfcr);
end
dqdalpha(3)=-(exp(-(alpha3*abs(lc))/abs(Gftt))*abs(lc)*(kappa3 - 1))/abs(Gftt);
if alpha4<=alpha4d
dqdalpha(4)=-(exp(-(alpha4*abs(lc))/abs(Gfct))*abs(lc)*(kappa4 - 1))/abs(Gfct);
else
dqdalpha(4)=(zeta4*(2*alpha4 - 2*alpha4d))/(alpha4 - alpha4max) - (zeta4*(alpha4 - alpha4d)^2)/(alpha4 - alpha4max)^2 - (exp(-(alpha4*abs(lc))/abs(Gfct))*abs(lc)*(kappa4 - 1))/abs(Gfct);
end
dqdalpha(5)=-(exp(-(alpha5*abs(lc))/abs(Gftl))*abs(lc)*(kappa5 - 1))/abs(Gftl);
if alpha6<=alpha6d
dqdalpha(6)=-(exp(-(alpha6*abs(lc))/abs(Gfcl))*abs(lc)*(kappa6 - 1))/abs(Gfcl);
else
dqdalpha(6)=(zeta6*(2*alpha6 - 2*alpha6d))/(alpha6 - alpha6max) - (zeta6*(alpha6 - alpha6d)^2)/(alpha6 - alpha6max)^2 - (exp(-(alpha6*abs(lc))/abs(Gfcl))*abs(lc)*(kappa6 - 1))/abs(Gfcl);
end
if alpha7<=alpha7d
dqdalpha(7)=-(exp(-(alpha7*abs(lc))/abs(GII))*abs(lc)*(kappa7 - 1))/abs(GII);
else
dqdalpha(7)=(zeta7*(2*alpha7 - 2*alpha7d))/(alpha7 - alpha7max) - (zeta7*(alpha7 - alpha7d)^2)/(alpha7 - alpha7max)^2 - (exp(-(alpha7*abs(lc))/abs(GII))*abs(lc)*(kappa7 - 1))/abs(GII);
end
d2qdalpha2(1)=(exp(-(alpha1*abs(lc))/abs(Gftr))*abs(lc)^2*(kappa1 - 1))/abs(Gftr)^2;
if alpha2<=alpha2d
d2qdalpha2(2)=(exp(-(alpha2*abs(lc))/abs(Gfcr))*abs(lc)^2*(kappa2 - 1))/abs(Gfcr)^2;
else
d2qdalpha2(2)=(2*zeta2)/(alpha2 - alpha2max) - (2*zeta2*(2*alpha2 - 2*alpha2d))/(alpha2 - alpha2max)^2 + (2*zeta2*(alpha2 - alpha2d)^2)/(alpha2 - alpha2max)^3 + (exp(-(alpha2*abs(lc))/abs(Gfcr))*abs(lc)^2*(kappa2 - 1))/abs(Gfcr)^2;
end
d2qdalpha2(3)=(exp(-(alpha3*abs(lc))/abs(Gftt))*abs(lc)^2*(kappa3 - 1))/abs(Gftt)^2;
if alpha4<=alpha4d
d2qdalpha2(4)=(exp(-(alpha4*abs(lc))/abs(Gfct))*abs(lc)^2*(kappa4 - 1))/abs(Gfct)^2;
else
d2qdalpha2(4)=(2*zeta4)/(alpha4 - alpha4max) - (2*zeta4*(2*alpha4 - 2*alpha4d))/(alpha4 - alpha4max)^2 + (2*zeta4*(alpha4 - alpha4d)^2)/(alpha4 - alpha4max)^3 + (exp(-(alpha4*abs(lc))/abs(Gfct))*abs(lc)^2*(kappa4 - 1))/abs(Gfct)^2;
end
d2qdalpha2(5)=(exp(-(alpha5*abs(lc))/abs(Gftl))*abs(lc)^2*(kappa5 - 1))/abs(Gftl)^2;
if alpha6<=alpha6d
d2qdalpha2(6)=(exp(-(alpha6*abs(lc))/abs(Gfcl))*abs(lc)^2*(kappa6 - 1))/abs(Gfcl)^2;
else
d2qdalpha2(6)=(2*zeta6)/(alpha6 - alpha6max) - (2*zeta6*(2*alpha6 - 2*alpha6d))/(alpha6 - alpha6max)^2 + (2*zeta6*(alpha6 - alpha6d)^2)/(alpha6 - alpha6max)^3 + (exp(-(alpha6*abs(lc))/abs(Gfcl))*abs(lc)^2*(kappa6 - 1))/abs(Gfcl)^2;
end
if alpha7<=alpha7d
d2qdalpha2(7)=(exp(-(alpha7*abs(lc))/abs(GII))*abs(lc)^2*(kappa7 - 1))/abs(GII)^2;
else
d2qdalpha2(7)=(2*zeta7)/(alpha7 - alpha7max) - (2*zeta7*(2*alpha7 - 2*alpha7d))/(alpha7 - alpha7max)^2 + (2*zeta7*(alpha7 - alpha7d)^2)/(alpha7 - alpha7max)^3 + (exp(-(alpha7*abs(lc))/abs(GII))*abs(lc)^2*(kappa7 - 1))/abs(GII)^2;
end

% End of Sym Results

%{
Dcut=[];
for i=1:length(hardeningsurfaces)
    %qcut(i)=q(hardeningsurfaces(i));
    for j=1:length(hardeningsurfaces)
        Dcut(i,j)=D(hardeningsurfaces(i),hardeningsurfaces(j));
    end
end
%}
%for i=1:7
%    q(i)=q(i)-1e99;
%end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [maxvalue,maxnum]=CellMax(cell11in)
maxnum=1;
maxvalue=cell11in{1};
for i=2:length(cell11in)
    if cell11in{i}>maxvalue
        maxvalue=cell11in{i};
        maxnum=i;
    end
end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [s_sp]=Linear_elastic(dESP,s_sp,E,nu)
	
	% de_sp                   = zeros(spCount,3);                     % Strain increment
	% e_sp                    = zeros(spCount,3);                     % Strain tensor
	% ds_sp                   = zeros(spCount,3);                     % Stress increment
	
	de_sp                   = zeros(1,3);                     % Strain increment
	
	
	%D = [E/(1-nu.^2) E*nu/(1-nu.^2) 0; E*nu/(1-nu.^2) E/(1-nu.^2) 0; 0 0 E/(1-nu)];
	D=E/((1+nu)*(1-2*nu))*[1-nu nu 0;nu 1-nu 0;0 0 (1-2*nu)];
	
	% THis is the linear elastic model
			de_sp(1) = dESP(1,1);
			de_sp(2) = dESP(2,2);
			de_sp(3) = dESP(2,1);
			
			ds_sp = D * de_sp';
	%         e_sp(spid,:)  =  e_sp(spid,:)+de_sp(spid,:);
			s_sp = s_sp + ds_sp';
			
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [sse_sp,s_sp]=Linear_elastic_se(dESP,s_sp,E,nu)
	
	% de_sp                   = zeros(spCount,3);                     % Strain increment
	% e_sp                    = zeros(spCount,3);                     % Strain tensor
	% ds_sp                   = zeros(spCount,3);                     % Stress increment
	
	de_sp                   = zeros(1,3);                     % Strain increment
	e_sp=zeros(3,1);
	sse_sp=zeros(1,1);
	
	%D = [E/(1-nu.^2) E*nu/(1-nu.^2) 0; E*nu/(1-nu.^2) E/(1-nu.^2) 0; 0 0 E/(1-nu)];
	D=E/((1+nu)*(1-2*nu))*[1-nu nu 0;nu 1-nu 0;0 0 (1-2*nu)];
	
	% THis is the linear elastic model
	de_sp(1) = dESP(1,1);
	de_sp(2) = dESP(2,2);
	de_sp(3) = dESP(2,1);
	
	ds_sp = D * de_sp';
	%e_sp(spid,:)  =  e_sp(spid,:)+de_sp(spid,:);
	s_sp = s_sp + ds_sp';
	
	e_sp=(D^-1)*s_sp';
	
	sse_sp=0.5*(e_sp(1)*s_sp(1)+e_sp(2)*s_sp(2)+2*e_sp(3)*s_sp(3));
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [s_sp]=Neo_Hookean_elastic(F_sp,E,nu)
	
	% This is the hyper-elastic Neo-Hookean model
	
	s_sp=zeros(1,3);
	J=det(F_sp);
	
	Lambda = E*nu/(1+nu)/(1-2*nu);
	Mu     = E/2/(1+nu);

	SSP = Lambda*log(J)/J*eye(2,2) + Mu/J*(F_sp*F_sp'-eye(2,2));
			s_sp(1,1) = SSP(1,1);
			s_sp(1,2) = SSP(2,2);
			s_sp(1,3) = SSP(1,2);
			
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [s_sp]=Linear_elastic_orthotropic(dESP,s_sp,Ebase,Ex,Ey,nu)
	
	% de_sp                   = zeros(spCount,3);                     % Strain increment
	% e_sp                    = zeros(spCount,3);                     % Strain tensor
	% ds_sp                   = zeros(spCount,3);                     % Stress increment
	de_sp                     = zeros(1,3);                           % Strain increment
	
	
	%{
	Comp=[1/Er -nurt/Et -nurl/El 0 0 0;
		-nurt/Et 1/Et -nutl/El 0 0 0;
		-nurl/El -nutl/El 1/El 0 0 0;
		0 0 0 1/Grt 0 0;
		0 0 0 0 1/Gtl 0;
		0 0 0 0 0 1/Grl];
	%}
	
	nuxy=nu;
	nuxz=nu;
	nuyz=nu;
	Gbase=Ebase/(2*(1+nu));
	Gxy=Gbase;
	Gxz=Gbase;
	Gyz=Gbase;
	Ez=Ebase;
	E=Ebase;
	
	%D = [E/(1-nu.^2) E*nu/(1-nu.^2) 0; E*nu/(1-nu.^2) E/(1-nu.^2) 0; 0 0 E/(1-nu)];
	
	%{
	D3D=[       -(Ex*Ey*(- Ey*nuyz^2 + Ez))/(Ey^2*nuyz^2 + 2*Ex*Ey*nuxy*nuxz*nuyz + Ex*Ey*nuxz^2 - Ez*Ey + Ex*Ez*nuxy^2), -(Ex*Ey*(Ez*nuxy + Ey*nuxz*nuyz))/(Ey^2*nuyz^2 + 2*Ex*Ey*nuxy*nuxz*nuyz + Ex*Ey*nuxz^2 - Ez*Ey + Ex*Ez*nuxy^2),    -(Ex*Ey*Ez*(nuxz + nuxy*nuyz))/(Ey^2*nuyz^2 + 2*Ex*Ey*nuxy*nuxz*nuyz + Ex*Ey*nuxz^2 - Ez*Ey + Ex*Ez*nuxy^2),   0,   0,   0;
	 -(Ex*Ey*(Ez*nuxy + Ey*nuxz*nuyz))/(Ey^2*nuyz^2 + 2*Ex*Ey*nuxy*nuxz*nuyz + Ex*Ey*nuxz^2 - Ez*Ey + Ex*Ez*nuxy^2),        -(Ey^2*(- Ex*nuxz^2 + Ez))/(Ey^2*nuyz^2 + 2*Ex*Ey*nuxy*nuxz*nuyz + Ex*Ey*nuxz^2 - Ez*Ey + Ex*Ez*nuxy^2), -(Ey*Ez*(Ey*nuyz + Ex*nuxy*nuxz))/(Ey^2*nuyz^2 + 2*Ex*Ey*nuxy*nuxz*nuyz + Ex*Ey*nuxz^2 - Ez*Ey + Ex*Ez*nuxy^2),   0,   0,   0;
		-(Ex*Ey*Ez*(nuxz + nuxy*nuyz))/(Ey^2*nuyz^2 + 2*Ex*Ey*nuxy*nuxz*nuyz + Ex*Ey*nuxz^2 - Ez*Ey + Ex*Ez*nuxy^2), -(Ey*Ez*(Ey*nuyz + Ex*nuxy*nuxz))/(Ey^2*nuyz^2 + 2*Ex*Ey*nuxy*nuxz*nuyz + Ex*Ey*nuxz^2 - Ez*Ey + Ex*Ez*nuxy^2),        -(Ez^2*(- Ex*nuxy^2 + Ey))/(Ey^2*nuyz^2 + 2*Ex*Ey*nuxy*nuxz*nuyz + Ex*Ey*nuxz^2 - Ez*Ey + Ex*Ez*nuxy^2),   0,   0,   0;
																												  0,                                                                                                              0,                                                                                                              0, Gxy,   0,   0;
																												  0,                                                                                                              0,                                                                                                              0,   0, Gyz,   0;
																												  0,                                                                                                              0,                                                                                                              0,   0,   0, Gxz];

	D=[D3D(1:2,1:2) D3D(1:2,4);
		D3D(4,1:2) D3D(4,4)];
	%}
	
	D = [Ex/(1-nu.^2) E*nu/(1-nu.^2) 0; E*nu/(1-nu.^2) E/(1-nu.^2) 0; 0 0 E/(1-nu)];
	
	% THis is the linear elastic model
			de_sp(1) = dESP(1,1);
			de_sp(2) = dESP(2,2);
			de_sp(3) = dESP(2,1);
			
			ds_sp = D * de_sp';
	%         e_sp(spid,:)  =  e_sp(spid,:)+de_sp(spid,:);
			s_sp = s_sp + ds_sp';
			
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [s_sp]=Linear_elastic_orthotropic_2(dESP,s_sp,Ex,Ey,Ez,Gxy,Gyz,Gxz,nuxy,nuyz,nuxz)

% de_sp                   = zeros(spCount,3);                     % Strain increment
% e_sp                    = zeros(spCount,3);                     % Strain tensor
% ds_sp                   = zeros(spCount,3);                     % Stress increment

%{
Comp=[1/Er -nurt/Et -nurl/El 0 0 0;
    -nurt/Et 1/Et -nutl/El 0 0 0;
    -nurl/El -nutl/El 1/El 0 0 0;
    0 0 0 1/Grt 0 0;
    0 0 0 0 1/Gtl 0;
    0 0 0 0 0 1/Grl];
%}



%D = [E/(1-nu.^2) E*nu/(1-nu.^2) 0; E*nu/(1-nu.^2) E/(1-nu.^2) 0; 0 0 E/(1-nu)];


D3D=[       -(Ex*Ey*(- Ey*nuyz^2 + Ez))/(Ey^2*nuyz^2 + 2*Ex*Ey*nuxy*nuxz*nuyz + Ex*Ey*nuxz^2 - Ez*Ey + Ex*Ez*nuxy^2), -(Ex*Ey*(Ez*nuxy + Ey*nuxz*nuyz))/(Ey^2*nuyz^2 + 2*Ex*Ey*nuxy*nuxz*nuyz + Ex*Ey*nuxz^2 - Ez*Ey + Ex*Ez*nuxy^2),    -(Ex*Ey*Ez*(nuxz + nuxy*nuyz))/(Ey^2*nuyz^2 + 2*Ex*Ey*nuxy*nuxz*nuyz + Ex*Ey*nuxz^2 - Ez*Ey + Ex*Ez*nuxy^2),   0,   0,   0;
 -(Ex*Ey*(Ez*nuxy + Ey*nuxz*nuyz))/(Ey^2*nuyz^2 + 2*Ex*Ey*nuxy*nuxz*nuyz + Ex*Ey*nuxz^2 - Ez*Ey + Ex*Ez*nuxy^2),        -(Ey^2*(- Ex*nuxz^2 + Ez))/(Ey^2*nuyz^2 + 2*Ex*Ey*nuxy*nuxz*nuyz + Ex*Ey*nuxz^2 - Ez*Ey + Ex*Ez*nuxy^2), -(Ey*Ez*(Ey*nuyz + Ex*nuxy*nuxz))/(Ey^2*nuyz^2 + 2*Ex*Ey*nuxy*nuxz*nuyz + Ex*Ey*nuxz^2 - Ez*Ey + Ex*Ez*nuxy^2),   0,   0,   0;
    -(Ex*Ey*Ez*(nuxz + nuxy*nuyz))/(Ey^2*nuyz^2 + 2*Ex*Ey*nuxy*nuxz*nuyz + Ex*Ey*nuxz^2 - Ez*Ey + Ex*Ez*nuxy^2), -(Ey*Ez*(Ey*nuyz + Ex*nuxy*nuxz))/(Ey^2*nuyz^2 + 2*Ex*Ey*nuxy*nuxz*nuyz + Ex*Ey*nuxz^2 - Ez*Ey + Ex*Ez*nuxy^2),        -(Ez^2*(- Ex*nuxy^2 + Ey))/(Ey^2*nuyz^2 + 2*Ex*Ey*nuxy*nuxz*nuyz + Ex*Ey*nuxz^2 - Ez*Ey + Ex*Ez*nuxy^2),   0,   0,   0;
                                                                                                              0,                                                                                                              0,                                                                                                              0, Gxy,   0,   0;
                                                                                                              0,                                                                                                              0,                                                                                                              0,   0, Gyz,   0;
                                                                                                              0,                                                                                                              0,                                                                                                              0,   0,   0, Gxz];

D=[D3D(1:2,1:2) D3D(1:2,4);
    D3D(4,1:2) D3D(4,4)];


%D = [Ex/(1-nu.^2) E*nu/(1-nu.^2) 0; E*nu/(1-nu.^2) E/(1-nu.^2) 0; 0 0 E/(1-nu)];

% THis is the linear elastic model
		de_sp=zeros(1,3);
        de_sp(1) = dESP(1,1);
        de_sp(2) = dESP(2,2);
        de_sp(3) = dESP(2,1);
        
        ds_sp = D * de_sp';
%         e_sp(spid,:)  =  e_sp(spid,:)+de_sp(spid,:);
        s_sp = s_sp + ds_sp';
        
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [r1_sp,r2_sp] = Update_topology(spCount,F_sp,r1_sp,r10_sp,r2_sp,r20_sp)

for spid=1:spCount
        r1_sp(spid,:) = (F_sp{spid} * r10_sp(spid,:)')';
        r2_sp(spid,:) = (F_sp{spid} * r20_sp(spid,:)')';     
end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

%{
%switchable2
function [StressProfile1]=Plot_Final2_alpha(climit,x_sp,LOC,spCount,r1_sp,r2_sp,plotignore,alphahp,surfacenum)
	
	 x_corner1              = zeros(spCount,2);
	 x_corner2              = zeros(spCount,2);
	 x_corner3              = zeros(spCount,2);
	 x_corner4              = zeros(spCount,2);
	 
	% displacement = zeros(spCount,1);
	velocity = zeros(spCount,1);
	% strain = zeros(spCount,1);
	spnum=0;
	x_sp_plot=zeros(1,2);
	splot_plot=zeros(1,1);
	for sp=1:spCount
		if plotignore(sp)
			continue;
		elseif alphahp(sp,surfacenum)==0
			continue;
		end
		spnum=spnum+1;
		x_sp_plot(spnum,:)=x_sp(sp,:);
		splot_plot(spnum)=alphahp(sp,surfacenum);
	end
	
	for sp=1:spCount
		 x_corner1(sp,:) = x_sp(sp,:) - r1_sp(sp,:) - r2_sp(sp,:);      % Position of corner 1
		 x_corner2(sp,:) = x_sp(sp,:) + r1_sp(sp,:) - r2_sp(sp,:);
		 x_corner3(sp,:) = x_sp(sp,:) + r1_sp(sp,:) + r2_sp(sp,:);
		 x_corner4(sp,:) = x_sp(sp,:) - r1_sp(sp,:) + r2_sp(sp,:);
	 end
	
	StressProfile1=figure;
	 set(StressProfile1, 'visible','off');
	sz = 40;
	%color = velocity;
	color = splot_plot;
	scatter(x_sp_plot(:,1),x_sp_plot(:,2),sz,color,'filled');
	hold on
	daspect([1 1 1]);
	for sp=1:spCount
		x_cor = [x_corner1(sp,1) x_corner2(sp,1) x_corner3(sp,1) x_corner4(sp,1) x_corner1(sp,1)];
		y_cor = [x_corner1(sp,2) x_corner2(sp,2) x_corner3(sp,2) x_corner4(sp,2) x_corner1(sp,2)];
		plot(x_cor,y_cor,'r')
	end
	grid on
	axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
	set(gca,'xtick',[0:20:max(LOC(:,1))]);
	set(gca,'ytick',[0:20:max(LOC(:,2))]);
	h=colorbar;
	colormap(jet(256))
	set(gca,'FontSize',20)
	% set(h, 'ytick', [0:0.2:1.2]);a
	caxis(climit);
	%set(gca,'ctick',[0:8]);
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [StressProfile1]=Plot_Final2_f_plot(t_time,tt,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,plotignore,f_final_vect,alphahp)
	
	 x_corner1              = zeros(spCount,2);
	 x_corner2              = zeros(spCount,2);
	 x_corner3              = zeros(spCount,2);
	 x_corner4              = zeros(spCount,2);
	 
	% displacement = zeros(spCount,1);
	velocity = zeros(spCount,1);
	% strain = zeros(spCount,1);
	spnum=0;
	x_sp_plot=zeros(1,2);
	splot_plot=zeros(1,1);
	for sp=1:spCount
		if plotignore(sp)
			continue;
		elseif max(alphahp(sp,:))==0
			continue;
		end
		spnum=spnum+1;
		x_sp_plot(spnum,:)=x_sp(sp,:);
		splot_plot(spnum)=FindMax(f_final_vect(sp,:));
	end
	
	for sp=1:spCount
		 x_corner1(sp,:) = x_sp(sp,:) - r1_sp(sp,:) - r2_sp(sp,:);      % Position of corner 1
		 x_corner2(sp,:) = x_sp(sp,:) + r1_sp(sp,:) - r2_sp(sp,:);
		 x_corner3(sp,:) = x_sp(sp,:) + r1_sp(sp,:) + r2_sp(sp,:);
		 x_corner4(sp,:) = x_sp(sp,:) - r1_sp(sp,:) + r2_sp(sp,:);
	 end
	
	StressProfile1=figure;
	 set(StressProfile1, 'visible','off');
	sz = 10;
	%color = velocity;
	color = splot_plot;
	scatter(x_sp_plot(:,1),x_sp_plot(:,2),sz,color,'filled');
	hold on
	daspect([1 1 1]);
	title(['tt=' num2str(tt) ', d=' num2str(DispPump)]);
	set(StressProfile1,'Position',[0 0 720 1280]);
	for sp=1:spCount
		x_cor = [x_corner1(sp,1) x_corner2(sp,1) x_corner3(sp,1) x_corner4(sp,1) x_corner1(sp,1)];
		y_cor = [x_corner1(sp,2) x_corner2(sp,2) x_corner3(sp,2) x_corner4(sp,2) x_corner1(sp,2)];
		plot(x_cor,y_cor,'r')
	end
	grid on
	axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
	set(gca,'xtick',[0:20:max(LOC(:,1))]);
	set(gca,'ytick',[0:20:max(LOC(:,2))]);
	h=colorbar;
	colormap(jet(256))
	set(gca,'FontSize',20)
	% set(h, 'ytick', [0:0.2:1.2]);a
	caxis([0 7]);
	%set(gca,'ctick',[0:8]);
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%function not in use
function CurrentConfig = Plot_Current_var(x_sp,LOC,LOCX,LOCY,orientationoffset,xdirletter,ydirletter,lp,F_sp)
	
    CurrentConfig=figure;
    plot(x_sp(:,1),x_sp(:,2),'o');
    hold on
    daspect([1 1 1]);
    lp_take=sum(sum(lp))/(size(lp,1)*size(lp,2));
    for i=1:length(orientationoffset)
        if length(xdirletter{i})==1 && xdirletter{i}=='l'
        elseif length(ydirletter{i})==1 && ydirletter{i}=='l'
            orientationoffset(i)=orientationoffset(i)+pi/2;
        elseif length(xdirletter{i})==1 && xdirletter{i}=='t'
        elseif length(ydirletter{i})==1 && ydirletter{i}=='t'
            orientationoffset(i)=orientationoffset(i)+pi/2;
        else
            continue
        end
        Rback=poldecomp(F_sp{i},0);
        R=transpose(Rback);
        totalangle=asin(R(1,2))+orientationoffset(i);
        xstart=x_sp(i,1)-lp_take*sqrt(2)/2*cos(totalangle);
        xend=x_sp(i,1)+lp_take*sqrt(2)/2*cos(totalangle);
        ystart=x_sp(i,2)-lp_take*sqrt(2)/2*sin(totalangle);
        yend=x_sp(i,2)+lp_take*sqrt(2)/2*sin(totalangle);
        plot([xstart xend],[ystart yend],'color','red');
    end
    title('initial condition');
    grid on
    axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
    set(gca,'xtick',LOCX);
    set(gca,'ytick',LOCY);
    % set(gca,'XTickLabel',[]);
    % set(gca,'YTickLabel',[]);
    hold off
end
%function not in use
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function CurrentConfig = Plot_CrackDirNairn(x_sp,LOC,orientationoffset,xdirletter,ydirletter,lp,le,F_sp,thetacrack,x_crack,x_cracktop,x_crackbot)
	
    CurrentConfig=figure;
    set(CurrentConfig, 'visible','off');
    plot(x_sp(:,1),x_sp(:,2),'o');
    hold on
    daspect([1 1 1]);
    %set(CurrentConfig,'Position',[0 0 720 1280]);
    lp_take=max(lp);
    for i=1:length(orientationoffset)
        if length(xdirletter{i})==1 && xdirletter{i}=='l'
        elseif length(ydirletter{i})==1 && ydirletter{i}=='l'
            orientationoffset(i)=orientationoffset(i)+pi/2;
        elseif length(xdirletter{i})==1 && xdirletter{i}=='t'
        elseif length(ydirletter{i})==1 && ydirletter{i}=='t'
            orientationoffset(i)=orientationoffset(i)+pi/2;
        else
            continue;
        end
        Rback=poldecomp(F_sp{i},0);
        R=transpose(Rback);
        %totalangle=asin(R(1,2))+orientationoffset(i);
		if isnan(thetacrack(i))
		elseif isinf(thetacrack(i))
		else
			totalangle=thetacrack(i);
			xstart=x_sp(i,1)-lp_take*sqrt(2)/2*cos(totalangle);
			xend=x_sp(i,1)+lp_take*sqrt(2)/2*cos(totalangle);
			ystart=x_sp(i,2)-lp_take*sqrt(2)/2*sin(totalangle);
			yend=x_sp(i,2)+lp_take*sqrt(2)/2*sin(totalangle);
			plot([xstart xend],[ystart yend],'color','red');
		end
    end
    if length(x_crack)==0
    else
        plot(x_cracktop(:,1),x_cracktop(:,2),'o','Color','red');
        plot(x_crack(:,1),x_crack(:,2),'o','Color','green');
        plot(x_crackbot(:,1),x_crackbot(:,2),'o','Color','blue');
    end
	title('Proposed Crack');
    grid on
    axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
    set(gca,'xtick',[0:le(1):max(LOC(:,1))]);
    set(gca,'ytick',[0:le(2):max(LOC(:,2))]);
    % set(gca,'XTickLabel',[]);
    % set(gca,'YTickLabel',[]);
    hold off
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function CurrentConfig = Plot_CrackDirNairn_multi(x_sp,LOC,orientationoffset,xdirletter,ydirletter,lp,le,F_sp,thetacrack,x_crack,x_cracktop,x_crackbot)
    CurrentConfig=figure;
    set(CurrentConfig, 'visible','off');
    plot(x_sp(:,1),x_sp(:,2),'o');
    hold on
    daspect([1 1 1]);
    %set(CurrentConfig,'Position',[0 0 720 1280]);
    lp_take=max(lp);
    for i=1:length(orientationoffset)
        if length(xdirletter{i})==1 && xdirletter{i}=='l'
        elseif length(ydirletter{i})==1 && ydirletter{i}=='l'
            orientationoffset(i)=orientationoffset(i)+pi/2;
        elseif length(xdirletter{i})==1 && xdirletter{i}=='t'
        elseif length(ydirletter{i})==1 && ydirletter{i}=='t'
            orientationoffset(i)=orientationoffset(i)+pi/2;
        else
            continue;
        end
        Rback=poldecomp(F_sp{i},0);
        R=transpose(Rback);
        %totalangle=asin(R(1,2))+orientationoffset(i);
		if isnan(thetacrack(i))
		elseif isinf(thetacrack(i))
		else
			totalangle=thetacrack(i);
			xstart=x_sp(i,1)-lp_take*sqrt(2)/2*cos(totalangle);
			xend=x_sp(i,1)+lp_take*sqrt(2)/2*cos(totalangle);
			ystart=x_sp(i,2)-lp_take*sqrt(2)/2*sin(totalangle);
			yend=x_sp(i,2)+lp_take*sqrt(2)/2*sin(totalangle);
			plot([xstart xend],[ystart yend],'color','red');
		end
    end
    for icrackpath=1:length(x_crack)
        plot(x_cracktop{icrackpath}(:,1),x_cracktop{icrackpath}(:,2),'o','Color','red');
        plot(x_crack{icrackpath}(:,1),x_crack{icrackpath}(:,2),'o','Color','green');
        plot(x_crackbot{icrackpath}(:,1),x_crackbot{icrackpath}(:,2),'o','Color','blue');
    end
	title('Proposed Crack');
    grid on
    axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
    set(gca,'xtick',[0:le(1):max(LOC(:,1))]);
    set(gca,'ytick',[0:le(2):max(LOC(:,2))]);
    % set(gca,'XTickLabel',[]);
    % set(gca,'YTickLabel',[]);
    hold off
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function CurrentConfig = Plot_CrackDirNairn_multilines(x_sp,LOC,orientationoffset,xdirletter,ydirletter,lp,le,F_sp,thetacrack,x_crack,x_cracktop,x_crackbot,CasetoRun)
    CurrentConfig=figure;
    set(CurrentConfig, 'visible','off');
    plot(x_sp(:,1),x_sp(:,2),'o');
    hold on
    daspect([1 1 1]);
	if CasetoRun==105 || CasetoRun==110
		set(CurrentConfig,'Position',[0 0 1800 1800]);
	end
    lp_take=max(lp);
    for i=1:length(orientationoffset)
        if length(xdirletter{i})==1 && xdirletter{i}=='l'
        elseif length(ydirletter{i})==1 && ydirletter{i}=='l'
            orientationoffset(i)=orientationoffset(i)+pi/2;
        elseif length(xdirletter{i})==1 && xdirletter{i}=='t'
        elseif length(ydirletter{i})==1 && ydirletter{i}=='t'
            orientationoffset(i)=orientationoffset(i)+pi/2;
        else
            continue;
        end
        Rback=poldecomp(F_sp{i},0);
        R=transpose(Rback);
        %totalangle=asin(R(1,2))+orientationoffset(i);
		if isnan(thetacrack(i))
		elseif isinf(thetacrack(i))
		else
			totalangle=thetacrack(i);
			xstart=x_sp(i,1)-lp_take*sqrt(2)/2*cos(totalangle);
			xend=x_sp(i,1)+lp_take*sqrt(2)/2*cos(totalangle);
			ystart=x_sp(i,2)-lp_take*sqrt(2)/2*sin(totalangle);
			yend=x_sp(i,2)+lp_take*sqrt(2)/2*sin(totalangle);
			plot([xstart xend],[ystart yend],'color','red');
		end
    end
    for icrackpath=1:length(x_crack)
		if CasetoRun==117
			plot(x_cracktop{icrackpath}(:,1),x_cracktop{icrackpath}(:,2),'x-','Color','red');
			plot(x_crack{icrackpath}(:,1),x_crack{icrackpath}(:,2),'x-','Color','black','LineWidth',2);
			plot(x_crackbot{icrackpath}(:,1),x_crackbot{icrackpath}(:,2),'x-','Color','blue');
		else
			%plot(x_cracktop{icrackpath}(:,1),x_cracktop{icrackpath}(:,2),'o','Color','red');
			plot(x_crack{icrackpath}(:,1),x_crack{icrackpath}(:,2),'-','Color','black','LineWidth',2);
			%plot(x_crackbot{icrackpath}(:,1),x_crackbot{icrackpath}(:,2),'o','Color','blue');
		end
    end
	title('Proposed Crack');
    grid on
    axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
    set(gca,'xtick',[0:le(1):max(LOC(:,1))]);
    set(gca,'ytick',[0:le(2):max(LOC(:,2))]);
    % set(gca,'XTickLabel',[]);
    % set(gca,'YTickLabel',[]);
    hold off
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function CurrentConfig = Plot_CrackDir(x_sp,LOC,orientationoffset,xdirletter,ydirletter,lp,le,F_sp,thetacrack)
	
    CurrentConfig=figure;
    set(CurrentConfig, 'visible','off');
    plot(x_sp(:,1),x_sp(:,2),'o');
    hold on
    daspect([1 1 1]);
    set(CurrentConfig,'Position',[0 0 720 1280]);
    lp_take=max(lp);
    for i=1:length(orientationoffset)
        if length(xdirletter{i})==1 && xdirletter{i}=='l'
        elseif length(ydirletter{i})==1 && ydirletter{i}=='l'
            orientationoffset(i)=orientationoffset(i)+pi/2;
        elseif length(xdirletter{i})==1 && xdirletter{i}=='t'
        elseif length(ydirletter{i})==1 && ydirletter{i}=='t'
            orientationoffset(i)=orientationoffset(i)+pi/2;
        else
            continue;
        end
        Rback=poldecomp(F_sp{i},0);
        R=transpose(Rback);
        %totalangle=asin(R(1,2))+orientationoffset(i);
		if isnan(thetacrack(i))
		elseif isinf(thetacrack(i))
		else
			totalangle=thetacrack(i);
			xstart=x_sp(i,1)-lp_take*sqrt(2)/2*cos(totalangle);
			xend=x_sp(i,1)+lp_take*sqrt(2)/2*cos(totalangle);
			ystart=x_sp(i,2)-lp_take*sqrt(2)/2*sin(totalangle);
			yend=x_sp(i,2)+lp_take*sqrt(2)/2*sin(totalangle);
			plot([xstart xend],[ystart yend],'color','red');
		end
    end
    
	title('Proposed Crack');
    grid on
    axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
    set(gca,'xtick',[0:le(1):max(LOC(:,1))]);
    set(gca,'ytick',[0:le(2):max(LOC(:,2))]);
    % set(gca,'XTickLabel',[]);
    % set(gca,'YTickLabel',[]);
    hold off
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function CurrentConfig = Plot_Current(x_sp,LOC,orientationoffset,xdirletter,ydirletter,lp,le,F_sp)
	
    CurrentConfig=figure;
    set(CurrentConfig, 'visible','off');
    plot(x_sp(:,1),x_sp(:,2),'o');
    hold on
    daspect([1 1 1]);
    set(CurrentConfig,'Position',[0 0 720 1280]);
    lp_take=max(lp);
    for i=1:length(orientationoffset)
        if length(xdirletter{i})==1 && xdirletter{i}=='l'
        elseif length(ydirletter{i})==1 && ydirletter{i}=='l'
            orientationoffset(i)=orientationoffset(i)+pi/2;
        elseif length(xdirletter{i})==1 && xdirletter{i}=='t'
        elseif length(ydirletter{i})==1 && ydirletter{i}=='t'
            orientationoffset(i)=orientationoffset(i)+pi/2;
        else
            continue;
        end
        Rback=poldecomp(F_sp{i},0);
        R=transpose(Rback);
        totalangle=asin(R(1,2))+orientationoffset(i);
        xstart=x_sp(i,1)-lp_take*sqrt(2)/2*cos(totalangle);
        xend=x_sp(i,1)+lp_take*sqrt(2)/2*cos(totalangle);
        ystart=x_sp(i,2)-lp_take*sqrt(2)/2*sin(totalangle);
        yend=x_sp(i,2)+lp_take*sqrt(2)/2*sin(totalangle);
        plot([xstart xend],[ystart yend],'color','red');
    end
    title('Current Config');
    grid on
    axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
    set(gca,'xtick',[0:le(1):max(LOC(:,1))]);
    set(gca,'ytick',[0:le(2):max(LOC(:,2))]);
    % set(gca,'XTickLabel',[]);
    % set(gca,'YTickLabel',[]);
    hold off
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [StressProfile1]=Plot_Final2_regularclimit(t_time,tt,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,splot,climits,plotignore)
	
	 x_corner1              = zeros(spCount,2);
	 x_corner2              = zeros(spCount,2);
	 x_corner3              = zeros(spCount,2);
	 x_corner4              = zeros(spCount,2);
	 
	% displacement = zeros(spCount,1);
	velocity = zeros(spCount,1);
	% strain = zeros(spCount,1);
	for sp=1:spCount
	%     displacement(sp) = sqrt(d_sp(sp,1)^2+d_sp(sp,2)^2);
		velocity(sp) = sqrt(v_ssp(sp,1)^2+v_ssp(sp,2)^2);
	%     strain(sp) = sqrt(e_sp(sp,1)^2+e_sp(sp,2)^2);
	end
	spnum=0;
	x_sp_plot=zeros(spCount-sum(plotignore),2);
	splot_plot=zeros(spCount-sum(plotignore),1);
	for sp=1:spCount
		if plotignore(sp)
			continue;
		end
		spnum=spnum+1;
		x_sp_plot(spnum,:)=x_sp(sp,:);
		splot_plot(spnum)=splot(sp);
	end
	
	for sp=1:spCount
	   
		 x_corner1(sp,:) = x_sp(sp,:) - r1_sp(sp,:) - r2_sp(sp,:);      % Position of corner 1
		 x_corner2(sp,:) = x_sp(sp,:) + r1_sp(sp,:) - r2_sp(sp,:);
		 x_corner3(sp,:) = x_sp(sp,:) + r1_sp(sp,:) + r2_sp(sp,:);
		 x_corner4(sp,:) = x_sp(sp,:) - r1_sp(sp,:) + r2_sp(sp,:);
	 end
	
	StressProfile1=figure;
	 set(StressProfile1, 'visible','off');
	sz = 40;
	%color = velocity;
	color = splot_plot;
	scatter(x_sp_plot(:,1),x_sp_plot(:,2),sz,color,'filled');
	hold on
	daspect([1 1 1]);
	title(['tt=' num2str(tt) ', d=' num2str(DispPump)]);
	%set(StressProfile1,'Position',[0 0 720 1280]);
	for sp=1:spCount
		x_cor = [x_corner1(sp,1) x_corner2(sp,1) x_corner3(sp,1) x_corner4(sp,1) x_corner1(sp,1)];
		y_cor = [x_corner1(sp,2) x_corner2(sp,2) x_corner3(sp,2) x_corner4(sp,2) x_corner1(sp,2)];
		plot(x_cor,y_cor,'r')
	end
	grid on
	axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
	set(gca,'xtick',[0:20:max(LOC(:,1))]);
	set(gca,'ytick',[0:20:max(LOC(:,2))]);
	h=colorbar;
	colormap(jet(256))
	set(gca,'FontSize',20)
	% set(h, 'ytick', [0:0.2:1.2]);
	if exist('climits')
		if length(climits)>0
			if climits(2)>climits(1);
				caxis(climits);
			end
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [StressProfile1]=Plot_Final2_regularclimit_multiline(t_time,tt,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,splot,climits,plotignore)
	 x_corner1              = zeros(spCount,2);
	 x_corner2              = zeros(spCount,2);
	 x_corner3              = zeros(spCount,2);
	 x_corner4              = zeros(spCount,2);
	 
	% displacement = zeros(spCount,1);
	velocity = zeros(spCount,1);
	% strain = zeros(spCount,1);
	for sp=1:spCount
	%     displacement(sp) = sqrt(d_sp(sp,1)^2+d_sp(sp,2)^2);
		velocity(sp) = sqrt(v_ssp(sp,1)^2+v_ssp(sp,2)^2);
	%     strain(sp) = sqrt(e_sp(sp,1)^2+e_sp(sp,2)^2);
	end
	spnum=0;
	x_sp_plot=zeros(spCount-sum(plotignore),2);
	splot_plot=zeros(spCount-sum(plotignore),1);
	for sp=1:spCount
		if plotignore(sp)
			continue;
		end
		spnum=spnum+1;
		x_sp_plot(spnum,:)=x_sp(sp,:);
		splot_plot(spnum)=splot(sp);
	end

	for sp=1:spCount
	   
		 x_corner1(sp,:) = x_sp(sp,:) - r1_sp(sp,:) - r2_sp(sp,:);      % Position of corner 1
		 x_corner2(sp,:) = x_sp(sp,:) + r1_sp(sp,:) - r2_sp(sp,:);
		 x_corner3(sp,:) = x_sp(sp,:) + r1_sp(sp,:) + r2_sp(sp,:);
		 x_corner4(sp,:) = x_sp(sp,:) - r1_sp(sp,:) + r2_sp(sp,:);
	 end

	StressProfile1=figure;
	 set(StressProfile1, 'visible','off');
	sz = 40;
	%color = velocity;
	color = splot_plot;
	scatter(x_sp_plot(:,1),x_sp_plot(:,2),sz,color,'filled');
	hold on
	daspect([1 1 1]);
	title(['tt=' num2str(tt) ', d=' num2str(DispPump)]);
	%set(StressProfile1,'Position',[0 0 720 1280]);
	for sp=1:spCount
		x_cor = [x_corner1(sp,1) x_corner2(sp,1) x_corner3(sp,1) x_corner4(sp,1) x_corner1(sp,1)];
		y_cor = [x_corner1(sp,2) x_corner2(sp,2) x_corner3(sp,2) x_corner4(sp,2) x_corner1(sp,2)];
		plot(x_cor,y_cor,'r')
	end
	grid on
	axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
	set(gca,'xtick',[0:20:max(LOC(:,1))]);
	set(gca,'ytick',[0:20:max(LOC(:,2))]);
	h=colorbar;
	colormap(jet(256))
	set(gca,'FontSize',20)
	% set(h, 'ytick', [0:0.2:1.2]);
	if exist('climits')
		if length(climits)>0
			if climits(2)>climits(1);
				caxis(climits);
			end
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [StressProfile1]=Plot_Final2_regularclimit_black(t_time,tt,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,splot,climits,plotignore,CasetoRun)
	
	 x_corner1              = zeros(spCount,2);
	 x_corner2              = zeros(spCount,2);
	 x_corner3              = zeros(spCount,2);
	 x_corner4              = zeros(spCount,2);
	 
	% displacement = zeros(spCount,1);
	velocity = zeros(spCount,1);
	% strain = zeros(spCount,1);
	for sp=1:spCount
	%     displacement(sp) = sqrt(d_sp(sp,1)^2+d_sp(sp,2)^2);
		velocity(sp) = sqrt(v_ssp(sp,1)^2+v_ssp(sp,2)^2);
	%     strain(sp) = sqrt(e_sp(sp,1)^2+e_sp(sp,2)^2);
	end
	spnum=0;
	x_sp_plot=zeros(spCount-sum(plotignore),2);
	splot_plot=zeros(spCount-sum(plotignore),1);
	for sp=1:spCount
		if plotignore(sp)
			continue;
		end
		spnum=spnum+1;
		x_sp_plot(spnum,:)=x_sp(sp,:);
		splot_plot(spnum)=splot(sp);
	end
	
	for sp=1:spCount
	   
		 x_corner1(sp,:) = x_sp(sp,:) - r1_sp(sp,:) - r2_sp(sp,:);      % Position of corner 1
		 x_corner2(sp,:) = x_sp(sp,:) + r1_sp(sp,:) - r2_sp(sp,:);
		 x_corner3(sp,:) = x_sp(sp,:) + r1_sp(sp,:) + r2_sp(sp,:);
		 x_corner4(sp,:) = x_sp(sp,:) - r1_sp(sp,:) + r2_sp(sp,:);
	end

	StressProfile1=figure;
	 set(StressProfile1, 'visible','off');
	 if CasetoRun==10
		 sz = 140;
	 else
		sz = 80;
	 end
	%color = velocity;
	color = splot_plot;
	scatter(x_sp_plot(:,1),x_sp_plot(:,2),sz,color,'filled');
	hold on
	daspect([1 1 1]);
	%title(['tt=' num2str(tt) ', d=' num2str(DispPump)]);
	set(StressProfile1,'Position',[0 0 1000 1000]);
	for sp=1:spCount
		x_cor = [x_corner1(sp,1) x_corner2(sp,1) x_corner3(sp,1) x_corner4(sp,1) x_corner1(sp,1)];
		y_cor = [x_corner1(sp,2) x_corner2(sp,2) x_corner3(sp,2) x_corner4(sp,2) x_corner1(sp,2)];
		if plotignore(sp)
			x_cross1=[x_corner1(sp,1) x_corner3(sp,1)];
			y_cross1=[x_corner1(sp,2) x_corner3(sp,2)];
			x_cross2=[x_corner2(sp,1) x_corner4(sp,1)];
			y_cross2=[x_corner2(sp,2) x_corner4(sp,2)];
			plot(x_cross1,y_cross1,'r');
			plot(x_cross2,y_cross2,'r');
		end
		plot(x_cor,y_cor,'r')
	end
	grid on
	if CasetoRun==10
		axis([0,max(LOC(:,1)),0,160]);
	else
		axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
	end
	set(gca,'xtick',[0:20:max(LOC(:,1))]);
	if CasetoRun==10
		set(gca,'ytick',[0:20:160]);
	else
		set(gca,'ytick',[0:20:max(LOC(:,2))]);
	end
	h=colorbar;
	currentcolormap1=jet(256);
	currentcolormap2=currentcolormap1;
	colormap(currentcolormap2)
	set(gca,'FontSize',40)
	% set(h, 'ytick', [0:0.2:1.2]);
	if exist('climits')
		if length(climits)>0
			if climits(2)>climits(1);
				caxis(climits);
			end
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [StressProfile1]=Plot_Final2_regularnolimit(x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,splot)
	
	 x_corner1              = zeros(spCount,2);
	 x_corner2              = zeros(spCount,2);
	 x_corner3              = zeros(spCount,2);
	 x_corner4              = zeros(spCount,2);
	 
	% displacement = zeros(spCount,1);
	velocity = zeros(spCount,1);
	% strain = zeros(spCount,1);
	for sp=1:spCount
	%     displacement(sp) = sqrt(d_sp(sp,1)^2+d_sp(sp,2)^2);
		velocity(sp) = sqrt(v_ssp(sp,1)^2+v_ssp(sp,2)^2);
	%     strain(sp) = sqrt(e_sp(sp,1)^2+e_sp(sp,2)^2);
	end
	
	 for sp=1:spCount
	 x_corner1(sp,:) = x_sp(sp,:) - r1_sp(sp,:) - r2_sp(sp,:);      % Position of corner 1
	 x_corner2(sp,:) = x_sp(sp,:) + r1_sp(sp,:) - r2_sp(sp,:);
	 x_corner3(sp,:) = x_sp(sp,:) + r1_sp(sp,:) + r2_sp(sp,:);
	 x_corner4(sp,:) = x_sp(sp,:) - r1_sp(sp,:) + r2_sp(sp,:);
	 end
	
	StressProfile1=figure;
	 set(StressProfile1, 'visible','off');
	sz = 40;
	%color = velocity;
	color = splot;
	scatter(x_sp(:,1),x_sp(:,2),sz,color,'filled');
	hold on
	daspect([1 1 1]);
	for sp=1:spCount
		x_cor = [x_corner1(sp,1) x_corner2(sp,1) x_corner3(sp,1) x_corner4(sp,1) x_corner1(sp,1)];
		y_cor = [x_corner1(sp,2) x_corner2(sp,2) x_corner3(sp,2) x_corner4(sp,2) x_corner1(sp,2)];
		plot(x_cor,y_cor,'r')
	end
	grid on
	axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
	set(gca,'xtick',[0:20:max(LOC(:,1))]);
	set(gca,'ytick',[0:20:max(LOC(:,2))]);
	h=colorbar;
	colormap(jet(256))
	set(gca,'FontSize',20)
	% set(h, 'ytick', [0:0.2:1.2]);
	%{
	if exist('climits')
		if length(climits)>0
			if climits(2)>climits(1);
				caxis(climits);
			end
		end
	end
	%}
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [StressProfile1,e_pl_max,e_pl_min,e_pl_shear]=Plot_Final2_principalclimit_ovl(t_time,tt,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,e_pl_sp,climits,maxminshear,ActuallyPlot,plotignore)
	
	 x_corner1              = zeros(spCount,2);
	 x_corner2              = zeros(spCount,2);
	 x_corner3              = zeros(spCount,2);
	 x_corner4              = zeros(spCount,2);
	 
	% displacement = zeros(spCount,1);
	velocity = zeros(spCount,1);
	% strain = zeros(spCount,1);
	
	for sp=1:spCount
	%     displacement(sp) = sqrt(d_sp(sp,1)^2+d_sp(sp,2)^2);
		velocity(sp) = sqrt(v_ssp(sp,1)^2+v_ssp(sp,2)^2);
	%     strain(sp) = sqrt(e_sp(sp,1)^2+e_sp(sp,2)^2);
	end
	
	
	 for sp=1:spCount
	 x_corner1(sp,:) = x_sp(sp,:) - r1_sp(sp,:) - r2_sp(sp,:);      % Position of corner 1
	 x_corner2(sp,:) = x_sp(sp,:) + r1_sp(sp,:) - r2_sp(sp,:);
	 x_corner3(sp,:) = x_sp(sp,:) + r1_sp(sp,:) + r2_sp(sp,:);
	 x_corner4(sp,:) = x_sp(sp,:) - r1_sp(sp,:) + r2_sp(sp,:);
	 end
	
	 %%Calculating Max Princ Plast Strain
	 for sp=1:spCount
		 theta=1/2*atan(2*e_pl_sp(sp,3)/(e_pl_sp(sp,1)-e_pl_sp(sp,2)));
		 e_pl_first=(e_pl_sp(sp,1)+e_pl_sp(sp,2))/2+(e_pl_sp(sp,1)-e_pl_sp(sp,2))/2*cos(2*theta)+e_pl_sp(sp,3)*sin(2*theta);
		 e_pl_second=(e_pl_sp(sp,1)+e_pl_sp(sp,2))/2-(e_pl_sp(sp,1)-e_pl_sp(sp,2))/2*cos(2*theta)-e_pl_sp(sp,3)*sin(2*theta);
		 e_pl_max(sp)=max(e_pl_first,e_pl_second);
		 e_pl_min(sp)=min(e_pl_first,e_pl_second);
		 e_pl_shear(sp)=(e_pl_max(sp)-e_pl_min(sp))/2;
		 if plotignore(sp)
		 else
			if maxminshear==1
				if isnan(e_pl_max(sp)) || isinf(e_pl_max(sp))
					e_pl_max(sp)=0;
				end
			elseif maxminshear==2
				if isnan(e_pl_min(sp)) || isinf(e_pl_min(sp))
					e_pl_min(sp)=0;
				end
			elseif maxminshear==3
				if isnan(e_pl_shear(sp)) || isinf(e_pl_shear(sp))
					e_pl_shear(sp)=0;
				end
			else
				disp('wrong maxminshear input!');
				pause
			end
		 end
	 end
	 if ActuallyPlot==1
		StressProfile1=figure;
		 set(StressProfile1, 'visible','off');
		sz = 30;
		%color = velocity;
		if maxminshear==1
			color = e_pl_max;
		elseif maxminshear==2
			color = e_pl_min;
		elseif maxminshear==3
			color = e_pl_shear;
		else
			disp('wrong maxminshear input!');
			pause
		end
		scatter(x_sp(:,1),x_sp(:,2),sz,color,'filled');
		hold on
		daspect([1 1 1]);
		title(['tt=' num2str(tt) ', d=' num2str(DispPump)]);
		set(StressProfile1,'Position',[0 0 5760 10240]);
		set(gca,'color','none');
		for sp=1:spCount
			if plotignore(sp)
			else
				x_cor = [x_corner1(sp,1) x_corner2(sp,1) x_corner3(sp,1) x_corner4(sp,1) x_corner1(sp,1)];
				y_cor = [x_corner1(sp,2) x_corner2(sp,2) x_corner3(sp,2) x_corner4(sp,2) x_corner1(sp,2)];
				plot(x_cor,y_cor,'r','LineWidth',2)
			end
		end
		grid on
		axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
		set(gca,'xtick',[0:inf:max(LOC(:,1))]);
		set(gca,'ytick',[0:inf:max(LOC(:,2))]);
		%h=colorbar;
		colormap(jet(256))
		% set(h, 'ytick', [0:0.2:1.2]);
		set(gca,'FontSize',1)
	else
		StressProfile1=[];
	end
	if exist('climits')
		if length(climits)>0
			if climits(2)>climits(1)
				caxis(climits);
			end
		end
	end

end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [StressProfile1,e_pl_max,e_pl_min,e_pl_shear]=Plot_Final2_principalclimit_report(matmodel,CasetoRun,t_time,tt,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,e_pl_sp,climits,maxminshear,ActuallyPlot)
	
	 x_corner1              = zeros(spCount,2);
	 x_corner2              = zeros(spCount,2);
	 x_corner3              = zeros(spCount,2);
	 x_corner4              = zeros(spCount,2);
	 
	% displacement = zeros(spCount,1);
	velocity = zeros(spCount,1);
	% strain = zeros(spCount,1);
	
	for sp=1:spCount
	%     displacement(sp) = sqrt(d_sp(sp,1)^2+d_sp(sp,2)^2);
		velocity(sp) = sqrt(v_ssp(sp,1)^2+v_ssp(sp,2)^2);
	%     strain(sp) = sqrt(e_sp(sp,1)^2+e_sp(sp,2)^2);
	end
	
	
	 for sp=1:spCount
	 x_corner1(sp,:) = x_sp(sp,:) - r1_sp(sp,:) - r2_sp(sp,:);      % Position of corner 1
	 x_corner2(sp,:) = x_sp(sp,:) + r1_sp(sp,:) - r2_sp(sp,:);
	 x_corner3(sp,:) = x_sp(sp,:) + r1_sp(sp,:) + r2_sp(sp,:);
	 x_corner4(sp,:) = x_sp(sp,:) - r1_sp(sp,:) + r2_sp(sp,:);
	 end
	
	 %%Calculating Max Princ Plast Strain
	 for sp=1:spCount
		 theta=1/2*atan(2*e_pl_sp(sp,3)/(e_pl_sp(sp,1)-e_pl_sp(sp,2)));
		 e_pl_first=(e_pl_sp(sp,1)+e_pl_sp(sp,2))/2+(e_pl_sp(sp,1)-e_pl_sp(sp,2))/2*cos(2*theta)+e_pl_sp(sp,3)*sin(2*theta);
		 e_pl_second=(e_pl_sp(sp,1)+e_pl_sp(sp,2))/2-(e_pl_sp(sp,1)-e_pl_sp(sp,2))/2*cos(2*theta)-e_pl_sp(sp,3)*sin(2*theta);
		 e_pl_max(sp)=max(e_pl_first,e_pl_second);
		 e_pl_min(sp)=min(e_pl_first,e_pl_second);
		 e_pl_shear(sp)=(e_pl_max(sp)-e_pl_min(sp))/2;
		 if matmodel(sp)~=1
		 else
			if maxminshear==1
				if isnan(e_pl_max(sp)) || isinf(e_pl_max(sp))
					e_pl_max(sp)=0;
				end
			elseif maxminshear==2
				if isnan(e_pl_min(sp)) || isinf(e_pl_min(sp))
					e_pl_min(sp)=0;
				end
			elseif maxminshear==3
				if isnan(e_pl_shear(sp)) || isinf(e_pl_shear(sp))
					e_pl_shear(sp)=0;
				end
			else
				disp('wrong maxminshear input!');
				pause
			end
		 end
	end
	 if ActuallyPlot==1
		StressProfile1=figure;
		 set(StressProfile1, 'visible','off');
		if CasetoRun==40 || CasetoRun==52 || CasetoRun==54
			sz = 20;
		elseif CasetoRun==61 || CasetoRun==62 || CasetoRun==63
			sz = 20;
		else
			sz = 10;
		end
		%color = velocity;
		if maxminshear==1
			color = e_pl_max;
		elseif maxminshear==2
			color = e_pl_min;
		elseif maxminshear==3
			color = e_pl_shear;
		else
			disp('wrong maxminshear input!');
			pause
		end
		scatter(x_sp(:,1),x_sp(:,2),sz,color,'filled');
		hold on
		daspect([1 1 1]);
		if CasetoRun==40 || CasetoRun==52 || CasetoRun==54
		elseif CasetoRun==61 || CasetoRun==62 || CasetoRun==63
		else
			title(['tt=' num2str(tt) ', d=' num2str(DispPump)]);
		end
		if CasetoRun==40 || CasetoRun==52 || CasetoRun==54
			set(StressProfile1,'Position',[0 0 600 960]);
		elseif CasetoRun==61 || CasetoRun==62 || CasetoRun==63
			set(StressProfile1,'Position',[0 0 600 960]);
		else
			set(StressProfile1,'Position',[0 0 720 1280]);
		end
		for sp=1:spCount
			x_cor = [x_corner1(sp,1) x_corner2(sp,1) x_corner3(sp,1) x_corner4(sp,1) x_corner1(sp,1)];
			y_cor = [x_corner1(sp,2) x_corner2(sp,2) x_corner3(sp,2) x_corner4(sp,2) x_corner1(sp,2)];
			plot(x_cor,y_cor,'r')
		end
		grid on
		if CasetoRun==40 || CasetoRun==52 || CasetoRun==54
			axis([0,max(LOC(:,1)),0,140]);
			set(gca,'xtick',[0:20:max(LOC(:,1))]);
			set(gca,'ytick',[0:20:140]);
		elseif CasetoRun==61 || CasetoRun==62 || CasetoRun==63
			axis([40,180,40,480]);
			set(gca,'xtick',[40:inf:180]);
			set(gca,'ytick',[40:inf:480]);
			axis off
		else
			axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
			set(gca,'xtick',[0:20:max(LOC(:,1))]);
			set(gca,'ytick',[0:20:max(LOC(:,2))]);
		end
		h=colorbar;
		colormap(jet(256))
		% set(h, 'ytick', [0:0.2:1.2]);
		if CasetoRun==40 || CasetoRun==52 || CasetoRun==54
			set(gca,'FontSize',30);
		else
			set(gca,'FontSize',20);
		end
	else
		StressProfile1=[];
	end
	if exist('climits')
		if length(climits)>0
			if climits(2)>climits(1)
				caxis(climits);
			end
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [StressProfile1,e_pl_max,e_pl_min,e_pl_shear]=Plot_Final2_principalclimit(t_time,tt,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,e_pl_sp,climits,maxminshear,ActuallyPlot)
	
	 x_corner1              = zeros(spCount,2);
	 x_corner2              = zeros(spCount,2);
	 x_corner3              = zeros(spCount,2);
	 x_corner4              = zeros(spCount,2);
	 
	% displacement = zeros(spCount,1);
	velocity = zeros(spCount,1);
	% strain = zeros(spCount,1);
	
	for sp=1:spCount
	%     displacement(sp) = sqrt(d_sp(sp,1)^2+d_sp(sp,2)^2);
		velocity(sp) = sqrt(v_ssp(sp,1)^2+v_ssp(sp,2)^2);
	%     strain(sp) = sqrt(e_sp(sp,1)^2+e_sp(sp,2)^2);
	end
	
	
	 for sp=1:spCount
	 x_corner1(sp,:) = x_sp(sp,:) - r1_sp(sp,:) - r2_sp(sp,:);      % Position of corner 1
	 x_corner2(sp,:) = x_sp(sp,:) + r1_sp(sp,:) - r2_sp(sp,:);
	 x_corner3(sp,:) = x_sp(sp,:) + r1_sp(sp,:) + r2_sp(sp,:);
	 x_corner4(sp,:) = x_sp(sp,:) - r1_sp(sp,:) + r2_sp(sp,:);
	 end

	 %%Calculating Max Princ Plast Strain
	 for sp=1:spCount
		 theta=1/2*atan(2*e_pl_sp(sp,3)/(e_pl_sp(sp,1)-e_pl_sp(sp,2)));
		 e_pl_first=(e_pl_sp(sp,1)+e_pl_sp(sp,2))/2+(e_pl_sp(sp,1)-e_pl_sp(sp,2))/2*cos(2*theta)+e_pl_sp(sp,3)*sin(2*theta);
		 e_pl_second=(e_pl_sp(sp,1)+e_pl_sp(sp,2))/2-(e_pl_sp(sp,1)-e_pl_sp(sp,2))/2*cos(2*theta)-e_pl_sp(sp,3)*sin(2*theta);
		 e_pl_max(sp)=max(e_pl_first,e_pl_second);
		 e_pl_min(sp)=min(e_pl_first,e_pl_second);
		 e_pl_shear(sp)=(e_pl_max(sp)-e_pl_min(sp))/2;
	 end
	 if ActuallyPlot==1
		StressProfile1=figure;
		 set(StressProfile1, 'visible','off');
		sz = 10;
		%color = velocity;
		if maxminshear==1
			color = e_pl_max;
		elseif maxminshear==2
			color = e_pl_min;
		elseif maxminshear==3
			color = e_pl_shear;
		else
			disp('wrong maxminshear input!');
			pause
		end
		scatter(x_sp(:,1),x_sp(:,2),sz,color,'filled');
		hold on
		daspect([1 1 1]);
		title(['tt=' num2str(tt) ', d=' num2str(DispPump)]);
		set(StressProfile1,'Position',[0 0 720 1280]);
		for sp=1:spCount
			x_cor = [x_corner1(sp,1) x_corner2(sp,1) x_corner3(sp,1) x_corner4(sp,1) x_corner1(sp,1)];
			y_cor = [x_corner1(sp,2) x_corner2(sp,2) x_corner3(sp,2) x_corner4(sp,2) x_corner1(sp,2)];
			plot(x_cor,y_cor,'r')
		end
		grid on
		axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
		set(gca,'xtick',[0:20:max(LOC(:,1))]);
		set(gca,'ytick',[0:20:max(LOC(:,2))]);
		h=colorbar;
		colormap(jet(256))
		% set(h, 'ytick', [0:0.2:1.2]);
		set(gca,'FontSize',20)
	else
		StressProfile1=[];
	end
	if exist('climits')
		if length(climits)>0
			if climits(2)>climits(1)
				caxis(climits);
			end
		end
	end
	
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [StressProfile1,e_pl_max,e_pl_min,e_pl_shear]=Plot_Final2_principalclimit_black(t_time,tt,DispPump,x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,e_pl_sp,climits,maxminshear,plotignore,ActuallyPlot,CasetoRun)
	
	 x_corner1              = zeros(spCount,2);
	 x_corner2              = zeros(spCount,2);
	 x_corner3              = zeros(spCount,2);
	 x_corner4              = zeros(spCount,2);
	 
	% displacement = zeros(spCount,1);
	velocity = zeros(spCount,1);
	% strain = zeros(spCount,1);
	
	for sp=1:spCount
	%     displacement(sp) = sqrt(d_sp(sp,1)^2+d_sp(sp,2)^2);
		velocity(sp) = sqrt(v_ssp(sp,1)^2+v_ssp(sp,2)^2);
	%     strain(sp) = sqrt(e_sp(sp,1)^2+e_sp(sp,2)^2);
	end
	
	
	 for sp=1:spCount
	 x_corner1(sp,:) = x_sp(sp,:) - r1_sp(sp,:) - r2_sp(sp,:);      % Position of corner 1
	 x_corner2(sp,:) = x_sp(sp,:) + r1_sp(sp,:) - r2_sp(sp,:);
	 x_corner3(sp,:) = x_sp(sp,:) + r1_sp(sp,:) + r2_sp(sp,:);
	 x_corner4(sp,:) = x_sp(sp,:) - r1_sp(sp,:) + r2_sp(sp,:);
	 end

	 %%Calculating Max Princ Plast Strain
	 for sp=1:spCount
		 theta=1/2*atan(2*e_pl_sp(sp,3)/(e_pl_sp(sp,1)-e_pl_sp(sp,2)));
		 e_pl_first=(e_pl_sp(sp,1)+e_pl_sp(sp,2))/2+(e_pl_sp(sp,1)-e_pl_sp(sp,2))/2*cos(2*theta)+e_pl_sp(sp,3)*sin(2*theta);
		 e_pl_second=(e_pl_sp(sp,1)+e_pl_sp(sp,2))/2-(e_pl_sp(sp,1)-e_pl_sp(sp,2))/2*cos(2*theta)-e_pl_sp(sp,3)*sin(2*theta);
		 e_pl_max(sp)=max(e_pl_first,e_pl_second);
		 e_pl_min(sp)=min(e_pl_first,e_pl_second);
		 e_pl_shear(sp)=(e_pl_max(sp)-e_pl_min(sp))/2;
	 end
	 if ActuallyPlot==1
		StressProfile1=figure;
		 set(StressProfile1, 'visible','off');
		 if CasetoRun==10
			 sz = 140;
		 else
			sz = 80;
		 end
		%color = velocity;
		if maxminshear==1
			color = e_pl_max;
		elseif maxminshear==2
			color = e_pl_min;
		elseif maxminshear==3
			color = e_pl_shear;
		else
			disp('wrong maxminshear input!');
			pause
		end
		scatter(x_sp(:,1),x_sp(:,2),sz,color,'filled');
		hold on
		daspect([1 1 1]);
		%title(['tt=' num2str(tt) ', d=' num2str(DispPump)]);
		set(StressProfile1,'Position',[0 0 1000 1000]);
		for sp=1:spCount
			x_cor = [x_corner1(sp,1) x_corner2(sp,1) x_corner3(sp,1) x_corner4(sp,1) x_corner1(sp,1)];
			y_cor = [x_corner1(sp,2) x_corner2(sp,2) x_corner3(sp,2) x_corner4(sp,2) x_corner1(sp,2)];
			if plotignore(sp)
				x_cross1=[x_corner1(sp,1) x_corner3(sp,1)];
				y_cross1=[x_corner1(sp,2) x_corner3(sp,2)];
				x_cross2=[x_corner2(sp,1) x_corner4(sp,1)];
				y_cross2=[x_corner2(sp,2) x_corner4(sp,2)];
				plot(x_cross1,y_cross1,'color','red');
				plot(x_cross2,y_cross2,'color','red');
			end
			plot(x_cor,y_cor,'red')
		end
		grid on
		if CasetoRun==10
			axis([0,max(LOC(:,1)),0,160]);
			set(gca,'ytick',[0:20:160]);
		else
			axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
			set(gca,'ytick',[0:20:max(LOC(:,2))]);
		end
		set(gca,'xtick',[0:20:max(LOC(:,1))]);
		h=colorbar;
		currentcolormap1=jet(256);
		currentcolormap2=currentcolormap1;
		colormap(currentcolormap2)
		% set(h, 'ytick', [0:0.2:1.2]);
		set(gca,'FontSize',40)
	else
		StressProfile1=[];
	end
	if exist('climits')
		if length(climits)>0
			if climits(2)>climits(1)
				caxis(climits);
			end
		end
	end
	
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [StressProfile1,e_pl_max,e_pl_min,e_pl_shear]=Plot_Final2_principalclimit_directions_crack(x_sp,x_crack,x_cracktop,x_crackbot,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,e_pl_sp,climits,maxminshear,lp,plotignore,ActuallyPlot)
	x_corner1              = zeros(spCount,2);
	x_corner2              = zeros(spCount,2);
	x_corner3              = zeros(spCount,2);
	x_corner4              = zeros(spCount,2);
	
	% displacement = zeros(spCount,1);
	velocity = zeros(spCount,1);
	% strain = zeros(spCount,1);
	for sp=1:spCount
	%     displacement(sp) = sqrt(d_sp(sp,1)^2+d_sp(sp,2)^2);
		velocity(sp) = sqrt(v_ssp(sp,1)^2+v_ssp(sp,2)^2);
	%     strain(sp) = sqrt(e_sp(sp,1)^2+e_sp(sp,2)^2);
	end

	for sp=1:spCount
		x_corner1(sp,:) = x_sp(sp,:) - r1_sp(sp,:) - r2_sp(sp,:);      % Position of corner 1
		x_corner2(sp,:) = x_sp(sp,:) + r1_sp(sp,:) - r2_sp(sp,:);
		x_corner3(sp,:) = x_sp(sp,:) + r1_sp(sp,:) + r2_sp(sp,:);
		x_corner4(sp,:) = x_sp(sp,:) - r1_sp(sp,:) + r2_sp(sp,:);
	end
	
	%%Calculating Max Princ Plast Strain
	thetamax=zeros(1,spCount);
	thetamin=zeros(1,spCount);
	for sp=1:spCount
		theta=1/2*atan(2*e_pl_sp(sp,3)/(e_pl_sp(sp,1)-e_pl_sp(sp,2)));
		e_pl_first=(e_pl_sp(sp,1)+e_pl_sp(sp,2))/2+(e_pl_sp(sp,1)-e_pl_sp(sp,2))/2*cos(2*theta)+e_pl_sp(sp,3)*sin(2*theta);
		e_pl_second=(e_pl_sp(sp,1)+e_pl_sp(sp,2))/2-(e_pl_sp(sp,1)-e_pl_sp(sp,2))/2*cos(2*theta)-e_pl_sp(sp,3)*sin(2*theta);
		if plotignore(sp)==0
			if e_pl_first>e_pl_second
				thetamax(sp)=theta;
				thetamin(sp)=theta+pi/2;
			else
				thetamax(sp)=theta+pi/2;
				thetamin(sp)=theta;
			end
		end
		e_pl_max(sp)=max(e_pl_first,e_pl_second);
		e_pl_min(sp)=min(e_pl_first,e_pl_second);
		e_pl_shear(sp)=(e_pl_max(sp)-e_pl_min(sp))/2;
	end
	
	if ActuallyPlot==1
		StressProfile1=figure;
		set(StressProfile1, 'visible','off');
		sz = 40;
		%color = velocity;
		if maxminshear==1
			color = e_pl_max;
		elseif maxminshear==2
			color = e_pl_min;
		elseif maxminshear==3
			color = e_pl_shear;
		else
			disp('wrong maxminshear input!');
			pause
		end
		color_cut=cutvector(color,0,plotignore);
		x_sp_cut=cutvector(x_sp,1,plotignore);
		scatter(x_sp_cut(:,1),x_sp_cut(:,2),sz,color_cut,'filled');
		hold on
		daspect([1 1 1]);
		for sp=1:spCount
			x_cor = [x_corner1(sp,1) x_corner2(sp,1) x_corner3(sp,1) x_corner4(sp,1) x_corner1(sp,1)];
			y_cor = [x_corner1(sp,2) x_corner2(sp,2) x_corner3(sp,2) x_corner4(sp,2) x_corner1(sp,2)];
			plot(x_cor,y_cor,'r')
			if plotignore(sp)
				continue;
			end
			if maxminshear==1
				thetaplot=thetamax(sp);
			elseif maxminshear==2
				thetaplot=thetamin(sp);
			elseif maxminshear==3
				continue;
			else
				disp('MaxminShear Wrong! Put either 1, 2, or 3!')
				pause
			end
			xstart=x_sp(sp,1)-lp(1)*sqrt(2)/2*cos(thetaplot);
			xend=x_sp(sp,1)+lp(1)*sqrt(2)/2*cos(thetaplot);
			ystart=x_sp(sp,2)-lp(2)*sqrt(2)/2*sin(thetaplot);
			yend=x_sp(sp,2)+lp(2)*sqrt(2)/2*sin(thetaplot);
			plot([xstart xend],[ystart yend],'color','black');
		end
		if length(x_crack)==0
		else
			plot(x_cracktop(:,1),x_cracktop(:,2),'o','Color','red');
			plot(x_crack(:,1),x_crack(:,2),'o','Color','green');
			plot(x_crackbot(:,1),x_crackbot(:,2),'o','Color','blue');
		end
		grid on
		axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
		set(gca,'xtick',[0:20:max(LOC(:,1))]);
		set(gca,'ytick',[0:20:max(LOC(:,2))]);
		h=colorbar;
		colormap(jet(256))
		set(gca,'FontSize',20)
	else
		StressProfile1=[];
	end
	% set(h, 'ytick', [0:0.2:1.2]);
	if exist('climits')
		if length(climits)>0
			if climits(2)>climits(1)
				caxis(climits);
			end
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [StressProfile1,e_pl_max,e_pl_min,e_pl_shear]=Plot_Final2_principalclimit_directions_crackmulti(x_sp,x_crack,x_cracktop,x_crackbot,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,e_pl_sp,climits,maxminshear,lp,plotignore,ActuallyPlot,CasetoRun)
	x_corner1              = zeros(spCount,2);
	x_corner2              = zeros(spCount,2);
	x_corner3              = zeros(spCount,2);
	x_corner4              = zeros(spCount,2);
	 
	%displacement = zeros(spCount,1);
	velocity = zeros(spCount,1);
	%strain = zeros(spCount,1);
	for sp=1:spCount
	%	displacement(sp) = sqrt(d_sp(sp,1)^2+d_sp(sp,2)^2);
		velocity(sp) = sqrt(v_ssp(sp,1)^2+v_ssp(sp,2)^2);
	%	strain(sp) = sqrt(e_sp(sp,1)^2+e_sp(sp,2)^2);
	end
	
	for sp=1:spCount
		x_corner1(sp,:) = x_sp(sp,:) - r1_sp(sp,:) - r2_sp(sp,:);      % Position of corner 1
		x_corner2(sp,:) = x_sp(sp,:) + r1_sp(sp,:) - r2_sp(sp,:);
		x_corner3(sp,:) = x_sp(sp,:) + r1_sp(sp,:) + r2_sp(sp,:);
		x_corner4(sp,:) = x_sp(sp,:) - r1_sp(sp,:) + r2_sp(sp,:);
	end

	%%Calculating Max Princ Plast Strain
	thetamax=zeros(1,spCount);
	thetamin=zeros(1,spCount);
	for sp=1:spCount
		theta=1/2*atan(2*e_pl_sp(sp,3)/(e_pl_sp(sp,1)-e_pl_sp(sp,2)));
		e_pl_first=(e_pl_sp(sp,1)+e_pl_sp(sp,2))/2+(e_pl_sp(sp,1)-e_pl_sp(sp,2))/2*cos(2*theta)+e_pl_sp(sp,3)*sin(2*theta);
		e_pl_second=(e_pl_sp(sp,1)+e_pl_sp(sp,2))/2-(e_pl_sp(sp,1)-e_pl_sp(sp,2))/2*cos(2*theta)-e_pl_sp(sp,3)*sin(2*theta);
		if plotignore(sp)==0
			if e_pl_first>e_pl_second
				thetamax(sp)=theta;
				thetamin(sp)=theta+pi/2;
			else
				thetamax(sp)=theta+pi/2;
				thetamin(sp)=theta;
			end
		end
		e_pl_max(sp)=max(e_pl_first,e_pl_second);
		e_pl_min(sp)=min(e_pl_first,e_pl_second);
		e_pl_shear(sp)=(e_pl_max(sp)-e_pl_min(sp))/2;
		 
	end
	if ActuallyPlot==1
		StressProfile1=figure;
		set(StressProfile1, 'visible','off');
		sz = 40;
		%color = velocity;
		if maxminshear==1
			color = e_pl_max;
		elseif maxminshear==2
			color = e_pl_min;
		elseif maxminshear==3
			color = e_pl_shear;
		else
			disp('wrong maxminshear input!');
			pause
		end
		color_cut=cutvector(color,0,plotignore);
		x_sp_cut=cutvector(x_sp,1,plotignore);
		scatter(x_sp_cut(:,1),x_sp_cut(:,2),sz,color_cut,'filled');
		hold on
		daspect([1 1 1]);
		if CasetoRun==105 || CasetoRun==110
			set(StressProfile1,'Position',[0 0 1800 1800]);
		end
		for sp=1:spCount
			x_cor = [x_corner1(sp,1) x_corner2(sp,1) x_corner3(sp,1) x_corner4(sp,1) x_corner1(sp,1)];
			y_cor = [x_corner1(sp,2) x_corner2(sp,2) x_corner3(sp,2) x_corner4(sp,2) x_corner1(sp,2)];
			plot(x_cor,y_cor,'r')
			if plotignore(sp)
				continue;
			end
			if maxminshear==1
				thetaplot=thetamax(sp);
			elseif maxminshear==2
				thetaplot=thetamin(sp);
			elseif maxminshear==3
				continue;
			else
				disp('MaxminShear Wrong! Put either 1, 2, or 3!')
				pause
			end
			xstart=x_sp(sp,1)-lp(1)*sqrt(2)/2*cos(thetaplot);
			xend=x_sp(sp,1)+lp(1)*sqrt(2)/2*cos(thetaplot);
			ystart=x_sp(sp,2)-lp(2)*sqrt(2)/2*sin(thetaplot);
			yend=x_sp(sp,2)+lp(2)*sqrt(2)/2*sin(thetaplot);
			plot([xstart xend],[ystart yend],'color','black');
		end
		if length(x_crack)==0
		else
			for icrackpath=1:length(x_crack)
				plot(x_cracktop{icrackpath}(:,1),x_cracktop{icrackpath}(:,2),'o','Color','red');
				plot(x_crack{icrackpath}(:,1),x_crack{icrackpath}(:,2),'o','Color','green');
				plot(x_crackbot{icrackpath}(:,1),x_crackbot{icrackpath}(:,2),'o','Color','blue');
			end
		end
		grid on
		axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
		set(gca,'xtick',[0:20:max(LOC(:,1))]);
		set(gca,'ytick',[0:20:max(LOC(:,2))]);
		h=colorbar;
		colormap(jet(256))
		set(gca,'FontSize',20)
	else
		StressProfile1=[];
	end
	% set(h, 'ytick', [0:0.2:1.2]);
	if exist('climits')
		if length(climits)>0
			if climits(2)>climits(1)
				caxis(climits);
			end
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [StressProfile1,e_pl_max,e_pl_min,e_pl_shear]=Plot_Final2_principalclimit_directions_crackmultiline(le_base,x_sp,x_crack,x_cracktop,x_crackbot,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,e_pl_sp,climits,maxminshear,lp,plotignore,ActuallyPlot,CasetoRun,refinementfactor)
	x_corner1              = zeros(spCount,2);
	x_corner2              = zeros(spCount,2);
	x_corner3              = zeros(spCount,2);
	x_corner4              = zeros(spCount,2);
	 
	%displacement = zeros(spCount,1);
	velocity = zeros(spCount,1);
	%strain = zeros(spCount,1);
	for sp=1:spCount
	%	displacement(sp) = sqrt(d_sp(sp,1)^2+d_sp(sp,2)^2);
		velocity(sp) = sqrt(v_ssp(sp,1)^2+v_ssp(sp,2)^2);
	%	strain(sp) = sqrt(e_sp(sp,1)^2+e_sp(sp,2)^2);
	end
	
	for sp=1:spCount
		x_corner1(sp,:) = x_sp(sp,:) - r1_sp(sp,:) - r2_sp(sp,:);      % Position of corner 1
		x_corner2(sp,:) = x_sp(sp,:) + r1_sp(sp,:) - r2_sp(sp,:);
		x_corner3(sp,:) = x_sp(sp,:) + r1_sp(sp,:) + r2_sp(sp,:);
		x_corner4(sp,:) = x_sp(sp,:) - r1_sp(sp,:) + r2_sp(sp,:);
	end

	%%Calculating Max Princ Plast Strain
	thetamax=zeros(1,spCount);
	thetamin=zeros(1,spCount);
	for sp=1:spCount
		theta=1/2*atan(2*e_pl_sp(sp,3)/(e_pl_sp(sp,1)-e_pl_sp(sp,2)));
		e_pl_first=(e_pl_sp(sp,1)+e_pl_sp(sp,2))/2+(e_pl_sp(sp,1)-e_pl_sp(sp,2))/2*cos(2*theta)+e_pl_sp(sp,3)*sin(2*theta);
		e_pl_second=(e_pl_sp(sp,1)+e_pl_sp(sp,2))/2-(e_pl_sp(sp,1)-e_pl_sp(sp,2))/2*cos(2*theta)-e_pl_sp(sp,3)*sin(2*theta);
		if plotignore(sp)==0
			if e_pl_first>e_pl_second
				thetamax(sp)=theta;
				thetamin(sp)=theta+pi/2;
			else
				thetamax(sp)=theta+pi/2;
				thetamin(sp)=theta;
			end
		end
		e_pl_max(sp)=max(e_pl_first,e_pl_second);
		e_pl_min(sp)=min(e_pl_first,e_pl_second);
		e_pl_shear(sp)=(e_pl_max(sp)-e_pl_min(sp))/2;
		if isnan(e_pl_max(sp))
			e_pl_max(sp)=0;
			e_pl_min(sp)=0;
			e_pl_shear(sp)=0;
		end
	end
	if ActuallyPlot==1
		StressProfile1=figure;
		set(StressProfile1, 'visible','off');
		if CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124
			sz=5*64/refinementfactor;
		elseif CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161
			sz=10*64/refinementfactor/9;
		else
			sz = 40;
		end
		%color = velocity;
		if maxminshear==1
			color = e_pl_max;
		elseif maxminshear==2
			color = e_pl_min;
		elseif maxminshear==3
			color = e_pl_shear;
		else
			disp('wrong maxminshear input!');
			pause
		end
		color_cut=cutvector(color,0,plotignore);
		x_sp_cut=cutvector(x_sp,1,plotignore);
		scatter(x_sp_cut(:,1),x_sp_cut(:,2),sz,color_cut,'filled');
		hold on
		daspect([1 1 1]);
		if CasetoRun==105 || CasetoRun==110
			set(StressProfile1,'Position',[0 0 1800 1800]);
		elseif CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124
			set(StressProfile1,'Position',[0 0 1800 1800]);
		end
		if CasetoRun==118 || CasetoRun==173
		elseif CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==152 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124
			for sp=1:spCount
				if plotignore(sp)
					continue;
				end
				if maxminshear==1
					thetaplot=thetamax(sp);
				elseif maxminshear==2
					thetaplot=thetamin(sp);
				elseif maxminshear==3
					continue;
				else
					disp('MaxminShear Wrong! Put either 1, 2, or 3!')
					pause
				end
				xstart=x_sp(sp,1)-lp(1)*sqrt(2)/2*cos(thetaplot);
				xend=x_sp(sp,1)+lp(1)*sqrt(2)/2*cos(thetaplot);
				ystart=x_sp(sp,2)-lp(2)*sqrt(2)/2*sin(thetaplot);
				yend=x_sp(sp,2)+lp(2)*sqrt(2)/2*sin(thetaplot);
				plot([xstart xend],[ystart yend],'color','black');
			end
		elseif CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161
			for sp=1:spCount
				x_cor = [x_corner1(sp,1) x_corner2(sp,1) x_corner3(sp,1) x_corner4(sp,1) x_corner1(sp,1)];
				y_cor = [x_corner1(sp,2) x_corner2(sp,2) x_corner3(sp,2) x_corner4(sp,2) x_corner1(sp,2)];
				plot(x_cor,y_cor,'r')
				if plotignore(sp)
					continue;
				end
				if maxminshear==1
					thetaplot=thetamax(sp);
				elseif maxminshear==2
					thetaplot=thetamin(sp);
				elseif maxminshear==3
					continue;
				else
					disp('MaxminShear Wrong! Put either 1, 2, or 3!')
					pause
				end
				xstart=x_sp(sp,1)-lp(1)*sqrt(2)/2*cos(thetaplot);
				xend=x_sp(sp,1)+lp(1)*sqrt(2)/2*cos(thetaplot);
				ystart=x_sp(sp,2)-lp(2)*sqrt(2)/2*sin(thetaplot);
				yend=x_sp(sp,2)+lp(2)*sqrt(2)/2*sin(thetaplot);
				plot([xstart xend],[ystart yend],'color','black');
			end
		else
			for sp=1:spCount
				x_cor = [x_corner1(sp,1) x_corner2(sp,1) x_corner3(sp,1) x_corner4(sp,1) x_corner1(sp,1)];
				y_cor = [x_corner1(sp,2) x_corner2(sp,2) x_corner3(sp,2) x_corner4(sp,2) x_corner1(sp,2)];
				plot(x_cor,y_cor,'r')
				if plotignore(sp)
					continue;
				end
				if maxminshear==1
					thetaplot=thetamax(sp);
				elseif maxminshear==2
					thetaplot=thetamin(sp);
				elseif maxminshear==3
					continue;
				else
					disp('MaxminShear Wrong! Put either 1, 2, or 3!')
					pause
				end
				xstart=x_sp(sp,1)-lp(1)*sqrt(2)/2*cos(thetaplot);
				% xend=x_sp(sp,1)+lp(1)*sqrt(2)/2*cos(thetaplot);
				ystart=x_sp(sp,2)-lp(2)*sqrt(2)/2*sin(thetaplot);
				yend=x_sp(sp,2)+lp(2)*sqrt(2)/2*sin(thetaplot);
				plot([xstart xend],[ystart yend],'color','black');
			end
		end
		if length(x_crack)==0
		else
			for icrackpath=1:length(x_crack)
				plot(x_cracktop{icrackpath}(:,1),x_cracktop{icrackpath}(:,2),'Color','red','LineWidth',1);
				plot(x_crack{icrackpath}(:,1),x_crack{icrackpath}(:,2),'-','Color','black','LineWidth',1);
				plot(x_crackbot{icrackpath}(:,1),x_crackbot{icrackpath}(:,2),'Color','blue','LineWidth',1);
			end
		end
		grid on
		if CasetoRun==118 || CasetoRun==173 || CasetoRun==192
			axis([1.8,4.2,1.8,4.2]*le_base);
			set(gca,'xtick',[1.8:0.2:4.2]*le_base);
			set(gca,'ytick',[1.8:0.2:4.2]*le_base);
		elseif CasetoRun==123 || CasetoRun==151 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128
			axis([1.8,6.2,1.8,4.2]);
			set(gca,'xtick',[1.8:0.2:6.2]);
			set(gca,'ytick',[1.8:0.2:4.2]);
		elseif CasetoRun==179
			axis([1.6,5.4,1.6,5.4]*200);
			set(gca,'xtick',[1.6:0.2:5.4]*200);
			set(gca,'ytick',[1.6:0.2:5.4]*200);
		elseif CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==189
			axis(le_base*[1.5,5.5,1.5,5.5]);
			%set(gca,'xtick',le_base*[1.5:0.25:5.5]);
			%set(gca,'ytick',le_base*[1.5:0.25:5.5]);
			set(gca,'xtick',[]);
			set(gca,'ytick',[]);
		elseif CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==178 || CasetoRun==169
			axis([1.6,5.4,1.6,5.4]);
			set(gca,'xtick',[1.6:0.2:5.4]);
			set(gca,'ytick',[1.6:0.2:5.4]);
		elseif CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==166 || CasetoRun==165
			axis([1.6,6.4,1.6,4.4]);
			set(gca,'xtick',[1.6:0.2:6.4]);
			set(gca,'ytick',[1.6:0.2:4.4]);
		elseif CasetoRun==129 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==130 || CasetoRun==140 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142
			axis([1.8,6.2,1.8,4.45]);
			set(gca,'xtick',[1.8:0.2:6.2]);
			set(gca,'ytick',[1.8:0.2:4.45]);
		elseif CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==147 || CasetoRun==145
			axis([1.8,13.2,1.8,5.2]);
			set(gca,'xtick',[1.8:0.2:13.2]);
			set(gca,'ytick',[1.8:0.2:5.2]);
		elseif CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153
			axis([0,14,0,14]);
			set(gca,'xtick',[0:1:14]);
			set(gca,'ytick',[0:1:14]);		
		elseif CasetoRun==154 || CasetoRun==161
			axis([2.5,5.5,2.5,5.5]);
			set(gca,'xtick',[2.5:0.25:5.5]);
			set(gca,'ytick',[2.5:0.25:5.5]);				
		elseif CasetoRun==138
			axis([1.8,4.2,1.8,4.2]*4.5);
			set(gca,'xtick',[1.8:0.2:4.2]*4.5);
			set(gca,'ytick',[1.8:0.2:4.2]*4.5);
		elseif CasetoRun==134 || CasetoRun==136
			axis([1.8,7.7,1.8,4.45]);
			set(gca,'xtick',[1.8:0.2:7.7]);
			set(gca,'ytick',[1.8:0.2:4.45]);
		elseif CasetoRun==124
			axis([1.3,11.7,1.3,10.4]);
			set(gca,'xtick',[1.3:1.3:11.7]);
			set(gca,'ytick',[1.3:1.3:10.4]);
		elseif CasetoRun==175 || CasetoRun==194 || CasetoRun==180
			if refinementfactor==2
				axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
				set(gca,'xtick',[0:0.5:max(LOC(:,1))]);
				set(gca,'ytick',[0:0.5:max(LOC(:,2))]);
			elseif refinementfactor==4
				axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
				set(gca,'xtick',[0:0.25:max(LOC(:,1))]);
				set(gca,'ytick',[0:0.25:max(LOC(:,2))]);
			else
				axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
				set(gca,'xtick',[0:max(LOC(:,1)):max(LOC(:,1))]);
				set(gca,'ytick',[0:max(LOC(:,2)):max(LOC(:,2))]);
			end
			set(gca,'Yticklabel',[]);
			set(gca,'Xticklabel',[]);
		else
			axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
			set(gca,'xtick',[0:20:max(LOC(:,1))]);
			set(gca,'ytick',[0:20:max(LOC(:,2))]);
		end
		h=colorbar;
		colormap(jet(256))
		set(gca,'FontSize',20)
	else
		StressProfile1=[];
	end
	% set(h, 'ytick', [0:0.2:1.2]);
	if exist('climits')
		if length(climits)>0
			if climits(2)>climits(1)
				caxis(climits);
			end
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [StressProfile1]=Plot_Cohesive(le_base,x_crack_abs_force,x_sp,x_crack,x_cracktop,x_crackbot,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,e_pl_sp,climits,maxminshear,lp,plotignore,ActuallyPlot,CasetoRun,refinementfactor)
	%BASED ON Plot_Final2_principalclimit_directions_crackmultiline
	x_corner1              = zeros(spCount,2);
	x_corner2              = zeros(spCount,2);
	x_corner3              = zeros(spCount,2);
	x_corner4              = zeros(spCount,2);
	
	%displacement = zeros(spCount,1);
	velocity = zeros(spCount,1);
	%strain = zeros(spCount,1);
	for sp=1:spCount
	%	displacement(sp) = sqrt(d_sp(sp,1)^2+d_sp(sp,2)^2);
		velocity(sp) = sqrt(v_ssp(sp,1)^2+v_ssp(sp,2)^2);
	%	strain(sp) = sqrt(e_sp(sp,1)^2+e_sp(sp,2)^2);
	end
	
	for sp=1:spCount
		x_corner1(sp,:) = x_sp(sp,:) - r1_sp(sp,:) - r2_sp(sp,:);      % Position of corner 1
		x_corner2(sp,:) = x_sp(sp,:) + r1_sp(sp,:) - r2_sp(sp,:);
		x_corner3(sp,:) = x_sp(sp,:) + r1_sp(sp,:) + r2_sp(sp,:);
		x_corner4(sp,:) = x_sp(sp,:) - r1_sp(sp,:) + r2_sp(sp,:);
	end

	%%Calculating Max Princ Plast Strain
	thetamax=zeros(1,spCount);
	thetamin=zeros(1,spCount);
	for sp=1:spCount
		theta=1/2*atan(2*e_pl_sp(sp,3)/(e_pl_sp(sp,1)-e_pl_sp(sp,2)));
		e_pl_first=(e_pl_sp(sp,1)+e_pl_sp(sp,2))/2+(e_pl_sp(sp,1)-e_pl_sp(sp,2))/2*cos(2*theta)+e_pl_sp(sp,3)*sin(2*theta);
		e_pl_second=(e_pl_sp(sp,1)+e_pl_sp(sp,2))/2-(e_pl_sp(sp,1)-e_pl_sp(sp,2))/2*cos(2*theta)-e_pl_sp(sp,3)*sin(2*theta);
		if plotignore(sp)==0
			if e_pl_first>e_pl_second
				thetamax(sp)=theta;
				thetamin(sp)=theta+pi/2;
			else
				thetamax(sp)=theta+pi/2;
				thetamin(sp)=theta;
			end
		end
		e_pl_max(sp)=max(e_pl_first,e_pl_second);
		e_pl_min(sp)=min(e_pl_first,e_pl_second);
		e_pl_shear(sp)=(e_pl_max(sp)-e_pl_min(sp))/2;
		if isnan(e_pl_max(sp))
			e_pl_max(sp)=0;
			e_pl_min(sp)=0;
			e_pl_shear(sp)=0;
		end
	end
	szbridge=0;
	if ActuallyPlot==1
		StressProfile1=figure;
		set(StressProfile1, 'visible','off');
		if CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124 || CasetoRun==192
			sz=5*64/refinementfactor;
			szbridge=sqrt(sz);
		elseif CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==189
			sz=5*64/refinementfactor;
			szbridge=sqrt(sz);
		elseif CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161
			sz=10*64/refinementfactor/9;
		else
			sz = 40;
		end
		%color = velocity;
		if maxminshear==1
			color = e_pl_max;
		elseif maxminshear==2
			color = e_pl_min;
		elseif maxminshear==3
			color = e_pl_shear;
		else
			disp('wrong maxminshear input!');
			pause
		end
		color_cut=cutvector(color,0,plotignore);
		x_sp_cut=cutvector(x_sp,1,plotignore);
		if CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==189 || CasetoRun==192
		else
			scatter(x_sp_cut(:,1),x_sp_cut(:,2),sz,color_cut,'filled');
			daspect([1 1 1]);
			hold on
		end
		
		if CasetoRun==105 || CasetoRun==110
			set(StressProfile1,'Position',[0 0 1800 1800]);
		elseif CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124
			set(StressProfile1,'Position',[0 0 1800 1800]);
		end
		if CasetoRun==118 || CasetoRun==173
		elseif CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189
			for sp=1:spCount
				x_cor = [x_corner1(sp,1) x_corner2(sp,1) x_corner3(sp,1) x_corner4(sp,1) x_corner1(sp,1)];
				y_cor = [x_corner1(sp,2) x_corner2(sp,2) x_corner3(sp,2) x_corner4(sp,2) x_corner1(sp,2)];
				plot(x_cor,y_cor,'r')
				if sp==1
					hold on;
					daspect([1 1 1]);
				end
				if plotignore(sp)
					continue;
				end
				if maxminshear==1
					thetaplot=thetamax(sp);
				elseif maxminshear==2
					thetaplot=thetamin(sp);
				elseif maxminshear==3
					continue;
				else
					disp('MaxminShear Wrong! Put either 1, 2, or 3!')
					pause
				end
				xstart=x_sp(sp,1)-lp(1)*sqrt(2)/2*cos(thetaplot);
				xend=x_sp(sp,1)+lp(1)*sqrt(2)/2*cos(thetaplot);
				ystart=x_sp(sp,2)-lp(2)*sqrt(2)/2*sin(thetaplot);
				yend=x_sp(sp,2)+lp(2)*sqrt(2)/2*sin(thetaplot);
				plot([xstart xend],[ystart yend],'color','black');
			end
		elseif CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==152 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124
			for sp=1:spCount
				if plotignore(sp)
					continue;
				end
				if maxminshear==1
					thetaplot=thetamax(sp);
				elseif maxminshear==2
					thetaplot=thetamin(sp);
				elseif maxminshear==3
					continue;
				else
					disp('MaxminShear Wrong! Put either 1, 2, or 3!')
					pause
				end
				xstart=x_sp(sp,1)-lp(1)*sqrt(2)/2*cos(thetaplot);
				xend=x_sp(sp,1)+lp(1)*sqrt(2)/2*cos(thetaplot);
				ystart=x_sp(sp,2)-lp(2)*sqrt(2)/2*sin(thetaplot);
				yend=x_sp(sp,2)+lp(2)*sqrt(2)/2*sin(thetaplot);
				plot([xstart xend],[ystart yend],'color','black');
			end
		elseif CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161
			for sp=1:spCount
				x_cor = [x_corner1(sp,1) x_corner2(sp,1) x_corner3(sp,1) x_corner4(sp,1) x_corner1(sp,1)];
				y_cor = [x_corner1(sp,2) x_corner2(sp,2) x_corner3(sp,2) x_corner4(sp,2) x_corner1(sp,2)];
				plot(x_cor,y_cor,'r')
				if plotignore(sp)
					continue;
				end
				if maxminshear==1
					thetaplot=thetamax(sp);
				elseif maxminshear==2
					thetaplot=thetamin(sp);
				elseif maxminshear==3
					continue;
				else
					disp('MaxminShear Wrong! Put either 1, 2, or 3!')
					pause
				end
				xstart=x_sp(sp,1)-lp(1)*sqrt(2)/2*cos(thetaplot);
				xend=x_sp(sp,1)+lp(1)*sqrt(2)/2*cos(thetaplot);
				ystart=x_sp(sp,2)-lp(2)*sqrt(2)/2*sin(thetaplot);
				yend=x_sp(sp,2)+lp(2)*sqrt(2)/2*sin(thetaplot);
				plot([xstart xend],[ystart yend],'color','black');
			end
		else
			for sp=1:spCount
				x_cor = [x_corner1(sp,1) x_corner2(sp,1) x_corner3(sp,1) x_corner4(sp,1) x_corner1(sp,1)];
				y_cor = [x_corner1(sp,2) x_corner2(sp,2) x_corner3(sp,2) x_corner4(sp,2) x_corner1(sp,2)];
				plot(x_cor,y_cor,'r')
				if plotignore(sp)
					continue;
				end
				if maxminshear==1
					thetaplot=thetamax(sp);
				elseif maxminshear==2
					thetaplot=thetamin(sp);
				elseif maxminshear==3
					continue;
				else
					disp('MaxminShear Wrong! Put either 1, 2, or 3!')
					pause
				end
				xstart=x_sp(sp,1)-lp(1)*sqrt(2)/2*cos(thetaplot);
				% xend=x_sp(sp,1)+lp(1)*sqrt(2)/2*cos(thetaplot);
				ystart=x_sp(sp,2)-lp(2)*sqrt(2)/2*sin(thetaplot);
				yend=x_sp(sp,2)+lp(2)*sqrt(2)/2*sin(thetaplot);
				plot([xstart xend],[ystart yend],'color','black');
			end
		end
		
		force.min=zeros(1,1);
		force.max=zeros(1,1);
		
		force.min=inf;
		force.max=-inf;
		
		if CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189
			if length(x_crack)==0
			else
				for icrackpath=1:length(x_crack)
					for iparticle=1:size(x_crack{icrackpath},1)
						if x_crack_abs_force(iparticle,icrackpath)<force.min
							force.min=x_crack_abs_force(iparticle,icrackpath);
						elseif x_crack_abs_force(iparticle,icrackpath)>force.max
							force.max=x_crack_abs_force(iparticle,icrackpath);
						end
					end
				end
			end
			if exist('climits')
				if length(climits)>0
					if climits(2)>climits(1)
						climits(1)=min(climits(1),force.min);
						climits(2)=max(climits(2),force.max);
					end
                end
            end
			if exist('climits')==0 || length(climits)==0
				climits(1)=force.min;
				climits(2)=force.max;
			end
			if length(x_crack)==0
			else
				for icrackpath=1:length(x_crack)
					%plot(x_cracktop{icrackpath}(:,1),x_cracktop{icrackpath}(:,2),'Color','red','LineWidth',0.5);
					plot(x_crack{icrackpath}(:,1),x_crack{icrackpath}(:,2),'-','Color','black','LineWidth',2);
					%plot(x_crackbot{icrackpath}(:,1),x_crackbot{icrackpath}(:,2),'Color','blue','LineWidth',0.5);
					for iparticle=1:size(x_crack{icrackpath},1)
																																  
																																  
						if x_crack_abs_force(iparticle,icrackpath)>0
							plotcolor=jet2rgb(256,climits(1),climits(2),x_crack_abs_force(iparticle,icrackpath));
							x_plot=[x_cracktop{icrackpath}(iparticle,1) x_crackbot{icrackpath}(iparticle,1)];
							y_plot=[x_cracktop{icrackpath}(iparticle,2) x_crackbot{icrackpath}(iparticle,2)];
							plot(x_plot,y_plot,'Color',plotcolor,'LineWidth',1);
							plot(sum(x_plot)/2,sum(y_plot)/2,'o','MarkerSize',szbridge,'MarkerEdgeColor',plotcolor);
							plot(sum(x_plot)/2,sum(y_plot)/2,'o','MarkerSize',szbridge+0.2,'MarkerEdgeColor',plotcolor);
							plot(sum(x_plot)/2,sum(y_plot)/2,'o','MarkerSize',szbridge+0.4,'MarkerEdgeColor',plotcolor);
							plot(sum(x_plot)/2,sum(y_plot)/2,'o','MarkerSize',szbridge+0.6,'MarkerEdgeColor',plotcolor);
							plot(sum(x_plot)/2,sum(y_plot)/2,'o','MarkerSize',szbridge+0.8,'MarkerEdgeColor',plotcolor);
							plot(sum(x_plot)/2,sum(y_plot)/2,'o','MarkerSize',szbridge-0.2,'MarkerEdgeColor',plotcolor);
							plot(sum(x_plot)/2,sum(y_plot)/2,'o','MarkerSize',szbridge-0.4,'MarkerEdgeColor',plotcolor);
							plot(sum(x_plot)/2,sum(y_plot)/2,'o','MarkerSize',szbridge-0.6,'MarkerEdgeColor',plotcolor);
							plot(sum(x_plot)/2,sum(y_plot)/2,'o','MarkerSize',szbridge-0.8,'MarkerEdgeColor',plotcolor);
							%'MarkerFaceColor',plotcolor
						end
					end
				end
			end
		end
		grid on
		if CasetoRun==118 || CasetoRun==173 || CasetoRun==192
			axis([1.8,4.2,1.8,4.2]*le_base);
			set(gca,'xtick',[1.8:0.2:4.2]*le_base);
			set(gca,'ytick',[1.8:0.2:4.2]*le_base);
		elseif CasetoRun==123 || CasetoRun==151 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128
			axis([1.8,6.2,1.8,4.2]);
			set(gca,'xtick',[1.8:0.2:6.2]);
			set(gca,'ytick',[1.8:0.2:4.2]);
		elseif CasetoRun==179
			axis([1.6,5.4,1.6,5.4]*200);
			set(gca,'xtick',[1.6:0.2:5.4]*200);
			set(gca,'ytick',[1.6:0.2:5.4]*200);
		elseif CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==189
			axis(le_base*[1.5,5.5,1.5,5.5]);
			%set(gca,'xtick',[1.5:0.25:5.5]);
			%set(gca,'ytick',[1.5:0.25:5.5]);
			set(gca,'xtick',[]);
			set(gca,'ytick',[]);
		elseif CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==178 || CasetoRun==169
			axis([1.6,5.4,1.6,5.4]);
			set(gca,'xtick',[1.6:0.2:5.4]);
			set(gca,'ytick',[1.6:0.2:5.4]);
		elseif CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==166 || CasetoRun==165
			axis([1.6,6.4,1.6,4.4]);
			set(gca,'xtick',[1.6:0.2:6.4]);
			set(gca,'ytick',[1.6:0.2:4.4]);
		elseif CasetoRun==129 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==130 || CasetoRun==140 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142
			axis([1.8,6.2,1.8,4.45]);
			set(gca,'xtick',[1.8:0.2:6.2]);
			set(gca,'ytick',[1.8:0.2:4.45]);
		elseif CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==147 || CasetoRun==145
			axis([1.8,13.2,1.8,5.2]);
			set(gca,'xtick',[1.8:0.2:13.2]);
			set(gca,'ytick',[1.8:0.2:5.2]);
		elseif CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153
			axis([0,14,0,14]);
			set(gca,'xtick',[0:1:14]);
			set(gca,'ytick',[0:1:14]);		
		elseif CasetoRun==154 || CasetoRun==161
			axis([2.5,5.5,2.5,5.5]);
			set(gca,'xtick',[2.5:0.25:5.5]);
			set(gca,'ytick',[2.5:0.25:5.5]);				
		elseif CasetoRun==138
			axis([1.8,4.2,1.8,4.2]*4.5);
			set(gca,'xtick',[1.8:0.2:4.2]*4.5);
			set(gca,'ytick',[1.8:0.2:4.2]*4.5);
		elseif CasetoRun==134 || CasetoRun==136
			axis([1.8,7.7,1.8,4.45]);
			set(gca,'xtick',[1.8:0.2:7.7]);
			set(gca,'ytick',[1.8:0.2:4.45]);
		elseif CasetoRun==124
			axis([1.3,11.7,1.3,10.4]);
			set(gca,'xtick',[1.3:1.3:11.7]);
			set(gca,'ytick',[1.3:1.3:10.4]);
		elseif CasetoRun==175 || CasetoRun==194 || CasetoRun==180
			if refinementfactor==2
				axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
				set(gca,'xtick',[0:0.5:max(LOC(:,1))]);
				set(gca,'ytick',[0:0.5:max(LOC(:,2))]);
			elseif refinementfactor==4
				axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
				set(gca,'xtick',[0:0.25:max(LOC(:,1))]);
				set(gca,'ytick',[0:0.25:max(LOC(:,2))]);
			else
				axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
				set(gca,'xtick',[0:max(LOC(:,1)):max(LOC(:,1))]);
				set(gca,'ytick',[0:max(LOC(:,2)):max(LOC(:,2))]);
			end
			set(gca,'Yticklabel',[]);
			set(gca,'Xticklabel',[]);
		else
			axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
			set(gca,'xtick',[0:20:max(LOC(:,1))]);
			set(gca,'ytick',[0:20:max(LOC(:,2))]);
		end
		h=colorbar;
		colormap(jet(256))
		set(gca,'FontSize',20)
	else
		StressProfile1=[];
	end
	% set(h, 'ytick', [0:0.2:1.2]);
	if exist('climits')
		if length(climits)>0
			if climits(2)>climits(1)
				caxis(climits);
			end
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [StressProfile1]=Plot_Sequence(x_crack_sequence_merge,x_crack_sequence_tipreg,x_crack_nparticles,le_base,x_crack_abs_force,x_sp,x_crack,x_cracktop,x_crackbot,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,e_pl_sp,climits,maxminshear,lp,plotignore,ActuallyPlot,CasetoRun,refinementfactor)
	%BASED ON Plot_Final2_principalclimit_directions_crackmultiline
	x_corner1              = zeros(spCount,2);
	x_corner2              = zeros(spCount,2);
	x_corner3              = zeros(spCount,2);
	x_corner4              = zeros(spCount,2);
	
	%displacement = zeros(spCount,1);
	velocity = zeros(spCount,1);
	%strain = zeros(spCount,1);
	for sp=1:spCount
	%	displacement(sp) = sqrt(d_sp(sp,1)^2+d_sp(sp,2)^2);
		velocity(sp) = sqrt(v_ssp(sp,1)^2+v_ssp(sp,2)^2);
	%	strain(sp) = sqrt(e_sp(sp,1)^2+e_sp(sp,2)^2);
	end
	
	for sp=1:spCount
		x_corner1(sp,:) = x_sp(sp,:) - r1_sp(sp,:) - r2_sp(sp,:);      % Position of corner 1
		x_corner2(sp,:) = x_sp(sp,:) + r1_sp(sp,:) - r2_sp(sp,:);
		x_corner3(sp,:) = x_sp(sp,:) + r1_sp(sp,:) + r2_sp(sp,:);
		x_corner4(sp,:) = x_sp(sp,:) - r1_sp(sp,:) + r2_sp(sp,:);
	end

	%%Calculating Max Princ Plast Strain
	thetamax=zeros(1,spCount);
	thetamin=zeros(1,spCount);
	for sp=1:spCount
		theta=1/2*atan(2*e_pl_sp(sp,3)/(e_pl_sp(sp,1)-e_pl_sp(sp,2)));
		e_pl_first=(e_pl_sp(sp,1)+e_pl_sp(sp,2))/2+(e_pl_sp(sp,1)-e_pl_sp(sp,2))/2*cos(2*theta)+e_pl_sp(sp,3)*sin(2*theta);
		e_pl_second=(e_pl_sp(sp,1)+e_pl_sp(sp,2))/2-(e_pl_sp(sp,1)-e_pl_sp(sp,2))/2*cos(2*theta)-e_pl_sp(sp,3)*sin(2*theta);
		if plotignore(sp)==0
			if e_pl_first>e_pl_second
				thetamax(sp)=theta;
				thetamin(sp)=theta+pi/2;
			else
				thetamax(sp)=theta+pi/2;
				thetamin(sp)=theta;
			end
		end
		e_pl_max(sp)=max(e_pl_first,e_pl_second);
		e_pl_min(sp)=min(e_pl_first,e_pl_second);
		e_pl_shear(sp)=(e_pl_max(sp)-e_pl_min(sp))/2;
		if isnan(e_pl_max(sp))
			e_pl_max(sp)=0;
			e_pl_min(sp)=0;
			e_pl_shear(sp)=0;
		end
	end
	szbridge=0;
	if ActuallyPlot==1
		StressProfile1=figure;
		set(StressProfile1, 'visible','off');
		if CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124 || CasetoRun==192
			sz=5*64/refinementfactor;
		elseif CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==189
			sz=5*64/refinementfactor;
			szbridge=sqrt(sz);
		elseif CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161
			sz=10*64/refinementfactor/9;
		else
			sz = 40;
		end
		%color = velocity;
		if maxminshear==1
			color = e_pl_max;
		elseif maxminshear==2
			color = e_pl_min;
		elseif maxminshear==3
			color = e_pl_shear;
		else
			disp('wrong maxminshear input!');
			pause
		end
		color_cut=cutvector(color,0,plotignore);
		x_sp_cut=cutvector(x_sp,1,plotignore);
		if CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189
		else
			%scatter(x_sp_cut(:,1),x_sp_cut(:,2),sz,color_cut,'filled');
			daspect([1 1 1]);
			hold on
		end
		
		if CasetoRun==105 || CasetoRun==110
			set(StressProfile1,'Position',[0 0 1800 1800]);
		elseif CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124
			set(StressProfile1,'Position',[0 0 1800 1800]);
		end
		if CasetoRun==118 || CasetoRun==173
		elseif CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189
			for sp=1:spCount
				x_cor = [x_corner1(sp,1) x_corner2(sp,1) x_corner3(sp,1) x_corner4(sp,1) x_corner1(sp,1)];
				y_cor = [x_corner1(sp,2) x_corner2(sp,2) x_corner3(sp,2) x_corner4(sp,2) x_corner1(sp,2)];
				plot(x_cor,y_cor,'r')
				if sp==1
					hold on;
					daspect([1 1 1]);
				end
				if plotignore(sp)
					continue;
				end
				if maxminshear==1
					thetaplot=thetamax(sp);
				elseif maxminshear==2
					thetaplot=thetamin(sp);
				elseif maxminshear==3
					continue;
				else
					disp('MaxminShear Wrong! Put either 1, 2, or 3!')
					pause
				end
				xstart=x_sp(sp,1)-lp(1)*sqrt(2)/2*cos(thetaplot);
				xend=x_sp(sp,1)+lp(1)*sqrt(2)/2*cos(thetaplot);
				ystart=x_sp(sp,2)-lp(2)*sqrt(2)/2*sin(thetaplot);
				yend=x_sp(sp,2)+lp(2)*sqrt(2)/2*sin(thetaplot);
				plot([xstart xend],[ystart yend],'color','black');
			end
		elseif CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==152 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124
			for sp=1:spCount
				if plotignore(sp)
					continue;
				end
				if maxminshear==1
					thetaplot=thetamax(sp);
				elseif maxminshear==2
					thetaplot=thetamin(sp);
				elseif maxminshear==3
					continue;
				else
					disp('MaxminShear Wrong! Put either 1, 2, or 3!')
					pause
				end
				xstart=x_sp(sp,1)-lp(1)*sqrt(2)/2*cos(thetaplot);
				xend=x_sp(sp,1)+lp(1)*sqrt(2)/2*cos(thetaplot);
				ystart=x_sp(sp,2)-lp(2)*sqrt(2)/2*sin(thetaplot);
				yend=x_sp(sp,2)+lp(2)*sqrt(2)/2*sin(thetaplot);
				plot([xstart xend],[ystart yend],'color','black');
			end
		elseif CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161
			for sp=1:spCount
				x_cor = [x_corner1(sp,1) x_corner2(sp,1) x_corner3(sp,1) x_corner4(sp,1) x_corner1(sp,1)];
				y_cor = [x_corner1(sp,2) x_corner2(sp,2) x_corner3(sp,2) x_corner4(sp,2) x_corner1(sp,2)];
				plot(x_cor,y_cor,'r')
				if plotignore(sp)
					continue;
				end
				if maxminshear==1
					thetaplot=thetamax(sp);
				elseif maxminshear==2
					thetaplot=thetamin(sp);
				elseif maxminshear==3
					continue;
				else
					disp('MaxminShear Wrong! Put either 1, 2, or 3!')
					pause
				end
				xstart=x_sp(sp,1)-lp(1)*sqrt(2)/2*cos(thetaplot);
				xend=x_sp(sp,1)+lp(1)*sqrt(2)/2*cos(thetaplot);
				ystart=x_sp(sp,2)-lp(2)*sqrt(2)/2*sin(thetaplot);
				yend=x_sp(sp,2)+lp(2)*sqrt(2)/2*sin(thetaplot);
				plot([xstart xend],[ystart yend],'color','black');
			end
		else
			for sp=1:spCount
				x_cor = [x_corner1(sp,1) x_corner2(sp,1) x_corner3(sp,1) x_corner4(sp,1) x_corner1(sp,1)];
				y_cor = [x_corner1(sp,2) x_corner2(sp,2) x_corner3(sp,2) x_corner4(sp,2) x_corner1(sp,2)];
				plot(x_cor,y_cor,'r')
				if plotignore(sp)
					continue;
				end
				if maxminshear==1
					thetaplot=thetamax(sp);
				elseif maxminshear==2
					thetaplot=thetamin(sp);
				elseif maxminshear==3
					continue;
				else
					disp('MaxminShear Wrong! Put either 1, 2, or 3!')
					pause
				end
				xstart=x_sp(sp,1)-lp(1)*sqrt(2)/2*cos(thetaplot);
				% xend=x_sp(sp,1)+lp(1)*sqrt(2)/2*cos(thetaplot);
				ystart=x_sp(sp,2)-lp(2)*sqrt(2)/2*sin(thetaplot);
				yend=x_sp(sp,2)+lp(2)*sqrt(2)/2*sin(thetaplot);
				plot([xstart xend],[ystart yend],'color','black');
			end
		end
		
		force.min=zeros(1,1);
		force.max=zeros(1,1);
		
		force.min=inf;
		force.max=-inf;
		
		if CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189
			if length(x_crack)==0
			else
				for icrackpath=1:length(x_crack)
					for iparticle=1:size(x_crack{icrackpath},1)
						if x_crack_abs_force(iparticle,icrackpath)<force.min
							force.min=x_crack_abs_force(iparticle,icrackpath);
						elseif x_crack_abs_force(iparticle,icrackpath)>force.max
							force.max=x_crack_abs_force(iparticle,icrackpath);
						end
					end
				end
			end
			if exist('climits')
				if length(climits)>0
					if climits(2)>climits(1)
						climits(1)=min(climits(1),force.min);
						climits(2)=max(climits(2),force.max);
					end
                end
            end
			if exist('climits')==0 || length(climits)==0
				climits(1)=force.min;
				climits(2)=force.max;
			end
			
			if length(x_crack)==0
			else
				for icrackpath=1:length(x_crack)
					%plot(x_cracktop{icrackpath}(:,1),x_cracktop{icrackpath}(:,2),'Color','red','LineWidth',0.5);
					plot(x_crack{icrackpath}(:,1),x_crack{icrackpath}(:,2),'-','Color','blue','LineWidth',2);
					if x_crack_sequence_merge(icrackpath,1)>0
						text(x_crack{icrackpath}(x_crack_nparticles(icrackpath),1),x_crack{icrackpath}(x_crack_nparticles(icrackpath),2),[num2str(2*(icrackpath-1)+1) '->' num2str(2*(x_crack_sequence_merge(icrackpath,1)-1)+1) '-' num2str(2*(x_crack_sequence_merge(icrackpath,1)-1)+2) char(13) char(10) '\downarrow'],'HorizontalAlignment','center','VerticalAlignment','Bottom','FontName','Times New Roman','FontSize',15);
					elseif x_crack_sequence_tipreg(icrackpath,1)==1
						text(x_crack{icrackpath}(x_crack_nparticles(icrackpath),1),x_crack{icrackpath}(x_crack_nparticles(icrackpath),2),['<-' num2str(2*(icrackpath-1)+1) '->' char(13) char(10) '\downarrow'],'HorizontalAlignment','center','VerticalAlignment','Bottom','FontName','Times New Roman','FontSize',15);
					else
						text(x_crack{icrackpath}(x_crack_nparticles(icrackpath),1),x_crack{icrackpath}(x_crack_nparticles(icrackpath),2),[num2str(2*(icrackpath-1)+1) char(13) char(10) '\downarrow'],'HorizontalAlignment','center','VerticalAlignment','Bottom','FontName','Times New Roman','FontSize',15);
					end
					if x_crack_sequence_merge(icrackpath,2)>0
						text(x_crack{icrackpath}(1,1),x_crack{icrackpath}(1,2),[num2str(2*(icrackpath-1)+2) '->' num2str(2*(x_crack_sequence_merge(icrackpath,2)-1)+1) '-' num2str(2*(x_crack_sequence_merge(icrackpath,2)-1)+2) char(13) char(10) '\downarrow'],'HorizontalAlignment','center','VerticalAlignment','Bottom','FontName','Times New Roman','FontSize',15);
					elseif x_crack_sequence_tipreg(icrackpath,2)==1
						text(x_crack{icrackpath}(1,1),x_crack{icrackpath}(1,2),['<-' num2str(2*(icrackpath-1)+2) '->' char(13) char(10) '\downarrow'],'HorizontalAlignment','center','VerticalAlignment','Bottom','FontName','Times New Roman','FontSize',15);
					else
						text(x_crack{icrackpath}(1,1),x_crack{icrackpath}(1,2),[num2str(2*(icrackpath-1)+2) char(13) char(10) '\downarrow'],'HorizontalAlignment','center','VerticalAlignment','Bottom','FontName','Times New Roman','FontSize',15);
					end

					%plot(x_crackbot{icrackpath}(:,1),x_crackbot{icrackpath}(:,2),'Color','blue','LineWidth',0.5);
				end
			end
		end
		grid on
		if CasetoRun==118 || CasetoRun==173 || CasetoRun==192
			axis([1.8,4.2,1.8,4.2]);
			set(gca,'xtick',[1.8:0.2:4.2]);
			set(gca,'ytick',[1.8:0.2:4.2]);
		elseif CasetoRun==123 || CasetoRun==151 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128
			axis([1.8,6.2,1.8,4.2]);
			set(gca,'xtick',[1.8:0.2:6.2]);
			set(gca,'ytick',[1.8:0.2:4.2]);
		elseif CasetoRun==179
			axis([1.6,5.4,1.6,5.4]*200);
			set(gca,'xtick',[1.6:0.2:5.4]*200);
			set(gca,'ytick',[1.6:0.2:5.4]*200);
		elseif CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==189
			axis(le_base*[1.5,5.5,1.5,5.5]);
			%set(gca,'xtick',[1.5:0.25:5.5]);
			%set(gca,'ytick',[1.5:0.25:5.5]);
			set(gca,'xtick',[]);
			set(gca,'ytick',[]);
		elseif CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==178 || CasetoRun==169
			axis([1.6,5.4,1.6,5.4]);
			set(gca,'xtick',[1.6:0.2:5.4]);
			set(gca,'ytick',[1.6:0.2:5.4]);
		elseif CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==166 || CasetoRun==165
			axis([1.6,6.4,1.6,4.4]);
			set(gca,'xtick',[1.6:0.2:6.4]);
			set(gca,'ytick',[1.6:0.2:4.4]);
		elseif CasetoRun==129 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==130 || CasetoRun==140 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142
			axis([1.8,6.2,1.8,4.45]);
			set(gca,'xtick',[1.8:0.2:6.2]);
			set(gca,'ytick',[1.8:0.2:4.45]);
		elseif CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==147 || CasetoRun==145
			axis([1.8,13.2,1.8,5.2]);
			set(gca,'xtick',[1.8:0.2:13.2]);
			set(gca,'ytick',[1.8:0.2:5.2]);
		elseif CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153
			axis([0,14,0,14]);
			set(gca,'xtick',[0:1:14]);
			set(gca,'ytick',[0:1:14]);		
		elseif CasetoRun==154 || CasetoRun==161
			axis([2.5,5.5,2.5,5.5]);
			set(gca,'xtick',[2.5:0.25:5.5]);
			set(gca,'ytick',[2.5:0.25:5.5]);				
		elseif CasetoRun==138
			axis([1.8,4.2,1.8,4.2]*4.5);
			set(gca,'xtick',[1.8:0.2:4.2]*4.5);
			set(gca,'ytick',[1.8:0.2:4.2]*4.5);
		elseif CasetoRun==134 || CasetoRun==136
			axis([1.8,7.7,1.8,4.45]);
			set(gca,'xtick',[1.8:0.2:7.7]);
			set(gca,'ytick',[1.8:0.2:4.45]);
		elseif CasetoRun==124
			axis([1.3,11.7,1.3,10.4]);
			set(gca,'xtick',[1.3:1.3:11.7]);
			set(gca,'ytick',[1.3:1.3:10.4]);
		elseif CasetoRun==175 || CasetoRun==194 || CasetoRun==180
			if refinementfactor==2
				axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
				set(gca,'xtick',[0:0.5:max(LOC(:,1))]);
				set(gca,'ytick',[0:0.5:max(LOC(:,2))]);
			elseif refinementfactor==4
				axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
				set(gca,'xtick',[0:0.25:max(LOC(:,1))]);
				set(gca,'ytick',[0:0.25:max(LOC(:,2))]);
			else
				axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
				set(gca,'xtick',[0:max(LOC(:,1)):max(LOC(:,1))]);
				set(gca,'ytick',[0:max(LOC(:,2)):max(LOC(:,2))]);
			end
			set(gca,'Yticklabel',[]);
			set(gca,'Xticklabel',[]);
		else
			axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
			set(gca,'xtick',[0:20:max(LOC(:,1))]);
			set(gca,'ytick',[0:20:max(LOC(:,2))]);
		end
		h=colorbar;
		colormap(jet(256))
		set(gca,'FontSize',20)
	else
		StressProfile1=[];
	end
	% set(h, 'ytick', [0:0.2:1.2]);
	if exist('climits')
		if length(climits)>0
			if climits(2)>climits(1)
				caxis(climits);
			end
		end
	end
end



%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [StressProfile1]=Plot_Cohesive_dispi(x_crack_abs_force,x_crack_bridge_absdeltaxmaxi,x_sp,x_crack,x_cracktop,x_crackbot,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,e_pl_sp,climits,maxminshear,lp,plotignore,ActuallyPlot,CasetoRun,refinementfactor)
	%BASED ON Plot_Final2_principalclimit_directions_crackmultiline
	x_corner1              = zeros(spCount,2);
	x_corner2              = zeros(spCount,2);
	x_corner3              = zeros(spCount,2);
	x_corner4              = zeros(spCount,2);
	
	%displacement = zeros(spCount,1);
	velocity = zeros(spCount,1);
	%strain = zeros(spCount,1);
	for sp=1:spCount
	%	displacement(sp) = sqrt(d_sp(sp,1)^2+d_sp(sp,2)^2);
		velocity(sp) = sqrt(v_ssp(sp,1)^2+v_ssp(sp,2)^2);
	%	strain(sp) = sqrt(e_sp(sp,1)^2+e_sp(sp,2)^2);
	end
	
	for sp=1:spCount
		x_corner1(sp,:) = x_sp(sp,:) - r1_sp(sp,:) - r2_sp(sp,:);      % Position of corner 1
		x_corner2(sp,:) = x_sp(sp,:) + r1_sp(sp,:) - r2_sp(sp,:);
		x_corner3(sp,:) = x_sp(sp,:) + r1_sp(sp,:) + r2_sp(sp,:);
		x_corner4(sp,:) = x_sp(sp,:) - r1_sp(sp,:) + r2_sp(sp,:);
	end

	%%Calculating Max Princ Plast Strain
	thetamax=zeros(1,spCount);
	thetamin=zeros(1,spCount);
	for sp=1:spCount
		theta=1/2*atan(2*e_pl_sp(sp,3)/(e_pl_sp(sp,1)-e_pl_sp(sp,2)));
		e_pl_first=(e_pl_sp(sp,1)+e_pl_sp(sp,2))/2+(e_pl_sp(sp,1)-e_pl_sp(sp,2))/2*cos(2*theta)+e_pl_sp(sp,3)*sin(2*theta);
		e_pl_second=(e_pl_sp(sp,1)+e_pl_sp(sp,2))/2-(e_pl_sp(sp,1)-e_pl_sp(sp,2))/2*cos(2*theta)-e_pl_sp(sp,3)*sin(2*theta);
		if plotignore(sp)==0
			if e_pl_first>e_pl_second
				thetamax(sp)=theta;
				thetamin(sp)=theta+pi/2;
			else
				thetamax(sp)=theta+pi/2;
				thetamin(sp)=theta;
			end
		end
		e_pl_max(sp)=max(e_pl_first,e_pl_second);
		e_pl_min(sp)=min(e_pl_first,e_pl_second);
		e_pl_shear(sp)=(e_pl_max(sp)-e_pl_min(sp))/2;
		if isnan(e_pl_max(sp))
			e_pl_max(sp)=0;
			e_pl_min(sp)=0;
			e_pl_shear(sp)=0;
		end
	end
	szbridge=0;
	if ActuallyPlot==1
		StressProfile1=figure;
		set(StressProfile1, 'visible','off');
		if CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124 || CasetoRun==192
			sz=5*64/refinementfactor;
		elseif CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==189
			sz=5*64/refinementfactor;
			szbridge=sqrt(sz);
		elseif CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161
			sz=10*64/refinementfactor/9;
		else
			sz = 40;
		end
		%color = velocity;
		if maxminshear==1
			color = e_pl_max;
		elseif maxminshear==2
			color = e_pl_min;
		elseif maxminshear==3
			color = e_pl_shear;
		else
			disp('wrong maxminshear input!');
			pause
		end
		color_cut=cutvector(color,0,plotignore);
		x_sp_cut=cutvector(x_sp,1,plotignore);
		if CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189
		else
			scatter(x_sp_cut(:,1),x_sp_cut(:,2),sz,color_cut,'filled');
			daspect([1 1 1]);
			hold on
		end
		
		if CasetoRun==105 || CasetoRun==110
			set(StressProfile1,'Position',[0 0 1800 1800]);
		elseif CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124
			set(StressProfile1,'Position',[0 0 1800 1800]);
		end
		if CasetoRun==118 || CasetoRun==173
		elseif CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189
			for sp=1:spCount
				x_cor = [x_corner1(sp,1) x_corner2(sp,1) x_corner3(sp,1) x_corner4(sp,1) x_corner1(sp,1)];
				y_cor = [x_corner1(sp,2) x_corner2(sp,2) x_corner3(sp,2) x_corner4(sp,2) x_corner1(sp,2)];
				plot(x_cor,y_cor,'r')
				if sp==1
					hold on;
					daspect([1 1 1]);
				end
				if plotignore(sp)
					continue;
				end
				if maxminshear==1
					thetaplot=thetamax(sp);
				elseif maxminshear==2
					thetaplot=thetamin(sp);
				elseif maxminshear==3
					continue;
				else
					disp('MaxminShear Wrong! Put either 1, 2, or 3!')
					pause
				end
				xstart=x_sp(sp,1)-lp(1)*sqrt(2)/2*cos(thetaplot);
				xend=x_sp(sp,1)+lp(1)*sqrt(2)/2*cos(thetaplot);
				ystart=x_sp(sp,2)-lp(2)*sqrt(2)/2*sin(thetaplot);
				yend=x_sp(sp,2)+lp(2)*sqrt(2)/2*sin(thetaplot);
				plot([xstart xend],[ystart yend],'color','black');
			end
		elseif CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==152 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124
			for sp=1:spCount
				if plotignore(sp)
					continue;
				end
				if maxminshear==1
					thetaplot=thetamax(sp);
				elseif maxminshear==2
					thetaplot=thetamin(sp);
				elseif maxminshear==3
					continue;
				else
					disp('MaxminShear Wrong! Put either 1, 2, or 3!')
					pause
				end
				xstart=x_sp(sp,1)-lp(1)*sqrt(2)/2*cos(thetaplot);
				xend=x_sp(sp,1)+lp(1)*sqrt(2)/2*cos(thetaplot);
				ystart=x_sp(sp,2)-lp(2)*sqrt(2)/2*sin(thetaplot);
				yend=x_sp(sp,2)+lp(2)*sqrt(2)/2*sin(thetaplot);
				plot([xstart xend],[ystart yend],'color','black');
			end
		elseif CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161
			for sp=1:spCount
				x_cor = [x_corner1(sp,1) x_corner2(sp,1) x_corner3(sp,1) x_corner4(sp,1) x_corner1(sp,1)];
				y_cor = [x_corner1(sp,2) x_corner2(sp,2) x_corner3(sp,2) x_corner4(sp,2) x_corner1(sp,2)];
				plot(x_cor,y_cor,'r')
				if plotignore(sp)
					continue;
				end
				if maxminshear==1
					thetaplot=thetamax(sp);
				elseif maxminshear==2
					thetaplot=thetamin(sp);
				elseif maxminshear==3
					continue;
				else
					disp('MaxminShear Wrong! Put either 1, 2, or 3!')
					pause
				end
				xstart=x_sp(sp,1)-lp(1)*sqrt(2)/2*cos(thetaplot);
				xend=x_sp(sp,1)+lp(1)*sqrt(2)/2*cos(thetaplot);
				ystart=x_sp(sp,2)-lp(2)*sqrt(2)/2*sin(thetaplot);
				yend=x_sp(sp,2)+lp(2)*sqrt(2)/2*sin(thetaplot);
				plot([xstart xend],[ystart yend],'color','black');
			end
		else
			for sp=1:spCount
				x_cor = [x_corner1(sp,1) x_corner2(sp,1) x_corner3(sp,1) x_corner4(sp,1) x_corner1(sp,1)];
				y_cor = [x_corner1(sp,2) x_corner2(sp,2) x_corner3(sp,2) x_corner4(sp,2) x_corner1(sp,2)];
				plot(x_cor,y_cor,'r')
				if plotignore(sp)
					continue;
				end
				if maxminshear==1
					thetaplot=thetamax(sp);
				elseif maxminshear==2
					thetaplot=thetamin(sp);
				elseif maxminshear==3
					continue;
				else
					disp('MaxminShear Wrong! Put either 1, 2, or 3!')
					pause
				end
				xstart=x_sp(sp,1)-lp(1)*sqrt(2)/2*cos(thetaplot);
				% xend=x_sp(sp,1)+lp(1)*sqrt(2)/2*cos(thetaplot);
				ystart=x_sp(sp,2)-lp(2)*sqrt(2)/2*sin(thetaplot);
				yend=x_sp(sp,2)+lp(2)*sqrt(2)/2*sin(thetaplot);
				plot([xstart xend],[ystart yend],'color','black');
			end
		end
		
		force.min=zeros(1,1);
		force.max=zeros(1,1);
		
		force.min=inf;
		force.max=-inf;
		
		if CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189
			if length(x_crack)==0
			else
				for icrackpath=1:length(x_crack)
					for iparticle=1:size(x_crack{icrackpath},1)
						if x_crack_bridge_absdeltaxmaxi(iparticle,icrackpath)<force.min
							force.min=x_crack_bridge_absdeltaxmaxi(iparticle,icrackpath);
						elseif x_crack_bridge_absdeltaxmaxi(iparticle,icrackpath)>force.max
							force.max=x_crack_bridge_absdeltaxmaxi(iparticle,icrackpath);
						end
					end
				end
			end
			if exist('climits')
				if length(climits)>0
					if climits(2)>climits(1)
						climits(1)=min(climits(1),force.min);
						climits(2)=max(climits(2),force.max);
					end
                end
            end
			if exist('climits')==0 || length(climits)==0
				climits(1)=force.min;
				climits(2)=force.max;
			end
			if length(x_crack)==0
			else
				for icrackpath=1:length(x_crack)
					%plot(x_cracktop{icrackpath}(:,1),x_cracktop{icrackpath}(:,2),'Color','red','LineWidth',0.5);
					plot(x_crack{icrackpath}(:,1),x_crack{icrackpath}(:,2),'-','Color','black','LineWidth',2);
					%plot(x_crackbot{icrackpath}(:,1),x_crackbot{icrackpath}(:,2),'Color','blue','LineWidth',0.5);
					for iparticle=1:size(x_crack{icrackpath},1)
																																  
																																  
						if x_crack_bridge_absdeltaxmaxi(iparticle,icrackpath)>0 || x_crack_abs_force(iparticle,icrackpath)>0
							plotcolor=jet2rgb(256,climits(1),climits(2),x_crack_bridge_absdeltaxmaxi(iparticle,icrackpath));
							x_plot=[x_cracktop{icrackpath}(iparticle,1) x_crackbot{icrackpath}(iparticle,1)];
							y_plot=[x_cracktop{icrackpath}(iparticle,2) x_crackbot{icrackpath}(iparticle,2)];
							plot(x_plot,y_plot,'Color',plotcolor,'LineWidth',1);
							plot(sum(x_plot)/2,sum(y_plot)/2,'o','MarkerSize',szbridge,'MarkerEdgeColor',plotcolor);
							plot(sum(x_plot)/2,sum(y_plot)/2,'o','MarkerSize',szbridge+0.2,'MarkerEdgeColor',plotcolor);
							plot(sum(x_plot)/2,sum(y_plot)/2,'o','MarkerSize',szbridge+0.4,'MarkerEdgeColor',plotcolor);
							plot(sum(x_plot)/2,sum(y_plot)/2,'o','MarkerSize',szbridge+0.6,'MarkerEdgeColor',plotcolor);
							plot(sum(x_plot)/2,sum(y_plot)/2,'o','MarkerSize',szbridge+0.8,'MarkerEdgeColor',plotcolor);
							plot(sum(x_plot)/2,sum(y_plot)/2,'o','MarkerSize',szbridge-0.2,'MarkerEdgeColor',plotcolor);
							plot(sum(x_plot)/2,sum(y_plot)/2,'o','MarkerSize',szbridge-0.4,'MarkerEdgeColor',plotcolor);
							plot(sum(x_plot)/2,sum(y_plot)/2,'o','MarkerSize',szbridge-0.6,'MarkerEdgeColor',plotcolor);
							plot(sum(x_plot)/2,sum(y_plot)/2,'o','MarkerSize',szbridge-0.8,'MarkerEdgeColor',plotcolor);
							%'MarkerFaceColor',plotcolor
						end
					end
				end
			end
		end
		grid on
		if CasetoRun==118 || CasetoRun==173 || CasetoRun==192
			axis([1.8,4.2,1.8,4.2]);
			set(gca,'xtick',[1.8:0.2:4.2]);
			set(gca,'ytick',[1.8:0.2:4.2]);
		elseif CasetoRun==123 || CasetoRun==151 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128
			axis([1.8,6.2,1.8,4.2]);
			set(gca,'xtick',[1.8:0.2:6.2]);
			set(gca,'ytick',[1.8:0.2:4.2]);
		elseif CasetoRun==179
			axis([1.6,5.4,1.6,5.4]*200);
			set(gca,'xtick',[1.6:0.2:5.4]*200);
			set(gca,'ytick',[1.6:0.2:5.4]*200);
		elseif CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==189
			axis([1.5,5.5,1.5,5.5]);
			set(gca,'xtick',[1.5:0.25:5.5]);
			set(gca,'ytick',[1.5:0.25:5.5]);
		elseif CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==178 || CasetoRun==169
			axis([1.6,5.4,1.6,5.4]);
			set(gca,'xtick',[1.6:0.2:5.4]);
			set(gca,'ytick',[1.6:0.2:5.4]);
		elseif CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==166 || CasetoRun==165
			axis([1.6,6.4,1.6,4.4]);
			set(gca,'xtick',[1.6:0.2:6.4]);
			set(gca,'ytick',[1.6:0.2:4.4]);
		elseif CasetoRun==129 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==130 || CasetoRun==140 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142
			axis([1.8,6.2,1.8,4.45]);
			set(gca,'xtick',[1.8:0.2:6.2]);
			set(gca,'ytick',[1.8:0.2:4.45]);
		elseif CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==147 || CasetoRun==145
			axis([1.8,13.2,1.8,5.2]);
			set(gca,'xtick',[1.8:0.2:13.2]);
			set(gca,'ytick',[1.8:0.2:5.2]);
		elseif CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153
			axis([0,14,0,14]);
			set(gca,'xtick',[0:1:14]);
			set(gca,'ytick',[0:1:14]);		
		elseif CasetoRun==154 || CasetoRun==161
			axis([2.5,5.5,2.5,5.5]);
			set(gca,'xtick',[2.5:0.25:5.5]);
			set(gca,'ytick',[2.5:0.25:5.5]);				
		elseif CasetoRun==138
			axis([1.8,4.2,1.8,4.2]*4.5);
			set(gca,'xtick',[1.8:0.2:4.2]*4.5);
			set(gca,'ytick',[1.8:0.2:4.2]*4.5);
		elseif CasetoRun==134 || CasetoRun==136
			axis([1.8,7.7,1.8,4.45]);
			set(gca,'xtick',[1.8:0.2:7.7]);
			set(gca,'ytick',[1.8:0.2:4.45]);
		elseif CasetoRun==124
			axis([1.3,11.7,1.3,10.4]);
			set(gca,'xtick',[1.3:1.3:11.7]);
			set(gca,'ytick',[1.3:1.3:10.4]);
		elseif CasetoRun==175 || CasetoRun==194 || CasetoRun==180
			if refinementfactor==2
				axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
				set(gca,'xtick',[0:0.5:max(LOC(:,1))]);
				set(gca,'ytick',[0:0.5:max(LOC(:,2))]);
			elseif refinementfactor==4
				axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
				set(gca,'xtick',[0:0.25:max(LOC(:,1))]);
				set(gca,'ytick',[0:0.25:max(LOC(:,2))]);
			else
				axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
				set(gca,'xtick',[0:max(LOC(:,1)):max(LOC(:,1))]);
				set(gca,'ytick',[0:max(LOC(:,2)):max(LOC(:,2))]);
			end
			set(gca,'Yticklabel',[]);
			set(gca,'Xticklabel',[]);
		else
			axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
			set(gca,'xtick',[0:20:max(LOC(:,1))]);
			set(gca,'ytick',[0:20:max(LOC(:,2))]);
		end
		h=colorbar;
		colormap(jet(256))
		set(gca,'FontSize',20)
	else
		StressProfile1=[];
	end
	% set(h, 'ytick', [0:0.2:1.2]);
	if exist('climits')
		if length(climits)>0
			if climits(2)>climits(1)
				caxis(climits);
			end
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function thergb=jet2rgb(colordepth,value_min,value_max,value_cur);
	%value_cur is a vector
	rgblist=jet(colordepth);
	value_cur_relative=zeros(1,length(value_cur));
	thergb=zeros(length(value_cur),3);
	for idata=1:length(value_cur)
		if value_cur(idata)<value_min
			value_cur_relative(idata)=0;
		elseif value_cur(idata)>value_max
			value_cur_relative(idata)=1;
		else
			value_cur_relative(idata)=(value_cur(idata)-value_min)/(value_max-value_min);
		end
		for idepth=1:colordepth
			if value_cur_relative(idata)<=idepth/colordepth
				thergb(idata,:)=rgblist(idepth,:);
				break;
			end
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [StressProfile1,vgtensor_ni_x,vgtensor_ni_y,vgtensor_ni_xy]=Plot_Final2_xyz_node(x_crack,x_cracktop,x_crackbot,LOC,le,d_sp,e_sp,v_ssp,niCount,r1_sp,r2_sp,E_acc,vgtensor_ni,climits,xyshear,ActuallyPlot,CasetoRun,refinementfactor)
	%{
	x_corner1              = zeros(niCount,2);
	x_corner2              = zeros(niCount,2);
	x_corner3              = zeros(niCount,2);
	x_corner4              = zeros(niCount,2);
	%}
	%displacement = zeros(niCount,1);
	%velocity = zeros(niCount,1);
	%strain = zeros(niCount,1);
	%{
	for sp=1:niCount
	%	displacement(sp) = sqrt(d_sp(sp,1)^2+d_sp(sp,2)^2);
		velocity(sp) = sqrt(v_ssp(sp,1)^2+v_ssp(sp,2)^2);
	%	strain(sp) = sqrt(e_sp(sp,1)^2+e_sp(sp,2)^2);
	end
	%}
	%{
	for sp=1:niCount
		x_corner1(sp,:) = x_sp(sp,:) - r1_sp(sp,:) - r2_sp(sp,:);      % Position of corner 1
		x_corner2(sp,:) = x_sp(sp,:) + r1_sp(sp,:) - r2_sp(sp,:);
		x_corner3(sp,:) = x_sp(sp,:) + r1_sp(sp,:) + r2_sp(sp,:);
		x_corner4(sp,:) = x_sp(sp,:) - r1_sp(sp,:) + r2_sp(sp,:);
	end
	%}
	%%Calculating Max Princ Plast Strain
	thetamax=zeros(1,niCount);
	thetamin=zeros(1,niCount);
	if ActuallyPlot==1
		StressProfile1=figure;
		set(StressProfile1, 'visible','off');
		if CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==130 || CasetoRun==124
			sz=10*512/refinementfactor^2;
		elseif CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142
			sz=10*128/refinementfactor^2;
		else
			sz=40;
		end
		vgtensor_ni_x=vgtensor_ni(:,1);
		vgtensor_ni_y=vgtensor_ni(:,2);
		vgtensor_ni_xy=vgtensor_ni(:,3);
		%color = velocity;
		if xyshear==1
			color = vgtensor_ni(:,1);
		elseif xyshear==2
			color = vgtensor_ni(:,2);
		elseif xyshear==3
			color = vgtensor_ni(:,3);
		else
			disp('wrong xyshear input!');
			pause
		end
		scatter(LOC(:,1),LOC(:,2),sz,color,'filled');
		hold on
		daspect([1 1 1]);
		if CasetoRun==105 || CasetoRun==110
			set(StressProfile1,'Position',[0 0 1800 1800]);
		elseif CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124
			set(StressProfile1,'Position',[0 0 1800 1800]);
		end

		if length(x_crack)==0
		else
			for icrackpath=1:length(x_crack)
				%plot(x_cracktop{icrackpath}(:,1),x_cracktop{icrackpath}(:,2),'o','Color','red');
				plot(x_crack{icrackpath}(:,1),x_crack{icrackpath}(:,2),'-','Color','black','LineWidth',2);
				%plot(x_crackbot{icrackpath}(:,1),x_crackbot{icrackpath}(:,2),'o','Color','blue');
			end
		end
		grid on
		if CasetoRun==118 || CasetoRun==173 || CasetoRun==192
			axis([1.8,4.2,1.8,4.2]);
			set(gca,'xtick',[1.8:0.2:4.2]);
			set(gca,'ytick',[1.8:0.2:4.2]);
		elseif CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169
			axis([1.8,5.2,1.8,5.2]);
			set(gca,'xtick',[1.8:0.2:5.2]);
			set(gca,'ytick',[1.8:0.2:5.2]);
		elseif CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128
			axis([1.8,6.2,1.8,4.2]);
			set(gca,'xtick',[1.8:0.2:6.2]);
			set(gca,'ytick',[1.8:0.2:4.2]);
		elseif CasetoRun==129 || CasetoRun==132 || CasetoRun==130
			axis([1.8,6.2,1.8,4.45]);
			set(gca,'xtick',[1.8:0.2:6.2]);
			set(gca,'ytick',[1.8:0.2:4.45]);
		elseif CasetoRun==138
			axis([1.8,4.2,1.8,4.2]*4.5);
			set(gca,'xtick',[1.8:0.2:4.2]*4.5);
			set(gca,'ytick',[1.8:0.2:4.2]*4.5);
		elseif CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==140 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142
			axis([1.8,10.2,1.8,4.45]);
			set(gca,'xtick',[1.8:0.2:10.2]);
			set(gca,'ytick',[1.8:0.2:4.45]);
		elseif CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145
			axis([1.8,13.2,1.8,5.2]);
			set(gca,'xtick',[1.8:0.2:13.2]);
			set(gca,'ytick',[1.8:0.2:5.2]);
		elseif CasetoRun==134 || CasetoRun==136
			axis([1.8,7.7,1.8,4.45]);
			set(gca,'xtick',[1.8:0.2:7.7]);
			set(gca,'ytick',[1.8:0.2:4.45]);
		elseif CasetoRun==124
			axis([1.3,11.7,1.3,10.4]);
			set(gca,'xtick',[1.3:1.3:11.7]);
			set(gca,'ytick',[1.3:1.3:10.4]);
		else
			axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
			set(gca,'xtick',[0:20:max(LOC(:,1))]);
			set(gca,'ytick',[0:20:max(LOC(:,2))]);
		end
		h=colorbar;
		colormap(jet(256))
		set(gca,'FontSize',20)
	else
		StressProfile1=[];
	end
	% set(h, 'ytick', [0:0.2:1.2]);
	if exist('climits')
		if length(climits)>0
			if climits(2)>climits(1)
				caxis(climits);
			end
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [StressProfile1,vgvector_sp_x,vgvector_sp_y,vgtensor_ni_xy]=Plot_Final2_xyz_particle(x_crack,x_cracktop,x_crackbot,x_sp,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,vgvector_sp,climits,x_or_y,ActuallyPlot,CasetoRun,refinementfactor)
	%{
	x_corner1              = zeros(spCount,2);
	x_corner2              = zeros(spCount,2);
	x_corner3              = zeros(spCount,2);
	x_corner4              = zeros(spCount,2);
	%}
	%displacement = zeros(spCount,1);
	%velocity = zeros(spCount,1);
	%strain = zeros(spCount,1);
	%{
	for sp=1:spCount
	%	displacement(sp) = sqrt(d_sp(sp,1)^2+d_sp(sp,2)^2);
		velocity(sp) = sqrt(v_ssp(sp,1)^2+v_ssp(sp,2)^2);
	%	strain(sp) = sqrt(e_sp(sp,1)^2+e_sp(sp,2)^2);
	end
	%}
	%{
	for sp=1:spCount
		x_corner1(sp,:) = x_sp(sp,:) - r1_sp(sp,:) - r2_sp(sp,:);      % Position of corner 1
		x_corner2(sp,:) = x_sp(sp,:) + r1_sp(sp,:) - r2_sp(sp,:);
		x_corner3(sp,:) = x_sp(sp,:) + r1_sp(sp,:) + r2_sp(sp,:);
		x_corner4(sp,:) = x_sp(sp,:) - r1_sp(sp,:) + r2_sp(sp,:);
	end
	%}
	%%Calculating Max Princ Plast Strain
	thetamax=zeros(1,spCount);
	thetamin=zeros(1,spCount);
	if ActuallyPlot==1
		StressProfile1=figure;
		set(StressProfile1, 'visible','off');
		if CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==130 || CasetoRun==124 || CasetoRun==192
			sz=10*512/refinementfactor^2;
		elseif CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==146 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142
			sz=10*128/refinementfactor^2/25;
		elseif CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==189
			sz=5*64/refinementfactor;
		else
			sz=40;
		end
		vgvector_sp_x=vgvector_sp(:,1);
		vgvector_sp_y=vgvector_sp(:,2);
		%color = velocity;
		if x_or_y==1
			color = vgvector_sp(:,1);
		elseif x_or_y==2
			color = vgvector_sp(:,2);
		elseif x_or_y==3
			color = vgvector_sp(:,3);
		else
			disp('wrong x_or_y input!');
			pause
		end
		scatter(x_sp(:,1),x_sp(:,2),sz,color,'filled');
		hold on
		daspect([1 1 1]);
		if CasetoRun==105 || CasetoRun==110
			set(StressProfile1,'Position',[0 0 1800 1800]);
		elseif CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==146 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124 || CasetoRun==192
			set(StressProfile1,'Position',[0 0 1800 1800]);
		elseif CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==189
			set(StressProfile1,'Position',[0 0 1800 1800]);
		end
		
		if length(x_crack)==0
		else
			for icrackpath=1:length(x_crack)
				plot(x_cracktop{icrackpath}(:,1),x_cracktop{icrackpath}(:,2),'o','Color','red');
				plot(x_crack{icrackpath}(:,1),x_crack{icrackpath}(:,2),'-','Color','black','LineWidth',2);
				plot(x_crackbot{icrackpath}(:,1),x_crackbot{icrackpath}(:,2),'o','Color','blue');
			end
		end
		grid on
		if CasetoRun==118 || CasetoRun==173 || CasetoRun==192
			axis([1.8,4.2,1.8,4.2]);
			set(gca,'xtick',[1.8:0.2:4.2]);
			set(gca,'ytick',[1.8:0.2:4.2]);
		elseif CasetoRun==123 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128
			axis([1.8,6.2,1.8,4.2]);
			set(gca,'xtick',[1.8:0.2:6.2]);
			set(gca,'ytick',[1.8:0.2:4.2]);
		elseif CasetoRun==129 || CasetoRun==132 || CasetoRun==130
			axis([1.8,6.2,1.8,4.45]);
			set(gca,'xtick',[1.8:0.2:6.2]);
			set(gca,'ytick',[1.8:0.2:4.45]);
		elseif CasetoRun==138
			axis([1.8,4.2,1.8,4.2]*4.5);
			set(gca,'xtick',[1.8:0.2:4.2]*4.5);
			set(gca,'ytick',[1.8:0.2:4.2]*4.5);
		elseif CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==140 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142
			axis([1.8,10.2,1.8,4.45]);
			set(gca,'xtick',[1.8:0.2:10.2]);
			set(gca,'ytick',[1.8:0.2:4.45]);
		elseif CasetoRun==144 || CasetoRun==146 || CasetoRun==145
			axis([1.8,13.2,1.8,5.2]);
			set(gca,'xtick',[1.8:0.4:13.2]);
			set(gca,'ytick',[1.8:0.4:5.2]);
		elseif CasetoRun==134 || CasetoRun==136
			axis([1.8,7.7,1.8,4.45]);
			set(gca,'xtick',[1.8:0.2:7.7]);
			set(gca,'ytick',[1.8:0.2:4.45]);
		elseif CasetoRun==124
			axis([1.3,11.7,1.3,10.4]);
			set(gca,'xtick',[1.3:1.3:11.7]);
			set(gca,'ytick',[1.3:1.3:10.4]);
		elseif CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==189
			axis([1.5,5.5,1.5,5.5]);
			set(gca,'xtick',[1.5:0.25:5.5]);
			set(gca,'ytick',[1.5:0.25:5.5]);
		else
			axis([0,max(x_sp(:,1)),0,max(x_sp(:,2))]);
			set(gca,'xtick',[0:20:max(x_sp(:,1))]);
			set(gca,'ytick',[0:20:max(x_sp(:,2))]);
		end
		h=colorbar;
		colormap(jet(256))
		set(gca,'FontSize',20)
	else
		StressProfile1=[];
	end
	% set(h, 'ytick', [0:0.2:1.2]);
	if exist('climits')
		if length(climits)>0
			if climits(2)>climits(1)
				caxis(climits);
			end
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [StressProfile1,principal_max,principal_min,principal_shear]=Plot_Final2_principalclimit_directions_node(x_crack,x_cracktop,x_crackbot,LOC,le,d_sp,e_sp,v_ssp,niCount,r1_sp,r2_sp,E_acc,vgtensor_ni,climits,maxminshear,ActuallyPlot,CasetoRun,refinementfactor)
	%{
	x_corner1              = zeros(niCount,2);
	x_corner2              = zeros(niCount,2);
	x_corner3              = zeros(niCount,2);
	x_corner4              = zeros(niCount,2);
	%}
	%displacement = zeros(niCount,1);
	%velocity = zeros(niCount,1);
	%strain = zeros(niCount,1);
	%{
	for sp=1:niCount
	%	displacement(sp) = sqrt(d_sp(sp,1)^2+d_sp(sp,2)^2);
		velocity(sp) = sqrt(v_ssp(sp,1)^2+v_ssp(sp,2)^2);
	%	strain(sp) = sqrt(e_sp(sp,1)^2+e_sp(sp,2)^2);
	end
	%}
	%{
	for sp=1:niCount
		x_corner1(sp,:) = x_sp(sp,:) - r1_sp(sp,:) - r2_sp(sp,:);      % Position of corner 1
		x_corner2(sp,:) = x_sp(sp,:) + r1_sp(sp,:) - r2_sp(sp,:);
		x_corner3(sp,:) = x_sp(sp,:) + r1_sp(sp,:) + r2_sp(sp,:);
		x_corner4(sp,:) = x_sp(sp,:) - r1_sp(sp,:) + r2_sp(sp,:);
	end
	%}
	%%Calculating Max Princ Plast Strain
	thetamax=zeros(1,niCount);
	thetamin=zeros(1,niCount);
	for io=1:niCount
		theta=1/2*atan(2*vgtensor_ni(io,3)/(vgtensor_ni(io,1)-vgtensor_ni(io,2)));
		principal_first=(vgtensor_ni(io,1)+vgtensor_ni(io,2))/2+(vgtensor_ni(io,1)-vgtensor_ni(io,2))/2*cos(2*theta)+vgtensor_ni(io,3)*sin(2*theta);
		principal_second=(vgtensor_ni(io,1)+vgtensor_ni(io,2))/2-(vgtensor_ni(io,1)-vgtensor_ni(io,2))/2*cos(2*theta)-vgtensor_ni(io,3)*sin(2*theta);
		if principal_first>principal_second
			thetamax(io)=theta;
			thetamin(io)=theta+pi/2;
		else
			thetamax(io)=theta+pi/2;
			thetamin(io)=theta;
		end
		principal_max(io)=max(principal_first,principal_second);
		principal_min(io)=min(principal_first,principal_second);
		principal_shear(io)=(principal_max(io)-principal_min(io))/2; %yes it's not the right name but easy to understand right?
	end
	if ActuallyPlot==1
		StressProfile1=figure;
		set(StressProfile1, 'visible','off');
		if CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==130 || CasetoRun==124 || CasetoRun==192
			sz=10*1024/refinementfactor^2;
		elseif CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169
			sz=10*512/refinementfactor^2;		
		elseif CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142
			sz=10*128/refinementfactor^2;
		else
			sz=40;
		end
		%color = velocity;
		if maxminshear==1
			color = principal_max;
		elseif maxminshear==2
			color = principal_min;
		elseif maxminshear==3
			color = principal_shear;
		else
			disp('wrong maxminshear input!');
			pause
		end
		scatter(LOC(:,1),LOC(:,2),sz,color,'filled');
		hold on
		daspect([1 1 1]);
		if CasetoRun==105 || CasetoRun==110
			set(StressProfile1,'Position',[0 0 1800 1800]);
		elseif CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124
			set(StressProfile1,'Position',[0 0 1800 1800]);
		end
		if CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124
			for io=1:niCount
				if maxminshear==1
					thetaplot=thetamax(io);
				elseif maxminshear==2
					thetaplot=thetamin(io);
				elseif maxminshear==3
					continue;
				else
					disp('MaxminShear Wrong! Put either 1, 2, or 3!')
					pause
				end
				xstart=LOC(io,1)-le(1)*sqrt(2)/2*cos(thetaplot);
				xend=LOC(io,1)+le(1)*sqrt(2)/2*cos(thetaplot);
				ystart=LOC(io,2)-le(1)*sqrt(2)/2*sin(thetaplot);
				yend=LOC(io,2)+le(1)*sqrt(2)/2*sin(thetaplot);
				plot([xstart xend],[ystart yend],'color','black');
			end
		else
			for io=1:niCount
				x_cor = [x_corner1(io,1) x_corner2(io,1) x_corner3(io,1) x_corner4(io,1) x_corner1(io,1)];
				y_cor = [x_corner1(io,2) x_corner2(io,2) x_corner3(io,2) x_corner4(io,2) x_corner1(io,2)];
				plot(x_cor,y_cor,'r')
				if plotignore(io)
					continue;
				end
				if maxminshear==1
					thetaplot=thetamax(io);
				elseif maxminshear==2
					thetaplot=thetamin(io);
				elseif maxminshear==3
					continue;
				else
					disp('MaxminShear Wrong! Put either 1, 2, or 3!')
					pause
				end
				xstart=x_sp(io,1)-lp(1)*sqrt(2)/2*cos(thetaplot);
				xend=x_sp(io,1)+lp(1)*sqrt(2)/2*cos(thetaplot);
				ystart=x_sp(io,2)-lp(2)*sqrt(2)/2*sin(thetaplot);
				yend=x_sp(io,2)+lp(2)*sqrt(2)/2*sin(thetaplot);
				plot([xstart xend],[ystart yend],'color','black');
			end
		end
		if length(x_crack)==0
		else
			for icrackpath=1:length(x_crack)
				%plot(x_cracktop{icrackpath}(:,1),x_cracktop{icrackpath}(:,2),'o','Color','red');
				plot(x_crack{icrackpath}(:,1),x_crack{icrackpath}(:,2),'-','Color','black','LineWidth',2);
				%plot(x_crackbot{icrackpath}(:,1),x_crackbot{icrackpath}(:,2),'o','Color','blue');
			end
		end
		grid on
		if CasetoRun==118 || CasetoRun==173 || CasetoRun==192
			axis([1.8,4.2,1.8,4.2]);
			set(gca,'xtick',[1.8:0.2:4.2]);
			set(gca,'ytick',[1.8:0.2:4.2]);
		elseif CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169
			axis([1.8,5.2,1.8,5.2]);
			set(gca,'xtick',[1.8:0.2:5.2]);
			set(gca,'ytick',[1.8:0.2:5.2]);
		elseif CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128
			axis([1.8,6.2,1.8,4.2]);
			set(gca,'xtick',[1.8:0.2:6.2]);
			set(gca,'ytick',[1.8:0.2:4.2]);
		elseif CasetoRun==129 || CasetoRun==132 || CasetoRun==130
			axis([1.8,6.2,1.8,4.45]);
			set(gca,'xtick',[1.8:0.2:6.2]);
			set(gca,'ytick',[1.8:0.2:4.45]);
		elseif CasetoRun==138
			axis([1.8,4.2,1.8,4.2]*4.5);
			set(gca,'xtick',[1.8:0.2:4.2]*4.5);
			set(gca,'ytick',[1.8:0.2:4.2]*4.5);
		elseif CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==140 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142
			axis([1.6,10.2,1.8,4.45]);
			set(gca,'xtick',[1.6:0.2:10.2]);
			set(gca,'ytick',[1.8:0.2:4.45]);
		elseif CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==147 || CasetoRun==145
			axis([1.8,13.2,1.8,5.2]);
			set(gca,'xtick',[1.8:0.2:13.2]);
			set(gca,'ytick',[1.8:0.2:5.2]);
		elseif CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161
			axis([0,14,0,14]);
			set(gca,'xtick',[0:1:14]);
			set(gca,'ytick',[0:1:14]);
		elseif CasetoRun==134 || CasetoRun==136
			axis([1.8,7.7,1.8,4.45]);
			set(gca,'xtick',[1.8:0.2:7.7]);
			set(gca,'ytick',[1.8:0.2:4.45]);
		elseif CasetoRun==124
			axis([1.3,11.7,1.3,10.4]);
			set(gca,'xtick',[1.3:1.3:11.7]);
			set(gca,'ytick',[1.3:1.3:10.4]);
		else
			axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
			set(gca,'xtick',[0:20:max(LOC(:,1))]);
			set(gca,'ytick',[0:20:max(LOC(:,2))]);
		end
		h=colorbar;
		colormap(jet(256))
		set(gca,'FontSize',20)
	else
		StressProfile1=[];
	end
	% set(h, 'ytick', [0:0.2:1.2]);
	if exist('climits')
		if length(climits)>0
			if climits(2)>climits(1)
				caxis(climits);
			end
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [StressProfile1,principal_max,principal_min,principal_shear]=Plot_principaldirs_node_proppath(x_crack,x_cracktop,x_crackbot,LOC,le,d_sp,e_sp,v_ssp,niCount,r1_sp,r2_sp,E_acc,vgtensor_ni,climits,maxminshear,ActuallyPlot,CasetoRun,refinementfactor,x_tip_dump,r_propdirweighted_dump)
	%{
	x_corner1              = zeros(niCount,2);
	x_corner2              = zeros(niCount,2);
	x_corner3              = zeros(niCount,2);
	x_corner4              = zeros(niCount,2);
	%}
	%displacement = zeros(niCount,1);
	%velocity = zeros(niCount,1);
	%strain = zeros(niCount,1);
	%{
	for sp=1:niCount
	%	displacement(sp) = sqrt(d_sp(sp,1)^2+d_sp(sp,2)^2);
		velocity(sp) = sqrt(v_ssp(sp,1)^2+v_ssp(sp,2)^2);
	%	strain(sp) = sqrt(e_sp(sp,1)^2+e_sp(sp,2)^2);
	end
	%}
	%{
	for sp=1:niCount
		x_corner1(sp,:) = x_sp(sp,:) - r1_sp(sp,:) - r2_sp(sp,:);      % Position of corner 1
		x_corner2(sp,:) = x_sp(sp,:) + r1_sp(sp,:) - r2_sp(sp,:);
		x_corner3(sp,:) = x_sp(sp,:) + r1_sp(sp,:) + r2_sp(sp,:);
		x_corner4(sp,:) = x_sp(sp,:) - r1_sp(sp,:) + r2_sp(sp,:);
	end
	%}
	%%Calculating Max Princ Plast Strain
	thetamax=zeros(1,niCount);
	thetamin=zeros(1,niCount);
	for io=1:niCount
		theta=1/2*atan(2*vgtensor_ni(io,3)/(vgtensor_ni(io,1)-vgtensor_ni(io,2)));
		principal_first=(vgtensor_ni(io,1)+vgtensor_ni(io,2))/2+(vgtensor_ni(io,1)-vgtensor_ni(io,2))/2*cos(2*theta)+vgtensor_ni(io,3)*sin(2*theta);
		principal_second=(vgtensor_ni(io,1)+vgtensor_ni(io,2))/2-(vgtensor_ni(io,1)-vgtensor_ni(io,2))/2*cos(2*theta)-vgtensor_ni(io,3)*sin(2*theta);
		if principal_first>principal_second
			thetamax(io)=theta;
			thetamin(io)=theta+pi/2;
		else
			thetamax(io)=theta+pi/2;
			thetamin(io)=theta;
		end
		principal_max(io)=max(principal_first,principal_second);
		principal_min(io)=min(principal_first,principal_second);
		principal_shear(io)=(principal_max(io)-principal_min(io))/2; %yes it's not the right name but easy to understand right?
	end
	if ActuallyPlot==1
		StressProfile1=figure;
		set(StressProfile1, 'visible','off');
		if CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==130 || CasetoRun==124
			sz=10*512/refinementfactor^2;
		elseif CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142
			sz=10*128/refinementfactor^2;
		else
			sz=40;
		end
		%color = velocity;
		if maxminshear==1
			color = principal_max;
		elseif maxminshear==2
			color = principal_min;
		elseif maxminshear==3
			color = principal_shear;
		else
			disp('wrong maxminshear input!');
			pause
		end
		scatter(LOC(:,1),LOC(:,2),sz,color,'filled');
		hold on
		daspect([1 1 1]);
		if CasetoRun==105 || CasetoRun==110
			set(StressProfile1,'Position',[0 0 1800 1800]);
		elseif CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124
			set(StressProfile1,'Position',[0 0 1800 1800]);
		end
		if CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124
			for io=1:niCount
				if maxminshear==1
					thetaplot=thetamax(io);
				elseif maxminshear==2
					thetaplot=thetamin(io);
				elseif maxminshear==3
					continue;
				else
					disp('MaxminShear Wrong! Put either 1, 2, or 3!')
					pause
				end
				xstart=LOC(io,1)-le(1)*sqrt(2)/2*cos(thetaplot);
				xend=LOC(io,1)+le(1)*sqrt(2)/2*cos(thetaplot);
				ystart=LOC(io,2)-le(1)*sqrt(2)/2*sin(thetaplot);
				yend=LOC(io,2)+le(1)*sqrt(2)/2*sin(thetaplot);
				plot([xstart xend],[ystart yend],'color','black');
			end
		else
			for io=1:niCount
				x_cor = [x_corner1(io,1) x_corner2(io,1) x_corner3(io,1) x_corner4(io,1) x_corner1(io,1)];
				y_cor = [x_corner1(io,2) x_corner2(io,2) x_corner3(io,2) x_corner4(io,2) x_corner1(io,2)];
				plot(x_cor,y_cor,'r')
				if plotignore(io)
					continue;
				end
				if maxminshear==1
					thetaplot=thetamax(io);
				elseif maxminshear==2
					thetaplot=thetamin(io);
				elseif maxminshear==3
					continue;
				else
					disp('MaxminShear Wrong! Put either 1, 2, or 3!')
					pause
				end
				xstart=x_sp(io,1)-lp(1)*sqrt(2)/2*cos(thetaplot);
				xend=x_sp(io,1)+lp(1)*sqrt(2)/2*cos(thetaplot);
				ystart=x_sp(io,2)-lp(2)*sqrt(2)/2*sin(thetaplot);
				yend=x_sp(io,2)+lp(2)*sqrt(2)/2*sin(thetaplot);
				plot([xstart xend],[ystart yend],'color','black');
			end
		end
		if length(x_crack)==0
		else
			for icrackpath=1:length(x_crack)
				%plot(x_cracktop{icrackpath}(:,1),x_cracktop{icrackpath}(:,2),'o','Color','red');
				plot(x_crack{icrackpath}(:,1),x_crack{icrackpath}(:,2),'-','Color','black','LineWidth',2);
				%plot(x_crackbot{icrackpath}(:,1),x_crackbot{icrackpath}(:,2),'o','Color','blue');
			end
		end
		if CasetoRun==118 || CasetoRun==173 || CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==192 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128 || CasetoRun==129 || CasetoRun==138 || CasetoRun==132 || CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==134 || CasetoRun==136 || CasetoRun==140 || CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142 || CasetoRun==130 || CasetoRun==124
			for itipdump=1:size(x_tip_dump,1)
				xstart=x_tip_dump(itipdump,1);
				ystart=x_tip_dump(itipdump,2);
				xend=xstart+r_propdirweighted_dump(itipdump,1)*le(1);
				yend=ystart+r_propdirweighted_dump(itipdump,2)*le(1);
				theangle=reliableatan(r_propdirweighted_dump(itipdump,1),r_propdirweighted_dump(itipdump,2));
				xendarrow1=xend+cos(theangle+3/4*pi)*le(1)/2;
				yendarrow1=yend+sin(theangle+3/4*pi)*le(1)/2;
				xendarrow2=xend+cos(theangle-3/4*pi)*le(1)/2;
				yendarrow2=yend+sin(theangle-3/4*pi)*le(1)/2;
				plot([xstart xend],[ystart yend],'color','red','LineWidth',1.5);
				plot([xend xendarrow1],[yend yendarrow1],'color','red','LineWidth',1.5);
				plot([xend xendarrow2],[yend yendarrow2],'color','red','LineWidth',1.5);
			end
		else
		end
		grid on
		if CasetoRun==118 || CasetoRun==173 || CasetoRun==192
			axis([1.8,4.2,1.8,4.2]);
			set(gca,'xtick',[1.8:0.2:4.2]);
			set(gca,'ytick',[1.8:0.2:4.2]);
		elseif CasetoRun==167 || CasetoRun==176 || CasetoRun==168 || CasetoRun==181 || CasetoRun==184 || CasetoRun==185 || CasetoRun==186 || CasetoRun==193 || CasetoRun==187 || CasetoRun==190 || CasetoRun==188 || CasetoRun==191 || CasetoRun==189 || CasetoRun==183 || CasetoRun==182 || CasetoRun==177 || CasetoRun==179 || CasetoRun==178 || CasetoRun==169
			axis([1.8,5.2,1.8,5.2]);
			set(gca,'xtick',[1.8:0.2:5.2]);
			set(gca,'ytick',[1.8:0.2:5.2]);
		elseif CasetoRun==123 || CasetoRun==151 || CasetoRun==163 || CasetoRun==170 || CasetoRun==171 || CasetoRun==166 || CasetoRun==165 || CasetoRun==125 || CasetoRun==126 || CasetoRun==127 || CasetoRun==128
			axis([1.8,6.2,1.8,4.2]);
			set(gca,'xtick',[1.8:0.2:6.2]);
			set(gca,'ytick',[1.8:0.2:4.2]);
		elseif CasetoRun==129 || CasetoRun==132 || CasetoRun==130
			axis([1.8,6.2,1.8,4.45]);
			set(gca,'xtick',[1.8:0.2:6.2]);
			set(gca,'ytick',[1.8:0.2:4.45]);
		elseif CasetoRun==138
			axis([1.8,4.2,1.8,4.2]*4.5);
			set(gca,'xtick',[1.8:0.2:4.2]*4.5);
			set(gca,'ytick',[1.8:0.2:4.2]*4.5);
		elseif CasetoRun==131 || CasetoRun==133 || CasetoRun==139 || CasetoRun==135 || CasetoRun==140 || CasetoRun==143 || CasetoRun==141 || CasetoRun==142
			axis([1.8,10.2,1.8,4.45]);
			set(gca,'xtick',[1.8:0.2:10.2]);
			set(gca,'ytick',[1.8:0.2:4.45]);
		elseif CasetoRun==144 || CasetoRun==148 || CasetoRun==146 || CasetoRun==149 || CasetoRun==150 || CasetoRun==155 || CasetoRun==158 || CasetoRun==157 || CasetoRun==160 || CasetoRun==175 || CasetoRun==194 || CasetoRun==180 || CasetoRun==156 || CasetoRun==159 || CasetoRun==162 || CasetoRun==164 || CasetoRun==172 || CasetoRun==174 || CasetoRun==152 || CasetoRun==153 || CasetoRun==154 || CasetoRun==161 || CasetoRun==147 || CasetoRun==145
			axis([1.8,13.2,1.8,5.2]);
			set(gca,'xtick',[1.8:0.2:13.2]);
			set(gca,'ytick',[1.8:0.2:5.2]);
		elseif CasetoRun==134 || CasetoRun==136
			axis([1.8,7.7,1.8,4.45]);
			set(gca,'xtick',[1.8:0.2:7.7]);
			set(gca,'ytick',[1.8:0.2:4.45]);
		elseif CasetoRun==124
			axis([1.3,11.7,1.3,10.4]);
			set(gca,'xtick',[1.3:1.3:11.7]);
			set(gca,'ytick',[1.3:1.3:10.4]);
		else
			axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
			set(gca,'xtick',[0:20:max(LOC(:,1))]);
			set(gca,'ytick',[0:20:max(LOC(:,2))]);
		end
		h=colorbar;
		colormap(jet(256))
		set(gca,'FontSize',20)
	else
		StressProfile1=[];
	end
	% set(h, 'ytick', [0:0.2:1.2]);
	if exist('climits')
		if length(climits)>0
			if climits(2)>climits(1)
				caxis(climits);
			end
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [StressProfile1,e_pl_max,e_pl_min,e_pl_shear]=Plot_principal_crackmulti_pforce(x_sp,x_crack,x_cracktop,x_crackbot,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,e_pl_sp,climits,maxminshear,lp,plotignore,ActuallyPlot,CasetoRun,pforce_sp)
	x_corner1              = zeros(spCount,2);
	x_corner2              = zeros(spCount,2);
	x_corner3              = zeros(spCount,2);
	x_corner4              = zeros(spCount,2);
	 
	%displacement = zeros(spCount,1);
	velocity = zeros(spCount,1);
	%strain = zeros(spCount,1);
	for sp=1:spCount
	%	displacement(sp) = sqrt(d_sp(sp,1)^2+d_sp(sp,2)^2);
		velocity(sp) = sqrt(v_ssp(sp,1)^2+v_ssp(sp,2)^2);
	%	strain(sp) = sqrt(e_sp(sp,1)^2+e_sp(sp,2)^2);
	end
	
	for sp=1:spCount
		x_corner1(sp,:) = x_sp(sp,:) - r1_sp(sp,:) - r2_sp(sp,:);      % Position of corner 1
		x_corner2(sp,:) = x_sp(sp,:) + r1_sp(sp,:) - r2_sp(sp,:);
		x_corner3(sp,:) = x_sp(sp,:) + r1_sp(sp,:) + r2_sp(sp,:);
		x_corner4(sp,:) = x_sp(sp,:) - r1_sp(sp,:) + r2_sp(sp,:);
	end

	%%Calculating Max Princ Plast Strain
	thetamax=zeros(1,spCount);
	thetamin=zeros(1,spCount);
	for sp=1:spCount
		theta=1/2*atan(2*e_pl_sp(sp,3)/(e_pl_sp(sp,1)-e_pl_sp(sp,2)));
		e_pl_first=(e_pl_sp(sp,1)+e_pl_sp(sp,2))/2+(e_pl_sp(sp,1)-e_pl_sp(sp,2))/2*cos(2*theta)+e_pl_sp(sp,3)*sin(2*theta);
		e_pl_second=(e_pl_sp(sp,1)+e_pl_sp(sp,2))/2-(e_pl_sp(sp,1)-e_pl_sp(sp,2))/2*cos(2*theta)-e_pl_sp(sp,3)*sin(2*theta);
		if plotignore(sp)==0
			if e_pl_first>e_pl_second
				thetamax(sp)=theta;
				thetamin(sp)=theta+pi/2;
			else
				thetamax(sp)=theta+pi/2;
				thetamin(sp)=theta;
			end
		end
		e_pl_max(sp)=max(e_pl_first,e_pl_second);
		e_pl_min(sp)=min(e_pl_first,e_pl_second);
		e_pl_shear(sp)=(e_pl_max(sp)-e_pl_min(sp))/2;
		 
	end
	if ActuallyPlot==1
		StressProfile1=figure;
		set(StressProfile1, 'visible','off');
		sz = 40;
		%color = velocity;
		if maxminshear==1
			color = e_pl_max;
		elseif maxminshear==2
			color = e_pl_min;
		elseif maxminshear==3
			color = e_pl_shear;
		else
			disp('wrong maxminshear input!');
			pause
		end
		color_cut=cutvector(color,0,plotignore);
		x_sp_cut=cutvector(x_sp,1,plotignore);
		scatter(x_sp_cut(:,1),x_sp_cut(:,2),sz,color_cut,'filled');
		hold on
		daspect([1 1 1]);
		if CasetoRun==105 || CasetoRun==110
			set(StressProfile1,'Position',[0 0 1800 1800]);
		end
		for sp=1:spCount
			x_cor = [x_corner1(sp,1) x_corner2(sp,1) x_corner3(sp,1) x_corner4(sp,1) x_corner1(sp,1)];
			y_cor = [x_corner1(sp,2) x_corner2(sp,2) x_corner3(sp,2) x_corner4(sp,2) x_corner1(sp,2)];
			plot(x_cor,y_cor,'r')
			if plotignore(sp)
				continue;
			end
			if maxminshear==1
				thetaplot=thetamax(sp);
			elseif maxminshear==2
				thetaplot=thetamin(sp);
			elseif maxminshear==3
				continue;
			else
				disp('MaxminShear Wrong! Put either 1, 2, or 3!')
				pause
			end
			xstart=x_sp(sp,1)-lp(1)*sqrt(2)/2*cos(thetaplot);
			xend=x_sp(sp,1)+lp(1)*sqrt(2)/2*cos(thetaplot);
			ystart=x_sp(sp,2)-lp(2)*sqrt(2)/2*sin(thetaplot);
			yend=x_sp(sp,2)+lp(2)*sqrt(2)/2*sin(thetaplot);
			%plot([xstart xend],[ystart yend],'color','black');
		end
		if length(x_crack)==0
		else
			for icrackpath=1:length(x_crack)
				%plot(x_cracktop{icrackpath}(:,1),x_cracktop{icrackpath}(:,2),'o','Color','red');
				plot(x_crack{icrackpath}(:,1),x_crack{icrackpath}(:,2),'-','Color','black','LineWidth',2);
				%plot(x_crackbot{icrackpath}(:,1),x_crackbot{icrackpath}(:,2),'o','Color','blue');
			end
		end
		domainsizevect=[max(LOC(:,1))-min(LOC(:,1)) max(LOC(:,2))-min(LOC(:,2))];
		domainsize=sqrt(dot(domainsizevect,domainsizevect));
		pforce_magnitude=zeros(spCount,1);
		for sp=1:spCount
			pforce_magnitude(sp,1)=sqrt(dot(pforce_sp(sp,:),pforce_sp(sp,:)));
		end
		pforce_maxmagnitude=max(pforce_magnitude);
		title(['pforce_maxmagnitude=' num2str(pforce_maxmagnitude)]);
		if pforce_maxmagnitude>0
			maxlinesize=domainsize/10;
			pforcetolinescale=maxlinesize/pforce_maxmagnitude;
			for sp=1:spCount
				if pforce_magnitude(sp,1)>0
					pforce_angle=reliableatan(pforce_sp(sp,1),pforce_sp(sp,2));
					linelength=pforce_magnitude(sp,1)*pforcetolinescale;
					plot([x_sp(sp,1) x_sp(sp,1)+linelength*cos(pforce_angle)],[x_sp(sp,2) x_sp(sp,2)+linelength*sin(pforce_angle)],'color','red','LineWidth',1.5);
				end
			end
		end
		grid on
		axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
		set(gca,'xtick',[0:20:max(LOC(:,1))]);
		set(gca,'ytick',[0:20:max(LOC(:,2))]);
		h=colorbar;
		colormap(jet(256))
		set(gca,'FontSize',20)
	else
		StressProfile1=[];
	end
	% set(h, 'ytick', [0:0.2:1.2]);
	if exist('climits')
		if length(climits)>0
			if climits(2)>climits(1)
				caxis(climits);
			end
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [StressProfile1,e_pl_max,e_pl_min,e_pl_shear]=Plot_principal_crackmulti_ntforce(x_sp,x_crack,x_cracktop,x_crackbot,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,e_pl_sp,climits,maxminshear,lp,plotignore,ActuallyPlot,CasetoRun,ntforce_si)
	x_corner1              = zeros(spCount,2);
	x_corner2              = zeros(spCount,2);
	x_corner3              = zeros(spCount,2);
	x_corner4              = zeros(spCount,2);
	 
	%displacement = zeros(spCount,1);
	velocity = zeros(spCount,1);
	%strain = zeros(spCount,1);
	for sp=1:spCount
	%	displacement(sp) = sqrt(d_sp(sp,1)^2+d_sp(sp,2)^2);
		velocity(sp) = sqrt(v_ssp(sp,1)^2+v_ssp(sp,2)^2);
	%	strain(sp) = sqrt(e_sp(sp,1)^2+e_sp(sp,2)^2);
	end
	
	for sp=1:spCount
		x_corner1(sp,:) = x_sp(sp,:) - r1_sp(sp,:) - r2_sp(sp,:);      % Position of corner 1
		x_corner2(sp,:) = x_sp(sp,:) + r1_sp(sp,:) - r2_sp(sp,:);
		x_corner3(sp,:) = x_sp(sp,:) + r1_sp(sp,:) + r2_sp(sp,:);
		x_corner4(sp,:) = x_sp(sp,:) - r1_sp(sp,:) + r2_sp(sp,:);
	end

	%%Calculating Max Princ Plast Strain
	thetamax=zeros(1,spCount);
	thetamin=zeros(1,spCount);
	for sp=1:spCount
		theta=1/2*atan(2*e_pl_sp(sp,3)/(e_pl_sp(sp,1)-e_pl_sp(sp,2)));
		e_pl_first=(e_pl_sp(sp,1)+e_pl_sp(sp,2))/2+(e_pl_sp(sp,1)-e_pl_sp(sp,2))/2*cos(2*theta)+e_pl_sp(sp,3)*sin(2*theta);
		e_pl_second=(e_pl_sp(sp,1)+e_pl_sp(sp,2))/2-(e_pl_sp(sp,1)-e_pl_sp(sp,2))/2*cos(2*theta)-e_pl_sp(sp,3)*sin(2*theta);
		if plotignore(sp)==0
			if e_pl_first>e_pl_second
				thetamax(sp)=theta;
				thetamin(sp)=theta+pi/2;
			else
				thetamax(sp)=theta+pi/2;
				thetamin(sp)=theta;
			end
		end
		e_pl_max(sp)=max(e_pl_first,e_pl_second);
		e_pl_min(sp)=min(e_pl_first,e_pl_second);
		e_pl_shear(sp)=(e_pl_max(sp)-e_pl_min(sp))/2;
		 
	end
	if ActuallyPlot==1
		StressProfile1=figure;
		set(StressProfile1, 'visible','off');
		sz = 40;
		%color = velocity;
		if maxminshear==1
			color = e_pl_max;
		elseif maxminshear==2
			color = e_pl_min;
		elseif maxminshear==3
			color = e_pl_shear;
		else
			disp('wrong maxminshear input!');
			pause
		end
		color_cut=cutvector(color,0,plotignore);
		x_sp_cut=cutvector(x_sp,1,plotignore);
		scatter(x_sp_cut(:,1),x_sp_cut(:,2),sz,color_cut,'filled');
		hold on
		daspect([1 1 1]);
		if CasetoRun==105 || CasetoRun==110
			set(StressProfile1,'Position',[0 0 1800 1800]);
		end
		for sp=1:spCount
			x_cor = [x_corner1(sp,1) x_corner2(sp,1) x_corner3(sp,1) x_corner4(sp,1) x_corner1(sp,1)];
			y_cor = [x_corner1(sp,2) x_corner2(sp,2) x_corner3(sp,2) x_corner4(sp,2) x_corner1(sp,2)];
			plot(x_cor,y_cor,'r')
			if plotignore(sp)
				continue;
			end
			if maxminshear==1
				thetaplot=thetamax(sp);
			elseif maxminshear==2
				thetaplot=thetamin(sp);
			elseif maxminshear==3
				continue;
			else
				disp('MaxminShear Wrong! Put either 1, 2, or 3!')
				pause
			end
			xstart=x_sp(sp,1)-lp(1)*sqrt(2)/2*cos(thetaplot);
			xend=x_sp(sp,1)+lp(1)*sqrt(2)/2*cos(thetaplot);
			ystart=x_sp(sp,2)-lp(2)*sqrt(2)/2*sin(thetaplot);
			yend=x_sp(sp,2)+lp(2)*sqrt(2)/2*sin(thetaplot);
			%plot([xstart xend],[ystart yend],'color','black');
		end
		if length(x_crack)==0
		else
			for icrackpath=1:length(x_crack)
				%plot(x_cracktop{icrackpath}(:,1),x_cracktop{icrackpath}(:,2),'o','Color','red');
				plot(x_crack{icrackpath}(:,1),x_crack{icrackpath}(:,2),'-','Color','black','LineWidth',2);
				%plot(x_crackbot{icrackpath}(:,1),x_crackbot{icrackpath}(:,2),'o','Color','blue');
			end
		end
		domainsizevect=[max(LOC(:,1))-min(LOC(:,1)) max(LOC(:,2))-min(LOC(:,2))];
		domainsize=sqrt(dot(domainsizevect,domainsizevect));
		ntforce_si_magnitude=zeros(spCount,1);
		for ni=1:size(LOC,1)
			ntforce_si_magnitude(ni,1)=sqrt(dot(ntforce_si(ni,:),ntforce_si(ni,:)));
		end
		ntforce_si_maxmagnitude=max(ntforce_si_magnitude);
		if ntforce_si_maxmagnitude>0
			maxlinesize=domainsize/10;
			ntforce_si_tolinescale=maxlinesize/ntforce_si_magnitude;
			for ni=1:size(LOC,1)
				if ntforce_si_magnitude(ni,1)>0
					ntforce_si_angle=reliableatan(ntforce_si(ni,1),ntforce_si(ni,2));
					linelength=ntforce_si_magnitude(ni,1)*ntforce_si_tolinescale;
					if linelength>0
						linelength
						ntforce_si_angle
					end
					plot([LOC(ni,1) LOC(ni,1)+linelength*cos(ntforce_si_angle)],[LOC(ni,2) LOC(ni,2)+linelength*sin(ntforce_si_angle)],'color','red','LineWidth',1.5);
				end
			end
		end
		grid on
		axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
		set(gca,'xtick',[0:20:max(LOC(:,1))]);
		set(gca,'ytick',[0:20:max(LOC(:,2))]);
		h=colorbar;
		colormap(jet(256))
		set(gca,'FontSize',20)
	else
		StressProfile1=[];
	end
	% set(h, 'ytick', [0:0.2:1.2]);
	if exist('climits')
		if length(climits)>0
			if climits(2)>climits(1)
				caxis(climits);
			end
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [StressProfile1,e_pl_max,e_pl_min,e_pl_shear]=Plot_Final2_principalclimit_directions(x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,e_pl_sp,climits,maxminshear,lp,plotignore,ActuallyPlot,CasetoRun)
	
	x_corner1              = zeros(spCount,2);
	x_corner2              = zeros(spCount,2);
	x_corner3              = zeros(spCount,2);
	x_corner4              = zeros(spCount,2);
	
	% displacement = zeros(spCount,1);
	velocity = zeros(spCount,1);
	% strain = zeros(spCount,1);
	for sp=1:spCount
	%     displacement(sp) = sqrt(d_sp(sp,1)^2+d_sp(sp,2)^2);
		velocity(sp) = sqrt(v_ssp(sp,1)^2+v_ssp(sp,2)^2);
	%     strain(sp) = sqrt(e_sp(sp,1)^2+e_sp(sp,2)^2);
	end
	
	for sp=1:spCount
		x_corner1(sp,:) = x_sp(sp,:) - r1_sp(sp,:) - r2_sp(sp,:);      % Position of corner 1
		x_corner2(sp,:) = x_sp(sp,:) + r1_sp(sp,:) - r2_sp(sp,:);
		x_corner3(sp,:) = x_sp(sp,:) + r1_sp(sp,:) + r2_sp(sp,:);
		x_corner4(sp,:) = x_sp(sp,:) - r1_sp(sp,:) + r2_sp(sp,:);
	end
	
	%%Calculating Max Princ Plast Strain
	thetamax=zeros(1,spCount);
	thetamin=zeros(1,spCount);
	for sp=1:spCount
		theta=1/2*atan(2*e_pl_sp(sp,3)/(e_pl_sp(sp,1)-e_pl_sp(sp,2)));
		e_pl_first=(e_pl_sp(sp,1)+e_pl_sp(sp,2))/2+(e_pl_sp(sp,1)-e_pl_sp(sp,2))/2*cos(2*theta)+e_pl_sp(sp,3)*sin(2*theta);
		e_pl_second=(e_pl_sp(sp,1)+e_pl_sp(sp,2))/2-(e_pl_sp(sp,1)-e_pl_sp(sp,2))/2*cos(2*theta)-e_pl_sp(sp,3)*sin(2*theta);
		if plotignore(sp)==0
			if e_pl_first>e_pl_second
				thetamax(sp)=theta;
				thetamin(sp)=theta+pi/2;
			else
				thetamax(sp)=theta+pi/2;
				thetamin(sp)=theta;
			end
		end
		e_pl_max(sp)=max(e_pl_first,e_pl_second);
		e_pl_min(sp)=min(e_pl_first,e_pl_second);
		e_pl_shear(sp)=(e_pl_max(sp)-e_pl_min(sp))/2;
		
	end
	if ActuallyPlot==1
		StressProfile1=figure;
		set(StressProfile1, 'visible','off');
		sz = 40;
		%color = velocity;
		if maxminshear==1
			color = e_pl_max;
		elseif maxminshear==2
			color = e_pl_min;
		elseif maxminshear==3
			color = e_pl_shear;
		else
			disp('wrong maxminshear input!');
			pause
		end
		color_cut=cutvector(color,0,plotignore);
		x_sp_cut=cutvector(x_sp,1,plotignore);
		scatter(x_sp_cut(:,1),x_sp_cut(:,2),sz,color_cut,'filled');
		hold on
		daspect([1 1 1]);
		if CasetoRun==105 || CasetoRun==110
			set(StressProfile1,'Position',[0 0 1800 1800]);
		end
		for sp=1:spCount
			x_cor = [x_corner1(sp,1) x_corner2(sp,1) x_corner3(sp,1) x_corner4(sp,1) x_corner1(sp,1)];
			y_cor = [x_corner1(sp,2) x_corner2(sp,2) x_corner3(sp,2) x_corner4(sp,2) x_corner1(sp,2)];
			plot(x_cor,y_cor,'r')
			if plotignore(sp)
				continue;
			end
			if maxminshear==1
				thetaplot=thetamax(sp);
			elseif maxminshear==2
				thetaplot=thetamin(sp);
			elseif maxminshear==3
				continue;
			else
				disp('MaxminShear Wrong! Put either 1, 2, or 3!')
				pause
			end
			xstart=x_sp(sp,1)-lp(1)*sqrt(2)/2*cos(thetaplot);
			xend=x_sp(sp,1)+lp(1)*sqrt(2)/2*cos(thetaplot);
			ystart=x_sp(sp,2)-lp(2)*sqrt(2)/2*sin(thetaplot);
			yend=x_sp(sp,2)+lp(2)*sqrt(2)/2*sin(thetaplot);
			plot([xstart xend],[ystart yend],'color','black');
		end
		grid on
		axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
		%set(gca,'xtick',[0:20:max(LOC(:,1))]);
		set(gca,'xtick',[]);
		%set(gca,'ytick',[0:20:max(LOC(:,2))]);
		set(gca,'ytick',[]);
		h=colorbar;
		colormap(jet(256))
		set(gca,'FontSize',20)
	else
		StressProfile1=[];
	end
	% set(h, 'ytick', [0:0.2:1.2]);
	if exist('climits')
		if length(climits)>0
			if climits(2)>climits(1)
				caxis(climits);
			end
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [StressProfile1,e_pl_max,e_pl_min,e_pl_shear]=Plot_Final2_principalclimit_directions_black(x_sp,LOC,le,d_sp,e_sp,v_ssp,spCount,r1_sp,r2_sp,E_acc,e_pl_sp,climits,maxminshear,lp,plotignore,ActuallyPlot,CasetoRun)
	
	x_corner1              = zeros(spCount,2);
	x_corner2              = zeros(spCount,2);
	x_corner3              = zeros(spCount,2);
	x_corner4              = zeros(spCount,2);

	%displacement = zeros(spCount,1);
	velocity = zeros(spCount,1);
	%strain = zeros(spCount,1);
	for sp=1:spCount
		%displacement(sp) = sqrt(d_sp(sp,1)^2+d_sp(sp,2)^2);
		velocity(sp) = sqrt(v_ssp(sp,1)^2+v_ssp(sp,2)^2);
		%strain(sp) = sqrt(e_sp(sp,1)^2+e_sp(sp,2)^2);
	end
	
	for sp=1:spCount
		x_corner1(sp,:) = x_sp(sp,:) - r1_sp(sp,:) - r2_sp(sp,:);      % Position of corner 1
		x_corner2(sp,:) = x_sp(sp,:) + r1_sp(sp,:) - r2_sp(sp,:);
		x_corner3(sp,:) = x_sp(sp,:) + r1_sp(sp,:) + r2_sp(sp,:);
		x_corner4(sp,:) = x_sp(sp,:) - r1_sp(sp,:) + r2_sp(sp,:);
	end
	
	%%Calculating Max Princ Plast Strain
	thetamax=zeros(1,spCount);
	thetamin=zeros(1,spCount);
	for sp=1:spCount
		theta=1/2*atan(2*e_pl_sp(sp,3)/(e_pl_sp(sp,1)-e_pl_sp(sp,2)));
		e_pl_first=(e_pl_sp(sp,1)+e_pl_sp(sp,2))/2+(e_pl_sp(sp,1)-e_pl_sp(sp,2))/2*cos(2*theta)+e_pl_sp(sp,3)*sin(2*theta);
		e_pl_second=(e_pl_sp(sp,1)+e_pl_sp(sp,2))/2-(e_pl_sp(sp,1)-e_pl_sp(sp,2))/2*cos(2*theta)-e_pl_sp(sp,3)*sin(2*theta);
		if plotignore(sp)==0
			if e_pl_first>e_pl_second
				thetamax(sp)=theta;
				thetamin(sp)=theta+pi/2;
			else
				thetamax(sp)=theta+pi/2;
				thetamin(sp)=theta;
			end
		end
		e_pl_max(sp)=max(e_pl_first,e_pl_second);
		e_pl_min(sp)=min(e_pl_first,e_pl_second);
		e_pl_shear(sp)=(e_pl_max(sp)-e_pl_min(sp))/2;
		
	end
	if ActuallyPlot==1
		StressProfile1=figure;
		set(StressProfile1, 'visible','off');
		sz = 30;
		%color = velocity;
		if maxminshear==1
			color = e_pl_max;
		elseif maxminshear==2
			color = e_pl_min;
		elseif maxminshear==3
			color = e_pl_shear;
		else
			disp('wrong maxminshear input!');
			pause
		end
		color_cut=cutvector(color,0,plotignore);
		
		if maxminshear==1
			maxvalue=max(color_cut);
		elseif maxminshear==2
			maxvalue=min(color_cut);
		elseif maxminshear==3
			maxvalue=max(color_cut);
		end
		TheDisplayName=['0 to ' num2str(abs(maxvalue)) ' MPa' ];
		
		if maxminshear==1
			TheDisplayName=[TheDisplayName ' (tension)'];
		elseif maxminshear==2
			TheDisplayName=[TheDisplayName ' (compression)'];
		elseif maxminshear==3
			TheDisplayName=[TheDisplayName ' (shear)'];
		end
		x_sp_cut=cutvector(x_sp,1,plotignore);
		scatter(x_sp_cut(:,1),x_sp_cut(:,2),sz,color_cut,'filled');
		hold on
		daspect([1 1 1]);
		set(StressProfile1,'Position',[0 0 1000 1000]);
		for sp=1:spCount
			if abs(x_sp(sp,1)-min(x_sp(:,1)))<lp(1)/2 && abs(x_sp(sp,2)-min(x_sp(:,2)))<lp(2)/2
				1;
			end
			x_cor = [x_corner1(sp,1) x_corner2(sp,1) x_corner3(sp,1) x_corner4(sp,1) x_corner1(sp,1)];
			y_cor = [x_corner1(sp,2) x_corner2(sp,2) x_corner3(sp,2) x_corner4(sp,2) x_corner1(sp,2)];
			if plotignore(sp)
				x_cross1=[x_corner1(sp,1) x_corner3(sp,1)];
				y_cross1=[x_corner1(sp,2) x_corner3(sp,2)];
				x_cross2=[x_corner2(sp,1) x_corner4(sp,1)];
				y_cross2=[x_corner2(sp,2) x_corner4(sp,2)];
				plot(x_cross1,y_cross1,'color','red','HandleVisibility','off');
				plot(x_cross2,y_cross2,'color','red','HandleVisibility','off');
			end
			if sp==1
				plot(x_cor,y_cor,'r','DisplayName',TheDisplayName)
			else
				plot(x_cor,y_cor,'r','HandleVisibility','off')
			end
			%if sp==1
				%hold on;
				%daspect([1 1 1]);
			%end
			if plotignore(sp)
				continue;
			end
			if maxminshear==1
				thetaplot=thetamax(sp);
				relativelength=max(color(sp),0)/maxvalue;
			elseif maxminshear==2
				thetaplot=thetamin(sp);
				relativelength=min(color(sp),0)/maxvalue;
			elseif maxminshear==3
				continue;
			else
				disp('MaxminShear Wrong! Put either 1, 2, or 3!')
				pause
			end
			relativelength=1;
			xstart=x_sp(sp,1)-lp(1)*relativelength*sqrt(2)/2*cos(thetaplot);
			xend=x_sp(sp,1)+lp(1)*relativelength*sqrt(2)/2*cos(thetaplot);
			ystart=x_sp(sp,2)-lp(2)*relativelength*sqrt(2)/2*sin(thetaplot);
			yend=x_sp(sp,2)+lp(2)*relativelength*sqrt(2)/2*sin(thetaplot);
			plot([xstart xend],[ystart yend],'color','black','HandleVisibility','off');
		end
		grid on
		if CasetoRun==10
			axis([0,max(LOC(:,1)),0,160]);
			set(gca,'ytick',[0:20:160]);
		else
			axis([0,max(LOC(:,1)),0,max(LOC(:,2))]);
			set(gca,'ytick',[0:20:max(LOC(:,2))]);
		end
		set(gca,'xtick',[0:20:max(LOC(:,1))]);
		%title(TheDisplayName);
		%legend show
		h=colorbar;
		colormap(jet(256));
		set(gca,'FontSize',40)
	else
		StressProfile1=[];
	end
	% set(h, 'ytick', [0:0.2:1.2]);
	%if exist('climits')
	%    if length(climits)>0
	%        if climits(2)>climits(1)
	%            caxis(climits);
	%        end
	%    end
	%end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%}
%switchable2

function directionnum = RTLtranslator(directionstr)
	%RTLTRANSLATOR Summary of this function goes here
	%   Detailed explanation goes here
    directionnum=0;
	errorswitch=0;
	if length(directionstr)==1
		if directionstr=='r'
			directionnum=1;
		elseif directionstr=='t'
			directionnum=2;
		elseif directionstr=='l'
			directionnum=3;
		else
			errorswitch=1;
		end
	elseif length(directionstr)==2
		if directionstr=='rt'
			directionnum=4;
		elseif directionstr=='tr'
			directionnum=4;
		elseif directionstr=='tl'
			directionnum=5;
		elseif directionstr=='lt'
			directionnum=5;
		elseif directionstr=='rl'
			directionnum=6;
		elseif directionstr=='lr'
			directionnum=6;
		else
			errorswitch=1;
		end
	else
		errorswitch=1;
	end
	if errorswitch==1
		fprintf('%s',['direction error' char(10)]);
		pause
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%{
%switchable1
function printvector(thevector,vectorname,indexes)
	if exist('indexes')
		texttodisplay=[vectorname '=['];
		for i=1:length(indexes)
			if i>1
				texttodisplay=[texttodisplay ','];
			end
			texttodisplay=[texttodisplay float2txt(5,thevector(indexes(i)))];
		end
		texttodisplay=[texttodisplay ']'];
		fprintf('%s',[texttodisplay chr(10)]);
	else
		texttodisplay=[vectorname '=['];
		for i=1:length(thevector)
			if i>1
				texttodisplay=[texttodisplay ','];
			end
			texttodisplay=[texttodisplay float2txt(5,thevector(i))];
		end
		texttodisplay=[texttodisplay ']'];
		fprintf('%s',[texttodisplay chr(10)]);
	end
end
%}
%switchable1

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function MatOut=MatReorder(MatIn,Order)
    MatOut=zeros(size(MatIn));
    for i=1:size(MatOut,1)
        for j=1:size(MatOut,2)
            MatOut(i,j)=MatIn(Order(i),Order(j));
        end
    end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

%{
%switchable1
function soundplay
    amp=1 ;
    fs=48000;  % sampling frequency
    duration=0.25;
    freq=1000;
    values=0:1/fs:16*duration;
	a=zeros(1,length(values));
    for i=1:length(values)
        if values(i)<=duration
            a(i)=amp*sin(2*pi* freq*values(i));
        elseif values(i)<=2*duration
            a(i)=0;
        elseif values(i)<=3*duration
            a(i)=amp*sin(2*pi* freq*values(i));
        elseif values(i)<=4*duration
            a(i)=0;
        elseif values(i)<=5*duration
            a(i)=amp*sin(2*pi* freq*values(i));
        elseif values(i)<=6*duration
            a(i)=0;
        elseif values(i)<=7*duration
            a(i)=amp*sin(2*pi* freq*values(i));
        elseif values(i)<=8*duration
            a(i)=0;
        elseif values(i)<=9*duration
            a(i)=amp*sin(2*pi* freq*values(i));
        elseif values(i)<=10*duration
            a(i)=0;
        elseif values(i)<=11*duration
            a(i)=amp*sin(2*pi* freq*values(i));
        elseif values(i)<=12*duration
            a(i)=0;
        elseif values(i)<=13*duration
            a(i)=amp*sin(2*pi* freq*values(i));
        elseif values(i)<=14*duration
            a(i)=0;
        elseif values(i)<=15*duration
            a(i)=amp*sin(2*pi* freq*values(i));
        elseif values(i)<=16*duration
            a(i)=0;
        elseif values(i)<=17*duration
            a(i)=amp*sin(2*pi* freq*values(i));
        elseif values(i)<=18*duration
            a(i)=0;
        elseif values(i)<=19*duration
            a(i)=amp*sin(2*pi* freq*values(i));
        elseif values(i)<=20*duration
            a(i)=0;
        end
    end
    sound(a,fs);
end
%}
%switchable1

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function vectorout=cutvector(vectorin,listdirection,ignorelist)
	%{
	example:
	x(sp,1:2), listdirection=1
	x(1:2,sp), listdirection=2
	%}
	if listdirection==0
		if size(vectorin,1)>size(vectorin,2)
			listdirection=1;
		elseif size(vectorin,2)>size(vectorin,1)
			listdirection=2;
		else
			fprintf('%s',['vectorin is a square matrix!' char(10)]);
			pause;
		end
	end
	if listdirection==1
		vectorout=zeros(size(vectorin,1)-sum(ignorelist),size(vectorin,2));
	elseif listdirection==2
		vectorout=zeros(size(vectorin,1),size(vectorin,2)-sum(ignorelist));
	else
		fprintf('%s',['incorrect list direction input!' char(10)]);
		pause;
	end
	newnumbering=0;
	for i=1:size(vectorin,listdirection)
		if ignorelist(i)
			continue;
		end
		newnumbering=newnumbering+1;
		if listdirection==1
			vectorout(newnumbering,:)=vectorin(i,:);
		elseif listdirection==2
			vectorout(:,newnumbering)=vectorin(:,i);
		else
			fprintf('%s',['incorrect list direction input!' char(10)]);
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function outputangle=reliableatan(deltax,deltay)
	outputangle=0;
	if deltax==0
		if deltay==0
			outputangle=0;
		elseif deltay>0
			outputangle=pi/2;
		elseif deltay<0
			outputangle=-pi/2;
		end
	elseif deltax>0
		outputangle=atan(deltay/deltax);
	elseif deltay>0
		outputangle=atan(deltay/deltax)+pi;
	elseif deltay<0
		outputangle=atan(deltay/deltax)-pi;
	elseif deltay==0
		outputangle=pi;
	else
		outputangle=0;
		%fprintf('%s',['scenario not considered!' char(10)]);
		%pause;
		%1;
	end
	%outputangle=outputangle*180/pi;
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function MinNum=FindMin(VectorIn)
    MinVal=VectorIn(1);
    MinNum=1;
    for i=2:length(VectorIn)
        if VectorIn(i)<MinVal
            MinVal=VectorIn(i);
            MinNum=i;
        end
    end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function MinNum=FindMinMatrix(MatrixIn)
	MinNum=zeros(1,2);
    MinVal=MatrixIn(1,1);
    MinNum(2)=1;
	MinNum(1)=1;
    for i=1:size(MatrixIn,1)
		for j=1:size(MatrixIn,2)
			if MatrixIn(i,j)<MinVal
				MinVal=MatrixIn(i,j);
				MinNum(1)=i;
				MinNum(2)=j;
			end
		end
    end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function MaxNum=FindMax(VectorIn)
    MaxVal=VectorIn(1);
    MaxNum=1;
    for i=2:length(VectorIn)
        if VectorIn(i)>MaxVal
            MaxVal=VectorIn(i);
            MaxNum=i;
        end
    end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function MaxVal=FindMaxVal(VectorIn)
    MaxVal=VectorIn(1);
    for i=2:length(VectorIn)
        if VectorIn(i)>MaxVal
            MaxVal=VectorIn(i);
        end
    end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function MaxVal=FindMaxValMatrix(MatrixIn)
    MaxVal=MatrixIn(1,1);
    for i=1:size(MatrixIn,1)
		for j=1:size(MatrixIn,2)
			if MatrixIn(i,j)>MaxVal
				MaxVal=MatrixIn(i,j);
			end
		end
    end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [R U V] = poldecomp(F,UVrequest)
    %POLDECOMP  Performs the polar decomposition of a regular square matrix.
    %   [R U V] = POLDECOMP(F) factorizes a non-singular square matrix F such
    %   that F=R*U and F=V*R, where
    %   U and V are symmetric, positive definite matrices and
    %   R is a rotational matrix
    %
    %   See also EIG, DIAG, REPMAT


    % This kind of decomposition is often used in continuum mechanics so it is
    % convenient to comment the code that way. From now, we use the matrix 
    % formalism of tensors. C is the right Cauchy-Green deformation tensor, 
    % F is the deformation tensor, lambda is the stretch.

    % Check input
    [m n] = size(F);
    if m ~= n
        error('Matrix must be square.');
    end

    C = F'*F;
    [Q0 lambdasquare] = eig(C);
    lambda = sqrt(diag((lambdasquare))); % extract the components
    % Uinv is the inverse of U and is constructed with the help of Q0. Uinv is
    % produced in the same base as F not in the base of its eigenvectors.
    Uinv = repmat(1./lambda',size(F,1),1).*Q0*Q0';
    % Using the definition, R, U and V can now be calculated
    R = F*Uinv;
    if UVrequest==1
        U = R'*F;
        V = F*R';
    end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function TexttoPrint=PrintMatrixVectorized(MatrixInput,MatrixName,DisplayKah)
    TexttoPrint=[MatrixName '=['];
    for i=1:size(MatrixInput,1)
        if i>1
            TexttoPrint=[TexttoPrint ';'];
        end
        for j=1:size(MatrixInput,2)
            if j>1
                TexttoPrint=[TexttoPrint ','];
            end
            TexttoPrint=[TexttoPrint float2txt(5,MatrixInput(i,j))];
        end
    end
    TexttoPrint=[TexttoPrint ']; det(' MatrixName ')=' float2txt(5,det(MatrixInput))];
    if DisplayKah==1
        fprintf('%s',[TexttoPrint char(10)]);
    end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function Result=CompareTexts(Text1,Text2)
    Result=0;
    if length(Text1)==length(Text2)
        if Text1==Text2
            Result=1;
        end
    end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%{
%switchable1
function TheVerdict=CloseEnough2(val1,val2,val2tolerance,absoluteput1_relativeput2)
    if exist('absoluteput1_relativeput2')
    else
        absoluteput1_relativeput2=2;
    end
    if exist('val2tolerance')
    else
        val2tolerance=1e-10;
    end
    TheVerdict=0;
    if absoluteput1_relativeput2==1
        if val1>=val2-abs(val2tolerance/2) && val1<=val2+abs(val2tolerance/2)
            TheVerdict=1;
        end
    elseif absoluteput1_relativeput2==2
        if val2>0
            if val1>=val2*(1-abs(val2tolerance/2)) && val1<=val2*(1+abs(val2tolerance/2))
                TheVerdict=1;
            end
        else
            if val1<=val2*(1-abs(val2tolerance/2)) && val1>=val2*(1+abs(val2tolerance/2))
                TheVerdict=1;
            end
        end            
    else
        fprintf('%s',['wrong input!' char(10)]);
        pause
        1;
    end
end
%}
%switchable1
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function TheVerdict=CloseEnough(val1,val2,val2tolerance,absoluteput1_relativeput2)
%{
    if exist('absoluteput1_relativeput2')
    else
        absoluteput1_relativeput2=2;
    end
    if exist('val2tolerance')
    else
        val2tolerance=1e-10;
    end
%}
    TheVerdict=0;
    if absoluteput1_relativeput2==1
        if val1>=val2-abs(val2tolerance/2) && val1<=val2+abs(val2tolerance/2)
            TheVerdict=1;
        end
    elseif absoluteput1_relativeput2==2
        if val2>0
            if val1>=val2*(1-abs(val2tolerance/2)) && val1<=val2*(1+abs(val2tolerance/2))
                TheVerdict=1;
            end
        else
            if val1<=val2*(1-abs(val2tolerance/2)) && val1>=val2*(1+abs(val2tolerance/2))
                TheVerdict=1;
            end
        end            
    else
        fprintf('%s',['wrong input!' char(10)]);
        pause
        1;
    end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%{
%switchable1
function [affectedvector sortedvector]=affectsort(toaffectvector,tosortvector,direction)
    %direction=0: ascending
    %direction=1: descending
    sortedvector=tosortvector;
    affectedvector=toaffectvector;
    
    if exist('direction')==0
        direction=0;
    end
    
    for j=1:length(tosortvector)^2
        allsorted=1;
        for i=1:length(tosortvector)-1
            if direction==0
                if sortedvector(i)>sortedvector(i+1)
                    allsorted=0;
                    dummy=sortedvector(i);
                    sortedvector(i)=sortedvector(i+1);
                    sortedvector(i+1)=dummy;
                    
                    dummy=affectedvector(i);
                    affectedvector(i)=affectedvector(i+1);
                    affectedvector(i+1)=dummy;
                end
            elseif direction==1
                if sortedvector(i)<sortedvector(i+1)
                    allsorted=0;
                    dummy=sortedvector(i);
                    sortedvector(i)=sortedvector(i+1);
                    sortedvector(i+1)=dummy;
                    
                    dummy=affectedvector(i);
                    affectedvector(i)=affectedvector(i+1);
                    affectedvector(i+1)=dummy;
                end
            else
                fprintf('%s',['direction input error!' char(10)]);
                pause;
                1;
            end
        end
        if allsorted
            break;
        end
    end
end
%}
%switchable1
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%{
%switchable1
function secspassed = clockallsec()
    dateinput=clock;
    month(1)=31;
    if mod(dateinput(1),4)==0
        month(2)=29;
    else
        month(2)=28;
    end
    month(3)=31;
    month(4)=30;
    month(5)=31;
    month(6)=30;
    month(7)=31;
    month(8)=31;
    month(9)=30;
    month(10)=31;
    month(11)=30;
    month(12)=31;
	
    dayspassed=floor((dateinput(1)-1)/4)*4*365.25+(dateinput(1)-1-floor((dateinput(1)-1)/4)*4)*365;
    for i=1:dateinput(2)-1
        dayspassed=dayspassed+month(i);
    end
    dayspassed=dayspassed+dateinput(3)-1;
    hourspassed=dayspassed*24+dateinput(4);
    minutespassed=hourspassed*60+dateinput(5);
    secspassed=minutespassed*60+dateinput(6);
end
%}
%switchable1
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function angletaken=gerhardangles(xstart,ystart,xtrial_global,ytrial_global)
    xtrial=xtrial_global-xstart;
    ytrial=ytrial_global-ystart;
    if ytrial<0 || ytrial>150
        angletaken=-inf;
        fprintf('%s',['wrong y trial! pausing...' char(10)]);
        pause;
        1;
        return
    end
    positions=[	3	6	11	13.5	18.5	22.5	27.5	35	42.3	47.5	60	87.5	101.5	107	112	118.3	122.5	;
        2.5	6.5	10.5	13.5	18.5	23	27.5	35	42.5	47.5	60.5	87.5	101.5	107	112	118.5	122.5	;
        2.5	6.5	10.5	13.5	18.5	23.5	28	35	42.5	47	59.5	87.8	101.5	107	112	119	122	;
        2.4	5.5	10	12.2	18.5	23.5	28.4	35.5	42.5	47.4	59.5	88.2	101.5	107.3	112.1	119.1	122.5	;
        1.8	5.5	9.5	12.5	18.1	23.1	28	35	42.5	47	59	88.5	101.5	107.3	112.5	118.6	122.5	;
        1.5	5.5	9.5	12.5	18	23.6	28	35	42	47	58.5	88.5	102	107.5	114	119	123	;
        1.5	6.5	9.8	13	18	23	27.7	35	42	47	58.5	89	102.5	107.7	114.6	119.4	123	;
        1.4	5.4	9.7	12.6	17.8	23.4	27.7	35	42.1	47	57.6	89.5	102.6	108	115.4	119.6	123.5	;
        1.2	5.3	9.7	12.8	17.7	22.6	28	34.8	41.6	46.8	57.5	89.5	103.5	108.4	115.5	120	123.8	;
        1	4.6	9.5	12.5	17.5	22.5	27.7	34.6	41.5	47	56.5	90.5	104	108.5	116.5	120.5	124.5	;
        1	4	9.5	12.5	17	22.5	27.5	34.5	41.5	47.2	55.5	91.4	104.5	108.7	116.6	121.5	126	;
        0.8	3.4	9.1	12.4	16.9	21.7	27.4	33.8	41.5	46.5	55.2	92.5	104.5	109.5	117	122	126.5	;
        -1	3.2	8.8	11.5	16.7	21.1	27.1	33.5	41.5	46.4	56	93.7	104.9	109.6	117.1	122.5	127	;
        -2	3.1	8.5	11.2	16.5	20.1	26.5	33	40.9	45.6	57.5	93.4	105	110.1	116.9	122.5	127.3	;
        -3	2.5	7.9	10.5	16.5	19.5	25	32.5	39.2	45.1	59	93.5	105.5	110.5	117.1	122.8	127.7	;
        -3.4	1.9	7.5	10.4	16.3	19.6	24.4	32.1	38	44.6	59.5	93.6	105.6	110.6	117.3	122.9	127.9	;
        -3.9	1.6	7.1	9.8	15.4	18.6	23.5	30.8	35.5	44.5	59.5	93.5	105.6	110.6	117	122.6	127.9	;
        -4.1	1	6.5	9.4	14.5	18	21.5	29	33.5	46.7	59.8	93.4	105.6	110.8	117.3	122.7	127.8	;
        -4.5	0.5	5.7	8.5	14	17.2	19.5	25.5	31.5	47.5	60	92.6	105.8	111.3	117.4	123	127.9	;
        -4.9	-0.6	4.6	8.4	13.1	16	17.8	22	28.5	47.9	60	92.1	105.9	111.4	117.5	123.5	127.9	;
        -5.2	-1.1	3.8	8	12	14	16.6	20	24.5	47.8	59.5	91.5	106.5	111	117.4	123.4	127.8	;
        -5.6	-1.7	2.8	7.4	10.5	12.5	14.5	16.8	19.8	47.6	59.4	91.1	106.5	110.5	117.1	123.5	127.8	;
        -5.7	-1.9	2.3	7	9.2	11.4	13.5	15.4	17.4	47.5	58.6	90.6	105.7	110.4	116.9	123.4	127.7	;
        -5.8	-2	1.6	7	9	10.6	12.8	14.5	15.8	46.4	58.8	90.6	105.6	110	116.6	123.2	127.6	;
        -5.9	-2	1.4	6.8	9.1	10.6	12.7	14.1	15.6	45.5	58.5	90.1	105.4	109.6	116.6	123	127.3	;
        -5.9	-2.1	1.5	6.6	9.9	11.8	13.5	14.6	16.4	44	59	89.6	104.8	109.1	116.5	123	127	;
        -5.9	-2.1	1.5	6.8	11.4	13.4	15.1	16.4	18.9	42.4	59.6	89.6	104.3	108.5	116.5	122.6	126.6	;
        -5.9	-2	1.6	7.4	12.4	15.1	17.2	22.5	35	45.1	60.5	89.5	104	108.1	116.4	122.1	126	;
        -5.8	-1.9	1.7	7.4	13.1	16.4	19.5	30.1	39.5	46.4	61	89.1	103.4	107.4	115.8	121.4	124.9	;
        -5.7	-1.9	1.8	7.7	14.4	18.4	22.6	34.1	42.4	48.3	61.5	88.9	102.9	107.5	115.4	120.8	124.5	;
        -5.6	-1.8	1.9	8	15.4	19.6	24.5	36.1	43.6	49.2	61.9	88.8	102.5	107.6	114.5	120.5	124.2	;
        -5.4	-1	2.6	9.1	16.6	21.4	27.5	37.8	45.2	51.1	62.6	88.1	101.7	107.6	113.6	120.4	124	;
        -5.1	-0.1	4.8	10.5	18.1	22.4	28.7	39.2	46	52.1	63.4	88.7	101.5	107.5	113.3	119.8	123.4	;
        -4.2	1.2	7.1	11.6	18.7	23.4	29.7	39.6	46.1	52.8	63.1	88.5	101.5	107.5	113.4	119.5	123.4	;
        -3.4	2.1	9.4	12.6	19.5	24.1	30.5	40	46.4	53	63	88.4	101.5	107.5	113.4	119.4	123	;
        -2.1	2.7	10	12.8	20	24.6	31.4	40.1	46.7	52.8	62.8	88.4	102.3	107.5	113.6	119.4	123.4	;
        -0.8	3.6	10.1	13.4	20.6	25.1	31.5	40.4	46.4	52.8	62.6	88.6	102.6	107.5	113.8	119.5	123.4	;
        0.9	4.1	10	13.7	20.7	25.4	31.5	40.4	46.4	52.5	62.4	89.6	102.8	107.5	114.1	119.5	123.5	;
        0.9	4.5	10	13.8	20.8	25.4	31.5	40	46.1	52.6	62.7	89.6	102.8	107.6	114.3	119.5	123.5	];

    verticals=[	0	...
        5	...
        10	...
        15	...
        20	...
        25	...
        30	...
        35	...
        40	...
        45	...
        50	...
        55	...
        60	...
        65	...
        70	...
        72.5	...
        75	...
        77.5	...
        80	...
        82.5	...
        85	...
        87.5	...
        90	...
        92.5	...
        95	...
        97.5	...
        100	...
        102.5	...
        105	...
        107.5	...
        110	...
        115	...
        120	...
        125	...
        130	...
        135	...
        140	...
        145	...
        150	];


    %xtrial=45;
    %ytrial=85;

    for i=1:length(verticals)-1
        if ((ytrial>=verticals(i) && ytrial<=verticals(i+1)) || (ytrial<=verticals(i) && ytrial>=verticals(i+1)))
            vernumberbefore=i;
            yextrafactor=(ytrial-verticals(vernumberbefore))/(verticals(vernumberbefore+1)-verticals(vernumberbefore));
            break;
        end
    end
    for i=1:size(positions,2)-1
        xbefore=positions(vernumberbefore,i)+(ytrial-verticals(vernumberbefore))/(verticals(vernumberbefore+1)-verticals(vernumberbefore))*(positions(vernumberbefore+1,i)-positions(vernumberbefore,i));
        xafter=positions(vernumberbefore,i+1)+(ytrial-verticals(vernumberbefore))/(verticals(vernumberbefore+1)-verticals(vernumberbefore))*(positions(vernumberbefore+1,i+1)-positions(vernumberbefore,i+1));
        if i==1 && xtrial<xbefore
            oneovergradient=(positions(vernumberbefore+1,i)-positions(vernumberbefore,i))/(verticals(vernumberbefore+1)-verticals(vernumberbefore));
            angletaken=atan(1/oneovergradient);
            if angletaken<0
                angletaken=angletaken+pi;
            end
            break;
        elseif i==(size(positions,2)-1) && xtrial>xafter
            oneovergradient=(positions(vernumberbefore+1,i+1)-positions(vernumberbefore,i+1))/(verticals(vernumberbefore+1)-verticals(vernumberbefore));
            angletaken=atan(1/oneovergradient);
            if angletaken<0
                angletaken=angletaken+pi;
            end
            break;
        elseif ((xtrial>=xbefore && xtrial<=xafter) || (xtrial<=xbefore && xtrial>=xafter))
            hornumberbefore=i;
            xextrafactor=(xtrial-xbefore)/(xafter-xbefore);
            oneovergradientbefore=(positions(vernumberbefore+1,hornumberbefore)-positions(vernumberbefore,hornumberbefore))/(verticals(vernumberbefore+1)-verticals(vernumberbefore));
            anglebefore=atan(1/oneovergradientbefore);
            if anglebefore<0
                anglebefore=anglebefore+pi;
            end
            oneovergradientafter=(positions(vernumberbefore+1,hornumberbefore+1)-positions(vernumberbefore,hornumberbefore+1))/(verticals(vernumberbefore+1)-verticals(vernumberbefore));
            angleafter=atan(1/oneovergradientafter);
            if angleafter<0
                angleafter=angleafter+pi;
            end
            angletaken=anglebefore+xextrafactor*(angleafter-anglebefore);
            break;
        end    
    end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function angletaken=gerhardanglesellipseonly(xtrial,ytrial,knot_x,knot_y,knot_rx,knot_ry,knot_theta)
    %if ytrial<0 || ytrial>150
    %    angletaken=-inf;
    %    disp('wrong y trial! pausing...');
    %    pause;
    %    1;
    %    return
    %end
    knotnum=2;
    angletaken=mod(pi/2 + atan(((2*cos(knot_theta(knotnum))*(cos(knot_theta(knotnum))*(knot_y(knotnum) - ytrial) - sin(knot_theta(knotnum))*(knot_x(knotnum) - xtrial)))/knot_ry(knotnum)^2 + (2*sin(knot_theta(knotnum))*(cos(knot_theta(knotnum))*(knot_x(knotnum) - xtrial) + sin(knot_theta(knotnum))*(knot_y(knotnum) - ytrial)))/knot_rx(knotnum)^2)/((2*cos(knot_theta(knotnum))*(cos(knot_theta(knotnum))*(knot_x(knotnum) - xtrial) + sin(knot_theta(knotnum))*(knot_y(knotnum) - ytrial)))/knot_rx(knotnum)^2 - (2*sin(knot_theta(knotnum))*(cos(knot_theta(knotnum))*(knot_y(knotnum) - ytrial) - sin(knot_theta(knotnum))*(knot_x(knotnum) - xtrial)))/knot_ry(knotnum)^2)), pi);
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function angletaken=gerhardanglescombined(xstart,ystart,xtrial_global,ytrial_global,knot_x,knot_y,knot_rx,knot_ry,knot_theta,CasetoRun)
    xtrial=xtrial_global-xstart;
    ytrial=ytrial_global-ystart;
    if ytrial<0 || ytrial>150
        angletaken1=-inf;
        fprintf('%s',['wrong y trial! pausing...' char(10)]);
        pause;
        1;
        return
    end
    positions=[	3	6	11	13.5	18.5	22.5	27.5	35	42.3	47.5	60	87.5	101.5	107	112	118.3	122.5	;
        2.5	6.5	10.5	13.5	18.5	23	27.5	35	42.5	47.5	60.5	87.5	101.5	107	112	118.5	122.5	;
        2.5	6.5	10.5	13.5	18.5	23.5	28	35	42.5	47	59.5	87.8	101.5	107	112	119	122	;
        2.4	5.5	10	12.2	18.5	23.5	28.4	35.5	42.5	47.4	59.5	88.2	101.5	107.3	112.1	119.1	122.5	;
        1.8	5.5	9.5	12.5	18.1	23.1	28	35	42.5	47	59	88.5	101.5	107.3	112.5	118.6	122.5	;
        1.5	5.5	9.5	12.5	18	23.6	28	35	42	47	58.5	88.5	102	107.5	114	119	123	;
        1.5	6.5	9.8	13	18	23	27.7	35	42	47	58.5	89	102.5	107.7	114.6	119.4	123	;
        1.4	5.4	9.7	12.6	17.8	23.4	27.7	35	42.1	47	57.6	89.5	102.6	108	115.4	119.6	123.5	;
        1.2	5.3	9.7	12.8	17.7	22.6	28	34.8	41.6	46.8	57.5	89.5	103.5	108.4	115.5	120	123.8	;
        1	4.6	9.5	12.5	17.5	22.5	27.7	34.6	41.5	47	56.5	90.5	104	108.5	116.5	120.5	124.5	;
        1	4	9.5	12.5	17	22.5	27.5	34.5	41.5	47.2	55.5	91.4	104.5	108.7	116.6	121.5	126	;
        0.8	3.4	9.1	12.4	16.9	21.7	27.4	33.8	41.5	46.5	55.2	92.5	104.5	109.5	117	122	126.5	;
        -1	3.2	8.8	11.5	16.7	21.1	27.1	33.5	41.5	46.4	56	93.7	104.9	109.6	117.1	122.5	127	;
        -2	3.1	8.5	11.2	16.5	20.1	26.5	33	40.9	45.6	57.5	93.4	105	110.1	116.9	122.5	127.3	;
        -3	2.5	7.9	10.5	16.5	19.5	25	32.5	39.2	45.1	59	93.5	105.5	110.5	117.1	122.8	127.7	;
        -3.4	1.9	7.5	10.4	16.3	19.6	24.4	32.1	38	44.6	59.5	93.6	105.6	110.6	117.3	122.9	127.9	;
        -3.9	1.6	7.1	9.8	15.4	18.6	23.5	30.8	35.5	44.5	59.5	93.5	105.6	110.6	117	122.6	127.9	;
        -4.1	1	6.5	9.4	14.5	18	21.5	29	33.5	46.7	59.8	93.4	105.6	110.8	117.3	122.7	127.8	;
        -4.5	0.5	5.7	8.5	14	17.2	19.5	25.5	31.5	47.5	60	92.6	105.8	111.3	117.4	123	127.9	;
        -4.9	-0.6	4.6	8.4	13.1	16	17.8	22	28.5	47.9	60	92.1	105.9	111.4	117.5	123.5	127.9	;
        -5.2	-1.1	3.8	8	12	14	16.6	20	24.5	47.8	59.5	91.5	106.5	111	117.4	123.4	127.8	;
        -5.6	-1.7	2.8	7.4	10.5	12.5	14.5	16.8	19.8	47.6	59.4	91.1	106.5	110.5	117.1	123.5	127.8	;
        -5.7	-1.9	2.3	7	9.2	11.4	13.5	15.4	17.4	47.5	58.6	90.6	105.7	110.4	116.9	123.4	127.7	;
        -5.8	-2	1.6	7	9	10.6	12.8	14.5	15.8	46.4	58.8	90.6	105.6	110	116.6	123.2	127.6	;
        -5.9	-2	1.4	6.8	9.1	10.6	12.7	14.1	15.6	45.5	58.5	90.1	105.4	109.6	116.6	123	127.3	;
        -5.9	-2.1	1.5	6.6	9.9	11.8	13.5	14.6	16.4	44	59	89.6	104.8	109.1	116.5	123	127	;
        -5.9	-2.1	1.5	6.8	11.4	13.4	15.1	16.4	18.9	42.4	59.6	89.6	104.3	108.5	116.5	122.6	126.6	;
        -5.9	-2	1.6	7.4	12.4	15.1	17.2	22.5	35	45.1	60.5	89.5	104	108.1	116.4	122.1	126	;
        -5.8	-1.9	1.7	7.4	13.1	16.4	19.5	30.1	39.5	46.4	61	89.1	103.4	107.4	115.8	121.4	124.9	;
        -5.7	-1.9	1.8	7.7	14.4	18.4	22.6	34.1	42.4	48.3	61.5	88.9	102.9	107.5	115.4	120.8	124.5	;
        -5.6	-1.8	1.9	8	15.4	19.6	24.5	36.1	43.6	49.2	61.9	88.8	102.5	107.6	114.5	120.5	124.2	;
        -5.4	-1	2.6	9.1	16.6	21.4	27.5	37.8	45.2	51.1	62.6	88.1	101.7	107.6	113.6	120.4	124	;
        -5.1	-0.1	4.8	10.5	18.1	22.4	28.7	39.2	46	52.1	63.4	88.7	101.5	107.5	113.3	119.8	123.4	;
        -4.2	1.2	7.1	11.6	18.7	23.4	29.7	39.6	46.1	52.8	63.1	88.5	101.5	107.5	113.4	119.5	123.4	;
        -3.4	2.1	9.4	12.6	19.5	24.1	30.5	40	46.4	53	63	88.4	101.5	107.5	113.4	119.4	123	;
        -2.1	2.7	10	12.8	20	24.6	31.4	40.1	46.7	52.8	62.8	88.4	102.3	107.5	113.6	119.4	123.4	;
        -0.8	3.6	10.1	13.4	20.6	25.1	31.5	40.4	46.4	52.8	62.6	88.6	102.6	107.5	113.8	119.5	123.4	;
        0.9	4.1	10	13.7	20.7	25.4	31.5	40.4	46.4	52.5	62.4	89.6	102.8	107.5	114.1	119.5	123.5	;
        0.9	4.5	10	13.8	20.8	25.4	31.5	40	46.1	52.6	62.7	89.6	102.8	107.6	114.3	119.5	123.5	];

    verticals=[	0	...
        5	...
        10	...
        15	...
        20	...
        25	...
        30	...
        35	...
        40	...
        45	...
        50	...
        55	...
        60	...
        65	...
        70	...
        72.5	...
        75	...
        77.5	...
        80	...
        82.5	...
        85	...
        87.5	...
        90	...
        92.5	...
        95	...
        97.5	...
        100	...
        102.5	...
        105	...
        107.5	...
        110	...
        115	...
        120	...
        125	...
        130	...
        135	...
        140	...
        145	...
        150	];


    %xtrial=45;
    %ytrial=85;

    for i=1:length(verticals)-1
        if ((ytrial>=verticals(i) && ytrial<=verticals(i+1)) || (ytrial<=verticals(i) && ytrial>=verticals(i+1)))
            vernumberbefore=i;
            yextrafactor=(ytrial-verticals(vernumberbefore))/(verticals(vernumberbefore+1)-verticals(vernumberbefore));
            break;
        end
    end
    for i=1:size(positions,2)-1
        xbefore=positions(vernumberbefore,i)+(ytrial-verticals(vernumberbefore))/(verticals(vernumberbefore+1)-verticals(vernumberbefore))*(positions(vernumberbefore+1,i)-positions(vernumberbefore,i));
        xafter=positions(vernumberbefore,i+1)+(ytrial-verticals(vernumberbefore))/(verticals(vernumberbefore+1)-verticals(vernumberbefore))*(positions(vernumberbefore+1,i+1)-positions(vernumberbefore,i+1));
        if i==1 && xtrial<xbefore
            oneovergradient=(positions(vernumberbefore+1,i)-positions(vernumberbefore,i))/(verticals(vernumberbefore+1)-verticals(vernumberbefore));
            angletaken1=atan(1/oneovergradient);
            if angletaken1<0
                angletaken1=angletaken1+pi;
            end
            break;
        elseif i==(size(positions,2)-1) && xtrial>xafter
            oneovergradient=(positions(vernumberbefore+1,i+1)-positions(vernumberbefore,i+1))/(verticals(vernumberbefore+1)-verticals(vernumberbefore));
            angletaken1=atan(1/oneovergradient);
            if angletaken1<0
                angletaken1=angletaken1+pi;
            end
            break;
        elseif ((xtrial>=xbefore && xtrial<=xafter) || (xtrial<=xbefore && xtrial>=xafter))
            hornumberbefore=i;
            xextrafactor=(xtrial-xbefore)/(xafter-xbefore);
            oneovergradientbefore=(positions(vernumberbefore+1,hornumberbefore)-positions(vernumberbefore,hornumberbefore))/(verticals(vernumberbefore+1)-verticals(vernumberbefore));
            anglebefore=atan(1/oneovergradientbefore);
            if anglebefore<0
                anglebefore=anglebefore+pi;
            end
            oneovergradientafter=(positions(vernumberbefore+1,hornumberbefore+1)-positions(vernumberbefore,hornumberbefore+1))/(verticals(vernumberbefore+1)-verticals(vernumberbefore));
            angleafter=atan(1/oneovergradientafter);
            if angleafter<0
                angleafter=angleafter+pi;
            end
            angletaken1=anglebefore+xextrafactor*(angleafter-anglebefore);
            break;
        end    
    end
    if CasetoRun==36 || CasetoRun==37 || CasetoRun==56 || CasetoRun==60 || CasetoRun==63
        angletaken=angletaken1;
        for knotnum=1:2
            f=(cos(knot_theta(knotnum))*(knot_x(knotnum) - xtrial_global) + sin(knot_theta(knotnum))*(knot_y(knotnum) - ytrial_global))^2/knot_rx(knotnum)^2 + (cos(knot_theta(knotnum))*(knot_y(knotnum) - ytrial_global) - sin(knot_theta(knotnum))*(knot_x(knotnum) - xtrial_global))^2/knot_ry(knotnum)^2 - 1;
            angletaken2=mod(pi/2 + atan(((2*cos(knot_theta(knotnum))*(cos(knot_theta(knotnum))*(knot_y(knotnum) - ytrial_global) - sin(knot_theta(knotnum))*(knot_x(knotnum) - xtrial_global)))/knot_ry(knotnum)^2 + (2*sin(knot_theta(knotnum))*(cos(knot_theta(knotnum))*(knot_x(knotnum) - xtrial_global) + sin(knot_theta(knotnum))*(knot_y(knotnum) - ytrial_global)))/knot_rx(knotnum)^2)/((2*cos(knot_theta(knotnum))*(cos(knot_theta(knotnum))*(knot_x(knotnum) - xtrial_global) + sin(knot_theta(knotnum))*(knot_y(knotnum) - ytrial_global)))/knot_rx(knotnum)^2 - (2*sin(knot_theta(knotnum))*(cos(knot_theta(knotnum))*(knot_y(knotnum) - ytrial_global) - sin(knot_theta(knotnum))*(knot_x(knotnum) - xtrial_global)))/knot_ry(knotnum)^2)), pi);
            if knotnum==1
                flimit1=1;
                flimit2=5;
            elseif knotnum==2
                flimit1=1;
                flimit2=flimit1;
            end
                
            if f<flimit1
                angletaken=angletaken2;
            elseif f<flimit2
                anglefactor=(f-flimit1)/(flimit2-flimit1);
                angletaken=angletaken2*(1-anglefactor)+angletaken*anglefactor;
            end
        end
    else
        knotnum=1;
        f=(cos(knot_theta(knotnum))*(knot_x(knotnum) - xtrial_global) + sin(knot_theta(knotnum))*(knot_y(knotnum) - ytrial_global))^2/knot_rx(knotnum)^2 + (cos(knot_theta(knotnum))*(knot_y(knotnum) - ytrial_global) - sin(knot_theta(knotnum))*(knot_x(knotnum) - xtrial_global))^2/knot_ry(knotnum)^2 - 1;
        angletaken2=mod(pi/2 + atan(((2*cos(knot_theta(knotnum))*(cos(knot_theta(knotnum))*(knot_y(knotnum) - ytrial_global) - sin(knot_theta(knotnum))*(knot_x(knotnum) - xtrial_global)))/knot_ry(knotnum)^2 + (2*sin(knot_theta(knotnum))*(cos(knot_theta(knotnum))*(knot_x(knotnum) - xtrial_global) + sin(knot_theta(knotnum))*(knot_y(knotnum) - ytrial_global)))/knot_rx(knotnum)^2)/((2*cos(knot_theta(knotnum))*(cos(knot_theta(knotnum))*(knot_x(knotnum) - xtrial_global) + sin(knot_theta(knotnum))*(knot_y(knotnum) - ytrial_global)))/knot_rx(knotnum)^2 - (2*sin(knot_theta(knotnum))*(cos(knot_theta(knotnum))*(knot_y(knotnum) - ytrial_global) - sin(knot_theta(knotnum))*(knot_x(knotnum) - xtrial_global)))/knot_ry(knotnum)^2)), pi);
        flimit1=1;
        flimit2=5;
        if f<flimit1
            angletaken=angletaken2;
        elseif f<flimit2
            anglefactor=(f-flimit1)/(flimit2-flimit1);
            angletaken=angletaken2*(1-anglefactor)+angletaken1*anglefactor;
        else
            angletaken=angletaken1;
        end
    end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [connectivity] = CrackParticleClustering(x_sp,distancelimit,justcrackedlist)
	%--------------------------Determining cenection between particles--------------------%
	nspCount=length(justcrackedlist);
	nspconnectivitylength=zeros(1,nspCount);
	nspconnectivitycounter=zeros(1,nspCount);
	coder.varsize('nspconnectivitycounter');

	for i=1:nspCount
		for j=1:nspCount
			distance=x_sp(justcrackedlist(j),:)-x_sp(justcrackedlist(i),:);
			distancemag=sqrt(dot(distance,distance));
			if distancemag<distancelimit
				nspconnectivitylength(i)=nspconnectivitylength(i)+1;
			end
		end
	end
	nspconnectivity=cell(1,nspCount);
	for i=1:nspCount
		nspconnectivity{i}=zeros(1,nspconnectivitylength(i));
	end
	%nspconnectivity_temp=cell(nspCount,1); %apparently unused
	for i=1:nspCount
		for j=1:nspCount
			distance=x_sp(justcrackedlist(j),:)-x_sp(justcrackedlist(i),:);
			distancemag=sqrt(dot(distance,distance));
			if distancemag<distancelimit
				nspconnectivitycounter(i)=nspconnectivitycounter(i)+1;
				nspconnectivity{i}(1,nspconnectivitycounter(i))=j;
			end
		end
	end
	%--------------------------------------------------------------------------------%
	%----------------------Forming velocity fields based on nspconnectivity---------------%
	stopcounter=0;                          %inital value for the counter calculation
	stop=0;                   %inital value for the counter
	while stop<1   %These calculation countiues until number of filled rows in nspconnectivity become unchanged.
		for i=1:length (nspconnectivity)                                                %Moving on the rows of nspconnectivity
			for j=1:length (nspconnectivity{i})                                           %Moving on the columns of nspconnectivity
				for k=i+1:length (nspconnectivity)                                        %Elements of next lines should be checked for finding element (i,j). Moving on the rows of nspconnectivity in next lines.
					m=1;                                                                %Elements of next lines should be checked for finding element (i,j). Moving on the columns of nspconnectivity in next lines. 
					while m<=length (nspconnectivity{k})                                  %This check can be stooped as soon as one element is found, since founding one conection is enough. While is used to easily stop this loop.
						
						if nspconnectivity{i}(j)<nspconnectivity{k}(m)               %If bigger than (i,j). Then there is no point in checking more.               
							m=length (nspconnectivity{k})+1;       
						elseif nspconnectivity{i}(j)>nspconnectivity{k}(m)                %If smaller than (i,j, then next one should be checked                                               %If not equal to (i,j)and smaller. Then go to next and check again.             
							m=m+1;                                                    
						elseif nspconnectivity{i}(j)==nspconnectivity{k}(m)               %If  equal to (i,j). This means that all particles on i and k are connected. Therefore, all particles of k will be moved to i. This will result in repeated particle on i which will be taken care of in the end of checking row i                     
							nspconnectivity{i}=[nspconnectivity{i} nspconnectivity{k}];   
							nspconnectivity{k}=zeros(1,0);
						end                
					end                        
				end
			end
			if length(nspconnectivity{i})>=0
				nspconnectivity{i}=unique(nspconnectivity{i}); %This will take care of repeated particle on row i
			end
		end
		%-------------While loop control------------%
		
		%nspconnectivity=nspconnectivity(~cellfun('isempty',nspconnectivity));                  %Removing empty cells
		nspconnectivity=EliminateEmptyCells(nspconnectivity);                  %Removing empty cells, coder friendly
		if stopcounter==length(nspconnectivity);                                      %If size of nspconnectivity is the same as the last loop. Then finish the while loop
			stop=1;
		else                                                                       %If not, then put the stopcounter equal to size of nspconnectivity. 
			stopcounter=length(nspconnectivity);
		end
		%-------------While loop control end------------%
	end
	
	connectivity=nspconnectivity;
	for i=1:length(nspconnectivity)
		for j=1:length(nspconnectivity{i})
			connectivity{i}(j)=justcrackedlist(nspconnectivity{i}(j));
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [connectivity] = CrackParticleClustering_nodes(LOC,distancelimit,justcrackedlist)
	%--------------------------Determining cenection between particles--------------------%
	nioCount=length(justcrackedlist);
	nioconnectivitylength=zeros(1,nioCount);
	nioconnectivitycounter=zeros(1,nioCount);
	coder.varsize('nioconnectivitycounter');

	for i=1:nioCount
		for j=1:nioCount
			distance=LOC(justcrackedlist(j),:)-LOC(justcrackedlist(i),:);
			distancemag=sqrt(dot(distance,distance));
			if distancemag<distancelimit
				nioconnectivitylength(i)=nioconnectivitylength(i)+1;
			end
		end
	end
	nioconnectivity=cell(1,nioCount);
	for i=1:nioCount
		nioconnectivity{i}=zeros(1,nioconnectivitylength(i));
	end
	%nspconnectivity_temp=cell(nioCount,1); %apparently unused
	for i=1:nioCount
		for j=1:nioCount
			distance=LOC(justcrackedlist(j),:)-LOC(justcrackedlist(i),:);
			distancemag=sqrt(dot(distance,distance));
			if distancemag<distancelimit
				nioconnectivitycounter(i)=nioconnectivitycounter(i)+1;
				nioconnectivity{i}(1,nioconnectivitycounter(i))=j;
			end
		end
	end
	%--------------------------------------------------------------------------------%
	%----------------------Forming velocity fields based on nioconnectivity---------------%
	stopcounter=0;                          %inital value for the counter calculation
	stop=0;                   %inital value for the counter
	while stop<1   %These calculation countiues until number of filled rows in nioconnectivity become unchanged.
		for i=1:length (nioconnectivity)                                                %Moving on the rows of nioconnectivity
			for j=1:length (nioconnectivity{i})                                           %Moving on the columns of nioconnectivity
				for k=i+1:length (nioconnectivity)                                        %Elements of next lines should be checked for finding element (i,j). Moving on the rows of nioconnectivity in next lines.
					m=1;                                                                %Elements of next lines should be checked for finding element (i,j). Moving on the columns of nioconnectivity in next lines. 
					while m<=length (nioconnectivity{k})                                  %This check can be stooped as soon as one element is found, since founding one conection is enough. While is used to easily stop this loop.
						
						if nioconnectivity{i}(j)<nioconnectivity{k}(m)               %If bigger than (i,j). Then there is no point in checking more.               
							m=length (nioconnectivity{k})+1;       
						elseif nioconnectivity{i}(j)>nioconnectivity{k}(m)                %If smaller than (i,j, then next one should be checked                                               %If not equal to (i,j)and smaller. Then go to next and check again.             
							m=m+1;                                                    
						elseif nioconnectivity{i}(j)==nioconnectivity{k}(m)               %If  equal to (i,j). This means that all particles on i and k are connected. Therefore, all particles of k will be moved to i. This will result in repeated particle on i which will be taken care of in the end of checking row i                     
							nioconnectivity{i}=[nioconnectivity{i} nioconnectivity{k}];   
							nioconnectivity{k}=zeros(1,0);
						end                
					end                        
				end
			end
			if length(nioconnectivity{i})>=0
				nioconnectivity{i}=unique(nioconnectivity{i}); %This will take care of repeated particle on row i
			end
		end
		%-------------While loop control------------%
		
		%nioconnectivity=nioconnectivity(~cellfun('isempty',nioconnectivity));                  %Removing empty cells
		nioconnectivity=EliminateEmptyCells(nioconnectivity);                  %Removing empty cells, coder friendly
		if stopcounter==length(nioconnectivity);                                      %If size of nioconnectivity is the same as the last loop. Then finish the while loop
			stop=1;
		else                                                                       %If not, then put the stopcounter equal to size of nioconnectivity. 
			stopcounter=length(nioconnectivity);
		end
		%-------------While loop control end------------%
	end
	
	connectivity=nioconnectivity;
	for i=1:length(nioconnectivity)
		for j=1:length(nioconnectivity{i})
			connectivity{i}(j)=justcrackedlist(nioconnectivity{i}(j));
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [connectivity] = CrackParticleClustering_nodes_nocell(LOC,distancelimit,justcrackedlist)
	%--------------------------Determining cenection between particles--------------------%
	nioCount=length(justcrackedlist);
	nioconnectivitylength=zeros(1,nioCount);
	nioconnectivitycounter=zeros(1,nioCount);
	coder.varsize('nioconnectivitycounter');

	for i=1:nioCount
		for j=1:nioCount
			distance=LOC(justcrackedlist(j),:)-LOC(justcrackedlist(i),:);
			distancemag=sqrt(dot(distance,distance));
			if distancemag<distancelimit
				nioconnectivitylength(i)=nioconnectivitylength(i)+1;
			end
		end
	end
	nioconnectivity=cell(1,nioCount);
	for i=1:nioCount
		nioconnectivity{i}=zeros(1,nioconnectivitylength(i));
	end
	%nspconnectivity_temp=cell(nioCount,1); %apparently unused
	for i=1:nioCount
		for j=1:nioCount
			distance=LOC(justcrackedlist(j),:)-LOC(justcrackedlist(i),:);
			distancemag=sqrt(dot(distance,distance));
			if distancemag<distancelimit
				nioconnectivitycounter(i)=nioconnectivitycounter(i)+1;
				nioconnectivity{i}(1,nioconnectivitycounter(i))=j;
			end
		end
	end
	%--------------------------------------------------------------------------------%
	%----------------------Forming velocity fields based on nioconnectivity---------------%
	stopcounter=0;                          %inital value for the counter calculation
	stop=0;                   %inital value for the counter
	while stop<1   %These calculation countiues until number of filled rows in nioconnectivity become unchanged.
		for i=1:length (nioconnectivity)                                                %Moving on the rows of nioconnectivity
			for j=1:length (nioconnectivity{i})                                           %Moving on the columns of nioconnectivity
				for k=i+1:length (nioconnectivity)                                        %Elements of next lines should be checked for finding element (i,j). Moving on the rows of nioconnectivity in next lines.
					m=1;                                                                %Elements of next lines should be checked for finding element (i,j). Moving on the columns of nioconnectivity in next lines. 
					while m<=length (nioconnectivity{k})                                  %This check can be stooped as soon as one element is found, since founding one conection is enough. While is used to easily stop this loop.
						
						if nioconnectivity{i}(j)<nioconnectivity{k}(m)               %If bigger than (i,j). Then there is no point in checking more.               
							m=length (nioconnectivity{k})+1;       
						elseif nioconnectivity{i}(j)>nioconnectivity{k}(m)                %If smaller than (i,j, then next one should be checked                                               %If not equal to (i,j)and smaller. Then go to next and check again.             
							m=m+1;                                                    
						elseif nioconnectivity{i}(j)==nioconnectivity{k}(m)               %If  equal to (i,j). This means that all particles on i and k are connected. Therefore, all particles of k will be moved to i. This will result in repeated particle on i which will be taken care of in the end of checking row i                     
							nioconnectivity{i}=[nioconnectivity{i} nioconnectivity{k}];   
							nioconnectivity{k}=zeros(1,0);
						end                
					end                        
				end
			end
			if length(nioconnectivity{i})>=0
				nioconnectivity{i}=unique(nioconnectivity{i}); %This will take care of repeated particle on row i
			end
		end
		%-------------While loop control------------%
		
		%nioconnectivity=nioconnectivity(~cellfun('isempty',nioconnectivity));                  %Removing empty cells
		nioconnectivity=EliminateEmptyCells(nioconnectivity);                  %Removing empty cells, coder friendly
		if stopcounter==length(nioconnectivity);                                      %If size of nioconnectivity is the same as the last loop. Then finish the while loop
			stop=1;
		else                                                                       %If not, then put the stopcounter equal to size of nioconnectivity. 
			stopcounter=length(nioconnectivity);
		end
		%-------------While loop control end------------%
	end
	
	connectivity=nioconnectivity;
	for i=1:length(nioconnectivity)
		for j=1:length(nioconnectivity{i})
			connectivity{i}(j)=justcrackedlist(nioconnectivity{i}(j));
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [TheFieldSplit,maplist,maplistsize]=Base3Mapping_sp(TheFieldSplitBase3,CONNECT,maplist,maplistsize,niCount)
	%coder.varsize('maplist');
	spCount=size(TheFieldSplitBase3,2);
    ncrackpath=size(TheFieldSplitBase3,3);
	spSizes=zeros(1,spCount);
	for sp=1:spCount
		spSizes(sp)=length(CONNECT{sp});
	end
	TheFieldSplit=zeros(max(spSizes),spCount);
	for sp=1:spCount
		for nni=1:spSizes(sp)
			ni=CONNECT{sp}(nni);
            matchfound=0;
            for imaplist=1:maplistsize
				summaplistequal=0;
				for jmaplist=1:size(maplist,2)
					if maplist(imaplist,jmaplist)==TheFieldSplitBase3(nni,sp,jmaplist)
						summaplistequal=summaplistequal+1;
					end
				end
				if summaplistequal==ncrackpath
					matchfound=1;
					TheFieldSplit(nni,sp)=imaplist;
					break;
				end
            end
            if matchfound==0
				maplistsize=maplistsize+1;
                TheFieldSplit(nni,sp)=maplistsize;
				for j=1:ncrackpath
					maplist(maplistsize,j)=TheFieldSplitBase3(nni,sp,j);
				end
            end
        end
    end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [TheFieldSplit,maplist,maplistsize]=Base3Mapping(TheFieldSplitBase3_old,CONNECTpn,maplist,maplistsize,spCount)
	%coder.varsize('maplist');
    ncrackpath=size(TheFieldSplitBase3_old{1},2);
    TheFieldSplit=ones(length(TheFieldSplitBase3_old),spCount);
    for i=1:size(CONNECTpn,1)
		CONNECTpnLength=0;
		for j=1:size(CONNECTpn,2)
			if CONNECTpn(i,j)>0
				CONNECTpnLength=CONNECTpnLength+1;
			else
				break;
			end
		end
        for nsp=1:CONNECTpnLength
			sp=CONNECTpn(i,nsp);
            matchfound=0;
            for imaplist=1:maplistsize
                if sum(maplist(imaplist,:)==TheFieldSplitBase3_old{i}(nsp,:))==ncrackpath;
                    matchfound=1;
                    TheFieldSplit(i,sp)=imaplist;
                    break;
                end
            end
            if matchfound==0
				maplistsize=maplistsize+1;
                TheFieldSplit(i,sp)=maplistsize;
				for j=1:ncrackpath
					maplist(maplistsize,j)=TheFieldSplitBase3_old{i}(nsp,j);
				end
            end
        end
    end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [TheFieldSplit,maplist,maplistsize]=Base3Mapping_crack(TheFieldSplitBase3_sp,CONNECTpn,CONNECT,spSizes,maplist,maplistsize)
	spCount=size(CONNECT,1);
    ncrackpath=size(TheFieldSplitBase3_sp,3);
    TheFieldSplit=ones(size(TheFieldSplitBase3_sp,1),size(TheFieldSplitBase3_sp,2));
    for sp=1:spCount
		for nni=1:spSizes(sp)
            %i=CONNECT(sp,nni);
            matchfound=0;
            for imaplist=1:maplistsize
				summaplistequal=0;
				for jmaplist=1:size(maplist,2)
					if maplist(imaplist,jmaplist)==TheFieldSplitBase3_sp(nni,sp,jmaplist);
						summaplistequal=summaplistequal+1;
					end
				end
                if summaplistequal==ncrackpath;
                    matchfound=1;
                    TheFieldSplit(nni,sp)=imaplist;
                    break;
                end
            end
            if matchfound==0
				maplistsize=maplistsize+1;
                TheFieldSplit(nni,sp)=maplistsize;
				for j=1:size(TheFieldSplitBase3_sp,3)
					maplist(maplistsize,j)=TheFieldSplitBase3_sp(nni,sp,j);
					%maplist=MatrixInsertion(maplist,size(maplist,1)+1,j,TheFieldSplitBase3_sp(nni,sp,j));
				end
            end
        end
    end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%{
function [TheFieldSplit,maplist,maplistsize]=Base3Mapping_crack_nocellboth(TheFieldSplitBase3_cracktop,TheFieldSplitBase3_crackbot,CONNECTpn,maplist,maplistsize)
    ncrackpath=size(TheFieldSplitBase3_cracktop,3);
    TheFieldSplit.top=ones(size(TheFieldSplitBase3_cracktop,1),size(TheFieldSplitBase3_cracktop,2));
    TheFieldSplit.bot=ones(size(TheFieldSplitBase3_crackbot,1),size(TheFieldSplitBase3_crackbot,2));
    for i=1:size(CONNECTpn,1)
		CONNECTpnLength=0;
		for j=1:size(CONNECTpn,2)
			if CONNECTpn(i,j)>0
				CONNECTpnLength=CONNECTpnLength+1;
			else
				break;
			end
		end
        for nsp=1:CONNECTpnLength
            sp=CONNECTpn(i,nsp);
            matchfound=0;
            for imaplist=1:maplistsize
				summaplistequal=0;
				for jmaplist=1:size(maplist,2)
					if maplist(imaplist,jmaplist)==TheFieldSplitBase3_cracktop(i,sp,jmaplist);
						summaplistequal=summaplistequal+1;
					end
				end
                if summaplistequal==ncrackpath;
                    matchfound=1;
                    TheFieldSplit(i,sp)=imaplist;
                    break;
                end
            end
            if matchfound==0
				maplistsize=maplistsize+1;
                TheFieldSplit(i,sp)=maplistsize;
				for j=1:size(TheFieldSplitBase3_cracktop,3)
					maplist(maplistsize,j)=TheFieldSplitBase3_cracktop(i,sp,j);
					%maplist=MatrixInsertion(maplist,size(maplist,1)+1,j,TheFieldSplitBase3_cracktop(i,sp,j));
				end
            end
        end
    end
end
%}
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function integeroutput=integermapping(integerinput,integermapper)
    for i=1:length(integermapper)
        if integerinput==integermapper(i)
            integeroutput=i;
            break;
        end
        if i==length(integermapper)
            fprintf('%s',['integer mapping failed! code 1904201805' char(10)]);
        end
    end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function newtensor=rotatetensorfromold(oldtensor,oldn1)
    oldn1=oldn1/sqrt(dot(oldn1,oldn1));
    
    %newn1=newn1/sqrt(dot(newn1,newn1));
    
    oldn13d=[oldn1(1) oldn1(2) 0];
    oldn23d=cross([0 0 1],oldn13d);
    oldn2=[oldn23d(1) oldn23d(2)];
    
    %newn13d=[newn1(1) newn1(2) 0];
    %newn23d=cross([0 0 1],newn13d);
    %newn2=[newn23d(1) newn23d(2)];
    
    a=[oldn1(1) oldn2(1);
       oldn1(2) oldn2(2)];
    
    newtensor=zeros(2,2);
    for i=1:2
        for j=1:2
            for m=1:2
                for n=1:2
                    newtensor(i,j)=newtensor(i,j)+a(i,m)*a(j,n)*oldtensor(m,n);
                end
            end
        end
    end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function newtensor=rotatetensorfromoldtonew(oldtensor,oldn1,newn1)
    oldn1=oldn1/sqrt(dot(oldn1,oldn1));
    
    newn1=newn1/sqrt(dot(newn1,newn1));
    
    oldn13d=[oldn1(1) oldn1(2) 0];
    oldn23d=cross([0 0 1],oldn13d);
    oldn2=[oldn23d(1) oldn23d(2)];
    
    newn13d=[newn1(1) newn1(2) 0];
    newn23d=cross([0 0 1],newn13d);
    newn2=[newn23d(1) newn23d(2)];
    
    afromold=[oldn1(1) oldn2(1);
       oldn1(2) oldn2(2)];
    atonew=[newn1(1) newn1(2);
       newn2(1) newn2(2)];
    
    a=atonew*afromold;

    newtensor=zeros(2,2);
    for i=1:2
        for j=1:2
            for m=1:2
                for n=1:2
                    newtensor(i,j)=newtensor(i,j)+a(i,m)*a(j,n)*oldtensor(m,n);
                end
            end
        end
    end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function newtensor=rotatetensortonew(oldtensor,newn1)
    %oldn1=oldn1/sqrt(dot(oldn1,oldn1));
    
    newn1=newn1/sqrt(dot(newn1,newn1));
    
    %oldn13d=[oldn1(1) oldn1(2) 0];
    %oldn23d=cross([0 0 1],oldn13d);
    %oldn2=[oldn23d(1) oldn23d(2)];
    
    newn13d=[newn1(1) newn1(2) 0];
    newn23d=cross([0 0 1],newn13d);
    newn2=[newn23d(1) newn23d(2)];
    
    %a=[oldn1(1) oldn2(1);
    %   oldn1(2) oldn2(2)];
    a=[newn1(1) newn1(2);
       newn2(1) newn2(2)];
    
    newtensor=zeros(2,2);
    for i=1:2
        for j=1:2
            for m=1:2
                for n=1:2
                    newtensor(i,j)=newtensor(i,j)+a(i,m)*a(j,n)*oldtensor(m,n);
                end
            end
        end
    end
end



%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

%{
%switchable1
function plotsigmainfconvergence()
	%meant to be copy-pasted
	%clear all
	close all
	clc
	convergence=[transpose(spCount) transpose(sigmainf)];

	loglog(convergence(:,1),convergence(:,2),'-x');
	hold on
	xlabel('number of particles');
	ylabel('sigma inf at propagation (MPa)');
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function plotnormsigmavsparticle()
	%meant to be copy-pasted
	%clear all
	close all
	clc
	convergence=[transpose(spCount) transpose(stressnormpersigmainf)];

	loglog(convergence(:,1),convergence(:,2),'-x');
	hold on
	xlabel('number of particles');
	ylabel('stressnormpersigmainf');
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function plotnormsigmavsgridsize()
	%meant to be copy-pasted
	%clear all
	close all
	clc
	convergence=[transpose(gridsize) transpose(stressnormpersigmainf)];

	loglog(convergence(:,1),convergence(:,2),'-x','DisplayName','Varies');
	hold on
	xlabel('grid size (mm)');
	ylabel('relative stress norm');
	set(gca,'XDir','reverse')
	set(gca,'xlim',[0.1 10]);
	n=length(gridsize);
	slope=log(stressnormpersigmainf(n)/stressnormpersigmainf(n-1))/log(gridsize(n)/gridsize(n-1))
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function plotGerror()
	%meant to be copy-pasted
	%clear all
	close all
	clc
	convergence=[transpose(gridsize) transpose(Grelativeerror)];

	loglog(convergence(:,1),convergence(:,2),'-x');
	hold on
	xlabel('grid size (mm)');
	ylabel('G relative error');
	set(gca,'XDir','reverse')
	set(gca,'xlim',[0.1 10]);
	n=length(gridsize);
	slope=log(Grelativeerror(n)/Grelativeerror(n-1))/log(gridsize(n)/gridsize(n-1))
end
%}
%switchable1

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- START CADAPT FUNCTIONS -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function CellOut=ResizeCell(CellIn,NewLength)
	CellOut=zeros(1,NewLength);
	for i=1:NewLength
		CellOut{i}=CellIn{i};
	end
end

function MatrixOut=ResizeMatrix(MatrixIn,NewSize1,NewSize2)
	MatrixOut=zeros(NewSize1,NewSize2);
	if NewSize1>size(MatrixIn,1)
		LoopSize1=size(MatrixIn,1);
	else
		LoopSize1=NewSize1;
	end
	if NewSize2>size(MatrixIn,2)
		LoopSize2=size(MatrixIn,2);
	else
		Loopsize2=NewSize2;
	end
	for i=1:LoopSize1
		for j=1:LoopSize2
			MatrixOut(i,j)=MatrixIn(i,j);
		end
	end
end

function VectorOut=ResizeVector(VectorIn,NewLength)
	VectorOut=zeros(1,NewLength);
	if NewLength>length(VectorIn)
		LoopLength=length(VectorIn);
	else
		LoopLength=NewLength;
	end
	for i=1:LoopLength
		VectorOut(i)=VectorIn(i);
	end
end

function CellOut=EliminateEmptyCells(CellIn);
	OldLength=length(CellIn);
	NewLength=OldLength;
	iNew=1;
	iNewtoOld=ones(1,OldLength);
	for iOld=1:OldLength
		if length(CellIn{iOld})==0
			NewLength=NewLength-1;
		else
			iNewtoOld(iNew)=iOld;
			iNew=iNew+1;
		end
	end
	CellOut=cell(1,NewLength);
	
	% old limit
	for iNew=1:NewLength
		CellOut{iNew}=CellIn{iNewtoOld(iNew)};
	end
end

function MatrixOutput=VectorizedMatrixInsertion1(MatrixInput,index,RowVectorInput)
	Size1=size(MatrixInput,1); %old row count of MatrixInput
	Size2=size(MatrixInput,2);
	if Size2==size(RowVectorInput,2)
		if index>Size1
			MatrixOutput=zeros(index,Size2);
			MatrixOutput(1:Size1,:)=MatrixInput;
			MatrixOutput(index,:)=RowVectorInput;
		else
			MatrixOutput=MatrixInput;
			MatrixOutput(index,:)=RowVectorInput;
		end
	else
		MatrixOutput=[];
	end
end

function StringOutput=float2txt(NDigits,FloatInput)
	if length(FloatInput)==0
		StringOutput='0';
	elseif FloatInput<=0
		StringOutput='0';
    else
		integerdigits=myfloor(log10(FloatInput))+1;
        if integerdigits<0
            integerdigits=0;
        end
		decimaldigits=max(0,NDigits-integerdigits);
		if decimaldigits>0
			chararray=zeros(1,NDigits+1);
		else
			chararray=zeros(1,NDigits);
		end
		for i=1:integerdigits
			chararray(i)=mod(myfloor(FloatInput*10^-(integerdigits-i)),10)+48;
		end
		if decimaldigits>0
			chararray(integerdigits+1)=46;
		end
		for i=1:decimaldigits
			chararray(i+integerdigits+1)=mod(myfloor(FloatInput*10^-(integerdigits-integerdigits-i)),10)+48;
		end
		StringOutput=char(chararray);
	end
end

function savestring(StringInput,TextFile)
    TheData=fopen(TextFile,'w');
    for i=1:length(StringInput)
        fprintf(TheData,'%s',StringInput(i));
    end
    fclose(TheData);
end

function StringOutput=loadstring(TextFile)
    TextFileOpen=fopen(TextFile);
    StringOutput=char(fread(TextFileOpen,[1,Inf],'char'));
    fclose(TextFileOpen);
end

function chararray=int2chararray(intinput)
    if intinput<=0
        chararray=[48];
    else
        digits=myfloor(log10(intinput))+1;
        chararray=zeros(1,digits);
        for i=1:digits
            chararray(i)=mod(myfloor(intinput*10^-(digits-i)),10)+48;
        end
    end
end

function txtoutput=int2txt_debug(intinput)
	fprintf('%s',['>>line 24207 entered int2txt_debug' char(10)]);
	fprintf('%s',['>>line 24208: intinput=' float2txt(5,intinput) char(10)]);
	txtoutput='123456789';
	coder.varsize('txtoutput');
	txtoutput='';
	floored=0;
    if intinput<=0
        txtoutput='0';
		fprintf('%s',['>>line 24211: txtoutput=' txtoutput char(10)]);
    else
		fprintf('%s',['>>line 24672: log10(intinput)=' float2txt(5,log10(intinput)) char(10)]);
		fprintf('%s',['>>line 24673: floor(log10(intinput))=' float2txt(5,floor(log10(intinput))) char(10)]);
		fprintf('%s',['>>line 24674: floor(log10(intinput))+1=' float2txt(5,floor(log10(intinput))+1) char(10)]);
        digits=floor(log10(intinput))+1;
		fprintf('%s',['>>line 24214: digits=' float2txt(5,digits) char(10)]);
        chararray=zeros(1,digits);
		for i=1:length(chararray)
			fprintf('%s',['>>line 24127: chararray(i)=' float2txt(5,chararray(i)) char(10)]);
		end
		fprintf('%s',['>>line 24219 entering digits loop' char(10)]);
        for i=1:digits
			fprintf('%s',['>>line 24683: i=' float2txt(5,i) char(10)]);
			fprintf('%s',['>>line 24684: intinput=' float2txt(5,intinput) char(10)]);
			fprintf('%s',['>>line 24685: digits=' float2txt(5,digits) char(10)]);
			fprintf('%s',['>>line 24686: -(digits-i)=' float2txt(5,-(digits-i)) char(10)]);
			fprintf('%s',['>>line 24687: 10^-(digits-i)=' float2txt(5,10^-(digits-i)) char(10)]);
			fprintf('%s',['>>line 24688: intinput*10^-(digits-i)=' float2txt(5,intinput*10^-(digits-i)) char(10)]);
			tobefloored=mod(intinput*10^-(digits-i),10);
			fprintf('%s',['>>line 24688: tobefloored=' float2txt(5,tobefloored) char(10)]);
			if tobefloored<1
				fprintf('%s',['tobefloored < 1!' char(10)]);
				floored=0;
			elseif tobefloored<2
				fprintf('%s',['tobefloored < 2!' char(10)]);
				floored=1;
			elseif tobefloored<3
				fprintf('%s',['tobefloored < 3!' char(10)]);
				floored=2;
			elseif tobefloored<4
				fprintf('%s',['tobefloored < 4!' char(10)]);
				floored=3;
			elseif tobefloored<5
				fprintf('%s',['tobefloored < 5!' char(10)]);
				floored=4;
			elseif tobefloored<6
				fprintf('%s',['tobefloored < 6!' char(10)]);
				floored=5;
			elseif tobefloored<7
				fprintf('%s',['tobefloored < 7!' char(10)]);
				floored=6;
			elseif tobefloored<8
				fprintf('%s',['tobefloored < 8!' char(10)]);
				floored=7;
			elseif tobefloored<9
				fprintf('%s',['tobefloored < 9!' char(10)]);
				floored=8;
			elseif tobefloored<10
				fprintf('%s',['tobefloored < 10!' char(10)]);
				floored=9;
			else
				fprintf('%s',['Conversion Error(1)!' char(10)]);
				fprintf('%s',['Conversion Error(2)!' char(10)]);
				fprintf('%s',['Conversion Error(3)!' char(10)]);
				fprintf('%s',['Conversion Error(4)!' char(10)]);
				fprintf('%s',['Conversion Error(5)!' char(10)]);
			end
			tobefloored=intinput*10^-(digits-i);
			floored2=tobefloored-mod(tobefloored,1);
			floored3=mod(tobefloored-mod(tobefloored,1),10);
			floored4=floor(floored3);
			fprintf('%s',['>>line 24688: floored=' float2txt(5,floored) char(10)]);
			fprintf('%s',['>>line 24688: floored2=' float2txt(5,floored2) char(10)]);
			fprintf('%s',['>>line 24688: floored3=' float2txt(5,floored3) char(10)]);
			fprintf('%s',['>>line 24688: floored4=' float2txt(5,floored4) char(10)]);
			fprintf('%s',['>>line 24693: floor(intinput*10^-(digits-i))=' float2txt(5,floor(intinput*10^-(digits-i))) char(10)]);
			fprintf('%s',['>>line 24694: mod(floor(intinput*10^-(digits-i)),10)=' float2txt(5,mod(floor(intinput*10^-(digits-i)),10)) char(10)]);
			fprintf('%s',['>>line 24695: mod(floor(intinput*10^-(digits-i)),10)+48=' float2txt(5,mod(floor(intinput*10^-(digits-i)),10)+48) char(10)]);
			fprintf('%s',['>>line 24696: chararray(i)=' float2txt(5,chararray(i)) char(10)]);
			fprintf('%s',['calculating new chararray(i)...' char(10)]);
            chararray(i)=mod(floor(intinput*10^-(digits-i)),10)+48;
			fprintf('%s',['>>line 24232: chararray(i)=' float2txt(5,chararray(i)) char(10)]);
        end
		fprintf('%s',['>>line 24234 out of digits loop' char(10)]);
		for i=1:length(chararray)
			fprintf('%s',['>>line 24236: chararray(i)=' float2txt(5,chararray(i)) char(10)]);
		end
        txtoutput=char(chararray);
		fprintf('%s',['>>line 24239: txtoutput=' txtoutput char(10)]);
    end
	fprintf('%s',['>>line 24241 exitting int2txt_debug' char(10)]);
end

function floored=myfloor(numberinput);
	floored=floor(numberinput-mod(numberinput,1));
end

function txtoutput=int2txt(intinput)
	txtoutput='123456789';
	coder.varsize('txtoutput');
	txtoutput='';
    if intinput<=0
        txtoutput='0';
    else
        digits=myfloor(log10(intinput))+1;
        chararray=zeros(1,digits);
        for i=1:digits
            chararray(i)=mod(myfloor(intinput*10^-(digits-i)),10)+48;
        end
        txtoutput=char(chararray);
    end
end

function txtoutput=int2txt_original(intinput)
	txtoutput='123456789';
	coder.varsize('txtoutput');
	txtoutput='';
    if intinput<=0
        txtoutput='0';
    else
        digits=floor(log10(intinput))+1;
        chararray=zeros(1,digits);
        for i=1:digits
            chararray(i)=mod(floor(intinput*10^-(digits-i)),10)+48;
        end
        txtoutput=char(chararray);
    end
end

function savecellmatrixfloat(TheCell,TextFile)
    dummy=0;
    dummy=length(TheCell);
    dummy=dummy+1;
	TheData=fopen(TextFile,'w');
	CellLength=length(TheCell);
	for iCell=CellLength:-1:1
        if iCell<CellLength
            fprintf(TheData,char(10));
        end
		fprintf(TheData,char(123));
		fprintf(TheData,'%s',int2txt(iCell));
		fprintf(TheData,char(125));
		fprintf(TheData,'\n');
		rowsize=size(TheCell{iCell},1);
		columnsize=size(TheCell{iCell},2);
		for i=1:rowsize
			if i>1
				fprintf(TheData,'\n');
			end
			for j=1:columnsize
				if j>1
					fprintf(TheData,char(9));
				end
				fprintf(TheData,'%s',float2scitxt(16,TheCell{iCell}(i,j)));
			end
		end
	end
    fclose(TheData);
end

function savecellmatrixfloat_original(TheCell,TextFile)
    dummy=0;
    dummy=length(TheCell);
    dummy=dummy+1;
	TheData=fopen(TextFile,'w');
	CellLength=length(TheCell);
	for iCell=CellLength:-1:1
        if iCell<CellLength
            fprintf(TheData,char(10));
        end
		fprintf(TheData,char(123));
		fprintf(TheData,'%s',int2txt(iCell));
		fprintf(TheData,char(125));
		fprintf(TheData,'\n');
		rowsize=size(TheCell{iCell},1);
		columnsize=size(TheCell{iCell},2);
		for i=1:rowsize
			if i>1
				fprintf(TheData,'\n');
			end
			for j=1:columnsize
				if j>1
					fprintf(TheData,char(9));
				end
				fprintf(TheData,'%s',float2scitxt(16,TheCell{iCell}(i,j)));
			end
		end
	end
    fclose(TheData);
end

function savematrix3floatcell(TheCell,TheSizes,nCell,TextFile)
    dummy=0;
    dummy=length(TheCell);
    dummy=dummy+1;
	TheData=fopen(TextFile,'w');
	CellLength=nCell;
	for iCell=CellLength:-1:1
        if iCell<CellLength
            fprintf(TheData,char(10));
        end
		fprintf(TheData,char(123));
		fprintf(TheData,'%s',int2txt(iCell));
		fprintf(TheData,char(125));
		fprintf(TheData,'\n');
		rowsize=TheSizes(iCell);
		columnsize=size(TheCell(:,:,1),2);
		for i=1:rowsize
			if i>1
				fprintf(TheData,'\n');
			end
			for j=1:columnsize
				if j>1
					fprintf(TheData,char(9));
				end
				fprintf(TheData,'%s',float2scitxt(16,TheCell(i,j,iCell)));
			end
		end
	end
    fclose(TheData);
end

function savematrix3float(TheMatrix3,TextFile)
    dummy=0;
    dummy=size(TheMatrix3,3);
    dummy=dummy+1;
	TheData=fopen(TextFile,'w');
	nSize1=size(TheMatrix3,1);
	nSize2=size(TheMatrix3,2);
	nSize3=size(TheMatrix3,3);
	for iSize3=nSize3:-1:1
        if iSize3<nSize3
            fprintf(TheData,char(10));
        end
		fprintf(TheData,char(123));
		fprintf(TheData,'%s',int2txt(iSize3));
		fprintf(TheData,char(125));
		fprintf(TheData,'\n');
		for iSize1=1:nSize1
			if iSize1>1
				fprintf(TheData,'\n');
			end
			for iSize2=1:nSize2
				if iSize2>1
					fprintf(TheData,char(9));
				end
				fprintf(TheData,'%s',float2scitxt(16,TheMatrix3(iSize1,iSize2,iSize3)));
			end
		end
	end
    fclose(TheData);
end

function CellSizes=loadcellsizes(TextFile)
    TextFileOpen=fopen(TextFile);
    TextFileChar=fread(TextFileOpen,[1,Inf],'char');
    fclose(TextFileOpen);
    if length(TextFileChar)>0
		ReadState=0;
		CurrentCellIndex=0;
		for i=1:length(TextFileChar)
			if TextFileChar(i)==123
				ReadState=3;
			elseif TextFileChar(i)>=48 && TextFileChar(i)<=57
				CurrentDigit=TextFileChar(i)-48;
				if ReadState==3
					CurrentCellIndex=CurrentCellIndex*10+CurrentDigit;
				end
			elseif i>1 && TextFileChar(i)==10 && TextFileChar(i-1)==125
				break;
            end
        end
        CellSizes=zeros(CurrentCellIndex,2);
        firstline=1;
        EmptyCell=1;
        CurrentCellIndex=0;
        CurrentDigit=0;
        columnsize=1;
        rowsize=0;
        for i=1:length(TextFileChar)
            if TextFileChar(i)==123
                ReadState=3;
                if i>1
                    if EmptyCell==0
                        CellSizes(CurrentCellIndex,1)=rowsize;
                        CellSizes(CurrentCellIndex,2)=columnsize;
                    else
                        CellSizes(CurrentCellIndex,1)=0;
                        CellSizes(CurrentCellIndex,2)=0;
                    end
                end
                CurrentCellIndex=0;
            elseif i>0 && TextFileChar(i)==10 && TextFileChar(i-1)==125
                ReadState=4;
                EmptyCell=1;
                columnsize=1;
                rowsize=0;
                firstline=1;
            elseif TextFileChar(i)==9
                EmptyCell=0;
                if ReadState==4 && firstline==1
                    columnsize=columnsize+1;
                end
            elseif TextFileChar(i)==10
                firstline=0;
                if ReadState==4
                    rowsize=rowsize+1;
                end
            elseif ReadState==3 && TextFileChar(i)>=48 && TextFileChar(i)<=57
                CurrentDigit=TextFileChar(i)-48;
                CurrentCellIndex=CurrentCellIndex*10+CurrentDigit;
            elseif i==length(TextFileChar)
                rowsize=rowsize+1;
                if EmptyCell==0
                    CellSizes(CurrentCellIndex,1)=rowsize;
                    CellSizes(CurrentCellIndex,2)=columnsize;
                else
                    CellSizes(CurrentCellIndex,1)=0;
                    CellSizes(CurrentCellIndex,2)=0;
                end
            end
        end
        1;
    else
        CellSizes=zeros(1,2);
    end
        %{
        columnsize=1;
        rowsize=1;
        firstenter=0;
        for i=1:length(TextFileChar)
            if TextFileChar(i)==char(10)
                if firstenter==0
                    firstenter=i;
                end
                rowsize=rowsize+1;
            end
            if firstenter==0
                if TextFileChar(i)==char(9)
                    columnsize=columnsize+1;
                end
            end
        end        
        %}
        % ReadState legend: 0: integer reading, 1: decimal reading, 2:
        % exponential reading, 3: cell index reading, 4: prealocating
        % matrix sizes at each cell
        % char(48-57): numbers 0-9 X
		% char(9): tab
        % char(32): space
        % char(10): enter X
        % char(101): e X
        % char(43): + X
        % char(45): -
        % char(46): . X
		% char(123): {
		% char(125): }
end

function Matrix3Output=loadmatrix3float(TextFile)
    CellSizesList=loadcellsizes(TextFile);
	nSize1=CellSizesList(1,1);
	nSize2=CellSizesList(1,2);
    nSize3=size(CellSizesList,1);
    CellSized=cell(1,nSize3);
    for i=1:nSize3
        CellSized{i}=zeros(CellSizesList(i,1),CellSizesList(i,2));
    end
    Matrix3Output=zeros(nSize1,nSize2,nSize3);
    TextFileOpen=fopen(TextFile);
    TextFileChar=fread(TextFileOpen,[1,Inf],'char');
    fclose(TextFileOpen);
    if length(TextFileChar)>0
        % ReadState legend: 0: integer reading, 1: decimal reading, 2:
        % exponential reading, 3: cell index reading, 4: prealocating
        % matrix sizes at each cell
        % char(48-57): numbers 0-9 X
		% char(9): tab
        % char(32): space
        % char(10): enter X
        % char(101): e X
        % char(43): + X
        % char(45): -
        % char(46): . X
		% char(123): {
		% char(125): }
        
        ReadState=0;
        CurrentColumn=1;
        CurrentRow=1;
        CurrentNumber=0;
        CurrentExponent=0;
        CurrentDigit=0;
        NegativeSignNumber=0;
        NegativeSignExponent=0;
        DecimalDistance=0;
		CurrentCellIndex=0;
        EmptyCell=1;
        for i=1:length(TextFileChar)
            if CurrentCellIndex==2
                1;
            end
			if TextFileChar(i)==123
				ReadState=3;
				CurrentCellIndex=0;
			elseif i>1 && TextFileChar(i)==10 && TextFileChar(i-1)==125
                ReadState=0;
                CurrentColumn=1;
                CurrentRow=1;
                CurrentNumber=0;
                CurrentExponent=0;
                CurrentDigit=0;
                NegativeSignNumber=0;
                NegativeSignExponent=0;
                DecimalDistance=0;
                EmptyCell=1;
            elseif TextFileChar(i)==9 || TextFileChar(i)==10
                if EmptyCell==0
                    Matrix3Output(CurrentRow,CurrentColumn,CurrentCellIndex)=((-1)^(NegativeSignNumber))*CurrentNumber*(10^(((-1)^(NegativeSignExponent))*(CurrentExponent)));
                end
                ReadState=0;
                CurrentNumber=0;
                CurrentExponent=0;
                NegativeSignNumber=0;
                NegativeSignExponent=0;
                if TextFileChar(i)==9
                    CurrentColumn=CurrentColumn+1;
                elseif TextFileChar(i)==10
                    CurrentColumn=1;
                    CurrentRow=CurrentRow+1;
                end
            elseif TextFileChar(i)==46
                ReadState=1;
                DecimalDistance=1;
            elseif TextFileChar(i)==101
                ReadState=2;
                NegativeSignExponent=0;
                CurrentExponent=0;
            elseif TextFileChar(i)==43
                if ReadState==2
                    NegativeSignExponent=0;
                else
                    NegativeSignNumber=0;
                end
            elseif TextFileChar(i)==45
                if ReadState==2
                    NegativeSignExponent=1;
                else
                    NegativeSignNumber=1;
                end
            elseif TextFileChar(i)>=48 && TextFileChar(i)<=57
                EmptyCell=0;
                CurrentDigit=TextFileChar(i)-48;
                if ReadState==0
                    CurrentNumber=CurrentNumber*10+CurrentDigit;
                elseif ReadState==1
                    CurrentNumber=CurrentNumber+CurrentDigit/(10^DecimalDistance);
                    DecimalDistance=DecimalDistance+1;
                elseif ReadState==2
                    CurrentExponent=CurrentExponent*10+CurrentDigit;
				elseif ReadState==3
					CurrentCellIndex=CurrentCellIndex*10+CurrentDigit;
                end                
            end
        end
        if EmptyCell==0
            Matrix3Output(CurrentRow,CurrentColumn,CurrentCellIndex)=((-1)^(NegativeSignNumber))*CurrentNumber*(10^(((-1)^(NegativeSignExponent))*(CurrentExponent)));
        end
    end
end

function CellOutput=loadcellmatrixfloat(TextFile)
    CellSizesList=loadcellsizes(TextFile);
    CellSize=size(CellSizesList,1);
    CellSized=cell(1,CellSize);
    for i=1:CellSize
        CellSized{i}=zeros(CellSizesList(i,1),CellSizesList(i,2));
    end
    CellOutput=CellSized;
    TextFileOpen=fopen(TextFile);
    TextFileChar=fread(TextFileOpen,[1,Inf],'char');
    fclose(TextFileOpen);
    if length(TextFileChar)>0
        % ReadState legend: 0: integer reading, 1: decimal reading, 2:
        % exponential reading, 3: cell index reading, 4: prealocating
        % matrix sizes at each cell
        % char(48-57): numbers 0-9 X
		% char(9): tab
        % char(32): space
        % char(10): enter X
        % char(101): e X
        % char(43): + X
        % char(45): -
        % char(46): . X
		% char(123): {
		% char(125): }
        
        ReadState=0;
        CurrentColumn=1;
        CurrentRow=1;
        CurrentNumber=0;
        CurrentExponent=0;
        CurrentDigit=0;
        NegativeSignNumber=0;
        NegativeSignExponent=0;
        DecimalDistance=0;
		CurrentCellIndex=0;
        EmptyCell=1;
        for i=1:length(TextFileChar)
            if CurrentCellIndex==2
                1;
            end
			if TextFileChar(i)==123
				ReadState=3;
				CurrentCellIndex=0;
			elseif i>1 && TextFileChar(i)==10 && TextFileChar(i-1)==125
                ReadState=0;
                CurrentColumn=1;
                CurrentRow=1;
                CurrentNumber=0;
                CurrentExponent=0;
                CurrentDigit=0;
                NegativeSignNumber=0;
                NegativeSignExponent=0;
                DecimalDistance=0;
                EmptyCell=1;
            elseif TextFileChar(i)==9 || TextFileChar(i)==10
                if EmptyCell==0
                    CellOutput{CurrentCellIndex}(CurrentRow,CurrentColumn)=((-1)^(NegativeSignNumber))*CurrentNumber*(10^(((-1)^(NegativeSignExponent))*(CurrentExponent)));
                end
                ReadState=0;
                CurrentNumber=0;
                CurrentExponent=0;
                NegativeSignNumber=0;
                NegativeSignExponent=0;
                if TextFileChar(i)==9
                    CurrentColumn=CurrentColumn+1;
                elseif TextFileChar(i)==10
                    CurrentColumn=1;
                    CurrentRow=CurrentRow+1;
                end
            elseif TextFileChar(i)==46
                ReadState=1;
                DecimalDistance=1;
            elseif TextFileChar(i)==101
                ReadState=2;
                NegativeSignExponent=0;
                CurrentExponent=0;
            elseif TextFileChar(i)==43
                if ReadState==2
                    NegativeSignExponent=0;
                else
                    NegativeSignNumber=0;
                end
            elseif TextFileChar(i)==45
                if ReadState==2
                    NegativeSignExponent=1;
                else
                    NegativeSignNumber=1;
                end
            elseif TextFileChar(i)>=48 && TextFileChar(i)<=57
                EmptyCell=0;
                CurrentDigit=TextFileChar(i)-48;
                if ReadState==0
                    CurrentNumber=CurrentNumber*10+CurrentDigit;
                elseif ReadState==1
                    CurrentNumber=CurrentNumber+CurrentDigit/(10^DecimalDistance);
                    DecimalDistance=DecimalDistance+1;
                elseif ReadState==2
                    CurrentExponent=CurrentExponent*10+CurrentDigit;
				elseif ReadState==3
					CurrentCellIndex=CurrentCellIndex*10+CurrentDigit;
                end                
            end
        end
        if EmptyCell==0
            CellOutput{CurrentCellIndex}(CurrentRow,CurrentColumn)=((-1)^(NegativeSignNumber))*CurrentNumber*(10^(((-1)^(NegativeSignExponent))*(CurrentExponent)));
        end
    end
end

function OutputCell=CellInsertion(TheCell,index,ValueorMatrix)
	if index>length(TheCell)
		OutputCell=cell(1,index);
        for i=1:length(TheCell)
			OutputCell{i}=TheCell{i};
        end
		OutputCell{index}=ValueorMatrix;
	else
		OutputCell=TheCell;
		OutputCell{index}=ValueorMatrix;
	end
end

%{
function OutputCell=DoubleCellInsertion(TheCell,index1,index2,ValueorMatrix)
	if index1>length(TheCell)
		OutputCell=cell(1,index1);
		OutputCell{index1}=cell(1,index2);
		for i=1:length(TheCell)
			OutputCell{i}=TheCell{i};
		end
	else
		
	end
	if index2>length(TheCell{index1})
		OutputCell{index1}=cell(1,index2);
        for i=1:length(TheCell{index1})
			OutputCell{index1}{i}=TheCell{index1}{i};
        end
		OutputCell{index1}{index2}=ValueorMatrix;
	else
		OutputCell{index1}=TheCell{index1};
		OutputCell{index1}{index2}=ValueorMatrix;
	end
end
%}

function OutputMatrix=MatrixInsertion(InputMatrix,Row,Column,Value);
	OldRowSize=size(InputMatrix,1);
	OldColumnSize=size(InputMatrix,2);
	if Row>OldRowSize || Column>OldColumnSize
		NewRowSize=max(Row,OldRowSize);
		NewColumnSize=max(Column,OldColumnSize);
		OutputMatrix=zeros(NewRowSize,NewColumnSize);
		for i=1:OldRowSize
			for j=1:OldColumnSize
				OutputMatrix(i,j)=InputMatrix(i,j);
			end
		end
	else
		OutputMatrix=InputMatrix;
	end
	OutputMatrix(Row,Column)=Value;
end

function OutputMatrix=Matrix3Insertion(InputMatrix,Index1,Index2,Index3,Value);
	OldSize=zeros(1,3);
    OldSize=size(InputMatrix);
	NewSize=zeros(1,3);
	NewIndex=zeros(1,3);
	NewIndex=[Index1 Index2 Index3];
	KeepOldSize=1;
	for i=1:3
		if NewIndex(i)>OldSize(i)
			KeepOldSize=0;
			NewSize(i)=NewIndex(i);
		else
			NewSize(i)=OldSize(i);
		end
	end
	if KeepOldSize
		OutputMatrix=InputMatrix;
	else
		OutputMatrix=zeros(NewSize);
		for i=1:OldSize(1)
			for j=1:OldSize(2)
				for k=1:OldSize(3)
					OutputMatrix(i,j,k)=InputMatrix(i,j,k);
				end
			end
		end
	end
	OutputMatrix(Index1,Index2,Index3)=Value;
end

function OutputVector=VectorInsertion(TheVector,index,value)
	if index>length(TheVector)
		OutputVector=zeros(1,index);
		%for i=1:length(TheVector)
        %    OutputVector(i)=TheVector(i);
        %end
		OutputVector(1:length(TheVector))=TheVector;
        OutputVector(index)=value;
	else
		OutputVector=TheVector;
		OutputVector(index)=value;
	end
end

function ValueOutput=loadsinglelong(TextFile)
    TextFileOpen=fopen(TextFile);
    TextFileChar=fread(TextFileOpen,[1,Inf],'char');
    fclose(TextFileOpen);
    if length(TextFileChar)>0
        % ReadState legend: 0: integer reading, 1: decimal reading, 2: exponential reading
        % char(48-57): numbers 0-9 X
		% char(9): tab
        % char(32): space
        % char(10): enter X
        % char(101): e X
        % char(43): + X
        % char(45): -
        % char(46): . X
        
        ReadState=0;
        CurrentNumber=0;
        CurrentDigit=0;
        NegativeSignNumber=0;
        DecimalDistance=0;
        for i=1:length(TextFileChar)
            if TextFileChar(i)==9 || TextFileChar(i)==10
				ValueOutput=((-1)^(NegativeSignNumber))*CurrentNumber;
				ReadState=0;
				CurrentNumber=0;
				CurrentExponent=0;
				NegativeSignNumber=0;
				NegativeSignExponent=0;
            elseif TextFileChar(i)==46
                ReadState=1;
                DecimalDistance=1;
            elseif TextFileChar(i)==43
				NegativeSignNumber=0;
            elseif TextFileChar(i)==45
				NegativeSignNumber=1;
            elseif TextFileChar(i)>=48 && TextFileChar(i)<=57
                CurrentDigit=TextFileChar(i)-48;
                if ReadState==0
                    CurrentNumber=CurrentNumber*10+CurrentDigit;
                elseif ReadState==1
                    CurrentNumber=CurrentNumber+CurrentDigit/(10^DecimalDistance);
                    DecimalDistance=DecimalDistance+1;
                end                
            end
        end
        ValueOutput=((-1)^(NegativeSignNumber))*CurrentNumber;
    else
        ValueOutput=0;
    end
end

function savesinglelong(TheValue,TextFile)
    TheData=fopen(TextFile,'w');
    fprintf(TheData,'%10.0f',TheValue);
    fclose(TheData);
end

function MatrixOutput=loadmatrixlong(TextFile)
    TextFileOpen=fopen(TextFile);
    TextFileChar=fread(TextFileOpen,[1,Inf],'char');
    fclose(TextFileOpen);
    if length(TextFileChar)>0
        columnsize=1;
        rowsize=1;
        firstenter=0;
        for i=1:length(TextFileChar)
            if TextFileChar(i)==char(10)
                if firstenter==0
                    firstenter=i;
                end
                rowsize=rowsize+1;
            end
            if firstenter==0 && TextFileChar(i)==char(9)
                columnsize=columnsize+1;
            end
        end
        MatrixOutput=zeros(rowsize,columnsize);
        % ReadState legend: 0: integer reading, 1: decimal reading, 2: exponential reading
        % char(48-57): numbers 0-9 X
		% char(9): tab
        % char(32): space
        % char(10): enter X
        % char(101): e X
        % char(43): + X
        % char(45): -
        % char(46): . X
        
        ReadState=0;
        CurrentColumn=1;
        CurrentRow=1;
        CurrentNumber=0;
        CurrentDigit=0;
        NegativeSignNumber=0;
        DecimalDistance=0;
        for i=1:length(TextFileChar)
            if TextFileChar(i)==9 || TextFileChar(i)==10
				MatrixOutput(CurrentRow,CurrentColumn)=((-1)^(NegativeSignNumber))*CurrentNumber;
				ReadState=0;
				CurrentNumber=0;
				CurrentExponent=0;
				NegativeSignNumber=0;
				NegativeSignExponent=0;
				if TextFileChar(i)==9
					CurrentColumn=CurrentColumn+1;
				elseif TextFileChar(i)==10
					CurrentColumn=1;
					CurrentRow=CurrentRow+1;
				end
            elseif TextFileChar(i)==46
                ReadState=1;
                DecimalDistance=1;
            elseif TextFileChar(i)==43
				NegativeSignNumber=0;
            elseif TextFileChar(i)==45
				NegativeSignNumber=1;
            elseif TextFileChar(i)>=48 && TextFileChar(i)<=57
                CurrentDigit=TextFileChar(i)-48;
                if ReadState==0
                    CurrentNumber=CurrentNumber*10+CurrentDigit;
                elseif ReadState==1
                    CurrentNumber=CurrentNumber+CurrentDigit/(10^DecimalDistance);
                    DecimalDistance=DecimalDistance+1;
                end                
            end
        end
        MatrixOutput(CurrentRow,CurrentColumn)=((-1)^(NegativeSignNumber))*CurrentNumber;
    else
        MatrixOutput=[];
    end
end

function savematrixlong(TheMatrix,TextFile)
    rowsize=size(TheMatrix,1);
    columnsize=size(TheMatrix,2);
    TheData=fopen(TextFile,'w');
    for i=1:rowsize
        if i>1
            fprintf(TheData,'\n');
        end
        for j=1:columnsize
            if j>1
                fprintf(TheData,char(9));
            end
            fprintf(TheData,'%10.0f',TheMatrix(i,j));
        end
    end
    fclose(TheData);
end

function savematrixfloat(TheMatrix,TextFile)
    rowsize=size(TheMatrix,1);
    columnsize=size(TheMatrix,2);
    TheData=fopen(TextFile,'w');
    for i=1:rowsize
        if i>1
            fprintf(TheData,'\n');
        end
        for j=1:columnsize
            if j>1
                fprintf(TheData,char(9));
            end
            fprintf(TheData,'%s',float2scitxt(16,TheMatrix(i,j)));
        end
    end
    fclose(TheData);
end

function MatrixOutput=loadmatrixfloat(TextFile)
    TextFileOpen=fopen(TextFile);
    TextFileChar=fread(TextFileOpen,[1,Inf],'char');
    fclose(TextFileOpen);
    if length(TextFileChar)>0
        columnsize=1;
        rowsize=1;
        firstenter=0;
        for i=1:length(TextFileChar)
            if TextFileChar(i)==char(10)
                if firstenter==0
                    firstenter=i;
                end
                rowsize=rowsize+1;
            end
            if firstenter==0
                if TextFileChar(i)==char(9)
                    columnsize=columnsize+1;
                end
            end
        end
        MatrixOutput=zeros(rowsize,columnsize);
        % ReadState legend: 0: integer reading, 1: decimal reading, 2: exponential reading
        % char(48-57): numbers 0-9 X
		% char(9): tab
        % char(32): space
        % char(10): enter X
        % char(101): e X
        % char(43): + X
        % char(45): -
        % char(46): . X
        
        ReadState=0;
        CurrentColumn=1;
        CurrentRow=1;
        CurrentNumber=0;
        CurrentExponent=0;
        CurrentDigit=0;
        NegativeSignNumber=0;
        NegativeSignExponent=0;
        DecimalDistance=0;
        for i=1:length(TextFileChar)
            if TextFileChar(i)==9 || TextFileChar(i)==10
                MatrixOutput(CurrentRow,CurrentColumn)=((-1)^(NegativeSignNumber))*CurrentNumber*(10^(((-1)^(NegativeSignExponent))*(CurrentExponent)));
                ReadState=0;
                CurrentNumber=0;
                CurrentExponent=0;
                NegativeSignNumber=0;
                NegativeSignExponent=0;
                if TextFileChar(i)==9
                    CurrentColumn=CurrentColumn+1;
                elseif TextFileChar(i)==10
                    CurrentColumn=1;
                    CurrentRow=CurrentRow+1;
                end
            elseif TextFileChar(i)==46
                ReadState=1;
                DecimalDistance=1;
            elseif TextFileChar(i)==101
                ReadState=2;
                NegativeSignExponent=0;
                CurrentExponent=0;
            elseif TextFileChar(i)==43
                if ReadState==2
                    NegativeSignExponent=0;
                else
                    NegativeSignNumber=0;
                end
            elseif TextFileChar(i)==45
                if ReadState==2
                    NegativeSignExponent=1;
                else
                    NegativeSignNumber=1;
                end
            elseif TextFileChar(i)>=48 && TextFileChar(i)<=57
                CurrentDigit=TextFileChar(i)-48;
                if ReadState==0
                    CurrentNumber=CurrentNumber*10+CurrentDigit;
                elseif ReadState==1
                    CurrentNumber=CurrentNumber+CurrentDigit/(10^DecimalDistance);
                    DecimalDistance=DecimalDistance+1;
                elseif ReadState==2
                    CurrentExponent=CurrentExponent*10+CurrentDigit;
                end                
            end
        end
        MatrixOutput(CurrentRow,CurrentColumn)=((-1)^(NegativeSignNumber))*CurrentNumber*(10^(((-1)^(NegativeSignExponent))*(CurrentExponent)));
    else
        MatrixOutput=[];
    end
end

function TheOutput = int2txt2(n)
   if n < 10
      TheOutput = [char(48+n)];
   else
      TheOutput = [int2txt(myfloor(n/10)), char(48+mod(n,10))];
   end
end

function savesinglefloat(TheValue,TextFile)
	TheData=fopen(TextFile,'w');
	fprintf(TheData,'%s',float2scitxt(16,TheValue));
	fclose(TheData);
end

function ValueOutput=loadsinglefloat(TextFile)
    TextFileOpen=fopen(TextFile);
    TextFileChar=fread(TextFileOpen,[1,Inf],'char');
    fclose(TextFileOpen);
    if length(TextFileChar)>0
        % ReadState legend: 0: integer reading, 1: decimal reading, 2: exponential reading
        % char(48-57): numbers 0-9 X
		% char(9): tab
        % char(32): space
        % char(10): enter X
        % char(101): e X
        % char(43): + X
        % char(45): -
        % char(46): . X
        
        ReadState=0;
        CurrentNumber=0;
        CurrentExponent=0;
        CurrentDigit=0;
        NegativeSignNumber=0;
        NegativeSignExponent=0;
        DecimalDistance=0;
        for i=1:length(TextFileChar)
            if TextFileChar(i)==46
                ReadState=1;
                DecimalDistance=1;
            elseif TextFileChar(i)==101
                ReadState=2;
                NegativeSignExponent=0;
                CurrentExponent=0;
            elseif TextFileChar(i)==43
                if ReadState==2
                    NegativeSignExponent=0;
                else
                    NegativeSignNumber=0;
                end
            elseif TextFileChar(i)==45
                if ReadState==2
                    NegativeSignExponent=1;
                else
                    NegativeSignNumber=1;
                end
            elseif TextFileChar(i)>=48 && TextFileChar(i)<=57
                CurrentDigit=TextFileChar(i)-48;
                if ReadState==0
                    CurrentNumber=CurrentNumber*10+CurrentDigit;
                elseif ReadState==1
                    CurrentNumber=CurrentNumber+CurrentDigit/(10^DecimalDistance);
                    DecimalDistance=DecimalDistance+1;
                elseif ReadState==2
                    CurrentExponent=CurrentExponent*10+CurrentDigit;
                end                
            end
        end
        ValueOutput=((-1)^(NegativeSignNumber))*CurrentNumber*(10^(((-1)^(NegativeSignExponent))*(CurrentExponent)));
    else
        ValueOutput=0;
    end	
end

function Gradient=ManualLinReg(x,y)
	n=length(x);
	sigmax=0;
	sigmay=0;
	sigmaxsquared=0;
	sigmaxy=0;
	if n==length(y)
		for i=1:n
			sigmaxy=sigmaxy+x(i)*y(i);
			sigmax=sigmax+x(i);
			sigmay=sigmay+y(i);
			sigmaxsquared=sigmaxsquared+x(i)^2;
		end
		Gradient=((n*sigmaxy)-(sigmax*sigmay))/((n*sigmaxsquared)-(sigmax^2));
	else
		Gradient=0;
		fprintf('%s',['x and y has to be the same length' char(10)]);
	end
end

function TextOutput=float2scitxt(TotalDigits,TheNumber)
	chararray=zeros(1,7+TotalDigits);
	charindex=0;
	if length(TheNumber)==0
		charindex=charindex+1;
		chararray(charindex)=43;
		charindex=charindex+1;
		chararray(charindex)=48;
		charindex=charindex+1;
		chararray(charindex)=46;
		for i=1:TotalDigits-1
			charindex=charindex+1;
			chararray(charindex)=48;
		end
		charindex=charindex+1;
		chararray(charindex)=101;
		charindex=charindex+1;
		chararray(charindex)=43;
		for i=1:3
			charindex=charindex+1;
			chararray(charindex)=48;
		end
	else
		%coder.varsize('chararray')
		if TheNumber<0
			charindex=charindex+1;
			chararray(charindex)=45;
			ThePower=myfloor(log10(-TheNumber));
		else
			charindex=charindex+1;
			chararray(charindex)=43;
			if TheNumber>0
				ThePower=myfloor(log10(TheNumber));
			else
				ThePower=0;
			end
		end
		for i=1:TotalDigits
			charindex=charindex+1;
			if TheNumber<0
				chararray(charindex)=mod(myfloor((-TheNumber)*10^-(ThePower+1-i)),10)+48;
			else
				chararray(charindex)=mod(myfloor((TheNumber)*10^-(ThePower+1-i)),10)+48;
			end
			if i==1
				charindex=charindex+1;
				chararray(charindex)=46;
			end
		end
		charindex=charindex+1;
		chararray(charindex)=101;
		if ThePower<0
			charindex=charindex+1;
			chararray(charindex)=45;
			ThePowerDigits=myfloor(log10(-ThePower))+1;
		else
			charindex=charindex+1;
			chararray(charindex)=43;
			if ThePower>0
				ThePowerDigits=myfloor(log10(ThePower))+1;
			else
				ThePowerDigits=0;
			end
		end
		for i=1:3-ThePowerDigits;
			charindex=charindex+1;
			chararray(charindex)=48;
		end
		for i=1:ThePowerDigits
			charindex=charindex+1;
			if ThePower<0
				chararray(charindex)=mod(myfloor((-ThePower)*10^-(ThePowerDigits-i)),10)+48;
			else
				chararray(charindex)=mod(myfloor(ThePower*10^-(ThePowerDigits-i)),10)+48;
			end
		end
	end
	TextOutput=char(chararray);
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- END CADAPT LOAD FUNCTIONS-----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function LWOut=LWRequest(x_request,y_request,x_min,y_min,x_max,y_max)
    ndotx=329;
    ndoty=270;
    
    LW=zeros(ndotx,ndoty);
    LW(1,88)=1;LW(1,89)=1;LW(1,90)=1;LW(1,191)=1;LW(1,192)=1;LW(1,193)=1;LW(1,194)=1;LW(1,195)=1;LW(1,250)=1;LW(1,251)=1;
    LW(1,252)=1;LW(1,266)=1;LW(1,267)=1;LW(1,268)=1;LW(1,269)=1;LW(1,270)=1;LW(2,88)=1;LW(2,89)=1;LW(2,90)=1;LW(2,190)=1;
    LW(2,191)=1;LW(2,192)=1;LW(2,193)=1;LW(2,194)=1;LW(2,195)=1;LW(2,251)=1;LW(2,269)=1;LW(2,270)=1;LW(3,87)=1;LW(3,88)=1;
    LW(3,89)=1;LW(3,189)=1;LW(3,190)=1;LW(3,191)=1;LW(3,192)=1;LW(3,193)=1;LW(4,87)=1;LW(4,88)=1;LW(4,89)=1;LW(4,189)=1;
    LW(4,190)=1;LW(4,191)=1;LW(4,192)=1;LW(4,193)=1;LW(5,86)=1;LW(5,87)=1;LW(5,88)=1;LW(5,189)=1;LW(5,190)=1;LW(5,191)=1;
    LW(5,192)=1;LW(6,86)=1;LW(6,87)=1;LW(6,88)=1;LW(6,188)=1;LW(6,189)=1;LW(6,190)=1;LW(6,191)=1;LW(6,192)=1;LW(7,85)=1;
    LW(7,86)=1;LW(7,87)=1;LW(7,88)=1;LW(7,189)=1;LW(7,190)=1;LW(7,191)=1;LW(8,86)=1;LW(8,87)=1;LW(8,88)=1;LW(8,89)=1;
    LW(9,86)=1;LW(9,87)=1;LW(9,88)=1;LW(9,89)=1;LW(9,90)=1;LW(9,267)=1;LW(9,268)=1;LW(9,269)=1;LW(10,86)=1;LW(10,87)=1;
    LW(10,88)=1;LW(10,89)=1;LW(10,267)=1;LW(10,268)=1;LW(10,269)=1;LW(10,270)=1;LW(11,86)=1;LW(11,87)=1;LW(11,267)=1;LW(11,268)=1;
    LW(11,269)=1;LW(11,270)=1;LW(12,7)=1;LW(12,87)=1;LW(12,267)=1;LW(12,268)=1;LW(12,269)=1;LW(13,6)=1;LW(13,7)=1;LW(13,8)=1;
    LW(13,9)=1;LW(13,20)=1;LW(13,21)=1;LW(13,56)=1;LW(13,87)=1;LW(14,5)=1;LW(14,6)=1;LW(14,7)=1;LW(14,8)=1;LW(14,9)=1;
    LW(14,10)=1;LW(14,19)=1;LW(14,20)=1;LW(14,21)=1;LW(14,22)=1;LW(14,48)=1;LW(14,49)=1;LW(14,55)=1;LW(14,56)=1;LW(14,57)=1;
    LW(14,67)=1;LW(14,68)=1;LW(15,1)=1;LW(15,2)=1;LW(15,3)=1;LW(15,4)=1;LW(15,5)=1;LW(15,6)=1;LW(15,7)=1;LW(15,8)=1;
    LW(15,9)=1;LW(15,10)=1;LW(15,11)=1;LW(15,12)=1;LW(15,13)=1;LW(15,14)=1;LW(15,15)=1;LW(15,16)=1;LW(15,17)=1;LW(15,18)=1;
    LW(15,19)=1;LW(15,20)=1;LW(15,21)=1;LW(15,22)=1;LW(15,23)=1;LW(15,24)=1;LW(15,25)=1;LW(15,26)=1;LW(15,27)=1;LW(15,28)=1;
    LW(15,29)=1;LW(15,30)=1;LW(15,38)=1;LW(15,40)=1;LW(15,41)=1;LW(15,42)=1;LW(15,43)=1;LW(15,44)=1;LW(15,46)=1;LW(15,47)=1;
    LW(15,48)=1;LW(15,49)=1;LW(15,50)=1;LW(15,51)=1;LW(15,52)=1;LW(15,53)=1;LW(15,54)=1;LW(15,55)=1;LW(15,56)=1;LW(15,57)=1;
    LW(15,58)=1;LW(15,59)=1;LW(15,60)=1;LW(15,61)=1;LW(15,62)=1;LW(15,63)=1;LW(15,65)=1;LW(15,66)=1;LW(15,67)=1;LW(15,68)=1;
    LW(15,69)=1;LW(15,70)=1;LW(15,87)=1;LW(15,88)=1;LW(15,89)=1;LW(15,90)=1;LW(16,1)=1;LW(16,2)=1;LW(16,3)=1;LW(16,4)=1;
    LW(16,5)=1;LW(16,6)=1;LW(16,7)=1;LW(16,8)=1;LW(16,9)=1;LW(16,10)=1;LW(16,11)=1;LW(16,12)=1;LW(16,13)=1;LW(16,14)=1;
    LW(16,15)=1;LW(16,16)=1;LW(16,17)=1;LW(16,18)=1;LW(16,19)=1;LW(16,20)=1;LW(16,21)=1;LW(16,22)=1;LW(16,23)=1;LW(16,24)=1;
    LW(16,25)=1;LW(16,26)=1;LW(16,27)=1;LW(16,28)=1;LW(16,29)=1;LW(16,30)=1;LW(16,31)=1;LW(16,32)=1;LW(16,33)=1;LW(16,34)=1;
    LW(16,35)=1;LW(16,36)=1;LW(16,37)=1;LW(16,38)=1;LW(16,39)=1;LW(16,40)=1;LW(16,41)=1;LW(16,42)=1;LW(16,43)=1;LW(16,44)=1;
    LW(16,45)=1;LW(16,46)=1;LW(16,47)=1;LW(16,48)=1;LW(16,49)=1;LW(16,50)=1;LW(16,51)=1;LW(16,52)=1;LW(16,53)=1;LW(16,54)=1;
    LW(16,55)=1;LW(16,56)=1;LW(16,57)=1;LW(16,58)=1;LW(16,59)=1;LW(16,60)=1;LW(16,61)=1;LW(16,62)=1;LW(16,63)=1;LW(16,64)=1;
    LW(16,65)=1;LW(16,66)=1;LW(16,67)=1;LW(16,68)=1;LW(16,69)=1;LW(16,70)=1;LW(16,71)=1;LW(16,72)=1;LW(16,73)=1;LW(16,74)=1;
    LW(16,75)=1;LW(16,76)=1;LW(16,77)=1;LW(16,78)=1;LW(16,79)=1;LW(16,80)=1;LW(16,81)=1;LW(16,82)=1;LW(16,83)=1;LW(16,84)=1;
    LW(16,85)=1;LW(16,86)=1;LW(16,87)=1;LW(16,88)=1;LW(16,89)=1;LW(16,90)=1;LW(16,91)=1;LW(16,96)=1;LW(16,97)=1;LW(16,98)=1;
    LW(16,99)=1;LW(16,100)=1;LW(16,101)=1;LW(16,102)=1;LW(16,103)=1;LW(16,104)=1;LW(16,105)=1;LW(17,1)=1;LW(17,2)=1;LW(17,3)=1;
    LW(17,4)=1;LW(17,5)=1;LW(17,6)=1;LW(17,7)=1;LW(17,8)=1;LW(17,9)=1;LW(17,10)=1;LW(17,11)=1;LW(17,12)=1;LW(17,13)=1;
    LW(17,14)=1;LW(17,15)=1;LW(17,16)=1;LW(17,17)=1;LW(17,18)=1;LW(17,19)=1;LW(17,20)=1;LW(17,21)=1;LW(17,22)=1;LW(17,23)=1;
    LW(17,24)=1;LW(17,25)=1;LW(17,26)=1;LW(17,27)=1;LW(17,28)=1;LW(17,29)=1;LW(17,30)=1;LW(17,31)=1;LW(17,32)=1;LW(17,33)=1;
    LW(17,34)=1;LW(17,35)=1;LW(17,36)=1;LW(17,37)=1;LW(17,38)=1;LW(17,39)=1;LW(17,40)=1;LW(17,41)=1;LW(17,42)=1;LW(17,43)=1;
    LW(17,44)=1;LW(17,45)=1;LW(17,46)=1;LW(17,47)=1;LW(17,48)=1;LW(17,49)=1;LW(17,50)=1;LW(17,51)=1;LW(17,52)=1;LW(17,53)=1;
    LW(17,54)=1;LW(17,55)=1;LW(17,56)=1;LW(17,57)=1;LW(17,58)=1;LW(17,59)=1;LW(17,60)=1;LW(17,61)=1;LW(17,62)=1;LW(17,63)=1;
    LW(17,64)=1;LW(17,65)=1;LW(17,66)=1;LW(17,67)=1;LW(17,68)=1;LW(17,69)=1;LW(17,70)=1;LW(17,71)=1;LW(17,72)=1;LW(17,73)=1;
    LW(17,74)=1;LW(17,75)=1;LW(17,76)=1;LW(17,77)=1;LW(17,78)=1;LW(17,79)=1;LW(17,80)=1;LW(17,81)=1;LW(17,82)=1;LW(17,83)=1;
    LW(17,84)=1;LW(17,85)=1;LW(17,86)=1;LW(17,87)=1;LW(17,88)=1;LW(17,89)=1;LW(17,90)=1;LW(17,91)=1;LW(17,92)=1;LW(17,95)=1;
    LW(17,96)=1;LW(17,97)=1;LW(17,98)=1;LW(17,99)=1;LW(17,100)=1;LW(17,101)=1;LW(17,102)=1;LW(17,103)=1;LW(17,104)=1;LW(17,105)=1;
    LW(17,106)=1;LW(17,111)=1;LW(17,112)=1;LW(17,113)=1;LW(18,1)=1;LW(18,2)=1;LW(18,3)=1;LW(18,4)=1;LW(18,5)=1;LW(18,6)=1;
    LW(18,7)=1;LW(18,8)=1;LW(18,9)=1;LW(18,10)=1;LW(18,11)=1;LW(18,12)=1;LW(18,13)=1;LW(18,14)=1;LW(18,15)=1;LW(18,16)=1;
    LW(18,17)=1;LW(18,18)=1;LW(18,19)=1;LW(18,20)=1;LW(18,21)=1;LW(18,22)=1;LW(18,23)=1;LW(18,24)=1;LW(18,25)=1;LW(18,26)=1;
    LW(18,27)=1;LW(18,28)=1;LW(18,29)=1;LW(18,30)=1;LW(18,31)=1;LW(18,32)=1;LW(18,33)=1;LW(18,34)=1;LW(18,35)=1;LW(18,36)=1;
    LW(18,37)=1;LW(18,38)=1;LW(18,39)=1;LW(18,40)=1;LW(18,41)=1;LW(18,42)=1;LW(18,43)=1;LW(18,44)=1;LW(18,45)=1;LW(18,46)=1;
    LW(18,47)=1;LW(18,48)=1;LW(18,49)=1;LW(18,50)=1;LW(18,51)=1;LW(18,52)=1;LW(18,53)=1;LW(18,54)=1;LW(18,55)=1;LW(18,56)=1;
    LW(18,57)=1;LW(18,58)=1;LW(18,59)=1;LW(18,60)=1;LW(18,61)=1;LW(18,62)=1;LW(18,63)=1;LW(18,64)=1;LW(18,65)=1;LW(18,66)=1;
    LW(18,67)=1;LW(18,68)=1;LW(18,69)=1;LW(18,70)=1;LW(18,71)=1;LW(18,72)=1;LW(18,73)=1;LW(18,74)=1;LW(18,75)=1;LW(18,76)=1;
    LW(18,77)=1;LW(18,78)=1;LW(18,79)=1;LW(18,80)=1;LW(18,81)=1;LW(18,82)=1;LW(18,83)=1;LW(18,84)=1;LW(18,85)=1;LW(18,86)=1;
    LW(18,87)=1;LW(18,88)=1;LW(18,89)=1;LW(18,90)=1;LW(18,91)=1;LW(18,92)=1;LW(18,93)=1;LW(18,94)=1;LW(18,95)=1;LW(18,96)=1;
    LW(18,97)=1;LW(18,98)=1;LW(18,99)=1;LW(18,100)=1;LW(18,101)=1;LW(18,102)=1;LW(18,103)=1;LW(18,104)=1;LW(18,105)=1;LW(18,106)=1;
    LW(18,107)=1;LW(18,111)=1;LW(18,112)=1;LW(18,113)=1;LW(19,1)=1;LW(19,2)=1;LW(19,3)=1;LW(19,4)=1;LW(19,5)=1;LW(19,6)=1;
    LW(19,7)=1;LW(19,8)=1;LW(19,9)=1;LW(19,10)=1;LW(19,11)=1;LW(19,12)=1;LW(19,13)=1;LW(19,14)=1;LW(19,15)=1;LW(19,16)=1;
    LW(19,17)=1;LW(19,18)=1;LW(19,19)=1;LW(19,20)=1;LW(19,21)=1;LW(19,22)=1;LW(19,23)=1;LW(19,24)=1;LW(19,25)=1;LW(19,26)=1;
    LW(19,27)=1;LW(19,28)=1;LW(19,29)=1;LW(19,30)=1;LW(19,31)=1;LW(19,32)=1;LW(19,33)=1;LW(19,34)=1;LW(19,35)=1;LW(19,36)=1;
    LW(19,37)=1;LW(19,38)=1;LW(19,39)=1;LW(19,40)=1;LW(19,41)=1;LW(19,42)=1;LW(19,43)=1;LW(19,44)=1;LW(19,45)=1;LW(19,46)=1;
    LW(19,47)=1;LW(19,48)=1;LW(19,49)=1;LW(19,50)=1;LW(19,51)=1;LW(19,52)=1;LW(19,53)=1;LW(19,54)=1;LW(19,55)=1;LW(19,56)=1;
    LW(19,57)=1;LW(19,58)=1;LW(19,59)=1;LW(19,60)=1;LW(19,61)=1;LW(19,62)=1;LW(19,63)=1;LW(19,64)=1;LW(19,65)=1;LW(19,66)=1;
    LW(19,67)=1;LW(19,68)=1;LW(19,69)=1;LW(19,70)=1;LW(19,71)=1;LW(19,72)=1;LW(19,73)=1;LW(19,74)=1;LW(19,75)=1;LW(19,76)=1;
    LW(19,77)=1;LW(19,78)=1;LW(19,79)=1;LW(19,80)=1;LW(19,81)=1;LW(19,82)=1;LW(19,83)=1;LW(19,84)=1;LW(19,85)=1;LW(19,86)=1;
    LW(19,87)=1;LW(19,88)=1;LW(19,89)=1;LW(19,90)=1;LW(19,91)=1;LW(19,92)=1;LW(19,93)=1;LW(19,94)=1;LW(19,95)=1;LW(19,96)=1;
    LW(19,97)=1;LW(19,98)=1;LW(19,99)=1;LW(19,100)=1;LW(19,101)=1;LW(19,102)=1;LW(19,103)=1;LW(19,104)=1;LW(19,105)=1;LW(19,106)=1;
    LW(19,107)=1;LW(19,108)=1;LW(19,109)=1;LW(19,110)=1;LW(19,111)=1;LW(19,112)=1;LW(19,113)=1;LW(19,125)=1;LW(19,126)=1;LW(19,127)=1;
    LW(19,138)=1;LW(19,139)=1;LW(20,1)=1;LW(20,2)=1;LW(20,3)=1;LW(20,4)=1;LW(20,5)=1;LW(20,6)=1;LW(20,7)=1;LW(20,8)=1;
    LW(20,9)=1;LW(20,10)=1;LW(20,11)=1;LW(20,12)=1;LW(20,13)=1;LW(20,14)=1;LW(20,15)=1;LW(20,16)=1;LW(20,17)=1;LW(20,18)=1;
    LW(20,19)=1;LW(20,20)=1;LW(20,21)=1;LW(20,22)=1;LW(20,23)=1;LW(20,24)=1;LW(20,25)=1;LW(20,26)=1;LW(20,27)=1;LW(20,28)=1;
    LW(20,29)=1;LW(20,30)=1;LW(20,31)=1;LW(20,32)=1;LW(20,33)=1;LW(20,34)=1;LW(20,35)=1;LW(20,36)=1;LW(20,37)=1;LW(20,38)=1;
    LW(20,39)=1;LW(20,40)=1;LW(20,41)=1;LW(20,42)=1;LW(20,43)=1;LW(20,44)=1;LW(20,45)=1;LW(20,46)=1;LW(20,47)=1;LW(20,48)=1;
    LW(20,49)=1;LW(20,50)=1;LW(20,51)=1;LW(20,52)=1;LW(20,53)=1;LW(20,54)=1;LW(20,55)=1;LW(20,56)=1;LW(20,57)=1;LW(20,58)=1;
    LW(20,59)=1;LW(20,60)=1;LW(20,61)=1;LW(20,62)=1;LW(20,63)=1;LW(20,64)=1;LW(20,65)=1;LW(20,66)=1;LW(20,67)=1;LW(20,68)=1;
    LW(20,69)=1;LW(20,70)=1;LW(20,71)=1;LW(20,72)=1;LW(20,73)=1;LW(20,74)=1;LW(20,75)=1;LW(20,76)=1;LW(20,77)=1;LW(20,78)=1;
    LW(20,79)=1;LW(20,80)=1;LW(20,81)=1;LW(20,82)=1;LW(20,83)=1;LW(20,84)=1;LW(20,85)=1;LW(20,86)=1;LW(20,87)=1;LW(20,88)=1;
    LW(20,89)=1;LW(20,90)=1;LW(20,91)=1;LW(20,92)=1;LW(20,93)=1;LW(20,94)=1;LW(20,95)=1;LW(20,96)=1;LW(20,97)=1;LW(20,98)=1;
    LW(20,99)=1;LW(20,100)=1;LW(20,101)=1;LW(20,102)=1;LW(20,103)=1;LW(20,104)=1;LW(20,105)=1;LW(20,106)=1;LW(20,107)=1;LW(20,108)=1;
    LW(20,109)=1;LW(20,110)=1;LW(20,111)=1;LW(20,112)=1;LW(20,113)=1;LW(20,114)=1;LW(20,115)=1;LW(20,116)=1;LW(20,117)=1;LW(20,118)=1;
    LW(20,119)=1;LW(20,120)=1;LW(20,124)=1;LW(20,125)=1;LW(20,126)=1;LW(20,127)=1;LW(20,128)=1;LW(20,129)=1;LW(20,136)=1;LW(20,137)=1;
    LW(20,138)=1;LW(20,139)=1;LW(20,140)=1;LW(21,1)=1;LW(21,2)=1;LW(21,3)=1;LW(21,4)=1;LW(21,5)=1;LW(21,6)=1;LW(21,7)=1;
    LW(21,8)=1;LW(21,9)=1;LW(21,10)=1;LW(21,11)=1;LW(21,12)=1;LW(21,13)=1;LW(21,14)=1;LW(21,15)=1;LW(21,16)=1;LW(21,17)=1;
    LW(21,18)=1;LW(21,19)=1;LW(21,20)=1;LW(21,21)=1;LW(21,22)=1;LW(21,23)=1;LW(21,24)=1;LW(21,25)=1;LW(21,26)=1;LW(21,27)=1;
    LW(21,28)=1;LW(21,29)=1;LW(21,30)=1;LW(21,31)=1;LW(21,32)=1;LW(21,33)=1;LW(21,34)=1;LW(21,35)=1;LW(21,36)=1;LW(21,37)=1;
    LW(21,38)=1;LW(21,39)=1;LW(21,40)=1;LW(21,41)=1;LW(21,42)=1;LW(21,43)=1;LW(21,44)=1;LW(21,45)=1;LW(21,46)=1;LW(21,47)=1;
    LW(21,48)=1;LW(21,49)=1;LW(21,50)=1;LW(21,51)=1;LW(21,52)=1;LW(21,53)=1;LW(21,54)=1;LW(21,55)=1;LW(21,56)=1;LW(21,57)=1;
    LW(21,58)=1;LW(21,59)=1;LW(21,60)=1;LW(21,61)=1;LW(21,62)=1;LW(21,63)=1;LW(21,64)=1;LW(21,65)=1;LW(21,66)=1;LW(21,67)=1;
    LW(21,68)=1;LW(21,69)=1;LW(21,70)=1;LW(21,71)=1;LW(21,72)=1;LW(21,73)=1;LW(21,74)=1;LW(21,75)=1;LW(21,76)=1;LW(21,77)=1;
    LW(21,78)=1;LW(21,79)=1;LW(21,80)=1;LW(21,81)=1;LW(21,82)=1;LW(21,83)=1;LW(21,84)=1;LW(21,85)=1;LW(21,86)=1;LW(21,87)=1;
    LW(21,88)=1;LW(21,89)=1;LW(21,90)=1;LW(21,91)=1;LW(21,92)=1;LW(21,93)=1;LW(21,94)=1;LW(21,95)=1;LW(21,96)=1;LW(21,97)=1;
    LW(21,98)=1;LW(21,99)=1;LW(21,100)=1;LW(21,101)=1;LW(21,102)=1;LW(21,103)=1;LW(21,104)=1;LW(21,105)=1;LW(21,106)=1;LW(21,107)=1;
    LW(21,108)=1;LW(21,109)=1;LW(21,110)=1;LW(21,111)=1;LW(21,112)=1;LW(21,113)=1;LW(21,114)=1;LW(21,115)=1;LW(21,116)=1;LW(21,117)=1;
    LW(21,118)=1;LW(21,119)=1;LW(21,120)=1;LW(21,121)=1;LW(21,123)=1;LW(21,124)=1;LW(21,125)=1;LW(21,126)=1;LW(21,127)=1;LW(21,128)=1;
    LW(21,129)=1;LW(21,130)=1;LW(21,131)=1;LW(21,136)=1;LW(21,137)=1;LW(21,138)=1;LW(21,139)=1;LW(21,140)=1;LW(21,145)=1;LW(21,150)=1;
    LW(21,151)=1;LW(22,1)=1;LW(22,2)=1;LW(22,3)=1;LW(22,4)=1;LW(22,5)=1;LW(22,6)=1;LW(22,7)=1;LW(22,8)=1;LW(22,9)=1;
    LW(22,10)=1;LW(22,11)=1;LW(22,12)=1;LW(22,13)=1;LW(22,14)=1;LW(22,15)=1;LW(22,16)=1;LW(22,17)=1;LW(22,18)=1;LW(22,19)=1;
    LW(22,20)=1;LW(22,21)=1;LW(22,22)=1;LW(22,23)=1;LW(22,24)=1;LW(22,25)=1;LW(22,26)=1;LW(22,27)=1;LW(22,28)=1;LW(22,29)=1;
    LW(22,30)=1;LW(22,31)=1;LW(22,32)=1;LW(22,33)=1;LW(22,34)=1;LW(22,35)=1;LW(22,36)=1;LW(22,37)=1;LW(22,38)=1;LW(22,39)=1;
    LW(22,40)=1;LW(22,41)=1;LW(22,42)=1;LW(22,43)=1;LW(22,44)=1;LW(22,45)=1;LW(22,46)=1;LW(22,47)=1;LW(22,48)=1;LW(22,49)=1;
    LW(22,50)=1;LW(22,51)=1;LW(22,52)=1;LW(22,53)=1;LW(22,54)=1;LW(22,55)=1;LW(22,56)=1;LW(22,57)=1;LW(22,58)=1;LW(22,59)=1;
    LW(22,60)=1;LW(22,61)=1;LW(22,62)=1;LW(22,63)=1;LW(22,64)=1;LW(22,65)=1;LW(22,66)=1;LW(22,67)=1;LW(22,68)=1;LW(22,69)=1;
    LW(22,70)=1;LW(22,71)=1;LW(22,72)=1;LW(22,73)=1;LW(22,74)=1;LW(22,75)=1;LW(22,76)=1;LW(22,77)=1;LW(22,78)=1;LW(22,79)=1;
    LW(22,80)=1;LW(22,81)=1;LW(22,82)=1;LW(22,83)=1;LW(22,84)=1;LW(22,85)=1;LW(22,86)=1;LW(22,87)=1;LW(22,88)=1;LW(22,89)=1;
    LW(22,90)=1;LW(22,91)=1;LW(22,92)=1;LW(22,93)=1;LW(22,94)=1;LW(22,95)=1;LW(22,96)=1;LW(22,97)=1;LW(22,98)=1;LW(22,99)=1;
    LW(22,100)=1;LW(22,101)=1;LW(22,102)=1;LW(22,103)=1;LW(22,104)=1;LW(22,105)=1;LW(22,106)=1;LW(22,107)=1;LW(22,108)=1;LW(22,109)=1;
    LW(22,110)=1;LW(22,111)=1;LW(22,112)=1;LW(22,113)=1;LW(22,114)=1;LW(22,115)=1;LW(22,116)=1;LW(22,117)=1;LW(22,118)=1;LW(22,119)=1;
    LW(22,120)=1;LW(22,121)=1;LW(22,122)=1;LW(22,123)=1;LW(22,124)=1;LW(22,125)=1;LW(22,126)=1;LW(22,127)=1;LW(22,128)=1;LW(22,129)=1;
    LW(22,130)=1;LW(22,131)=1;LW(22,132)=1;LW(22,136)=1;LW(22,137)=1;LW(22,138)=1;LW(22,139)=1;LW(22,140)=1;LW(22,141)=1;LW(22,142)=1;
    LW(22,143)=1;LW(22,144)=1;LW(22,145)=1;LW(22,146)=1;LW(22,149)=1;LW(22,150)=1;LW(22,151)=1;LW(23,1)=1;LW(23,2)=1;LW(23,3)=1;
    LW(23,4)=1;LW(23,5)=1;LW(23,6)=1;LW(23,7)=1;LW(23,8)=1;LW(23,9)=1;LW(23,10)=1;LW(23,11)=1;LW(23,12)=1;LW(23,13)=1;
    LW(23,14)=1;LW(23,15)=1;LW(23,16)=1;LW(23,17)=1;LW(23,18)=1;LW(23,19)=1;LW(23,20)=1;LW(23,21)=1;LW(23,22)=1;LW(23,23)=1;
    LW(23,24)=1;LW(23,25)=1;LW(23,26)=1;LW(23,27)=1;LW(23,28)=1;LW(23,29)=1;LW(23,30)=1;LW(23,31)=1;LW(23,32)=1;LW(23,33)=1;
    LW(23,34)=1;LW(23,35)=1;LW(23,36)=1;LW(23,37)=1;LW(23,38)=1;LW(23,39)=1;LW(23,40)=1;LW(23,41)=1;LW(23,42)=1;LW(23,43)=1;
    LW(23,44)=1;LW(23,45)=1;LW(23,46)=1;LW(23,47)=1;LW(23,48)=1;LW(23,49)=1;LW(23,50)=1;LW(23,51)=1;LW(23,52)=1;LW(23,53)=1;
    LW(23,54)=1;LW(23,55)=1;LW(23,56)=1;LW(23,57)=1;LW(23,58)=1;LW(23,59)=1;LW(23,60)=1;LW(23,61)=1;LW(23,62)=1;LW(23,63)=1;
    LW(23,64)=1;LW(23,65)=1;LW(23,66)=1;LW(23,67)=1;LW(23,68)=1;LW(23,69)=1;LW(23,70)=1;LW(23,71)=1;LW(23,72)=1;LW(23,73)=1;
    LW(23,74)=1;LW(23,75)=1;LW(23,76)=1;LW(23,77)=1;LW(23,78)=1;LW(23,79)=1;LW(23,80)=1;LW(23,81)=1;LW(23,82)=1;LW(23,83)=1;
    LW(23,84)=1;LW(23,85)=1;LW(23,86)=1;LW(23,87)=1;LW(23,88)=1;LW(23,89)=1;LW(23,90)=1;LW(23,91)=1;LW(23,92)=1;LW(23,93)=1;
    LW(23,94)=1;LW(23,95)=1;LW(23,96)=1;LW(23,97)=1;LW(23,98)=1;LW(23,99)=1;LW(23,100)=1;LW(23,101)=1;LW(23,102)=1;LW(23,103)=1;
    LW(23,104)=1;LW(23,105)=1;LW(23,106)=1;LW(23,107)=1;LW(23,108)=1;LW(23,109)=1;LW(23,110)=1;LW(23,111)=1;LW(23,112)=1;LW(23,113)=1;
    LW(23,114)=1;LW(23,115)=1;LW(23,116)=1;LW(23,117)=1;LW(23,118)=1;LW(23,119)=1;LW(23,120)=1;LW(23,121)=1;LW(23,122)=1;LW(23,123)=1;
    LW(23,124)=1;LW(23,125)=1;LW(23,126)=1;LW(23,127)=1;LW(23,128)=1;LW(23,129)=1;LW(23,130)=1;LW(23,131)=1;LW(23,132)=1;LW(23,133)=1;
    LW(23,135)=1;LW(23,136)=1;LW(23,137)=1;LW(23,138)=1;LW(23,139)=1;LW(23,140)=1;LW(23,141)=1;LW(23,142)=1;LW(23,143)=1;LW(23,144)=1;
    LW(23,145)=1;LW(23,146)=1;LW(23,147)=1;LW(23,148)=1;LW(23,149)=1;LW(23,150)=1;LW(23,151)=1;LW(23,152)=1;LW(24,1)=1;LW(24,2)=1;
    LW(24,3)=1;LW(24,4)=1;LW(24,5)=1;LW(24,6)=1;LW(24,7)=1;LW(24,8)=1;LW(24,9)=1;LW(24,10)=1;LW(24,11)=1;LW(24,12)=1;
    LW(24,13)=1;LW(24,14)=1;LW(24,15)=1;LW(24,16)=1;LW(24,17)=1;LW(24,18)=1;LW(24,19)=1;LW(24,20)=1;LW(24,21)=1;LW(24,22)=1;
    LW(24,23)=1;LW(24,24)=1;LW(24,25)=1;LW(24,26)=1;LW(24,27)=1;LW(24,28)=1;LW(24,29)=1;LW(24,30)=1;LW(24,31)=1;LW(24,32)=1;
    LW(24,33)=1;LW(24,34)=1;LW(24,35)=1;LW(24,36)=1;LW(24,37)=1;LW(24,38)=1;LW(24,39)=1;LW(24,40)=1;LW(24,41)=1;LW(24,42)=1;
    LW(24,43)=1;LW(24,44)=1;LW(24,45)=1;LW(24,46)=1;LW(24,47)=1;LW(24,48)=1;LW(24,49)=1;LW(24,50)=1;LW(24,51)=1;LW(24,52)=1;
    LW(24,53)=1;LW(24,54)=1;LW(24,55)=1;LW(24,56)=1;LW(24,57)=1;LW(24,58)=1;LW(24,59)=1;LW(24,60)=1;LW(24,61)=1;LW(24,62)=1;
    LW(24,63)=1;LW(24,64)=1;LW(24,65)=1;LW(24,66)=1;LW(24,67)=1;LW(24,68)=1;LW(24,69)=1;LW(24,70)=1;LW(24,71)=1;LW(24,72)=1;
    LW(24,73)=1;LW(24,74)=1;LW(24,75)=1;LW(24,76)=1;LW(24,77)=1;LW(24,78)=1;LW(24,79)=1;LW(24,80)=1;LW(24,81)=1;LW(24,82)=1;
    LW(24,83)=1;LW(24,84)=1;LW(24,85)=1;LW(24,86)=1;LW(24,87)=1;LW(24,88)=1;LW(24,89)=1;LW(24,90)=1;LW(24,91)=1;LW(24,92)=1;
    LW(24,93)=1;LW(24,94)=1;LW(24,95)=1;LW(24,96)=1;LW(24,97)=1;LW(24,98)=1;LW(24,99)=1;LW(24,100)=1;LW(24,101)=1;LW(24,102)=1;
    LW(24,103)=1;LW(24,104)=1;LW(24,105)=1;LW(24,106)=1;LW(24,107)=1;LW(24,108)=1;LW(24,109)=1;LW(24,110)=1;LW(24,111)=1;LW(24,112)=1;
    LW(24,113)=1;LW(24,114)=1;LW(24,115)=1;LW(24,116)=1;LW(24,117)=1;LW(24,118)=1;LW(24,119)=1;LW(24,120)=1;LW(24,121)=1;LW(24,122)=1;
    LW(24,123)=1;LW(24,124)=1;LW(24,125)=1;LW(24,126)=1;LW(24,127)=1;LW(24,128)=1;LW(24,129)=1;LW(24,130)=1;LW(24,131)=1;LW(24,132)=1;
    LW(24,133)=1;LW(24,134)=1;LW(24,135)=1;LW(24,136)=1;LW(24,137)=1;LW(24,138)=1;LW(24,139)=1;LW(24,140)=1;LW(24,141)=1;LW(24,142)=1;
    LW(24,143)=1;LW(24,144)=1;LW(24,145)=1;LW(24,146)=1;LW(24,147)=1;LW(24,148)=1;LW(24,149)=1;LW(24,150)=1;LW(24,151)=1;LW(24,152)=1;
    LW(24,153)=1;LW(24,154)=1;LW(24,155)=1;LW(24,156)=1;LW(24,157)=1;LW(24,158)=1;LW(24,159)=1;LW(24,163)=1;LW(24,164)=1;LW(24,165)=1;
    LW(25,1)=1;LW(25,2)=1;LW(25,3)=1;LW(25,4)=1;LW(25,5)=1;LW(25,6)=1;LW(25,7)=1;LW(25,8)=1;LW(25,9)=1;LW(25,10)=1;
    LW(25,11)=1;LW(25,12)=1;LW(25,13)=1;LW(25,14)=1;LW(25,15)=1;LW(25,16)=1;LW(25,17)=1;LW(25,18)=1;LW(25,19)=1;LW(25,20)=1;
    LW(25,21)=1;LW(25,22)=1;LW(25,23)=1;LW(25,24)=1;LW(25,25)=1;LW(25,26)=1;LW(25,27)=1;LW(25,28)=1;LW(25,29)=1;LW(25,30)=1;
    LW(25,31)=1;LW(25,32)=1;LW(25,33)=1;LW(25,34)=1;LW(25,35)=1;LW(25,36)=1;LW(25,37)=1;LW(25,38)=1;LW(25,39)=1;LW(25,40)=1;
    LW(25,41)=1;LW(25,42)=1;LW(25,43)=1;LW(25,44)=1;LW(25,45)=1;LW(25,46)=1;LW(25,47)=1;LW(25,48)=1;LW(25,49)=1;LW(25,50)=1;
    LW(25,51)=1;LW(25,52)=1;LW(25,53)=1;LW(25,54)=1;LW(25,55)=1;LW(25,56)=1;LW(25,57)=1;LW(25,58)=1;LW(25,59)=1;LW(25,60)=1;
    LW(25,61)=1;LW(25,62)=1;LW(25,63)=1;LW(25,64)=1;LW(25,65)=1;LW(25,66)=1;LW(25,67)=1;LW(25,68)=1;LW(25,69)=1;LW(25,70)=1;
    LW(25,71)=1;LW(25,72)=1;LW(25,73)=1;LW(25,74)=1;LW(25,75)=1;LW(25,76)=1;LW(25,77)=1;LW(25,78)=1;LW(25,79)=1;LW(25,80)=1;
    LW(25,81)=1;LW(25,82)=1;LW(25,83)=1;LW(25,84)=1;LW(25,85)=1;LW(25,86)=1;LW(25,87)=1;LW(25,88)=1;LW(25,89)=1;LW(25,90)=1;
    LW(25,91)=1;LW(25,92)=1;LW(25,93)=1;LW(25,94)=1;LW(25,95)=1;LW(25,96)=1;LW(25,97)=1;LW(25,98)=1;LW(25,99)=1;LW(25,100)=1;
    LW(25,101)=1;LW(25,102)=1;LW(25,103)=1;LW(25,104)=1;LW(25,105)=1;LW(25,106)=1;LW(25,107)=1;LW(25,108)=1;LW(25,109)=1;LW(25,110)=1;
    LW(25,111)=1;LW(25,112)=1;LW(25,113)=1;LW(25,114)=1;LW(25,115)=1;LW(25,116)=1;LW(25,117)=1;LW(25,118)=1;LW(25,119)=1;LW(25,120)=1;
    LW(25,121)=1;LW(25,122)=1;LW(25,123)=1;LW(25,124)=1;LW(25,125)=1;LW(25,126)=1;LW(25,127)=1;LW(25,128)=1;LW(25,129)=1;LW(25,130)=1;
    LW(25,131)=1;LW(25,132)=1;LW(25,133)=1;LW(25,134)=1;LW(25,135)=1;LW(25,136)=1;LW(25,137)=1;LW(25,138)=1;LW(25,139)=1;LW(25,140)=1;
    LW(25,141)=1;LW(25,142)=1;LW(25,143)=1;LW(25,144)=1;LW(25,145)=1;LW(25,146)=1;LW(25,147)=1;LW(25,148)=1;LW(25,149)=1;LW(25,150)=1;
    LW(25,151)=1;LW(25,152)=1;LW(25,153)=1;LW(25,154)=1;LW(25,155)=1;LW(25,156)=1;LW(25,157)=1;LW(25,158)=1;LW(25,159)=1;LW(25,160)=1;
    LW(25,161)=1;LW(25,162)=1;LW(25,163)=1;LW(25,164)=1;LW(25,165)=1;LW(25,166)=1;LW(25,172)=1;LW(26,1)=1;LW(26,2)=1;LW(26,3)=1;
    LW(26,4)=1;LW(26,5)=1;LW(26,6)=1;LW(26,7)=1;LW(26,8)=1;LW(26,9)=1;LW(26,10)=1;LW(26,11)=1;LW(26,12)=1;LW(26,13)=1;
    LW(26,14)=1;LW(26,15)=1;LW(26,16)=1;LW(26,17)=1;LW(26,18)=1;LW(26,19)=1;LW(26,20)=1;LW(26,21)=1;LW(26,22)=1;LW(26,23)=1;
    LW(26,24)=1;LW(26,25)=1;LW(26,26)=1;LW(26,27)=1;LW(26,28)=1;LW(26,29)=1;LW(26,30)=1;LW(26,31)=1;LW(26,32)=1;LW(26,33)=1;
    LW(26,34)=1;LW(26,35)=1;LW(26,36)=1;LW(26,37)=1;LW(26,38)=1;LW(26,39)=1;LW(26,40)=1;LW(26,41)=1;LW(26,42)=1;LW(26,43)=1;
    LW(26,44)=1;LW(26,45)=1;LW(26,46)=1;LW(26,47)=1;LW(26,48)=1;LW(26,49)=1;LW(26,50)=1;LW(26,51)=1;LW(26,52)=1;LW(26,53)=1;
    LW(26,54)=1;LW(26,55)=1;LW(26,56)=1;LW(26,57)=1;LW(26,58)=1;LW(26,59)=1;LW(26,60)=1;LW(26,61)=1;LW(26,62)=1;LW(26,63)=1;
    LW(26,64)=1;LW(26,65)=1;LW(26,66)=1;LW(26,67)=1;LW(26,68)=1;LW(26,69)=1;LW(26,70)=1;LW(26,71)=1;LW(26,72)=1;LW(26,73)=1;
    LW(26,74)=1;LW(26,75)=1;LW(26,76)=1;LW(26,77)=1;LW(26,78)=1;LW(26,79)=1;LW(26,80)=1;LW(26,81)=1;LW(26,82)=1;LW(26,83)=1;
    LW(26,84)=1;LW(26,85)=1;LW(26,86)=1;LW(26,87)=1;LW(26,88)=1;LW(26,89)=1;LW(26,90)=1;LW(26,91)=1;LW(26,92)=1;LW(26,93)=1;
    LW(26,94)=1;LW(26,95)=1;LW(26,96)=1;LW(26,97)=1;LW(26,98)=1;LW(26,99)=1;LW(26,100)=1;LW(26,101)=1;LW(26,102)=1;LW(26,103)=1;
    LW(26,104)=1;LW(26,105)=1;LW(26,106)=1;LW(26,107)=1;LW(26,108)=1;LW(26,109)=1;LW(26,110)=1;LW(26,111)=1;LW(26,112)=1;LW(26,113)=1;
    LW(26,114)=1;LW(26,115)=1;LW(26,116)=1;LW(26,117)=1;LW(26,118)=1;LW(26,119)=1;LW(26,120)=1;LW(26,121)=1;LW(26,122)=1;LW(26,123)=1;
    LW(26,124)=1;LW(26,125)=1;LW(26,126)=1;LW(26,127)=1;LW(26,128)=1;LW(26,129)=1;LW(26,130)=1;LW(26,131)=1;LW(26,132)=1;LW(26,133)=1;
    LW(26,134)=1;LW(26,135)=1;LW(26,136)=1;LW(26,137)=1;LW(26,138)=1;LW(26,139)=1;LW(26,140)=1;LW(26,141)=1;LW(26,142)=1;LW(26,143)=1;
    LW(26,144)=1;LW(26,145)=1;LW(26,146)=1;LW(26,147)=1;LW(26,148)=1;LW(26,149)=1;LW(26,150)=1;LW(26,151)=1;LW(26,152)=1;LW(26,153)=1;
    LW(26,154)=1;LW(26,155)=1;LW(26,156)=1;LW(26,157)=1;LW(26,158)=1;LW(26,159)=1;LW(26,160)=1;LW(26,161)=1;LW(26,162)=1;LW(26,163)=1;
    LW(26,164)=1;LW(26,165)=1;LW(26,166)=1;LW(26,167)=1;LW(26,168)=1;LW(26,169)=1;LW(26,170)=1;LW(26,171)=1;LW(26,172)=1;LW(26,173)=1;
    LW(27,1)=1;LW(27,2)=1;LW(27,3)=1;LW(27,4)=1;LW(27,5)=1;LW(27,6)=1;LW(27,7)=1;LW(27,8)=1;LW(27,9)=1;LW(27,10)=1;
    LW(27,11)=1;LW(27,12)=1;LW(27,13)=1;LW(27,14)=1;LW(27,15)=1;LW(27,16)=1;LW(27,17)=1;LW(27,18)=1;LW(27,19)=1;LW(27,20)=1;
    LW(27,21)=1;LW(27,22)=1;LW(27,23)=1;LW(27,24)=1;LW(27,25)=1;LW(27,26)=1;LW(27,27)=1;LW(27,28)=1;LW(27,29)=1;LW(27,30)=1;
    LW(27,31)=1;LW(27,32)=1;LW(27,33)=1;LW(27,34)=1;LW(27,35)=1;LW(27,36)=1;LW(27,37)=1;LW(27,38)=1;LW(27,39)=1;LW(27,40)=1;
    LW(27,41)=1;LW(27,42)=1;LW(27,43)=1;LW(27,44)=1;LW(27,45)=1;LW(27,46)=1;LW(27,47)=1;LW(27,48)=1;LW(27,49)=1;LW(27,50)=1;
    LW(27,51)=1;LW(27,52)=1;LW(27,53)=1;LW(27,54)=1;LW(27,55)=1;LW(27,56)=1;LW(27,57)=1;LW(27,58)=1;LW(27,59)=1;LW(27,60)=1;
    LW(27,61)=1;LW(27,62)=1;LW(27,63)=1;LW(27,64)=1;LW(27,65)=1;LW(27,66)=1;LW(27,67)=1;LW(27,68)=1;LW(27,69)=1;LW(27,70)=1;
    LW(27,71)=1;LW(27,72)=1;LW(27,73)=1;LW(27,74)=1;LW(27,75)=1;LW(27,76)=1;LW(27,77)=1;LW(27,78)=1;LW(27,79)=1;LW(27,80)=1;
    LW(27,81)=1;LW(27,82)=1;LW(27,83)=1;LW(27,84)=1;LW(27,85)=1;LW(27,86)=1;LW(27,87)=1;LW(27,88)=1;LW(27,89)=1;LW(27,90)=1;
    LW(27,91)=1;LW(27,92)=1;LW(27,93)=1;LW(27,94)=1;LW(27,95)=1;LW(27,96)=1;LW(27,97)=1;LW(27,98)=1;LW(27,99)=1;LW(27,100)=1;
    LW(27,101)=1;LW(27,102)=1;LW(27,103)=1;LW(27,104)=1;LW(27,105)=1;LW(27,106)=1;LW(27,107)=1;LW(27,108)=1;LW(27,109)=1;LW(27,110)=1;
    LW(27,111)=1;LW(27,112)=1;LW(27,113)=1;LW(27,114)=1;LW(27,115)=1;LW(27,116)=1;LW(27,117)=1;LW(27,118)=1;LW(27,119)=1;LW(27,120)=1;
    LW(27,121)=1;LW(27,122)=1;LW(27,123)=1;LW(27,124)=1;LW(27,125)=1;LW(27,126)=1;LW(27,127)=1;LW(27,128)=1;LW(27,129)=1;LW(27,130)=1;
    LW(27,131)=1;LW(27,132)=1;LW(27,133)=1;LW(27,134)=1;LW(27,135)=1;LW(27,136)=1;LW(27,137)=1;LW(27,138)=1;LW(27,139)=1;LW(27,140)=1;
    LW(27,141)=1;LW(27,142)=1;LW(27,143)=1;LW(27,144)=1;LW(27,145)=1;LW(27,146)=1;LW(27,147)=1;LW(27,148)=1;LW(27,149)=1;LW(27,150)=1;
    LW(27,151)=1;LW(27,152)=1;LW(27,153)=1;LW(27,154)=1;LW(27,155)=1;LW(27,156)=1;LW(27,157)=1;LW(27,158)=1;LW(27,159)=1;LW(27,160)=1;
    LW(27,161)=1;LW(27,162)=1;LW(27,163)=1;LW(27,164)=1;LW(27,165)=1;LW(27,166)=1;LW(27,167)=1;LW(27,168)=1;LW(27,169)=1;LW(27,170)=1;
    LW(27,171)=1;LW(27,172)=1;LW(27,173)=1;LW(27,174)=1;LW(27,175)=1;LW(27,177)=1;LW(27,178)=1;LW(27,179)=1;LW(27,180)=1;LW(27,181)=1;
    LW(27,182)=1;LW(27,184)=1;LW(27,185)=1;LW(27,186)=1;LW(28,1)=1;LW(28,2)=1;LW(28,3)=1;LW(28,4)=1;LW(28,5)=1;LW(28,6)=1;
    LW(28,7)=1;LW(28,8)=1;LW(28,9)=1;LW(28,10)=1;LW(28,11)=1;LW(28,12)=1;LW(28,13)=1;LW(28,14)=1;LW(28,15)=1;LW(28,16)=1;
    LW(28,17)=1;LW(28,18)=1;LW(28,19)=1;LW(28,20)=1;LW(28,21)=1;LW(28,22)=1;LW(28,23)=1;LW(28,24)=1;LW(28,25)=1;LW(28,26)=1;
    LW(28,27)=1;LW(28,28)=1;LW(28,29)=1;LW(28,30)=1;LW(28,31)=1;LW(28,32)=1;LW(28,33)=1;LW(28,34)=1;LW(28,35)=1;LW(28,36)=1;
    LW(28,37)=1;LW(28,38)=1;LW(28,39)=1;LW(28,40)=1;LW(28,41)=1;LW(28,42)=1;LW(28,43)=1;LW(28,44)=1;LW(28,45)=1;LW(28,46)=1;
    LW(28,47)=1;LW(28,48)=1;LW(28,49)=1;LW(28,50)=1;LW(28,51)=1;LW(28,52)=1;LW(28,53)=1;LW(28,54)=1;LW(28,55)=1;LW(28,56)=1;
    LW(28,57)=1;LW(28,58)=1;LW(28,59)=1;LW(28,60)=1;LW(28,61)=1;LW(28,62)=1;LW(28,63)=1;LW(28,64)=1;LW(28,65)=1;LW(28,66)=1;
    LW(28,67)=1;LW(28,68)=1;LW(28,69)=1;LW(28,70)=1;LW(28,71)=1;LW(28,72)=1;LW(28,73)=1;LW(28,74)=1;LW(28,75)=1;LW(28,76)=1;
    LW(28,77)=1;LW(28,78)=1;LW(28,79)=1;LW(28,80)=1;LW(28,81)=1;LW(28,82)=1;LW(28,83)=1;LW(28,84)=1;LW(28,85)=1;LW(28,86)=1;
    LW(28,87)=1;LW(28,88)=1;LW(28,89)=1;LW(28,90)=1;LW(28,91)=1;LW(28,92)=1;LW(28,93)=1;LW(28,94)=1;LW(28,95)=1;LW(28,96)=1;
    LW(28,97)=1;LW(28,98)=1;LW(28,99)=1;LW(28,100)=1;LW(28,101)=1;LW(28,102)=1;LW(28,103)=1;LW(28,104)=1;LW(28,105)=1;LW(28,106)=1;
    LW(28,107)=1;LW(28,108)=1;LW(28,109)=1;LW(28,110)=1;LW(28,111)=1;LW(28,112)=1;LW(28,113)=1;LW(28,114)=1;LW(28,115)=1;LW(28,116)=1;
    LW(28,117)=1;LW(28,118)=1;LW(28,119)=1;LW(28,120)=1;LW(28,121)=1;LW(28,122)=1;LW(28,123)=1;LW(28,124)=1;LW(28,125)=1;LW(28,126)=1;
    LW(28,127)=1;LW(28,128)=1;LW(28,129)=1;LW(28,130)=1;LW(28,131)=1;LW(28,132)=1;LW(28,133)=1;LW(28,134)=1;LW(28,135)=1;LW(28,136)=1;
    LW(28,137)=1;LW(28,138)=1;LW(28,139)=1;LW(28,140)=1;LW(28,141)=1;LW(28,142)=1;LW(28,143)=1;LW(28,144)=1;LW(28,145)=1;LW(28,146)=1;
    LW(28,147)=1;LW(28,148)=1;LW(28,149)=1;LW(28,150)=1;LW(28,151)=1;LW(28,152)=1;LW(28,153)=1;LW(28,154)=1;LW(28,155)=1;LW(28,156)=1;
    LW(28,157)=1;LW(28,158)=1;LW(28,159)=1;LW(28,160)=1;LW(28,161)=1;LW(28,162)=1;LW(28,163)=1;LW(28,164)=1;LW(28,165)=1;LW(28,166)=1;
    LW(28,167)=1;LW(28,168)=1;LW(28,169)=1;LW(28,170)=1;LW(28,171)=1;LW(28,172)=1;LW(28,173)=1;LW(28,174)=1;LW(28,175)=1;LW(28,176)=1;
    LW(28,177)=1;LW(28,178)=1;LW(28,179)=1;LW(28,180)=1;LW(28,181)=1;LW(28,182)=1;LW(28,183)=1;LW(28,184)=1;LW(28,185)=1;LW(28,186)=1;
    LW(28,187)=1;LW(28,188)=1;LW(28,191)=1;LW(28,192)=1;LW(28,193)=1;LW(29,1)=1;LW(29,2)=1;LW(29,3)=1;LW(29,4)=1;LW(29,5)=1;
    LW(29,6)=1;LW(29,7)=1;LW(29,8)=1;LW(29,9)=1;LW(29,10)=1;LW(29,11)=1;LW(29,12)=1;LW(29,13)=1;LW(29,14)=1;LW(29,15)=1;
    LW(29,16)=1;LW(29,17)=1;LW(29,18)=1;LW(29,19)=1;LW(29,20)=1;LW(29,21)=1;LW(29,22)=1;LW(29,23)=1;LW(29,24)=1;LW(29,25)=1;
    LW(29,26)=1;LW(29,27)=1;LW(29,28)=1;LW(29,29)=1;LW(29,30)=1;LW(29,31)=1;LW(29,32)=1;LW(29,33)=1;LW(29,34)=1;LW(29,35)=1;
    LW(29,36)=1;LW(29,37)=1;LW(29,38)=1;LW(29,39)=1;LW(29,40)=1;LW(29,41)=1;LW(29,42)=1;LW(29,43)=1;LW(29,44)=1;LW(29,45)=1;
    LW(29,46)=1;LW(29,47)=1;LW(29,48)=1;LW(29,49)=1;LW(29,50)=1;LW(29,51)=1;LW(29,52)=1;LW(29,53)=1;LW(29,54)=1;LW(29,55)=1;
    LW(29,56)=1;LW(29,57)=1;LW(29,58)=1;LW(29,59)=1;LW(29,60)=1;LW(29,61)=1;LW(29,62)=1;LW(29,63)=1;LW(29,64)=1;LW(29,65)=1;
    LW(29,66)=1;LW(29,67)=1;LW(29,68)=1;LW(29,69)=1;LW(29,70)=1;LW(29,71)=1;LW(29,72)=1;LW(29,73)=1;LW(29,74)=1;LW(29,75)=1;
    LW(29,76)=1;LW(29,77)=1;LW(29,78)=1;LW(29,79)=1;LW(29,80)=1;LW(29,81)=1;LW(29,82)=1;LW(29,83)=1;LW(29,84)=1;LW(29,85)=1;
    LW(29,86)=1;LW(29,87)=1;LW(29,88)=1;LW(29,89)=1;LW(29,90)=1;LW(29,91)=1;LW(29,92)=1;LW(29,93)=1;LW(29,94)=1;LW(29,95)=1;
    LW(29,96)=1;LW(29,97)=1;LW(29,98)=1;LW(29,99)=1;LW(29,100)=1;LW(29,101)=1;LW(29,102)=1;LW(29,103)=1;LW(29,104)=1;LW(29,105)=1;
    LW(29,106)=1;LW(29,107)=1;LW(29,108)=1;LW(29,109)=1;LW(29,110)=1;LW(29,111)=1;LW(29,112)=1;LW(29,113)=1;LW(29,114)=1;LW(29,115)=1;
    LW(29,116)=1;LW(29,117)=1;LW(29,118)=1;LW(29,119)=1;LW(29,120)=1;LW(29,121)=1;LW(29,122)=1;LW(29,123)=1;LW(29,124)=1;LW(29,125)=1;
    LW(29,126)=1;LW(29,127)=1;LW(29,128)=1;LW(29,129)=1;LW(29,130)=1;LW(29,131)=1;LW(29,132)=1;LW(29,133)=1;LW(29,134)=1;LW(29,135)=1;
    LW(29,136)=1;LW(29,137)=1;LW(29,138)=1;LW(29,139)=1;LW(29,140)=1;LW(29,141)=1;LW(29,142)=1;LW(29,143)=1;LW(29,144)=1;LW(29,145)=1;
    LW(29,146)=1;LW(29,147)=1;LW(29,148)=1;LW(29,149)=1;LW(29,150)=1;LW(29,151)=1;LW(29,152)=1;LW(29,153)=1;LW(29,154)=1;LW(29,155)=1;
    LW(29,156)=1;LW(29,157)=1;LW(29,158)=1;LW(29,159)=1;LW(29,160)=1;LW(29,161)=1;LW(29,162)=1;LW(29,163)=1;LW(29,164)=1;LW(29,165)=1;
    LW(29,166)=1;LW(29,167)=1;LW(29,168)=1;LW(29,169)=1;LW(29,170)=1;LW(29,171)=1;LW(29,172)=1;LW(29,173)=1;LW(29,174)=1;LW(29,175)=1;
    LW(29,176)=1;LW(29,177)=1;LW(29,178)=1;LW(29,179)=1;LW(29,180)=1;LW(29,181)=1;LW(29,182)=1;LW(29,183)=1;LW(29,184)=1;LW(29,185)=1;
    LW(29,186)=1;LW(29,187)=1;LW(29,188)=1;LW(29,189)=1;LW(29,190)=1;LW(29,191)=1;LW(29,192)=1;LW(29,193)=1;LW(29,194)=1;LW(29,195)=1;
    LW(29,205)=1;LW(29,206)=1;LW(29,207)=1;LW(29,208)=1;LW(30,1)=1;LW(30,2)=1;LW(30,3)=1;LW(30,4)=1;LW(30,5)=1;LW(30,6)=1;
    LW(30,7)=1;LW(30,8)=1;LW(30,10)=1;LW(30,11)=1;LW(30,12)=1;LW(30,13)=1;LW(30,14)=1;LW(30,15)=1;LW(30,16)=1;LW(30,17)=1;
    LW(30,18)=1;LW(30,19)=1;LW(30,20)=1;LW(30,21)=1;LW(30,22)=1;LW(30,23)=1;LW(30,24)=1;LW(30,25)=1;LW(30,26)=1;LW(30,27)=1;
    LW(30,28)=1;LW(30,29)=1;LW(30,30)=1;LW(30,31)=1;LW(30,32)=1;LW(30,33)=1;LW(30,34)=1;LW(30,35)=1;LW(30,36)=1;LW(30,37)=1;
    LW(30,38)=1;LW(30,39)=1;LW(30,40)=1;LW(30,41)=1;LW(30,42)=1;LW(30,43)=1;LW(30,44)=1;LW(30,45)=1;LW(30,46)=1;LW(30,47)=1;
    LW(30,48)=1;LW(30,49)=1;LW(30,50)=1;LW(30,51)=1;LW(30,52)=1;LW(30,53)=1;LW(30,54)=1;LW(30,55)=1;LW(30,56)=1;LW(30,57)=1;
    LW(30,58)=1;LW(30,59)=1;LW(30,60)=1;LW(30,61)=1;LW(30,62)=1;LW(30,63)=1;LW(30,64)=1;LW(30,65)=1;LW(30,66)=1;LW(30,67)=1;
    LW(30,68)=1;LW(30,69)=1;LW(30,70)=1;LW(30,71)=1;LW(30,72)=1;LW(30,73)=1;LW(30,74)=1;LW(30,75)=1;LW(30,76)=1;LW(30,77)=1;
    LW(30,78)=1;LW(30,79)=1;LW(30,80)=1;LW(30,81)=1;LW(30,82)=1;LW(30,83)=1;LW(30,84)=1;LW(30,85)=1;LW(30,86)=1;LW(30,87)=1;
    LW(30,88)=1;LW(30,89)=1;LW(30,90)=1;LW(30,91)=1;LW(30,92)=1;LW(30,93)=1;LW(30,94)=1;LW(30,95)=1;LW(30,96)=1;LW(30,97)=1;
    LW(30,98)=1;LW(30,99)=1;LW(30,100)=1;LW(30,101)=1;LW(30,102)=1;LW(30,103)=1;LW(30,104)=1;LW(30,105)=1;LW(30,106)=1;LW(30,107)=1;
    LW(30,108)=1;LW(30,109)=1;LW(30,110)=1;LW(30,111)=1;LW(30,112)=1;LW(30,113)=1;LW(30,114)=1;LW(30,115)=1;LW(30,116)=1;LW(30,117)=1;
    LW(30,118)=1;LW(30,119)=1;LW(30,120)=1;LW(30,121)=1;LW(30,122)=1;LW(30,123)=1;LW(30,124)=1;LW(30,125)=1;LW(30,126)=1;LW(30,127)=1;
    LW(30,128)=1;LW(30,129)=1;LW(30,130)=1;LW(30,131)=1;LW(30,132)=1;LW(30,133)=1;LW(30,134)=1;LW(30,135)=1;LW(30,136)=1;LW(30,137)=1;
    LW(30,138)=1;LW(30,139)=1;LW(30,140)=1;LW(30,141)=1;LW(30,142)=1;LW(30,143)=1;LW(30,144)=1;LW(30,145)=1;LW(30,146)=1;LW(30,147)=1;
    LW(30,148)=1;LW(30,149)=1;LW(30,150)=1;LW(30,151)=1;LW(30,152)=1;LW(30,153)=1;LW(30,154)=1;LW(30,155)=1;LW(30,156)=1;LW(30,157)=1;
    LW(30,158)=1;LW(30,159)=1;LW(30,160)=1;LW(30,161)=1;LW(30,162)=1;LW(30,163)=1;LW(30,164)=1;LW(30,165)=1;LW(30,166)=1;LW(30,167)=1;
    LW(30,168)=1;LW(30,169)=1;LW(30,170)=1;LW(30,171)=1;LW(30,172)=1;LW(30,173)=1;LW(30,174)=1;LW(30,175)=1;LW(30,176)=1;LW(30,177)=1;
    LW(30,178)=1;LW(30,179)=1;LW(30,180)=1;LW(30,181)=1;LW(30,182)=1;LW(30,183)=1;LW(30,184)=1;LW(30,185)=1;LW(30,186)=1;LW(30,187)=1;
    LW(30,188)=1;LW(30,189)=1;LW(30,190)=1;LW(30,191)=1;LW(30,192)=1;LW(30,193)=1;LW(30,194)=1;LW(30,195)=1;LW(30,196)=1;LW(30,199)=1;
    LW(30,200)=1;LW(30,201)=1;LW(30,202)=1;LW(30,203)=1;LW(30,204)=1;LW(30,205)=1;LW(30,206)=1;LW(30,207)=1;LW(30,208)=1;LW(30,209)=1;
    LW(31,1)=1;LW(31,2)=1;LW(31,3)=1;LW(31,4)=1;LW(31,5)=1;LW(31,6)=1;LW(31,7)=1;LW(31,8)=1;LW(31,11)=1;LW(31,12)=1;
    LW(31,13)=1;LW(31,14)=1;LW(31,15)=1;LW(31,16)=1;LW(31,17)=1;LW(31,18)=1;LW(31,19)=1;LW(31,20)=1;LW(31,21)=1;LW(31,22)=1;
    LW(31,23)=1;LW(31,24)=1;LW(31,25)=1;LW(31,26)=1;LW(31,27)=1;LW(31,28)=1;LW(31,29)=1;LW(31,30)=1;LW(31,31)=1;LW(31,32)=1;
    LW(31,33)=1;LW(31,34)=1;LW(31,35)=1;LW(31,36)=1;LW(31,37)=1;LW(31,38)=1;LW(31,39)=1;LW(31,40)=1;LW(31,41)=1;LW(31,42)=1;
    LW(31,43)=1;LW(31,44)=1;LW(31,45)=1;LW(31,46)=1;LW(31,47)=1;LW(31,48)=1;LW(31,49)=1;LW(31,50)=1;LW(31,51)=1;LW(31,52)=1;
    LW(31,53)=1;LW(31,54)=1;LW(31,55)=1;LW(31,56)=1;LW(31,57)=1;LW(31,58)=1;LW(31,59)=1;LW(31,60)=1;LW(31,61)=1;LW(31,62)=1;
    LW(31,63)=1;LW(31,64)=1;LW(31,65)=1;LW(31,66)=1;LW(31,67)=1;LW(31,68)=1;LW(31,69)=1;LW(31,70)=1;LW(31,71)=1;LW(31,72)=1;
    LW(31,73)=1;LW(31,74)=1;LW(31,75)=1;LW(31,76)=1;LW(31,77)=1;LW(31,78)=1;LW(31,79)=1;LW(31,80)=1;LW(31,81)=1;LW(31,82)=1;
    LW(31,83)=1;LW(31,84)=1;LW(31,85)=1;LW(31,86)=1;LW(31,87)=1;LW(31,88)=1;LW(31,89)=1;LW(31,90)=1;LW(31,91)=1;LW(31,92)=1;
    LW(31,94)=1;LW(31,95)=1;LW(31,96)=1;LW(31,97)=1;LW(31,98)=1;LW(31,99)=1;LW(31,100)=1;LW(31,101)=1;LW(31,102)=1;LW(31,103)=1;
    LW(31,104)=1;LW(31,105)=1;LW(31,106)=1;LW(31,107)=1;LW(31,108)=1;LW(31,109)=1;LW(31,110)=1;LW(31,111)=1;LW(31,112)=1;LW(31,113)=1;
    LW(31,114)=1;LW(31,115)=1;LW(31,116)=1;LW(31,117)=1;LW(31,118)=1;LW(31,119)=1;LW(31,120)=1;LW(31,121)=1;LW(31,122)=1;LW(31,123)=1;
    LW(31,124)=1;LW(31,125)=1;LW(31,126)=1;LW(31,127)=1;LW(31,128)=1;LW(31,129)=1;LW(31,130)=1;LW(31,131)=1;LW(31,132)=1;LW(31,133)=1;
    LW(31,134)=1;LW(31,135)=1;LW(31,136)=1;LW(31,137)=1;LW(31,138)=1;LW(31,139)=1;LW(31,140)=1;LW(31,141)=1;LW(31,142)=1;LW(31,143)=1;
    LW(31,144)=1;LW(31,145)=1;LW(31,146)=1;LW(31,147)=1;LW(31,148)=1;LW(31,149)=1;LW(31,150)=1;LW(31,151)=1;LW(31,152)=1;LW(31,153)=1;
    LW(31,154)=1;LW(31,155)=1;LW(31,156)=1;LW(31,157)=1;LW(31,158)=1;LW(31,159)=1;LW(31,160)=1;LW(31,161)=1;LW(31,162)=1;LW(31,163)=1;
    LW(31,164)=1;LW(31,165)=1;LW(31,166)=1;LW(31,167)=1;LW(31,168)=1;LW(31,169)=1;LW(31,170)=1;LW(31,171)=1;LW(31,172)=1;LW(31,173)=1;
    LW(31,174)=1;LW(31,175)=1;LW(31,176)=1;LW(31,177)=1;LW(31,178)=1;LW(31,179)=1;LW(31,180)=1;LW(31,181)=1;LW(31,182)=1;LW(31,183)=1;
    LW(31,184)=1;LW(31,185)=1;LW(31,186)=1;LW(31,187)=1;LW(31,188)=1;LW(31,189)=1;LW(31,190)=1;LW(31,191)=1;LW(31,192)=1;LW(31,193)=1;
    LW(31,194)=1;LW(31,195)=1;LW(31,196)=1;LW(31,197)=1;LW(31,198)=1;LW(31,199)=1;LW(31,200)=1;LW(31,201)=1;LW(31,202)=1;LW(31,203)=1;
    LW(31,204)=1;LW(31,205)=1;LW(31,206)=1;LW(31,207)=1;LW(31,208)=1;LW(31,209)=1;LW(31,210)=1;LW(31,211)=1;LW(31,213)=1;LW(31,214)=1;
    LW(31,215)=1;LW(31,216)=1;LW(32,1)=1;LW(32,2)=1;LW(32,3)=1;LW(32,4)=1;LW(32,5)=1;LW(32,6)=1;LW(32,7)=1;LW(32,11)=1;
    LW(32,12)=1;LW(32,13)=1;LW(32,14)=1;LW(32,15)=1;LW(32,16)=1;LW(32,17)=1;LW(32,18)=1;LW(32,19)=1;LW(32,20)=1;LW(32,21)=1;
    LW(32,22)=1;LW(32,23)=1;LW(32,24)=1;LW(32,25)=1;LW(32,26)=1;LW(32,27)=1;LW(32,28)=1;LW(32,29)=1;LW(32,30)=1;LW(32,31)=1;
    LW(32,32)=1;LW(32,33)=1;LW(32,34)=1;LW(32,35)=1;LW(32,36)=1;LW(32,37)=1;LW(32,38)=1;LW(32,39)=1;LW(32,40)=1;LW(32,41)=1;
    LW(32,42)=1;LW(32,43)=1;LW(32,44)=1;LW(32,45)=1;LW(32,46)=1;LW(32,47)=1;LW(32,48)=1;LW(32,49)=1;LW(32,50)=1;LW(32,51)=1;
    LW(32,52)=1;LW(32,53)=1;LW(32,54)=1;LW(32,55)=1;LW(32,56)=1;LW(32,57)=1;LW(32,58)=1;LW(32,59)=1;LW(32,60)=1;LW(32,61)=1;
    LW(32,62)=1;LW(32,63)=1;LW(32,64)=1;LW(32,65)=1;LW(32,66)=1;LW(32,67)=1;LW(32,68)=1;LW(32,69)=1;LW(32,70)=1;LW(32,71)=1;
    LW(32,72)=1;LW(32,73)=1;LW(32,74)=1;LW(32,75)=1;LW(32,76)=1;LW(32,77)=1;LW(32,78)=1;LW(32,79)=1;LW(32,80)=1;LW(32,81)=1;
    LW(32,82)=1;LW(32,83)=1;LW(32,84)=1;LW(32,85)=1;LW(32,86)=1;LW(32,87)=1;LW(32,88)=1;LW(32,89)=1;LW(32,90)=1;LW(32,91)=1;
    LW(32,92)=1;LW(32,93)=1;LW(32,94)=1;LW(32,95)=1;LW(32,96)=1;LW(32,97)=1;LW(32,98)=1;LW(32,99)=1;LW(32,100)=1;LW(32,101)=1;
    LW(32,102)=1;LW(32,103)=1;LW(32,104)=1;LW(32,105)=1;LW(32,106)=1;LW(32,107)=1;LW(32,108)=1;LW(32,109)=1;LW(32,110)=1;LW(32,111)=1;
    LW(32,112)=1;LW(32,113)=1;LW(32,114)=1;LW(32,115)=1;LW(32,116)=1;LW(32,117)=1;LW(32,118)=1;LW(32,119)=1;LW(32,120)=1;LW(32,121)=1;
    LW(32,122)=1;LW(32,123)=1;LW(32,124)=1;LW(32,125)=1;LW(32,126)=1;LW(32,127)=1;LW(32,128)=1;LW(32,129)=1;LW(32,130)=1;LW(32,131)=1;
    LW(32,132)=1;LW(32,133)=1;LW(32,134)=1;LW(32,135)=1;LW(32,136)=1;LW(32,137)=1;LW(32,138)=1;LW(32,139)=1;LW(32,140)=1;LW(32,141)=1;
    LW(32,142)=1;LW(32,143)=1;LW(32,144)=1;LW(32,145)=1;LW(32,146)=1;LW(32,147)=1;LW(32,148)=1;LW(32,149)=1;LW(32,150)=1;LW(32,151)=1;
    LW(32,152)=1;LW(32,153)=1;LW(32,154)=1;LW(32,155)=1;LW(32,156)=1;LW(32,157)=1;LW(32,158)=1;LW(32,159)=1;LW(32,160)=1;LW(32,161)=1;
    LW(32,162)=1;LW(32,163)=1;LW(32,164)=1;LW(32,165)=1;LW(32,166)=1;LW(32,167)=1;LW(32,168)=1;LW(32,169)=1;LW(32,170)=1;LW(32,171)=1;
    LW(32,172)=1;LW(32,173)=1;LW(32,174)=1;LW(32,175)=1;LW(32,176)=1;LW(32,177)=1;LW(32,178)=1;LW(32,179)=1;LW(32,180)=1;LW(32,181)=1;
    LW(32,182)=1;LW(32,183)=1;LW(32,184)=1;LW(32,185)=1;LW(32,186)=1;LW(32,187)=1;LW(32,188)=1;LW(32,189)=1;LW(32,190)=1;LW(32,191)=1;
    LW(32,192)=1;LW(32,193)=1;LW(32,194)=1;LW(32,195)=1;LW(32,196)=1;LW(32,197)=1;LW(32,198)=1;LW(32,199)=1;LW(32,200)=1;LW(32,201)=1;
    LW(32,202)=1;LW(32,203)=1;LW(32,204)=1;LW(32,205)=1;LW(32,206)=1;LW(32,207)=1;LW(32,208)=1;LW(32,209)=1;LW(32,210)=1;LW(32,211)=1;
    LW(32,212)=1;LW(32,213)=1;LW(32,214)=1;LW(32,215)=1;LW(32,216)=1;LW(32,217)=1;LW(33,1)=1;LW(33,2)=1;LW(33,3)=1;LW(33,4)=1;
    LW(33,5)=1;LW(33,6)=1;LW(33,7)=1;LW(33,11)=1;LW(33,12)=1;LW(33,13)=1;LW(33,14)=1;LW(33,15)=1;LW(33,16)=1;LW(33,17)=1;
    LW(33,18)=1;LW(33,19)=1;LW(33,20)=1;LW(33,21)=1;LW(33,22)=1;LW(33,23)=1;LW(33,24)=1;LW(33,25)=1;LW(33,26)=1;LW(33,27)=1;
    LW(33,28)=1;LW(33,29)=1;LW(33,30)=1;LW(33,31)=1;LW(33,32)=1;LW(33,33)=1;LW(33,34)=1;LW(33,35)=1;LW(33,36)=1;LW(33,37)=1;
    LW(33,38)=1;LW(33,39)=1;LW(33,40)=1;LW(33,41)=1;LW(33,42)=1;LW(33,43)=1;LW(33,44)=1;LW(33,45)=1;LW(33,46)=1;LW(33,47)=1;
    LW(33,48)=1;LW(33,49)=1;LW(33,50)=1;LW(33,51)=1;LW(33,52)=1;LW(33,53)=1;LW(33,54)=1;LW(33,55)=1;LW(33,56)=1;LW(33,57)=1;
    LW(33,58)=1;LW(33,59)=1;LW(33,60)=1;LW(33,61)=1;LW(33,62)=1;LW(33,63)=1;LW(33,64)=1;LW(33,65)=1;LW(33,66)=1;LW(33,67)=1;
    LW(33,68)=1;LW(33,69)=1;LW(33,70)=1;LW(33,71)=1;LW(33,72)=1;LW(33,73)=1;LW(33,74)=1;LW(33,75)=1;LW(33,76)=1;LW(33,77)=1;
    LW(33,78)=1;LW(33,79)=1;LW(33,80)=1;LW(33,81)=1;LW(33,82)=1;LW(33,83)=1;LW(33,84)=1;LW(33,85)=1;LW(33,86)=1;LW(33,87)=1;
    LW(33,88)=1;LW(33,89)=1;LW(33,90)=1;LW(33,91)=1;LW(33,92)=1;LW(33,93)=1;LW(33,94)=1;LW(33,95)=1;LW(33,96)=1;LW(33,97)=1;
    LW(33,98)=1;LW(33,99)=1;LW(33,100)=1;LW(33,101)=1;LW(33,102)=1;LW(33,103)=1;LW(33,104)=1;LW(33,105)=1;LW(33,106)=1;LW(33,107)=1;
    LW(33,108)=1;LW(33,109)=1;LW(33,110)=1;LW(33,111)=1;LW(33,112)=1;LW(33,113)=1;LW(33,114)=1;LW(33,115)=1;LW(33,116)=1;LW(33,117)=1;
    LW(33,118)=1;LW(33,119)=1;LW(33,120)=1;LW(33,121)=1;LW(33,122)=1;LW(33,123)=1;LW(33,124)=1;LW(33,125)=1;LW(33,126)=1;LW(33,127)=1;
    LW(33,128)=1;LW(33,129)=1;LW(33,130)=1;LW(33,131)=1;LW(33,132)=1;LW(33,133)=1;LW(33,134)=1;LW(33,135)=1;LW(33,136)=1;LW(33,137)=1;
    LW(33,138)=1;LW(33,139)=1;LW(33,140)=1;LW(33,141)=1;LW(33,142)=1;LW(33,143)=1;LW(33,144)=1;LW(33,145)=1;LW(33,146)=1;LW(33,147)=1;
    LW(33,148)=1;LW(33,149)=1;LW(33,150)=1;LW(33,151)=1;LW(33,152)=1;LW(33,153)=1;LW(33,154)=1;LW(33,155)=1;LW(33,156)=1;LW(33,157)=1;
    LW(33,158)=1;LW(33,159)=1;LW(33,160)=1;LW(33,161)=1;LW(33,162)=1;LW(33,163)=1;LW(33,164)=1;LW(33,165)=1;LW(33,166)=1;LW(33,167)=1;
    LW(33,168)=1;LW(33,169)=1;LW(33,170)=1;LW(33,171)=1;LW(33,172)=1;LW(33,173)=1;LW(33,174)=1;LW(33,175)=1;LW(33,176)=1;LW(33,177)=1;
    LW(33,178)=1;LW(33,179)=1;LW(33,180)=1;LW(33,181)=1;LW(33,182)=1;LW(33,183)=1;LW(33,184)=1;LW(33,185)=1;LW(33,186)=1;LW(33,187)=1;
    LW(33,188)=1;LW(33,189)=1;LW(33,190)=1;LW(33,191)=1;LW(33,192)=1;LW(33,193)=1;LW(33,194)=1;LW(33,195)=1;LW(33,196)=1;LW(33,197)=1;
    LW(33,198)=1;LW(33,199)=1;LW(33,200)=1;LW(33,201)=1;LW(33,202)=1;LW(33,203)=1;LW(33,204)=1;LW(33,205)=1;LW(33,206)=1;LW(33,207)=1;
    LW(33,208)=1;LW(33,209)=1;LW(33,210)=1;LW(33,211)=1;LW(33,212)=1;LW(33,213)=1;LW(33,214)=1;LW(33,215)=1;LW(33,216)=1;LW(33,217)=1;
    LW(34,1)=1;LW(34,2)=1;LW(34,3)=1;LW(34,4)=1;LW(34,5)=1;LW(34,6)=1;LW(34,11)=1;LW(34,12)=1;LW(34,13)=1;LW(34,14)=1;
    LW(34,15)=1;LW(34,16)=1;LW(34,17)=1;LW(34,18)=1;LW(34,19)=1;LW(34,20)=1;LW(34,21)=1;LW(34,22)=1;LW(34,23)=1;LW(34,24)=1;
    LW(34,25)=1;LW(34,26)=1;LW(34,27)=1;LW(34,28)=1;LW(34,29)=1;LW(34,30)=1;LW(34,31)=1;LW(34,32)=1;LW(34,33)=1;LW(34,34)=1;
    LW(34,35)=1;LW(34,36)=1;LW(34,37)=1;LW(34,38)=1;LW(34,39)=1;LW(34,40)=1;LW(34,41)=1;LW(34,42)=1;LW(34,43)=1;LW(34,44)=1;
    LW(34,45)=1;LW(34,46)=1;LW(34,47)=1;LW(34,48)=1;LW(34,49)=1;LW(34,50)=1;LW(34,51)=1;LW(34,52)=1;LW(34,53)=1;LW(34,54)=1;
    LW(34,55)=1;LW(34,56)=1;LW(34,57)=1;LW(34,58)=1;LW(34,59)=1;LW(34,60)=1;LW(34,61)=1;LW(34,62)=1;LW(34,63)=1;LW(34,64)=1;
    LW(34,65)=1;LW(34,66)=1;LW(34,67)=1;LW(34,68)=1;LW(34,69)=1;LW(34,70)=1;LW(34,71)=1;LW(34,72)=1;LW(34,73)=1;LW(34,74)=1;
    LW(34,75)=1;LW(34,76)=1;LW(34,77)=1;LW(34,78)=1;LW(34,79)=1;LW(34,80)=1;LW(34,81)=1;LW(34,82)=1;LW(34,83)=1;LW(34,84)=1;
    LW(34,85)=1;LW(34,86)=1;LW(34,87)=1;LW(34,88)=1;LW(34,89)=1;LW(34,90)=1;LW(34,91)=1;LW(34,92)=1;LW(34,93)=1;LW(34,94)=1;
    LW(34,95)=1;LW(34,96)=1;LW(34,97)=1;LW(34,98)=1;LW(34,99)=1;LW(34,100)=1;LW(34,101)=1;LW(34,102)=1;LW(34,103)=1;LW(34,104)=1;
    LW(34,105)=1;LW(34,106)=1;LW(34,107)=1;LW(34,108)=1;LW(34,109)=1;LW(34,110)=1;LW(34,111)=1;LW(34,112)=1;LW(34,113)=1;LW(34,114)=1;
    LW(34,115)=1;LW(34,117)=1;LW(34,118)=1;LW(34,119)=1;LW(34,120)=1;LW(34,121)=1;LW(34,122)=1;LW(34,123)=1;LW(34,124)=1;LW(34,125)=1;
    LW(34,126)=1;LW(34,127)=1;LW(34,128)=1;LW(34,129)=1;LW(34,130)=1;LW(34,131)=1;LW(34,132)=1;LW(34,133)=1;LW(34,134)=1;LW(34,135)=1;
    LW(34,136)=1;LW(34,137)=1;LW(34,138)=1;LW(34,139)=1;LW(34,140)=1;LW(34,141)=1;LW(34,142)=1;LW(34,143)=1;LW(34,144)=1;LW(34,145)=1;
    LW(34,146)=1;LW(34,147)=1;LW(34,148)=1;LW(34,149)=1;LW(34,150)=1;LW(34,151)=1;LW(34,152)=1;LW(34,153)=1;LW(34,154)=1;LW(34,155)=1;
    LW(34,156)=1;LW(34,157)=1;LW(34,158)=1;LW(34,159)=1;LW(34,160)=1;LW(34,161)=1;LW(34,162)=1;LW(34,163)=1;LW(34,164)=1;LW(34,165)=1;
    LW(34,166)=1;LW(34,167)=1;LW(34,168)=1;LW(34,169)=1;LW(34,170)=1;LW(34,171)=1;LW(34,172)=1;LW(34,173)=1;LW(34,174)=1;LW(34,175)=1;
    LW(34,176)=1;LW(34,177)=1;LW(34,178)=1;LW(34,179)=1;LW(34,180)=1;LW(34,181)=1;LW(34,182)=1;LW(34,183)=1;LW(34,184)=1;LW(34,185)=1;
    LW(34,186)=1;LW(34,187)=1;LW(34,188)=1;LW(34,189)=1;LW(34,190)=1;LW(34,191)=1;LW(34,192)=1;LW(34,193)=1;LW(34,194)=1;LW(34,195)=1;
    LW(34,196)=1;LW(34,197)=1;LW(34,198)=1;LW(34,199)=1;LW(34,200)=1;LW(34,201)=1;LW(34,202)=1;LW(34,203)=1;LW(34,204)=1;LW(34,205)=1;
    LW(34,206)=1;LW(34,207)=1;LW(34,208)=1;LW(34,209)=1;LW(34,210)=1;LW(34,211)=1;LW(34,212)=1;LW(34,213)=1;LW(34,214)=1;LW(34,215)=1;
    LW(34,216)=1;LW(34,217)=1;LW(34,218)=1;LW(34,222)=1;LW(34,223)=1;LW(34,224)=1;LW(34,225)=1;LW(34,226)=1;LW(34,227)=1;LW(35,1)=1;
    LW(35,2)=1;LW(35,3)=1;LW(35,4)=1;LW(35,5)=1;LW(35,6)=1;LW(35,7)=1;LW(35,12)=1;LW(35,13)=1;LW(35,14)=1;LW(35,15)=1;
    LW(35,16)=1;LW(35,17)=1;LW(35,18)=1;LW(35,19)=1;LW(35,20)=1;LW(35,21)=1;LW(35,22)=1;LW(35,23)=1;LW(35,24)=1;LW(35,25)=1;
    LW(35,26)=1;LW(35,27)=1;LW(35,28)=1;LW(35,29)=1;LW(35,30)=1;LW(35,31)=1;LW(35,32)=1;LW(35,33)=1;LW(35,34)=1;LW(35,35)=1;
    LW(35,36)=1;LW(35,37)=1;LW(35,38)=1;LW(35,39)=1;LW(35,40)=1;LW(35,41)=1;LW(35,42)=1;LW(35,43)=1;LW(35,44)=1;LW(35,45)=1;
    LW(35,46)=1;LW(35,47)=1;LW(35,48)=1;LW(35,49)=1;LW(35,50)=1;LW(35,51)=1;LW(35,52)=1;LW(35,53)=1;LW(35,54)=1;LW(35,55)=1;
    LW(35,56)=1;LW(35,57)=1;LW(35,58)=1;LW(35,59)=1;LW(35,60)=1;LW(35,61)=1;LW(35,62)=1;LW(35,63)=1;LW(35,64)=1;LW(35,65)=1;
    LW(35,66)=1;LW(35,67)=1;LW(35,68)=1;LW(35,69)=1;LW(35,70)=1;LW(35,71)=1;LW(35,72)=1;LW(35,73)=1;LW(35,74)=1;LW(35,75)=1;
    LW(35,76)=1;LW(35,77)=1;LW(35,78)=1;LW(35,79)=1;LW(35,80)=1;LW(35,81)=1;LW(35,82)=1;LW(35,83)=1;LW(35,84)=1;LW(35,85)=1;
    LW(35,86)=1;LW(35,87)=1;LW(35,88)=1;LW(35,89)=1;LW(35,90)=1;LW(35,91)=1;LW(35,92)=1;LW(35,93)=1;LW(35,94)=1;LW(35,95)=1;
    LW(35,96)=1;LW(35,97)=1;LW(35,98)=1;LW(35,99)=1;LW(35,100)=1;LW(35,101)=1;LW(35,102)=1;LW(35,103)=1;LW(35,104)=1;LW(35,105)=1;
    LW(35,106)=1;LW(35,107)=1;LW(35,108)=1;LW(35,109)=1;LW(35,110)=1;LW(35,111)=1;LW(35,112)=1;LW(35,113)=1;LW(35,114)=1;LW(35,115)=1;
    LW(35,116)=1;LW(35,119)=1;LW(35,120)=1;LW(35,121)=1;LW(35,122)=1;LW(35,123)=1;LW(35,124)=1;LW(35,125)=1;LW(35,126)=1;LW(35,127)=1;
    LW(35,128)=1;LW(35,129)=1;LW(35,130)=1;LW(35,131)=1;LW(35,132)=1;LW(35,133)=1;LW(35,134)=1;LW(35,135)=1;LW(35,136)=1;LW(35,137)=1;
    LW(35,138)=1;LW(35,139)=1;LW(35,140)=1;LW(35,141)=1;LW(35,142)=1;LW(35,143)=1;LW(35,144)=1;LW(35,145)=1;LW(35,146)=1;LW(35,147)=1;
    LW(35,148)=1;LW(35,149)=1;LW(35,150)=1;LW(35,151)=1;LW(35,152)=1;LW(35,153)=1;LW(35,154)=1;LW(35,155)=1;LW(35,156)=1;LW(35,157)=1;
    LW(35,158)=1;LW(35,159)=1;LW(35,160)=1;LW(35,161)=1;LW(35,162)=1;LW(35,163)=1;LW(35,164)=1;LW(35,165)=1;LW(35,166)=1;LW(35,167)=1;
    LW(35,168)=1;LW(35,169)=1;LW(35,170)=1;LW(35,171)=1;LW(35,172)=1;LW(35,173)=1;LW(35,174)=1;LW(35,175)=1;LW(35,176)=1;LW(35,177)=1;
    LW(35,178)=1;LW(35,179)=1;LW(35,180)=1;LW(35,181)=1;LW(35,182)=1;LW(35,183)=1;LW(35,184)=1;LW(35,185)=1;LW(35,186)=1;LW(35,187)=1;
    LW(35,188)=1;LW(35,189)=1;LW(35,190)=1;LW(35,191)=1;LW(35,192)=1;LW(35,193)=1;LW(35,194)=1;LW(35,195)=1;LW(35,196)=1;LW(35,197)=1;
    LW(35,198)=1;LW(35,199)=1;LW(35,200)=1;LW(35,201)=1;LW(35,202)=1;LW(35,203)=1;LW(35,204)=1;LW(35,205)=1;LW(35,206)=1;LW(35,207)=1;
    LW(35,208)=1;LW(35,209)=1;LW(35,210)=1;LW(35,211)=1;LW(35,212)=1;LW(35,213)=1;LW(35,214)=1;LW(35,215)=1;LW(35,216)=1;LW(35,217)=1;
    LW(35,218)=1;LW(35,219)=1;LW(35,220)=1;LW(35,221)=1;LW(35,222)=1;LW(35,223)=1;LW(35,224)=1;LW(35,225)=1;LW(35,226)=1;LW(35,227)=1;
    LW(35,228)=1;LW(35,229)=1;LW(35,230)=1;LW(35,231)=1;LW(35,234)=1;LW(35,235)=1;LW(35,236)=1;LW(35,238)=1;LW(35,239)=1;LW(36,1)=1;
    LW(36,2)=1;LW(36,3)=1;LW(36,4)=1;LW(36,5)=1;LW(36,6)=1;LW(36,7)=1;LW(36,8)=1;LW(36,9)=1;LW(36,13)=1;LW(36,14)=1;
    LW(36,15)=1;LW(36,16)=1;LW(36,17)=1;LW(36,18)=1;LW(36,23)=1;LW(36,24)=1;LW(36,25)=1;LW(36,26)=1;LW(36,27)=1;LW(36,28)=1;
    LW(36,29)=1;LW(36,30)=1;LW(36,31)=1;LW(36,32)=1;LW(36,33)=1;LW(36,34)=1;LW(36,35)=1;LW(36,36)=1;LW(36,37)=1;LW(36,38)=1;
    LW(36,39)=1;LW(36,40)=1;LW(36,47)=1;LW(36,48)=1;LW(36,49)=1;LW(36,50)=1;LW(36,51)=1;LW(36,52)=1;LW(36,53)=1;LW(36,54)=1;
    LW(36,55)=1;LW(36,56)=1;LW(36,57)=1;LW(36,58)=1;LW(36,59)=1;LW(36,62)=1;LW(36,63)=1;LW(36,64)=1;LW(36,65)=1;LW(36,66)=1;
    LW(36,67)=1;LW(36,68)=1;LW(36,69)=1;LW(36,70)=1;LW(36,72)=1;LW(36,73)=1;LW(36,74)=1;LW(36,75)=1;LW(36,76)=1;LW(36,77)=1;
    LW(36,78)=1;LW(36,79)=1;LW(36,80)=1;LW(36,81)=1;LW(36,84)=1;LW(36,85)=1;LW(36,86)=1;LW(36,87)=1;LW(36,88)=1;LW(36,89)=1;
    LW(36,90)=1;LW(36,93)=1;LW(36,94)=1;LW(36,96)=1;LW(36,97)=1;LW(36,98)=1;LW(36,99)=1;LW(36,100)=1;LW(36,101)=1;LW(36,102)=1;
    LW(36,103)=1;LW(36,104)=1;LW(36,105)=1;LW(36,106)=1;LW(36,107)=1;LW(36,108)=1;LW(36,109)=1;LW(36,110)=1;LW(36,111)=1;LW(36,112)=1;
    LW(36,113)=1;LW(36,114)=1;LW(36,115)=1;LW(36,116)=1;LW(36,120)=1;LW(36,121)=1;LW(36,122)=1;LW(36,123)=1;LW(36,124)=1;LW(36,125)=1;
    LW(36,126)=1;LW(36,127)=1;LW(36,128)=1;LW(36,129)=1;LW(36,130)=1;LW(36,131)=1;LW(36,132)=1;LW(36,133)=1;LW(36,134)=1;LW(36,135)=1;
    LW(36,136)=1;LW(36,137)=1;LW(36,138)=1;LW(36,139)=1;LW(36,140)=1;LW(36,141)=1;LW(36,142)=1;LW(36,143)=1;LW(36,144)=1;LW(36,145)=1;
    LW(36,146)=1;LW(36,147)=1;LW(36,148)=1;LW(36,149)=1;LW(36,150)=1;LW(36,151)=1;LW(36,152)=1;LW(36,153)=1;LW(36,154)=1;LW(36,155)=1;
    LW(36,156)=1;LW(36,157)=1;LW(36,158)=1;LW(36,159)=1;LW(36,160)=1;LW(36,161)=1;LW(36,162)=1;LW(36,163)=1;LW(36,164)=1;LW(36,165)=1;
    LW(36,166)=1;LW(36,167)=1;LW(36,168)=1;LW(36,169)=1;LW(36,170)=1;LW(36,171)=1;LW(36,172)=1;LW(36,173)=1;LW(36,174)=1;LW(36,175)=1;
    LW(36,176)=1;LW(36,177)=1;LW(36,178)=1;LW(36,179)=1;LW(36,180)=1;LW(36,181)=1;LW(36,182)=1;LW(36,183)=1;LW(36,184)=1;LW(36,185)=1;
    LW(36,186)=1;LW(36,187)=1;LW(36,188)=1;LW(36,189)=1;LW(36,190)=1;LW(36,191)=1;LW(36,192)=1;LW(36,193)=1;LW(36,194)=1;LW(36,195)=1;
    LW(36,196)=1;LW(36,197)=1;LW(36,198)=1;LW(36,199)=1;LW(36,200)=1;LW(36,201)=1;LW(36,202)=1;LW(36,203)=1;LW(36,204)=1;LW(36,205)=1;
    LW(36,206)=1;LW(36,207)=1;LW(36,208)=1;LW(36,209)=1;LW(36,210)=1;LW(36,211)=1;LW(36,212)=1;LW(36,213)=1;LW(36,214)=1;LW(36,215)=1;
    LW(36,216)=1;LW(36,217)=1;LW(36,218)=1;LW(36,219)=1;LW(36,220)=1;LW(36,221)=1;LW(36,222)=1;LW(36,223)=1;LW(36,224)=1;LW(36,225)=1;
    LW(36,226)=1;LW(36,227)=1;LW(36,228)=1;LW(36,229)=1;LW(36,230)=1;LW(36,231)=1;LW(36,232)=1;LW(36,233)=1;LW(36,234)=1;LW(36,235)=1;
    LW(36,236)=1;LW(36,237)=1;LW(36,238)=1;LW(36,239)=1;LW(36,240)=1;LW(36,241)=1;LW(36,242)=1;LW(36,243)=1;LW(36,244)=1;LW(36,245)=1;
    LW(36,246)=1;LW(36,247)=1;LW(36,248)=1;LW(36,249)=1;LW(37,3)=1;LW(37,4)=1;LW(37,5)=1;LW(37,6)=1;LW(37,7)=1;LW(37,8)=1;
    LW(37,9)=1;LW(37,10)=1;LW(37,14)=1;LW(37,15)=1;LW(37,16)=1;LW(37,17)=1;LW(37,18)=1;LW(37,23)=1;LW(37,24)=1;LW(37,25)=1;
    LW(37,26)=1;LW(37,27)=1;LW(37,28)=1;LW(37,29)=1;LW(37,30)=1;LW(37,31)=1;LW(37,32)=1;LW(37,33)=1;LW(37,34)=1;LW(37,35)=1;
    LW(37,36)=1;LW(37,37)=1;LW(37,38)=1;LW(37,47)=1;LW(37,48)=1;LW(37,49)=1;LW(37,50)=1;LW(37,51)=1;LW(37,52)=1;LW(37,53)=1;
    LW(37,54)=1;LW(37,55)=1;LW(37,56)=1;LW(37,57)=1;LW(37,63)=1;LW(37,64)=1;LW(37,65)=1;LW(37,66)=1;LW(37,74)=1;LW(37,75)=1;
    LW(37,76)=1;LW(37,77)=1;LW(37,78)=1;LW(37,79)=1;LW(37,80)=1;LW(37,81)=1;LW(37,85)=1;LW(37,86)=1;LW(37,87)=1;LW(37,88)=1;
    LW(37,89)=1;LW(37,90)=1;LW(37,93)=1;LW(37,94)=1;LW(37,99)=1;LW(37,100)=1;LW(37,101)=1;LW(37,102)=1;LW(37,103)=1;LW(37,111)=1;
    LW(37,112)=1;LW(37,113)=1;LW(37,114)=1;LW(37,115)=1;LW(37,116)=1;LW(37,121)=1;LW(37,122)=1;LW(37,123)=1;LW(37,124)=1;LW(37,125)=1;
    LW(37,126)=1;LW(37,127)=1;LW(37,128)=1;LW(37,129)=1;LW(37,130)=1;LW(37,131)=1;LW(37,132)=1;LW(37,133)=1;LW(37,134)=1;LW(37,135)=1;
    LW(37,136)=1;LW(37,137)=1;LW(37,138)=1;LW(37,139)=1;LW(37,140)=1;LW(37,141)=1;LW(37,142)=1;LW(37,143)=1;LW(37,144)=1;LW(37,145)=1;
    LW(37,146)=1;LW(37,147)=1;LW(37,148)=1;LW(37,149)=1;LW(37,150)=1;LW(37,151)=1;LW(37,152)=1;LW(37,153)=1;LW(37,154)=1;LW(37,155)=1;
    LW(37,156)=1;LW(37,157)=1;LW(37,158)=1;LW(37,159)=1;LW(37,160)=1;LW(37,161)=1;LW(37,162)=1;LW(37,163)=1;LW(37,164)=1;LW(37,165)=1;
    LW(37,166)=1;LW(37,167)=1;LW(37,168)=1;LW(37,169)=1;LW(37,170)=1;LW(37,171)=1;LW(37,172)=1;LW(37,173)=1;LW(37,174)=1;LW(37,175)=1;
    LW(37,176)=1;LW(37,177)=1;LW(37,178)=1;LW(37,179)=1;LW(37,180)=1;LW(37,181)=1;LW(37,182)=1;LW(37,183)=1;LW(37,184)=1;LW(37,185)=1;
    LW(37,186)=1;LW(37,187)=1;LW(37,188)=1;LW(37,189)=1;LW(37,190)=1;LW(37,191)=1;LW(37,192)=1;LW(37,193)=1;LW(37,194)=1;LW(37,195)=1;
    LW(37,196)=1;LW(37,197)=1;LW(37,198)=1;LW(37,199)=1;LW(37,200)=1;LW(37,201)=1;LW(37,202)=1;LW(37,203)=1;LW(37,204)=1;LW(37,205)=1;
    LW(37,206)=1;LW(37,207)=1;LW(37,208)=1;LW(37,209)=1;LW(37,210)=1;LW(37,211)=1;LW(37,212)=1;LW(37,213)=1;LW(37,214)=1;LW(37,215)=1;
    LW(37,216)=1;LW(37,217)=1;LW(37,218)=1;LW(37,219)=1;LW(37,220)=1;LW(37,221)=1;LW(37,222)=1;LW(37,223)=1;LW(37,224)=1;LW(37,225)=1;
    LW(37,226)=1;LW(37,227)=1;LW(37,228)=1;LW(37,229)=1;LW(37,230)=1;LW(37,231)=1;LW(37,232)=1;LW(37,233)=1;LW(37,234)=1;LW(37,235)=1;
    LW(37,236)=1;LW(37,237)=1;LW(37,238)=1;LW(37,239)=1;LW(37,240)=1;LW(37,241)=1;LW(37,242)=1;LW(37,243)=1;LW(37,244)=1;LW(37,245)=1;
    LW(37,246)=1;LW(37,247)=1;LW(37,248)=1;LW(37,249)=1;LW(37,250)=1;LW(37,251)=1;LW(38,3)=1;LW(38,4)=1;LW(38,5)=1;LW(38,6)=1;
    LW(38,7)=1;LW(38,8)=1;LW(38,9)=1;LW(38,10)=1;LW(38,13)=1;LW(38,14)=1;LW(38,15)=1;LW(38,16)=1;LW(38,17)=1;LW(38,18)=1;
    LW(38,23)=1;LW(38,24)=1;LW(38,25)=1;LW(38,26)=1;LW(38,27)=1;LW(38,28)=1;LW(38,29)=1;LW(38,30)=1;LW(38,31)=1;LW(38,32)=1;
    LW(38,33)=1;LW(38,34)=1;LW(38,35)=1;LW(38,36)=1;LW(38,37)=1;LW(38,50)=1;LW(38,51)=1;LW(38,52)=1;LW(38,53)=1;LW(38,54)=1;
    LW(38,55)=1;LW(38,56)=1;LW(38,57)=1;LW(38,63)=1;LW(38,64)=1;LW(38,65)=1;LW(38,66)=1;LW(38,75)=1;LW(38,79)=1;LW(38,80)=1;
    LW(38,81)=1;LW(38,84)=1;LW(38,85)=1;LW(38,86)=1;LW(38,87)=1;LW(38,88)=1;LW(38,89)=1;LW(38,99)=1;LW(38,100)=1;LW(38,101)=1;
    LW(38,102)=1;LW(38,112)=1;LW(38,113)=1;LW(38,114)=1;LW(38,115)=1;LW(38,120)=1;LW(38,121)=1;LW(38,122)=1;LW(38,123)=1;LW(38,124)=1;
    LW(38,125)=1;LW(38,126)=1;LW(38,127)=1;LW(38,128)=1;LW(38,129)=1;LW(38,130)=1;LW(38,131)=1;LW(38,132)=1;LW(38,133)=1;LW(38,134)=1;
    LW(38,135)=1;LW(38,136)=1;LW(38,137)=1;LW(38,138)=1;LW(38,139)=1;LW(38,140)=1;LW(38,141)=1;LW(38,142)=1;LW(38,143)=1;LW(38,144)=1;
    LW(38,145)=1;LW(38,146)=1;LW(38,147)=1;LW(38,148)=1;LW(38,149)=1;LW(38,150)=1;LW(38,151)=1;LW(38,152)=1;LW(38,153)=1;LW(38,154)=1;
    LW(38,155)=1;LW(38,156)=1;LW(38,157)=1;LW(38,158)=1;LW(38,159)=1;LW(38,160)=1;LW(38,161)=1;LW(38,162)=1;LW(38,163)=1;LW(38,164)=1;
    LW(38,165)=1;LW(38,166)=1;LW(38,167)=1;LW(38,168)=1;LW(38,169)=1;LW(38,170)=1;LW(38,171)=1;LW(38,172)=1;LW(38,173)=1;LW(38,174)=1;
    LW(38,175)=1;LW(38,176)=1;LW(38,177)=1;LW(38,178)=1;LW(38,179)=1;LW(38,180)=1;LW(38,181)=1;LW(38,182)=1;LW(38,183)=1;LW(38,184)=1;
    LW(38,185)=1;LW(38,186)=1;LW(38,187)=1;LW(38,188)=1;LW(38,189)=1;LW(38,190)=1;LW(38,191)=1;LW(38,192)=1;LW(38,193)=1;LW(38,194)=1;
    LW(38,195)=1;LW(38,196)=1;LW(38,197)=1;LW(38,198)=1;LW(38,199)=1;LW(38,200)=1;LW(38,201)=1;LW(38,202)=1;LW(38,203)=1;LW(38,204)=1;
    LW(38,205)=1;LW(38,206)=1;LW(38,207)=1;LW(38,208)=1;LW(38,209)=1;LW(38,210)=1;LW(38,211)=1;LW(38,212)=1;LW(38,213)=1;LW(38,214)=1;
    LW(38,215)=1;LW(38,216)=1;LW(38,217)=1;LW(38,218)=1;LW(38,219)=1;LW(38,220)=1;LW(38,221)=1;LW(38,222)=1;LW(38,223)=1;LW(38,224)=1;
    LW(38,225)=1;LW(38,226)=1;LW(38,227)=1;LW(38,228)=1;LW(38,229)=1;LW(38,230)=1;LW(38,231)=1;LW(38,232)=1;LW(38,233)=1;LW(38,234)=1;
    LW(38,235)=1;LW(38,236)=1;LW(38,237)=1;LW(38,238)=1;LW(38,239)=1;LW(38,240)=1;LW(38,241)=1;LW(38,242)=1;LW(38,243)=1;LW(38,244)=1;
    LW(38,245)=1;LW(38,246)=1;LW(38,247)=1;LW(38,248)=1;LW(38,249)=1;LW(38,250)=1;LW(38,251)=1;LW(38,252)=1;LW(38,253)=1;LW(38,254)=1;
    LW(39,3)=1;LW(39,4)=1;LW(39,5)=1;LW(39,6)=1;LW(39,7)=1;LW(39,8)=1;LW(39,9)=1;LW(39,10)=1;LW(39,13)=1;LW(39,14)=1;
    LW(39,15)=1;LW(39,16)=1;LW(39,17)=1;LW(39,24)=1;LW(39,25)=1;LW(39,26)=1;LW(39,27)=1;LW(39,28)=1;LW(39,29)=1;LW(39,30)=1;
    LW(39,31)=1;LW(39,32)=1;LW(39,33)=1;LW(39,34)=1;LW(39,35)=1;LW(39,63)=1;LW(39,64)=1;LW(39,65)=1;LW(39,84)=1;LW(39,85)=1;
    LW(39,86)=1;LW(39,87)=1;LW(39,88)=1;LW(39,100)=1;LW(39,101)=1;LW(39,121)=1;LW(39,122)=1;LW(39,126)=1;LW(39,127)=1;LW(39,128)=1;
    LW(39,129)=1;LW(39,130)=1;LW(39,131)=1;LW(39,132)=1;LW(39,133)=1;LW(39,134)=1;LW(39,135)=1;LW(39,140)=1;LW(39,141)=1;LW(39,142)=1;
    LW(39,143)=1;LW(39,144)=1;LW(39,145)=1;LW(39,146)=1;LW(39,147)=1;LW(39,148)=1;LW(39,149)=1;LW(39,150)=1;LW(39,151)=1;LW(39,152)=1;
    LW(39,153)=1;LW(39,154)=1;LW(39,155)=1;LW(39,156)=1;LW(39,157)=1;LW(39,158)=1;LW(39,159)=1;LW(39,160)=1;LW(39,161)=1;LW(39,162)=1;
    LW(39,163)=1;LW(39,164)=1;LW(39,165)=1;LW(39,166)=1;LW(39,167)=1;LW(39,168)=1;LW(39,169)=1;LW(39,170)=1;LW(39,171)=1;LW(39,172)=1;
    LW(39,173)=1;LW(39,174)=1;LW(39,175)=1;LW(39,176)=1;LW(39,177)=1;LW(39,178)=1;LW(39,179)=1;LW(39,180)=1;LW(39,181)=1;LW(39,182)=1;
    LW(39,183)=1;LW(39,184)=1;LW(39,185)=1;LW(39,186)=1;LW(39,187)=1;LW(39,188)=1;LW(39,189)=1;LW(39,190)=1;LW(39,191)=1;LW(39,192)=1;
    LW(39,193)=1;LW(39,194)=1;LW(39,195)=1;LW(39,196)=1;LW(39,197)=1;LW(39,198)=1;LW(39,199)=1;LW(39,200)=1;LW(39,201)=1;LW(39,202)=1;
    LW(39,203)=1;LW(39,204)=1;LW(39,205)=1;LW(39,206)=1;LW(39,207)=1;LW(39,208)=1;LW(39,209)=1;LW(39,210)=1;LW(39,211)=1;LW(39,212)=1;
    LW(39,213)=1;LW(39,214)=1;LW(39,215)=1;LW(39,216)=1;LW(39,217)=1;LW(39,218)=1;LW(39,219)=1;LW(39,220)=1;LW(39,221)=1;LW(39,222)=1;
    LW(39,223)=1;LW(39,224)=1;LW(39,225)=1;LW(39,226)=1;LW(39,227)=1;LW(39,228)=1;LW(39,229)=1;LW(39,230)=1;LW(39,231)=1;LW(39,232)=1;
    LW(39,233)=1;LW(39,234)=1;LW(39,235)=1;LW(39,236)=1;LW(39,237)=1;LW(39,238)=1;LW(39,239)=1;LW(39,240)=1;LW(39,241)=1;LW(39,242)=1;
    LW(39,243)=1;LW(39,244)=1;LW(39,245)=1;LW(39,246)=1;LW(39,247)=1;LW(39,248)=1;LW(39,249)=1;LW(39,250)=1;LW(39,251)=1;LW(39,252)=1;
    LW(39,253)=1;LW(39,254)=1;LW(39,255)=1;LW(39,256)=1;LW(39,257)=1;LW(39,260)=1;LW(39,261)=1;LW(40,3)=1;LW(40,4)=1;LW(40,5)=1;
    LW(40,14)=1;LW(40,15)=1;LW(40,16)=1;LW(40,17)=1;LW(40,29)=1;LW(40,30)=1;LW(40,31)=1;LW(40,32)=1;LW(40,33)=1;LW(40,34)=1;
    LW(40,35)=1;LW(40,84)=1;LW(40,85)=1;LW(40,86)=1;LW(40,87)=1;LW(40,88)=1;LW(40,130)=1;LW(40,131)=1;LW(40,132)=1;LW(40,133)=1;
    LW(40,140)=1;LW(40,141)=1;LW(40,142)=1;LW(40,143)=1;LW(40,144)=1;LW(40,145)=1;LW(40,146)=1;LW(40,147)=1;LW(40,148)=1;LW(40,149)=1;
    LW(40,150)=1;LW(40,151)=1;LW(40,152)=1;LW(40,153)=1;LW(40,154)=1;LW(40,155)=1;LW(40,156)=1;LW(40,157)=1;LW(40,158)=1;LW(40,159)=1;
    LW(40,160)=1;LW(40,161)=1;LW(40,162)=1;LW(40,163)=1;LW(40,164)=1;LW(40,165)=1;LW(40,166)=1;LW(40,167)=1;LW(40,168)=1;LW(40,169)=1;
    LW(40,170)=1;LW(40,171)=1;LW(40,172)=1;LW(40,173)=1;LW(40,174)=1;LW(40,175)=1;LW(40,176)=1;LW(40,177)=1;LW(40,178)=1;LW(40,179)=1;
    LW(40,180)=1;LW(40,181)=1;LW(40,182)=1;LW(40,183)=1;LW(40,184)=1;LW(40,185)=1;LW(40,186)=1;LW(40,187)=1;LW(40,188)=1;LW(40,189)=1;
    LW(40,190)=1;LW(40,191)=1;LW(40,192)=1;LW(40,193)=1;LW(40,194)=1;LW(40,195)=1;LW(40,196)=1;LW(40,197)=1;LW(40,198)=1;LW(40,199)=1;
    LW(40,200)=1;LW(40,201)=1;LW(40,202)=1;LW(40,203)=1;LW(40,204)=1;LW(40,205)=1;LW(40,206)=1;LW(40,207)=1;LW(40,208)=1;LW(40,209)=1;
    LW(40,210)=1;LW(40,211)=1;LW(40,212)=1;LW(40,213)=1;LW(40,214)=1;LW(40,215)=1;LW(40,216)=1;LW(40,217)=1;LW(40,218)=1;LW(40,219)=1;
    LW(40,220)=1;LW(40,221)=1;LW(40,222)=1;LW(40,223)=1;LW(40,224)=1;LW(40,225)=1;LW(40,226)=1;LW(40,227)=1;LW(40,228)=1;LW(40,229)=1;
    LW(40,230)=1;LW(40,231)=1;LW(40,232)=1;LW(40,233)=1;LW(40,234)=1;LW(40,235)=1;LW(40,236)=1;LW(40,237)=1;LW(40,238)=1;LW(40,239)=1;
    LW(40,240)=1;LW(40,241)=1;LW(40,242)=1;LW(40,243)=1;LW(40,244)=1;LW(40,245)=1;LW(40,246)=1;LW(40,247)=1;LW(40,248)=1;LW(40,249)=1;
    LW(40,250)=1;LW(40,251)=1;LW(40,252)=1;LW(40,253)=1;LW(40,254)=1;LW(40,255)=1;LW(40,256)=1;LW(40,257)=1;LW(40,258)=1;LW(40,259)=1;
    LW(40,260)=1;LW(40,261)=1;LW(40,262)=1;LW(40,267)=1;LW(40,268)=1;LW(41,4)=1;LW(41,5)=1;LW(41,14)=1;LW(41,15)=1;LW(41,16)=1;
    LW(41,17)=1;LW(41,31)=1;LW(41,32)=1;LW(41,33)=1;LW(41,34)=1;LW(41,84)=1;LW(41,85)=1;LW(41,86)=1;LW(41,87)=1;LW(41,88)=1;
    LW(41,141)=1;LW(41,142)=1;LW(41,143)=1;LW(41,144)=1;LW(41,145)=1;LW(41,146)=1;LW(41,147)=1;LW(41,148)=1;LW(41,149)=1;LW(41,152)=1;
    LW(41,153)=1;LW(41,154)=1;LW(41,155)=1;LW(41,156)=1;LW(41,157)=1;LW(41,158)=1;LW(41,159)=1;LW(41,160)=1;LW(41,161)=1;LW(41,162)=1;
    LW(41,163)=1;LW(41,164)=1;LW(41,165)=1;LW(41,166)=1;LW(41,167)=1;LW(41,168)=1;LW(41,169)=1;LW(41,170)=1;LW(41,171)=1;LW(41,172)=1;
    LW(41,173)=1;LW(41,174)=1;LW(41,175)=1;LW(41,176)=1;LW(41,177)=1;LW(41,178)=1;LW(41,179)=1;LW(41,180)=1;LW(41,181)=1;LW(41,182)=1;
    LW(41,183)=1;LW(41,184)=1;LW(41,185)=1;LW(41,186)=1;LW(41,187)=1;LW(41,188)=1;LW(41,189)=1;LW(41,190)=1;LW(41,191)=1;LW(41,192)=1;
    LW(41,193)=1;LW(41,194)=1;LW(41,195)=1;LW(41,196)=1;LW(41,197)=1;LW(41,198)=1;LW(41,199)=1;LW(41,200)=1;LW(41,201)=1;LW(41,202)=1;
    LW(41,203)=1;LW(41,204)=1;LW(41,205)=1;LW(41,206)=1;LW(41,207)=1;LW(41,208)=1;LW(41,209)=1;LW(41,210)=1;LW(41,211)=1;LW(41,212)=1;
    LW(41,213)=1;LW(41,214)=1;LW(41,215)=1;LW(41,216)=1;LW(41,217)=1;LW(41,218)=1;LW(41,219)=1;LW(41,220)=1;LW(41,221)=1;LW(41,222)=1;
    LW(41,223)=1;LW(41,224)=1;LW(41,225)=1;LW(41,226)=1;LW(41,227)=1;LW(41,228)=1;LW(41,229)=1;LW(41,230)=1;LW(41,231)=1;LW(41,232)=1;
    LW(41,233)=1;LW(41,234)=1;LW(41,235)=1;LW(41,236)=1;LW(41,237)=1;LW(41,238)=1;LW(41,239)=1;LW(41,240)=1;LW(41,241)=1;LW(41,242)=1;
    LW(41,243)=1;LW(41,244)=1;LW(41,245)=1;LW(41,246)=1;LW(41,247)=1;LW(41,248)=1;LW(41,249)=1;LW(41,250)=1;LW(41,251)=1;LW(41,252)=1;
    LW(41,253)=1;LW(41,254)=1;LW(41,255)=1;LW(41,256)=1;LW(41,257)=1;LW(41,258)=1;LW(41,259)=1;LW(41,260)=1;LW(41,261)=1;LW(41,262)=1;
    LW(41,263)=1;LW(41,264)=1;LW(41,265)=1;LW(41,266)=1;LW(41,267)=1;LW(41,268)=1;LW(41,269)=1;LW(42,15)=1;LW(42,16)=1;LW(42,17)=1;
    LW(42,31)=1;LW(42,32)=1;LW(42,33)=1;LW(42,34)=1;LW(42,85)=1;LW(42,86)=1;LW(42,87)=1;LW(42,88)=1;LW(42,141)=1;LW(42,142)=1;
    LW(42,143)=1;LW(42,144)=1;LW(42,145)=1;LW(42,147)=1;LW(42,148)=1;LW(42,152)=1;LW(42,153)=1;LW(42,154)=1;LW(42,155)=1;LW(42,156)=1;
    LW(42,157)=1;LW(42,158)=1;LW(42,159)=1;LW(42,160)=1;LW(42,161)=1;LW(42,162)=1;LW(42,163)=1;LW(42,164)=1;LW(42,165)=1;LW(42,166)=1;
    LW(42,167)=1;LW(42,168)=1;LW(42,169)=1;LW(42,170)=1;LW(42,171)=1;LW(42,172)=1;LW(42,173)=1;LW(42,174)=1;LW(42,175)=1;LW(42,176)=1;
    LW(42,177)=1;LW(42,178)=1;LW(42,179)=1;LW(42,180)=1;LW(42,181)=1;LW(42,182)=1;LW(42,183)=1;LW(42,184)=1;LW(42,185)=1;LW(42,186)=1;
    LW(42,187)=1;LW(42,188)=1;LW(42,189)=1;LW(42,190)=1;LW(42,191)=1;LW(42,192)=1;LW(42,193)=1;LW(42,194)=1;LW(42,195)=1;LW(42,196)=1;
    LW(42,197)=1;LW(42,198)=1;LW(42,199)=1;LW(42,200)=1;LW(42,201)=1;LW(42,202)=1;LW(42,203)=1;LW(42,204)=1;LW(42,205)=1;LW(42,206)=1;
    LW(42,207)=1;LW(42,208)=1;LW(42,209)=1;LW(42,210)=1;LW(42,211)=1;LW(42,212)=1;LW(42,213)=1;LW(42,214)=1;LW(42,215)=1;LW(42,216)=1;
    LW(42,217)=1;LW(42,218)=1;LW(42,219)=1;LW(42,220)=1;LW(42,221)=1;LW(42,222)=1;LW(42,223)=1;LW(42,224)=1;LW(42,225)=1;LW(42,226)=1;
    LW(42,227)=1;LW(42,228)=1;LW(42,229)=1;LW(42,230)=1;LW(42,231)=1;LW(42,232)=1;LW(42,233)=1;LW(42,234)=1;LW(42,235)=1;LW(42,236)=1;
    LW(42,237)=1;LW(42,238)=1;LW(42,239)=1;LW(42,240)=1;LW(42,241)=1;LW(42,242)=1;LW(42,243)=1;LW(42,244)=1;LW(42,245)=1;LW(42,246)=1;
    LW(42,247)=1;LW(42,248)=1;LW(42,249)=1;LW(42,250)=1;LW(42,251)=1;LW(42,252)=1;LW(42,253)=1;LW(42,254)=1;LW(42,255)=1;LW(42,256)=1;
    LW(42,257)=1;LW(42,258)=1;LW(42,259)=1;LW(42,260)=1;LW(42,261)=1;LW(42,262)=1;LW(42,263)=1;LW(42,264)=1;LW(42,265)=1;LW(42,266)=1;
    LW(42,267)=1;LW(42,268)=1;LW(42,269)=1;LW(42,270)=1;LW(43,32)=1;LW(43,33)=1;LW(43,86)=1;LW(43,87)=1;LW(43,88)=1;LW(43,89)=1;
    LW(43,153)=1;LW(43,154)=1;LW(43,155)=1;LW(43,156)=1;LW(43,157)=1;LW(43,158)=1;LW(43,159)=1;LW(43,160)=1;LW(43,161)=1;LW(43,162)=1;
    LW(43,163)=1;LW(43,164)=1;LW(43,165)=1;LW(43,166)=1;LW(43,167)=1;LW(43,168)=1;LW(43,169)=1;LW(43,170)=1;LW(43,171)=1;LW(43,172)=1;
    LW(43,173)=1;LW(43,174)=1;LW(43,175)=1;LW(43,176)=1;LW(43,177)=1;LW(43,178)=1;LW(43,179)=1;LW(43,180)=1;LW(43,181)=1;LW(43,182)=1;
    LW(43,183)=1;LW(43,184)=1;LW(43,185)=1;LW(43,186)=1;LW(43,187)=1;LW(43,188)=1;LW(43,189)=1;LW(43,190)=1;LW(43,191)=1;LW(43,192)=1;
    LW(43,193)=1;LW(43,194)=1;LW(43,195)=1;LW(43,196)=1;LW(43,197)=1;LW(43,198)=1;LW(43,199)=1;LW(43,200)=1;LW(43,201)=1;LW(43,202)=1;
    LW(43,203)=1;LW(43,204)=1;LW(43,205)=1;LW(43,206)=1;LW(43,207)=1;LW(43,208)=1;LW(43,209)=1;LW(43,210)=1;LW(43,211)=1;LW(43,212)=1;
    LW(43,213)=1;LW(43,214)=1;LW(43,215)=1;LW(43,216)=1;LW(43,217)=1;LW(43,218)=1;LW(43,219)=1;LW(43,220)=1;LW(43,221)=1;LW(43,222)=1;
    LW(43,223)=1;LW(43,224)=1;LW(43,225)=1;LW(43,226)=1;LW(43,227)=1;LW(43,228)=1;LW(43,229)=1;LW(43,230)=1;LW(43,231)=1;LW(43,232)=1;
    LW(43,233)=1;LW(43,234)=1;LW(43,235)=1;LW(43,236)=1;LW(43,237)=1;LW(43,238)=1;LW(43,239)=1;LW(43,240)=1;LW(43,241)=1;LW(43,242)=1;
    LW(43,243)=1;LW(43,244)=1;LW(43,245)=1;LW(43,246)=1;LW(43,247)=1;LW(43,248)=1;LW(43,249)=1;LW(43,250)=1;LW(43,251)=1;LW(43,252)=1;
    LW(43,253)=1;LW(43,254)=1;LW(43,255)=1;LW(43,256)=1;LW(43,257)=1;LW(43,258)=1;LW(43,259)=1;LW(43,260)=1;LW(43,261)=1;LW(43,262)=1;
    LW(43,263)=1;LW(43,264)=1;LW(43,265)=1;LW(43,266)=1;LW(43,267)=1;LW(43,268)=1;LW(43,269)=1;LW(43,270)=1;LW(44,87)=1;LW(44,88)=1;
    LW(44,89)=1;LW(44,90)=1;LW(44,164)=1;LW(44,165)=1;LW(44,166)=1;LW(44,167)=1;LW(44,168)=1;LW(44,169)=1;LW(44,170)=1;LW(44,174)=1;
    LW(44,175)=1;LW(44,176)=1;LW(44,177)=1;LW(44,178)=1;LW(44,179)=1;LW(44,180)=1;LW(44,181)=1;LW(44,182)=1;LW(44,183)=1;LW(44,184)=1;
    LW(44,185)=1;LW(44,186)=1;LW(44,187)=1;LW(44,188)=1;LW(44,189)=1;LW(44,190)=1;LW(44,191)=1;LW(44,192)=1;LW(44,193)=1;LW(44,194)=1;
    LW(44,195)=1;LW(44,196)=1;LW(44,197)=1;LW(44,198)=1;LW(44,199)=1;LW(44,200)=1;LW(44,201)=1;LW(44,202)=1;LW(44,203)=1;LW(44,204)=1;
    LW(44,205)=1;LW(44,206)=1;LW(44,207)=1;LW(44,208)=1;LW(44,209)=1;LW(44,210)=1;LW(44,211)=1;LW(44,212)=1;LW(44,213)=1;LW(44,214)=1;
    LW(44,215)=1;LW(44,216)=1;LW(44,217)=1;LW(44,218)=1;LW(44,219)=1;LW(44,220)=1;LW(44,221)=1;LW(44,222)=1;LW(44,223)=1;LW(44,224)=1;
    LW(44,225)=1;LW(44,226)=1;LW(44,227)=1;LW(44,228)=1;LW(44,229)=1;LW(44,230)=1;LW(44,231)=1;LW(44,232)=1;LW(44,233)=1;LW(44,234)=1;
    LW(44,235)=1;LW(44,236)=1;LW(44,237)=1;LW(44,238)=1;LW(44,239)=1;LW(44,240)=1;LW(44,241)=1;LW(44,242)=1;LW(44,243)=1;LW(44,244)=1;
    LW(44,245)=1;LW(44,246)=1;LW(44,247)=1;LW(44,248)=1;LW(44,249)=1;LW(44,250)=1;LW(44,251)=1;LW(44,252)=1;LW(44,253)=1;LW(44,254)=1;
    LW(44,255)=1;LW(44,256)=1;LW(44,257)=1;LW(44,258)=1;LW(44,259)=1;LW(44,260)=1;LW(44,261)=1;LW(44,262)=1;LW(44,263)=1;LW(44,264)=1;
    LW(44,265)=1;LW(44,266)=1;LW(44,267)=1;LW(44,268)=1;LW(44,269)=1;LW(44,270)=1;LW(45,86)=1;LW(45,87)=1;LW(45,88)=1;LW(45,165)=1;
    LW(45,166)=1;LW(45,167)=1;LW(45,168)=1;LW(45,169)=1;LW(45,175)=1;LW(45,176)=1;LW(45,177)=1;LW(45,178)=1;LW(45,179)=1;LW(45,180)=1;
    LW(45,181)=1;LW(45,182)=1;LW(45,183)=1;LW(45,184)=1;LW(45,185)=1;LW(45,186)=1;LW(45,187)=1;LW(45,188)=1;LW(45,189)=1;LW(45,190)=1;
    LW(45,191)=1;LW(45,192)=1;LW(45,193)=1;LW(45,194)=1;LW(45,195)=1;LW(45,196)=1;LW(45,197)=1;LW(45,198)=1;LW(45,199)=1;LW(45,200)=1;
    LW(45,201)=1;LW(45,202)=1;LW(45,203)=1;LW(45,204)=1;LW(45,205)=1;LW(45,206)=1;LW(45,207)=1;LW(45,208)=1;LW(45,209)=1;LW(45,210)=1;
    LW(45,211)=1;LW(45,212)=1;LW(45,213)=1;LW(45,214)=1;LW(45,215)=1;LW(45,216)=1;LW(45,217)=1;LW(45,218)=1;LW(45,219)=1;LW(45,220)=1;
    LW(45,221)=1;LW(45,222)=1;LW(45,223)=1;LW(45,224)=1;LW(45,225)=1;LW(45,226)=1;LW(45,227)=1;LW(45,228)=1;LW(45,229)=1;LW(45,230)=1;
    LW(45,231)=1;LW(45,232)=1;LW(45,233)=1;LW(45,234)=1;LW(45,235)=1;LW(45,236)=1;LW(45,237)=1;LW(45,238)=1;LW(45,239)=1;LW(45,240)=1;
    LW(45,241)=1;LW(45,242)=1;LW(45,243)=1;LW(45,244)=1;LW(45,245)=1;LW(45,246)=1;LW(45,247)=1;LW(45,248)=1;LW(45,249)=1;LW(45,250)=1;
    LW(45,251)=1;LW(45,252)=1;LW(45,253)=1;LW(45,254)=1;LW(45,255)=1;LW(45,256)=1;LW(45,257)=1;LW(45,258)=1;LW(45,259)=1;LW(45,260)=1;
    LW(45,261)=1;LW(45,262)=1;LW(45,263)=1;LW(45,264)=1;LW(45,265)=1;LW(45,266)=1;LW(45,267)=1;LW(45,268)=1;LW(45,269)=1;LW(45,270)=1;
    LW(46,86)=1;LW(46,87)=1;LW(46,166)=1;LW(46,175)=1;LW(46,176)=1;LW(46,177)=1;LW(46,178)=1;LW(46,179)=1;LW(46,180)=1;LW(46,181)=1;
    LW(46,182)=1;LW(46,183)=1;LW(46,184)=1;LW(46,185)=1;LW(46,186)=1;LW(46,187)=1;LW(46,188)=1;LW(46,189)=1;LW(46,190)=1;LW(46,191)=1;
    LW(46,192)=1;LW(46,193)=1;LW(46,194)=1;LW(46,195)=1;LW(46,196)=1;LW(46,197)=1;LW(46,198)=1;LW(46,199)=1;LW(46,200)=1;LW(46,201)=1;
    LW(46,202)=1;LW(46,203)=1;LW(46,204)=1;LW(46,205)=1;LW(46,206)=1;LW(46,207)=1;LW(46,208)=1;LW(46,209)=1;LW(46,210)=1;LW(46,211)=1;
    LW(46,212)=1;LW(46,213)=1;LW(46,214)=1;LW(46,215)=1;LW(46,216)=1;LW(46,217)=1;LW(46,218)=1;LW(46,219)=1;LW(46,220)=1;LW(46,221)=1;
    LW(46,222)=1;LW(46,223)=1;LW(46,224)=1;LW(46,225)=1;LW(46,226)=1;LW(46,227)=1;LW(46,228)=1;LW(46,229)=1;LW(46,230)=1;LW(46,231)=1;
    LW(46,232)=1;LW(46,233)=1;LW(46,234)=1;LW(46,235)=1;LW(46,236)=1;LW(46,237)=1;LW(46,238)=1;LW(46,239)=1;LW(46,240)=1;LW(46,241)=1;
    LW(46,242)=1;LW(46,243)=1;LW(46,244)=1;LW(46,245)=1;LW(46,246)=1;LW(46,247)=1;LW(46,248)=1;LW(46,249)=1;LW(46,250)=1;LW(46,251)=1;
    LW(46,252)=1;LW(46,253)=1;LW(46,254)=1;LW(46,255)=1;LW(46,256)=1;LW(46,257)=1;LW(46,258)=1;LW(46,259)=1;LW(46,260)=1;LW(46,261)=1;
    LW(46,262)=1;LW(46,263)=1;LW(46,264)=1;LW(46,265)=1;LW(46,266)=1;LW(46,267)=1;LW(46,268)=1;LW(46,269)=1;LW(46,270)=1;LW(47,86)=1;
    LW(47,87)=1;LW(47,185)=1;LW(47,186)=1;LW(47,187)=1;LW(47,188)=1;LW(47,189)=1;LW(47,190)=1;LW(47,191)=1;LW(47,192)=1;LW(47,193)=1;
    LW(47,194)=1;LW(47,195)=1;LW(47,196)=1;LW(47,197)=1;LW(47,198)=1;LW(47,199)=1;LW(47,200)=1;LW(47,201)=1;LW(47,202)=1;LW(47,203)=1;
    LW(47,204)=1;LW(47,205)=1;LW(47,206)=1;LW(47,207)=1;LW(47,208)=1;LW(47,209)=1;LW(47,210)=1;LW(47,211)=1;LW(47,212)=1;LW(47,213)=1;
    LW(47,214)=1;LW(47,215)=1;LW(47,216)=1;LW(47,217)=1;LW(47,218)=1;LW(47,219)=1;LW(47,220)=1;LW(47,221)=1;LW(47,222)=1;LW(47,223)=1;
    LW(47,224)=1;LW(47,225)=1;LW(47,226)=1;LW(47,227)=1;LW(47,228)=1;LW(47,229)=1;LW(47,230)=1;LW(47,231)=1;LW(47,232)=1;LW(47,233)=1;
    LW(47,234)=1;LW(47,235)=1;LW(47,236)=1;LW(47,237)=1;LW(47,238)=1;LW(47,239)=1;LW(47,240)=1;LW(47,241)=1;LW(47,242)=1;LW(47,243)=1;
    LW(47,244)=1;LW(47,245)=1;LW(47,246)=1;LW(47,247)=1;LW(47,248)=1;LW(47,249)=1;LW(47,250)=1;LW(47,251)=1;LW(47,252)=1;LW(47,253)=1;
    LW(47,254)=1;LW(47,255)=1;LW(47,256)=1;LW(47,257)=1;LW(47,258)=1;LW(47,259)=1;LW(47,260)=1;LW(47,261)=1;LW(47,262)=1;LW(47,263)=1;
    LW(47,264)=1;LW(47,265)=1;LW(47,266)=1;LW(47,267)=1;LW(47,268)=1;LW(47,269)=1;LW(47,270)=1;LW(48,186)=1;LW(48,187)=1;LW(48,188)=1;
    LW(48,189)=1;LW(48,190)=1;LW(48,193)=1;LW(48,194)=1;LW(48,195)=1;LW(48,196)=1;LW(48,197)=1;LW(48,198)=1;LW(48,199)=1;LW(48,200)=1;
    LW(48,201)=1;LW(48,202)=1;LW(48,203)=1;LW(48,204)=1;LW(48,205)=1;LW(48,206)=1;LW(48,207)=1;LW(48,208)=1;LW(48,209)=1;LW(48,210)=1;
    LW(48,211)=1;LW(48,212)=1;LW(48,213)=1;LW(48,214)=1;LW(48,215)=1;LW(48,216)=1;LW(48,217)=1;LW(48,218)=1;LW(48,219)=1;LW(48,220)=1;
    LW(48,221)=1;LW(48,222)=1;LW(48,223)=1;LW(48,224)=1;LW(48,225)=1;LW(48,226)=1;LW(48,227)=1;LW(48,228)=1;LW(48,229)=1;LW(48,230)=1;
    LW(48,231)=1;LW(48,232)=1;LW(48,233)=1;LW(48,234)=1;LW(48,235)=1;LW(48,236)=1;LW(48,237)=1;LW(48,238)=1;LW(48,239)=1;LW(48,240)=1;
    LW(48,241)=1;LW(48,242)=1;LW(48,243)=1;LW(48,244)=1;LW(48,245)=1;LW(48,246)=1;LW(48,247)=1;LW(48,248)=1;LW(48,249)=1;LW(48,250)=1;
    LW(48,251)=1;LW(48,252)=1;LW(48,253)=1;LW(48,254)=1;LW(48,255)=1;LW(48,256)=1;LW(48,257)=1;LW(48,258)=1;LW(48,259)=1;LW(48,260)=1;
    LW(48,261)=1;LW(48,262)=1;LW(48,263)=1;LW(48,264)=1;LW(48,265)=1;LW(48,266)=1;LW(48,267)=1;LW(48,268)=1;LW(48,269)=1;LW(48,270)=1;
    LW(49,187)=1;LW(49,188)=1;LW(49,189)=1;LW(49,194)=1;LW(49,195)=1;LW(49,196)=1;LW(49,197)=1;LW(49,198)=1;LW(49,199)=1;LW(49,200)=1;
    LW(49,201)=1;LW(49,202)=1;LW(49,203)=1;LW(49,204)=1;LW(49,205)=1;LW(49,206)=1;LW(49,207)=1;LW(49,208)=1;LW(49,209)=1;LW(49,210)=1;
    LW(49,211)=1;LW(49,212)=1;LW(49,213)=1;LW(49,214)=1;LW(49,215)=1;LW(49,216)=1;LW(49,217)=1;LW(49,218)=1;LW(49,219)=1;LW(49,220)=1;
    LW(49,221)=1;LW(49,222)=1;LW(49,223)=1;LW(49,224)=1;LW(49,225)=1;LW(49,226)=1;LW(49,227)=1;LW(49,228)=1;LW(49,229)=1;LW(49,230)=1;
    LW(49,231)=1;LW(49,232)=1;LW(49,233)=1;LW(49,234)=1;LW(49,235)=1;LW(49,236)=1;LW(49,237)=1;LW(49,238)=1;LW(49,239)=1;LW(49,240)=1;
    LW(49,241)=1;LW(49,242)=1;LW(49,243)=1;LW(49,244)=1;LW(49,245)=1;LW(49,246)=1;LW(49,247)=1;LW(49,248)=1;LW(49,249)=1;LW(49,250)=1;
    LW(49,251)=1;LW(49,252)=1;LW(49,253)=1;LW(49,254)=1;LW(49,255)=1;LW(49,256)=1;LW(49,257)=1;LW(49,258)=1;LW(49,259)=1;LW(49,260)=1;
    LW(49,261)=1;LW(49,262)=1;LW(49,263)=1;LW(49,264)=1;LW(49,265)=1;LW(49,266)=1;LW(49,267)=1;LW(49,268)=1;LW(49,269)=1;LW(49,270)=1;
    LW(50,203)=1;LW(50,204)=1;LW(50,205)=1;LW(50,206)=1;LW(50,207)=1;LW(50,208)=1;LW(50,209)=1;LW(50,210)=1;LW(50,211)=1;LW(50,212)=1;
    LW(50,213)=1;LW(50,214)=1;LW(50,215)=1;LW(50,216)=1;LW(50,217)=1;LW(50,218)=1;LW(50,219)=1;LW(50,220)=1;LW(50,221)=1;LW(50,222)=1;
    LW(50,223)=1;LW(50,224)=1;LW(50,225)=1;LW(50,226)=1;LW(50,227)=1;LW(50,228)=1;LW(50,229)=1;LW(50,230)=1;LW(50,231)=1;LW(50,232)=1;
    LW(50,233)=1;LW(50,234)=1;LW(50,235)=1;LW(50,236)=1;LW(50,237)=1;LW(50,238)=1;LW(50,239)=1;LW(50,240)=1;LW(50,241)=1;LW(50,242)=1;
    LW(50,243)=1;LW(50,244)=1;LW(50,245)=1;LW(50,246)=1;LW(50,247)=1;LW(50,248)=1;LW(50,249)=1;LW(50,250)=1;LW(50,251)=1;LW(50,252)=1;
    LW(50,253)=1;LW(50,254)=1;LW(50,255)=1;LW(50,256)=1;LW(50,257)=1;LW(50,258)=1;LW(50,259)=1;LW(50,260)=1;LW(50,261)=1;LW(50,262)=1;
    LW(50,263)=1;LW(50,264)=1;LW(50,265)=1;LW(50,266)=1;LW(50,267)=1;LW(50,268)=1;LW(50,269)=1;LW(50,270)=1;LW(51,208)=1;LW(51,209)=1;
    LW(51,210)=1;LW(51,211)=1;LW(51,212)=1;LW(51,213)=1;LW(51,214)=1;LW(51,215)=1;LW(51,216)=1;LW(51,217)=1;LW(51,218)=1;LW(51,219)=1;
    LW(51,220)=1;LW(51,221)=1;LW(51,222)=1;LW(51,223)=1;LW(51,224)=1;LW(51,225)=1;LW(51,226)=1;LW(51,227)=1;LW(51,228)=1;LW(51,229)=1;
    LW(51,230)=1;LW(51,231)=1;LW(51,232)=1;LW(51,233)=1;LW(51,234)=1;LW(51,235)=1;LW(51,236)=1;LW(51,237)=1;LW(51,238)=1;LW(51,239)=1;
    LW(51,240)=1;LW(51,241)=1;LW(51,242)=1;LW(51,243)=1;LW(51,244)=1;LW(51,245)=1;LW(51,246)=1;LW(51,247)=1;LW(51,248)=1;LW(51,249)=1;
    LW(51,250)=1;LW(51,251)=1;LW(51,252)=1;LW(51,253)=1;LW(51,254)=1;LW(51,255)=1;LW(51,256)=1;LW(51,257)=1;LW(51,258)=1;LW(51,259)=1;
    LW(51,260)=1;LW(51,261)=1;LW(51,262)=1;LW(51,263)=1;LW(51,264)=1;LW(51,265)=1;LW(51,266)=1;LW(51,267)=1;LW(51,268)=1;LW(51,269)=1;
    LW(51,270)=1;LW(52,209)=1;LW(52,210)=1;LW(52,211)=1;LW(52,212)=1;LW(52,213)=1;LW(52,214)=1;LW(52,215)=1;LW(52,216)=1;LW(52,217)=1;
    LW(52,218)=1;LW(52,219)=1;LW(52,220)=1;LW(52,221)=1;LW(52,222)=1;LW(52,223)=1;LW(52,224)=1;LW(52,225)=1;LW(52,226)=1;LW(52,227)=1;
    LW(52,228)=1;LW(52,229)=1;LW(52,230)=1;LW(52,231)=1;LW(52,232)=1;LW(52,233)=1;LW(52,234)=1;LW(52,235)=1;LW(52,236)=1;LW(52,237)=1;
    LW(52,238)=1;LW(52,239)=1;LW(52,240)=1;LW(52,241)=1;LW(52,242)=1;LW(52,243)=1;LW(52,244)=1;LW(52,245)=1;LW(52,246)=1;LW(52,247)=1;
    LW(52,248)=1;LW(52,249)=1;LW(52,250)=1;LW(52,251)=1;LW(52,252)=1;LW(52,253)=1;LW(52,254)=1;LW(52,255)=1;LW(52,256)=1;LW(52,257)=1;
    LW(52,258)=1;LW(52,259)=1;LW(52,260)=1;LW(52,261)=1;LW(52,262)=1;LW(52,263)=1;LW(52,264)=1;LW(52,265)=1;LW(52,266)=1;LW(52,267)=1;
    LW(52,268)=1;LW(52,269)=1;LW(52,270)=1;LW(53,216)=1;LW(53,217)=1;LW(53,220)=1;LW(53,221)=1;LW(53,222)=1;LW(53,223)=1;LW(53,224)=1;
    LW(53,225)=1;LW(53,226)=1;LW(53,227)=1;LW(53,228)=1;LW(53,229)=1;LW(53,230)=1;LW(53,231)=1;LW(53,232)=1;LW(53,233)=1;LW(53,234)=1;
    LW(53,235)=1;LW(53,236)=1;LW(53,237)=1;LW(53,238)=1;LW(53,239)=1;LW(53,240)=1;LW(53,241)=1;LW(53,242)=1;LW(53,243)=1;LW(53,244)=1;
    LW(53,245)=1;LW(53,246)=1;LW(53,247)=1;LW(53,248)=1;LW(53,249)=1;LW(53,250)=1;LW(53,251)=1;LW(53,252)=1;LW(53,253)=1;LW(53,254)=1;
    LW(53,255)=1;LW(53,256)=1;LW(53,257)=1;LW(53,258)=1;LW(53,259)=1;LW(53,260)=1;LW(53,261)=1;LW(53,262)=1;LW(53,263)=1;LW(53,264)=1;
    LW(53,265)=1;LW(53,266)=1;LW(53,267)=1;LW(53,268)=1;LW(53,269)=1;LW(53,270)=1;LW(54,220)=1;LW(54,221)=1;LW(54,222)=1;LW(54,223)=1;
    LW(54,224)=1;LW(54,225)=1;LW(54,226)=1;LW(54,227)=1;LW(54,228)=1;LW(54,229)=1;LW(54,230)=1;LW(54,231)=1;LW(54,232)=1;LW(54,233)=1;
    LW(54,234)=1;LW(54,235)=1;LW(54,236)=1;LW(54,237)=1;LW(54,238)=1;LW(54,239)=1;LW(54,240)=1;LW(54,241)=1;LW(54,242)=1;LW(54,243)=1;
    LW(54,244)=1;LW(54,245)=1;LW(54,246)=1;LW(54,247)=1;LW(54,248)=1;LW(54,249)=1;LW(54,250)=1;LW(54,251)=1;LW(54,252)=1;LW(54,253)=1;
    LW(54,254)=1;LW(54,255)=1;LW(54,256)=1;LW(54,257)=1;LW(54,258)=1;LW(54,259)=1;LW(54,260)=1;LW(54,261)=1;LW(54,262)=1;LW(54,263)=1;
    LW(54,264)=1;LW(54,265)=1;LW(54,266)=1;LW(54,267)=1;LW(54,268)=1;LW(54,269)=1;LW(54,270)=1;LW(55,215)=1;LW(55,216)=1;LW(55,217)=1;
    LW(55,220)=1;LW(55,221)=1;LW(55,222)=1;LW(55,223)=1;LW(55,224)=1;LW(55,225)=1;LW(55,226)=1;LW(55,227)=1;LW(55,228)=1;LW(55,229)=1;
    LW(55,230)=1;LW(55,231)=1;LW(55,232)=1;LW(55,233)=1;LW(55,234)=1;LW(55,235)=1;LW(55,236)=1;LW(55,237)=1;LW(55,238)=1;LW(55,239)=1;
    LW(55,240)=1;LW(55,241)=1;LW(55,242)=1;LW(55,243)=1;LW(55,244)=1;LW(55,245)=1;LW(55,246)=1;LW(55,247)=1;LW(55,248)=1;LW(55,249)=1;
    LW(55,250)=1;LW(55,251)=1;LW(55,252)=1;LW(55,253)=1;LW(55,254)=1;LW(55,255)=1;LW(55,256)=1;LW(55,257)=1;LW(55,258)=1;LW(55,259)=1;
    LW(55,260)=1;LW(55,261)=1;LW(55,262)=1;LW(55,263)=1;LW(55,264)=1;LW(55,265)=1;LW(55,266)=1;LW(55,267)=1;LW(55,268)=1;LW(55,269)=1;
    LW(55,270)=1;LW(56,215)=1;LW(56,216)=1;LW(56,217)=1;LW(56,221)=1;LW(56,222)=1;LW(56,223)=1;LW(56,224)=1;LW(56,225)=1;LW(56,226)=1;
    LW(56,227)=1;LW(56,228)=1;LW(56,229)=1;LW(56,230)=1;LW(56,231)=1;LW(56,232)=1;LW(56,233)=1;LW(56,234)=1;LW(56,235)=1;LW(56,236)=1;
    LW(56,237)=1;LW(56,238)=1;LW(56,239)=1;LW(56,240)=1;LW(56,241)=1;LW(56,242)=1;LW(56,243)=1;LW(56,244)=1;LW(56,245)=1;LW(56,246)=1;
    LW(56,247)=1;LW(56,248)=1;LW(56,249)=1;LW(56,250)=1;LW(56,251)=1;LW(56,252)=1;LW(56,253)=1;LW(56,254)=1;LW(56,255)=1;LW(56,256)=1;
    LW(56,257)=1;LW(56,258)=1;LW(56,259)=1;LW(56,260)=1;LW(56,261)=1;LW(56,262)=1;LW(56,263)=1;LW(56,264)=1;LW(56,265)=1;LW(56,266)=1;
    LW(56,267)=1;LW(56,268)=1;LW(56,269)=1;LW(56,270)=1;LW(57,230)=1;LW(57,231)=1;LW(57,232)=1;LW(57,233)=1;LW(57,244)=1;LW(57,245)=1;
    LW(57,246)=1;LW(57,247)=1;LW(57,248)=1;LW(57,249)=1;LW(57,250)=1;LW(57,251)=1;LW(57,252)=1;LW(57,253)=1;LW(57,254)=1;LW(57,255)=1;
    LW(57,256)=1;LW(57,257)=1;LW(57,258)=1;LW(57,259)=1;LW(57,260)=1;LW(57,261)=1;LW(57,262)=1;LW(57,263)=1;LW(57,264)=1;LW(57,265)=1;
    LW(57,266)=1;LW(57,267)=1;LW(57,268)=1;LW(57,269)=1;LW(57,270)=1;LW(58,254)=1;LW(58,255)=1;LW(58,256)=1;LW(58,257)=1;LW(58,258)=1;
    LW(58,259)=1;LW(58,260)=1;LW(58,261)=1;LW(58,262)=1;LW(58,263)=1;LW(58,264)=1;LW(58,265)=1;LW(58,266)=1;LW(58,267)=1;LW(58,268)=1;
    LW(58,269)=1;LW(58,270)=1;LW(59,256)=1;LW(59,257)=1;LW(59,258)=1;LW(59,259)=1;LW(59,260)=1;LW(59,261)=1;LW(59,262)=1;LW(59,263)=1;
    LW(59,264)=1;LW(59,265)=1;LW(59,266)=1;LW(59,267)=1;LW(59,268)=1;LW(59,269)=1;LW(59,270)=1;LW(60,257)=1;LW(60,258)=1;LW(60,259)=1;
    LW(60,260)=1;LW(60,261)=1;LW(60,262)=1;LW(60,263)=1;LW(60,264)=1;LW(60,265)=1;LW(60,266)=1;LW(60,267)=1;LW(60,268)=1;LW(60,269)=1;
    LW(60,270)=1;LW(61,257)=1;LW(61,258)=1;LW(61,259)=1;LW(61,260)=1;LW(61,261)=1;LW(61,262)=1;LW(61,263)=1;LW(61,264)=1;LW(61,265)=1;
    LW(61,266)=1;LW(61,267)=1;LW(61,268)=1;LW(61,269)=1;LW(61,270)=1;LW(62,258)=1;LW(62,259)=1;LW(62,260)=1;LW(62,261)=1;LW(62,262)=1;
    LW(62,263)=1;LW(62,264)=1;LW(62,265)=1;LW(62,266)=1;LW(62,267)=1;LW(62,268)=1;LW(62,269)=1;LW(62,270)=1;LW(63,258)=1;LW(63,259)=1;
    LW(63,260)=1;LW(63,261)=1;LW(63,262)=1;LW(63,263)=1;LW(63,264)=1;LW(63,265)=1;LW(63,266)=1;LW(63,267)=1;LW(63,268)=1;LW(63,269)=1;
    LW(63,270)=1;LW(64,262)=1;LW(64,263)=1;LW(64,264)=1;LW(64,265)=1;LW(64,266)=1;LW(64,267)=1;LW(64,268)=1;LW(64,269)=1;LW(64,270)=1;
    LW(65,270)=1;LW(69,263)=1;LW(70,75)=1;LW(71,74)=1;LW(71,75)=1;LW(71,76)=1;LW(72,74)=1;LW(72,75)=1;LW(72,76)=1;LW(73,74)=1;
    LW(73,75)=1;LW(73,76)=1;LW(74,74)=1;LW(74,75)=1;LW(74,76)=1;LW(75,75)=1;LW(76,72)=1;LW(76,73)=1;LW(78,74)=1;LW(78,75)=1;
    LW(79,73)=1;LW(79,74)=1;LW(79,75)=1;LW(79,76)=1;LW(80,73)=1;LW(80,74)=1;LW(80,75)=1;LW(80,76)=1;LW(81,42)=1;LW(81,60)=1;
    LW(81,61)=1;LW(81,62)=1;LW(81,67)=1;LW(81,68)=1;LW(81,69)=1;LW(81,73)=1;LW(81,74)=1;LW(81,75)=1;LW(81,76)=1;LW(81,81)=1;
    LW(81,82)=1;LW(81,83)=1;LW(81,84)=1;LW(81,85)=1;LW(81,86)=1;LW(81,88)=1;LW(81,89)=1;LW(81,90)=1;LW(81,91)=1;LW(82,35)=1;
    LW(82,36)=1;LW(82,37)=1;LW(82,39)=1;LW(82,40)=1;LW(82,41)=1;LW(82,42)=1;LW(82,43)=1;LW(82,44)=1;LW(82,46)=1;LW(82,47)=1;
    LW(82,48)=1;LW(82,49)=1;LW(82,50)=1;LW(82,51)=1;LW(82,52)=1;LW(82,53)=1;LW(82,54)=1;LW(82,55)=1;LW(82,56)=1;LW(82,57)=1;
    LW(82,58)=1;LW(82,59)=1;LW(82,60)=1;LW(82,61)=1;LW(82,62)=1;LW(82,63)=1;LW(82,64)=1;LW(82,65)=1;LW(82,66)=1;LW(82,67)=1;
    LW(82,68)=1;LW(82,69)=1;LW(82,70)=1;LW(82,71)=1;LW(82,72)=1;LW(82,73)=1;LW(82,74)=1;LW(82,75)=1;LW(82,76)=1;LW(82,77)=1;
    LW(82,80)=1;LW(82,81)=1;LW(82,82)=1;LW(82,83)=1;LW(82,84)=1;LW(82,85)=1;LW(82,86)=1;LW(82,87)=1;LW(82,88)=1;LW(82,89)=1;
    LW(82,90)=1;LW(82,91)=1;LW(82,92)=1;LW(82,93)=1;LW(82,94)=1;LW(82,95)=1;LW(82,96)=1;LW(82,97)=1;LW(82,98)=1;LW(82,99)=1;
    LW(82,100)=1;LW(82,101)=1;LW(82,102)=1;LW(82,103)=1;LW(82,104)=1;LW(82,105)=1;LW(82,106)=1;LW(82,109)=1;LW(82,110)=1;LW(82,111)=1;
    LW(82,112)=1;LW(82,124)=1;LW(82,125)=1;LW(82,126)=1;LW(82,138)=1;LW(82,139)=1;LW(83,14)=1;LW(83,20)=1;LW(83,21)=1;LW(83,22)=1;
    LW(83,27)=1;LW(83,28)=1;LW(83,29)=1;LW(83,34)=1;LW(83,35)=1;LW(83,36)=1;LW(83,37)=1;LW(83,38)=1;LW(83,39)=1;LW(83,40)=1;
    LW(83,41)=1;LW(83,42)=1;LW(83,43)=1;LW(83,44)=1;LW(83,45)=1;LW(83,46)=1;LW(83,47)=1;LW(83,48)=1;LW(83,49)=1;LW(83,50)=1;
    LW(83,51)=1;LW(83,52)=1;LW(83,53)=1;LW(83,54)=1;LW(83,55)=1;LW(83,56)=1;LW(83,57)=1;LW(83,58)=1;LW(83,59)=1;LW(83,60)=1;
    LW(83,61)=1;LW(83,62)=1;LW(83,63)=1;LW(83,64)=1;LW(83,65)=1;LW(83,66)=1;LW(83,67)=1;LW(83,68)=1;LW(83,69)=1;LW(83,70)=1;
    LW(83,71)=1;LW(83,72)=1;LW(83,73)=1;LW(83,74)=1;LW(83,75)=1;LW(83,76)=1;LW(83,77)=1;LW(83,78)=1;LW(83,79)=1;LW(83,80)=1;
    LW(83,81)=1;LW(83,82)=1;LW(83,83)=1;LW(83,84)=1;LW(83,85)=1;LW(83,86)=1;LW(83,87)=1;LW(83,88)=1;LW(83,89)=1;LW(83,90)=1;
    LW(83,91)=1;LW(83,92)=1;LW(83,93)=1;LW(83,94)=1;LW(83,95)=1;LW(83,96)=1;LW(83,97)=1;LW(83,98)=1;LW(83,99)=1;LW(83,100)=1;
    LW(83,101)=1;LW(83,102)=1;LW(83,103)=1;LW(83,104)=1;LW(83,105)=1;LW(83,106)=1;LW(83,107)=1;LW(83,108)=1;LW(83,109)=1;LW(83,110)=1;
    LW(83,111)=1;LW(83,112)=1;LW(83,113)=1;LW(83,114)=1;LW(83,116)=1;LW(83,117)=1;LW(83,118)=1;LW(83,119)=1;LW(83,120)=1;LW(83,121)=1;
    LW(83,122)=1;LW(83,123)=1;LW(83,124)=1;LW(83,125)=1;LW(83,126)=1;LW(83,127)=1;LW(83,128)=1;LW(83,129)=1;LW(83,130)=1;LW(83,131)=1;
    LW(83,132)=1;LW(83,133)=1;LW(83,134)=1;LW(83,135)=1;LW(83,137)=1;LW(83,138)=1;LW(83,139)=1;LW(83,140)=1;LW(83,147)=1;LW(83,149)=1;
    LW(83,150)=1;LW(83,151)=1;LW(83,156)=1;LW(83,157)=1;LW(83,158)=1;LW(83,159)=1;LW(83,163)=1;LW(83,164)=1;LW(83,165)=1;LW(83,172)=1;
    LW(84,6)=1;LW(84,7)=1;LW(84,8)=1;LW(84,9)=1;LW(84,12)=1;LW(84,13)=1;LW(84,14)=1;LW(84,15)=1;LW(84,16)=1;LW(84,18)=1;
    LW(84,19)=1;LW(84,20)=1;LW(84,21)=1;LW(84,22)=1;LW(84,23)=1;LW(84,24)=1;LW(84,25)=1;LW(84,26)=1;LW(84,27)=1;LW(84,28)=1;
    LW(84,29)=1;LW(84,30)=1;LW(84,31)=1;LW(84,32)=1;LW(84,33)=1;LW(84,34)=1;LW(84,35)=1;LW(84,36)=1;LW(84,37)=1;LW(84,38)=1;
    LW(84,39)=1;LW(84,40)=1;LW(84,41)=1;LW(84,42)=1;LW(84,43)=1;LW(84,44)=1;LW(84,45)=1;LW(84,46)=1;LW(84,47)=1;LW(84,48)=1;
    LW(84,49)=1;LW(84,50)=1;LW(84,51)=1;LW(84,52)=1;LW(84,53)=1;LW(84,54)=1;LW(84,55)=1;LW(84,56)=1;LW(84,57)=1;LW(84,58)=1;
    LW(84,59)=1;LW(84,60)=1;LW(84,61)=1;LW(84,62)=1;LW(84,63)=1;LW(84,64)=1;LW(84,65)=1;LW(84,66)=1;LW(84,67)=1;LW(84,68)=1;
    LW(84,69)=1;LW(84,70)=1;LW(84,71)=1;LW(84,72)=1;LW(84,73)=1;LW(84,74)=1;LW(84,75)=1;LW(84,76)=1;LW(84,77)=1;LW(84,78)=1;
    LW(84,79)=1;LW(84,80)=1;LW(84,81)=1;LW(84,82)=1;LW(84,83)=1;LW(84,84)=1;LW(84,85)=1;LW(84,86)=1;LW(84,87)=1;LW(84,88)=1;
    LW(84,89)=1;LW(84,90)=1;LW(84,91)=1;LW(84,92)=1;LW(84,93)=1;LW(84,94)=1;LW(84,95)=1;LW(84,96)=1;LW(84,97)=1;LW(84,98)=1;
    LW(84,99)=1;LW(84,100)=1;LW(84,101)=1;LW(84,102)=1;LW(84,103)=1;LW(84,104)=1;LW(84,105)=1;LW(84,106)=1;LW(84,107)=1;LW(84,108)=1;
    LW(84,109)=1;LW(84,110)=1;LW(84,111)=1;LW(84,112)=1;LW(84,113)=1;LW(84,114)=1;LW(84,115)=1;LW(84,116)=1;LW(84,117)=1;LW(84,118)=1;
    LW(84,119)=1;LW(84,120)=1;LW(84,121)=1;LW(84,122)=1;LW(84,123)=1;LW(84,124)=1;LW(84,125)=1;LW(84,126)=1;LW(84,127)=1;LW(84,128)=1;
    LW(84,129)=1;LW(84,130)=1;LW(84,131)=1;LW(84,132)=1;LW(84,133)=1;LW(84,134)=1;LW(84,135)=1;LW(84,136)=1;LW(84,137)=1;LW(84,138)=1;
    LW(84,139)=1;LW(84,140)=1;LW(84,141)=1;LW(84,142)=1;LW(84,143)=1;LW(84,144)=1;LW(84,145)=1;LW(84,146)=1;LW(84,147)=1;LW(84,148)=1;
    LW(84,149)=1;LW(84,150)=1;LW(84,151)=1;LW(84,152)=1;LW(84,153)=1;LW(84,154)=1;LW(84,155)=1;LW(84,156)=1;LW(84,157)=1;LW(84,158)=1;
    LW(84,159)=1;LW(84,160)=1;LW(84,162)=1;LW(84,163)=1;LW(84,164)=1;LW(84,165)=1;LW(84,166)=1;LW(84,167)=1;LW(84,171)=1;LW(84,172)=1;
    LW(84,173)=1;LW(84,174)=1;LW(84,178)=1;LW(84,179)=1;LW(84,180)=1;LW(85,5)=1;LW(85,6)=1;LW(85,7)=1;LW(85,8)=1;LW(85,9)=1;
    LW(85,10)=1;LW(85,11)=1;LW(85,12)=1;LW(85,13)=1;LW(85,14)=1;LW(85,15)=1;LW(85,16)=1;LW(85,17)=1;LW(85,18)=1;LW(85,19)=1;
    LW(85,20)=1;LW(85,21)=1;LW(85,22)=1;LW(85,23)=1;LW(85,24)=1;LW(85,25)=1;LW(85,26)=1;LW(85,27)=1;LW(85,28)=1;LW(85,29)=1;
    LW(85,30)=1;LW(85,31)=1;LW(85,32)=1;LW(85,33)=1;LW(85,34)=1;LW(85,35)=1;LW(85,36)=1;LW(85,37)=1;LW(85,38)=1;LW(85,39)=1;
    LW(85,40)=1;LW(85,41)=1;LW(85,42)=1;LW(85,43)=1;LW(85,44)=1;LW(85,45)=1;LW(85,46)=1;LW(85,47)=1;LW(85,48)=1;LW(85,49)=1;
    LW(85,50)=1;LW(85,51)=1;LW(85,52)=1;LW(85,53)=1;LW(85,54)=1;LW(85,55)=1;LW(85,56)=1;LW(85,57)=1;LW(85,58)=1;LW(85,59)=1;
    LW(85,60)=1;LW(85,61)=1;LW(85,62)=1;LW(85,63)=1;LW(85,64)=1;LW(85,65)=1;LW(85,66)=1;LW(85,67)=1;LW(85,68)=1;LW(85,69)=1;
    LW(85,70)=1;LW(85,71)=1;LW(85,72)=1;LW(85,73)=1;LW(85,74)=1;LW(85,75)=1;LW(85,76)=1;LW(85,77)=1;LW(85,78)=1;LW(85,79)=1;
    LW(85,80)=1;LW(85,81)=1;LW(85,82)=1;LW(85,83)=1;LW(85,84)=1;LW(85,85)=1;LW(85,86)=1;LW(85,87)=1;LW(85,88)=1;LW(85,89)=1;
    LW(85,90)=1;LW(85,91)=1;LW(85,92)=1;LW(85,93)=1;LW(85,94)=1;LW(85,95)=1;LW(85,96)=1;LW(85,97)=1;LW(85,98)=1;LW(85,99)=1;
    LW(85,100)=1;LW(85,101)=1;LW(85,102)=1;LW(85,103)=1;LW(85,104)=1;LW(85,105)=1;LW(85,106)=1;LW(85,107)=1;LW(85,108)=1;LW(85,109)=1;
    LW(85,110)=1;LW(85,111)=1;LW(85,112)=1;LW(85,113)=1;LW(85,114)=1;LW(85,115)=1;LW(85,116)=1;LW(85,117)=1;LW(85,118)=1;LW(85,119)=1;
    LW(85,120)=1;LW(85,121)=1;LW(85,122)=1;LW(85,123)=1;LW(85,124)=1;LW(85,125)=1;LW(85,126)=1;LW(85,127)=1;LW(85,128)=1;LW(85,129)=1;
    LW(85,130)=1;LW(85,131)=1;LW(85,132)=1;LW(85,133)=1;LW(85,134)=1;LW(85,135)=1;LW(85,136)=1;LW(85,137)=1;LW(85,138)=1;LW(85,139)=1;
    LW(85,140)=1;LW(85,141)=1;LW(85,142)=1;LW(85,143)=1;LW(85,144)=1;LW(85,145)=1;LW(85,146)=1;LW(85,147)=1;LW(85,148)=1;LW(85,149)=1;
    LW(85,150)=1;LW(85,151)=1;LW(85,152)=1;LW(85,153)=1;LW(85,154)=1;LW(85,155)=1;LW(85,156)=1;LW(85,157)=1;LW(85,158)=1;LW(85,159)=1;
    LW(85,160)=1;LW(85,161)=1;LW(85,162)=1;LW(85,163)=1;LW(85,164)=1;LW(85,165)=1;LW(85,166)=1;LW(85,167)=1;LW(85,168)=1;LW(85,169)=1;
    LW(85,170)=1;LW(85,171)=1;LW(85,172)=1;LW(85,173)=1;LW(85,174)=1;LW(85,175)=1;LW(85,176)=1;LW(85,177)=1;LW(85,178)=1;LW(85,179)=1;
    LW(85,180)=1;LW(85,181)=1;LW(85,182)=1;LW(85,183)=1;LW(85,184)=1;LW(85,185)=1;LW(85,186)=1;LW(85,187)=1;LW(85,188)=1;LW(85,200)=1;
    LW(85,201)=1;LW(86,1)=1;LW(86,2)=1;LW(86,3)=1;LW(86,4)=1;LW(86,5)=1;LW(86,6)=1;LW(86,7)=1;LW(86,8)=1;LW(86,9)=1;
    LW(86,10)=1;LW(86,11)=1;LW(86,12)=1;LW(86,13)=1;LW(86,14)=1;LW(86,15)=1;LW(86,16)=1;LW(86,17)=1;LW(86,18)=1;LW(86,19)=1;
    LW(86,20)=1;LW(86,21)=1;LW(86,22)=1;LW(86,23)=1;LW(86,24)=1;LW(86,25)=1;LW(86,26)=1;LW(86,27)=1;LW(86,28)=1;LW(86,29)=1;
    LW(86,30)=1;LW(86,31)=1;LW(86,32)=1;LW(86,33)=1;LW(86,34)=1;LW(86,35)=1;LW(86,36)=1;LW(86,37)=1;LW(86,38)=1;LW(86,39)=1;
    LW(86,40)=1;LW(86,41)=1;LW(86,42)=1;LW(86,43)=1;LW(86,44)=1;LW(86,45)=1;LW(86,46)=1;LW(86,47)=1;LW(86,48)=1;LW(86,49)=1;
    LW(86,50)=1;LW(86,51)=1;LW(86,52)=1;LW(86,53)=1;LW(86,54)=1;LW(86,55)=1;LW(86,56)=1;LW(86,57)=1;LW(86,58)=1;LW(86,59)=1;
    LW(86,60)=1;LW(86,61)=1;LW(86,62)=1;LW(86,63)=1;LW(86,64)=1;LW(86,65)=1;LW(86,66)=1;LW(86,67)=1;LW(86,68)=1;LW(86,69)=1;
    LW(86,70)=1;LW(86,71)=1;LW(86,72)=1;LW(86,73)=1;LW(86,74)=1;LW(86,75)=1;LW(86,76)=1;LW(86,77)=1;LW(86,78)=1;LW(86,79)=1;
    LW(86,80)=1;LW(86,81)=1;LW(86,82)=1;LW(86,83)=1;LW(86,84)=1;LW(86,85)=1;LW(86,86)=1;LW(86,87)=1;LW(86,88)=1;LW(86,89)=1;
    LW(86,90)=1;LW(86,91)=1;LW(86,92)=1;LW(86,93)=1;LW(86,94)=1;LW(86,95)=1;LW(86,96)=1;LW(86,97)=1;LW(86,98)=1;LW(86,99)=1;
    LW(86,100)=1;LW(86,101)=1;LW(86,102)=1;LW(86,103)=1;LW(86,104)=1;LW(86,105)=1;LW(86,106)=1;LW(86,107)=1;LW(86,108)=1;LW(86,109)=1;
    LW(86,110)=1;LW(86,111)=1;LW(86,112)=1;LW(86,113)=1;LW(86,114)=1;LW(86,115)=1;LW(86,116)=1;LW(86,117)=1;LW(86,118)=1;LW(86,119)=1;
    LW(86,120)=1;LW(86,121)=1;LW(86,122)=1;LW(86,123)=1;LW(86,124)=1;LW(86,125)=1;LW(86,126)=1;LW(86,127)=1;LW(86,128)=1;LW(86,129)=1;
    LW(86,130)=1;LW(86,131)=1;LW(86,132)=1;LW(86,133)=1;LW(86,134)=1;LW(86,135)=1;LW(86,136)=1;LW(86,137)=1;LW(86,138)=1;LW(86,139)=1;
    LW(86,140)=1;LW(86,141)=1;LW(86,142)=1;LW(86,143)=1;LW(86,144)=1;LW(86,145)=1;LW(86,146)=1;LW(86,147)=1;LW(86,148)=1;LW(86,149)=1;
    LW(86,150)=1;LW(86,151)=1;LW(86,152)=1;LW(86,153)=1;LW(86,154)=1;LW(86,155)=1;LW(86,156)=1;LW(86,157)=1;LW(86,158)=1;LW(86,159)=1;
    LW(86,160)=1;LW(86,161)=1;LW(86,162)=1;LW(86,163)=1;LW(86,164)=1;LW(86,165)=1;LW(86,166)=1;LW(86,167)=1;LW(86,168)=1;LW(86,169)=1;
    LW(86,170)=1;LW(86,171)=1;LW(86,172)=1;LW(86,173)=1;LW(86,174)=1;LW(86,175)=1;LW(86,176)=1;LW(86,177)=1;LW(86,178)=1;LW(86,179)=1;
    LW(86,180)=1;LW(86,181)=1;LW(86,182)=1;LW(86,183)=1;LW(86,184)=1;LW(86,185)=1;LW(86,186)=1;LW(86,187)=1;LW(86,188)=1;LW(86,189)=1;
    LW(86,190)=1;LW(86,191)=1;LW(86,192)=1;LW(86,193)=1;LW(86,194)=1;LW(86,195)=1;LW(86,199)=1;LW(86,200)=1;LW(86,201)=1;LW(86,202)=1;
    LW(86,203)=1;LW(86,206)=1;LW(86,207)=1;LW(86,208)=1;LW(86,213)=1;LW(86,214)=1;LW(87,1)=1;LW(87,2)=1;LW(87,3)=1;LW(87,4)=1;
    LW(87,5)=1;LW(87,6)=1;LW(87,7)=1;LW(87,8)=1;LW(87,9)=1;LW(87,10)=1;LW(87,11)=1;LW(87,12)=1;LW(87,13)=1;LW(87,14)=1;
    LW(87,15)=1;LW(87,16)=1;LW(87,17)=1;LW(87,18)=1;LW(87,19)=1;LW(87,20)=1;LW(87,21)=1;LW(87,22)=1;LW(87,23)=1;LW(87,24)=1;
    LW(87,25)=1;LW(87,26)=1;LW(87,27)=1;LW(87,28)=1;LW(87,29)=1;LW(87,30)=1;LW(87,31)=1;LW(87,32)=1;LW(87,33)=1;LW(87,34)=1;
    LW(87,35)=1;LW(87,36)=1;LW(87,37)=1;LW(87,38)=1;LW(87,39)=1;LW(87,40)=1;LW(87,41)=1;LW(87,42)=1;LW(87,43)=1;LW(87,44)=1;
    LW(87,45)=1;LW(87,46)=1;LW(87,47)=1;LW(87,48)=1;LW(87,49)=1;LW(87,50)=1;LW(87,51)=1;LW(87,52)=1;LW(87,53)=1;LW(87,54)=1;
    LW(87,55)=1;LW(87,56)=1;LW(87,57)=1;LW(87,58)=1;LW(87,59)=1;LW(87,60)=1;LW(87,61)=1;LW(87,62)=1;LW(87,63)=1;LW(87,64)=1;
    LW(87,65)=1;LW(87,66)=1;LW(87,67)=1;LW(87,68)=1;LW(87,69)=1;LW(87,70)=1;LW(87,71)=1;LW(87,72)=1;LW(87,73)=1;LW(87,74)=1;
    LW(87,75)=1;LW(87,76)=1;LW(87,77)=1;LW(87,78)=1;LW(87,79)=1;LW(87,80)=1;LW(87,81)=1;LW(87,82)=1;LW(87,83)=1;LW(87,84)=1;
    LW(87,85)=1;LW(87,86)=1;LW(87,87)=1;LW(87,88)=1;LW(87,89)=1;LW(87,90)=1;LW(87,91)=1;LW(87,92)=1;LW(87,93)=1;LW(87,94)=1;
    LW(87,95)=1;LW(87,96)=1;LW(87,97)=1;LW(87,98)=1;LW(87,99)=1;LW(87,100)=1;LW(87,101)=1;LW(87,102)=1;LW(87,103)=1;LW(87,104)=1;
    LW(87,105)=1;LW(87,106)=1;LW(87,107)=1;LW(87,108)=1;LW(87,109)=1;LW(87,110)=1;LW(87,111)=1;LW(87,112)=1;LW(87,113)=1;LW(87,114)=1;
    LW(87,115)=1;LW(87,116)=1;LW(87,117)=1;LW(87,118)=1;LW(87,119)=1;LW(87,120)=1;LW(87,121)=1;LW(87,122)=1;LW(87,123)=1;LW(87,124)=1;
    LW(87,125)=1;LW(87,126)=1;LW(87,127)=1;LW(87,128)=1;LW(87,129)=1;LW(87,130)=1;LW(87,131)=1;LW(87,132)=1;LW(87,133)=1;LW(87,134)=1;
    LW(87,135)=1;LW(87,136)=1;LW(87,137)=1;LW(87,138)=1;LW(87,139)=1;LW(87,140)=1;LW(87,141)=1;LW(87,142)=1;LW(87,143)=1;LW(87,144)=1;
    LW(87,145)=1;LW(87,146)=1;LW(87,147)=1;LW(87,148)=1;LW(87,149)=1;LW(87,150)=1;LW(87,151)=1;LW(87,152)=1;LW(87,153)=1;LW(87,154)=1;
    LW(87,155)=1;LW(87,156)=1;LW(87,157)=1;LW(87,158)=1;LW(87,159)=1;LW(87,160)=1;LW(87,161)=1;LW(87,162)=1;LW(87,163)=1;LW(87,164)=1;
    LW(87,165)=1;LW(87,166)=1;LW(87,167)=1;LW(87,168)=1;LW(87,169)=1;LW(87,170)=1;LW(87,171)=1;LW(87,172)=1;LW(87,173)=1;LW(87,174)=1;
    LW(87,175)=1;LW(87,176)=1;LW(87,177)=1;LW(87,178)=1;LW(87,179)=1;LW(87,180)=1;LW(87,181)=1;LW(87,182)=1;LW(87,183)=1;LW(87,184)=1;
    LW(87,185)=1;LW(87,186)=1;LW(87,187)=1;LW(87,188)=1;LW(87,189)=1;LW(87,190)=1;LW(87,191)=1;LW(87,192)=1;LW(87,193)=1;LW(87,194)=1;
    LW(87,195)=1;LW(87,196)=1;LW(87,197)=1;LW(87,198)=1;LW(87,199)=1;LW(87,200)=1;LW(87,201)=1;LW(87,202)=1;LW(87,203)=1;LW(87,204)=1;
    LW(87,205)=1;LW(87,206)=1;LW(87,207)=1;LW(87,208)=1;LW(87,209)=1;LW(87,210)=1;LW(87,211)=1;LW(87,212)=1;LW(87,213)=1;LW(87,214)=1;
    LW(87,215)=1;LW(87,216)=1;LW(87,220)=1;LW(87,221)=1;LW(88,1)=1;LW(88,2)=1;LW(88,3)=1;LW(88,4)=1;LW(88,5)=1;LW(88,6)=1;
    LW(88,7)=1;LW(88,8)=1;LW(88,9)=1;LW(88,10)=1;LW(88,11)=1;LW(88,12)=1;LW(88,13)=1;LW(88,14)=1;LW(88,15)=1;LW(88,16)=1;
    LW(88,17)=1;LW(88,18)=1;LW(88,19)=1;LW(88,20)=1;LW(88,21)=1;LW(88,22)=1;LW(88,23)=1;LW(88,24)=1;LW(88,25)=1;LW(88,26)=1;
    LW(88,27)=1;LW(88,28)=1;LW(88,29)=1;LW(88,30)=1;LW(88,31)=1;LW(88,32)=1;LW(88,33)=1;LW(88,34)=1;LW(88,35)=1;LW(88,36)=1;
    LW(88,37)=1;LW(88,38)=1;LW(88,39)=1;LW(88,40)=1;LW(88,41)=1;LW(88,42)=1;LW(88,43)=1;LW(88,44)=1;LW(88,45)=1;LW(88,46)=1;
    LW(88,47)=1;LW(88,48)=1;LW(88,49)=1;LW(88,50)=1;LW(88,51)=1;LW(88,52)=1;LW(88,53)=1;LW(88,54)=1;LW(88,55)=1;LW(88,56)=1;
    LW(88,57)=1;LW(88,58)=1;LW(88,59)=1;LW(88,60)=1;LW(88,61)=1;LW(88,62)=1;LW(88,63)=1;LW(88,64)=1;LW(88,65)=1;LW(88,66)=1;
    LW(88,67)=1;LW(88,68)=1;LW(88,69)=1;LW(88,70)=1;LW(88,71)=1;LW(88,72)=1;LW(88,73)=1;LW(88,74)=1;LW(88,75)=1;LW(88,76)=1;
    LW(88,77)=1;LW(88,78)=1;LW(88,79)=1;LW(88,80)=1;LW(88,81)=1;LW(88,82)=1;LW(88,83)=1;LW(88,84)=1;LW(88,85)=1;LW(88,86)=1;
    LW(88,87)=1;LW(88,88)=1;LW(88,89)=1;LW(88,90)=1;LW(88,91)=1;LW(88,92)=1;LW(88,93)=1;LW(88,94)=1;LW(88,95)=1;LW(88,96)=1;
    LW(88,97)=1;LW(88,98)=1;LW(88,99)=1;LW(88,100)=1;LW(88,101)=1;LW(88,102)=1;LW(88,103)=1;LW(88,104)=1;LW(88,105)=1;LW(88,106)=1;
    LW(88,107)=1;LW(88,108)=1;LW(88,109)=1;LW(88,110)=1;LW(88,111)=1;LW(88,112)=1;LW(88,113)=1;LW(88,114)=1;LW(88,115)=1;LW(88,116)=1;
    LW(88,117)=1;LW(88,118)=1;LW(88,119)=1;LW(88,120)=1;LW(88,121)=1;LW(88,122)=1;LW(88,123)=1;LW(88,124)=1;LW(88,125)=1;LW(88,126)=1;
    LW(88,127)=1;LW(88,128)=1;LW(88,129)=1;LW(88,130)=1;LW(88,131)=1;LW(88,132)=1;LW(88,133)=1;LW(88,134)=1;LW(88,135)=1;LW(88,136)=1;
    LW(88,137)=1;LW(88,138)=1;LW(88,139)=1;LW(88,140)=1;LW(88,141)=1;LW(88,142)=1;LW(88,143)=1;LW(88,144)=1;LW(88,145)=1;LW(88,146)=1;
    LW(88,147)=1;LW(88,148)=1;LW(88,149)=1;LW(88,150)=1;LW(88,151)=1;LW(88,152)=1;LW(88,153)=1;LW(88,154)=1;LW(88,155)=1;LW(88,156)=1;
    LW(88,157)=1;LW(88,158)=1;LW(88,159)=1;LW(88,160)=1;LW(88,161)=1;LW(88,162)=1;LW(88,163)=1;LW(88,164)=1;LW(88,165)=1;LW(88,166)=1;
    LW(88,167)=1;LW(88,168)=1;LW(88,169)=1;LW(88,170)=1;LW(88,171)=1;LW(88,172)=1;LW(88,173)=1;LW(88,174)=1;LW(88,175)=1;LW(88,176)=1;
    LW(88,177)=1;LW(88,178)=1;LW(88,179)=1;LW(88,180)=1;LW(88,181)=1;LW(88,182)=1;LW(88,183)=1;LW(88,184)=1;LW(88,185)=1;LW(88,186)=1;
    LW(88,187)=1;LW(88,188)=1;LW(88,189)=1;LW(88,190)=1;LW(88,191)=1;LW(88,192)=1;LW(88,193)=1;LW(88,194)=1;LW(88,195)=1;LW(88,196)=1;
    LW(88,197)=1;LW(88,198)=1;LW(88,199)=1;LW(88,200)=1;LW(88,201)=1;LW(88,202)=1;LW(88,203)=1;LW(88,204)=1;LW(88,205)=1;LW(88,206)=1;
    LW(88,207)=1;LW(88,208)=1;LW(88,209)=1;LW(88,210)=1;LW(88,211)=1;LW(88,212)=1;LW(88,213)=1;LW(88,214)=1;LW(88,215)=1;LW(88,216)=1;
    LW(88,217)=1;LW(88,218)=1;LW(88,219)=1;LW(88,220)=1;LW(88,221)=1;LW(88,222)=1;LW(89,1)=1;LW(89,2)=1;LW(89,3)=1;LW(89,4)=1;
    LW(89,5)=1;LW(89,6)=1;LW(89,7)=1;LW(89,8)=1;LW(89,9)=1;LW(89,10)=1;LW(89,11)=1;LW(89,12)=1;LW(89,13)=1;LW(89,14)=1;
    LW(89,15)=1;LW(89,16)=1;LW(89,17)=1;LW(89,18)=1;LW(89,19)=1;LW(89,20)=1;LW(89,21)=1;LW(89,22)=1;LW(89,23)=1;LW(89,24)=1;
    LW(89,25)=1;LW(89,26)=1;LW(89,27)=1;LW(89,28)=1;LW(89,29)=1;LW(89,30)=1;LW(89,31)=1;LW(89,32)=1;LW(89,33)=1;LW(89,34)=1;
    LW(89,35)=1;LW(89,36)=1;LW(89,37)=1;LW(89,38)=1;LW(89,39)=1;LW(89,40)=1;LW(89,41)=1;LW(89,42)=1;LW(89,43)=1;LW(89,44)=1;
    LW(89,45)=1;LW(89,46)=1;LW(89,47)=1;LW(89,48)=1;LW(89,49)=1;LW(89,50)=1;LW(89,51)=1;LW(89,52)=1;LW(89,53)=1;LW(89,54)=1;
    LW(89,55)=1;LW(89,56)=1;LW(89,57)=1;LW(89,58)=1;LW(89,59)=1;LW(89,60)=1;LW(89,61)=1;LW(89,62)=1;LW(89,63)=1;LW(89,64)=1;
    LW(89,65)=1;LW(89,66)=1;LW(89,67)=1;LW(89,68)=1;LW(89,69)=1;LW(89,70)=1;LW(89,71)=1;LW(89,72)=1;LW(89,73)=1;LW(89,74)=1;
    LW(89,75)=1;LW(89,76)=1;LW(89,77)=1;LW(89,78)=1;LW(89,79)=1;LW(89,80)=1;LW(89,81)=1;LW(89,82)=1;LW(89,83)=1;LW(89,84)=1;
    LW(89,85)=1;LW(89,86)=1;LW(89,87)=1;LW(89,88)=1;LW(89,89)=1;LW(89,90)=1;LW(89,91)=1;LW(89,92)=1;LW(89,93)=1;LW(89,94)=1;
    LW(89,95)=1;LW(89,96)=1;LW(89,97)=1;LW(89,98)=1;LW(89,99)=1;LW(89,100)=1;LW(89,101)=1;LW(89,102)=1;LW(89,103)=1;LW(89,104)=1;
    LW(89,105)=1;LW(89,106)=1;LW(89,107)=1;LW(89,108)=1;LW(89,109)=1;LW(89,110)=1;LW(89,111)=1;LW(89,112)=1;LW(89,113)=1;LW(89,114)=1;
    LW(89,115)=1;LW(89,116)=1;LW(89,117)=1;LW(89,118)=1;LW(89,119)=1;LW(89,120)=1;LW(89,121)=1;LW(89,122)=1;LW(89,123)=1;LW(89,124)=1;
    LW(89,125)=1;LW(89,126)=1;LW(89,127)=1;LW(89,128)=1;LW(89,129)=1;LW(89,130)=1;LW(89,131)=1;LW(89,132)=1;LW(89,133)=1;LW(89,134)=1;
    LW(89,135)=1;LW(89,136)=1;LW(89,137)=1;LW(89,138)=1;LW(89,139)=1;LW(89,140)=1;LW(89,141)=1;LW(89,142)=1;LW(89,143)=1;LW(89,144)=1;
    LW(89,145)=1;LW(89,146)=1;LW(89,147)=1;LW(89,148)=1;LW(89,149)=1;LW(89,150)=1;LW(89,151)=1;LW(89,152)=1;LW(89,153)=1;LW(89,154)=1;
    LW(89,155)=1;LW(89,156)=1;LW(89,157)=1;LW(89,158)=1;LW(89,159)=1;LW(89,160)=1;LW(89,161)=1;LW(89,162)=1;LW(89,163)=1;LW(89,164)=1;
    LW(89,165)=1;LW(89,166)=1;LW(89,167)=1;LW(89,168)=1;LW(89,169)=1;LW(89,170)=1;LW(89,171)=1;LW(89,172)=1;LW(89,173)=1;LW(89,174)=1;
    LW(89,175)=1;LW(89,176)=1;LW(89,177)=1;LW(89,178)=1;LW(89,179)=1;LW(89,180)=1;LW(89,181)=1;LW(89,182)=1;LW(89,183)=1;LW(89,184)=1;
    LW(89,185)=1;LW(89,186)=1;LW(89,187)=1;LW(89,188)=1;LW(89,189)=1;LW(89,190)=1;LW(89,191)=1;LW(89,192)=1;LW(89,193)=1;LW(89,194)=1;
    LW(89,195)=1;LW(89,196)=1;LW(89,197)=1;LW(89,198)=1;LW(89,199)=1;LW(89,200)=1;LW(89,201)=1;LW(89,202)=1;LW(89,203)=1;LW(89,204)=1;
    LW(89,205)=1;LW(89,206)=1;LW(89,207)=1;LW(89,208)=1;LW(89,209)=1;LW(89,210)=1;LW(89,211)=1;LW(89,212)=1;LW(89,213)=1;LW(89,214)=1;
    LW(89,215)=1;LW(89,216)=1;LW(89,217)=1;LW(89,218)=1;LW(89,219)=1;LW(89,220)=1;LW(89,221)=1;LW(89,222)=1;LW(89,223)=1;LW(89,224)=1;
    LW(89,225)=1;LW(89,226)=1;LW(89,227)=1;LW(89,228)=1;LW(89,229)=1;LW(89,235)=1;LW(90,1)=1;LW(90,2)=1;LW(90,3)=1;LW(90,4)=1;
    LW(90,5)=1;LW(90,6)=1;LW(90,7)=1;LW(90,8)=1;LW(90,9)=1;LW(90,10)=1;LW(90,11)=1;LW(90,12)=1;LW(90,13)=1;LW(90,14)=1;
    LW(90,15)=1;LW(90,16)=1;LW(90,17)=1;LW(90,18)=1;LW(90,19)=1;LW(90,20)=1;LW(90,21)=1;LW(90,22)=1;LW(90,23)=1;LW(90,24)=1;
    LW(90,25)=1;LW(90,26)=1;LW(90,27)=1;LW(90,28)=1;LW(90,29)=1;LW(90,30)=1;LW(90,31)=1;LW(90,32)=1;LW(90,33)=1;LW(90,34)=1;
    LW(90,35)=1;LW(90,36)=1;LW(90,37)=1;LW(90,38)=1;LW(90,39)=1;LW(90,40)=1;LW(90,41)=1;LW(90,42)=1;LW(90,43)=1;LW(90,44)=1;
    LW(90,45)=1;LW(90,46)=1;LW(90,47)=1;LW(90,48)=1;LW(90,49)=1;LW(90,50)=1;LW(90,51)=1;LW(90,52)=1;LW(90,53)=1;LW(90,54)=1;
    LW(90,55)=1;LW(90,56)=1;LW(90,57)=1;LW(90,58)=1;LW(90,59)=1;LW(90,60)=1;LW(90,61)=1;LW(90,62)=1;LW(90,63)=1;LW(90,64)=1;
    LW(90,65)=1;LW(90,66)=1;LW(90,67)=1;LW(90,68)=1;LW(90,69)=1;LW(90,70)=1;LW(90,71)=1;LW(90,72)=1;LW(90,73)=1;LW(90,74)=1;
    LW(90,75)=1;LW(90,76)=1;LW(90,77)=1;LW(90,78)=1;LW(90,79)=1;LW(90,80)=1;LW(90,81)=1;LW(90,82)=1;LW(90,83)=1;LW(90,84)=1;
    LW(90,85)=1;LW(90,86)=1;LW(90,87)=1;LW(90,88)=1;LW(90,89)=1;LW(90,90)=1;LW(90,91)=1;LW(90,92)=1;LW(90,93)=1;LW(90,94)=1;
    LW(90,95)=1;LW(90,96)=1;LW(90,97)=1;LW(90,98)=1;LW(90,99)=1;LW(90,100)=1;LW(90,101)=1;LW(90,102)=1;LW(90,103)=1;LW(90,104)=1;
    LW(90,105)=1;LW(90,106)=1;LW(90,107)=1;LW(90,108)=1;LW(90,109)=1;LW(90,110)=1;LW(90,111)=1;LW(90,112)=1;LW(90,113)=1;LW(90,114)=1;
    LW(90,115)=1;LW(90,116)=1;LW(90,117)=1;LW(90,118)=1;LW(90,119)=1;LW(90,120)=1;LW(90,121)=1;LW(90,122)=1;LW(90,123)=1;LW(90,124)=1;
    LW(90,125)=1;LW(90,126)=1;LW(90,127)=1;LW(90,128)=1;LW(90,129)=1;LW(90,130)=1;LW(90,131)=1;LW(90,132)=1;LW(90,133)=1;LW(90,134)=1;
    LW(90,135)=1;LW(90,136)=1;LW(90,137)=1;LW(90,138)=1;LW(90,139)=1;LW(90,140)=1;LW(90,141)=1;LW(90,142)=1;LW(90,143)=1;LW(90,144)=1;
    LW(90,145)=1;LW(90,146)=1;LW(90,147)=1;LW(90,148)=1;LW(90,149)=1;LW(90,150)=1;LW(90,151)=1;LW(90,152)=1;LW(90,153)=1;LW(90,154)=1;
    LW(90,155)=1;LW(90,156)=1;LW(90,157)=1;LW(90,158)=1;LW(90,159)=1;LW(90,160)=1;LW(90,161)=1;LW(90,162)=1;LW(90,163)=1;LW(90,164)=1;
    LW(90,165)=1;LW(90,166)=1;LW(90,167)=1;LW(90,168)=1;LW(90,169)=1;LW(90,170)=1;LW(90,171)=1;LW(90,172)=1;LW(90,173)=1;LW(90,174)=1;
    LW(90,175)=1;LW(90,176)=1;LW(90,177)=1;LW(90,178)=1;LW(90,179)=1;LW(90,180)=1;LW(90,181)=1;LW(90,182)=1;LW(90,183)=1;LW(90,184)=1;
    LW(90,185)=1;LW(90,186)=1;LW(90,187)=1;LW(90,188)=1;LW(90,189)=1;LW(90,190)=1;LW(90,191)=1;LW(90,192)=1;LW(90,193)=1;LW(90,194)=1;
    LW(90,195)=1;LW(90,196)=1;LW(90,197)=1;LW(90,198)=1;LW(90,199)=1;LW(90,200)=1;LW(90,201)=1;LW(90,202)=1;LW(90,203)=1;LW(90,204)=1;
    LW(90,205)=1;LW(90,206)=1;LW(90,207)=1;LW(90,208)=1;LW(90,209)=1;LW(90,210)=1;LW(90,211)=1;LW(90,212)=1;LW(90,213)=1;LW(90,214)=1;
    LW(90,215)=1;LW(90,216)=1;LW(90,217)=1;LW(90,218)=1;LW(90,219)=1;LW(90,220)=1;LW(90,221)=1;LW(90,222)=1;LW(90,223)=1;LW(90,224)=1;
    LW(90,225)=1;LW(90,226)=1;LW(90,227)=1;LW(90,228)=1;LW(90,229)=1;LW(90,230)=1;LW(90,234)=1;LW(90,235)=1;LW(90,236)=1;LW(91,1)=1;
    LW(91,2)=1;LW(91,3)=1;LW(91,4)=1;LW(91,5)=1;LW(91,6)=1;LW(91,7)=1;LW(91,8)=1;LW(91,9)=1;LW(91,10)=1;LW(91,11)=1;
    LW(91,12)=1;LW(91,13)=1;LW(91,14)=1;LW(91,15)=1;LW(91,16)=1;LW(91,17)=1;LW(91,18)=1;LW(91,19)=1;LW(91,20)=1;LW(91,21)=1;
    LW(91,22)=1;LW(91,23)=1;LW(91,24)=1;LW(91,25)=1;LW(91,26)=1;LW(91,27)=1;LW(91,28)=1;LW(91,29)=1;LW(91,30)=1;LW(91,31)=1;
    LW(91,32)=1;LW(91,33)=1;LW(91,34)=1;LW(91,35)=1;LW(91,36)=1;LW(91,37)=1;LW(91,38)=1;LW(91,39)=1;LW(91,40)=1;LW(91,41)=1;
    LW(91,42)=1;LW(91,43)=1;LW(91,44)=1;LW(91,45)=1;LW(91,46)=1;LW(91,47)=1;LW(91,48)=1;LW(91,49)=1;LW(91,50)=1;LW(91,51)=1;
    LW(91,52)=1;LW(91,53)=1;LW(91,54)=1;LW(91,55)=1;LW(91,56)=1;LW(91,57)=1;LW(91,58)=1;LW(91,59)=1;LW(91,60)=1;LW(91,61)=1;
    LW(91,62)=1;LW(91,63)=1;LW(91,64)=1;LW(91,65)=1;LW(91,66)=1;LW(91,67)=1;LW(91,68)=1;LW(91,69)=1;LW(91,70)=1;LW(91,71)=1;
    LW(91,72)=1;LW(91,73)=1;LW(91,74)=1;LW(91,75)=1;LW(91,76)=1;LW(91,77)=1;LW(91,78)=1;LW(91,79)=1;LW(91,80)=1;LW(91,81)=1;
    LW(91,82)=1;LW(91,83)=1;LW(91,84)=1;LW(91,85)=1;LW(91,86)=1;LW(91,87)=1;LW(91,88)=1;LW(91,89)=1;LW(91,90)=1;LW(91,91)=1;
    LW(91,92)=1;LW(91,93)=1;LW(91,94)=1;LW(91,95)=1;LW(91,96)=1;LW(91,97)=1;LW(91,98)=1;LW(91,99)=1;LW(91,100)=1;LW(91,101)=1;
    LW(91,102)=1;LW(91,103)=1;LW(91,104)=1;LW(91,105)=1;LW(91,106)=1;LW(91,107)=1;LW(91,108)=1;LW(91,109)=1;LW(91,110)=1;LW(91,111)=1;
    LW(91,112)=1;LW(91,113)=1;LW(91,114)=1;LW(91,115)=1;LW(91,116)=1;LW(91,117)=1;LW(91,118)=1;LW(91,119)=1;LW(91,120)=1;LW(91,121)=1;
    LW(91,122)=1;LW(91,123)=1;LW(91,124)=1;LW(91,125)=1;LW(91,126)=1;LW(91,127)=1;LW(91,128)=1;LW(91,129)=1;LW(91,130)=1;LW(91,131)=1;
    LW(91,132)=1;LW(91,133)=1;LW(91,134)=1;LW(91,135)=1;LW(91,136)=1;LW(91,137)=1;LW(91,138)=1;LW(91,139)=1;LW(91,140)=1;LW(91,141)=1;
    LW(91,142)=1;LW(91,143)=1;LW(91,144)=1;LW(91,145)=1;LW(91,146)=1;LW(91,147)=1;LW(91,148)=1;LW(91,149)=1;LW(91,150)=1;LW(91,151)=1;
    LW(91,152)=1;LW(91,153)=1;LW(91,154)=1;LW(91,155)=1;LW(91,156)=1;LW(91,157)=1;LW(91,158)=1;LW(91,159)=1;LW(91,160)=1;LW(91,161)=1;
    LW(91,162)=1;LW(91,163)=1;LW(91,164)=1;LW(91,165)=1;LW(91,166)=1;LW(91,167)=1;LW(91,168)=1;LW(91,169)=1;LW(91,170)=1;LW(91,171)=1;
    LW(91,172)=1;LW(91,173)=1;LW(91,174)=1;LW(91,175)=1;LW(91,176)=1;LW(91,177)=1;LW(91,178)=1;LW(91,179)=1;LW(91,180)=1;LW(91,181)=1;
    LW(91,182)=1;LW(91,183)=1;LW(91,184)=1;LW(91,185)=1;LW(91,186)=1;LW(91,187)=1;LW(91,188)=1;LW(91,189)=1;LW(91,190)=1;LW(91,191)=1;
    LW(91,192)=1;LW(91,193)=1;LW(91,194)=1;LW(91,195)=1;LW(91,196)=1;LW(91,197)=1;LW(91,198)=1;LW(91,199)=1;LW(91,200)=1;LW(91,201)=1;
    LW(91,202)=1;LW(91,203)=1;LW(91,204)=1;LW(91,205)=1;LW(91,206)=1;LW(91,207)=1;LW(91,208)=1;LW(91,209)=1;LW(91,210)=1;LW(91,211)=1;
    LW(91,212)=1;LW(91,213)=1;LW(91,214)=1;LW(91,215)=1;LW(91,216)=1;LW(91,217)=1;LW(91,218)=1;LW(91,219)=1;LW(91,220)=1;LW(91,221)=1;
    LW(91,222)=1;LW(91,223)=1;LW(91,224)=1;LW(91,225)=1;LW(91,226)=1;LW(91,227)=1;LW(91,228)=1;LW(91,229)=1;LW(91,230)=1;LW(91,231)=1;
    LW(91,234)=1;LW(91,235)=1;LW(91,236)=1;LW(91,237)=1;LW(91,238)=1;LW(91,239)=1;LW(91,240)=1;LW(91,241)=1;LW(91,242)=1;LW(92,1)=1;
    LW(92,2)=1;LW(92,3)=1;LW(92,4)=1;LW(92,5)=1;LW(92,6)=1;LW(92,7)=1;LW(92,8)=1;LW(92,9)=1;LW(92,10)=1;LW(92,11)=1;
    LW(92,12)=1;LW(92,13)=1;LW(92,14)=1;LW(92,15)=1;LW(92,16)=1;LW(92,17)=1;LW(92,18)=1;LW(92,19)=1;LW(92,20)=1;LW(92,21)=1;
    LW(92,22)=1;LW(92,23)=1;LW(92,24)=1;LW(92,25)=1;LW(92,26)=1;LW(92,27)=1;LW(92,28)=1;LW(92,29)=1;LW(92,30)=1;LW(92,31)=1;
    LW(92,32)=1;LW(92,33)=1;LW(92,34)=1;LW(92,35)=1;LW(92,36)=1;LW(92,37)=1;LW(92,38)=1;LW(92,39)=1;LW(92,40)=1;LW(92,41)=1;
    LW(92,42)=1;LW(92,43)=1;LW(92,44)=1;LW(92,45)=1;LW(92,46)=1;LW(92,47)=1;LW(92,48)=1;LW(92,49)=1;LW(92,50)=1;LW(92,51)=1;
    LW(92,52)=1;LW(92,53)=1;LW(92,54)=1;LW(92,55)=1;LW(92,56)=1;LW(92,57)=1;LW(92,58)=1;LW(92,59)=1;LW(92,60)=1;LW(92,61)=1;
    LW(92,62)=1;LW(92,63)=1;LW(92,64)=1;LW(92,65)=1;LW(92,66)=1;LW(92,67)=1;LW(92,68)=1;LW(92,69)=1;LW(92,70)=1;LW(92,71)=1;
    LW(92,72)=1;LW(92,73)=1;LW(92,74)=1;LW(92,75)=1;LW(92,76)=1;LW(92,77)=1;LW(92,78)=1;LW(92,79)=1;LW(92,80)=1;LW(92,81)=1;
    LW(92,82)=1;LW(92,83)=1;LW(92,84)=1;LW(92,85)=1;LW(92,86)=1;LW(92,87)=1;LW(92,88)=1;LW(92,89)=1;LW(92,90)=1;LW(92,91)=1;
    LW(92,92)=1;LW(92,93)=1;LW(92,94)=1;LW(92,95)=1;LW(92,96)=1;LW(92,97)=1;LW(92,98)=1;LW(92,99)=1;LW(92,100)=1;LW(92,101)=1;
    LW(92,102)=1;LW(92,103)=1;LW(92,104)=1;LW(92,105)=1;LW(92,106)=1;LW(92,107)=1;LW(92,108)=1;LW(92,109)=1;LW(92,110)=1;LW(92,111)=1;
    LW(92,112)=1;LW(92,113)=1;LW(92,114)=1;LW(92,115)=1;LW(92,116)=1;LW(92,117)=1;LW(92,118)=1;LW(92,119)=1;LW(92,120)=1;LW(92,121)=1;
    LW(92,122)=1;LW(92,123)=1;LW(92,124)=1;LW(92,125)=1;LW(92,126)=1;LW(92,127)=1;LW(92,128)=1;LW(92,129)=1;LW(92,130)=1;LW(92,131)=1;
    LW(92,132)=1;LW(92,133)=1;LW(92,134)=1;LW(92,135)=1;LW(92,136)=1;LW(92,137)=1;LW(92,138)=1;LW(92,139)=1;LW(92,140)=1;LW(92,141)=1;
    LW(92,142)=1;LW(92,143)=1;LW(92,144)=1;LW(92,145)=1;LW(92,146)=1;LW(92,147)=1;LW(92,148)=1;LW(92,149)=1;LW(92,150)=1;LW(92,151)=1;
    LW(92,152)=1;LW(92,153)=1;LW(92,154)=1;LW(92,155)=1;LW(92,156)=1;LW(92,157)=1;LW(92,158)=1;LW(92,159)=1;LW(92,160)=1;LW(92,161)=1;
    LW(92,162)=1;LW(92,163)=1;LW(92,164)=1;LW(92,165)=1;LW(92,166)=1;LW(92,167)=1;LW(92,168)=1;LW(92,169)=1;LW(92,170)=1;LW(92,171)=1;
    LW(92,172)=1;LW(92,173)=1;LW(92,174)=1;LW(92,175)=1;LW(92,176)=1;LW(92,177)=1;LW(92,178)=1;LW(92,179)=1;LW(92,180)=1;LW(92,181)=1;
    LW(92,182)=1;LW(92,183)=1;LW(92,184)=1;LW(92,185)=1;LW(92,186)=1;LW(92,187)=1;LW(92,188)=1;LW(92,189)=1;LW(92,190)=1;LW(92,191)=1;
    LW(92,192)=1;LW(92,193)=1;LW(92,194)=1;LW(92,195)=1;LW(92,196)=1;LW(92,197)=1;LW(92,198)=1;LW(92,199)=1;LW(92,200)=1;LW(92,201)=1;
    LW(92,202)=1;LW(92,203)=1;LW(92,204)=1;LW(92,205)=1;LW(92,206)=1;LW(92,207)=1;LW(92,208)=1;LW(92,209)=1;LW(92,210)=1;LW(92,211)=1;
    LW(92,212)=1;LW(92,213)=1;LW(92,214)=1;LW(92,215)=1;LW(92,216)=1;LW(92,217)=1;LW(92,218)=1;LW(92,219)=1;LW(92,220)=1;LW(92,221)=1;
    LW(92,222)=1;LW(92,223)=1;LW(92,224)=1;LW(92,225)=1;LW(92,226)=1;LW(92,227)=1;LW(92,228)=1;LW(92,229)=1;LW(92,230)=1;LW(92,231)=1;
    LW(92,232)=1;LW(92,233)=1;LW(92,234)=1;LW(92,235)=1;LW(92,236)=1;LW(92,237)=1;LW(92,238)=1;LW(92,239)=1;LW(92,240)=1;LW(92,241)=1;
    LW(92,242)=1;LW(92,243)=1;LW(92,244)=1;LW(92,245)=1;LW(92,246)=1;LW(92,247)=1;LW(92,248)=1;LW(92,249)=1;LW(93,1)=1;LW(93,2)=1;
    LW(93,3)=1;LW(93,4)=1;LW(93,5)=1;LW(93,6)=1;LW(93,7)=1;LW(93,8)=1;LW(93,9)=1;LW(93,10)=1;LW(93,11)=1;LW(93,12)=1;
    LW(93,13)=1;LW(93,14)=1;LW(93,15)=1;LW(93,16)=1;LW(93,17)=1;LW(93,18)=1;LW(93,19)=1;LW(93,20)=1;LW(93,21)=1;LW(93,22)=1;
    LW(93,23)=1;LW(93,24)=1;LW(93,25)=1;LW(93,26)=1;LW(93,27)=1;LW(93,28)=1;LW(93,29)=1;LW(93,30)=1;LW(93,31)=1;LW(93,32)=1;
    LW(93,33)=1;LW(93,34)=1;LW(93,35)=1;LW(93,36)=1;LW(93,37)=1;LW(93,38)=1;LW(93,39)=1;LW(93,40)=1;LW(93,41)=1;LW(93,42)=1;
    LW(93,43)=1;LW(93,44)=1;LW(93,45)=1;LW(93,46)=1;LW(93,47)=1;LW(93,48)=1;LW(93,49)=1;LW(93,50)=1;LW(93,51)=1;LW(93,52)=1;
    LW(93,53)=1;LW(93,54)=1;LW(93,55)=1;LW(93,56)=1;LW(93,57)=1;LW(93,58)=1;LW(93,59)=1;LW(93,60)=1;LW(93,61)=1;LW(93,62)=1;
    LW(93,63)=1;LW(93,64)=1;LW(93,65)=1;LW(93,66)=1;LW(93,67)=1;LW(93,68)=1;LW(93,69)=1;LW(93,70)=1;LW(93,71)=1;LW(93,72)=1;
    LW(93,73)=1;LW(93,74)=1;LW(93,75)=1;LW(93,76)=1;LW(93,77)=1;LW(93,78)=1;LW(93,79)=1;LW(93,80)=1;LW(93,81)=1;LW(93,82)=1;
    LW(93,83)=1;LW(93,84)=1;LW(93,85)=1;LW(93,86)=1;LW(93,87)=1;LW(93,88)=1;LW(93,89)=1;LW(93,90)=1;LW(93,91)=1;LW(93,92)=1;
    LW(93,93)=1;LW(93,94)=1;LW(93,95)=1;LW(93,96)=1;LW(93,97)=1;LW(93,98)=1;LW(93,99)=1;LW(93,100)=1;LW(93,101)=1;LW(93,102)=1;
    LW(93,103)=1;LW(93,104)=1;LW(93,105)=1;LW(93,106)=1;LW(93,107)=1;LW(93,108)=1;LW(93,109)=1;LW(93,110)=1;LW(93,111)=1;LW(93,112)=1;
    LW(93,113)=1;LW(93,114)=1;LW(93,115)=1;LW(93,116)=1;LW(93,117)=1;LW(93,118)=1;LW(93,119)=1;LW(93,120)=1;LW(93,121)=1;LW(93,122)=1;
    LW(93,123)=1;LW(93,124)=1;LW(93,125)=1;LW(93,126)=1;LW(93,127)=1;LW(93,128)=1;LW(93,129)=1;LW(93,130)=1;LW(93,131)=1;LW(93,132)=1;
    LW(93,133)=1;LW(93,134)=1;LW(93,135)=1;LW(93,136)=1;LW(93,137)=1;LW(93,138)=1;LW(93,139)=1;LW(93,140)=1;LW(93,141)=1;LW(93,142)=1;
    LW(93,143)=1;LW(93,144)=1;LW(93,145)=1;LW(93,146)=1;LW(93,147)=1;LW(93,148)=1;LW(93,149)=1;LW(93,150)=1;LW(93,151)=1;LW(93,152)=1;
    LW(93,153)=1;LW(93,154)=1;LW(93,155)=1;LW(93,156)=1;LW(93,157)=1;LW(93,158)=1;LW(93,159)=1;LW(93,160)=1;LW(93,161)=1;LW(93,162)=1;
    LW(93,163)=1;LW(93,164)=1;LW(93,165)=1;LW(93,166)=1;LW(93,167)=1;LW(93,168)=1;LW(93,169)=1;LW(93,170)=1;LW(93,171)=1;LW(93,172)=1;
    LW(93,173)=1;LW(93,174)=1;LW(93,175)=1;LW(93,176)=1;LW(93,177)=1;LW(93,178)=1;LW(93,179)=1;LW(93,180)=1;LW(93,181)=1;LW(93,182)=1;
    LW(93,183)=1;LW(93,184)=1;LW(93,185)=1;LW(93,186)=1;LW(93,187)=1;LW(93,188)=1;LW(93,189)=1;LW(93,190)=1;LW(93,191)=1;LW(93,192)=1;
    LW(93,193)=1;LW(93,194)=1;LW(93,195)=1;LW(93,196)=1;LW(93,197)=1;LW(93,198)=1;LW(93,199)=1;LW(93,200)=1;LW(93,201)=1;LW(93,202)=1;
    LW(93,203)=1;LW(93,204)=1;LW(93,205)=1;LW(93,206)=1;LW(93,207)=1;LW(93,208)=1;LW(93,209)=1;LW(93,210)=1;LW(93,211)=1;LW(93,212)=1;
    LW(93,213)=1;LW(93,214)=1;LW(93,215)=1;LW(93,216)=1;LW(93,217)=1;LW(93,218)=1;LW(93,219)=1;LW(93,220)=1;LW(93,221)=1;LW(93,222)=1;
    LW(93,223)=1;LW(93,224)=1;LW(93,225)=1;LW(93,226)=1;LW(93,227)=1;LW(93,228)=1;LW(93,229)=1;LW(93,230)=1;LW(93,231)=1;LW(93,232)=1;
    LW(93,233)=1;LW(93,234)=1;LW(93,235)=1;LW(93,236)=1;LW(93,237)=1;LW(93,238)=1;LW(93,239)=1;LW(93,240)=1;LW(93,241)=1;LW(93,242)=1;
    LW(93,243)=1;LW(93,244)=1;LW(93,245)=1;LW(93,246)=1;LW(93,247)=1;LW(93,248)=1;LW(93,249)=1;LW(93,250)=1;LW(93,251)=1;LW(93,252)=1;
    LW(93,253)=1;LW(93,254)=1;LW(93,255)=1;LW(93,256)=1;LW(94,1)=1;LW(94,2)=1;LW(94,3)=1;LW(94,4)=1;LW(94,5)=1;LW(94,6)=1;
    LW(94,7)=1;LW(94,8)=1;LW(94,9)=1;LW(94,10)=1;LW(94,11)=1;LW(94,12)=1;LW(94,13)=1;LW(94,14)=1;LW(94,15)=1;LW(94,16)=1;
    LW(94,17)=1;LW(94,18)=1;LW(94,19)=1;LW(94,20)=1;LW(94,21)=1;LW(94,22)=1;LW(94,23)=1;LW(94,24)=1;LW(94,25)=1;LW(94,26)=1;
    LW(94,27)=1;LW(94,28)=1;LW(94,29)=1;LW(94,30)=1;LW(94,31)=1;LW(94,32)=1;LW(94,33)=1;LW(94,34)=1;LW(94,35)=1;LW(94,36)=1;
    LW(94,37)=1;LW(94,38)=1;LW(94,39)=1;LW(94,40)=1;LW(94,41)=1;LW(94,42)=1;LW(94,43)=1;LW(94,44)=1;LW(94,45)=1;LW(94,46)=1;
    LW(94,47)=1;LW(94,48)=1;LW(94,49)=1;LW(94,50)=1;LW(94,51)=1;LW(94,52)=1;LW(94,53)=1;LW(94,54)=1;LW(94,55)=1;LW(94,56)=1;
    LW(94,57)=1;LW(94,58)=1;LW(94,59)=1;LW(94,60)=1;LW(94,61)=1;LW(94,62)=1;LW(94,63)=1;LW(94,64)=1;LW(94,65)=1;LW(94,66)=1;
    LW(94,67)=1;LW(94,68)=1;LW(94,69)=1;LW(94,70)=1;LW(94,71)=1;LW(94,72)=1;LW(94,73)=1;LW(94,74)=1;LW(94,75)=1;LW(94,76)=1;
    LW(94,77)=1;LW(94,78)=1;LW(94,79)=1;LW(94,80)=1;LW(94,81)=1;LW(94,82)=1;LW(94,83)=1;LW(94,84)=1;LW(94,85)=1;LW(94,86)=1;
    LW(94,87)=1;LW(94,88)=1;LW(94,89)=1;LW(94,90)=1;LW(94,91)=1;LW(94,92)=1;LW(94,93)=1;LW(94,94)=1;LW(94,95)=1;LW(94,96)=1;
    LW(94,97)=1;LW(94,98)=1;LW(94,99)=1;LW(94,100)=1;LW(94,101)=1;LW(94,102)=1;LW(94,103)=1;LW(94,104)=1;LW(94,105)=1;LW(94,106)=1;
    LW(94,107)=1;LW(94,108)=1;LW(94,109)=1;LW(94,110)=1;LW(94,111)=1;LW(94,112)=1;LW(94,113)=1;LW(94,114)=1;LW(94,115)=1;LW(94,116)=1;
    LW(94,117)=1;LW(94,118)=1;LW(94,119)=1;LW(94,120)=1;LW(94,121)=1;LW(94,122)=1;LW(94,123)=1;LW(94,124)=1;LW(94,125)=1;LW(94,126)=1;
    LW(94,127)=1;LW(94,128)=1;LW(94,129)=1;LW(94,130)=1;LW(94,131)=1;LW(94,132)=1;LW(94,133)=1;LW(94,134)=1;LW(94,135)=1;LW(94,136)=1;
    LW(94,137)=1;LW(94,138)=1;LW(94,139)=1;LW(94,140)=1;LW(94,141)=1;LW(94,142)=1;LW(94,143)=1;LW(94,144)=1;LW(94,145)=1;LW(94,146)=1;
    LW(94,147)=1;LW(94,148)=1;LW(94,149)=1;LW(94,150)=1;LW(94,151)=1;LW(94,152)=1;LW(94,153)=1;LW(94,154)=1;LW(94,155)=1;LW(94,156)=1;
    LW(94,157)=1;LW(94,158)=1;LW(94,159)=1;LW(94,160)=1;LW(94,161)=1;LW(94,162)=1;LW(94,163)=1;LW(94,164)=1;LW(94,165)=1;LW(94,166)=1;
    LW(94,167)=1;LW(94,168)=1;LW(94,169)=1;LW(94,170)=1;LW(94,171)=1;LW(94,172)=1;LW(94,173)=1;LW(94,174)=1;LW(94,175)=1;LW(94,176)=1;
    LW(94,177)=1;LW(94,178)=1;LW(94,179)=1;LW(94,180)=1;LW(94,181)=1;LW(94,182)=1;LW(94,183)=1;LW(94,184)=1;LW(94,185)=1;LW(94,186)=1;
    LW(94,187)=1;LW(94,188)=1;LW(94,189)=1;LW(94,190)=1;LW(94,191)=1;LW(94,192)=1;LW(94,193)=1;LW(94,194)=1;LW(94,195)=1;LW(94,196)=1;
    LW(94,197)=1;LW(94,198)=1;LW(94,199)=1;LW(94,200)=1;LW(94,201)=1;LW(94,202)=1;LW(94,203)=1;LW(94,204)=1;LW(94,205)=1;LW(94,206)=1;
    LW(94,207)=1;LW(94,208)=1;LW(94,209)=1;LW(94,210)=1;LW(94,211)=1;LW(94,212)=1;LW(94,213)=1;LW(94,214)=1;LW(94,215)=1;LW(94,216)=1;
    LW(94,217)=1;LW(94,218)=1;LW(94,219)=1;LW(94,220)=1;LW(94,221)=1;LW(94,222)=1;LW(94,223)=1;LW(94,224)=1;LW(94,225)=1;LW(94,226)=1;
    LW(94,227)=1;LW(94,228)=1;LW(94,229)=1;LW(94,230)=1;LW(94,231)=1;LW(94,232)=1;LW(94,233)=1;LW(94,234)=1;LW(94,235)=1;LW(94,236)=1;
    LW(94,237)=1;LW(94,238)=1;LW(94,239)=1;LW(94,240)=1;LW(94,241)=1;LW(94,242)=1;LW(94,243)=1;LW(94,244)=1;LW(94,245)=1;LW(94,246)=1;
    LW(94,247)=1;LW(94,248)=1;LW(94,249)=1;LW(94,250)=1;LW(94,251)=1;LW(94,252)=1;LW(94,253)=1;LW(94,254)=1;LW(94,255)=1;LW(94,256)=1;
    LW(94,257)=1;LW(94,258)=1;LW(94,259)=1;LW(94,260)=1;LW(94,261)=1;LW(95,1)=1;LW(95,2)=1;LW(95,3)=1;LW(95,4)=1;LW(95,5)=1;
    LW(95,6)=1;LW(95,7)=1;LW(95,8)=1;LW(95,9)=1;LW(95,10)=1;LW(95,11)=1;LW(95,12)=1;LW(95,13)=1;LW(95,14)=1;LW(95,15)=1;
    LW(95,16)=1;LW(95,17)=1;LW(95,18)=1;LW(95,19)=1;LW(95,20)=1;LW(95,21)=1;LW(95,22)=1;LW(95,23)=1;LW(95,24)=1;LW(95,25)=1;
    LW(95,26)=1;LW(95,27)=1;LW(95,28)=1;LW(95,29)=1;LW(95,30)=1;LW(95,31)=1;LW(95,32)=1;LW(95,33)=1;LW(95,34)=1;LW(95,35)=1;
    LW(95,36)=1;LW(95,37)=1;LW(95,38)=1;LW(95,39)=1;LW(95,40)=1;LW(95,41)=1;LW(95,42)=1;LW(95,43)=1;LW(95,44)=1;LW(95,45)=1;
    LW(95,46)=1;LW(95,47)=1;LW(95,48)=1;LW(95,49)=1;LW(95,50)=1;LW(95,51)=1;LW(95,52)=1;LW(95,53)=1;LW(95,54)=1;LW(95,55)=1;
    LW(95,56)=1;LW(95,57)=1;LW(95,58)=1;LW(95,59)=1;LW(95,60)=1;LW(95,61)=1;LW(95,62)=1;LW(95,63)=1;LW(95,64)=1;LW(95,65)=1;
    LW(95,66)=1;LW(95,67)=1;LW(95,68)=1;LW(95,69)=1;LW(95,70)=1;LW(95,71)=1;LW(95,72)=1;LW(95,73)=1;LW(95,74)=1;LW(95,75)=1;
    LW(95,76)=1;LW(95,77)=1;LW(95,78)=1;LW(95,79)=1;LW(95,80)=1;LW(95,81)=1;LW(95,82)=1;LW(95,83)=1;LW(95,84)=1;LW(95,85)=1;
    LW(95,86)=1;LW(95,87)=1;LW(95,88)=1;LW(95,89)=1;LW(95,90)=1;LW(95,91)=1;LW(95,92)=1;LW(95,93)=1;LW(95,94)=1;LW(95,95)=1;
    LW(95,96)=1;LW(95,97)=1;LW(95,98)=1;LW(95,99)=1;LW(95,100)=1;LW(95,101)=1;LW(95,102)=1;LW(95,103)=1;LW(95,104)=1;LW(95,105)=1;
    LW(95,106)=1;LW(95,107)=1;LW(95,108)=1;LW(95,109)=1;LW(95,110)=1;LW(95,111)=1;LW(95,112)=1;LW(95,113)=1;LW(95,114)=1;LW(95,115)=1;
    LW(95,116)=1;LW(95,117)=1;LW(95,118)=1;LW(95,119)=1;LW(95,120)=1;LW(95,121)=1;LW(95,122)=1;LW(95,123)=1;LW(95,124)=1;LW(95,125)=1;
    LW(95,126)=1;LW(95,127)=1;LW(95,128)=1;LW(95,129)=1;LW(95,130)=1;LW(95,131)=1;LW(95,132)=1;LW(95,133)=1;LW(95,134)=1;LW(95,135)=1;
    LW(95,136)=1;LW(95,137)=1;LW(95,138)=1;LW(95,139)=1;LW(95,140)=1;LW(95,141)=1;LW(95,142)=1;LW(95,143)=1;LW(95,144)=1;LW(95,145)=1;
    LW(95,146)=1;LW(95,147)=1;LW(95,148)=1;LW(95,149)=1;LW(95,150)=1;LW(95,151)=1;LW(95,152)=1;LW(95,153)=1;LW(95,154)=1;LW(95,155)=1;
    LW(95,156)=1;LW(95,157)=1;LW(95,158)=1;LW(95,159)=1;LW(95,160)=1;LW(95,161)=1;LW(95,162)=1;LW(95,163)=1;LW(95,164)=1;LW(95,165)=1;
    LW(95,166)=1;LW(95,167)=1;LW(95,168)=1;LW(95,169)=1;LW(95,170)=1;LW(95,171)=1;LW(95,172)=1;LW(95,173)=1;LW(95,174)=1;LW(95,175)=1;
    LW(95,176)=1;LW(95,177)=1;LW(95,178)=1;LW(95,179)=1;LW(95,180)=1;LW(95,181)=1;LW(95,182)=1;LW(95,183)=1;LW(95,184)=1;LW(95,185)=1;
    LW(95,186)=1;LW(95,187)=1;LW(95,188)=1;LW(95,189)=1;LW(95,190)=1;LW(95,191)=1;LW(95,192)=1;LW(95,193)=1;LW(95,194)=1;LW(95,195)=1;
    LW(95,196)=1;LW(95,197)=1;LW(95,198)=1;LW(95,199)=1;LW(95,200)=1;LW(95,201)=1;LW(95,202)=1;LW(95,203)=1;LW(95,204)=1;LW(95,205)=1;
    LW(95,206)=1;LW(95,207)=1;LW(95,208)=1;LW(95,209)=1;LW(95,210)=1;LW(95,211)=1;LW(95,212)=1;LW(95,213)=1;LW(95,214)=1;LW(95,215)=1;
    LW(95,216)=1;LW(95,217)=1;LW(95,218)=1;LW(95,219)=1;LW(95,220)=1;LW(95,221)=1;LW(95,222)=1;LW(95,223)=1;LW(95,224)=1;LW(95,225)=1;
    LW(95,226)=1;LW(95,227)=1;LW(95,228)=1;LW(95,229)=1;LW(95,230)=1;LW(95,231)=1;LW(95,232)=1;LW(95,233)=1;LW(95,234)=1;LW(95,235)=1;
    LW(95,236)=1;LW(95,237)=1;LW(95,238)=1;LW(95,239)=1;LW(95,240)=1;LW(95,241)=1;LW(95,242)=1;LW(95,243)=1;LW(95,244)=1;LW(95,245)=1;
    LW(95,246)=1;LW(95,247)=1;LW(95,248)=1;LW(95,249)=1;LW(95,250)=1;LW(95,251)=1;LW(95,252)=1;LW(95,253)=1;LW(95,254)=1;LW(95,255)=1;
    LW(95,256)=1;LW(95,257)=1;LW(95,258)=1;LW(95,259)=1;LW(95,260)=1;LW(95,261)=1;LW(95,262)=1;LW(95,263)=1;LW(95,264)=1;LW(95,265)=1;
    LW(95,266)=1;LW(95,267)=1;LW(95,268)=1;LW(95,269)=1;LW(96,1)=1;LW(96,2)=1;LW(96,3)=1;LW(96,4)=1;LW(96,5)=1;LW(96,6)=1;
    LW(96,7)=1;LW(96,8)=1;LW(96,9)=1;LW(96,10)=1;LW(96,11)=1;LW(96,12)=1;LW(96,13)=1;LW(96,14)=1;LW(96,15)=1;LW(96,16)=1;
    LW(96,17)=1;LW(96,18)=1;LW(96,19)=1;LW(96,20)=1;LW(96,21)=1;LW(96,22)=1;LW(96,23)=1;LW(96,24)=1;LW(96,25)=1;LW(96,26)=1;
    LW(96,27)=1;LW(96,28)=1;LW(96,29)=1;LW(96,30)=1;LW(96,31)=1;LW(96,32)=1;LW(96,33)=1;LW(96,34)=1;LW(96,35)=1;LW(96,36)=1;
    LW(96,37)=1;LW(96,38)=1;LW(96,39)=1;LW(96,40)=1;LW(96,41)=1;LW(96,42)=1;LW(96,43)=1;LW(96,44)=1;LW(96,45)=1;LW(96,46)=1;
    LW(96,47)=1;LW(96,48)=1;LW(96,49)=1;LW(96,50)=1;LW(96,51)=1;LW(96,52)=1;LW(96,53)=1;LW(96,54)=1;LW(96,55)=1;LW(96,56)=1;
    LW(96,57)=1;LW(96,58)=1;LW(96,59)=1;LW(96,60)=1;LW(96,61)=1;LW(96,62)=1;LW(96,63)=1;LW(96,64)=1;LW(96,65)=1;LW(96,66)=1;
    LW(96,71)=1;LW(96,72)=1;LW(96,73)=1;LW(96,74)=1;LW(96,75)=1;LW(96,76)=1;LW(96,81)=1;LW(96,82)=1;LW(96,83)=1;LW(96,84)=1;
    LW(96,85)=1;LW(96,86)=1;LW(96,87)=1;LW(96,88)=1;LW(96,89)=1;LW(96,90)=1;LW(96,91)=1;LW(96,92)=1;LW(96,93)=1;LW(96,94)=1;
    LW(96,95)=1;LW(96,96)=1;LW(96,97)=1;LW(96,98)=1;LW(96,99)=1;LW(96,100)=1;LW(96,101)=1;LW(96,102)=1;LW(96,103)=1;LW(96,104)=1;
    LW(96,105)=1;LW(96,106)=1;LW(96,107)=1;LW(96,108)=1;LW(96,109)=1;LW(96,110)=1;LW(96,111)=1;LW(96,112)=1;LW(96,113)=1;LW(96,114)=1;
    LW(96,115)=1;LW(96,116)=1;LW(96,117)=1;LW(96,118)=1;LW(96,119)=1;LW(96,120)=1;LW(96,121)=1;LW(96,122)=1;LW(96,123)=1;LW(96,124)=1;
    LW(96,125)=1;LW(96,126)=1;LW(96,127)=1;LW(96,128)=1;LW(96,129)=1;LW(96,130)=1;LW(96,131)=1;LW(96,132)=1;LW(96,133)=1;LW(96,134)=1;
    LW(96,135)=1;LW(96,136)=1;LW(96,137)=1;LW(96,138)=1;LW(96,139)=1;LW(96,140)=1;LW(96,141)=1;LW(96,142)=1;LW(96,143)=1;LW(96,144)=1;
    LW(96,145)=1;LW(96,146)=1;LW(96,147)=1;LW(96,148)=1;LW(96,149)=1;LW(96,150)=1;LW(96,151)=1;LW(96,152)=1;LW(96,153)=1;LW(96,154)=1;
    LW(96,155)=1;LW(96,156)=1;LW(96,157)=1;LW(96,158)=1;LW(96,159)=1;LW(96,160)=1;LW(96,161)=1;LW(96,162)=1;LW(96,163)=1;LW(96,164)=1;
    LW(96,165)=1;LW(96,166)=1;LW(96,167)=1;LW(96,168)=1;LW(96,169)=1;LW(96,170)=1;LW(96,171)=1;LW(96,172)=1;LW(96,173)=1;LW(96,174)=1;
    LW(96,175)=1;LW(96,176)=1;LW(96,177)=1;LW(96,178)=1;LW(96,179)=1;LW(96,180)=1;LW(96,181)=1;LW(96,182)=1;LW(96,183)=1;LW(96,184)=1;
    LW(96,185)=1;LW(96,186)=1;LW(96,187)=1;LW(96,188)=1;LW(96,189)=1;LW(96,190)=1;LW(96,191)=1;LW(96,192)=1;LW(96,193)=1;LW(96,194)=1;
    LW(96,195)=1;LW(96,196)=1;LW(96,197)=1;LW(96,198)=1;LW(96,199)=1;LW(96,200)=1;LW(96,201)=1;LW(96,202)=1;LW(96,203)=1;LW(96,204)=1;
    LW(96,205)=1;LW(96,206)=1;LW(96,207)=1;LW(96,208)=1;LW(96,209)=1;LW(96,210)=1;LW(96,211)=1;LW(96,212)=1;LW(96,213)=1;LW(96,214)=1;
    LW(96,215)=1;LW(96,216)=1;LW(96,217)=1;LW(96,218)=1;LW(96,219)=1;LW(96,220)=1;LW(96,221)=1;LW(96,222)=1;LW(96,223)=1;LW(96,224)=1;
    LW(96,225)=1;LW(96,226)=1;LW(96,227)=1;LW(96,228)=1;LW(96,229)=1;LW(96,230)=1;LW(96,231)=1;LW(96,232)=1;LW(96,233)=1;LW(96,234)=1;
    LW(96,235)=1;LW(96,236)=1;LW(96,237)=1;LW(96,238)=1;LW(96,239)=1;LW(96,240)=1;LW(96,241)=1;LW(96,242)=1;LW(96,243)=1;LW(96,244)=1;
    LW(96,245)=1;LW(96,246)=1;LW(96,247)=1;LW(96,248)=1;LW(96,249)=1;LW(96,250)=1;LW(96,251)=1;LW(96,252)=1;LW(96,253)=1;LW(96,254)=1;
    LW(96,255)=1;LW(96,256)=1;LW(96,257)=1;LW(96,258)=1;LW(96,259)=1;LW(96,260)=1;LW(96,261)=1;LW(96,262)=1;LW(96,263)=1;LW(96,264)=1;
    LW(96,265)=1;LW(96,266)=1;LW(96,267)=1;LW(96,268)=1;LW(96,269)=1;LW(96,270)=1;LW(97,1)=1;LW(97,2)=1;LW(97,3)=1;LW(97,4)=1;
    LW(97,5)=1;LW(97,6)=1;LW(97,7)=1;LW(97,8)=1;LW(97,9)=1;LW(97,10)=1;LW(97,11)=1;LW(97,12)=1;LW(97,13)=1;LW(97,14)=1;
    LW(97,15)=1;LW(97,16)=1;LW(97,17)=1;LW(97,18)=1;LW(97,19)=1;LW(97,20)=1;LW(97,21)=1;LW(97,22)=1;LW(97,23)=1;LW(97,24)=1;
    LW(97,25)=1;LW(97,26)=1;LW(97,27)=1;LW(97,28)=1;LW(97,29)=1;LW(97,30)=1;LW(97,31)=1;LW(97,32)=1;LW(97,33)=1;LW(97,34)=1;
    LW(97,35)=1;LW(97,36)=1;LW(97,37)=1;LW(97,38)=1;LW(97,39)=1;LW(97,40)=1;LW(97,41)=1;LW(97,42)=1;LW(97,43)=1;LW(97,44)=1;
    LW(97,45)=1;LW(97,46)=1;LW(97,47)=1;LW(97,48)=1;LW(97,49)=1;LW(97,50)=1;LW(97,51)=1;LW(97,52)=1;LW(97,53)=1;LW(97,54)=1;
    LW(97,55)=1;LW(97,56)=1;LW(97,57)=1;LW(97,58)=1;LW(97,59)=1;LW(97,63)=1;LW(97,64)=1;LW(97,65)=1;LW(97,66)=1;LW(97,73)=1;
    LW(97,74)=1;LW(97,75)=1;LW(97,86)=1;LW(97,87)=1;LW(97,88)=1;LW(97,89)=1;LW(97,90)=1;LW(97,91)=1;LW(97,92)=1;LW(97,93)=1;
    LW(97,94)=1;LW(97,95)=1;LW(97,96)=1;LW(97,105)=1;LW(97,106)=1;LW(97,107)=1;LW(97,108)=1;LW(97,109)=1;LW(97,110)=1;LW(97,111)=1;
    LW(97,112)=1;LW(97,113)=1;LW(97,114)=1;LW(97,115)=1;LW(97,116)=1;LW(97,117)=1;LW(97,118)=1;LW(97,119)=1;LW(97,120)=1;LW(97,121)=1;
    LW(97,122)=1;LW(97,123)=1;LW(97,124)=1;LW(97,125)=1;LW(97,126)=1;LW(97,127)=1;LW(97,128)=1;LW(97,129)=1;LW(97,130)=1;LW(97,131)=1;
    LW(97,132)=1;LW(97,133)=1;LW(97,134)=1;LW(97,135)=1;LW(97,136)=1;LW(97,137)=1;LW(97,138)=1;LW(97,139)=1;LW(97,140)=1;LW(97,141)=1;
    LW(97,142)=1;LW(97,143)=1;LW(97,144)=1;LW(97,145)=1;LW(97,146)=1;LW(97,147)=1;LW(97,148)=1;LW(97,149)=1;LW(97,150)=1;LW(97,151)=1;
    LW(97,152)=1;LW(97,153)=1;LW(97,154)=1;LW(97,155)=1;LW(97,156)=1;LW(97,157)=1;LW(97,158)=1;LW(97,159)=1;LW(97,160)=1;LW(97,161)=1;
    LW(97,162)=1;LW(97,163)=1;LW(97,164)=1;LW(97,165)=1;LW(97,166)=1;LW(97,167)=1;LW(97,168)=1;LW(97,169)=1;LW(97,170)=1;LW(97,171)=1;
    LW(97,172)=1;LW(97,173)=1;LW(97,174)=1;LW(97,175)=1;LW(97,176)=1;LW(97,177)=1;LW(97,178)=1;LW(97,179)=1;LW(97,180)=1;LW(97,181)=1;
    LW(97,182)=1;LW(97,183)=1;LW(97,184)=1;LW(97,185)=1;LW(97,186)=1;LW(97,187)=1;LW(97,188)=1;LW(97,189)=1;LW(97,190)=1;LW(97,191)=1;
    LW(97,192)=1;LW(97,193)=1;LW(97,194)=1;LW(97,195)=1;LW(97,196)=1;LW(97,197)=1;LW(97,198)=1;LW(97,199)=1;LW(97,200)=1;LW(97,201)=1;
    LW(97,202)=1;LW(97,203)=1;LW(97,204)=1;LW(97,205)=1;LW(97,206)=1;LW(97,207)=1;LW(97,208)=1;LW(97,209)=1;LW(97,210)=1;LW(97,211)=1;
    LW(97,212)=1;LW(97,213)=1;LW(97,214)=1;LW(97,215)=1;LW(97,216)=1;LW(97,217)=1;LW(97,218)=1;LW(97,219)=1;LW(97,220)=1;LW(97,221)=1;
    LW(97,222)=1;LW(97,223)=1;LW(97,224)=1;LW(97,225)=1;LW(97,226)=1;LW(97,227)=1;LW(97,228)=1;LW(97,229)=1;LW(97,230)=1;LW(97,231)=1;
    LW(97,232)=1;LW(97,233)=1;LW(97,234)=1;LW(97,235)=1;LW(97,236)=1;LW(97,237)=1;LW(97,238)=1;LW(97,239)=1;LW(97,240)=1;LW(97,241)=1;
    LW(97,242)=1;LW(97,243)=1;LW(97,244)=1;LW(97,245)=1;LW(97,246)=1;LW(97,247)=1;LW(97,248)=1;LW(97,249)=1;LW(97,250)=1;LW(97,251)=1;
    LW(97,252)=1;LW(97,253)=1;LW(97,254)=1;LW(97,255)=1;LW(97,256)=1;LW(97,257)=1;LW(97,258)=1;LW(97,259)=1;LW(97,260)=1;LW(97,261)=1;
    LW(97,262)=1;LW(97,263)=1;LW(97,264)=1;LW(97,265)=1;LW(97,266)=1;LW(97,267)=1;LW(97,268)=1;LW(97,269)=1;LW(97,270)=1;LW(98,1)=1;
    LW(98,2)=1;LW(98,3)=1;LW(98,4)=1;LW(98,5)=1;LW(98,6)=1;LW(98,7)=1;LW(98,8)=1;LW(98,9)=1;LW(98,10)=1;LW(98,11)=1;
    LW(98,12)=1;LW(98,13)=1;LW(98,14)=1;LW(98,15)=1;LW(98,16)=1;LW(98,17)=1;LW(98,18)=1;LW(98,19)=1;LW(98,20)=1;LW(98,21)=1;
    LW(98,22)=1;LW(98,23)=1;LW(98,24)=1;LW(98,25)=1;LW(98,26)=1;LW(98,27)=1;LW(98,28)=1;LW(98,29)=1;LW(98,30)=1;LW(98,31)=1;
    LW(98,32)=1;LW(98,33)=1;LW(98,34)=1;LW(98,35)=1;LW(98,36)=1;LW(98,37)=1;LW(98,38)=1;LW(98,39)=1;LW(98,40)=1;LW(98,41)=1;
    LW(98,42)=1;LW(98,43)=1;LW(98,44)=1;LW(98,45)=1;LW(98,46)=1;LW(98,47)=1;LW(98,48)=1;LW(98,49)=1;LW(98,50)=1;LW(98,51)=1;
    LW(98,52)=1;LW(98,53)=1;LW(98,54)=1;LW(98,55)=1;LW(98,58)=1;LW(98,59)=1;LW(98,63)=1;LW(98,64)=1;LW(98,65)=1;LW(98,66)=1;
    LW(98,74)=1;LW(98,75)=1;LW(98,87)=1;LW(98,88)=1;LW(98,89)=1;LW(98,90)=1;LW(98,91)=1;LW(98,92)=1;LW(98,93)=1;LW(98,94)=1;
    LW(98,95)=1;LW(98,96)=1;LW(98,106)=1;LW(98,107)=1;LW(98,108)=1;LW(98,109)=1;LW(98,110)=1;LW(98,111)=1;LW(98,112)=1;LW(98,113)=1;
    LW(98,114)=1;LW(98,115)=1;LW(98,116)=1;LW(98,117)=1;LW(98,118)=1;LW(98,119)=1;LW(98,120)=1;LW(98,121)=1;LW(98,122)=1;LW(98,125)=1;
    LW(98,126)=1;LW(98,127)=1;LW(98,128)=1;LW(98,129)=1;LW(98,130)=1;LW(98,131)=1;LW(98,132)=1;LW(98,133)=1;LW(98,134)=1;LW(98,135)=1;
    LW(98,136)=1;LW(98,137)=1;LW(98,138)=1;LW(98,139)=1;LW(98,140)=1;LW(98,141)=1;LW(98,142)=1;LW(98,143)=1;LW(98,144)=1;LW(98,145)=1;
    LW(98,146)=1;LW(98,147)=1;LW(98,148)=1;LW(98,149)=1;LW(98,150)=1;LW(98,151)=1;LW(98,152)=1;LW(98,153)=1;LW(98,154)=1;LW(98,155)=1;
    LW(98,156)=1;LW(98,157)=1;LW(98,158)=1;LW(98,159)=1;LW(98,160)=1;LW(98,161)=1;LW(98,162)=1;LW(98,163)=1;LW(98,164)=1;LW(98,165)=1;
    LW(98,166)=1;LW(98,167)=1;LW(98,168)=1;LW(98,169)=1;LW(98,170)=1;LW(98,171)=1;LW(98,172)=1;LW(98,173)=1;LW(98,174)=1;LW(98,175)=1;
    LW(98,176)=1;LW(98,177)=1;LW(98,178)=1;LW(98,179)=1;LW(98,180)=1;LW(98,181)=1;LW(98,182)=1;LW(98,183)=1;LW(98,184)=1;LW(98,185)=1;
    LW(98,186)=1;LW(98,187)=1;LW(98,188)=1;LW(98,189)=1;LW(98,190)=1;LW(98,191)=1;LW(98,192)=1;LW(98,193)=1;LW(98,194)=1;LW(98,195)=1;
    LW(98,196)=1;LW(98,197)=1;LW(98,198)=1;LW(98,199)=1;LW(98,200)=1;LW(98,201)=1;LW(98,202)=1;LW(98,203)=1;LW(98,204)=1;LW(98,205)=1;
    LW(98,206)=1;LW(98,207)=1;LW(98,208)=1;LW(98,209)=1;LW(98,210)=1;LW(98,211)=1;LW(98,212)=1;LW(98,213)=1;LW(98,214)=1;LW(98,215)=1;
    LW(98,216)=1;LW(98,217)=1;LW(98,218)=1;LW(98,219)=1;LW(98,220)=1;LW(98,221)=1;LW(98,222)=1;LW(98,223)=1;LW(98,224)=1;LW(98,225)=1;
    LW(98,226)=1;LW(98,227)=1;LW(98,228)=1;LW(98,229)=1;LW(98,230)=1;LW(98,231)=1;LW(98,232)=1;LW(98,233)=1;LW(98,234)=1;LW(98,235)=1;
    LW(98,236)=1;LW(98,237)=1;LW(98,238)=1;LW(98,239)=1;LW(98,240)=1;LW(98,241)=1;LW(98,242)=1;LW(98,243)=1;LW(98,244)=1;LW(98,245)=1;
    LW(98,246)=1;LW(98,247)=1;LW(98,248)=1;LW(98,249)=1;LW(98,250)=1;LW(98,251)=1;LW(98,252)=1;LW(98,253)=1;LW(98,254)=1;LW(98,255)=1;
    LW(98,256)=1;LW(98,257)=1;LW(98,258)=1;LW(98,259)=1;LW(98,260)=1;LW(98,261)=1;LW(98,262)=1;LW(98,263)=1;LW(98,264)=1;LW(98,265)=1;
    LW(98,266)=1;LW(98,267)=1;LW(98,268)=1;LW(98,269)=1;LW(98,270)=1;LW(99,1)=1;LW(99,2)=1;LW(99,3)=1;LW(99,4)=1;LW(99,5)=1;
    LW(99,6)=1;LW(99,7)=1;LW(99,8)=1;LW(99,9)=1;LW(99,10)=1;LW(99,11)=1;LW(99,12)=1;LW(99,13)=1;LW(99,14)=1;LW(99,15)=1;
    LW(99,16)=1;LW(99,17)=1;LW(99,18)=1;LW(99,19)=1;LW(99,20)=1;LW(99,21)=1;LW(99,22)=1;LW(99,23)=1;LW(99,24)=1;LW(99,25)=1;
    LW(99,26)=1;LW(99,27)=1;LW(99,28)=1;LW(99,29)=1;LW(99,30)=1;LW(99,31)=1;LW(99,32)=1;LW(99,33)=1;LW(99,34)=1;LW(99,35)=1;
    LW(99,36)=1;LW(99,37)=1;LW(99,38)=1;LW(99,39)=1;LW(99,40)=1;LW(99,41)=1;LW(99,42)=1;LW(99,43)=1;LW(99,44)=1;LW(99,45)=1;
    LW(99,46)=1;LW(99,47)=1;LW(99,48)=1;LW(99,49)=1;LW(99,50)=1;LW(99,51)=1;LW(99,52)=1;LW(99,53)=1;LW(99,54)=1;LW(99,55)=1;
    LW(99,56)=1;LW(99,58)=1;LW(99,59)=1;LW(99,60)=1;LW(99,62)=1;LW(99,63)=1;LW(99,64)=1;LW(99,65)=1;LW(99,74)=1;LW(99,75)=1;
    LW(99,87)=1;LW(99,88)=1;LW(99,89)=1;LW(99,90)=1;LW(99,91)=1;LW(99,92)=1;LW(99,93)=1;LW(99,94)=1;LW(99,95)=1;LW(99,96)=1;
    LW(99,99)=1;LW(99,100)=1;LW(99,105)=1;LW(99,106)=1;LW(99,107)=1;LW(99,108)=1;LW(99,109)=1;LW(99,110)=1;LW(99,111)=1;LW(99,112)=1;
    LW(99,113)=1;LW(99,114)=1;LW(99,115)=1;LW(99,116)=1;LW(99,117)=1;LW(99,118)=1;LW(99,119)=1;LW(99,120)=1;LW(99,121)=1;LW(99,122)=1;
    LW(99,127)=1;LW(99,128)=1;LW(99,129)=1;LW(99,134)=1;LW(99,135)=1;LW(99,136)=1;LW(99,137)=1;LW(99,138)=1;LW(99,139)=1;LW(99,140)=1;
    LW(99,141)=1;LW(99,142)=1;LW(99,143)=1;LW(99,144)=1;LW(99,145)=1;LW(99,146)=1;LW(99,147)=1;LW(99,148)=1;LW(99,149)=1;LW(99,150)=1;
    LW(99,151)=1;LW(99,152)=1;LW(99,153)=1;LW(99,154)=1;LW(99,155)=1;LW(99,156)=1;LW(99,157)=1;LW(99,158)=1;LW(99,159)=1;LW(99,160)=1;
    LW(99,161)=1;LW(99,162)=1;LW(99,163)=1;LW(99,164)=1;LW(99,165)=1;LW(99,166)=1;LW(99,167)=1;LW(99,168)=1;LW(99,169)=1;LW(99,170)=1;
    LW(99,171)=1;LW(99,172)=1;LW(99,173)=1;LW(99,174)=1;LW(99,175)=1;LW(99,176)=1;LW(99,177)=1;LW(99,178)=1;LW(99,179)=1;LW(99,180)=1;
    LW(99,181)=1;LW(99,182)=1;LW(99,183)=1;LW(99,184)=1;LW(99,185)=1;LW(99,186)=1;LW(99,187)=1;LW(99,188)=1;LW(99,189)=1;LW(99,190)=1;
    LW(99,191)=1;LW(99,192)=1;LW(99,193)=1;LW(99,194)=1;LW(99,195)=1;LW(99,196)=1;LW(99,197)=1;LW(99,198)=1;LW(99,199)=1;LW(99,200)=1;
    LW(99,201)=1;LW(99,202)=1;LW(99,203)=1;LW(99,204)=1;LW(99,205)=1;LW(99,206)=1;LW(99,207)=1;LW(99,208)=1;LW(99,209)=1;LW(99,210)=1;
    LW(99,211)=1;LW(99,212)=1;LW(99,213)=1;LW(99,214)=1;LW(99,215)=1;LW(99,216)=1;LW(99,217)=1;LW(99,218)=1;LW(99,219)=1;LW(99,220)=1;
    LW(99,221)=1;LW(99,222)=1;LW(99,223)=1;LW(99,224)=1;LW(99,225)=1;LW(99,226)=1;LW(99,227)=1;LW(99,228)=1;LW(99,229)=1;LW(99,230)=1;
    LW(99,231)=1;LW(99,232)=1;LW(99,233)=1;LW(99,234)=1;LW(99,235)=1;LW(99,236)=1;LW(99,237)=1;LW(99,238)=1;LW(99,239)=1;LW(99,240)=1;
    LW(99,241)=1;LW(99,242)=1;LW(99,243)=1;LW(99,244)=1;LW(99,245)=1;LW(99,246)=1;LW(99,247)=1;LW(99,248)=1;LW(99,249)=1;LW(99,250)=1;
    LW(99,251)=1;LW(99,252)=1;LW(99,253)=1;LW(99,254)=1;LW(99,255)=1;LW(99,256)=1;LW(99,257)=1;LW(99,258)=1;LW(99,259)=1;LW(99,260)=1;
    LW(99,261)=1;LW(99,262)=1;LW(99,263)=1;LW(99,264)=1;LW(99,265)=1;LW(99,266)=1;LW(99,267)=1;LW(99,268)=1;LW(99,269)=1;LW(99,270)=1;
    LW(100,1)=1;LW(100,2)=1;LW(100,3)=1;LW(100,4)=1;LW(100,5)=1;LW(100,6)=1;LW(100,7)=1;LW(100,8)=1;LW(100,9)=1;LW(100,10)=1;
    LW(100,11)=1;LW(100,12)=1;LW(100,13)=1;LW(100,14)=1;LW(100,15)=1;LW(100,16)=1;LW(100,17)=1;LW(100,18)=1;LW(100,19)=1;LW(100,20)=1;
    LW(100,21)=1;LW(100,22)=1;LW(100,23)=1;LW(100,24)=1;LW(100,25)=1;LW(100,26)=1;LW(100,27)=1;LW(100,28)=1;LW(100,29)=1;LW(100,30)=1;
    LW(100,31)=1;LW(100,32)=1;LW(100,33)=1;LW(100,34)=1;LW(100,35)=1;LW(100,36)=1;LW(100,37)=1;LW(100,38)=1;LW(100,39)=1;LW(100,40)=1;
    LW(100,41)=1;LW(100,42)=1;LW(100,43)=1;LW(100,44)=1;LW(100,45)=1;LW(100,46)=1;LW(100,47)=1;LW(100,48)=1;LW(100,49)=1;LW(100,50)=1;
    LW(100,51)=1;LW(100,52)=1;LW(100,53)=1;LW(100,54)=1;LW(100,55)=1;LW(100,59)=1;LW(100,63)=1;LW(100,64)=1;LW(100,65)=1;LW(100,73)=1;
    LW(100,74)=1;LW(100,75)=1;LW(100,87)=1;LW(100,88)=1;LW(100,89)=1;LW(100,90)=1;LW(100,91)=1;LW(100,92)=1;LW(100,93)=1;LW(100,94)=1;
    LW(100,95)=1;LW(100,106)=1;LW(100,107)=1;LW(100,108)=1;LW(100,109)=1;LW(100,110)=1;LW(100,111)=1;LW(100,112)=1;LW(100,113)=1;LW(100,114)=1;
    LW(100,115)=1;LW(100,116)=1;LW(100,117)=1;LW(100,118)=1;LW(100,120)=1;LW(100,121)=1;LW(100,122)=1;LW(100,128)=1;LW(100,129)=1;LW(100,135)=1;
    LW(100,136)=1;LW(100,137)=1;LW(100,138)=1;LW(100,139)=1;LW(100,140)=1;LW(100,141)=1;LW(100,142)=1;LW(100,143)=1;LW(100,144)=1;LW(100,145)=1;
    LW(100,146)=1;LW(100,147)=1;LW(100,148)=1;LW(100,149)=1;LW(100,150)=1;LW(100,151)=1;LW(100,152)=1;LW(100,153)=1;LW(100,154)=1;LW(100,155)=1;
    LW(100,156)=1;LW(100,157)=1;LW(100,158)=1;LW(100,159)=1;LW(100,160)=1;LW(100,161)=1;LW(100,162)=1;LW(100,163)=1;LW(100,164)=1;LW(100,165)=1;
    LW(100,166)=1;LW(100,167)=1;LW(100,168)=1;LW(100,169)=1;LW(100,170)=1;LW(100,171)=1;LW(100,172)=1;LW(100,173)=1;LW(100,174)=1;LW(100,175)=1;
    LW(100,176)=1;LW(100,177)=1;LW(100,178)=1;LW(100,179)=1;LW(100,180)=1;LW(100,181)=1;LW(100,182)=1;LW(100,183)=1;LW(100,184)=1;LW(100,185)=1;
    LW(100,186)=1;LW(100,187)=1;LW(100,188)=1;LW(100,189)=1;LW(100,190)=1;LW(100,191)=1;LW(100,192)=1;LW(100,193)=1;LW(100,194)=1;LW(100,195)=1;
    LW(100,196)=1;LW(100,197)=1;LW(100,198)=1;LW(100,199)=1;LW(100,200)=1;LW(100,201)=1;LW(100,202)=1;LW(100,203)=1;LW(100,204)=1;LW(100,205)=1;
    LW(100,206)=1;LW(100,207)=1;LW(100,208)=1;LW(100,209)=1;LW(100,210)=1;LW(100,211)=1;LW(100,212)=1;LW(100,213)=1;LW(100,214)=1;LW(100,215)=1;
    LW(100,216)=1;LW(100,217)=1;LW(100,218)=1;LW(100,219)=1;LW(100,220)=1;LW(100,221)=1;LW(100,222)=1;LW(100,223)=1;LW(100,224)=1;LW(100,225)=1;
    LW(100,226)=1;LW(100,227)=1;LW(100,228)=1;LW(100,229)=1;LW(100,230)=1;LW(100,231)=1;LW(100,232)=1;LW(100,233)=1;LW(100,234)=1;LW(100,235)=1;
    LW(100,236)=1;LW(100,237)=1;LW(100,238)=1;LW(100,239)=1;LW(100,240)=1;LW(100,241)=1;LW(100,242)=1;LW(100,243)=1;LW(100,244)=1;LW(100,245)=1;
    LW(100,246)=1;LW(100,247)=1;LW(100,248)=1;LW(100,249)=1;LW(100,250)=1;LW(100,251)=1;LW(100,252)=1;LW(100,253)=1;LW(100,254)=1;LW(100,255)=1;
    LW(100,256)=1;LW(100,257)=1;LW(100,258)=1;LW(100,259)=1;LW(100,260)=1;LW(100,261)=1;LW(100,262)=1;LW(100,263)=1;LW(100,264)=1;LW(100,265)=1;
    LW(100,266)=1;LW(100,267)=1;LW(100,268)=1;LW(100,269)=1;LW(100,270)=1;LW(101,1)=1;LW(101,2)=1;LW(101,3)=1;LW(101,4)=1;LW(101,5)=1;
    LW(101,6)=1;LW(101,7)=1;LW(101,8)=1;LW(101,9)=1;LW(101,10)=1;LW(101,11)=1;LW(101,12)=1;LW(101,13)=1;LW(101,14)=1;LW(101,15)=1;
    LW(101,16)=1;LW(101,17)=1;LW(101,18)=1;LW(101,19)=1;LW(101,20)=1;LW(101,21)=1;LW(101,22)=1;LW(101,23)=1;LW(101,24)=1;LW(101,25)=1;
    LW(101,26)=1;LW(101,27)=1;LW(101,28)=1;LW(101,29)=1;LW(101,30)=1;LW(101,31)=1;LW(101,32)=1;LW(101,33)=1;LW(101,34)=1;LW(101,35)=1;
    LW(101,36)=1;LW(101,37)=1;LW(101,38)=1;LW(101,39)=1;LW(101,40)=1;LW(101,41)=1;LW(101,42)=1;LW(101,43)=1;LW(101,44)=1;LW(101,45)=1;
    LW(101,46)=1;LW(101,47)=1;LW(101,48)=1;LW(101,49)=1;LW(101,50)=1;LW(101,51)=1;LW(101,52)=1;LW(101,53)=1;LW(101,54)=1;LW(101,64)=1;
    LW(101,73)=1;LW(101,74)=1;LW(101,75)=1;LW(101,88)=1;LW(101,89)=1;LW(101,90)=1;LW(101,91)=1;LW(101,92)=1;LW(101,93)=1;LW(101,94)=1;
    LW(101,95)=1;LW(101,109)=1;LW(101,110)=1;LW(101,111)=1;LW(101,112)=1;LW(101,113)=1;LW(101,114)=1;LW(101,115)=1;LW(101,116)=1;LW(101,117)=1;
    LW(101,121)=1;LW(101,135)=1;LW(101,136)=1;LW(101,137)=1;LW(101,138)=1;LW(101,139)=1;LW(101,140)=1;LW(101,141)=1;LW(101,142)=1;LW(101,143)=1;
    LW(101,144)=1;LW(101,145)=1;LW(101,146)=1;LW(101,147)=1;LW(101,148)=1;LW(101,149)=1;LW(101,150)=1;LW(101,151)=1;LW(101,152)=1;LW(101,153)=1;
    LW(101,154)=1;LW(101,155)=1;LW(101,156)=1;LW(101,157)=1;LW(101,158)=1;LW(101,159)=1;LW(101,160)=1;LW(101,161)=1;LW(101,162)=1;LW(101,163)=1;
    LW(101,164)=1;LW(101,165)=1;LW(101,166)=1;LW(101,167)=1;LW(101,168)=1;LW(101,169)=1;LW(101,170)=1;LW(101,171)=1;LW(101,172)=1;LW(101,173)=1;
    LW(101,174)=1;LW(101,175)=1;LW(101,176)=1;LW(101,177)=1;LW(101,178)=1;LW(101,179)=1;LW(101,180)=1;LW(101,181)=1;LW(101,182)=1;LW(101,183)=1;
    LW(101,184)=1;LW(101,185)=1;LW(101,186)=1;LW(101,187)=1;LW(101,188)=1;LW(101,189)=1;LW(101,190)=1;LW(101,191)=1;LW(101,192)=1;LW(101,193)=1;
    LW(101,194)=1;LW(101,195)=1;LW(101,196)=1;LW(101,197)=1;LW(101,198)=1;LW(101,199)=1;LW(101,200)=1;LW(101,201)=1;LW(101,202)=1;LW(101,203)=1;
    LW(101,204)=1;LW(101,205)=1;LW(101,206)=1;LW(101,207)=1;LW(101,208)=1;LW(101,209)=1;LW(101,210)=1;LW(101,211)=1;LW(101,212)=1;LW(101,213)=1;
    LW(101,214)=1;LW(101,215)=1;LW(101,216)=1;LW(101,217)=1;LW(101,218)=1;LW(101,219)=1;LW(101,220)=1;LW(101,221)=1;LW(101,222)=1;LW(101,223)=1;
    LW(101,224)=1;LW(101,225)=1;LW(101,226)=1;LW(101,227)=1;LW(101,228)=1;LW(101,229)=1;LW(101,230)=1;LW(101,231)=1;LW(101,232)=1;LW(101,233)=1;
    LW(101,234)=1;LW(101,235)=1;LW(101,236)=1;LW(101,237)=1;LW(101,238)=1;LW(101,239)=1;LW(101,240)=1;LW(101,241)=1;LW(101,242)=1;LW(101,243)=1;
    LW(101,244)=1;LW(101,245)=1;LW(101,246)=1;LW(101,247)=1;LW(101,248)=1;LW(101,249)=1;LW(101,250)=1;LW(101,251)=1;LW(101,252)=1;LW(101,253)=1;
    LW(101,254)=1;LW(101,255)=1;LW(101,256)=1;LW(101,257)=1;LW(101,258)=1;LW(101,259)=1;LW(101,260)=1;LW(101,261)=1;LW(101,262)=1;LW(101,263)=1;
    LW(101,264)=1;LW(101,265)=1;LW(101,266)=1;LW(101,267)=1;LW(101,268)=1;LW(101,269)=1;LW(101,270)=1;LW(102,1)=1;LW(102,2)=1;LW(102,3)=1;
    LW(102,4)=1;LW(102,5)=1;LW(102,6)=1;LW(102,7)=1;LW(102,8)=1;LW(102,9)=1;LW(102,10)=1;LW(102,11)=1;LW(102,12)=1;LW(102,13)=1;
    LW(102,14)=1;LW(102,15)=1;LW(102,16)=1;LW(102,17)=1;LW(102,18)=1;LW(102,19)=1;LW(102,20)=1;LW(102,21)=1;LW(102,22)=1;LW(102,23)=1;
    LW(102,24)=1;LW(102,25)=1;LW(102,26)=1;LW(102,27)=1;LW(102,28)=1;LW(102,29)=1;LW(102,30)=1;LW(102,31)=1;LW(102,32)=1;LW(102,33)=1;
    LW(102,34)=1;LW(102,35)=1;LW(102,36)=1;LW(102,37)=1;LW(102,38)=1;LW(102,39)=1;LW(102,40)=1;LW(102,41)=1;LW(102,42)=1;LW(102,43)=1;
    LW(102,44)=1;LW(102,45)=1;LW(102,46)=1;LW(102,74)=1;LW(102,75)=1;LW(102,88)=1;LW(102,89)=1;LW(102,90)=1;LW(102,91)=1;LW(102,92)=1;
    LW(102,93)=1;LW(102,94)=1;LW(102,95)=1;LW(102,110)=1;LW(102,111)=1;LW(102,112)=1;LW(102,113)=1;LW(102,114)=1;LW(102,115)=1;LW(102,116)=1;
    LW(102,136)=1;LW(102,137)=1;LW(102,138)=1;LW(102,139)=1;LW(102,140)=1;LW(102,141)=1;LW(102,142)=1;LW(102,143)=1;LW(102,144)=1;LW(102,145)=1;
    LW(102,146)=1;LW(102,147)=1;LW(102,148)=1;LW(102,149)=1;LW(102,151)=1;LW(102,152)=1;LW(102,153)=1;LW(102,154)=1;LW(102,155)=1;LW(102,156)=1;
    LW(102,157)=1;LW(102,158)=1;LW(102,159)=1;LW(102,160)=1;LW(102,161)=1;LW(102,162)=1;LW(102,163)=1;LW(102,165)=1;LW(102,166)=1;LW(102,167)=1;
    LW(102,168)=1;LW(102,169)=1;LW(102,170)=1;LW(102,171)=1;LW(102,172)=1;LW(102,173)=1;LW(102,174)=1;LW(102,175)=1;LW(102,176)=1;LW(102,177)=1;
    LW(102,178)=1;LW(102,179)=1;LW(102,180)=1;LW(102,181)=1;LW(102,182)=1;LW(102,183)=1;LW(102,184)=1;LW(102,185)=1;LW(102,186)=1;LW(102,187)=1;
    LW(102,188)=1;LW(102,189)=1;LW(102,190)=1;LW(102,191)=1;LW(102,192)=1;LW(102,193)=1;LW(102,194)=1;LW(102,195)=1;LW(102,196)=1;LW(102,197)=1;
    LW(102,198)=1;LW(102,199)=1;LW(102,200)=1;LW(102,201)=1;LW(102,202)=1;LW(102,203)=1;LW(102,204)=1;LW(102,205)=1;LW(102,206)=1;LW(102,207)=1;
    LW(102,208)=1;LW(102,209)=1;LW(102,210)=1;LW(102,211)=1;LW(102,212)=1;LW(102,213)=1;LW(102,214)=1;LW(102,215)=1;LW(102,216)=1;LW(102,217)=1;
    LW(102,218)=1;LW(102,219)=1;LW(102,220)=1;LW(102,221)=1;LW(102,222)=1;LW(102,223)=1;LW(102,224)=1;LW(102,225)=1;LW(102,226)=1;LW(102,227)=1;
    LW(102,228)=1;LW(102,229)=1;LW(102,230)=1;LW(102,231)=1;LW(102,232)=1;LW(102,233)=1;LW(102,234)=1;LW(102,235)=1;LW(102,236)=1;LW(102,237)=1;
    LW(102,238)=1;LW(102,239)=1;LW(102,240)=1;LW(102,241)=1;LW(102,242)=1;LW(102,243)=1;LW(102,244)=1;LW(102,245)=1;LW(102,246)=1;LW(102,247)=1;
    LW(102,248)=1;LW(102,249)=1;LW(102,250)=1;LW(102,251)=1;LW(102,252)=1;LW(102,253)=1;LW(102,254)=1;LW(102,255)=1;LW(102,256)=1;LW(102,257)=1;
    LW(102,258)=1;LW(102,259)=1;LW(102,260)=1;LW(102,261)=1;LW(102,262)=1;LW(102,263)=1;LW(102,264)=1;LW(102,265)=1;LW(102,266)=1;LW(102,267)=1;
    LW(102,268)=1;LW(102,269)=1;LW(102,270)=1;LW(103,1)=1;LW(103,2)=1;LW(103,3)=1;LW(103,4)=1;LW(103,5)=1;LW(103,6)=1;LW(103,7)=1;
    LW(103,8)=1;LW(103,9)=1;LW(103,10)=1;LW(103,11)=1;LW(103,12)=1;LW(103,13)=1;LW(103,14)=1;LW(103,15)=1;LW(103,16)=1;LW(103,17)=1;
    LW(103,18)=1;LW(103,19)=1;LW(103,20)=1;LW(103,23)=1;LW(103,24)=1;LW(103,25)=1;LW(103,26)=1;LW(103,27)=1;LW(103,28)=1;LW(103,29)=1;
    LW(103,30)=1;LW(103,31)=1;LW(103,32)=1;LW(103,33)=1;LW(103,34)=1;LW(103,35)=1;LW(103,36)=1;LW(103,37)=1;LW(103,38)=1;LW(103,39)=1;
    LW(103,40)=1;LW(103,41)=1;LW(103,74)=1;LW(103,75)=1;LW(103,76)=1;LW(103,89)=1;LW(103,90)=1;LW(103,91)=1;LW(103,92)=1;LW(103,93)=1;
    LW(103,94)=1;LW(103,95)=1;LW(103,111)=1;LW(103,112)=1;LW(103,113)=1;LW(103,114)=1;LW(103,115)=1;LW(103,139)=1;LW(103,140)=1;LW(103,141)=1;
    LW(103,142)=1;LW(103,143)=1;LW(103,144)=1;LW(103,145)=1;LW(103,148)=1;LW(103,152)=1;LW(103,153)=1;LW(103,154)=1;LW(103,155)=1;LW(103,156)=1;
    LW(103,157)=1;LW(103,158)=1;LW(103,159)=1;LW(103,160)=1;LW(103,161)=1;LW(103,162)=1;LW(103,165)=1;LW(103,166)=1;LW(103,167)=1;LW(103,168)=1;
    LW(103,169)=1;LW(103,170)=1;LW(103,171)=1;LW(103,172)=1;LW(103,173)=1;LW(103,174)=1;LW(103,175)=1;LW(103,176)=1;LW(103,177)=1;LW(103,178)=1;
    LW(103,179)=1;LW(103,180)=1;LW(103,181)=1;LW(103,182)=1;LW(103,183)=1;LW(103,184)=1;LW(103,191)=1;LW(103,192)=1;LW(103,193)=1;LW(103,194)=1;
    LW(103,195)=1;LW(103,196)=1;LW(103,197)=1;LW(103,198)=1;LW(103,199)=1;LW(103,200)=1;LW(103,201)=1;LW(103,202)=1;LW(103,203)=1;LW(103,204)=1;
    LW(103,205)=1;LW(103,206)=1;LW(103,207)=1;LW(103,208)=1;LW(103,209)=1;LW(103,210)=1;LW(103,211)=1;LW(103,212)=1;LW(103,213)=1;LW(103,214)=1;
    LW(103,215)=1;LW(103,216)=1;LW(103,217)=1;LW(103,218)=1;LW(103,219)=1;LW(103,220)=1;LW(103,221)=1;LW(103,222)=1;LW(103,223)=1;LW(103,224)=1;
    LW(103,225)=1;LW(103,226)=1;LW(103,227)=1;LW(103,228)=1;LW(103,229)=1;LW(103,230)=1;LW(103,231)=1;LW(103,232)=1;LW(103,233)=1;LW(103,234)=1;
    LW(103,235)=1;LW(103,236)=1;LW(103,237)=1;LW(103,238)=1;LW(103,239)=1;LW(103,240)=1;LW(103,241)=1;LW(103,242)=1;LW(103,243)=1;LW(103,244)=1;
    LW(103,245)=1;LW(103,246)=1;LW(103,247)=1;LW(103,248)=1;LW(103,249)=1;LW(103,250)=1;LW(103,251)=1;LW(103,252)=1;LW(103,253)=1;LW(103,254)=1;
    LW(103,255)=1;LW(103,256)=1;LW(103,257)=1;LW(103,258)=1;LW(103,259)=1;LW(103,260)=1;LW(103,261)=1;LW(103,262)=1;LW(103,263)=1;LW(103,264)=1;
    LW(103,265)=1;LW(103,266)=1;LW(103,267)=1;LW(103,268)=1;LW(103,269)=1;LW(103,270)=1;LW(104,1)=1;LW(104,2)=1;LW(104,3)=1;LW(104,4)=1;
    LW(104,5)=1;LW(104,6)=1;LW(104,7)=1;LW(104,8)=1;LW(104,9)=1;LW(104,10)=1;LW(104,11)=1;LW(104,12)=1;LW(104,13)=1;LW(104,15)=1;
    LW(104,16)=1;LW(104,17)=1;LW(104,18)=1;LW(104,19)=1;LW(104,31)=1;LW(104,32)=1;LW(104,33)=1;LW(104,37)=1;LW(104,38)=1;LW(104,39)=1;
    LW(104,40)=1;LW(104,74)=1;LW(104,75)=1;LW(104,76)=1;LW(104,91)=1;LW(104,92)=1;LW(104,93)=1;LW(104,94)=1;LW(104,95)=1;LW(104,139)=1;
    LW(104,140)=1;LW(104,141)=1;LW(104,159)=1;LW(104,160)=1;LW(104,161)=1;LW(104,162)=1;LW(104,168)=1;LW(104,169)=1;LW(104,170)=1;LW(104,175)=1;
    LW(104,176)=1;LW(104,193)=1;LW(104,194)=1;LW(104,195)=1;LW(104,196)=1;LW(104,197)=1;LW(104,198)=1;LW(104,199)=1;LW(104,200)=1;LW(104,201)=1;
    LW(104,202)=1;LW(104,203)=1;LW(104,204)=1;LW(104,205)=1;LW(104,206)=1;LW(104,207)=1;LW(104,208)=1;LW(104,209)=1;LW(104,210)=1;LW(104,211)=1;
    LW(104,212)=1;LW(104,213)=1;LW(104,214)=1;LW(104,215)=1;LW(104,216)=1;LW(104,217)=1;LW(104,218)=1;LW(104,219)=1;LW(104,220)=1;LW(104,221)=1;
    LW(104,222)=1;LW(104,223)=1;LW(104,224)=1;LW(104,225)=1;LW(104,226)=1;LW(104,227)=1;LW(104,228)=1;LW(104,229)=1;LW(104,230)=1;LW(104,231)=1;
    LW(104,232)=1;LW(104,233)=1;LW(104,234)=1;LW(104,235)=1;LW(104,236)=1;LW(104,237)=1;LW(104,238)=1;LW(104,239)=1;LW(104,240)=1;LW(104,241)=1;
    LW(104,242)=1;LW(104,243)=1;LW(104,244)=1;LW(104,245)=1;LW(104,246)=1;LW(104,247)=1;LW(104,248)=1;LW(104,249)=1;LW(104,250)=1;LW(104,251)=1;
    LW(104,252)=1;LW(104,253)=1;LW(104,254)=1;LW(104,255)=1;LW(104,256)=1;LW(104,257)=1;LW(104,258)=1;LW(104,259)=1;LW(104,260)=1;LW(104,261)=1;
    LW(104,262)=1;LW(104,263)=1;LW(104,264)=1;LW(104,265)=1;LW(104,266)=1;LW(104,267)=1;LW(104,268)=1;LW(104,269)=1;LW(104,270)=1;LW(105,1)=1;
    LW(105,2)=1;LW(105,3)=1;LW(105,4)=1;LW(105,5)=1;LW(105,9)=1;LW(105,10)=1;LW(105,11)=1;LW(105,74)=1;LW(105,75)=1;LW(105,76)=1;
    LW(105,92)=1;LW(105,93)=1;LW(105,94)=1;LW(105,95)=1;LW(105,140)=1;LW(105,141)=1;LW(105,142)=1;LW(105,160)=1;LW(105,161)=1;LW(105,162)=1;
    LW(105,163)=1;LW(105,194)=1;LW(105,195)=1;LW(105,196)=1;LW(105,197)=1;LW(105,198)=1;LW(105,199)=1;LW(105,202)=1;LW(105,203)=1;LW(105,204)=1;
    LW(105,205)=1;LW(105,206)=1;LW(105,207)=1;LW(105,208)=1;LW(105,209)=1;LW(105,210)=1;LW(105,211)=1;LW(105,212)=1;LW(105,213)=1;LW(105,214)=1;
    LW(105,215)=1;LW(105,216)=1;LW(105,217)=1;LW(105,218)=1;LW(105,219)=1;LW(105,220)=1;LW(105,221)=1;LW(105,222)=1;LW(105,223)=1;LW(105,224)=1;
    LW(105,225)=1;LW(105,226)=1;LW(105,227)=1;LW(105,228)=1;LW(105,229)=1;LW(105,230)=1;LW(105,231)=1;LW(105,232)=1;LW(105,233)=1;LW(105,234)=1;
    LW(105,235)=1;LW(105,236)=1;LW(105,237)=1;LW(105,238)=1;LW(105,239)=1;LW(105,240)=1;LW(105,241)=1;LW(105,242)=1;LW(105,243)=1;LW(105,244)=1;
    LW(105,245)=1;LW(105,246)=1;LW(105,247)=1;LW(105,248)=1;LW(105,249)=1;LW(105,250)=1;LW(105,251)=1;LW(105,252)=1;LW(105,253)=1;LW(105,254)=1;
    LW(105,255)=1;LW(105,256)=1;LW(105,257)=1;LW(105,258)=1;LW(105,259)=1;LW(105,260)=1;LW(105,261)=1;LW(105,262)=1;LW(105,263)=1;LW(105,264)=1;
    LW(105,265)=1;LW(105,266)=1;LW(105,267)=1;LW(105,268)=1;LW(105,269)=1;LW(105,270)=1;LW(106,1)=1;LW(106,2)=1;LW(106,3)=1;LW(106,73)=1;
    LW(106,74)=1;LW(106,75)=1;LW(106,76)=1;LW(106,92)=1;LW(106,93)=1;LW(106,94)=1;LW(106,95)=1;LW(106,112)=1;LW(106,142)=1;LW(106,160)=1;
    LW(106,161)=1;LW(106,162)=1;LW(106,163)=1;LW(106,197)=1;LW(106,198)=1;LW(106,205)=1;LW(106,206)=1;LW(106,207)=1;LW(106,208)=1;LW(106,209)=1;
    LW(106,210)=1;LW(106,211)=1;LW(106,212)=1;LW(106,213)=1;LW(106,214)=1;LW(106,215)=1;LW(106,216)=1;LW(106,217)=1;LW(106,218)=1;LW(106,219)=1;
    LW(106,220)=1;LW(106,221)=1;LW(106,222)=1;LW(106,223)=1;LW(106,224)=1;LW(106,225)=1;LW(106,226)=1;LW(106,227)=1;LW(106,228)=1;LW(106,229)=1;
    LW(106,230)=1;LW(106,231)=1;LW(106,232)=1;LW(106,233)=1;LW(106,234)=1;LW(106,235)=1;LW(106,236)=1;LW(106,237)=1;LW(106,238)=1;LW(106,239)=1;
    LW(106,240)=1;LW(106,241)=1;LW(106,242)=1;LW(106,243)=1;LW(106,244)=1;LW(106,245)=1;LW(106,246)=1;LW(106,247)=1;LW(106,248)=1;LW(106,249)=1;
    LW(106,250)=1;LW(106,251)=1;LW(106,252)=1;LW(106,253)=1;LW(106,254)=1;LW(106,255)=1;LW(106,256)=1;LW(106,257)=1;LW(106,258)=1;LW(106,259)=1;
    LW(106,260)=1;LW(106,261)=1;LW(106,262)=1;LW(106,263)=1;LW(106,264)=1;LW(106,265)=1;LW(106,266)=1;LW(106,267)=1;LW(106,268)=1;LW(106,269)=1;
    LW(106,270)=1;LW(107,1)=1;LW(107,2)=1;LW(107,74)=1;LW(107,75)=1;LW(107,92)=1;LW(107,93)=1;LW(107,94)=1;LW(107,160)=1;LW(107,161)=1;
    LW(107,162)=1;LW(107,210)=1;LW(107,211)=1;LW(107,212)=1;LW(107,213)=1;LW(107,214)=1;LW(107,215)=1;LW(107,216)=1;LW(107,217)=1;LW(107,218)=1;
    LW(107,219)=1;LW(107,220)=1;LW(107,221)=1;LW(107,222)=1;LW(107,223)=1;LW(107,224)=1;LW(107,225)=1;LW(107,226)=1;LW(107,227)=1;LW(107,228)=1;
    LW(107,229)=1;LW(107,230)=1;LW(107,231)=1;LW(107,232)=1;LW(107,233)=1;LW(107,234)=1;LW(107,235)=1;LW(107,236)=1;LW(107,237)=1;LW(107,238)=1;
    LW(107,239)=1;LW(107,240)=1;LW(107,241)=1;LW(107,242)=1;LW(107,243)=1;LW(107,244)=1;LW(107,245)=1;LW(107,246)=1;LW(107,247)=1;LW(107,248)=1;
    LW(107,249)=1;LW(107,250)=1;LW(107,251)=1;LW(107,252)=1;LW(107,253)=1;LW(107,254)=1;LW(107,255)=1;LW(107,256)=1;LW(107,257)=1;LW(107,258)=1;
    LW(107,259)=1;LW(107,260)=1;LW(107,261)=1;LW(107,262)=1;LW(107,263)=1;LW(107,264)=1;LW(107,265)=1;LW(107,266)=1;LW(107,267)=1;LW(107,268)=1;
    LW(107,269)=1;LW(107,270)=1;LW(108,139)=1;LW(108,160)=1;LW(108,161)=1;LW(108,162)=1;LW(108,217)=1;LW(108,218)=1;LW(108,219)=1;LW(108,224)=1;
    LW(108,225)=1;LW(108,226)=1;LW(108,227)=1;LW(108,228)=1;LW(108,229)=1;LW(108,230)=1;LW(108,231)=1;LW(108,232)=1;LW(108,233)=1;LW(108,234)=1;
    LW(108,235)=1;LW(108,236)=1;LW(108,237)=1;LW(108,238)=1;LW(108,239)=1;LW(108,240)=1;LW(108,241)=1;LW(108,242)=1;LW(108,243)=1;LW(108,244)=1;
    LW(108,245)=1;LW(108,246)=1;LW(108,247)=1;LW(108,248)=1;LW(108,249)=1;LW(108,250)=1;LW(108,251)=1;LW(108,252)=1;LW(108,253)=1;LW(108,254)=1;
    LW(108,255)=1;LW(108,256)=1;LW(108,257)=1;LW(108,258)=1;LW(108,259)=1;LW(108,260)=1;LW(108,261)=1;LW(108,262)=1;LW(108,263)=1;LW(108,264)=1;
    LW(108,265)=1;LW(108,266)=1;LW(108,267)=1;LW(108,268)=1;LW(108,269)=1;LW(108,270)=1;LW(109,230)=1;LW(109,231)=1;LW(109,232)=1;LW(109,233)=1;
    LW(109,234)=1;LW(109,235)=1;LW(109,236)=1;LW(109,237)=1;LW(109,238)=1;LW(109,239)=1;LW(109,240)=1;LW(109,241)=1;LW(109,242)=1;LW(109,243)=1;
    LW(109,244)=1;LW(109,245)=1;LW(109,246)=1;LW(109,247)=1;LW(109,248)=1;LW(109,249)=1;LW(109,250)=1;LW(109,251)=1;LW(109,252)=1;LW(109,253)=1;
    LW(109,254)=1;LW(109,255)=1;LW(109,256)=1;LW(109,257)=1;LW(109,258)=1;LW(109,259)=1;LW(109,260)=1;LW(109,261)=1;LW(109,262)=1;LW(109,263)=1;
    LW(109,264)=1;LW(109,265)=1;LW(109,266)=1;LW(109,267)=1;LW(109,268)=1;LW(109,269)=1;LW(109,270)=1;LW(110,230)=1;LW(110,231)=1;LW(110,232)=1;
    LW(110,233)=1;LW(110,234)=1;LW(110,235)=1;LW(110,236)=1;LW(110,237)=1;LW(110,238)=1;LW(110,239)=1;LW(110,240)=1;LW(110,241)=1;LW(110,242)=1;
    LW(110,243)=1;LW(110,244)=1;LW(110,245)=1;LW(110,246)=1;LW(110,247)=1;LW(110,248)=1;LW(110,249)=1;LW(110,250)=1;LW(110,251)=1;LW(110,252)=1;
    LW(110,253)=1;LW(110,254)=1;LW(110,255)=1;LW(110,256)=1;LW(110,257)=1;LW(110,258)=1;LW(110,259)=1;LW(110,260)=1;LW(110,261)=1;LW(110,262)=1;
    LW(110,263)=1;LW(110,264)=1;LW(110,265)=1;LW(110,266)=1;LW(110,267)=1;LW(110,268)=1;LW(110,269)=1;LW(110,270)=1;LW(111,230)=1;LW(111,231)=1;
    LW(111,232)=1;LW(111,233)=1;LW(111,234)=1;LW(111,235)=1;LW(111,236)=1;LW(111,237)=1;LW(111,238)=1;LW(111,239)=1;LW(111,240)=1;LW(111,241)=1;
    LW(111,242)=1;LW(111,243)=1;LW(111,244)=1;LW(111,245)=1;LW(111,246)=1;LW(111,247)=1;LW(111,248)=1;LW(111,249)=1;LW(111,250)=1;LW(111,251)=1;
    LW(111,252)=1;LW(111,253)=1;LW(111,254)=1;LW(111,255)=1;LW(111,256)=1;LW(111,257)=1;LW(111,258)=1;LW(111,259)=1;LW(111,260)=1;LW(111,261)=1;
    LW(111,262)=1;LW(111,263)=1;LW(111,264)=1;LW(111,265)=1;LW(111,266)=1;LW(111,267)=1;LW(111,268)=1;LW(111,269)=1;LW(111,270)=1;LW(112,228)=1;
    LW(112,229)=1;LW(112,230)=1;LW(112,231)=1;LW(112,232)=1;LW(112,233)=1;LW(112,234)=1;LW(112,235)=1;LW(112,236)=1;LW(112,237)=1;LW(112,238)=1;
    LW(112,239)=1;LW(112,240)=1;LW(112,241)=1;LW(112,242)=1;LW(112,243)=1;LW(112,244)=1;LW(112,245)=1;LW(112,246)=1;LW(112,247)=1;LW(112,248)=1;
    LW(112,249)=1;LW(112,250)=1;LW(112,251)=1;LW(112,252)=1;LW(112,253)=1;LW(112,254)=1;LW(112,255)=1;LW(112,256)=1;LW(112,257)=1;LW(112,258)=1;
    LW(112,259)=1;LW(112,260)=1;LW(112,261)=1;LW(112,262)=1;LW(112,263)=1;LW(112,264)=1;LW(112,265)=1;LW(112,266)=1;LW(112,267)=1;LW(112,268)=1;
    LW(112,269)=1;LW(112,270)=1;LW(113,227)=1;LW(113,228)=1;LW(113,229)=1;LW(113,230)=1;LW(113,233)=1;LW(113,234)=1;LW(113,235)=1;LW(113,236)=1;
    LW(113,237)=1;LW(113,238)=1;LW(113,239)=1;LW(113,240)=1;LW(113,241)=1;LW(113,242)=1;LW(113,243)=1;LW(113,244)=1;LW(113,245)=1;LW(113,246)=1;
    LW(113,247)=1;LW(113,248)=1;LW(113,249)=1;LW(113,250)=1;LW(113,251)=1;LW(113,252)=1;LW(113,253)=1;LW(113,254)=1;LW(113,255)=1;LW(113,256)=1;
    LW(113,257)=1;LW(113,258)=1;LW(113,259)=1;LW(113,260)=1;LW(113,261)=1;LW(113,262)=1;LW(113,263)=1;LW(113,264)=1;LW(113,265)=1;LW(113,266)=1;
    LW(113,267)=1;LW(113,268)=1;LW(113,269)=1;LW(113,270)=1;LW(114,228)=1;LW(114,229)=1;LW(114,230)=1;LW(114,234)=1;LW(114,235)=1;LW(114,236)=1;
    LW(114,237)=1;LW(114,238)=1;LW(114,239)=1;LW(114,240)=1;LW(114,241)=1;LW(114,242)=1;LW(114,243)=1;LW(114,244)=1;LW(114,245)=1;LW(114,246)=1;
    LW(114,247)=1;LW(114,248)=1;LW(114,249)=1;LW(114,250)=1;LW(114,251)=1;LW(114,252)=1;LW(114,253)=1;LW(114,254)=1;LW(114,255)=1;LW(114,256)=1;
    LW(114,257)=1;LW(114,258)=1;LW(114,259)=1;LW(114,260)=1;LW(114,261)=1;LW(114,262)=1;LW(114,263)=1;LW(114,264)=1;LW(114,265)=1;LW(114,266)=1;
    LW(114,267)=1;LW(114,268)=1;LW(114,269)=1;LW(114,270)=1;LW(115,229)=1;LW(115,230)=1;LW(115,234)=1;LW(115,235)=1;LW(115,236)=1;LW(115,237)=1;
    LW(115,238)=1;LW(115,239)=1;LW(115,240)=1;LW(115,241)=1;LW(115,242)=1;LW(115,243)=1;LW(115,244)=1;LW(115,245)=1;LW(115,246)=1;LW(115,247)=1;
    LW(115,248)=1;LW(115,249)=1;LW(115,250)=1;LW(115,251)=1;LW(115,252)=1;LW(115,253)=1;LW(115,254)=1;LW(115,255)=1;LW(115,256)=1;LW(115,257)=1;
    LW(115,258)=1;LW(115,259)=1;LW(115,260)=1;LW(115,261)=1;LW(115,262)=1;LW(115,263)=1;LW(115,264)=1;LW(115,265)=1;LW(115,266)=1;LW(115,267)=1;
    LW(115,268)=1;LW(115,269)=1;LW(115,270)=1;LW(116,230)=1;LW(116,231)=1;LW(116,234)=1;LW(116,235)=1;LW(116,236)=1;LW(116,237)=1;LW(116,238)=1;
    LW(116,239)=1;LW(116,240)=1;LW(116,241)=1;LW(116,242)=1;LW(116,243)=1;LW(116,244)=1;LW(116,245)=1;LW(116,246)=1;LW(116,247)=1;LW(116,248)=1;
    LW(116,249)=1;LW(116,250)=1;LW(116,251)=1;LW(116,252)=1;LW(116,253)=1;LW(116,254)=1;LW(116,255)=1;LW(116,256)=1;LW(116,257)=1;LW(116,258)=1;
    LW(116,259)=1;LW(116,260)=1;LW(116,261)=1;LW(116,262)=1;LW(116,263)=1;LW(116,264)=1;LW(116,265)=1;LW(116,266)=1;LW(116,267)=1;LW(116,268)=1;
    LW(116,269)=1;LW(116,270)=1;LW(117,236)=1;LW(117,237)=1;LW(117,238)=1;LW(117,239)=1;LW(117,240)=1;LW(117,241)=1;LW(117,242)=1;LW(117,243)=1;
    LW(117,244)=1;LW(117,245)=1;LW(117,246)=1;LW(117,247)=1;LW(117,248)=1;LW(117,249)=1;LW(117,250)=1;LW(117,251)=1;LW(117,252)=1;LW(117,253)=1;
    LW(117,254)=1;LW(117,255)=1;LW(117,256)=1;LW(117,257)=1;LW(117,258)=1;LW(117,259)=1;LW(117,260)=1;LW(117,261)=1;LW(117,262)=1;LW(117,263)=1;
    LW(117,264)=1;LW(117,265)=1;LW(117,266)=1;LW(117,267)=1;LW(117,268)=1;LW(117,269)=1;LW(117,270)=1;LW(118,243)=1;LW(118,244)=1;LW(118,245)=1;
    LW(118,246)=1;LW(118,247)=1;LW(118,248)=1;LW(118,249)=1;LW(118,250)=1;LW(118,251)=1;LW(118,252)=1;LW(118,253)=1;LW(118,254)=1;LW(118,255)=1;
    LW(118,256)=1;LW(118,257)=1;LW(118,258)=1;LW(118,259)=1;LW(118,260)=1;LW(118,261)=1;LW(118,262)=1;LW(118,263)=1;LW(118,264)=1;LW(118,265)=1;
    LW(118,266)=1;LW(118,267)=1;LW(118,268)=1;LW(118,269)=1;LW(118,270)=1;LW(119,245)=1;LW(119,246)=1;LW(119,247)=1;LW(119,248)=1;LW(119,249)=1;
    LW(119,250)=1;LW(119,251)=1;LW(119,252)=1;LW(119,253)=1;LW(119,254)=1;LW(119,255)=1;LW(119,256)=1;LW(119,257)=1;LW(119,258)=1;LW(119,262)=1;
    LW(119,263)=1;LW(119,264)=1;LW(119,265)=1;LW(119,266)=1;LW(119,267)=1;LW(119,268)=1;LW(119,269)=1;LW(119,270)=1;LW(120,75)=1;LW(120,253)=1;
    LW(120,254)=1;LW(120,255)=1;LW(120,256)=1;LW(120,257)=1;LW(120,262)=1;LW(120,263)=1;LW(120,264)=1;LW(120,265)=1;LW(120,266)=1;LW(120,267)=1;
    LW(120,268)=1;LW(120,269)=1;LW(120,270)=1;LW(121,254)=1;LW(121,255)=1;LW(121,256)=1;LW(121,257)=1;LW(121,258)=1;LW(121,259)=1;LW(121,260)=1;
    LW(121,261)=1;LW(121,262)=1;LW(121,265)=1;LW(121,266)=1;LW(121,267)=1;LW(121,268)=1;LW(121,269)=1;LW(121,270)=1;LW(122,254)=1;LW(122,255)=1;
    LW(122,256)=1;LW(122,257)=1;LW(122,258)=1;LW(122,259)=1;LW(122,260)=1;LW(122,261)=1;LW(122,262)=1;LW(122,266)=1;LW(122,267)=1;LW(122,268)=1;
    LW(122,269)=1;LW(122,270)=1;LW(123,255)=1;LW(123,258)=1;LW(123,259)=1;LW(123,260)=1;LW(123,261)=1;LW(123,262)=1;LW(123,268)=1;LW(123,269)=1;
    LW(123,270)=1;LW(124,255)=1;LW(124,258)=1;LW(124,259)=1;LW(124,260)=1;LW(124,261)=1;LW(124,262)=1;LW(124,269)=1;LW(124,270)=1;LW(125,258)=1;
    LW(125,259)=1;LW(125,260)=1;LW(125,261)=1;LW(125,262)=1;LW(125,263)=1;LW(126,259)=1;LW(126,260)=1;LW(126,261)=1;LW(126,262)=1;LW(128,259)=1;
    LW(128,260)=1;LW(129,259)=1;LW(133,75)=1;LW(134,75)=1;LW(139,74)=1;LW(139,75)=1;LW(140,74)=1;LW(140,75)=1;LW(140,76)=1;LW(141,74)=1;
    LW(141,75)=1;LW(141,76)=1;LW(142,74)=1;LW(142,75)=1;LW(142,76)=1;LW(143,74)=1;LW(143,75)=1;LW(144,75)=1;LW(145,75)=1;LW(146,75)=1;
    LW(147,75)=1;LW(148,75)=1;LW(149,74)=1;LW(149,75)=1;LW(149,195)=1;LW(150,74)=1;LW(150,75)=1;LW(150,95)=1;LW(150,103)=1;LW(150,125)=1;
    LW(150,195)=1;LW(151,55)=1;LW(151,56)=1;LW(151,59)=1;LW(151,60)=1;LW(151,61)=1;LW(151,62)=1;LW(151,63)=1;LW(151,64)=1;LW(151,65)=1;
    LW(151,73)=1;LW(151,74)=1;LW(151,75)=1;LW(151,76)=1;LW(151,82)=1;LW(151,83)=1;LW(151,84)=1;LW(151,85)=1;LW(151,86)=1;LW(151,89)=1;
    LW(151,90)=1;LW(151,91)=1;LW(151,92)=1;LW(151,93)=1;LW(151,94)=1;LW(151,95)=1;LW(151,96)=1;LW(151,97)=1;LW(151,98)=1;LW(151,99)=1;
    LW(151,101)=1;LW(151,102)=1;LW(151,103)=1;LW(151,104)=1;LW(151,105)=1;LW(151,110)=1;LW(151,111)=1;LW(151,112)=1;LW(151,124)=1;LW(151,125)=1;
    LW(151,126)=1;LW(151,130)=1;LW(151,131)=1;LW(151,132)=1;LW(151,133)=1;LW(151,164)=1;LW(151,195)=1;LW(152,55)=1;LW(152,56)=1;LW(152,57)=1;
    LW(152,58)=1;LW(152,59)=1;LW(152,60)=1;LW(152,61)=1;LW(152,62)=1;LW(152,63)=1;LW(152,64)=1;LW(152,65)=1;LW(152,66)=1;LW(152,67)=1;
    LW(152,68)=1;LW(152,73)=1;LW(152,74)=1;LW(152,75)=1;LW(152,76)=1;LW(152,81)=1;LW(152,82)=1;LW(152,83)=1;LW(152,84)=1;LW(152,85)=1;
    LW(152,86)=1;LW(152,87)=1;LW(152,88)=1;LW(152,89)=1;LW(152,90)=1;LW(152,91)=1;LW(152,92)=1;LW(152,93)=1;LW(152,94)=1;LW(152,95)=1;
    LW(152,96)=1;LW(152,97)=1;LW(152,98)=1;LW(152,99)=1;LW(152,100)=1;LW(152,101)=1;LW(152,102)=1;LW(152,103)=1;LW(152,104)=1;LW(152,105)=1;
    LW(152,106)=1;LW(152,107)=1;LW(152,108)=1;LW(152,109)=1;LW(152,110)=1;LW(152,111)=1;LW(152,112)=1;LW(152,113)=1;LW(152,116)=1;LW(152,117)=1;
    LW(152,118)=1;LW(152,124)=1;LW(152,125)=1;LW(152,126)=1;LW(152,127)=1;LW(152,130)=1;LW(152,131)=1;LW(152,132)=1;LW(152,133)=1;LW(152,134)=1;
    LW(152,135)=1;LW(152,138)=1;LW(152,139)=1;LW(152,163)=1;LW(152,164)=1;LW(152,165)=1;LW(152,195)=1;LW(153,47)=1;LW(153,48)=1;LW(153,49)=1;
    LW(153,50)=1;LW(153,54)=1;LW(153,55)=1;LW(153,56)=1;LW(153,57)=1;LW(153,58)=1;LW(153,59)=1;LW(153,60)=1;LW(153,61)=1;LW(153,62)=1;
    LW(153,63)=1;LW(153,64)=1;LW(153,65)=1;LW(153,66)=1;LW(153,67)=1;LW(153,68)=1;LW(153,69)=1;LW(153,72)=1;LW(153,73)=1;LW(153,74)=1;
    LW(153,75)=1;LW(153,76)=1;LW(153,77)=1;LW(153,81)=1;LW(153,82)=1;LW(153,83)=1;LW(153,84)=1;LW(153,85)=1;LW(153,86)=1;LW(153,87)=1;
    LW(153,88)=1;LW(153,89)=1;LW(153,90)=1;LW(153,91)=1;LW(153,92)=1;LW(153,93)=1;LW(153,94)=1;LW(153,95)=1;LW(153,96)=1;LW(153,97)=1;
    LW(153,98)=1;LW(153,99)=1;LW(153,100)=1;LW(153,101)=1;LW(153,102)=1;LW(153,103)=1;LW(153,104)=1;LW(153,105)=1;LW(153,106)=1;LW(153,107)=1;
    LW(153,108)=1;LW(153,109)=1;LW(153,110)=1;LW(153,111)=1;LW(153,112)=1;LW(153,113)=1;LW(153,114)=1;LW(153,115)=1;LW(153,116)=1;LW(153,117)=1;
    LW(153,118)=1;LW(153,119)=1;LW(153,120)=1;LW(153,121)=1;LW(153,122)=1;LW(153,123)=1;LW(153,124)=1;LW(153,125)=1;LW(153,126)=1;LW(153,127)=1;
    LW(153,128)=1;LW(153,129)=1;LW(153,130)=1;LW(153,131)=1;LW(153,132)=1;LW(153,133)=1;LW(153,134)=1;LW(153,135)=1;LW(153,136)=1;LW(153,137)=1;
    LW(153,138)=1;LW(153,139)=1;LW(153,140)=1;LW(153,141)=1;LW(153,142)=1;LW(153,143)=1;LW(153,144)=1;LW(153,145)=1;LW(153,146)=1;LW(153,150)=1;
    LW(153,151)=1;LW(153,152)=1;LW(153,159)=1;LW(153,163)=1;LW(153,164)=1;LW(153,165)=1;LW(153,166)=1;LW(153,167)=1;LW(153,168)=1;LW(153,171)=1;
    LW(153,172)=1;LW(153,173)=1;LW(154,35)=1;LW(154,42)=1;LW(154,43)=1;LW(154,44)=1;LW(154,45)=1;LW(154,46)=1;LW(154,47)=1;LW(154,48)=1;
    LW(154,49)=1;LW(154,50)=1;LW(154,51)=1;LW(154,52)=1;LW(154,53)=1;LW(154,54)=1;LW(154,55)=1;LW(154,56)=1;LW(154,57)=1;LW(154,58)=1;
    LW(154,59)=1;LW(154,60)=1;LW(154,61)=1;LW(154,62)=1;LW(154,63)=1;LW(154,64)=1;LW(154,65)=1;LW(154,66)=1;LW(154,67)=1;LW(154,68)=1;
    LW(154,69)=1;LW(154,70)=1;LW(154,71)=1;LW(154,72)=1;LW(154,73)=1;LW(154,74)=1;LW(154,75)=1;LW(154,76)=1;LW(154,77)=1;LW(154,78)=1;
    LW(154,79)=1;LW(154,80)=1;LW(154,81)=1;LW(154,82)=1;LW(154,83)=1;LW(154,84)=1;LW(154,85)=1;LW(154,86)=1;LW(154,87)=1;LW(154,88)=1;
    LW(154,89)=1;LW(154,90)=1;LW(154,91)=1;LW(154,92)=1;LW(154,93)=1;LW(154,94)=1;LW(154,95)=1;LW(154,96)=1;LW(154,97)=1;LW(154,98)=1;
    LW(154,99)=1;LW(154,100)=1;LW(154,101)=1;LW(154,102)=1;LW(154,103)=1;LW(154,104)=1;LW(154,105)=1;LW(154,106)=1;LW(154,107)=1;LW(154,108)=1;
    LW(154,109)=1;LW(154,110)=1;LW(154,111)=1;LW(154,112)=1;LW(154,113)=1;LW(154,114)=1;LW(154,115)=1;LW(154,116)=1;LW(154,117)=1;LW(154,118)=1;
    LW(154,119)=1;LW(154,120)=1;LW(154,121)=1;LW(154,122)=1;LW(154,123)=1;LW(154,124)=1;LW(154,125)=1;LW(154,126)=1;LW(154,127)=1;LW(154,128)=1;
    LW(154,129)=1;LW(154,130)=1;LW(154,131)=1;LW(154,132)=1;LW(154,133)=1;LW(154,134)=1;LW(154,135)=1;LW(154,136)=1;LW(154,137)=1;LW(154,138)=1;
    LW(154,139)=1;LW(154,140)=1;LW(154,141)=1;LW(154,142)=1;LW(154,143)=1;LW(154,144)=1;LW(154,145)=1;LW(154,146)=1;LW(154,147)=1;LW(154,148)=1;
    LW(154,149)=1;LW(154,150)=1;LW(154,151)=1;LW(154,152)=1;LW(154,153)=1;LW(154,154)=1;LW(154,155)=1;LW(154,156)=1;LW(154,157)=1;LW(154,158)=1;
    LW(154,159)=1;LW(154,160)=1;LW(154,161)=1;LW(154,162)=1;LW(154,163)=1;LW(154,164)=1;LW(154,165)=1;LW(154,166)=1;LW(154,167)=1;LW(154,168)=1;
    LW(154,169)=1;LW(154,170)=1;LW(154,171)=1;LW(154,172)=1;LW(154,173)=1;LW(154,174)=1;LW(154,176)=1;LW(154,177)=1;LW(154,178)=1;LW(154,179)=1;
    LW(155,27)=1;LW(155,28)=1;LW(155,29)=1;LW(155,30)=1;LW(155,33)=1;LW(155,34)=1;LW(155,35)=1;LW(155,36)=1;LW(155,37)=1;LW(155,40)=1;
    LW(155,41)=1;LW(155,42)=1;LW(155,43)=1;LW(155,44)=1;LW(155,45)=1;LW(155,46)=1;LW(155,47)=1;LW(155,48)=1;LW(155,49)=1;LW(155,50)=1;
    LW(155,51)=1;LW(155,52)=1;LW(155,53)=1;LW(155,54)=1;LW(155,55)=1;LW(155,56)=1;LW(155,57)=1;LW(155,58)=1;LW(155,59)=1;LW(155,60)=1;
    LW(155,61)=1;LW(155,62)=1;LW(155,63)=1;LW(155,64)=1;LW(155,65)=1;LW(155,66)=1;LW(155,67)=1;LW(155,68)=1;LW(155,69)=1;LW(155,70)=1;
    LW(155,71)=1;LW(155,72)=1;LW(155,73)=1;LW(155,74)=1;LW(155,75)=1;LW(155,76)=1;LW(155,77)=1;LW(155,78)=1;LW(155,79)=1;LW(155,80)=1;
    LW(155,81)=1;LW(155,82)=1;LW(155,83)=1;LW(155,84)=1;LW(155,85)=1;LW(155,86)=1;LW(155,87)=1;LW(155,88)=1;LW(155,89)=1;LW(155,90)=1;
    LW(155,91)=1;LW(155,92)=1;LW(155,93)=1;LW(155,94)=1;LW(155,95)=1;LW(155,96)=1;LW(155,97)=1;LW(155,98)=1;LW(155,99)=1;LW(155,100)=1;
    LW(155,101)=1;LW(155,102)=1;LW(155,103)=1;LW(155,104)=1;LW(155,105)=1;LW(155,106)=1;LW(155,107)=1;LW(155,108)=1;LW(155,109)=1;LW(155,110)=1;
    LW(155,111)=1;LW(155,112)=1;LW(155,113)=1;LW(155,114)=1;LW(155,115)=1;LW(155,116)=1;LW(155,117)=1;LW(155,118)=1;LW(155,119)=1;LW(155,120)=1;
    LW(155,121)=1;LW(155,122)=1;LW(155,123)=1;LW(155,124)=1;LW(155,125)=1;LW(155,126)=1;LW(155,127)=1;LW(155,128)=1;LW(155,129)=1;LW(155,130)=1;
    LW(155,131)=1;LW(155,132)=1;LW(155,133)=1;LW(155,134)=1;LW(155,135)=1;LW(155,136)=1;LW(155,137)=1;LW(155,138)=1;LW(155,139)=1;LW(155,140)=1;
    LW(155,141)=1;LW(155,142)=1;LW(155,143)=1;LW(155,144)=1;LW(155,145)=1;LW(155,146)=1;LW(155,147)=1;LW(155,148)=1;LW(155,149)=1;LW(155,150)=1;
    LW(155,151)=1;LW(155,152)=1;LW(155,153)=1;LW(155,154)=1;LW(155,155)=1;LW(155,156)=1;LW(155,157)=1;LW(155,158)=1;LW(155,159)=1;LW(155,160)=1;
    LW(155,161)=1;LW(155,162)=1;LW(155,163)=1;LW(155,164)=1;LW(155,165)=1;LW(155,166)=1;LW(155,167)=1;LW(155,168)=1;LW(155,169)=1;LW(155,170)=1;
    LW(155,171)=1;LW(155,172)=1;LW(155,173)=1;LW(155,174)=1;LW(155,175)=1;LW(155,176)=1;LW(155,177)=1;LW(155,178)=1;LW(155,179)=1;LW(155,180)=1;
    LW(155,181)=1;LW(155,182)=1;LW(155,183)=1;LW(155,184)=1;LW(155,185)=1;LW(155,186)=1;LW(155,187)=1;LW(155,191)=1;LW(155,192)=1;LW(155,193)=1;
    LW(156,14)=1;LW(156,15)=1;LW(156,16)=1;LW(156,26)=1;LW(156,27)=1;LW(156,28)=1;LW(156,29)=1;LW(156,30)=1;LW(156,31)=1;LW(156,32)=1;
    LW(156,33)=1;LW(156,34)=1;LW(156,35)=1;LW(156,36)=1;LW(156,37)=1;LW(156,38)=1;LW(156,39)=1;LW(156,40)=1;LW(156,41)=1;LW(156,42)=1;
    LW(156,43)=1;LW(156,44)=1;LW(156,45)=1;LW(156,46)=1;LW(156,47)=1;LW(156,48)=1;LW(156,49)=1;LW(156,50)=1;LW(156,51)=1;LW(156,52)=1;
    LW(156,53)=1;LW(156,54)=1;LW(156,55)=1;LW(156,56)=1;LW(156,57)=1;LW(156,58)=1;LW(156,59)=1;LW(156,60)=1;LW(156,61)=1;LW(156,62)=1;
    LW(156,63)=1;LW(156,64)=1;LW(156,65)=1;LW(156,66)=1;LW(156,67)=1;LW(156,68)=1;LW(156,69)=1;LW(156,70)=1;LW(156,71)=1;LW(156,72)=1;
    LW(156,73)=1;LW(156,74)=1;LW(156,75)=1;LW(156,76)=1;LW(156,77)=1;LW(156,78)=1;LW(156,79)=1;LW(156,80)=1;LW(156,81)=1;LW(156,82)=1;
    LW(156,83)=1;LW(156,84)=1;LW(156,85)=1;LW(156,86)=1;LW(156,87)=1;LW(156,88)=1;LW(156,89)=1;LW(156,90)=1;LW(156,91)=1;LW(156,92)=1;
    LW(156,93)=1;LW(156,94)=1;LW(156,95)=1;LW(156,96)=1;LW(156,97)=1;LW(156,98)=1;LW(156,99)=1;LW(156,100)=1;LW(156,101)=1;LW(156,102)=1;
    LW(156,103)=1;LW(156,104)=1;LW(156,105)=1;LW(156,106)=1;LW(156,107)=1;LW(156,108)=1;LW(156,109)=1;LW(156,110)=1;LW(156,111)=1;LW(156,112)=1;
    LW(156,113)=1;LW(156,114)=1;LW(156,115)=1;LW(156,116)=1;LW(156,117)=1;LW(156,118)=1;LW(156,119)=1;LW(156,120)=1;LW(156,121)=1;LW(156,122)=1;
    LW(156,123)=1;LW(156,124)=1;LW(156,125)=1;LW(156,126)=1;LW(156,127)=1;LW(156,128)=1;LW(156,129)=1;LW(156,130)=1;LW(156,131)=1;LW(156,132)=1;
    LW(156,133)=1;LW(156,134)=1;LW(156,135)=1;LW(156,136)=1;LW(156,137)=1;LW(156,138)=1;LW(156,139)=1;LW(156,140)=1;LW(156,141)=1;LW(156,142)=1;
    LW(156,143)=1;LW(156,144)=1;LW(156,145)=1;LW(156,146)=1;LW(156,147)=1;LW(156,148)=1;LW(156,149)=1;LW(156,150)=1;LW(156,151)=1;LW(156,152)=1;
    LW(156,153)=1;LW(156,154)=1;LW(156,155)=1;LW(156,156)=1;LW(156,157)=1;LW(156,158)=1;LW(156,159)=1;LW(156,160)=1;LW(156,161)=1;LW(156,162)=1;
    LW(156,163)=1;LW(156,164)=1;LW(156,165)=1;LW(156,166)=1;LW(156,167)=1;LW(156,168)=1;LW(156,169)=1;LW(156,170)=1;LW(156,171)=1;LW(156,172)=1;
    LW(156,173)=1;LW(156,174)=1;LW(156,175)=1;LW(156,176)=1;LW(156,177)=1;LW(156,178)=1;LW(156,179)=1;LW(156,180)=1;LW(156,181)=1;LW(156,182)=1;
    LW(156,183)=1;LW(156,184)=1;LW(156,185)=1;LW(156,186)=1;LW(156,187)=1;LW(156,188)=1;LW(156,189)=1;LW(156,190)=1;LW(156,191)=1;LW(156,192)=1;
    LW(156,193)=1;LW(156,194)=1;LW(156,198)=1;LW(156,199)=1;LW(156,200)=1;LW(156,201)=1;LW(156,202)=1;LW(156,203)=1;LW(156,204)=1;LW(156,205)=1;
    LW(156,206)=1;LW(156,207)=1;LW(156,208)=1;LW(157,6)=1;LW(157,7)=1;LW(157,8)=1;LW(157,12)=1;LW(157,13)=1;LW(157,14)=1;LW(157,15)=1;
    LW(157,16)=1;LW(157,17)=1;LW(157,18)=1;LW(157,19)=1;LW(157,20)=1;LW(157,21)=1;LW(157,22)=1;LW(157,23)=1;LW(157,24)=1;LW(157,25)=1;
    LW(157,26)=1;LW(157,27)=1;LW(157,28)=1;LW(157,29)=1;LW(157,30)=1;LW(157,31)=1;LW(157,32)=1;LW(157,33)=1;LW(157,34)=1;LW(157,35)=1;
    LW(157,36)=1;LW(157,37)=1;LW(157,38)=1;LW(157,39)=1;LW(157,40)=1;LW(157,41)=1;LW(157,42)=1;LW(157,43)=1;LW(157,44)=1;LW(157,45)=1;
    LW(157,46)=1;LW(157,47)=1;LW(157,48)=1;LW(157,49)=1;LW(157,50)=1;LW(157,51)=1;LW(157,52)=1;LW(157,53)=1;LW(157,54)=1;LW(157,55)=1;
    LW(157,56)=1;LW(157,57)=1;LW(157,58)=1;LW(157,59)=1;LW(157,60)=1;LW(157,61)=1;LW(157,62)=1;LW(157,63)=1;LW(157,64)=1;LW(157,65)=1;
    LW(157,66)=1;LW(157,67)=1;LW(157,68)=1;LW(157,69)=1;LW(157,70)=1;LW(157,71)=1;LW(157,72)=1;LW(157,73)=1;LW(157,74)=1;LW(157,75)=1;
    LW(157,76)=1;LW(157,77)=1;LW(157,78)=1;LW(157,79)=1;LW(157,80)=1;LW(157,81)=1;LW(157,82)=1;LW(157,83)=1;LW(157,84)=1;LW(157,85)=1;
    LW(157,86)=1;LW(157,87)=1;LW(157,88)=1;LW(157,89)=1;LW(157,90)=1;LW(157,91)=1;LW(157,92)=1;LW(157,93)=1;LW(157,94)=1;LW(157,95)=1;
    LW(157,96)=1;LW(157,97)=1;LW(157,98)=1;LW(157,99)=1;LW(157,100)=1;LW(157,101)=1;LW(157,102)=1;LW(157,103)=1;LW(157,104)=1;LW(157,105)=1;
    LW(157,106)=1;LW(157,107)=1;LW(157,108)=1;LW(157,109)=1;LW(157,110)=1;LW(157,111)=1;LW(157,112)=1;LW(157,113)=1;LW(157,114)=1;LW(157,115)=1;
    LW(157,116)=1;LW(157,117)=1;LW(157,118)=1;LW(157,119)=1;LW(157,120)=1;LW(157,121)=1;LW(157,122)=1;LW(157,123)=1;LW(157,124)=1;LW(157,125)=1;
    LW(157,126)=1;LW(157,127)=1;LW(157,128)=1;LW(157,129)=1;LW(157,130)=1;LW(157,131)=1;LW(157,132)=1;LW(157,133)=1;LW(157,134)=1;LW(157,135)=1;
    LW(157,136)=1;LW(157,137)=1;LW(157,138)=1;LW(157,139)=1;LW(157,140)=1;LW(157,141)=1;LW(157,142)=1;LW(157,143)=1;LW(157,144)=1;LW(157,145)=1;
    LW(157,146)=1;LW(157,147)=1;LW(157,148)=1;LW(157,149)=1;LW(157,150)=1;LW(157,151)=1;LW(157,152)=1;LW(157,153)=1;LW(157,154)=1;LW(157,155)=1;
    LW(157,156)=1;LW(157,157)=1;LW(157,158)=1;LW(157,159)=1;LW(157,160)=1;LW(157,161)=1;LW(157,162)=1;LW(157,163)=1;LW(157,164)=1;LW(157,165)=1;
    LW(157,166)=1;LW(157,167)=1;LW(157,168)=1;LW(157,169)=1;LW(157,170)=1;LW(157,171)=1;LW(157,172)=1;LW(157,173)=1;LW(157,174)=1;LW(157,175)=1;
    LW(157,176)=1;LW(157,177)=1;LW(157,178)=1;LW(157,179)=1;LW(157,180)=1;LW(157,181)=1;LW(157,182)=1;LW(157,183)=1;LW(157,184)=1;LW(157,185)=1;
    LW(157,186)=1;LW(157,187)=1;LW(157,188)=1;LW(157,189)=1;LW(157,190)=1;LW(157,191)=1;LW(157,192)=1;LW(157,193)=1;LW(157,194)=1;LW(157,195)=1;
    LW(157,197)=1;LW(157,198)=1;LW(157,199)=1;LW(157,200)=1;LW(157,201)=1;LW(157,202)=1;LW(157,203)=1;LW(157,204)=1;LW(157,205)=1;LW(157,206)=1;
    LW(157,207)=1;LW(157,208)=1;LW(157,209)=1;LW(157,210)=1;LW(157,213)=1;LW(157,214)=1;LW(157,215)=1;LW(157,216)=1;LW(157,217)=1;LW(158,4)=1;
    LW(158,5)=1;LW(158,6)=1;LW(158,7)=1;LW(158,8)=1;LW(158,9)=1;LW(158,10)=1;LW(158,11)=1;LW(158,12)=1;LW(158,13)=1;LW(158,14)=1;
    LW(158,15)=1;LW(158,16)=1;LW(158,17)=1;LW(158,18)=1;LW(158,19)=1;LW(158,20)=1;LW(158,21)=1;LW(158,22)=1;LW(158,23)=1;LW(158,24)=1;
    LW(158,25)=1;LW(158,26)=1;LW(158,27)=1;LW(158,28)=1;LW(158,29)=1;LW(158,30)=1;LW(158,31)=1;LW(158,32)=1;LW(158,33)=1;LW(158,34)=1;
    LW(158,35)=1;LW(158,36)=1;LW(158,37)=1;LW(158,38)=1;LW(158,39)=1;LW(158,40)=1;LW(158,41)=1;LW(158,42)=1;LW(158,43)=1;LW(158,44)=1;
    LW(158,45)=1;LW(158,46)=1;LW(158,47)=1;LW(158,48)=1;LW(158,49)=1;LW(158,50)=1;LW(158,51)=1;LW(158,52)=1;LW(158,53)=1;LW(158,54)=1;
    LW(158,55)=1;LW(158,56)=1;LW(158,57)=1;LW(158,58)=1;LW(158,59)=1;LW(158,60)=1;LW(158,61)=1;LW(158,62)=1;LW(158,63)=1;LW(158,64)=1;
    LW(158,65)=1;LW(158,66)=1;LW(158,67)=1;LW(158,68)=1;LW(158,69)=1;LW(158,70)=1;LW(158,71)=1;LW(158,72)=1;LW(158,73)=1;LW(158,74)=1;
    LW(158,75)=1;LW(158,76)=1;LW(158,77)=1;LW(158,78)=1;LW(158,79)=1;LW(158,80)=1;LW(158,81)=1;LW(158,82)=1;LW(158,83)=1;LW(158,84)=1;
    LW(158,85)=1;LW(158,86)=1;LW(158,87)=1;LW(158,88)=1;LW(158,89)=1;LW(158,90)=1;LW(158,91)=1;LW(158,92)=1;LW(158,93)=1;LW(158,94)=1;
    LW(158,95)=1;LW(158,96)=1;LW(158,97)=1;LW(158,98)=1;LW(158,99)=1;LW(158,100)=1;LW(158,101)=1;LW(158,102)=1;LW(158,103)=1;LW(158,104)=1;
    LW(158,105)=1;LW(158,106)=1;LW(158,107)=1;LW(158,108)=1;LW(158,109)=1;LW(158,110)=1;LW(158,111)=1;LW(158,112)=1;LW(158,113)=1;LW(158,114)=1;
    LW(158,115)=1;LW(158,116)=1;LW(158,117)=1;LW(158,118)=1;LW(158,119)=1;LW(158,120)=1;LW(158,121)=1;LW(158,122)=1;LW(158,123)=1;LW(158,124)=1;
    LW(158,125)=1;LW(158,126)=1;LW(158,127)=1;LW(158,128)=1;LW(158,129)=1;LW(158,130)=1;LW(158,131)=1;LW(158,132)=1;LW(158,133)=1;LW(158,134)=1;
    LW(158,135)=1;LW(158,136)=1;LW(158,137)=1;LW(158,138)=1;LW(158,139)=1;LW(158,140)=1;LW(158,141)=1;LW(158,142)=1;LW(158,143)=1;LW(158,144)=1;
    LW(158,145)=1;LW(158,146)=1;LW(158,147)=1;LW(158,148)=1;LW(158,149)=1;LW(158,150)=1;LW(158,151)=1;LW(158,152)=1;LW(158,153)=1;LW(158,154)=1;
    LW(158,155)=1;LW(158,156)=1;LW(158,157)=1;LW(158,158)=1;LW(158,159)=1;LW(158,160)=1;LW(158,161)=1;LW(158,162)=1;LW(158,163)=1;LW(158,164)=1;
    LW(158,165)=1;LW(158,166)=1;LW(158,167)=1;LW(158,168)=1;LW(158,169)=1;LW(158,170)=1;LW(158,171)=1;LW(158,172)=1;LW(158,173)=1;LW(158,174)=1;
    LW(158,175)=1;LW(158,176)=1;LW(158,177)=1;LW(158,178)=1;LW(158,179)=1;LW(158,180)=1;LW(158,181)=1;LW(158,182)=1;LW(158,183)=1;LW(158,184)=1;
    LW(158,185)=1;LW(158,186)=1;LW(158,187)=1;LW(158,188)=1;LW(158,189)=1;LW(158,190)=1;LW(158,191)=1;LW(158,192)=1;LW(158,193)=1;LW(158,194)=1;
    LW(158,195)=1;LW(158,196)=1;LW(158,197)=1;LW(158,198)=1;LW(158,199)=1;LW(158,200)=1;LW(158,201)=1;LW(158,202)=1;LW(158,203)=1;LW(158,204)=1;
    LW(158,205)=1;LW(158,206)=1;LW(158,207)=1;LW(158,208)=1;LW(158,209)=1;LW(158,210)=1;LW(158,211)=1;LW(158,212)=1;LW(158,213)=1;LW(158,214)=1;
    LW(158,215)=1;LW(158,216)=1;LW(158,217)=1;LW(158,218)=1;LW(158,219)=1;LW(158,220)=1;LW(158,221)=1;LW(159,1)=1;LW(159,2)=1;LW(159,3)=1;
    LW(159,4)=1;LW(159,5)=1;LW(159,6)=1;LW(159,7)=1;LW(159,8)=1;LW(159,9)=1;LW(159,10)=1;LW(159,11)=1;LW(159,12)=1;LW(159,13)=1;
    LW(159,14)=1;LW(159,15)=1;LW(159,16)=1;LW(159,17)=1;LW(159,18)=1;LW(159,19)=1;LW(159,20)=1;LW(159,21)=1;LW(159,22)=1;LW(159,23)=1;
    LW(159,24)=1;LW(159,25)=1;LW(159,26)=1;LW(159,27)=1;LW(159,28)=1;LW(159,29)=1;LW(159,30)=1;LW(159,31)=1;LW(159,32)=1;LW(159,33)=1;
    LW(159,34)=1;LW(159,35)=1;LW(159,36)=1;LW(159,37)=1;LW(159,38)=1;LW(159,39)=1;LW(159,40)=1;LW(159,41)=1;LW(159,42)=1;LW(159,43)=1;
    LW(159,44)=1;LW(159,45)=1;LW(159,46)=1;LW(159,47)=1;LW(159,48)=1;LW(159,49)=1;LW(159,50)=1;LW(159,51)=1;LW(159,52)=1;LW(159,53)=1;
    LW(159,54)=1;LW(159,55)=1;LW(159,56)=1;LW(159,57)=1;LW(159,58)=1;LW(159,59)=1;LW(159,60)=1;LW(159,61)=1;LW(159,62)=1;LW(159,63)=1;
    LW(159,64)=1;LW(159,65)=1;LW(159,66)=1;LW(159,67)=1;LW(159,68)=1;LW(159,69)=1;LW(159,70)=1;LW(159,71)=1;LW(159,72)=1;LW(159,73)=1;
    LW(159,74)=1;LW(159,75)=1;LW(159,76)=1;LW(159,77)=1;LW(159,78)=1;LW(159,79)=1;LW(159,80)=1;LW(159,81)=1;LW(159,82)=1;LW(159,83)=1;
    LW(159,84)=1;LW(159,85)=1;LW(159,86)=1;LW(159,87)=1;LW(159,88)=1;LW(159,89)=1;LW(159,90)=1;LW(159,91)=1;LW(159,92)=1;LW(159,93)=1;
    LW(159,94)=1;LW(159,95)=1;LW(159,96)=1;LW(159,97)=1;LW(159,98)=1;LW(159,99)=1;LW(159,100)=1;LW(159,101)=1;LW(159,102)=1;LW(159,103)=1;
    LW(159,104)=1;LW(159,105)=1;LW(159,106)=1;LW(159,107)=1;LW(159,108)=1;LW(159,109)=1;LW(159,110)=1;LW(159,111)=1;LW(159,112)=1;LW(159,113)=1;
    LW(159,114)=1;LW(159,115)=1;LW(159,116)=1;LW(159,117)=1;LW(159,118)=1;LW(159,119)=1;LW(159,120)=1;LW(159,121)=1;LW(159,122)=1;LW(159,123)=1;
    LW(159,124)=1;LW(159,125)=1;LW(159,126)=1;LW(159,127)=1;LW(159,128)=1;LW(159,129)=1;LW(159,130)=1;LW(159,131)=1;LW(159,132)=1;LW(159,133)=1;
    LW(159,134)=1;LW(159,135)=1;LW(159,136)=1;LW(159,137)=1;LW(159,138)=1;LW(159,139)=1;LW(159,140)=1;LW(159,141)=1;LW(159,142)=1;LW(159,143)=1;
    LW(159,144)=1;LW(159,145)=1;LW(159,146)=1;LW(159,147)=1;LW(159,148)=1;LW(159,149)=1;LW(159,150)=1;LW(159,151)=1;LW(159,152)=1;LW(159,153)=1;
    LW(159,154)=1;LW(159,155)=1;LW(159,156)=1;LW(159,157)=1;LW(159,158)=1;LW(159,159)=1;LW(159,160)=1;LW(159,161)=1;LW(159,162)=1;LW(159,163)=1;
    LW(159,164)=1;LW(159,165)=1;LW(159,166)=1;LW(159,167)=1;LW(159,168)=1;LW(159,169)=1;LW(159,170)=1;LW(159,171)=1;LW(159,172)=1;LW(159,173)=1;
    LW(159,174)=1;LW(159,175)=1;LW(159,176)=1;LW(159,177)=1;LW(159,178)=1;LW(159,179)=1;LW(159,180)=1;LW(159,181)=1;LW(159,182)=1;LW(159,183)=1;
    LW(159,184)=1;LW(159,185)=1;LW(159,186)=1;LW(159,187)=1;LW(159,188)=1;LW(159,189)=1;LW(159,190)=1;LW(159,191)=1;LW(159,192)=1;LW(159,193)=1;
    LW(159,194)=1;LW(159,195)=1;LW(159,196)=1;LW(159,197)=1;LW(159,198)=1;LW(159,199)=1;LW(159,200)=1;LW(159,201)=1;LW(159,202)=1;LW(159,203)=1;
    LW(159,204)=1;LW(159,205)=1;LW(159,206)=1;LW(159,207)=1;LW(159,208)=1;LW(159,209)=1;LW(159,210)=1;LW(159,211)=1;LW(159,212)=1;LW(159,213)=1;
    LW(159,214)=1;LW(159,215)=1;LW(159,216)=1;LW(159,217)=1;LW(159,218)=1;LW(159,219)=1;LW(159,220)=1;LW(159,221)=1;LW(159,222)=1;LW(159,223)=1;
    LW(159,224)=1;LW(159,225)=1;LW(159,226)=1;LW(159,227)=1;LW(159,228)=1;LW(159,229)=1;LW(159,230)=1;LW(160,1)=1;LW(160,2)=1;LW(160,3)=1;
    LW(160,4)=1;LW(160,5)=1;LW(160,6)=1;LW(160,7)=1;LW(160,8)=1;LW(160,9)=1;LW(160,10)=1;LW(160,11)=1;LW(160,12)=1;LW(160,13)=1;
    LW(160,14)=1;LW(160,15)=1;LW(160,16)=1;LW(160,17)=1;LW(160,18)=1;LW(160,19)=1;LW(160,20)=1;LW(160,21)=1;LW(160,22)=1;LW(160,23)=1;
    LW(160,24)=1;LW(160,25)=1;LW(160,26)=1;LW(160,27)=1;LW(160,28)=1;LW(160,29)=1;LW(160,30)=1;LW(160,31)=1;LW(160,32)=1;LW(160,33)=1;
    LW(160,34)=1;LW(160,35)=1;LW(160,36)=1;LW(160,37)=1;LW(160,38)=1;LW(160,39)=1;LW(160,40)=1;LW(160,41)=1;LW(160,42)=1;LW(160,43)=1;
    LW(160,44)=1;LW(160,45)=1;LW(160,46)=1;LW(160,47)=1;LW(160,48)=1;LW(160,49)=1;LW(160,50)=1;LW(160,51)=1;LW(160,52)=1;LW(160,53)=1;
    LW(160,54)=1;LW(160,55)=1;LW(160,56)=1;LW(160,57)=1;LW(160,58)=1;LW(160,59)=1;LW(160,60)=1;LW(160,61)=1;LW(160,62)=1;LW(160,63)=1;
    LW(160,64)=1;LW(160,65)=1;LW(160,66)=1;LW(160,67)=1;LW(160,68)=1;LW(160,69)=1;LW(160,70)=1;LW(160,71)=1;LW(160,72)=1;LW(160,73)=1;
    LW(160,74)=1;LW(160,75)=1;LW(160,76)=1;LW(160,77)=1;LW(160,78)=1;LW(160,79)=1;LW(160,80)=1;LW(160,81)=1;LW(160,82)=1;LW(160,83)=1;
    LW(160,84)=1;LW(160,85)=1;LW(160,86)=1;LW(160,87)=1;LW(160,88)=1;LW(160,89)=1;LW(160,90)=1;LW(160,91)=1;LW(160,92)=1;LW(160,93)=1;
    LW(160,94)=1;LW(160,95)=1;LW(160,96)=1;LW(160,97)=1;LW(160,98)=1;LW(160,99)=1;LW(160,100)=1;LW(160,101)=1;LW(160,102)=1;LW(160,103)=1;
    LW(160,104)=1;LW(160,105)=1;LW(160,106)=1;LW(160,107)=1;LW(160,108)=1;LW(160,109)=1;LW(160,110)=1;LW(160,111)=1;LW(160,112)=1;LW(160,113)=1;
    LW(160,114)=1;LW(160,115)=1;LW(160,116)=1;LW(160,117)=1;LW(160,118)=1;LW(160,119)=1;LW(160,120)=1;LW(160,121)=1;LW(160,122)=1;LW(160,123)=1;
    LW(160,124)=1;LW(160,125)=1;LW(160,126)=1;LW(160,127)=1;LW(160,128)=1;LW(160,129)=1;LW(160,130)=1;LW(160,131)=1;LW(160,132)=1;LW(160,133)=1;
    LW(160,134)=1;LW(160,135)=1;LW(160,136)=1;LW(160,137)=1;LW(160,138)=1;LW(160,139)=1;LW(160,140)=1;LW(160,141)=1;LW(160,142)=1;LW(160,143)=1;
    LW(160,144)=1;LW(160,145)=1;LW(160,146)=1;LW(160,147)=1;LW(160,148)=1;LW(160,149)=1;LW(160,150)=1;LW(160,151)=1;LW(160,152)=1;LW(160,153)=1;
    LW(160,154)=1;LW(160,155)=1;LW(160,156)=1;LW(160,157)=1;LW(160,158)=1;LW(160,159)=1;LW(160,160)=1;LW(160,161)=1;LW(160,162)=1;LW(160,163)=1;
    LW(160,164)=1;LW(160,165)=1;LW(160,166)=1;LW(160,167)=1;LW(160,168)=1;LW(160,169)=1;LW(160,170)=1;LW(160,171)=1;LW(160,172)=1;LW(160,173)=1;
    LW(160,174)=1;LW(160,175)=1;LW(160,176)=1;LW(160,177)=1;LW(160,178)=1;LW(160,179)=1;LW(160,180)=1;LW(160,181)=1;LW(160,182)=1;LW(160,183)=1;
    LW(160,184)=1;LW(160,185)=1;LW(160,186)=1;LW(160,187)=1;LW(160,188)=1;LW(160,189)=1;LW(160,190)=1;LW(160,191)=1;LW(160,192)=1;LW(160,193)=1;
    LW(160,194)=1;LW(160,195)=1;LW(160,196)=1;LW(160,197)=1;LW(160,198)=1;LW(160,199)=1;LW(160,200)=1;LW(160,201)=1;LW(160,202)=1;LW(160,203)=1;
    LW(160,204)=1;LW(160,205)=1;LW(160,206)=1;LW(160,207)=1;LW(160,208)=1;LW(160,209)=1;LW(160,210)=1;LW(160,211)=1;LW(160,212)=1;LW(160,213)=1;
    LW(160,214)=1;LW(160,215)=1;LW(160,216)=1;LW(160,217)=1;LW(160,218)=1;LW(160,219)=1;LW(160,220)=1;LW(160,221)=1;LW(160,222)=1;LW(160,223)=1;
    LW(160,224)=1;LW(160,225)=1;LW(160,226)=1;LW(160,227)=1;LW(160,228)=1;LW(160,229)=1;LW(160,230)=1;LW(160,231)=1;LW(160,232)=1;LW(160,233)=1;
    LW(160,234)=1;LW(160,235)=1;LW(160,236)=1;LW(161,1)=1;LW(161,2)=1;LW(161,3)=1;LW(161,4)=1;LW(161,5)=1;LW(161,6)=1;LW(161,7)=1;
    LW(161,8)=1;LW(161,9)=1;LW(161,10)=1;LW(161,11)=1;LW(161,12)=1;LW(161,13)=1;LW(161,14)=1;LW(161,15)=1;LW(161,16)=1;LW(161,17)=1;
    LW(161,18)=1;LW(161,19)=1;LW(161,20)=1;LW(161,21)=1;LW(161,22)=1;LW(161,23)=1;LW(161,24)=1;LW(161,25)=1;LW(161,26)=1;LW(161,27)=1;
    LW(161,28)=1;LW(161,29)=1;LW(161,30)=1;LW(161,31)=1;LW(161,32)=1;LW(161,33)=1;LW(161,34)=1;LW(161,35)=1;LW(161,36)=1;LW(161,37)=1;
    LW(161,38)=1;LW(161,39)=1;LW(161,40)=1;LW(161,41)=1;LW(161,42)=1;LW(161,43)=1;LW(161,44)=1;LW(161,45)=1;LW(161,46)=1;LW(161,47)=1;
    LW(161,48)=1;LW(161,49)=1;LW(161,50)=1;LW(161,51)=1;LW(161,52)=1;LW(161,53)=1;LW(161,54)=1;LW(161,55)=1;LW(161,56)=1;LW(161,57)=1;
    LW(161,58)=1;LW(161,59)=1;LW(161,60)=1;LW(161,61)=1;LW(161,62)=1;LW(161,63)=1;LW(161,64)=1;LW(161,65)=1;LW(161,66)=1;LW(161,67)=1;
    LW(161,68)=1;LW(161,69)=1;LW(161,70)=1;LW(161,71)=1;LW(161,72)=1;LW(161,73)=1;LW(161,74)=1;LW(161,75)=1;LW(161,76)=1;LW(161,77)=1;
    LW(161,78)=1;LW(161,79)=1;LW(161,80)=1;LW(161,81)=1;LW(161,82)=1;LW(161,83)=1;LW(161,84)=1;LW(161,85)=1;LW(161,86)=1;LW(161,87)=1;
    LW(161,88)=1;LW(161,89)=1;LW(161,90)=1;LW(161,91)=1;LW(161,92)=1;LW(161,93)=1;LW(161,94)=1;LW(161,95)=1;LW(161,96)=1;LW(161,97)=1;
    LW(161,98)=1;LW(161,99)=1;LW(161,100)=1;LW(161,101)=1;LW(161,102)=1;LW(161,103)=1;LW(161,104)=1;LW(161,105)=1;LW(161,106)=1;LW(161,107)=1;
    LW(161,108)=1;LW(161,109)=1;LW(161,110)=1;LW(161,111)=1;LW(161,112)=1;LW(161,113)=1;LW(161,114)=1;LW(161,115)=1;LW(161,116)=1;LW(161,117)=1;
    LW(161,118)=1;LW(161,119)=1;LW(161,120)=1;LW(161,121)=1;LW(161,122)=1;LW(161,123)=1;LW(161,124)=1;LW(161,125)=1;LW(161,126)=1;LW(161,127)=1;
    LW(161,128)=1;LW(161,129)=1;LW(161,130)=1;LW(161,131)=1;LW(161,132)=1;LW(161,133)=1;LW(161,134)=1;LW(161,135)=1;LW(161,136)=1;LW(161,137)=1;
    LW(161,138)=1;LW(161,139)=1;LW(161,140)=1;LW(161,141)=1;LW(161,142)=1;LW(161,143)=1;LW(161,144)=1;LW(161,145)=1;LW(161,146)=1;LW(161,147)=1;
    LW(161,148)=1;LW(161,149)=1;LW(161,150)=1;LW(161,151)=1;LW(161,152)=1;LW(161,153)=1;LW(161,154)=1;LW(161,155)=1;LW(161,156)=1;LW(161,157)=1;
    LW(161,158)=1;LW(161,159)=1;LW(161,160)=1;LW(161,161)=1;LW(161,162)=1;LW(161,163)=1;LW(161,164)=1;LW(161,165)=1;LW(161,166)=1;LW(161,167)=1;
    LW(161,168)=1;LW(161,169)=1;LW(161,170)=1;LW(161,171)=1;LW(161,172)=1;LW(161,173)=1;LW(161,174)=1;LW(161,175)=1;LW(161,176)=1;LW(161,177)=1;
    LW(161,178)=1;LW(161,179)=1;LW(161,180)=1;LW(161,181)=1;LW(161,182)=1;LW(161,183)=1;LW(161,184)=1;LW(161,185)=1;LW(161,186)=1;LW(161,187)=1;
    LW(161,188)=1;LW(161,189)=1;LW(161,190)=1;LW(161,191)=1;LW(161,192)=1;LW(161,193)=1;LW(161,194)=1;LW(161,195)=1;LW(161,196)=1;LW(161,197)=1;
    LW(161,198)=1;LW(161,199)=1;LW(161,200)=1;LW(161,201)=1;LW(161,202)=1;LW(161,203)=1;LW(161,204)=1;LW(161,205)=1;LW(161,206)=1;LW(161,207)=1;
    LW(161,208)=1;LW(161,209)=1;LW(161,210)=1;LW(161,211)=1;LW(161,212)=1;LW(161,213)=1;LW(161,214)=1;LW(161,215)=1;LW(161,216)=1;LW(161,217)=1;
    LW(161,218)=1;LW(161,219)=1;LW(161,220)=1;LW(161,221)=1;LW(161,222)=1;LW(161,223)=1;LW(161,224)=1;LW(161,225)=1;LW(161,226)=1;LW(161,227)=1;
    LW(161,228)=1;LW(161,229)=1;LW(161,230)=1;LW(161,231)=1;LW(161,232)=1;LW(161,233)=1;LW(161,234)=1;LW(161,235)=1;LW(161,236)=1;LW(161,237)=1;
    LW(161,238)=1;LW(161,239)=1;LW(161,240)=1;LW(161,241)=1;LW(161,242)=1;LW(161,246)=1;LW(161,247)=1;LW(162,1)=1;LW(162,2)=1;LW(162,3)=1;
    LW(162,4)=1;LW(162,5)=1;LW(162,6)=1;LW(162,7)=1;LW(162,8)=1;LW(162,9)=1;LW(162,10)=1;LW(162,11)=1;LW(162,12)=1;LW(162,13)=1;
    LW(162,14)=1;LW(162,15)=1;LW(162,16)=1;LW(162,17)=1;LW(162,18)=1;LW(162,19)=1;LW(162,20)=1;LW(162,21)=1;LW(162,22)=1;LW(162,23)=1;
    LW(162,24)=1;LW(162,25)=1;LW(162,26)=1;LW(162,27)=1;LW(162,28)=1;LW(162,29)=1;LW(162,30)=1;LW(162,31)=1;LW(162,32)=1;LW(162,33)=1;
    LW(162,34)=1;LW(162,35)=1;LW(162,36)=1;LW(162,37)=1;LW(162,38)=1;LW(162,39)=1;LW(162,40)=1;LW(162,41)=1;LW(162,42)=1;LW(162,43)=1;
    LW(162,44)=1;LW(162,45)=1;LW(162,46)=1;LW(162,47)=1;LW(162,48)=1;LW(162,49)=1;LW(162,50)=1;LW(162,51)=1;LW(162,52)=1;LW(162,53)=1;
    LW(162,54)=1;LW(162,55)=1;LW(162,56)=1;LW(162,57)=1;LW(162,58)=1;LW(162,59)=1;LW(162,60)=1;LW(162,61)=1;LW(162,62)=1;LW(162,63)=1;
    LW(162,64)=1;LW(162,65)=1;LW(162,66)=1;LW(162,67)=1;LW(162,68)=1;LW(162,69)=1;LW(162,70)=1;LW(162,71)=1;LW(162,72)=1;LW(162,73)=1;
    LW(162,74)=1;LW(162,75)=1;LW(162,76)=1;LW(162,77)=1;LW(162,78)=1;LW(162,79)=1;LW(162,80)=1;LW(162,81)=1;LW(162,82)=1;LW(162,83)=1;
    LW(162,84)=1;LW(162,85)=1;LW(162,86)=1;LW(162,87)=1;LW(162,88)=1;LW(162,89)=1;LW(162,90)=1;LW(162,91)=1;LW(162,92)=1;LW(162,93)=1;
    LW(162,94)=1;LW(162,95)=1;LW(162,96)=1;LW(162,97)=1;LW(162,98)=1;LW(162,99)=1;LW(162,100)=1;LW(162,101)=1;LW(162,102)=1;LW(162,103)=1;
    LW(162,104)=1;LW(162,105)=1;LW(162,106)=1;LW(162,107)=1;LW(162,108)=1;LW(162,109)=1;LW(162,110)=1;LW(162,111)=1;LW(162,112)=1;LW(162,113)=1;
    LW(162,114)=1;LW(162,115)=1;LW(162,116)=1;LW(162,117)=1;LW(162,118)=1;LW(162,119)=1;LW(162,120)=1;LW(162,121)=1;LW(162,122)=1;LW(162,123)=1;
    LW(162,124)=1;LW(162,125)=1;LW(162,126)=1;LW(162,127)=1;LW(162,128)=1;LW(162,129)=1;LW(162,130)=1;LW(162,131)=1;LW(162,132)=1;LW(162,133)=1;
    LW(162,134)=1;LW(162,135)=1;LW(162,136)=1;LW(162,137)=1;LW(162,138)=1;LW(162,139)=1;LW(162,140)=1;LW(162,141)=1;LW(162,142)=1;LW(162,143)=1;
    LW(162,144)=1;LW(162,145)=1;LW(162,146)=1;LW(162,147)=1;LW(162,148)=1;LW(162,149)=1;LW(162,150)=1;LW(162,151)=1;LW(162,152)=1;LW(162,153)=1;
    LW(162,154)=1;LW(162,155)=1;LW(162,156)=1;LW(162,157)=1;LW(162,158)=1;LW(162,159)=1;LW(162,160)=1;LW(162,161)=1;LW(162,162)=1;LW(162,163)=1;
    LW(162,164)=1;LW(162,165)=1;LW(162,166)=1;LW(162,167)=1;LW(162,168)=1;LW(162,169)=1;LW(162,170)=1;LW(162,171)=1;LW(162,172)=1;LW(162,173)=1;
    LW(162,174)=1;LW(162,175)=1;LW(162,176)=1;LW(162,177)=1;LW(162,178)=1;LW(162,179)=1;LW(162,180)=1;LW(162,181)=1;LW(162,182)=1;LW(162,183)=1;
    LW(162,184)=1;LW(162,185)=1;LW(162,186)=1;LW(162,187)=1;LW(162,188)=1;LW(162,189)=1;LW(162,190)=1;LW(162,191)=1;LW(162,192)=1;LW(162,193)=1;
    LW(162,194)=1;LW(162,195)=1;LW(162,196)=1;LW(162,197)=1;LW(162,198)=1;LW(162,199)=1;LW(162,200)=1;LW(162,201)=1;LW(162,202)=1;LW(162,203)=1;
    LW(162,204)=1;LW(162,205)=1;LW(162,206)=1;LW(162,207)=1;LW(162,208)=1;LW(162,209)=1;LW(162,210)=1;LW(162,211)=1;LW(162,212)=1;LW(162,213)=1;
    LW(162,214)=1;LW(162,215)=1;LW(162,216)=1;LW(162,217)=1;LW(162,218)=1;LW(162,219)=1;LW(162,220)=1;LW(162,221)=1;LW(162,222)=1;LW(162,223)=1;
    LW(162,224)=1;LW(162,225)=1;LW(162,226)=1;LW(162,227)=1;LW(162,228)=1;LW(162,229)=1;LW(162,230)=1;LW(162,231)=1;LW(162,232)=1;LW(162,233)=1;
    LW(162,234)=1;LW(162,235)=1;LW(162,236)=1;LW(162,237)=1;LW(162,238)=1;LW(162,239)=1;LW(162,240)=1;LW(162,241)=1;LW(162,242)=1;LW(162,243)=1;
    LW(162,244)=1;LW(162,245)=1;LW(162,246)=1;LW(162,247)=1;LW(162,248)=1;LW(162,249)=1;LW(162,250)=1;LW(163,1)=1;LW(163,2)=1;LW(163,3)=1;
    LW(163,4)=1;LW(163,5)=1;LW(163,6)=1;LW(163,7)=1;LW(163,8)=1;LW(163,9)=1;LW(163,10)=1;LW(163,11)=1;LW(163,12)=1;LW(163,13)=1;
    LW(163,14)=1;LW(163,15)=1;LW(163,16)=1;LW(163,17)=1;LW(163,18)=1;LW(163,19)=1;LW(163,20)=1;LW(163,21)=1;LW(163,22)=1;LW(163,23)=1;
    LW(163,24)=1;LW(163,25)=1;LW(163,26)=1;LW(163,27)=1;LW(163,28)=1;LW(163,29)=1;LW(163,30)=1;LW(163,31)=1;LW(163,32)=1;LW(163,33)=1;
    LW(163,34)=1;LW(163,35)=1;LW(163,36)=1;LW(163,37)=1;LW(163,38)=1;LW(163,39)=1;LW(163,40)=1;LW(163,41)=1;LW(163,42)=1;LW(163,43)=1;
    LW(163,44)=1;LW(163,45)=1;LW(163,46)=1;LW(163,47)=1;LW(163,48)=1;LW(163,49)=1;LW(163,50)=1;LW(163,51)=1;LW(163,52)=1;LW(163,53)=1;
    LW(163,54)=1;LW(163,55)=1;LW(163,56)=1;LW(163,57)=1;LW(163,58)=1;LW(163,59)=1;LW(163,60)=1;LW(163,61)=1;LW(163,62)=1;LW(163,63)=1;
    LW(163,64)=1;LW(163,65)=1;LW(163,66)=1;LW(163,67)=1;LW(163,68)=1;LW(163,69)=1;LW(163,70)=1;LW(163,71)=1;LW(163,72)=1;LW(163,73)=1;
    LW(163,74)=1;LW(163,75)=1;LW(163,76)=1;LW(163,77)=1;LW(163,78)=1;LW(163,79)=1;LW(163,80)=1;LW(163,81)=1;LW(163,82)=1;LW(163,83)=1;
    LW(163,84)=1;LW(163,85)=1;LW(163,86)=1;LW(163,87)=1;LW(163,88)=1;LW(163,89)=1;LW(163,90)=1;LW(163,91)=1;LW(163,92)=1;LW(163,93)=1;
    LW(163,94)=1;LW(163,95)=1;LW(163,96)=1;LW(163,97)=1;LW(163,98)=1;LW(163,99)=1;LW(163,100)=1;LW(163,101)=1;LW(163,102)=1;LW(163,103)=1;
    LW(163,104)=1;LW(163,105)=1;LW(163,106)=1;LW(163,107)=1;LW(163,108)=1;LW(163,109)=1;LW(163,110)=1;LW(163,111)=1;LW(163,112)=1;LW(163,113)=1;
    LW(163,114)=1;LW(163,115)=1;LW(163,116)=1;LW(163,117)=1;LW(163,118)=1;LW(163,119)=1;LW(163,120)=1;LW(163,121)=1;LW(163,122)=1;LW(163,123)=1;
    LW(163,124)=1;LW(163,125)=1;LW(163,126)=1;LW(163,127)=1;LW(163,128)=1;LW(163,129)=1;LW(163,130)=1;LW(163,131)=1;LW(163,132)=1;LW(163,133)=1;
    LW(163,134)=1;LW(163,135)=1;LW(163,136)=1;LW(163,137)=1;LW(163,138)=1;LW(163,139)=1;LW(163,140)=1;LW(163,141)=1;LW(163,142)=1;LW(163,143)=1;
    LW(163,144)=1;LW(163,145)=1;LW(163,146)=1;LW(163,147)=1;LW(163,148)=1;LW(163,149)=1;LW(163,150)=1;LW(163,151)=1;LW(163,152)=1;LW(163,153)=1;
    LW(163,154)=1;LW(163,155)=1;LW(163,156)=1;LW(163,157)=1;LW(163,158)=1;LW(163,159)=1;LW(163,160)=1;LW(163,161)=1;LW(163,162)=1;LW(163,163)=1;
    LW(163,164)=1;LW(163,165)=1;LW(163,166)=1;LW(163,167)=1;LW(163,168)=1;LW(163,169)=1;LW(163,170)=1;LW(163,171)=1;LW(163,172)=1;LW(163,173)=1;
    LW(163,174)=1;LW(163,175)=1;LW(163,176)=1;LW(163,177)=1;LW(163,178)=1;LW(163,179)=1;LW(163,180)=1;LW(163,181)=1;LW(163,182)=1;LW(163,183)=1;
    LW(163,184)=1;LW(163,185)=1;LW(163,186)=1;LW(163,187)=1;LW(163,188)=1;LW(163,189)=1;LW(163,190)=1;LW(163,191)=1;LW(163,192)=1;LW(163,193)=1;
    LW(163,194)=1;LW(163,195)=1;LW(163,196)=1;LW(163,197)=1;LW(163,198)=1;LW(163,199)=1;LW(163,200)=1;LW(163,201)=1;LW(163,202)=1;LW(163,203)=1;
    LW(163,204)=1;LW(163,205)=1;LW(163,206)=1;LW(163,207)=1;LW(163,208)=1;LW(163,209)=1;LW(163,210)=1;LW(163,211)=1;LW(163,212)=1;LW(163,213)=1;
    LW(163,214)=1;LW(163,215)=1;LW(163,216)=1;LW(163,217)=1;LW(163,218)=1;LW(163,219)=1;LW(163,220)=1;LW(163,221)=1;LW(163,222)=1;LW(163,223)=1;
    LW(163,224)=1;LW(163,225)=1;LW(163,226)=1;LW(163,227)=1;LW(163,228)=1;LW(163,229)=1;LW(163,230)=1;LW(163,231)=1;LW(163,232)=1;LW(163,233)=1;
    LW(163,234)=1;LW(163,235)=1;LW(163,236)=1;LW(163,237)=1;LW(163,238)=1;LW(163,239)=1;LW(163,240)=1;LW(163,241)=1;LW(163,242)=1;LW(163,243)=1;
    LW(163,244)=1;LW(163,245)=1;LW(163,246)=1;LW(163,247)=1;LW(163,248)=1;LW(163,249)=1;LW(163,250)=1;LW(163,251)=1;LW(163,252)=1;LW(163,253)=1;
    LW(163,254)=1;LW(163,255)=1;LW(163,256)=1;LW(163,260)=1;LW(163,261)=1;LW(164,1)=1;LW(164,2)=1;LW(164,3)=1;LW(164,4)=1;LW(164,5)=1;
    LW(164,6)=1;LW(164,7)=1;LW(164,8)=1;LW(164,9)=1;LW(164,10)=1;LW(164,11)=1;LW(164,12)=1;LW(164,13)=1;LW(164,14)=1;LW(164,15)=1;
    LW(164,16)=1;LW(164,17)=1;LW(164,18)=1;LW(164,19)=1;LW(164,20)=1;LW(164,21)=1;LW(164,22)=1;LW(164,23)=1;LW(164,24)=1;LW(164,25)=1;
    LW(164,26)=1;LW(164,27)=1;LW(164,28)=1;LW(164,29)=1;LW(164,30)=1;LW(164,31)=1;LW(164,32)=1;LW(164,33)=1;LW(164,34)=1;LW(164,35)=1;
    LW(164,36)=1;LW(164,37)=1;LW(164,38)=1;LW(164,39)=1;LW(164,40)=1;LW(164,41)=1;LW(164,42)=1;LW(164,43)=1;LW(164,44)=1;LW(164,45)=1;
    LW(164,46)=1;LW(164,47)=1;LW(164,48)=1;LW(164,49)=1;LW(164,50)=1;LW(164,51)=1;LW(164,52)=1;LW(164,53)=1;LW(164,54)=1;LW(164,55)=1;
    LW(164,56)=1;LW(164,57)=1;LW(164,58)=1;LW(164,59)=1;LW(164,60)=1;LW(164,61)=1;LW(164,62)=1;LW(164,63)=1;LW(164,64)=1;LW(164,65)=1;
    LW(164,66)=1;LW(164,67)=1;LW(164,68)=1;LW(164,69)=1;LW(164,70)=1;LW(164,71)=1;LW(164,72)=1;LW(164,73)=1;LW(164,74)=1;LW(164,75)=1;
    LW(164,76)=1;LW(164,77)=1;LW(164,78)=1;LW(164,79)=1;LW(164,80)=1;LW(164,81)=1;LW(164,82)=1;LW(164,83)=1;LW(164,84)=1;LW(164,85)=1;
    LW(164,86)=1;LW(164,87)=1;LW(164,88)=1;LW(164,89)=1;LW(164,90)=1;LW(164,91)=1;LW(164,92)=1;LW(164,93)=1;LW(164,94)=1;LW(164,95)=1;
    LW(164,96)=1;LW(164,97)=1;LW(164,98)=1;LW(164,99)=1;LW(164,100)=1;LW(164,101)=1;LW(164,102)=1;LW(164,103)=1;LW(164,104)=1;LW(164,105)=1;
    LW(164,106)=1;LW(164,107)=1;LW(164,108)=1;LW(164,109)=1;LW(164,110)=1;LW(164,111)=1;LW(164,112)=1;LW(164,113)=1;LW(164,114)=1;LW(164,115)=1;
    LW(164,116)=1;LW(164,117)=1;LW(164,118)=1;LW(164,119)=1;LW(164,120)=1;LW(164,121)=1;LW(164,122)=1;LW(164,123)=1;LW(164,124)=1;LW(164,125)=1;
    LW(164,126)=1;LW(164,127)=1;LW(164,128)=1;LW(164,129)=1;LW(164,130)=1;LW(164,131)=1;LW(164,132)=1;LW(164,133)=1;LW(164,134)=1;LW(164,135)=1;
    LW(164,136)=1;LW(164,137)=1;LW(164,138)=1;LW(164,139)=1;LW(164,140)=1;LW(164,141)=1;LW(164,142)=1;LW(164,143)=1;LW(164,144)=1;LW(164,145)=1;
    LW(164,146)=1;LW(164,147)=1;LW(164,148)=1;LW(164,149)=1;LW(164,150)=1;LW(164,151)=1;LW(164,152)=1;LW(164,153)=1;LW(164,154)=1;LW(164,155)=1;
    LW(164,156)=1;LW(164,157)=1;LW(164,158)=1;LW(164,159)=1;LW(164,160)=1;LW(164,161)=1;LW(164,162)=1;LW(164,163)=1;LW(164,164)=1;LW(164,165)=1;
    LW(164,166)=1;LW(164,167)=1;LW(164,168)=1;LW(164,169)=1;LW(164,170)=1;LW(164,171)=1;LW(164,172)=1;LW(164,173)=1;LW(164,174)=1;LW(164,175)=1;
    LW(164,176)=1;LW(164,177)=1;LW(164,178)=1;LW(164,179)=1;LW(164,180)=1;LW(164,181)=1;LW(164,182)=1;LW(164,183)=1;LW(164,184)=1;LW(164,185)=1;
    LW(164,186)=1;LW(164,187)=1;LW(164,188)=1;LW(164,189)=1;LW(164,190)=1;LW(164,191)=1;LW(164,192)=1;LW(164,193)=1;LW(164,194)=1;LW(164,195)=1;
    LW(164,196)=1;LW(164,197)=1;LW(164,198)=1;LW(164,199)=1;LW(164,200)=1;LW(164,201)=1;LW(164,202)=1;LW(164,203)=1;LW(164,204)=1;LW(164,205)=1;
    LW(164,206)=1;LW(164,207)=1;LW(164,208)=1;LW(164,209)=1;LW(164,210)=1;LW(164,211)=1;LW(164,212)=1;LW(164,213)=1;LW(164,214)=1;LW(164,215)=1;
    LW(164,216)=1;LW(164,217)=1;LW(164,218)=1;LW(164,219)=1;LW(164,220)=1;LW(164,221)=1;LW(164,222)=1;LW(164,223)=1;LW(164,224)=1;LW(164,225)=1;
    LW(164,226)=1;LW(164,227)=1;LW(164,228)=1;LW(164,229)=1;LW(164,230)=1;LW(164,231)=1;LW(164,232)=1;LW(164,233)=1;LW(164,234)=1;LW(164,235)=1;
    LW(164,236)=1;LW(164,237)=1;LW(164,238)=1;LW(164,239)=1;LW(164,240)=1;LW(164,241)=1;LW(164,242)=1;LW(164,243)=1;LW(164,244)=1;LW(164,245)=1;
    LW(164,246)=1;LW(164,247)=1;LW(164,248)=1;LW(164,249)=1;LW(164,250)=1;LW(164,251)=1;LW(164,252)=1;LW(164,253)=1;LW(164,254)=1;LW(164,255)=1;
    LW(164,256)=1;LW(164,257)=1;LW(164,258)=1;LW(164,259)=1;LW(164,260)=1;LW(164,261)=1;LW(164,262)=1;LW(164,263)=1;LW(165,1)=1;LW(165,2)=1;
    LW(165,3)=1;LW(165,4)=1;LW(165,5)=1;LW(165,6)=1;LW(165,7)=1;LW(165,8)=1;LW(165,9)=1;LW(165,10)=1;LW(165,11)=1;LW(165,12)=1;
    LW(165,13)=1;LW(165,14)=1;LW(165,15)=1;LW(165,16)=1;LW(165,17)=1;LW(165,18)=1;LW(165,19)=1;LW(165,20)=1;LW(165,21)=1;LW(165,22)=1;
    LW(165,23)=1;LW(165,24)=1;LW(165,25)=1;LW(165,26)=1;LW(165,27)=1;LW(165,28)=1;LW(165,29)=1;LW(165,30)=1;LW(165,31)=1;LW(165,32)=1;
    LW(165,33)=1;LW(165,34)=1;LW(165,35)=1;LW(165,36)=1;LW(165,37)=1;LW(165,38)=1;LW(165,39)=1;LW(165,40)=1;LW(165,41)=1;LW(165,42)=1;
    LW(165,43)=1;LW(165,44)=1;LW(165,45)=1;LW(165,46)=1;LW(165,47)=1;LW(165,48)=1;LW(165,49)=1;LW(165,50)=1;LW(165,51)=1;LW(165,52)=1;
    LW(165,53)=1;LW(165,54)=1;LW(165,55)=1;LW(165,56)=1;LW(165,57)=1;LW(165,58)=1;LW(165,59)=1;LW(165,60)=1;LW(165,61)=1;LW(165,62)=1;
    LW(165,63)=1;LW(165,64)=1;LW(165,65)=1;LW(165,66)=1;LW(165,67)=1;LW(165,68)=1;LW(165,69)=1;LW(165,70)=1;LW(165,71)=1;LW(165,72)=1;
    LW(165,73)=1;LW(165,74)=1;LW(165,75)=1;LW(165,76)=1;LW(165,77)=1;LW(165,78)=1;LW(165,79)=1;LW(165,80)=1;LW(165,81)=1;LW(165,82)=1;
    LW(165,83)=1;LW(165,84)=1;LW(165,85)=1;LW(165,86)=1;LW(165,87)=1;LW(165,88)=1;LW(165,89)=1;LW(165,90)=1;LW(165,91)=1;LW(165,92)=1;
    LW(165,93)=1;LW(165,94)=1;LW(165,95)=1;LW(165,96)=1;LW(165,97)=1;LW(165,98)=1;LW(165,99)=1;LW(165,100)=1;LW(165,101)=1;LW(165,102)=1;
    LW(165,103)=1;LW(165,104)=1;LW(165,105)=1;LW(165,106)=1;LW(165,107)=1;LW(165,108)=1;LW(165,109)=1;LW(165,110)=1;LW(165,111)=1;LW(165,112)=1;
    LW(165,113)=1;LW(165,114)=1;LW(165,115)=1;LW(165,116)=1;LW(165,117)=1;LW(165,118)=1;LW(165,119)=1;LW(165,120)=1;LW(165,121)=1;LW(165,122)=1;
    LW(165,123)=1;LW(165,124)=1;LW(165,125)=1;LW(165,126)=1;LW(165,127)=1;LW(165,128)=1;LW(165,129)=1;LW(165,130)=1;LW(165,131)=1;LW(165,132)=1;
    LW(165,133)=1;LW(165,134)=1;LW(165,135)=1;LW(165,136)=1;LW(165,137)=1;LW(165,138)=1;LW(165,139)=1;LW(165,140)=1;LW(165,141)=1;LW(165,142)=1;
    LW(165,143)=1;LW(165,144)=1;LW(165,145)=1;LW(165,146)=1;LW(165,147)=1;LW(165,148)=1;LW(165,149)=1;LW(165,150)=1;LW(165,151)=1;LW(165,152)=1;
    LW(165,153)=1;LW(165,154)=1;LW(165,155)=1;LW(165,156)=1;LW(165,157)=1;LW(165,158)=1;LW(165,159)=1;LW(165,160)=1;LW(165,161)=1;LW(165,162)=1;
    LW(165,163)=1;LW(165,164)=1;LW(165,165)=1;LW(165,166)=1;LW(165,167)=1;LW(165,168)=1;LW(165,169)=1;LW(165,170)=1;LW(165,171)=1;LW(165,172)=1;
    LW(165,173)=1;LW(165,174)=1;LW(165,175)=1;LW(165,176)=1;LW(165,177)=1;LW(165,178)=1;LW(165,179)=1;LW(165,180)=1;LW(165,181)=1;LW(165,182)=1;
    LW(165,183)=1;LW(165,184)=1;LW(165,185)=1;LW(165,186)=1;LW(165,187)=1;LW(165,188)=1;LW(165,189)=1;LW(165,190)=1;LW(165,191)=1;LW(165,192)=1;
    LW(165,193)=1;LW(165,194)=1;LW(165,195)=1;LW(165,196)=1;LW(165,197)=1;LW(165,198)=1;LW(165,199)=1;LW(165,200)=1;LW(165,201)=1;LW(165,202)=1;
    LW(165,203)=1;LW(165,204)=1;LW(165,205)=1;LW(165,206)=1;LW(165,207)=1;LW(165,208)=1;LW(165,209)=1;LW(165,210)=1;LW(165,211)=1;LW(165,212)=1;
    LW(165,213)=1;LW(165,214)=1;LW(165,215)=1;LW(165,216)=1;LW(165,217)=1;LW(165,218)=1;LW(165,219)=1;LW(165,220)=1;LW(165,221)=1;LW(165,222)=1;
    LW(165,223)=1;LW(165,224)=1;LW(165,225)=1;LW(165,226)=1;LW(165,227)=1;LW(165,228)=1;LW(165,229)=1;LW(165,230)=1;LW(165,231)=1;LW(165,232)=1;
    LW(165,233)=1;LW(165,234)=1;LW(165,235)=1;LW(165,236)=1;LW(165,237)=1;LW(165,238)=1;LW(165,239)=1;LW(165,240)=1;LW(165,241)=1;LW(165,242)=1;
    LW(165,243)=1;LW(165,244)=1;LW(165,245)=1;LW(165,246)=1;LW(165,247)=1;LW(165,248)=1;LW(165,249)=1;LW(165,250)=1;LW(165,251)=1;LW(165,252)=1;
    LW(165,253)=1;LW(165,254)=1;LW(165,255)=1;LW(165,256)=1;LW(165,257)=1;LW(165,258)=1;LW(165,259)=1;LW(165,260)=1;LW(165,261)=1;LW(165,262)=1;
    LW(165,263)=1;LW(165,264)=1;LW(165,265)=1;LW(166,1)=1;LW(166,2)=1;LW(166,3)=1;LW(166,4)=1;LW(166,5)=1;LW(166,6)=1;LW(166,7)=1;
    LW(166,8)=1;LW(166,9)=1;LW(166,10)=1;LW(166,11)=1;LW(166,12)=1;LW(166,13)=1;LW(166,14)=1;LW(166,15)=1;LW(166,16)=1;LW(166,17)=1;
    LW(166,18)=1;LW(166,19)=1;LW(166,20)=1;LW(166,21)=1;LW(166,22)=1;LW(166,23)=1;LW(166,24)=1;LW(166,25)=1;LW(166,26)=1;LW(166,27)=1;
    LW(166,28)=1;LW(166,29)=1;LW(166,30)=1;LW(166,31)=1;LW(166,32)=1;LW(166,33)=1;LW(166,34)=1;LW(166,35)=1;LW(166,36)=1;LW(166,37)=1;
    LW(166,38)=1;LW(166,39)=1;LW(166,40)=1;LW(166,41)=1;LW(166,42)=1;LW(166,43)=1;LW(166,44)=1;LW(166,45)=1;LW(166,46)=1;LW(166,47)=1;
    LW(166,48)=1;LW(166,49)=1;LW(166,50)=1;LW(166,51)=1;LW(166,52)=1;LW(166,53)=1;LW(166,54)=1;LW(166,55)=1;LW(166,56)=1;LW(166,57)=1;
    LW(166,58)=1;LW(166,59)=1;LW(166,60)=1;LW(166,61)=1;LW(166,62)=1;LW(166,63)=1;LW(166,64)=1;LW(166,65)=1;LW(166,66)=1;LW(166,67)=1;
    LW(166,68)=1;LW(166,69)=1;LW(166,70)=1;LW(166,71)=1;LW(166,72)=1;LW(166,73)=1;LW(166,74)=1;LW(166,75)=1;LW(166,76)=1;LW(166,77)=1;
    LW(166,78)=1;LW(166,79)=1;LW(166,80)=1;LW(166,81)=1;LW(166,82)=1;LW(166,83)=1;LW(166,84)=1;LW(166,85)=1;LW(166,86)=1;LW(166,87)=1;
    LW(166,88)=1;LW(166,89)=1;LW(166,90)=1;LW(166,91)=1;LW(166,92)=1;LW(166,93)=1;LW(166,94)=1;LW(166,95)=1;LW(166,96)=1;LW(166,97)=1;
    LW(166,98)=1;LW(166,99)=1;LW(166,100)=1;LW(166,101)=1;LW(166,102)=1;LW(166,103)=1;LW(166,104)=1;LW(166,105)=1;LW(166,106)=1;LW(166,107)=1;
    LW(166,108)=1;LW(166,109)=1;LW(166,110)=1;LW(166,111)=1;LW(166,112)=1;LW(166,113)=1;LW(166,114)=1;LW(166,115)=1;LW(166,116)=1;LW(166,117)=1;
    LW(166,118)=1;LW(166,119)=1;LW(166,120)=1;LW(166,121)=1;LW(166,122)=1;LW(166,123)=1;LW(166,124)=1;LW(166,125)=1;LW(166,126)=1;LW(166,127)=1;
    LW(166,128)=1;LW(166,129)=1;LW(166,130)=1;LW(166,131)=1;LW(166,132)=1;LW(166,133)=1;LW(166,134)=1;LW(166,135)=1;LW(166,136)=1;LW(166,137)=1;
    LW(166,138)=1;LW(166,139)=1;LW(166,140)=1;LW(166,141)=1;LW(166,142)=1;LW(166,143)=1;LW(166,144)=1;LW(166,145)=1;LW(166,146)=1;LW(166,147)=1;
    LW(166,148)=1;LW(166,149)=1;LW(166,150)=1;LW(166,151)=1;LW(166,152)=1;LW(166,153)=1;LW(166,154)=1;LW(166,155)=1;LW(166,156)=1;LW(166,157)=1;
    LW(166,158)=1;LW(166,159)=1;LW(166,160)=1;LW(166,161)=1;LW(166,162)=1;LW(166,163)=1;LW(166,164)=1;LW(166,165)=1;LW(166,166)=1;LW(166,167)=1;
    LW(166,168)=1;LW(166,169)=1;LW(166,170)=1;LW(166,171)=1;LW(166,172)=1;LW(166,173)=1;LW(166,174)=1;LW(166,175)=1;LW(166,176)=1;LW(166,177)=1;
    LW(166,178)=1;LW(166,179)=1;LW(166,180)=1;LW(166,181)=1;LW(166,182)=1;LW(166,183)=1;LW(166,184)=1;LW(166,185)=1;LW(166,186)=1;LW(166,187)=1;
    LW(166,188)=1;LW(166,189)=1;LW(166,190)=1;LW(166,191)=1;LW(166,192)=1;LW(166,193)=1;LW(166,194)=1;LW(166,195)=1;LW(166,196)=1;LW(166,197)=1;
    LW(166,198)=1;LW(166,199)=1;LW(166,200)=1;LW(166,201)=1;LW(166,202)=1;LW(166,203)=1;LW(166,204)=1;LW(166,205)=1;LW(166,206)=1;LW(166,207)=1;
    LW(166,208)=1;LW(166,209)=1;LW(166,210)=1;LW(166,211)=1;LW(166,212)=1;LW(166,213)=1;LW(166,214)=1;LW(166,215)=1;LW(166,216)=1;LW(166,217)=1;
    LW(166,218)=1;LW(166,219)=1;LW(166,220)=1;LW(166,221)=1;LW(166,222)=1;LW(166,223)=1;LW(166,224)=1;LW(166,225)=1;LW(166,226)=1;LW(166,227)=1;
    LW(166,228)=1;LW(166,229)=1;LW(166,230)=1;LW(166,231)=1;LW(166,232)=1;LW(166,233)=1;LW(166,234)=1;LW(166,235)=1;LW(166,236)=1;LW(166,237)=1;
    LW(166,238)=1;LW(166,239)=1;LW(166,240)=1;LW(166,241)=1;LW(166,242)=1;LW(166,243)=1;LW(166,244)=1;LW(166,245)=1;LW(166,246)=1;LW(166,247)=1;
    LW(166,248)=1;LW(166,249)=1;LW(166,250)=1;LW(166,251)=1;LW(166,252)=1;LW(166,253)=1;LW(166,254)=1;LW(166,255)=1;LW(166,256)=1;LW(166,257)=1;
    LW(166,258)=1;LW(166,259)=1;LW(166,260)=1;LW(166,261)=1;LW(166,262)=1;LW(166,263)=1;LW(166,264)=1;LW(166,265)=1;LW(166,266)=1;LW(166,267)=1;
    LW(166,268)=1;LW(166,269)=1;LW(167,1)=1;LW(167,2)=1;LW(167,3)=1;LW(167,4)=1;LW(167,5)=1;LW(167,6)=1;LW(167,7)=1;LW(167,8)=1;
    LW(167,9)=1;LW(167,10)=1;LW(167,11)=1;LW(167,12)=1;LW(167,13)=1;LW(167,14)=1;LW(167,15)=1;LW(167,16)=1;LW(167,17)=1;LW(167,18)=1;
    LW(167,19)=1;LW(167,20)=1;LW(167,21)=1;LW(167,22)=1;LW(167,23)=1;LW(167,24)=1;LW(167,25)=1;LW(167,26)=1;LW(167,27)=1;LW(167,28)=1;
    LW(167,29)=1;LW(167,30)=1;LW(167,31)=1;LW(167,32)=1;LW(167,33)=1;LW(167,34)=1;LW(167,35)=1;LW(167,36)=1;LW(167,37)=1;LW(167,38)=1;
    LW(167,39)=1;LW(167,40)=1;LW(167,41)=1;LW(167,42)=1;LW(167,43)=1;LW(167,44)=1;LW(167,45)=1;LW(167,46)=1;LW(167,47)=1;LW(167,48)=1;
    LW(167,49)=1;LW(167,50)=1;LW(167,51)=1;LW(167,52)=1;LW(167,53)=1;LW(167,54)=1;LW(167,55)=1;LW(167,56)=1;LW(167,57)=1;LW(167,58)=1;
    LW(167,59)=1;LW(167,60)=1;LW(167,61)=1;LW(167,62)=1;LW(167,63)=1;LW(167,64)=1;LW(167,65)=1;LW(167,66)=1;LW(167,67)=1;LW(167,68)=1;
    LW(167,69)=1;LW(167,70)=1;LW(167,71)=1;LW(167,72)=1;LW(167,73)=1;LW(167,74)=1;LW(167,75)=1;LW(167,76)=1;LW(167,77)=1;LW(167,78)=1;
    LW(167,79)=1;LW(167,80)=1;LW(167,81)=1;LW(167,82)=1;LW(167,83)=1;LW(167,84)=1;LW(167,85)=1;LW(167,86)=1;LW(167,87)=1;LW(167,88)=1;
    LW(167,89)=1;LW(167,90)=1;LW(167,91)=1;LW(167,92)=1;LW(167,93)=1;LW(167,94)=1;LW(167,95)=1;LW(167,96)=1;LW(167,97)=1;LW(167,98)=1;
    LW(167,99)=1;LW(167,100)=1;LW(167,101)=1;LW(167,102)=1;LW(167,103)=1;LW(167,104)=1;LW(167,105)=1;LW(167,106)=1;LW(167,107)=1;LW(167,108)=1;
    LW(167,109)=1;LW(167,110)=1;LW(167,111)=1;LW(167,112)=1;LW(167,113)=1;LW(167,114)=1;LW(167,115)=1;LW(167,116)=1;LW(167,117)=1;LW(167,118)=1;
    LW(167,119)=1;LW(167,120)=1;LW(167,121)=1;LW(167,122)=1;LW(167,123)=1;LW(167,124)=1;LW(167,125)=1;LW(167,126)=1;LW(167,127)=1;LW(167,128)=1;
    LW(167,129)=1;LW(167,130)=1;LW(167,131)=1;LW(167,132)=1;LW(167,133)=1;LW(167,134)=1;LW(167,135)=1;LW(167,136)=1;LW(167,137)=1;LW(167,138)=1;
    LW(167,139)=1;LW(167,140)=1;LW(167,141)=1;LW(167,142)=1;LW(167,143)=1;LW(167,144)=1;LW(167,145)=1;LW(167,146)=1;LW(167,147)=1;LW(167,148)=1;
    LW(167,149)=1;LW(167,150)=1;LW(167,151)=1;LW(167,152)=1;LW(167,153)=1;LW(167,154)=1;LW(167,155)=1;LW(167,156)=1;LW(167,157)=1;LW(167,158)=1;
    LW(167,159)=1;LW(167,160)=1;LW(167,161)=1;LW(167,162)=1;LW(167,163)=1;LW(167,164)=1;LW(167,165)=1;LW(167,166)=1;LW(167,167)=1;LW(167,168)=1;
    LW(167,169)=1;LW(167,170)=1;LW(167,171)=1;LW(167,172)=1;LW(167,173)=1;LW(167,174)=1;LW(167,175)=1;LW(167,176)=1;LW(167,177)=1;LW(167,178)=1;
    LW(167,179)=1;LW(167,180)=1;LW(167,181)=1;LW(167,182)=1;LW(167,183)=1;LW(167,184)=1;LW(167,185)=1;LW(167,186)=1;LW(167,187)=1;LW(167,188)=1;
    LW(167,189)=1;LW(167,190)=1;LW(167,191)=1;LW(167,192)=1;LW(167,193)=1;LW(167,194)=1;LW(167,195)=1;LW(167,196)=1;LW(167,197)=1;LW(167,198)=1;
    LW(167,199)=1;LW(167,200)=1;LW(167,201)=1;LW(167,202)=1;LW(167,203)=1;LW(167,204)=1;LW(167,205)=1;LW(167,206)=1;LW(167,207)=1;LW(167,208)=1;
    LW(167,209)=1;LW(167,210)=1;LW(167,211)=1;LW(167,212)=1;LW(167,213)=1;LW(167,214)=1;LW(167,215)=1;LW(167,216)=1;LW(167,217)=1;LW(167,218)=1;
    LW(167,219)=1;LW(167,220)=1;LW(167,221)=1;LW(167,222)=1;LW(167,223)=1;LW(167,224)=1;LW(167,225)=1;LW(167,226)=1;LW(167,227)=1;LW(167,228)=1;
    LW(167,229)=1;LW(167,230)=1;LW(167,231)=1;LW(167,232)=1;LW(167,233)=1;LW(167,234)=1;LW(167,235)=1;LW(167,236)=1;LW(167,237)=1;LW(167,238)=1;
    LW(167,239)=1;LW(167,240)=1;LW(167,241)=1;LW(167,242)=1;LW(167,243)=1;LW(167,244)=1;LW(167,245)=1;LW(167,246)=1;LW(167,247)=1;LW(167,248)=1;
    LW(167,249)=1;LW(167,250)=1;LW(167,251)=1;LW(167,252)=1;LW(167,253)=1;LW(167,254)=1;LW(167,255)=1;LW(167,256)=1;LW(167,257)=1;LW(167,258)=1;
    LW(167,259)=1;LW(167,260)=1;LW(167,261)=1;LW(167,262)=1;LW(167,263)=1;LW(167,264)=1;LW(167,265)=1;LW(167,266)=1;LW(167,267)=1;LW(167,268)=1;
    LW(167,269)=1;LW(167,270)=1;LW(168,1)=1;LW(168,2)=1;LW(168,3)=1;LW(168,4)=1;LW(168,5)=1;LW(168,6)=1;LW(168,7)=1;LW(168,8)=1;
    LW(168,9)=1;LW(168,10)=1;LW(168,11)=1;LW(168,12)=1;LW(168,13)=1;LW(168,14)=1;LW(168,15)=1;LW(168,16)=1;LW(168,17)=1;LW(168,18)=1;
    LW(168,19)=1;LW(168,20)=1;LW(168,21)=1;LW(168,22)=1;LW(168,23)=1;LW(168,24)=1;LW(168,25)=1;LW(168,26)=1;LW(168,27)=1;LW(168,28)=1;
    LW(168,29)=1;LW(168,30)=1;LW(168,31)=1;LW(168,32)=1;LW(168,33)=1;LW(168,34)=1;LW(168,35)=1;LW(168,36)=1;LW(168,37)=1;LW(168,38)=1;
    LW(168,39)=1;LW(168,40)=1;LW(168,41)=1;LW(168,42)=1;LW(168,43)=1;LW(168,44)=1;LW(168,45)=1;LW(168,46)=1;LW(168,47)=1;LW(168,48)=1;
    LW(168,49)=1;LW(168,50)=1;LW(168,51)=1;LW(168,52)=1;LW(168,53)=1;LW(168,54)=1;LW(168,55)=1;LW(168,56)=1;LW(168,57)=1;LW(168,58)=1;
    LW(168,59)=1;LW(168,60)=1;LW(168,61)=1;LW(168,62)=1;LW(168,63)=1;LW(168,64)=1;LW(168,65)=1;LW(168,66)=1;LW(168,67)=1;LW(168,68)=1;
    LW(168,69)=1;LW(168,70)=1;LW(168,71)=1;LW(168,72)=1;LW(168,73)=1;LW(168,74)=1;LW(168,75)=1;LW(168,76)=1;LW(168,77)=1;LW(168,78)=1;
    LW(168,79)=1;LW(168,80)=1;LW(168,81)=1;LW(168,82)=1;LW(168,83)=1;LW(168,84)=1;LW(168,85)=1;LW(168,86)=1;LW(168,87)=1;LW(168,88)=1;
    LW(168,89)=1;LW(168,90)=1;LW(168,91)=1;LW(168,92)=1;LW(168,93)=1;LW(168,94)=1;LW(168,95)=1;LW(168,96)=1;LW(168,97)=1;LW(168,98)=1;
    LW(168,99)=1;LW(168,100)=1;LW(168,101)=1;LW(168,102)=1;LW(168,103)=1;LW(168,104)=1;LW(168,105)=1;LW(168,106)=1;LW(168,107)=1;LW(168,108)=1;
    LW(168,109)=1;LW(168,110)=1;LW(168,111)=1;LW(168,112)=1;LW(168,113)=1;LW(168,114)=1;LW(168,115)=1;LW(168,116)=1;LW(168,117)=1;LW(168,118)=1;
    LW(168,119)=1;LW(168,120)=1;LW(168,121)=1;LW(168,122)=1;LW(168,123)=1;LW(168,124)=1;LW(168,125)=1;LW(168,126)=1;LW(168,127)=1;LW(168,128)=1;
    LW(168,129)=1;LW(168,130)=1;LW(168,131)=1;LW(168,132)=1;LW(168,133)=1;LW(168,134)=1;LW(168,135)=1;LW(168,136)=1;LW(168,137)=1;LW(168,138)=1;
    LW(168,139)=1;LW(168,140)=1;LW(168,141)=1;LW(168,142)=1;LW(168,143)=1;LW(168,144)=1;LW(168,145)=1;LW(168,146)=1;LW(168,147)=1;LW(168,148)=1;
    LW(168,149)=1;LW(168,150)=1;LW(168,151)=1;LW(168,152)=1;LW(168,153)=1;LW(168,154)=1;LW(168,155)=1;LW(168,156)=1;LW(168,157)=1;LW(168,158)=1;
    LW(168,159)=1;LW(168,160)=1;LW(168,161)=1;LW(168,162)=1;LW(168,163)=1;LW(168,164)=1;LW(168,165)=1;LW(168,166)=1;LW(168,167)=1;LW(168,168)=1;
    LW(168,169)=1;LW(168,170)=1;LW(168,171)=1;LW(168,172)=1;LW(168,173)=1;LW(168,174)=1;LW(168,175)=1;LW(168,176)=1;LW(168,177)=1;LW(168,178)=1;
    LW(168,179)=1;LW(168,180)=1;LW(168,181)=1;LW(168,182)=1;LW(168,183)=1;LW(168,184)=1;LW(168,185)=1;LW(168,186)=1;LW(168,187)=1;LW(168,188)=1;
    LW(168,189)=1;LW(168,190)=1;LW(168,191)=1;LW(168,192)=1;LW(168,193)=1;LW(168,194)=1;LW(168,195)=1;LW(168,196)=1;LW(168,197)=1;LW(168,198)=1;
    LW(168,199)=1;LW(168,200)=1;LW(168,201)=1;LW(168,202)=1;LW(168,203)=1;LW(168,204)=1;LW(168,205)=1;LW(168,206)=1;LW(168,207)=1;LW(168,208)=1;
    LW(168,209)=1;LW(168,210)=1;LW(168,211)=1;LW(168,212)=1;LW(168,213)=1;LW(168,214)=1;LW(168,215)=1;LW(168,216)=1;LW(168,217)=1;LW(168,218)=1;
    LW(168,219)=1;LW(168,220)=1;LW(168,221)=1;LW(168,222)=1;LW(168,223)=1;LW(168,224)=1;LW(168,225)=1;LW(168,226)=1;LW(168,227)=1;LW(168,228)=1;
    LW(168,229)=1;LW(168,230)=1;LW(168,231)=1;LW(168,232)=1;LW(168,233)=1;LW(168,234)=1;LW(168,235)=1;LW(168,236)=1;LW(168,237)=1;LW(168,238)=1;
    LW(168,239)=1;LW(168,240)=1;LW(168,241)=1;LW(168,242)=1;LW(168,243)=1;LW(168,244)=1;LW(168,245)=1;LW(168,246)=1;LW(168,247)=1;LW(168,248)=1;
    LW(168,249)=1;LW(168,250)=1;LW(168,251)=1;LW(168,252)=1;LW(168,253)=1;LW(168,254)=1;LW(168,255)=1;LW(168,256)=1;LW(168,257)=1;LW(168,258)=1;
    LW(168,259)=1;LW(168,260)=1;LW(168,261)=1;LW(168,262)=1;LW(168,263)=1;LW(168,264)=1;LW(168,265)=1;LW(168,266)=1;LW(168,267)=1;LW(168,268)=1;
    LW(168,269)=1;LW(168,270)=1;LW(169,1)=1;LW(169,2)=1;LW(169,3)=1;LW(169,4)=1;LW(169,5)=1;LW(169,6)=1;LW(169,7)=1;LW(169,8)=1;
    LW(169,9)=1;LW(169,10)=1;LW(169,11)=1;LW(169,12)=1;LW(169,13)=1;LW(169,14)=1;LW(169,15)=1;LW(169,16)=1;LW(169,17)=1;LW(169,18)=1;
    LW(169,19)=1;LW(169,20)=1;LW(169,21)=1;LW(169,22)=1;LW(169,23)=1;LW(169,24)=1;LW(169,25)=1;LW(169,26)=1;LW(169,27)=1;LW(169,28)=1;
    LW(169,29)=1;LW(169,30)=1;LW(169,31)=1;LW(169,32)=1;LW(169,33)=1;LW(169,34)=1;LW(169,35)=1;LW(169,36)=1;LW(169,37)=1;LW(169,38)=1;
    LW(169,39)=1;LW(169,40)=1;LW(169,41)=1;LW(169,42)=1;LW(169,43)=1;LW(169,44)=1;LW(169,45)=1;LW(169,46)=1;LW(169,47)=1;LW(169,48)=1;
    LW(169,49)=1;LW(169,50)=1;LW(169,51)=1;LW(169,52)=1;LW(169,53)=1;LW(169,54)=1;LW(169,55)=1;LW(169,56)=1;LW(169,57)=1;LW(169,58)=1;
    LW(169,59)=1;LW(169,60)=1;LW(169,61)=1;LW(169,62)=1;LW(169,63)=1;LW(169,64)=1;LW(169,65)=1;LW(169,66)=1;LW(169,67)=1;LW(169,68)=1;
    LW(169,69)=1;LW(169,70)=1;LW(169,71)=1;LW(169,72)=1;LW(169,73)=1;LW(169,74)=1;LW(169,75)=1;LW(169,76)=1;LW(169,77)=1;LW(169,78)=1;
    LW(169,79)=1;LW(169,80)=1;LW(169,81)=1;LW(169,82)=1;LW(169,83)=1;LW(169,84)=1;LW(169,85)=1;LW(169,86)=1;LW(169,87)=1;LW(169,88)=1;
    LW(169,89)=1;LW(169,90)=1;LW(169,91)=1;LW(169,92)=1;LW(169,93)=1;LW(169,94)=1;LW(169,95)=1;LW(169,96)=1;LW(169,97)=1;LW(169,98)=1;
    LW(169,99)=1;LW(169,100)=1;LW(169,101)=1;LW(169,102)=1;LW(169,103)=1;LW(169,104)=1;LW(169,105)=1;LW(169,106)=1;LW(169,107)=1;LW(169,108)=1;
    LW(169,109)=1;LW(169,110)=1;LW(169,111)=1;LW(169,112)=1;LW(169,113)=1;LW(169,114)=1;LW(169,115)=1;LW(169,116)=1;LW(169,117)=1;LW(169,118)=1;
    LW(169,119)=1;LW(169,120)=1;LW(169,121)=1;LW(169,122)=1;LW(169,123)=1;LW(169,124)=1;LW(169,125)=1;LW(169,126)=1;LW(169,127)=1;LW(169,128)=1;
    LW(169,129)=1;LW(169,130)=1;LW(169,131)=1;LW(169,132)=1;LW(169,133)=1;LW(169,134)=1;LW(169,135)=1;LW(169,136)=1;LW(169,137)=1;LW(169,138)=1;
    LW(169,139)=1;LW(169,140)=1;LW(169,141)=1;LW(169,142)=1;LW(169,143)=1;LW(169,144)=1;LW(169,145)=1;LW(169,146)=1;LW(169,147)=1;LW(169,148)=1;
    LW(169,149)=1;LW(169,150)=1;LW(169,151)=1;LW(169,152)=1;LW(169,153)=1;LW(169,154)=1;LW(169,155)=1;LW(169,156)=1;LW(169,157)=1;LW(169,158)=1;
    LW(169,159)=1;LW(169,160)=1;LW(169,161)=1;LW(169,162)=1;LW(169,163)=1;LW(169,164)=1;LW(169,165)=1;LW(169,166)=1;LW(169,167)=1;LW(169,168)=1;
    LW(169,169)=1;LW(169,170)=1;LW(169,171)=1;LW(169,172)=1;LW(169,173)=1;LW(169,174)=1;LW(169,175)=1;LW(169,176)=1;LW(169,177)=1;LW(169,178)=1;
    LW(169,179)=1;LW(169,180)=1;LW(169,181)=1;LW(169,182)=1;LW(169,183)=1;LW(169,184)=1;LW(169,185)=1;LW(169,186)=1;LW(169,187)=1;LW(169,188)=1;
    LW(169,189)=1;LW(169,190)=1;LW(169,191)=1;LW(169,192)=1;LW(169,193)=1;LW(169,194)=1;LW(169,195)=1;LW(169,196)=1;LW(169,197)=1;LW(169,198)=1;
    LW(169,199)=1;LW(169,200)=1;LW(169,201)=1;LW(169,202)=1;LW(169,203)=1;LW(169,204)=1;LW(169,205)=1;LW(169,206)=1;LW(169,207)=1;LW(169,208)=1;
    LW(169,209)=1;LW(169,210)=1;LW(169,211)=1;LW(169,212)=1;LW(169,213)=1;LW(169,214)=1;LW(169,215)=1;LW(169,216)=1;LW(169,217)=1;LW(169,218)=1;
    LW(169,219)=1;LW(169,220)=1;LW(169,221)=1;LW(169,222)=1;LW(169,223)=1;LW(169,224)=1;LW(169,225)=1;LW(169,226)=1;LW(169,227)=1;LW(169,228)=1;
    LW(169,229)=1;LW(169,230)=1;LW(169,231)=1;LW(169,232)=1;LW(169,233)=1;LW(169,234)=1;LW(169,235)=1;LW(169,236)=1;LW(169,237)=1;LW(169,238)=1;
    LW(169,239)=1;LW(169,240)=1;LW(169,241)=1;LW(169,242)=1;LW(169,243)=1;LW(169,244)=1;LW(169,245)=1;LW(169,246)=1;LW(169,247)=1;LW(169,248)=1;
    LW(169,249)=1;LW(169,250)=1;LW(169,251)=1;LW(169,252)=1;LW(169,253)=1;LW(169,254)=1;LW(169,255)=1;LW(169,256)=1;LW(169,257)=1;LW(169,258)=1;
    LW(169,259)=1;LW(169,260)=1;LW(169,261)=1;LW(169,262)=1;LW(169,263)=1;LW(169,264)=1;LW(169,265)=1;LW(169,266)=1;LW(169,267)=1;LW(169,268)=1;
    LW(169,269)=1;LW(169,270)=1;LW(170,1)=1;LW(170,2)=1;LW(170,3)=1;LW(170,4)=1;LW(170,5)=1;LW(170,6)=1;LW(170,7)=1;LW(170,8)=1;
    LW(170,9)=1;LW(170,10)=1;LW(170,11)=1;LW(170,12)=1;LW(170,13)=1;LW(170,14)=1;LW(170,15)=1;LW(170,16)=1;LW(170,17)=1;LW(170,18)=1;
    LW(170,19)=1;LW(170,20)=1;LW(170,21)=1;LW(170,22)=1;LW(170,23)=1;LW(170,24)=1;LW(170,25)=1;LW(170,26)=1;LW(170,27)=1;LW(170,28)=1;
    LW(170,29)=1;LW(170,30)=1;LW(170,31)=1;LW(170,32)=1;LW(170,33)=1;LW(170,34)=1;LW(170,35)=1;LW(170,36)=1;LW(170,37)=1;LW(170,38)=1;
    LW(170,39)=1;LW(170,40)=1;LW(170,41)=1;LW(170,42)=1;LW(170,43)=1;LW(170,44)=1;LW(170,45)=1;LW(170,46)=1;LW(170,47)=1;LW(170,48)=1;
    LW(170,49)=1;LW(170,50)=1;LW(170,51)=1;LW(170,52)=1;LW(170,53)=1;LW(170,54)=1;LW(170,55)=1;LW(170,56)=1;LW(170,57)=1;LW(170,58)=1;
    LW(170,59)=1;LW(170,60)=1;LW(170,61)=1;LW(170,62)=1;LW(170,63)=1;LW(170,64)=1;LW(170,65)=1;LW(170,66)=1;LW(170,67)=1;LW(170,68)=1;
    LW(170,69)=1;LW(170,70)=1;LW(170,71)=1;LW(170,72)=1;LW(170,73)=1;LW(170,74)=1;LW(170,75)=1;LW(170,76)=1;LW(170,77)=1;LW(170,78)=1;
    LW(170,79)=1;LW(170,80)=1;LW(170,81)=1;LW(170,82)=1;LW(170,83)=1;LW(170,84)=1;LW(170,85)=1;LW(170,86)=1;LW(170,87)=1;LW(170,88)=1;
    LW(170,89)=1;LW(170,90)=1;LW(170,91)=1;LW(170,92)=1;LW(170,93)=1;LW(170,94)=1;LW(170,95)=1;LW(170,96)=1;LW(170,97)=1;LW(170,98)=1;
    LW(170,99)=1;LW(170,100)=1;LW(170,101)=1;LW(170,102)=1;LW(170,103)=1;LW(170,104)=1;LW(170,105)=1;LW(170,106)=1;LW(170,107)=1;LW(170,108)=1;
    LW(170,109)=1;LW(170,110)=1;LW(170,111)=1;LW(170,112)=1;LW(170,113)=1;LW(170,114)=1;LW(170,115)=1;LW(170,116)=1;LW(170,117)=1;LW(170,118)=1;
    LW(170,119)=1;LW(170,120)=1;LW(170,121)=1;LW(170,122)=1;LW(170,123)=1;LW(170,124)=1;LW(170,125)=1;LW(170,126)=1;LW(170,127)=1;LW(170,128)=1;
    LW(170,129)=1;LW(170,130)=1;LW(170,131)=1;LW(170,132)=1;LW(170,133)=1;LW(170,134)=1;LW(170,135)=1;LW(170,136)=1;LW(170,137)=1;LW(170,138)=1;
    LW(170,139)=1;LW(170,140)=1;LW(170,141)=1;LW(170,142)=1;LW(170,143)=1;LW(170,144)=1;LW(170,145)=1;LW(170,146)=1;LW(170,147)=1;LW(170,148)=1;
    LW(170,149)=1;LW(170,150)=1;LW(170,154)=1;LW(170,155)=1;LW(170,159)=1;LW(170,160)=1;LW(170,161)=1;LW(170,162)=1;LW(170,163)=1;LW(170,164)=1;
    LW(170,165)=1;LW(170,166)=1;LW(170,167)=1;LW(170,168)=1;LW(170,169)=1;LW(170,170)=1;LW(170,171)=1;LW(170,172)=1;LW(170,173)=1;LW(170,174)=1;
    LW(170,175)=1;LW(170,176)=1;LW(170,177)=1;LW(170,178)=1;LW(170,179)=1;LW(170,180)=1;LW(170,181)=1;LW(170,182)=1;LW(170,183)=1;LW(170,184)=1;
    LW(170,185)=1;LW(170,186)=1;LW(170,187)=1;LW(170,188)=1;LW(170,189)=1;LW(170,190)=1;LW(170,191)=1;LW(170,192)=1;LW(170,193)=1;LW(170,194)=1;
    LW(170,195)=1;LW(170,196)=1;LW(170,197)=1;LW(170,198)=1;LW(170,199)=1;LW(170,200)=1;LW(170,201)=1;LW(170,202)=1;LW(170,203)=1;LW(170,204)=1;
    LW(170,205)=1;LW(170,206)=1;LW(170,207)=1;LW(170,208)=1;LW(170,209)=1;LW(170,210)=1;LW(170,211)=1;LW(170,212)=1;LW(170,213)=1;LW(170,214)=1;
    LW(170,215)=1;LW(170,216)=1;LW(170,217)=1;LW(170,218)=1;LW(170,219)=1;LW(170,220)=1;LW(170,221)=1;LW(170,222)=1;LW(170,223)=1;LW(170,224)=1;
    LW(170,225)=1;LW(170,226)=1;LW(170,227)=1;LW(170,228)=1;LW(170,229)=1;LW(170,230)=1;LW(170,231)=1;LW(170,232)=1;LW(170,233)=1;LW(170,234)=1;
    LW(170,235)=1;LW(170,236)=1;LW(170,237)=1;LW(170,238)=1;LW(170,239)=1;LW(170,240)=1;LW(170,241)=1;LW(170,242)=1;LW(170,243)=1;LW(170,244)=1;
    LW(170,245)=1;LW(170,246)=1;LW(170,247)=1;LW(170,248)=1;LW(170,249)=1;LW(170,250)=1;LW(170,251)=1;LW(170,252)=1;LW(170,253)=1;LW(170,254)=1;
    LW(170,255)=1;LW(170,256)=1;LW(170,257)=1;LW(170,258)=1;LW(170,259)=1;LW(170,260)=1;LW(170,261)=1;LW(170,262)=1;LW(170,263)=1;LW(170,264)=1;
    LW(170,265)=1;LW(170,266)=1;LW(170,267)=1;LW(170,268)=1;LW(170,269)=1;LW(170,270)=1;LW(171,1)=1;LW(171,2)=1;LW(171,3)=1;LW(171,4)=1;
    LW(171,5)=1;LW(171,6)=1;LW(171,7)=1;LW(171,8)=1;LW(171,9)=1;LW(171,10)=1;LW(171,11)=1;LW(171,12)=1;LW(171,13)=1;LW(171,14)=1;
    LW(171,15)=1;LW(171,16)=1;LW(171,17)=1;LW(171,18)=1;LW(171,19)=1;LW(171,20)=1;LW(171,21)=1;LW(171,22)=1;LW(171,23)=1;LW(171,24)=1;
    LW(171,25)=1;LW(171,26)=1;LW(171,27)=1;LW(171,28)=1;LW(171,29)=1;LW(171,30)=1;LW(171,31)=1;LW(171,32)=1;LW(171,33)=1;LW(171,34)=1;
    LW(171,35)=1;LW(171,36)=1;LW(171,37)=1;LW(171,38)=1;LW(171,39)=1;LW(171,40)=1;LW(171,41)=1;LW(171,42)=1;LW(171,43)=1;LW(171,44)=1;
    LW(171,45)=1;LW(171,46)=1;LW(171,47)=1;LW(171,48)=1;LW(171,49)=1;LW(171,50)=1;LW(171,51)=1;LW(171,52)=1;LW(171,53)=1;LW(171,54)=1;
    LW(171,55)=1;LW(171,56)=1;LW(171,57)=1;LW(171,58)=1;LW(171,59)=1;LW(171,60)=1;LW(171,61)=1;LW(171,62)=1;LW(171,63)=1;LW(171,64)=1;
    LW(171,65)=1;LW(171,66)=1;LW(171,67)=1;LW(171,68)=1;LW(171,69)=1;LW(171,70)=1;LW(171,71)=1;LW(171,72)=1;LW(171,73)=1;LW(171,74)=1;
    LW(171,75)=1;LW(171,76)=1;LW(171,77)=1;LW(171,78)=1;LW(171,79)=1;LW(171,80)=1;LW(171,81)=1;LW(171,82)=1;LW(171,83)=1;LW(171,84)=1;
    LW(171,85)=1;LW(171,86)=1;LW(171,87)=1;LW(171,88)=1;LW(171,89)=1;LW(171,90)=1;LW(171,91)=1;LW(171,92)=1;LW(171,93)=1;LW(171,94)=1;
    LW(171,95)=1;LW(171,96)=1;LW(171,97)=1;LW(171,98)=1;LW(171,99)=1;LW(171,100)=1;LW(171,101)=1;LW(171,102)=1;LW(171,103)=1;LW(171,104)=1;
    LW(171,105)=1;LW(171,106)=1;LW(171,107)=1;LW(171,108)=1;LW(171,109)=1;LW(171,110)=1;LW(171,111)=1;LW(171,112)=1;LW(171,113)=1;LW(171,114)=1;
    LW(171,115)=1;LW(171,116)=1;LW(171,117)=1;LW(171,118)=1;LW(171,119)=1;LW(171,120)=1;LW(171,121)=1;LW(171,122)=1;LW(171,123)=1;LW(171,124)=1;
    LW(171,125)=1;LW(171,126)=1;LW(171,127)=1;LW(171,128)=1;LW(171,129)=1;LW(171,130)=1;LW(171,131)=1;LW(171,132)=1;LW(171,133)=1;LW(171,134)=1;
    LW(171,135)=1;LW(171,136)=1;LW(171,137)=1;LW(171,138)=1;LW(171,139)=1;LW(171,140)=1;LW(171,141)=1;LW(171,142)=1;LW(171,143)=1;LW(171,144)=1;
    LW(171,145)=1;LW(171,146)=1;LW(171,147)=1;LW(171,148)=1;LW(171,149)=1;LW(171,159)=1;LW(171,160)=1;LW(171,161)=1;LW(171,162)=1;LW(171,163)=1;
    LW(171,164)=1;LW(171,165)=1;LW(171,166)=1;LW(171,167)=1;LW(171,168)=1;LW(171,169)=1;LW(171,170)=1;LW(171,171)=1;LW(171,172)=1;LW(171,173)=1;
    LW(171,174)=1;LW(171,175)=1;LW(171,176)=1;LW(171,177)=1;LW(171,178)=1;LW(171,179)=1;LW(171,180)=1;LW(171,181)=1;LW(171,182)=1;LW(171,183)=1;
    LW(171,184)=1;LW(171,185)=1;LW(171,186)=1;LW(171,187)=1;LW(171,188)=1;LW(171,189)=1;LW(171,190)=1;LW(171,191)=1;LW(171,192)=1;LW(171,193)=1;
    LW(171,194)=1;LW(171,195)=1;LW(171,196)=1;LW(171,197)=1;LW(171,198)=1;LW(171,199)=1;LW(171,200)=1;LW(171,201)=1;LW(171,202)=1;LW(171,203)=1;
    LW(171,204)=1;LW(171,205)=1;LW(171,206)=1;LW(171,207)=1;LW(171,208)=1;LW(171,209)=1;LW(171,210)=1;LW(171,211)=1;LW(171,212)=1;LW(171,213)=1;
    LW(171,214)=1;LW(171,215)=1;LW(171,216)=1;LW(171,217)=1;LW(171,218)=1;LW(171,219)=1;LW(171,220)=1;LW(171,221)=1;LW(171,222)=1;LW(171,223)=1;
    LW(171,224)=1;LW(171,225)=1;LW(171,226)=1;LW(171,227)=1;LW(171,228)=1;LW(171,229)=1;LW(171,230)=1;LW(171,231)=1;LW(171,232)=1;LW(171,233)=1;
    LW(171,234)=1;LW(171,235)=1;LW(171,236)=1;LW(171,237)=1;LW(171,238)=1;LW(171,239)=1;LW(171,240)=1;LW(171,241)=1;LW(171,242)=1;LW(171,243)=1;
    LW(171,244)=1;LW(171,245)=1;LW(171,246)=1;LW(171,247)=1;LW(171,248)=1;LW(171,249)=1;LW(171,250)=1;LW(171,251)=1;LW(171,252)=1;LW(171,253)=1;
    LW(171,254)=1;LW(171,255)=1;LW(171,256)=1;LW(171,257)=1;LW(171,258)=1;LW(171,259)=1;LW(171,260)=1;LW(171,261)=1;LW(171,262)=1;LW(171,263)=1;
    LW(171,264)=1;LW(171,265)=1;LW(171,266)=1;LW(171,267)=1;LW(171,268)=1;LW(171,269)=1;LW(171,270)=1;LW(172,1)=1;LW(172,2)=1;LW(172,3)=1;
    LW(172,4)=1;LW(172,5)=1;LW(172,6)=1;LW(172,7)=1;LW(172,8)=1;LW(172,9)=1;LW(172,10)=1;LW(172,11)=1;LW(172,12)=1;LW(172,13)=1;
    LW(172,14)=1;LW(172,15)=1;LW(172,16)=1;LW(172,17)=1;LW(172,18)=1;LW(172,19)=1;LW(172,20)=1;LW(172,21)=1;LW(172,22)=1;LW(172,23)=1;
    LW(172,24)=1;LW(172,25)=1;LW(172,26)=1;LW(172,27)=1;LW(172,28)=1;LW(172,29)=1;LW(172,30)=1;LW(172,31)=1;LW(172,32)=1;LW(172,33)=1;
    LW(172,34)=1;LW(172,35)=1;LW(172,36)=1;LW(172,37)=1;LW(172,38)=1;LW(172,39)=1;LW(172,40)=1;LW(172,41)=1;LW(172,42)=1;LW(172,43)=1;
    LW(172,44)=1;LW(172,45)=1;LW(172,46)=1;LW(172,47)=1;LW(172,48)=1;LW(172,49)=1;LW(172,50)=1;LW(172,51)=1;LW(172,52)=1;LW(172,53)=1;
    LW(172,54)=1;LW(172,55)=1;LW(172,56)=1;LW(172,57)=1;LW(172,58)=1;LW(172,59)=1;LW(172,60)=1;LW(172,61)=1;LW(172,62)=1;LW(172,63)=1;
    LW(172,64)=1;LW(172,65)=1;LW(172,66)=1;LW(172,67)=1;LW(172,68)=1;LW(172,69)=1;LW(172,70)=1;LW(172,71)=1;LW(172,72)=1;LW(172,73)=1;
    LW(172,74)=1;LW(172,75)=1;LW(172,76)=1;LW(172,77)=1;LW(172,78)=1;LW(172,79)=1;LW(172,80)=1;LW(172,81)=1;LW(172,82)=1;LW(172,83)=1;
    LW(172,84)=1;LW(172,85)=1;LW(172,86)=1;LW(172,87)=1;LW(172,88)=1;LW(172,89)=1;LW(172,90)=1;LW(172,91)=1;LW(172,92)=1;LW(172,93)=1;
    LW(172,94)=1;LW(172,95)=1;LW(172,96)=1;LW(172,97)=1;LW(172,98)=1;LW(172,99)=1;LW(172,100)=1;LW(172,101)=1;LW(172,102)=1;LW(172,103)=1;
    LW(172,104)=1;LW(172,105)=1;LW(172,106)=1;LW(172,107)=1;LW(172,108)=1;LW(172,109)=1;LW(172,110)=1;LW(172,111)=1;LW(172,112)=1;LW(172,113)=1;
    LW(172,114)=1;LW(172,115)=1;LW(172,116)=1;LW(172,117)=1;LW(172,118)=1;LW(172,119)=1;LW(172,120)=1;LW(172,121)=1;LW(172,122)=1;LW(172,123)=1;
    LW(172,124)=1;LW(172,125)=1;LW(172,126)=1;LW(172,127)=1;LW(172,128)=1;LW(172,129)=1;LW(172,130)=1;LW(172,131)=1;LW(172,132)=1;LW(172,133)=1;
    LW(172,134)=1;LW(172,135)=1;LW(172,136)=1;LW(172,137)=1;LW(172,138)=1;LW(172,140)=1;LW(172,141)=1;LW(172,142)=1;LW(172,143)=1;LW(172,144)=1;
    LW(172,145)=1;LW(172,146)=1;LW(172,147)=1;LW(172,148)=1;LW(172,149)=1;LW(172,160)=1;LW(172,161)=1;LW(172,162)=1;LW(172,163)=1;LW(172,164)=1;
    LW(172,165)=1;LW(172,166)=1;LW(172,167)=1;LW(172,168)=1;LW(172,169)=1;LW(172,170)=1;LW(172,171)=1;LW(172,172)=1;LW(172,173)=1;LW(172,174)=1;
    LW(172,175)=1;LW(172,176)=1;LW(172,177)=1;LW(172,178)=1;LW(172,179)=1;LW(172,180)=1;LW(172,181)=1;LW(172,182)=1;LW(172,183)=1;LW(172,184)=1;
    LW(172,185)=1;LW(172,186)=1;LW(172,187)=1;LW(172,188)=1;LW(172,189)=1;LW(172,190)=1;LW(172,191)=1;LW(172,192)=1;LW(172,193)=1;LW(172,194)=1;
    LW(172,195)=1;LW(172,196)=1;LW(172,197)=1;LW(172,198)=1;LW(172,199)=1;LW(172,200)=1;LW(172,201)=1;LW(172,202)=1;LW(172,203)=1;LW(172,204)=1;
    LW(172,205)=1;LW(172,206)=1;LW(172,207)=1;LW(172,208)=1;LW(172,209)=1;LW(172,210)=1;LW(172,211)=1;LW(172,212)=1;LW(172,213)=1;LW(172,214)=1;
    LW(172,215)=1;LW(172,216)=1;LW(172,217)=1;LW(172,218)=1;LW(172,219)=1;LW(172,220)=1;LW(172,221)=1;LW(172,222)=1;LW(172,223)=1;LW(172,224)=1;
    LW(172,225)=1;LW(172,226)=1;LW(172,227)=1;LW(172,228)=1;LW(172,229)=1;LW(172,230)=1;LW(172,231)=1;LW(172,232)=1;LW(172,233)=1;LW(172,234)=1;
    LW(172,235)=1;LW(172,236)=1;LW(172,237)=1;LW(172,238)=1;LW(172,239)=1;LW(172,240)=1;LW(172,241)=1;LW(172,242)=1;LW(172,243)=1;LW(172,244)=1;
    LW(172,245)=1;LW(172,246)=1;LW(172,247)=1;LW(172,248)=1;LW(172,249)=1;LW(172,250)=1;LW(172,251)=1;LW(172,252)=1;LW(172,253)=1;LW(172,254)=1;
    LW(172,255)=1;LW(172,256)=1;LW(172,257)=1;LW(172,258)=1;LW(172,259)=1;LW(172,260)=1;LW(172,261)=1;LW(172,262)=1;LW(172,263)=1;LW(172,264)=1;
    LW(172,265)=1;LW(172,266)=1;LW(172,267)=1;LW(172,268)=1;LW(172,269)=1;LW(172,270)=1;LW(173,1)=1;LW(173,2)=1;LW(173,3)=1;LW(173,4)=1;
    LW(173,5)=1;LW(173,6)=1;LW(173,7)=1;LW(173,8)=1;LW(173,9)=1;LW(173,10)=1;LW(173,11)=1;LW(173,12)=1;LW(173,13)=1;LW(173,14)=1;
    LW(173,15)=1;LW(173,16)=1;LW(173,17)=1;LW(173,18)=1;LW(173,19)=1;LW(173,20)=1;LW(173,21)=1;LW(173,22)=1;LW(173,23)=1;LW(173,24)=1;
    LW(173,25)=1;LW(173,26)=1;LW(173,27)=1;LW(173,28)=1;LW(173,29)=1;LW(173,30)=1;LW(173,31)=1;LW(173,32)=1;LW(173,33)=1;LW(173,34)=1;
    LW(173,35)=1;LW(173,36)=1;LW(173,37)=1;LW(173,38)=1;LW(173,39)=1;LW(173,40)=1;LW(173,41)=1;LW(173,42)=1;LW(173,43)=1;LW(173,44)=1;
    LW(173,45)=1;LW(173,46)=1;LW(173,47)=1;LW(173,48)=1;LW(173,49)=1;LW(173,50)=1;LW(173,51)=1;LW(173,52)=1;LW(173,53)=1;LW(173,54)=1;
    LW(173,55)=1;LW(173,56)=1;LW(173,57)=1;LW(173,58)=1;LW(173,59)=1;LW(173,60)=1;LW(173,61)=1;LW(173,62)=1;LW(173,63)=1;LW(173,64)=1;
    LW(173,65)=1;LW(173,66)=1;LW(173,67)=1;LW(173,68)=1;LW(173,69)=1;LW(173,70)=1;LW(173,71)=1;LW(173,72)=1;LW(173,73)=1;LW(173,74)=1;
    LW(173,75)=1;LW(173,76)=1;LW(173,77)=1;LW(173,78)=1;LW(173,79)=1;LW(173,80)=1;LW(173,81)=1;LW(173,82)=1;LW(173,83)=1;LW(173,84)=1;
    LW(173,85)=1;LW(173,86)=1;LW(173,87)=1;LW(173,88)=1;LW(173,89)=1;LW(173,90)=1;LW(173,91)=1;LW(173,92)=1;LW(173,93)=1;LW(173,94)=1;
    LW(173,95)=1;LW(173,96)=1;LW(173,97)=1;LW(173,98)=1;LW(173,99)=1;LW(173,100)=1;LW(173,101)=1;LW(173,102)=1;LW(173,103)=1;LW(173,104)=1;
    LW(173,105)=1;LW(173,106)=1;LW(173,107)=1;LW(173,108)=1;LW(173,109)=1;LW(173,110)=1;LW(173,111)=1;LW(173,112)=1;LW(173,113)=1;LW(173,114)=1;
    LW(173,115)=1;LW(173,116)=1;LW(173,117)=1;LW(173,118)=1;LW(173,119)=1;LW(173,120)=1;LW(173,121)=1;LW(173,122)=1;LW(173,123)=1;LW(173,124)=1;
    LW(173,125)=1;LW(173,126)=1;LW(173,127)=1;LW(173,128)=1;LW(173,129)=1;LW(173,130)=1;LW(173,131)=1;LW(173,132)=1;LW(173,133)=1;LW(173,134)=1;
    LW(173,135)=1;LW(173,136)=1;LW(173,137)=1;LW(173,138)=1;LW(173,139)=1;LW(173,140)=1;LW(173,141)=1;LW(173,142)=1;LW(173,143)=1;LW(173,144)=1;
    LW(173,145)=1;LW(173,146)=1;LW(173,147)=1;LW(173,148)=1;LW(173,153)=1;LW(173,154)=1;LW(173,161)=1;LW(173,162)=1;LW(173,163)=1;LW(173,164)=1;
    LW(173,165)=1;LW(173,166)=1;LW(173,167)=1;LW(173,168)=1;LW(173,169)=1;LW(173,170)=1;LW(173,171)=1;LW(173,172)=1;LW(173,173)=1;LW(173,174)=1;
    LW(173,175)=1;LW(173,176)=1;LW(173,177)=1;LW(173,178)=1;LW(173,179)=1;LW(173,180)=1;LW(173,181)=1;LW(173,182)=1;LW(173,183)=1;LW(173,184)=1;
    LW(173,185)=1;LW(173,186)=1;LW(173,187)=1;LW(173,188)=1;LW(173,189)=1;LW(173,190)=1;LW(173,191)=1;LW(173,192)=1;LW(173,193)=1;LW(173,194)=1;
    LW(173,195)=1;LW(173,196)=1;LW(173,197)=1;LW(173,198)=1;LW(173,199)=1;LW(173,200)=1;LW(173,201)=1;LW(173,202)=1;LW(173,203)=1;LW(173,204)=1;
    LW(173,205)=1;LW(173,206)=1;LW(173,207)=1;LW(173,208)=1;LW(173,209)=1;LW(173,210)=1;LW(173,211)=1;LW(173,212)=1;LW(173,213)=1;LW(173,214)=1;
    LW(173,215)=1;LW(173,216)=1;LW(173,217)=1;LW(173,218)=1;LW(173,219)=1;LW(173,220)=1;LW(173,221)=1;LW(173,222)=1;LW(173,223)=1;LW(173,224)=1;
    LW(173,225)=1;LW(173,226)=1;LW(173,227)=1;LW(173,228)=1;LW(173,229)=1;LW(173,230)=1;LW(173,231)=1;LW(173,232)=1;LW(173,233)=1;LW(173,234)=1;
    LW(173,235)=1;LW(173,236)=1;LW(173,237)=1;LW(173,238)=1;LW(173,239)=1;LW(173,240)=1;LW(173,241)=1;LW(173,242)=1;LW(173,243)=1;LW(173,244)=1;
    LW(173,245)=1;LW(173,246)=1;LW(173,247)=1;LW(173,248)=1;LW(173,249)=1;LW(173,250)=1;LW(173,251)=1;LW(173,252)=1;LW(173,253)=1;LW(173,254)=1;
    LW(173,255)=1;LW(173,256)=1;LW(173,257)=1;LW(173,258)=1;LW(173,259)=1;LW(173,260)=1;LW(173,261)=1;LW(173,262)=1;LW(173,263)=1;LW(173,264)=1;
    LW(173,265)=1;LW(173,266)=1;LW(173,267)=1;LW(173,268)=1;LW(173,269)=1;LW(173,270)=1;LW(174,1)=1;LW(174,2)=1;LW(174,3)=1;LW(174,4)=1;
    LW(174,5)=1;LW(174,6)=1;LW(174,7)=1;LW(174,8)=1;LW(174,9)=1;LW(174,10)=1;LW(174,11)=1;LW(174,12)=1;LW(174,13)=1;LW(174,14)=1;
    LW(174,15)=1;LW(174,16)=1;LW(174,17)=1;LW(174,18)=1;LW(174,19)=1;LW(174,20)=1;LW(174,21)=1;LW(174,22)=1;LW(174,23)=1;LW(174,24)=1;
    LW(174,25)=1;LW(174,26)=1;LW(174,27)=1;LW(174,28)=1;LW(174,29)=1;LW(174,30)=1;LW(174,31)=1;LW(174,32)=1;LW(174,33)=1;LW(174,34)=1;
    LW(174,35)=1;LW(174,36)=1;LW(174,37)=1;LW(174,38)=1;LW(174,39)=1;LW(174,40)=1;LW(174,41)=1;LW(174,42)=1;LW(174,43)=1;LW(174,44)=1;
    LW(174,45)=1;LW(174,46)=1;LW(174,47)=1;LW(174,48)=1;LW(174,49)=1;LW(174,50)=1;LW(174,51)=1;LW(174,52)=1;LW(174,53)=1;LW(174,54)=1;
    LW(174,55)=1;LW(174,56)=1;LW(174,57)=1;LW(174,58)=1;LW(174,59)=1;LW(174,60)=1;LW(174,61)=1;LW(174,62)=1;LW(174,63)=1;LW(174,64)=1;
    LW(174,65)=1;LW(174,66)=1;LW(174,67)=1;LW(174,68)=1;LW(174,69)=1;LW(174,70)=1;LW(174,71)=1;LW(174,72)=1;LW(174,73)=1;LW(174,74)=1;
    LW(174,75)=1;LW(174,76)=1;LW(174,77)=1;LW(174,78)=1;LW(174,79)=1;LW(174,80)=1;LW(174,81)=1;LW(174,82)=1;LW(174,83)=1;LW(174,84)=1;
    LW(174,85)=1;LW(174,86)=1;LW(174,87)=1;LW(174,88)=1;LW(174,89)=1;LW(174,90)=1;LW(174,91)=1;LW(174,92)=1;LW(174,93)=1;LW(174,94)=1;
    LW(174,100)=1;LW(174,101)=1;LW(174,102)=1;LW(174,105)=1;LW(174,106)=1;LW(174,107)=1;LW(174,108)=1;LW(174,109)=1;LW(174,110)=1;LW(174,111)=1;
    LW(174,112)=1;LW(174,113)=1;LW(174,114)=1;LW(174,115)=1;LW(174,116)=1;LW(174,117)=1;LW(174,118)=1;LW(174,119)=1;LW(174,120)=1;LW(174,121)=1;
    LW(174,122)=1;LW(174,123)=1;LW(174,124)=1;LW(174,125)=1;LW(174,126)=1;LW(174,127)=1;LW(174,128)=1;LW(174,129)=1;LW(174,130)=1;LW(174,131)=1;
    LW(174,132)=1;LW(174,133)=1;LW(174,134)=1;LW(174,135)=1;LW(174,136)=1;LW(174,137)=1;LW(174,138)=1;LW(174,139)=1;LW(174,140)=1;LW(174,141)=1;
    LW(174,142)=1;LW(174,143)=1;LW(174,144)=1;LW(174,145)=1;LW(174,146)=1;LW(174,147)=1;LW(174,148)=1;LW(174,152)=1;LW(174,153)=1;LW(174,154)=1;
    LW(174,155)=1;LW(174,162)=1;LW(174,163)=1;LW(174,164)=1;LW(174,165)=1;LW(174,166)=1;LW(174,167)=1;LW(174,168)=1;LW(174,169)=1;LW(174,170)=1;
    LW(174,171)=1;LW(174,172)=1;LW(174,173)=1;LW(174,174)=1;LW(174,175)=1;LW(174,176)=1;LW(174,177)=1;LW(174,178)=1;LW(174,179)=1;LW(174,180)=1;
    LW(174,181)=1;LW(174,182)=1;LW(174,183)=1;LW(174,184)=1;LW(174,185)=1;LW(174,186)=1;LW(174,187)=1;LW(174,188)=1;LW(174,189)=1;LW(174,190)=1;
    LW(174,191)=1;LW(174,192)=1;LW(174,193)=1;LW(174,194)=1;LW(174,195)=1;LW(174,196)=1;LW(174,197)=1;LW(174,198)=1;LW(174,199)=1;LW(174,200)=1;
    LW(174,201)=1;LW(174,202)=1;LW(174,203)=1;LW(174,204)=1;LW(174,205)=1;LW(174,206)=1;LW(174,207)=1;LW(174,208)=1;LW(174,209)=1;LW(174,210)=1;
    LW(174,211)=1;LW(174,212)=1;LW(174,213)=1;LW(174,214)=1;LW(174,215)=1;LW(174,216)=1;LW(174,217)=1;LW(174,218)=1;LW(174,219)=1;LW(174,220)=1;
    LW(174,221)=1;LW(174,222)=1;LW(174,223)=1;LW(174,224)=1;LW(174,225)=1;LW(174,226)=1;LW(174,227)=1;LW(174,228)=1;LW(174,229)=1;LW(174,230)=1;
    LW(174,231)=1;LW(174,232)=1;LW(174,233)=1;LW(174,234)=1;LW(174,235)=1;LW(174,236)=1;LW(174,237)=1;LW(174,238)=1;LW(174,239)=1;LW(174,240)=1;
    LW(174,241)=1;LW(174,242)=1;LW(174,243)=1;LW(174,244)=1;LW(174,245)=1;LW(174,246)=1;LW(174,247)=1;LW(174,248)=1;LW(174,249)=1;LW(174,250)=1;
    LW(174,251)=1;LW(174,252)=1;LW(174,253)=1;LW(174,254)=1;LW(174,255)=1;LW(174,256)=1;LW(174,257)=1;LW(174,258)=1;LW(174,259)=1;LW(174,260)=1;
    LW(174,261)=1;LW(174,262)=1;LW(174,263)=1;LW(174,264)=1;LW(174,265)=1;LW(174,266)=1;LW(174,267)=1;LW(174,268)=1;LW(174,269)=1;LW(174,270)=1;
    LW(175,1)=1;LW(175,2)=1;LW(175,3)=1;LW(175,4)=1;LW(175,5)=1;LW(175,6)=1;LW(175,7)=1;LW(175,8)=1;LW(175,9)=1;LW(175,10)=1;
    LW(175,11)=1;LW(175,12)=1;LW(175,13)=1;LW(175,14)=1;LW(175,15)=1;LW(175,16)=1;LW(175,17)=1;LW(175,18)=1;LW(175,19)=1;LW(175,20)=1;
    LW(175,21)=1;LW(175,22)=1;LW(175,23)=1;LW(175,24)=1;LW(175,25)=1;LW(175,26)=1;LW(175,27)=1;LW(175,28)=1;LW(175,29)=1;LW(175,30)=1;
    LW(175,31)=1;LW(175,32)=1;LW(175,33)=1;LW(175,34)=1;LW(175,35)=1;LW(175,36)=1;LW(175,37)=1;LW(175,38)=1;LW(175,39)=1;LW(175,40)=1;
    LW(175,41)=1;LW(175,42)=1;LW(175,43)=1;LW(175,44)=1;LW(175,45)=1;LW(175,46)=1;LW(175,47)=1;LW(175,48)=1;LW(175,49)=1;LW(175,50)=1;
    LW(175,51)=1;LW(175,52)=1;LW(175,53)=1;LW(175,54)=1;LW(175,55)=1;LW(175,56)=1;LW(175,57)=1;LW(175,58)=1;LW(175,59)=1;LW(175,60)=1;
    LW(175,61)=1;LW(175,62)=1;LW(175,63)=1;LW(175,64)=1;LW(175,65)=1;LW(175,66)=1;LW(175,67)=1;LW(175,68)=1;LW(175,69)=1;LW(175,70)=1;
    LW(175,71)=1;LW(175,72)=1;LW(175,73)=1;LW(175,74)=1;LW(175,75)=1;LW(175,76)=1;LW(175,77)=1;LW(175,78)=1;LW(175,79)=1;LW(175,80)=1;
    LW(175,81)=1;LW(175,82)=1;LW(175,83)=1;LW(175,84)=1;LW(175,85)=1;LW(175,86)=1;LW(175,87)=1;LW(175,88)=1;LW(175,89)=1;LW(175,90)=1;
    LW(175,91)=1;LW(175,92)=1;LW(175,106)=1;LW(175,107)=1;LW(175,108)=1;LW(175,109)=1;LW(175,110)=1;LW(175,114)=1;LW(175,115)=1;LW(175,116)=1;
    LW(175,117)=1;LW(175,118)=1;LW(175,119)=1;LW(175,120)=1;LW(175,121)=1;LW(175,122)=1;LW(175,123)=1;LW(175,124)=1;LW(175,125)=1;LW(175,126)=1;
    LW(175,127)=1;LW(175,128)=1;LW(175,129)=1;LW(175,134)=1;LW(175,135)=1;LW(175,136)=1;LW(175,137)=1;LW(175,138)=1;LW(175,139)=1;LW(175,140)=1;
    LW(175,141)=1;LW(175,142)=1;LW(175,143)=1;LW(175,144)=1;LW(175,145)=1;LW(175,146)=1;LW(175,147)=1;LW(175,148)=1;LW(175,152)=1;LW(175,153)=1;
    LW(175,154)=1;LW(175,155)=1;LW(175,156)=1;LW(175,157)=1;LW(175,163)=1;LW(175,164)=1;LW(175,165)=1;LW(175,166)=1;LW(175,167)=1;LW(175,168)=1;
    LW(175,169)=1;LW(175,170)=1;LW(175,171)=1;LW(175,172)=1;LW(175,173)=1;LW(175,174)=1;LW(175,175)=1;LW(175,176)=1;LW(175,177)=1;LW(175,178)=1;
    LW(175,179)=1;LW(175,180)=1;LW(175,181)=1;LW(175,182)=1;LW(175,183)=1;LW(175,184)=1;LW(175,187)=1;LW(175,188)=1;LW(175,189)=1;LW(175,190)=1;
    LW(175,191)=1;LW(175,192)=1;LW(175,193)=1;LW(175,194)=1;LW(175,195)=1;LW(175,196)=1;LW(175,197)=1;LW(175,198)=1;LW(175,199)=1;LW(175,200)=1;
    LW(175,201)=1;LW(175,202)=1;LW(175,203)=1;LW(175,204)=1;LW(175,205)=1;LW(175,206)=1;LW(175,207)=1;LW(175,208)=1;LW(175,209)=1;LW(175,210)=1;
    LW(175,211)=1;LW(175,212)=1;LW(175,213)=1;LW(175,214)=1;LW(175,215)=1;LW(175,216)=1;LW(175,217)=1;LW(175,218)=1;LW(175,219)=1;LW(175,220)=1;
    LW(175,221)=1;LW(175,222)=1;LW(175,223)=1;LW(175,224)=1;LW(175,225)=1;LW(175,226)=1;LW(175,227)=1;LW(175,228)=1;LW(175,229)=1;LW(175,230)=1;
    LW(175,231)=1;LW(175,232)=1;LW(175,233)=1;LW(175,234)=1;LW(175,235)=1;LW(175,236)=1;LW(175,237)=1;LW(175,238)=1;LW(175,239)=1;LW(175,240)=1;
    LW(175,241)=1;LW(175,242)=1;LW(175,243)=1;LW(175,244)=1;LW(175,245)=1;LW(175,246)=1;LW(175,247)=1;LW(175,248)=1;LW(175,249)=1;LW(175,250)=1;
    LW(175,251)=1;LW(175,252)=1;LW(175,253)=1;LW(175,254)=1;LW(175,255)=1;LW(175,256)=1;LW(175,257)=1;LW(175,258)=1;LW(175,259)=1;LW(175,260)=1;
    LW(175,261)=1;LW(175,262)=1;LW(175,263)=1;LW(175,264)=1;LW(175,265)=1;LW(175,266)=1;LW(175,267)=1;LW(175,268)=1;LW(175,269)=1;LW(175,270)=1;
    LW(176,1)=1;LW(176,2)=1;LW(176,3)=1;LW(176,4)=1;LW(176,5)=1;LW(176,6)=1;LW(176,7)=1;LW(176,8)=1;LW(176,9)=1;LW(176,10)=1;
    LW(176,11)=1;LW(176,12)=1;LW(176,13)=1;LW(176,14)=1;LW(176,15)=1;LW(176,16)=1;LW(176,17)=1;LW(176,18)=1;LW(176,19)=1;LW(176,20)=1;
    LW(176,21)=1;LW(176,22)=1;LW(176,23)=1;LW(176,24)=1;LW(176,25)=1;LW(176,26)=1;LW(176,27)=1;LW(176,28)=1;LW(176,29)=1;LW(176,35)=1;
    LW(176,36)=1;LW(176,37)=1;LW(176,38)=1;LW(176,39)=1;LW(176,40)=1;LW(176,41)=1;LW(176,42)=1;LW(176,43)=1;LW(176,44)=1;LW(176,46)=1;
    LW(176,47)=1;LW(176,48)=1;LW(176,49)=1;LW(176,50)=1;LW(176,51)=1;LW(176,52)=1;LW(176,53)=1;LW(176,54)=1;LW(176,55)=1;LW(176,56)=1;
    LW(176,57)=1;LW(176,58)=1;LW(176,59)=1;LW(176,60)=1;LW(176,61)=1;LW(176,62)=1;LW(176,63)=1;LW(176,64)=1;LW(176,65)=1;LW(176,66)=1;
    LW(176,67)=1;LW(176,68)=1;LW(176,69)=1;LW(176,70)=1;LW(176,71)=1;LW(176,72)=1;LW(176,77)=1;LW(176,78)=1;LW(176,79)=1;LW(176,80)=1;
    LW(176,81)=1;LW(176,82)=1;LW(176,84)=1;LW(176,85)=1;LW(176,86)=1;LW(176,87)=1;LW(176,88)=1;LW(176,89)=1;LW(176,90)=1;LW(176,91)=1;
    LW(176,92)=1;LW(176,106)=1;LW(176,107)=1;LW(176,108)=1;LW(176,109)=1;LW(176,114)=1;LW(176,115)=1;LW(176,116)=1;LW(176,119)=1;LW(176,120)=1;
    LW(176,121)=1;LW(176,122)=1;LW(176,123)=1;LW(176,124)=1;LW(176,125)=1;LW(176,126)=1;LW(176,127)=1;LW(176,128)=1;LW(176,129)=1;LW(176,135)=1;
    LW(176,136)=1;LW(176,137)=1;LW(176,138)=1;LW(176,139)=1;LW(176,140)=1;LW(176,141)=1;LW(176,142)=1;LW(176,143)=1;LW(176,144)=1;LW(176,145)=1;
    LW(176,146)=1;LW(176,147)=1;LW(176,152)=1;LW(176,153)=1;LW(176,154)=1;LW(176,155)=1;LW(176,156)=1;LW(176,157)=1;LW(176,162)=1;LW(176,163)=1;
    LW(176,164)=1;LW(176,165)=1;LW(176,166)=1;LW(176,167)=1;LW(176,168)=1;LW(176,169)=1;LW(176,170)=1;LW(176,171)=1;LW(176,172)=1;LW(176,173)=1;
    LW(176,174)=1;LW(176,175)=1;LW(176,176)=1;LW(176,179)=1;LW(176,180)=1;LW(176,181)=1;LW(176,182)=1;LW(176,183)=1;LW(176,187)=1;LW(176,188)=1;
    LW(176,189)=1;LW(176,190)=1;LW(176,191)=1;LW(176,192)=1;LW(176,193)=1;LW(176,194)=1;LW(176,195)=1;LW(176,196)=1;LW(176,197)=1;LW(176,198)=1;
    LW(176,199)=1;LW(176,200)=1;LW(176,201)=1;LW(176,202)=1;LW(176,203)=1;LW(176,204)=1;LW(176,205)=1;LW(176,206)=1;LW(176,207)=1;LW(176,208)=1;
    LW(176,209)=1;LW(176,210)=1;LW(176,211)=1;LW(176,212)=1;LW(176,213)=1;LW(176,214)=1;LW(176,215)=1;LW(176,216)=1;LW(176,217)=1;LW(176,218)=1;
    LW(176,219)=1;LW(176,220)=1;LW(176,221)=1;LW(176,222)=1;LW(176,223)=1;LW(176,224)=1;LW(176,225)=1;LW(176,226)=1;LW(176,227)=1;LW(176,228)=1;
    LW(176,229)=1;LW(176,230)=1;LW(176,231)=1;LW(176,232)=1;LW(176,233)=1;LW(176,234)=1;LW(176,235)=1;LW(176,236)=1;LW(176,237)=1;LW(176,238)=1;
    LW(176,239)=1;LW(176,240)=1;LW(176,241)=1;LW(176,242)=1;LW(176,243)=1;LW(176,244)=1;LW(176,245)=1;LW(176,246)=1;LW(176,247)=1;LW(176,248)=1;
    LW(176,249)=1;LW(176,250)=1;LW(176,251)=1;LW(176,252)=1;LW(176,253)=1;LW(176,254)=1;LW(176,255)=1;LW(176,256)=1;LW(176,257)=1;LW(176,258)=1;
    LW(176,259)=1;LW(176,260)=1;LW(176,261)=1;LW(176,262)=1;LW(176,263)=1;LW(176,264)=1;LW(176,265)=1;LW(176,266)=1;LW(176,267)=1;LW(176,268)=1;
    LW(176,269)=1;LW(176,270)=1;LW(177,1)=1;LW(177,2)=1;LW(177,3)=1;LW(177,4)=1;LW(177,5)=1;LW(177,6)=1;LW(177,7)=1;LW(177,8)=1;
    LW(177,9)=1;LW(177,10)=1;LW(177,11)=1;LW(177,12)=1;LW(177,13)=1;LW(177,14)=1;LW(177,15)=1;LW(177,16)=1;LW(177,17)=1;LW(177,18)=1;
    LW(177,19)=1;LW(177,20)=1;LW(177,21)=1;LW(177,22)=1;LW(177,23)=1;LW(177,24)=1;LW(177,25)=1;LW(177,26)=1;LW(177,27)=1;LW(177,28)=1;
    LW(177,29)=1;LW(177,36)=1;LW(177,37)=1;LW(177,38)=1;LW(177,39)=1;LW(177,40)=1;LW(177,41)=1;LW(177,42)=1;LW(177,43)=1;LW(177,50)=1;
    LW(177,51)=1;LW(177,52)=1;LW(177,53)=1;LW(177,54)=1;LW(177,55)=1;LW(177,56)=1;LW(177,57)=1;LW(177,58)=1;LW(177,59)=1;LW(177,60)=1;
    LW(177,61)=1;LW(177,62)=1;LW(177,63)=1;LW(177,64)=1;LW(177,65)=1;LW(177,66)=1;LW(177,67)=1;LW(177,69)=1;LW(177,70)=1;LW(177,71)=1;
    LW(177,72)=1;LW(177,79)=1;LW(177,80)=1;LW(177,81)=1;LW(177,82)=1;LW(177,83)=1;LW(177,84)=1;LW(177,85)=1;LW(177,86)=1;LW(177,87)=1;
    LW(177,88)=1;LW(177,89)=1;LW(177,90)=1;LW(177,91)=1;LW(177,106)=1;LW(177,107)=1;LW(177,108)=1;LW(177,109)=1;LW(177,114)=1;LW(177,115)=1;
    LW(177,119)=1;LW(177,120)=1;LW(177,121)=1;LW(177,122)=1;LW(177,123)=1;LW(177,124)=1;LW(177,125)=1;LW(177,126)=1;LW(177,127)=1;LW(177,128)=1;
    LW(177,129)=1;LW(177,137)=1;LW(177,138)=1;LW(177,139)=1;LW(177,140)=1;LW(177,141)=1;LW(177,142)=1;LW(177,143)=1;LW(177,144)=1;LW(177,145)=1;
    LW(177,152)=1;LW(177,153)=1;LW(177,154)=1;LW(177,155)=1;LW(177,156)=1;LW(177,160)=1;LW(177,161)=1;LW(177,162)=1;LW(177,163)=1;LW(177,164)=1;
    LW(177,165)=1;LW(177,166)=1;LW(177,167)=1;LW(177,168)=1;LW(177,169)=1;LW(177,170)=1;LW(177,171)=1;LW(177,172)=1;LW(177,173)=1;LW(177,174)=1;
    LW(177,175)=1;LW(177,176)=1;LW(177,179)=1;LW(177,180)=1;LW(177,181)=1;LW(177,182)=1;LW(177,183)=1;LW(177,187)=1;LW(177,188)=1;LW(177,189)=1;
    LW(177,190)=1;LW(177,191)=1;LW(177,192)=1;LW(177,193)=1;LW(177,194)=1;LW(177,195)=1;LW(177,196)=1;LW(177,197)=1;LW(177,198)=1;LW(177,199)=1;
    LW(177,200)=1;LW(177,201)=1;LW(177,202)=1;LW(177,203)=1;LW(177,204)=1;LW(177,205)=1;LW(177,206)=1;LW(177,207)=1;LW(177,208)=1;LW(177,209)=1;
    LW(177,210)=1;LW(177,211)=1;LW(177,212)=1;LW(177,213)=1;LW(177,214)=1;LW(177,215)=1;LW(177,216)=1;LW(177,217)=1;LW(177,218)=1;LW(177,219)=1;
    LW(177,220)=1;LW(177,221)=1;LW(177,222)=1;LW(177,223)=1;LW(177,224)=1;LW(177,225)=1;LW(177,226)=1;LW(177,227)=1;LW(177,228)=1;LW(177,229)=1;
    LW(177,230)=1;LW(177,231)=1;LW(177,232)=1;LW(177,233)=1;LW(177,234)=1;LW(177,235)=1;LW(177,236)=1;LW(177,237)=1;LW(177,238)=1;LW(177,239)=1;
    LW(177,240)=1;LW(177,241)=1;LW(177,242)=1;LW(177,243)=1;LW(177,244)=1;LW(177,245)=1;LW(177,246)=1;LW(177,247)=1;LW(177,248)=1;LW(177,249)=1;
    LW(177,250)=1;LW(177,251)=1;LW(177,252)=1;LW(177,253)=1;LW(177,254)=1;LW(177,255)=1;LW(177,256)=1;LW(177,257)=1;LW(177,258)=1;LW(177,259)=1;
    LW(177,260)=1;LW(177,261)=1;LW(177,262)=1;LW(177,263)=1;LW(177,264)=1;LW(177,265)=1;LW(177,266)=1;LW(177,267)=1;LW(177,268)=1;LW(177,269)=1;
    LW(177,270)=1;LW(178,1)=1;LW(178,2)=1;LW(178,3)=1;LW(178,4)=1;LW(178,5)=1;LW(178,6)=1;LW(178,7)=1;LW(178,8)=1;LW(178,9)=1;
    LW(178,10)=1;LW(178,11)=1;LW(178,12)=1;LW(178,13)=1;LW(178,14)=1;LW(178,15)=1;LW(178,16)=1;LW(178,17)=1;LW(178,18)=1;LW(178,19)=1;
    LW(178,20)=1;LW(178,21)=1;LW(178,22)=1;LW(178,23)=1;LW(178,24)=1;LW(178,25)=1;LW(178,26)=1;LW(178,27)=1;LW(178,28)=1;LW(178,29)=1;
    LW(178,30)=1;LW(178,36)=1;LW(178,37)=1;LW(178,38)=1;LW(178,39)=1;LW(178,40)=1;LW(178,41)=1;LW(178,42)=1;LW(178,43)=1;LW(178,44)=1;
    LW(178,45)=1;LW(178,46)=1;LW(178,50)=1;LW(178,51)=1;LW(178,52)=1;LW(178,53)=1;LW(178,54)=1;LW(178,55)=1;LW(178,56)=1;LW(178,57)=1;
    LW(178,58)=1;LW(178,59)=1;LW(178,60)=1;LW(178,61)=1;LW(178,62)=1;LW(178,64)=1;LW(178,65)=1;LW(178,66)=1;LW(178,69)=1;LW(178,70)=1;
    LW(178,71)=1;LW(178,72)=1;LW(178,82)=1;LW(178,83)=1;LW(178,84)=1;LW(178,85)=1;LW(178,86)=1;LW(178,87)=1;LW(178,106)=1;LW(178,107)=1;
    LW(178,108)=1;LW(178,109)=1;LW(178,115)=1;LW(178,120)=1;LW(178,121)=1;LW(178,122)=1;LW(178,123)=1;LW(178,127)=1;LW(178,128)=1;LW(178,129)=1;
    LW(178,140)=1;LW(178,141)=1;LW(178,142)=1;LW(178,143)=1;LW(178,144)=1;LW(178,152)=1;LW(178,153)=1;LW(178,154)=1;LW(178,155)=1;LW(178,156)=1;
    LW(178,160)=1;LW(178,161)=1;LW(178,162)=1;LW(178,163)=1;LW(178,164)=1;LW(178,165)=1;LW(178,166)=1;LW(178,167)=1;LW(178,168)=1;LW(178,169)=1;
    LW(178,170)=1;LW(178,171)=1;LW(178,172)=1;LW(178,173)=1;LW(178,174)=1;LW(178,175)=1;LW(178,176)=1;LW(178,177)=1;LW(178,178)=1;LW(178,180)=1;
    LW(178,181)=1;LW(178,182)=1;LW(178,183)=1;LW(178,187)=1;LW(178,188)=1;LW(178,189)=1;LW(178,190)=1;LW(178,191)=1;LW(178,192)=1;LW(178,193)=1;
    LW(178,194)=1;LW(178,195)=1;LW(178,196)=1;LW(178,197)=1;LW(178,198)=1;LW(178,199)=1;LW(178,200)=1;LW(178,201)=1;LW(178,202)=1;LW(178,203)=1;
    LW(178,204)=1;LW(178,205)=1;LW(178,206)=1;LW(178,207)=1;LW(178,208)=1;LW(178,209)=1;LW(178,210)=1;LW(178,211)=1;LW(178,212)=1;LW(178,213)=1;
    LW(178,214)=1;LW(178,215)=1;LW(178,216)=1;LW(178,217)=1;LW(178,218)=1;LW(178,219)=1;LW(178,220)=1;LW(178,221)=1;LW(178,222)=1;LW(178,223)=1;
    LW(178,224)=1;LW(178,225)=1;LW(178,226)=1;LW(178,227)=1;LW(178,228)=1;LW(178,229)=1;LW(178,230)=1;LW(178,231)=1;LW(178,232)=1;LW(178,233)=1;
    LW(178,234)=1;LW(178,235)=1;LW(178,236)=1;LW(178,237)=1;LW(178,238)=1;LW(178,239)=1;LW(178,240)=1;LW(178,241)=1;LW(178,242)=1;LW(178,243)=1;
    LW(178,244)=1;LW(178,245)=1;LW(178,246)=1;LW(178,247)=1;LW(178,248)=1;LW(178,249)=1;LW(178,250)=1;LW(178,251)=1;LW(178,252)=1;LW(178,253)=1;
    LW(178,254)=1;LW(178,255)=1;LW(178,256)=1;LW(178,257)=1;LW(178,258)=1;LW(178,259)=1;LW(178,260)=1;LW(178,261)=1;LW(178,262)=1;LW(178,263)=1;
    LW(178,264)=1;LW(178,265)=1;LW(178,266)=1;LW(178,267)=1;LW(178,268)=1;LW(178,269)=1;LW(178,270)=1;LW(179,3)=1;LW(179,4)=1;LW(179,5)=1;
    LW(179,6)=1;LW(179,7)=1;LW(179,8)=1;LW(179,9)=1;LW(179,10)=1;LW(179,11)=1;LW(179,12)=1;LW(179,13)=1;LW(179,14)=1;LW(179,15)=1;
    LW(179,16)=1;LW(179,17)=1;LW(179,18)=1;LW(179,19)=1;LW(179,20)=1;LW(179,21)=1;LW(179,22)=1;LW(179,23)=1;LW(179,29)=1;LW(179,30)=1;
    LW(179,31)=1;LW(179,37)=1;LW(179,38)=1;LW(179,39)=1;LW(179,40)=1;LW(179,41)=1;LW(179,42)=1;LW(179,43)=1;LW(179,44)=1;LW(179,45)=1;
    LW(179,46)=1;LW(179,51)=1;LW(179,52)=1;LW(179,53)=1;LW(179,54)=1;LW(179,55)=1;LW(179,56)=1;LW(179,57)=1;LW(179,58)=1;LW(179,59)=1;
    LW(179,60)=1;LW(179,61)=1;LW(179,62)=1;LW(179,67)=1;LW(179,68)=1;LW(179,69)=1;LW(179,70)=1;LW(179,71)=1;LW(179,72)=1;LW(179,84)=1;
    LW(179,85)=1;LW(179,86)=1;LW(179,87)=1;LW(179,107)=1;LW(179,108)=1;LW(179,121)=1;LW(179,122)=1;LW(179,127)=1;LW(179,128)=1;LW(179,129)=1;
    LW(179,141)=1;LW(179,142)=1;LW(179,143)=1;LW(179,144)=1;LW(179,153)=1;LW(179,154)=1;LW(179,155)=1;LW(179,156)=1;LW(179,166)=1;LW(179,167)=1;
    LW(179,168)=1;LW(179,169)=1;LW(179,170)=1;LW(179,171)=1;LW(179,172)=1;LW(179,173)=1;LW(179,174)=1;LW(179,175)=1;LW(179,176)=1;LW(179,177)=1;
    LW(179,178)=1;LW(179,183)=1;LW(179,184)=1;LW(179,185)=1;LW(179,188)=1;LW(179,189)=1;LW(179,190)=1;LW(179,191)=1;LW(179,192)=1;LW(179,193)=1;
    LW(179,194)=1;LW(179,195)=1;LW(179,196)=1;LW(179,197)=1;LW(179,198)=1;LW(179,199)=1;LW(179,200)=1;LW(179,201)=1;LW(179,202)=1;LW(179,203)=1;
    LW(179,204)=1;LW(179,205)=1;LW(179,206)=1;LW(179,207)=1;LW(179,208)=1;LW(179,209)=1;LW(179,210)=1;LW(179,211)=1;LW(179,212)=1;LW(179,213)=1;
    LW(179,214)=1;LW(179,215)=1;LW(179,216)=1;LW(179,217)=1;LW(179,218)=1;LW(179,219)=1;LW(179,220)=1;LW(179,221)=1;LW(179,222)=1;LW(179,223)=1;
    LW(179,224)=1;LW(179,225)=1;LW(179,226)=1;LW(179,227)=1;LW(179,228)=1;LW(179,229)=1;LW(179,230)=1;LW(179,231)=1;LW(179,232)=1;LW(179,233)=1;
    LW(179,234)=1;LW(179,235)=1;LW(179,236)=1;LW(179,237)=1;LW(179,238)=1;LW(179,239)=1;LW(179,240)=1;LW(179,241)=1;LW(179,242)=1;LW(179,243)=1;
    LW(179,244)=1;LW(179,245)=1;LW(179,246)=1;LW(179,247)=1;LW(179,248)=1;LW(179,249)=1;LW(179,250)=1;LW(179,251)=1;LW(179,252)=1;LW(179,253)=1;
    LW(179,254)=1;LW(179,255)=1;LW(179,256)=1;LW(179,257)=1;LW(179,258)=1;LW(179,259)=1;LW(179,260)=1;LW(179,261)=1;LW(179,262)=1;LW(179,263)=1;
    LW(179,264)=1;LW(179,265)=1;LW(179,266)=1;LW(179,267)=1;LW(179,268)=1;LW(179,269)=1;LW(179,270)=1;LW(180,3)=1;LW(180,4)=1;LW(180,5)=1;
    LW(180,6)=1;LW(180,7)=1;LW(180,8)=1;LW(180,9)=1;LW(180,10)=1;LW(180,11)=1;LW(180,12)=1;LW(180,13)=1;LW(180,14)=1;LW(180,15)=1;
    LW(180,16)=1;LW(180,17)=1;LW(180,18)=1;LW(180,19)=1;LW(180,20)=1;LW(180,21)=1;LW(180,22)=1;LW(180,23)=1;LW(180,29)=1;LW(180,30)=1;
    LW(180,31)=1;LW(180,38)=1;LW(180,39)=1;LW(180,40)=1;LW(180,41)=1;LW(180,42)=1;LW(180,43)=1;LW(180,44)=1;LW(180,45)=1;LW(180,46)=1;
    LW(180,52)=1;LW(180,53)=1;LW(180,54)=1;LW(180,55)=1;LW(180,56)=1;LW(180,57)=1;LW(180,58)=1;LW(180,59)=1;LW(180,60)=1;LW(180,61)=1;
    LW(180,67)=1;LW(180,68)=1;LW(180,69)=1;LW(180,70)=1;LW(180,71)=1;LW(180,72)=1;LW(180,73)=1;LW(180,74)=1;LW(180,75)=1;LW(180,128)=1;
    LW(180,129)=1;LW(180,141)=1;LW(180,142)=1;LW(180,143)=1;LW(180,144)=1;LW(180,146)=1;LW(180,147)=1;LW(180,153)=1;LW(180,154)=1;LW(180,155)=1;
    LW(180,156)=1;LW(180,166)=1;LW(180,167)=1;LW(180,168)=1;LW(180,169)=1;LW(180,170)=1;LW(180,173)=1;LW(180,174)=1;LW(180,175)=1;LW(180,176)=1;
    LW(180,177)=1;LW(180,178)=1;LW(180,183)=1;LW(180,184)=1;LW(180,185)=1;LW(180,189)=1;LW(180,190)=1;LW(180,191)=1;LW(180,192)=1;LW(180,193)=1;
    LW(180,194)=1;LW(180,195)=1;LW(180,196)=1;LW(180,197)=1;LW(180,198)=1;LW(180,199)=1;LW(180,200)=1;LW(180,201)=1;LW(180,202)=1;LW(180,203)=1;
    LW(180,204)=1;LW(180,205)=1;LW(180,206)=1;LW(180,207)=1;LW(180,208)=1;LW(180,209)=1;LW(180,210)=1;LW(180,211)=1;LW(180,212)=1;LW(180,213)=1;
    LW(180,214)=1;LW(180,215)=1;LW(180,216)=1;LW(180,217)=1;LW(180,218)=1;LW(180,219)=1;LW(180,220)=1;LW(180,221)=1;LW(180,222)=1;LW(180,223)=1;
    LW(180,224)=1;LW(180,225)=1;LW(180,226)=1;LW(180,227)=1;LW(180,228)=1;LW(180,229)=1;LW(180,230)=1;LW(180,231)=1;LW(180,232)=1;LW(180,233)=1;
    LW(180,234)=1;LW(180,235)=1;LW(180,236)=1;LW(180,237)=1;LW(180,238)=1;LW(180,239)=1;LW(180,240)=1;LW(180,241)=1;LW(180,242)=1;LW(180,243)=1;
    LW(180,244)=1;LW(180,245)=1;LW(180,246)=1;LW(180,247)=1;LW(180,248)=1;LW(180,249)=1;LW(180,250)=1;LW(180,251)=1;LW(180,252)=1;LW(180,253)=1;
    LW(180,254)=1;LW(180,255)=1;LW(180,256)=1;LW(180,257)=1;LW(180,258)=1;LW(180,259)=1;LW(180,260)=1;LW(180,261)=1;LW(180,262)=1;LW(180,263)=1;
    LW(180,264)=1;LW(180,265)=1;LW(180,266)=1;LW(180,267)=1;LW(180,268)=1;LW(180,269)=1;LW(180,270)=1;LW(181,4)=1;LW(181,5)=1;LW(181,6)=1;
    LW(181,7)=1;LW(181,8)=1;LW(181,9)=1;LW(181,10)=1;LW(181,11)=1;LW(181,12)=1;LW(181,13)=1;LW(181,16)=1;LW(181,17)=1;LW(181,18)=1;
    LW(181,19)=1;LW(181,20)=1;LW(181,22)=1;LW(181,40)=1;LW(181,41)=1;LW(181,42)=1;LW(181,43)=1;LW(181,44)=1;LW(181,45)=1;LW(181,46)=1;
    LW(181,53)=1;LW(181,54)=1;LW(181,55)=1;LW(181,56)=1;LW(181,57)=1;LW(181,58)=1;LW(181,59)=1;LW(181,71)=1;LW(181,72)=1;LW(181,73)=1;
    LW(181,74)=1;LW(181,104)=1;LW(181,174)=1;LW(181,175)=1;LW(181,176)=1;LW(181,177)=1;LW(181,178)=1;LW(181,183)=1;LW(181,184)=1;LW(181,185)=1;
    LW(181,186)=1;LW(181,187)=1;LW(181,188)=1;LW(181,189)=1;LW(181,190)=1;LW(181,191)=1;LW(181,192)=1;LW(181,193)=1;LW(181,194)=1;LW(181,195)=1;
    LW(181,196)=1;LW(181,197)=1;LW(181,198)=1;LW(181,199)=1;LW(181,200)=1;LW(181,201)=1;LW(181,202)=1;LW(181,203)=1;LW(181,204)=1;LW(181,205)=1;
    LW(181,206)=1;LW(181,207)=1;LW(181,208)=1;LW(181,209)=1;LW(181,210)=1;LW(181,211)=1;LW(181,212)=1;LW(181,213)=1;LW(181,214)=1;LW(181,215)=1;
    LW(181,216)=1;LW(181,217)=1;LW(181,218)=1;LW(181,219)=1;LW(181,220)=1;LW(181,221)=1;LW(181,222)=1;LW(181,223)=1;LW(181,224)=1;LW(181,225)=1;
    LW(181,226)=1;LW(181,227)=1;LW(181,228)=1;LW(181,229)=1;LW(181,230)=1;LW(181,231)=1;LW(181,232)=1;LW(181,233)=1;LW(181,234)=1;LW(181,235)=1;
    LW(181,236)=1;LW(181,237)=1;LW(181,238)=1;LW(181,239)=1;LW(181,240)=1;LW(181,241)=1;LW(181,242)=1;LW(181,243)=1;LW(181,244)=1;LW(181,245)=1;
    LW(181,246)=1;LW(181,247)=1;LW(181,248)=1;LW(181,249)=1;LW(181,250)=1;LW(181,251)=1;LW(181,252)=1;LW(181,253)=1;LW(181,254)=1;LW(181,255)=1;
    LW(181,256)=1;LW(181,257)=1;LW(181,258)=1;LW(181,259)=1;LW(181,260)=1;LW(181,261)=1;LW(181,262)=1;LW(181,263)=1;LW(181,264)=1;LW(181,265)=1;
    LW(181,266)=1;LW(181,267)=1;LW(181,268)=1;LW(181,269)=1;LW(181,270)=1;LW(182,3)=1;LW(182,4)=1;LW(182,5)=1;LW(182,6)=1;LW(182,7)=1;
    LW(182,8)=1;LW(182,9)=1;LW(182,10)=1;LW(182,11)=1;LW(182,12)=1;LW(182,13)=1;LW(182,17)=1;LW(182,18)=1;LW(182,41)=1;LW(182,42)=1;
    LW(182,43)=1;LW(182,44)=1;LW(182,45)=1;LW(182,46)=1;LW(182,53)=1;LW(182,54)=1;LW(182,55)=1;LW(182,56)=1;LW(182,57)=1;LW(182,58)=1;
    LW(182,59)=1;LW(182,73)=1;LW(182,103)=1;LW(182,104)=1;LW(182,175)=1;LW(182,176)=1;LW(182,177)=1;LW(182,178)=1;LW(182,183)=1;LW(182,184)=1;
    LW(182,185)=1;LW(182,186)=1;LW(182,187)=1;LW(182,188)=1;LW(182,189)=1;LW(182,190)=1;LW(182,191)=1;LW(182,192)=1;LW(182,193)=1;LW(182,194)=1;
    LW(182,195)=1;LW(182,196)=1;LW(182,197)=1;LW(182,198)=1;LW(182,199)=1;LW(182,200)=1;LW(182,201)=1;LW(182,202)=1;LW(182,203)=1;LW(182,204)=1;
    LW(182,205)=1;LW(182,206)=1;LW(182,207)=1;LW(182,208)=1;LW(182,209)=1;LW(182,210)=1;LW(182,211)=1;LW(182,212)=1;LW(182,213)=1;LW(182,214)=1;
    LW(182,215)=1;LW(182,216)=1;LW(182,217)=1;LW(182,218)=1;LW(182,219)=1;LW(182,220)=1;LW(182,221)=1;LW(182,222)=1;LW(182,223)=1;LW(182,224)=1;
    LW(182,225)=1;LW(182,226)=1;LW(182,227)=1;LW(182,228)=1;LW(182,229)=1;LW(182,230)=1;LW(182,231)=1;LW(182,232)=1;LW(182,233)=1;LW(182,234)=1;
    LW(182,235)=1;LW(182,236)=1;LW(182,237)=1;LW(182,238)=1;LW(182,239)=1;LW(182,240)=1;LW(182,241)=1;LW(182,242)=1;LW(182,243)=1;LW(182,244)=1;
    LW(182,245)=1;LW(182,246)=1;LW(182,247)=1;LW(182,248)=1;LW(182,249)=1;LW(182,250)=1;LW(182,251)=1;LW(182,252)=1;LW(182,253)=1;LW(182,254)=1;
    LW(182,255)=1;LW(182,256)=1;LW(182,257)=1;LW(182,258)=1;LW(182,259)=1;LW(182,260)=1;LW(182,261)=1;LW(182,262)=1;LW(182,263)=1;LW(182,264)=1;
    LW(182,265)=1;LW(182,266)=1;LW(182,267)=1;LW(182,268)=1;LW(182,269)=1;LW(182,270)=1;LW(183,3)=1;LW(183,4)=1;LW(183,5)=1;LW(183,6)=1;
    LW(183,7)=1;LW(183,8)=1;LW(183,9)=1;LW(183,10)=1;LW(183,11)=1;LW(183,12)=1;LW(183,17)=1;LW(183,41)=1;LW(183,42)=1;LW(183,43)=1;
    LW(183,44)=1;LW(183,45)=1;LW(183,46)=1;LW(183,53)=1;LW(183,54)=1;LW(183,55)=1;LW(183,56)=1;LW(183,57)=1;LW(183,58)=1;LW(183,59)=1;
    LW(183,104)=1;LW(183,175)=1;LW(183,176)=1;LW(183,177)=1;LW(183,178)=1;LW(183,185)=1;LW(183,186)=1;LW(183,187)=1;LW(183,188)=1;LW(183,189)=1;
    LW(183,190)=1;LW(183,191)=1;LW(183,192)=1;LW(183,193)=1;LW(183,194)=1;LW(183,195)=1;LW(183,196)=1;LW(183,197)=1;LW(183,198)=1;LW(183,199)=1;
    LW(183,200)=1;LW(183,201)=1;LW(183,202)=1;LW(183,203)=1;LW(183,204)=1;LW(183,205)=1;LW(183,206)=1;LW(183,207)=1;LW(183,208)=1;LW(183,209)=1;
    LW(183,210)=1;LW(183,211)=1;LW(183,212)=1;LW(183,213)=1;LW(183,214)=1;LW(183,215)=1;LW(183,216)=1;LW(183,217)=1;LW(183,218)=1;LW(183,219)=1;
    LW(183,220)=1;LW(183,221)=1;LW(183,222)=1;LW(183,223)=1;LW(183,224)=1;LW(183,225)=1;LW(183,226)=1;LW(183,227)=1;LW(183,228)=1;LW(183,229)=1;
    LW(183,230)=1;LW(183,231)=1;LW(183,232)=1;LW(183,233)=1;LW(183,234)=1;LW(183,235)=1;LW(183,236)=1;LW(183,237)=1;LW(183,238)=1;LW(183,239)=1;
    LW(183,240)=1;LW(183,241)=1;LW(183,242)=1;LW(183,243)=1;LW(183,244)=1;LW(183,245)=1;LW(183,246)=1;LW(183,247)=1;LW(183,248)=1;LW(183,249)=1;
    LW(183,250)=1;LW(183,251)=1;LW(183,252)=1;LW(183,253)=1;LW(183,254)=1;LW(183,255)=1;LW(183,256)=1;LW(183,257)=1;LW(183,258)=1;LW(183,259)=1;
    LW(183,260)=1;LW(183,261)=1;LW(183,262)=1;LW(183,263)=1;LW(183,264)=1;LW(183,265)=1;LW(183,266)=1;LW(183,267)=1;LW(183,268)=1;LW(183,269)=1;
    LW(183,270)=1;LW(184,2)=1;LW(184,3)=1;LW(184,4)=1;LW(184,5)=1;LW(184,6)=1;LW(184,7)=1;LW(184,8)=1;LW(184,9)=1;LW(184,10)=1;
    LW(184,11)=1;LW(184,12)=1;LW(184,54)=1;LW(184,55)=1;LW(184,56)=1;LW(184,57)=1;LW(184,58)=1;LW(184,59)=1;LW(184,175)=1;LW(184,176)=1;
    LW(184,177)=1;LW(184,188)=1;LW(184,189)=1;LW(184,190)=1;LW(184,191)=1;LW(184,192)=1;LW(184,193)=1;LW(184,194)=1;LW(184,195)=1;LW(184,196)=1;
    LW(184,197)=1;LW(184,198)=1;LW(184,199)=1;LW(184,200)=1;LW(184,201)=1;LW(184,202)=1;LW(184,203)=1;LW(184,204)=1;LW(184,205)=1;LW(184,206)=1;
    LW(184,207)=1;LW(184,208)=1;LW(184,209)=1;LW(184,210)=1;LW(184,211)=1;LW(184,212)=1;LW(184,213)=1;LW(184,214)=1;LW(184,215)=1;LW(184,216)=1;
    LW(184,217)=1;LW(184,218)=1;LW(184,219)=1;LW(184,220)=1;LW(184,221)=1;LW(184,222)=1;LW(184,223)=1;LW(184,224)=1;LW(184,225)=1;LW(184,226)=1;
    LW(184,227)=1;LW(184,228)=1;LW(184,229)=1;LW(184,230)=1;LW(184,231)=1;LW(184,232)=1;LW(184,233)=1;LW(184,234)=1;LW(184,235)=1;LW(184,236)=1;
    LW(184,237)=1;LW(184,238)=1;LW(184,239)=1;LW(184,240)=1;LW(184,241)=1;LW(184,242)=1;LW(184,243)=1;LW(184,244)=1;LW(184,245)=1;LW(184,246)=1;
    LW(184,247)=1;LW(184,248)=1;LW(184,249)=1;LW(184,250)=1;LW(184,251)=1;LW(184,252)=1;LW(184,253)=1;LW(184,254)=1;LW(184,255)=1;LW(184,256)=1;
    LW(184,257)=1;LW(184,258)=1;LW(184,259)=1;LW(184,260)=1;LW(184,261)=1;LW(184,262)=1;LW(184,263)=1;LW(184,264)=1;LW(184,265)=1;LW(184,266)=1;
    LW(184,267)=1;LW(184,268)=1;LW(184,269)=1;LW(184,270)=1;LW(185,2)=1;LW(185,3)=1;LW(185,4)=1;LW(185,5)=1;LW(185,10)=1;LW(185,54)=1;
    LW(185,55)=1;LW(185,56)=1;LW(185,57)=1;LW(185,58)=1;LW(185,59)=1;LW(185,204)=1;LW(185,205)=1;LW(185,206)=1;LW(185,207)=1;LW(185,208)=1;
    LW(185,209)=1;LW(185,210)=1;LW(185,211)=1;LW(185,212)=1;LW(185,213)=1;LW(185,214)=1;LW(185,215)=1;LW(185,216)=1;LW(185,217)=1;LW(185,218)=1;
    LW(185,219)=1;LW(185,220)=1;LW(185,221)=1;LW(185,222)=1;LW(185,223)=1;LW(185,224)=1;LW(185,225)=1;LW(185,226)=1;LW(185,227)=1;LW(185,228)=1;
    LW(185,229)=1;LW(185,230)=1;LW(185,231)=1;LW(185,232)=1;LW(185,233)=1;LW(185,234)=1;LW(185,235)=1;LW(185,236)=1;LW(185,237)=1;LW(185,238)=1;
    LW(185,239)=1;LW(185,240)=1;LW(185,241)=1;LW(185,242)=1;LW(185,243)=1;LW(185,244)=1;LW(185,245)=1;LW(185,246)=1;LW(185,247)=1;LW(185,248)=1;
    LW(185,249)=1;LW(185,250)=1;LW(185,251)=1;LW(185,252)=1;LW(185,253)=1;LW(185,254)=1;LW(185,255)=1;LW(185,256)=1;LW(185,257)=1;LW(185,258)=1;
    LW(185,259)=1;LW(185,260)=1;LW(185,261)=1;LW(185,262)=1;LW(185,263)=1;LW(185,264)=1;LW(185,265)=1;LW(185,266)=1;LW(185,267)=1;LW(185,268)=1;
    LW(185,269)=1;LW(185,270)=1;LW(186,55)=1;LW(186,56)=1;LW(186,57)=1;LW(186,58)=1;LW(186,59)=1;LW(186,216)=1;LW(186,217)=1;LW(186,218)=1;
    LW(186,219)=1;LW(186,220)=1;LW(186,221)=1;LW(186,222)=1;LW(186,223)=1;LW(186,224)=1;LW(186,225)=1;LW(186,226)=1;LW(186,227)=1;LW(186,228)=1;
    LW(186,229)=1;LW(186,230)=1;LW(186,231)=1;LW(186,232)=1;LW(186,233)=1;LW(186,234)=1;LW(186,235)=1;LW(186,236)=1;LW(186,237)=1;LW(186,238)=1;
    LW(186,239)=1;LW(186,240)=1;LW(186,241)=1;LW(186,242)=1;LW(186,243)=1;LW(186,244)=1;LW(186,245)=1;LW(186,246)=1;LW(186,247)=1;LW(186,248)=1;
    LW(186,249)=1;LW(186,250)=1;LW(186,251)=1;LW(186,252)=1;LW(186,253)=1;LW(186,254)=1;LW(186,255)=1;LW(186,256)=1;LW(186,257)=1;LW(186,258)=1;
    LW(186,259)=1;LW(186,260)=1;LW(186,261)=1;LW(186,262)=1;LW(186,263)=1;LW(186,264)=1;LW(186,265)=1;LW(186,266)=1;LW(186,267)=1;LW(186,268)=1;
    LW(186,269)=1;LW(186,270)=1;LW(187,56)=1;LW(187,57)=1;LW(187,58)=1;LW(187,218)=1;LW(187,219)=1;LW(187,220)=1;LW(187,221)=1;LW(187,222)=1;
    LW(187,223)=1;LW(187,224)=1;LW(187,225)=1;LW(187,226)=1;LW(187,227)=1;LW(187,228)=1;LW(187,229)=1;LW(187,230)=1;LW(187,231)=1;LW(187,232)=1;
    LW(187,233)=1;LW(187,234)=1;LW(187,235)=1;LW(187,236)=1;LW(187,237)=1;LW(187,238)=1;LW(187,239)=1;LW(187,240)=1;LW(187,241)=1;LW(187,242)=1;
    LW(187,243)=1;LW(187,244)=1;LW(187,245)=1;LW(187,246)=1;LW(187,247)=1;LW(187,248)=1;LW(187,249)=1;LW(187,250)=1;LW(187,251)=1;LW(187,252)=1;
    LW(187,253)=1;LW(187,254)=1;LW(187,255)=1;LW(187,256)=1;LW(187,257)=1;LW(187,258)=1;LW(187,259)=1;LW(187,260)=1;LW(187,261)=1;LW(187,262)=1;
    LW(187,263)=1;LW(187,264)=1;LW(187,265)=1;LW(187,266)=1;LW(187,267)=1;LW(187,268)=1;LW(187,269)=1;LW(187,270)=1;LW(188,56)=1;LW(188,57)=1;
    LW(188,58)=1;LW(188,223)=1;LW(188,224)=1;LW(188,225)=1;LW(188,226)=1;LW(188,227)=1;LW(188,229)=1;LW(188,230)=1;LW(188,231)=1;LW(188,232)=1;
    LW(188,233)=1;LW(188,234)=1;LW(188,235)=1;LW(188,236)=1;LW(188,237)=1;LW(188,238)=1;LW(188,239)=1;LW(188,240)=1;LW(188,241)=1;LW(188,242)=1;
    LW(188,243)=1;LW(188,244)=1;LW(188,245)=1;LW(188,246)=1;LW(188,247)=1;LW(188,248)=1;LW(188,249)=1;LW(188,250)=1;LW(188,251)=1;LW(188,252)=1;
    LW(188,253)=1;LW(188,254)=1;LW(188,255)=1;LW(188,256)=1;LW(188,257)=1;LW(188,258)=1;LW(188,259)=1;LW(188,260)=1;LW(188,261)=1;LW(188,262)=1;
    LW(188,263)=1;LW(188,264)=1;LW(188,265)=1;LW(188,266)=1;LW(188,267)=1;LW(188,268)=1;LW(188,269)=1;LW(188,270)=1;LW(189,56)=1;LW(189,57)=1;
    LW(189,58)=1;LW(189,223)=1;LW(189,224)=1;LW(189,225)=1;LW(189,226)=1;LW(189,229)=1;LW(189,230)=1;LW(189,231)=1;LW(189,232)=1;LW(189,233)=1;
    LW(189,234)=1;LW(189,235)=1;LW(189,236)=1;LW(189,237)=1;LW(189,238)=1;LW(189,239)=1;LW(189,240)=1;LW(189,241)=1;LW(189,242)=1;LW(189,243)=1;
    LW(189,244)=1;LW(189,245)=1;LW(189,246)=1;LW(189,247)=1;LW(189,248)=1;LW(189,249)=1;LW(189,250)=1;LW(189,251)=1;LW(189,252)=1;LW(189,253)=1;
    LW(189,254)=1;LW(189,255)=1;LW(189,256)=1;LW(189,257)=1;LW(189,258)=1;LW(189,259)=1;LW(189,260)=1;LW(189,261)=1;LW(189,262)=1;LW(189,263)=1;
    LW(189,264)=1;LW(189,265)=1;LW(189,266)=1;LW(189,267)=1;LW(189,268)=1;LW(189,269)=1;LW(189,270)=1;LW(190,230)=1;LW(190,231)=1;LW(190,232)=1;
    LW(190,233)=1;LW(190,234)=1;LW(190,235)=1;LW(190,236)=1;LW(190,237)=1;LW(190,238)=1;LW(190,239)=1;LW(190,240)=1;LW(190,241)=1;LW(190,242)=1;
    LW(190,243)=1;LW(190,244)=1;LW(190,245)=1;LW(190,246)=1;LW(190,247)=1;LW(190,248)=1;LW(190,249)=1;LW(190,250)=1;LW(190,251)=1;LW(190,252)=1;
    LW(190,253)=1;LW(190,254)=1;LW(190,257)=1;LW(190,258)=1;LW(190,259)=1;LW(190,260)=1;LW(190,261)=1;LW(190,262)=1;LW(190,263)=1;LW(190,264)=1;
    LW(190,265)=1;LW(190,266)=1;LW(190,267)=1;LW(190,268)=1;LW(190,269)=1;LW(190,270)=1;LW(191,233)=1;LW(191,235)=1;LW(191,236)=1;LW(191,237)=1;
    LW(191,238)=1;LW(191,239)=1;LW(191,240)=1;LW(191,241)=1;LW(191,242)=1;LW(191,243)=1;LW(191,244)=1;LW(191,245)=1;LW(191,246)=1;LW(191,247)=1;
    LW(191,248)=1;LW(191,249)=1;LW(191,250)=1;LW(191,251)=1;LW(191,252)=1;LW(191,253)=1;LW(191,254)=1;LW(191,256)=1;LW(191,257)=1;LW(191,258)=1;
    LW(191,259)=1;LW(191,260)=1;LW(191,261)=1;LW(191,262)=1;LW(191,263)=1;LW(191,264)=1;LW(191,265)=1;LW(191,266)=1;LW(191,267)=1;LW(191,268)=1;
    LW(191,269)=1;LW(191,270)=1;LW(192,237)=1;LW(192,240)=1;LW(192,241)=1;LW(192,242)=1;LW(192,243)=1;LW(192,244)=1;LW(192,245)=1;LW(192,246)=1;
    LW(192,247)=1;LW(192,248)=1;LW(192,249)=1;LW(192,250)=1;LW(192,251)=1;LW(192,252)=1;LW(192,253)=1;LW(192,257)=1;LW(192,258)=1;LW(192,259)=1;
    LW(192,260)=1;LW(192,261)=1;LW(192,262)=1;LW(192,263)=1;LW(192,264)=1;LW(192,265)=1;LW(192,266)=1;LW(192,267)=1;LW(192,268)=1;LW(192,269)=1;
    LW(192,270)=1;LW(193,248)=1;LW(193,249)=1;LW(193,250)=1;LW(193,251)=1;LW(193,252)=1;LW(193,253)=1;LW(193,258)=1;LW(193,259)=1;LW(193,260)=1;
    LW(193,261)=1;LW(193,262)=1;LW(193,263)=1;LW(193,264)=1;LW(193,265)=1;LW(193,266)=1;LW(193,267)=1;LW(193,268)=1;LW(193,269)=1;LW(193,270)=1;
    LW(194,259)=1;LW(194,260)=1;LW(194,261)=1;LW(194,262)=1;LW(194,263)=1;LW(194,264)=1;LW(194,265)=1;LW(194,266)=1;LW(194,267)=1;LW(194,268)=1;
    LW(194,269)=1;LW(194,270)=1;LW(195,259)=1;LW(195,260)=1;LW(195,261)=1;LW(195,262)=1;LW(195,263)=1;LW(195,264)=1;LW(195,265)=1;LW(195,266)=1;
    LW(195,267)=1;LW(195,268)=1;LW(195,269)=1;LW(195,270)=1;LW(196,259)=1;LW(196,260)=1;LW(196,261)=1;LW(196,262)=1;LW(196,263)=1;LW(196,264)=1;
    LW(196,265)=1;LW(196,266)=1;LW(196,267)=1;LW(196,268)=1;LW(196,269)=1;LW(196,270)=1;LW(197,260)=1;LW(197,261)=1;LW(197,262)=1;LW(197,263)=1;
    LW(197,264)=1;LW(197,265)=1;LW(197,266)=1;LW(197,267)=1;LW(197,268)=1;LW(197,269)=1;LW(197,270)=1;LW(198,263)=1;LW(198,264)=1;LW(198,265)=1;
    LW(198,266)=1;LW(198,267)=1;LW(198,268)=1;LW(198,269)=1;LW(198,270)=1;LW(199,266)=1;LW(199,267)=1;LW(199,268)=1;LW(199,269)=1;LW(199,270)=1;
    LW(200,269)=1;LW(200,270)=1;LW(201,270)=1;LW(212,125)=1;LW(212,126)=1;LW(213,89)=1;LW(213,96)=1;LW(213,103)=1;LW(213,104)=1;LW(213,124)=1;
    LW(213,125)=1;LW(213,126)=1;LW(213,127)=1;LW(213,128)=1;LW(214,60)=1;LW(214,61)=1;LW(214,62)=1;LW(214,75)=1;LW(214,82)=1;LW(214,83)=1;
    LW(214,84)=1;LW(214,85)=1;LW(214,87)=1;LW(214,88)=1;LW(214,89)=1;LW(214,90)=1;LW(214,91)=1;LW(214,92)=1;LW(214,94)=1;LW(214,95)=1;
    LW(214,96)=1;LW(214,97)=1;LW(214,98)=1;LW(214,99)=1;LW(214,100)=1;LW(214,101)=1;LW(214,102)=1;LW(214,103)=1;LW(214,104)=1;LW(214,105)=1;
    LW(214,106)=1;LW(214,108)=1;LW(214,109)=1;LW(214,110)=1;LW(214,111)=1;LW(214,112)=1;LW(214,116)=1;LW(214,117)=1;LW(214,118)=1;LW(214,119)=1;
    LW(214,124)=1;LW(214,125)=1;LW(214,126)=1;LW(214,127)=1;LW(214,128)=1;LW(214,129)=1;LW(214,130)=1;LW(214,131)=1;LW(214,132)=1;LW(214,138)=1;
    LW(215,60)=1;LW(215,61)=1;LW(215,62)=1;LW(215,63)=1;LW(215,66)=1;LW(215,67)=1;LW(215,68)=1;LW(215,69)=1;LW(215,74)=1;LW(215,75)=1;
    LW(215,76)=1;LW(215,81)=1;LW(215,82)=1;LW(215,83)=1;LW(215,84)=1;LW(215,85)=1;LW(215,86)=1;LW(215,87)=1;LW(215,88)=1;LW(215,89)=1;
    LW(215,90)=1;LW(215,91)=1;LW(215,92)=1;LW(215,93)=1;LW(215,94)=1;LW(215,95)=1;LW(215,96)=1;LW(215,97)=1;LW(215,98)=1;LW(215,99)=1;
    LW(215,100)=1;LW(215,101)=1;LW(215,102)=1;LW(215,103)=1;LW(215,104)=1;LW(215,105)=1;LW(215,106)=1;LW(215,107)=1;LW(215,108)=1;LW(215,109)=1;
    LW(215,110)=1;LW(215,111)=1;LW(215,112)=1;LW(215,113)=1;LW(215,115)=1;LW(215,116)=1;LW(215,117)=1;LW(215,118)=1;LW(215,119)=1;LW(215,120)=1;
    LW(215,124)=1;LW(215,125)=1;LW(215,126)=1;LW(215,127)=1;LW(215,128)=1;LW(215,129)=1;LW(215,130)=1;LW(215,131)=1;LW(215,132)=1;LW(215,133)=1;
    LW(215,134)=1;LW(215,138)=1;LW(215,139)=1;LW(215,140)=1;LW(216,60)=1;LW(216,61)=1;LW(216,62)=1;LW(216,63)=1;LW(216,67)=1;LW(216,68)=1;
    LW(216,69)=1;LW(216,74)=1;LW(216,75)=1;LW(216,76)=1;LW(216,81)=1;LW(216,82)=1;LW(216,83)=1;LW(216,84)=1;LW(216,85)=1;LW(216,86)=1;
    LW(216,87)=1;LW(216,88)=1;LW(216,89)=1;LW(216,90)=1;LW(216,91)=1;LW(216,92)=1;LW(216,93)=1;LW(216,94)=1;LW(216,95)=1;LW(216,96)=1;
    LW(216,97)=1;LW(216,98)=1;LW(216,99)=1;LW(216,100)=1;LW(216,101)=1;LW(216,102)=1;LW(216,103)=1;LW(216,104)=1;LW(216,105)=1;LW(216,106)=1;
    LW(216,107)=1;LW(216,108)=1;LW(216,109)=1;LW(216,110)=1;LW(216,111)=1;LW(216,112)=1;LW(216,113)=1;LW(216,116)=1;LW(216,117)=1;LW(216,118)=1;
    LW(216,119)=1;LW(216,120)=1;LW(216,124)=1;LW(216,125)=1;LW(216,126)=1;LW(216,127)=1;LW(216,128)=1;LW(216,129)=1;LW(216,130)=1;LW(216,131)=1;
    LW(216,132)=1;LW(216,133)=1;LW(216,134)=1;LW(216,138)=1;LW(216,139)=1;LW(216,140)=1;LW(217,60)=1;LW(217,61)=1;LW(217,62)=1;LW(217,67)=1;
    LW(217,68)=1;LW(217,69)=1;LW(217,74)=1;LW(217,75)=1;LW(217,76)=1;LW(217,81)=1;LW(217,82)=1;LW(217,83)=1;LW(217,84)=1;LW(217,85)=1;
    LW(217,86)=1;LW(217,87)=1;LW(217,88)=1;LW(217,89)=1;LW(217,90)=1;LW(217,91)=1;LW(217,92)=1;LW(217,93)=1;LW(217,94)=1;LW(217,95)=1;
    LW(217,96)=1;LW(217,97)=1;LW(217,98)=1;LW(217,99)=1;LW(217,100)=1;LW(217,101)=1;LW(217,102)=1;LW(217,103)=1;LW(217,104)=1;LW(217,105)=1;
    LW(217,106)=1;LW(217,107)=1;LW(217,108)=1;LW(217,109)=1;LW(217,110)=1;LW(217,111)=1;LW(217,112)=1;LW(217,113)=1;LW(217,116)=1;LW(217,117)=1;
    LW(217,118)=1;LW(217,119)=1;LW(217,120)=1;LW(217,124)=1;LW(217,125)=1;LW(217,126)=1;LW(217,127)=1;LW(217,128)=1;LW(217,129)=1;LW(217,130)=1;
    LW(217,131)=1;LW(217,132)=1;LW(217,133)=1;LW(217,134)=1;LW(217,138)=1;LW(217,139)=1;LW(217,140)=1;LW(218,55)=1;LW(218,56)=1;LW(218,57)=1;
    LW(218,58)=1;LW(218,59)=1;LW(218,60)=1;LW(218,61)=1;LW(218,62)=1;LW(218,63)=1;LW(218,64)=1;LW(218,65)=1;LW(218,66)=1;LW(218,67)=1;
    LW(218,68)=1;LW(218,69)=1;LW(218,70)=1;LW(218,71)=1;LW(218,72)=1;LW(218,73)=1;LW(218,74)=1;LW(218,75)=1;LW(218,76)=1;LW(218,77)=1;
    LW(218,80)=1;LW(218,81)=1;LW(218,82)=1;LW(218,83)=1;LW(218,84)=1;LW(218,85)=1;LW(218,86)=1;LW(218,87)=1;LW(218,88)=1;LW(218,89)=1;
    LW(218,90)=1;LW(218,91)=1;LW(218,92)=1;LW(218,93)=1;LW(218,94)=1;LW(218,95)=1;LW(218,96)=1;LW(218,97)=1;LW(218,98)=1;LW(218,99)=1;
    LW(218,100)=1;LW(218,101)=1;LW(218,102)=1;LW(218,103)=1;LW(218,104)=1;LW(218,105)=1;LW(218,106)=1;LW(218,107)=1;LW(218,108)=1;LW(218,109)=1;
    LW(218,110)=1;LW(218,111)=1;LW(218,112)=1;LW(218,113)=1;LW(218,114)=1;LW(218,115)=1;LW(218,116)=1;LW(218,117)=1;LW(218,118)=1;LW(218,119)=1;
    LW(218,120)=1;LW(218,123)=1;LW(218,124)=1;LW(218,125)=1;LW(218,126)=1;LW(218,127)=1;LW(218,128)=1;LW(218,129)=1;LW(218,130)=1;LW(218,131)=1;
    LW(218,132)=1;LW(218,133)=1;LW(218,134)=1;LW(218,135)=1;LW(218,136)=1;LW(218,137)=1;LW(218,138)=1;LW(218,139)=1;LW(218,140)=1;LW(218,141)=1;
    LW(219,48)=1;LW(219,49)=1;LW(219,50)=1;LW(219,51)=1;LW(219,52)=1;LW(219,53)=1;LW(219,54)=1;LW(219,55)=1;LW(219,56)=1;LW(219,57)=1;
    LW(219,58)=1;LW(219,59)=1;LW(219,60)=1;LW(219,61)=1;LW(219,62)=1;LW(219,63)=1;LW(219,64)=1;LW(219,65)=1;LW(219,66)=1;LW(219,67)=1;
    LW(219,68)=1;LW(219,69)=1;LW(219,70)=1;LW(219,71)=1;LW(219,72)=1;LW(219,73)=1;LW(219,74)=1;LW(219,75)=1;LW(219,76)=1;LW(219,77)=1;
    LW(219,78)=1;LW(219,79)=1;LW(219,80)=1;LW(219,81)=1;LW(219,82)=1;LW(219,83)=1;LW(219,84)=1;LW(219,85)=1;LW(219,86)=1;LW(219,87)=1;
    LW(219,88)=1;LW(219,89)=1;LW(219,90)=1;LW(219,91)=1;LW(219,92)=1;LW(219,93)=1;LW(219,94)=1;LW(219,95)=1;LW(219,96)=1;LW(219,97)=1;
    LW(219,98)=1;LW(219,99)=1;LW(219,100)=1;LW(219,101)=1;LW(219,102)=1;LW(219,103)=1;LW(219,104)=1;LW(219,105)=1;LW(219,106)=1;LW(219,107)=1;
    LW(219,108)=1;LW(219,109)=1;LW(219,110)=1;LW(219,111)=1;LW(219,112)=1;LW(219,113)=1;LW(219,114)=1;LW(219,115)=1;LW(219,116)=1;LW(219,117)=1;
    LW(219,118)=1;LW(219,119)=1;LW(219,120)=1;LW(219,121)=1;LW(219,122)=1;LW(219,123)=1;LW(219,124)=1;LW(219,125)=1;LW(219,126)=1;LW(219,127)=1;
    LW(219,128)=1;LW(219,129)=1;LW(219,130)=1;LW(219,131)=1;LW(219,132)=1;LW(219,133)=1;LW(219,134)=1;LW(219,135)=1;LW(219,136)=1;LW(219,137)=1;
    LW(219,138)=1;LW(219,139)=1;LW(219,140)=1;LW(219,141)=1;LW(219,142)=1;LW(219,143)=1;LW(219,144)=1;LW(219,145)=1;LW(219,146)=1;LW(219,150)=1;
    LW(219,164)=1;LW(219,165)=1;LW(219,171)=1;LW(219,172)=1;LW(219,173)=1;LW(220,47)=1;LW(220,48)=1;LW(220,49)=1;LW(220,50)=1;LW(220,51)=1;
    LW(220,52)=1;LW(220,53)=1;LW(220,54)=1;LW(220,55)=1;LW(220,56)=1;LW(220,57)=1;LW(220,58)=1;LW(220,59)=1;LW(220,60)=1;LW(220,61)=1;
    LW(220,62)=1;LW(220,63)=1;LW(220,64)=1;LW(220,65)=1;LW(220,66)=1;LW(220,67)=1;LW(220,68)=1;LW(220,69)=1;LW(220,70)=1;LW(220,71)=1;
    LW(220,72)=1;LW(220,73)=1;LW(220,74)=1;LW(220,75)=1;LW(220,76)=1;LW(220,77)=1;LW(220,78)=1;LW(220,79)=1;LW(220,80)=1;LW(220,81)=1;
    LW(220,82)=1;LW(220,83)=1;LW(220,84)=1;LW(220,85)=1;LW(220,86)=1;LW(220,87)=1;LW(220,88)=1;LW(220,89)=1;LW(220,90)=1;LW(220,91)=1;
    LW(220,92)=1;LW(220,93)=1;LW(220,94)=1;LW(220,95)=1;LW(220,96)=1;LW(220,97)=1;LW(220,98)=1;LW(220,99)=1;LW(220,100)=1;LW(220,101)=1;
    LW(220,102)=1;LW(220,103)=1;LW(220,104)=1;LW(220,105)=1;LW(220,106)=1;LW(220,107)=1;LW(220,108)=1;LW(220,109)=1;LW(220,110)=1;LW(220,111)=1;
    LW(220,112)=1;LW(220,113)=1;LW(220,114)=1;LW(220,115)=1;LW(220,116)=1;LW(220,117)=1;LW(220,118)=1;LW(220,119)=1;LW(220,120)=1;LW(220,121)=1;
    LW(220,122)=1;LW(220,123)=1;LW(220,124)=1;LW(220,125)=1;LW(220,126)=1;LW(220,127)=1;LW(220,128)=1;LW(220,129)=1;LW(220,130)=1;LW(220,131)=1;
    LW(220,132)=1;LW(220,133)=1;LW(220,134)=1;LW(220,135)=1;LW(220,136)=1;LW(220,137)=1;LW(220,138)=1;LW(220,139)=1;LW(220,140)=1;LW(220,141)=1;
    LW(220,142)=1;LW(220,143)=1;LW(220,144)=1;LW(220,145)=1;LW(220,146)=1;LW(220,147)=1;LW(220,148)=1;LW(220,149)=1;LW(220,150)=1;LW(220,151)=1;
    LW(220,152)=1;LW(220,153)=1;LW(220,154)=1;LW(220,155)=1;LW(220,156)=1;LW(220,157)=1;LW(220,158)=1;LW(220,159)=1;LW(220,160)=1;LW(220,161)=1;
    LW(220,162)=1;LW(220,163)=1;LW(220,164)=1;LW(220,165)=1;LW(220,166)=1;LW(220,167)=1;LW(220,168)=1;LW(220,169)=1;LW(220,170)=1;LW(220,171)=1;
    LW(220,172)=1;LW(220,173)=1;LW(220,174)=1;LW(220,176)=1;LW(220,177)=1;LW(220,178)=1;LW(220,179)=1;LW(220,180)=1;LW(220,181)=1;LW(220,184)=1;
    LW(220,185)=1;LW(220,186)=1;LW(221,41)=1;LW(221,42)=1;LW(221,43)=1;LW(221,44)=1;LW(221,45)=1;LW(221,46)=1;LW(221,47)=1;LW(221,48)=1;
    LW(221,49)=1;LW(221,50)=1;LW(221,51)=1;LW(221,52)=1;LW(221,53)=1;LW(221,54)=1;LW(221,55)=1;LW(221,56)=1;LW(221,57)=1;LW(221,58)=1;
    LW(221,59)=1;LW(221,60)=1;LW(221,61)=1;LW(221,62)=1;LW(221,63)=1;LW(221,64)=1;LW(221,65)=1;LW(221,66)=1;LW(221,67)=1;LW(221,68)=1;
    LW(221,69)=1;LW(221,70)=1;LW(221,71)=1;LW(221,72)=1;LW(221,73)=1;LW(221,74)=1;LW(221,75)=1;LW(221,76)=1;LW(221,77)=1;LW(221,78)=1;
    LW(221,79)=1;LW(221,80)=1;LW(221,81)=1;LW(221,82)=1;LW(221,83)=1;LW(221,84)=1;LW(221,85)=1;LW(221,86)=1;LW(221,87)=1;LW(221,88)=1;
    LW(221,89)=1;LW(221,90)=1;LW(221,91)=1;LW(221,92)=1;LW(221,93)=1;LW(221,94)=1;LW(221,95)=1;LW(221,96)=1;LW(221,97)=1;LW(221,98)=1;
    LW(221,99)=1;LW(221,100)=1;LW(221,101)=1;LW(221,102)=1;LW(221,103)=1;LW(221,104)=1;LW(221,105)=1;LW(221,106)=1;LW(221,107)=1;LW(221,108)=1;
    LW(221,109)=1;LW(221,110)=1;LW(221,111)=1;LW(221,112)=1;LW(221,113)=1;LW(221,114)=1;LW(221,115)=1;LW(221,116)=1;LW(221,117)=1;LW(221,118)=1;
    LW(221,119)=1;LW(221,120)=1;LW(221,121)=1;LW(221,122)=1;LW(221,123)=1;LW(221,124)=1;LW(221,125)=1;LW(221,126)=1;LW(221,127)=1;LW(221,128)=1;
    LW(221,129)=1;LW(221,130)=1;LW(221,131)=1;LW(221,132)=1;LW(221,133)=1;LW(221,134)=1;LW(221,135)=1;LW(221,136)=1;LW(221,137)=1;LW(221,138)=1;
    LW(221,139)=1;LW(221,140)=1;LW(221,141)=1;LW(221,142)=1;LW(221,143)=1;LW(221,144)=1;LW(221,145)=1;LW(221,146)=1;LW(221,147)=1;LW(221,148)=1;
    LW(221,149)=1;LW(221,150)=1;LW(221,151)=1;LW(221,152)=1;LW(221,153)=1;LW(221,154)=1;LW(221,155)=1;LW(221,156)=1;LW(221,157)=1;LW(221,158)=1;
    LW(221,159)=1;LW(221,160)=1;LW(221,161)=1;LW(221,162)=1;LW(221,163)=1;LW(221,164)=1;LW(221,165)=1;LW(221,166)=1;LW(221,167)=1;LW(221,168)=1;
    LW(221,169)=1;LW(221,170)=1;LW(221,171)=1;LW(221,172)=1;LW(221,173)=1;LW(221,174)=1;LW(221,175)=1;LW(221,176)=1;LW(221,177)=1;LW(221,178)=1;
    LW(221,179)=1;LW(221,180)=1;LW(221,181)=1;LW(221,182)=1;LW(221,183)=1;LW(221,184)=1;LW(221,185)=1;LW(221,186)=1;LW(221,187)=1;LW(221,188)=1;
    LW(221,191)=1;LW(221,192)=1;LW(221,193)=1;LW(221,194)=1;LW(221,195)=1;LW(221,200)=1;LW(221,201)=1;LW(222,20)=1;LW(222,21)=1;LW(222,22)=1;
    LW(222,27)=1;LW(222,28)=1;LW(222,29)=1;LW(222,30)=1;LW(222,34)=1;LW(222,35)=1;LW(222,36)=1;LW(222,37)=1;LW(222,38)=1;LW(222,39)=1;
    LW(222,40)=1;LW(222,41)=1;LW(222,42)=1;LW(222,43)=1;LW(222,44)=1;LW(222,45)=1;LW(222,46)=1;LW(222,47)=1;LW(222,48)=1;LW(222,49)=1;
    LW(222,50)=1;LW(222,51)=1;LW(222,52)=1;LW(222,53)=1;LW(222,54)=1;LW(222,55)=1;LW(222,56)=1;LW(222,57)=1;LW(222,58)=1;LW(222,59)=1;
    LW(222,60)=1;LW(222,61)=1;LW(222,62)=1;LW(222,63)=1;LW(222,64)=1;LW(222,65)=1;LW(222,66)=1;LW(222,67)=1;LW(222,68)=1;LW(222,69)=1;
    LW(222,70)=1;LW(222,71)=1;LW(222,72)=1;LW(222,73)=1;LW(222,74)=1;LW(222,75)=1;LW(222,76)=1;LW(222,77)=1;LW(222,78)=1;LW(222,79)=1;
    LW(222,80)=1;LW(222,81)=1;LW(222,82)=1;LW(222,83)=1;LW(222,84)=1;LW(222,85)=1;LW(222,86)=1;LW(222,87)=1;LW(222,88)=1;LW(222,89)=1;
    LW(222,90)=1;LW(222,91)=1;LW(222,92)=1;LW(222,93)=1;LW(222,94)=1;LW(222,95)=1;LW(222,96)=1;LW(222,97)=1;LW(222,98)=1;LW(222,99)=1;
    LW(222,100)=1;LW(222,101)=1;LW(222,102)=1;LW(222,103)=1;LW(222,104)=1;LW(222,105)=1;LW(222,106)=1;LW(222,107)=1;LW(222,108)=1;LW(222,109)=1;
    LW(222,110)=1;LW(222,111)=1;LW(222,112)=1;LW(222,113)=1;LW(222,114)=1;LW(222,115)=1;LW(222,116)=1;LW(222,117)=1;LW(222,118)=1;LW(222,119)=1;
    LW(222,120)=1;LW(222,121)=1;LW(222,122)=1;LW(222,123)=1;LW(222,124)=1;LW(222,125)=1;LW(222,126)=1;LW(222,127)=1;LW(222,128)=1;LW(222,129)=1;
    LW(222,130)=1;LW(222,131)=1;LW(222,132)=1;LW(222,133)=1;LW(222,134)=1;LW(222,135)=1;LW(222,136)=1;LW(222,137)=1;LW(222,138)=1;LW(222,139)=1;
    LW(222,140)=1;LW(222,141)=1;LW(222,142)=1;LW(222,143)=1;LW(222,144)=1;LW(222,145)=1;LW(222,146)=1;LW(222,147)=1;LW(222,148)=1;LW(222,149)=1;
    LW(222,150)=1;LW(222,151)=1;LW(222,152)=1;LW(222,153)=1;LW(222,154)=1;LW(222,155)=1;LW(222,156)=1;LW(222,157)=1;LW(222,158)=1;LW(222,159)=1;
    LW(222,160)=1;LW(222,161)=1;LW(222,162)=1;LW(222,163)=1;LW(222,164)=1;LW(222,165)=1;LW(222,166)=1;LW(222,167)=1;LW(222,168)=1;LW(222,169)=1;
    LW(222,170)=1;LW(222,171)=1;LW(222,172)=1;LW(222,173)=1;LW(222,174)=1;LW(222,175)=1;LW(222,176)=1;LW(222,177)=1;LW(222,178)=1;LW(222,179)=1;
    LW(222,180)=1;LW(222,181)=1;LW(222,182)=1;LW(222,183)=1;LW(222,184)=1;LW(222,185)=1;LW(222,186)=1;LW(222,187)=1;LW(222,188)=1;LW(222,189)=1;
    LW(222,190)=1;LW(222,191)=1;LW(222,192)=1;LW(222,193)=1;LW(222,194)=1;LW(222,195)=1;LW(222,196)=1;LW(222,197)=1;LW(222,198)=1;LW(222,199)=1;
    LW(222,200)=1;LW(222,201)=1;LW(222,202)=1;LW(222,203)=1;LW(222,204)=1;LW(222,205)=1;LW(222,206)=1;LW(222,207)=1;LW(222,208)=1;LW(222,209)=1;
    LW(222,210)=1;LW(222,212)=1;LW(222,213)=1;LW(222,214)=1;LW(223,15)=1;LW(223,18)=1;LW(223,19)=1;LW(223,20)=1;LW(223,21)=1;LW(223,22)=1;
    LW(223,23)=1;LW(223,24)=1;LW(223,25)=1;LW(223,26)=1;LW(223,27)=1;LW(223,28)=1;LW(223,29)=1;LW(223,30)=1;LW(223,31)=1;LW(223,32)=1;
    LW(223,33)=1;LW(223,34)=1;LW(223,35)=1;LW(223,36)=1;LW(223,37)=1;LW(223,38)=1;LW(223,39)=1;LW(223,40)=1;LW(223,41)=1;LW(223,42)=1;
    LW(223,43)=1;LW(223,44)=1;LW(223,45)=1;LW(223,46)=1;LW(223,47)=1;LW(223,48)=1;LW(223,49)=1;LW(223,50)=1;LW(223,51)=1;LW(223,52)=1;
    LW(223,53)=1;LW(223,54)=1;LW(223,55)=1;LW(223,56)=1;LW(223,57)=1;LW(223,58)=1;LW(223,59)=1;LW(223,60)=1;LW(223,61)=1;LW(223,62)=1;
    LW(223,63)=1;LW(223,64)=1;LW(223,65)=1;LW(223,66)=1;LW(223,67)=1;LW(223,68)=1;LW(223,69)=1;LW(223,70)=1;LW(223,71)=1;LW(223,72)=1;
    LW(223,73)=1;LW(223,74)=1;LW(223,75)=1;LW(223,76)=1;LW(223,77)=1;LW(223,78)=1;LW(223,79)=1;LW(223,80)=1;LW(223,81)=1;LW(223,82)=1;
    LW(223,83)=1;LW(223,84)=1;LW(223,85)=1;LW(223,86)=1;LW(223,87)=1;LW(223,88)=1;LW(223,89)=1;LW(223,90)=1;LW(223,91)=1;LW(223,92)=1;
    LW(223,93)=1;LW(223,94)=1;LW(223,95)=1;LW(223,96)=1;LW(223,97)=1;LW(223,98)=1;LW(223,99)=1;LW(223,100)=1;LW(223,101)=1;LW(223,102)=1;
    LW(223,103)=1;LW(223,104)=1;LW(223,105)=1;LW(223,106)=1;LW(223,107)=1;LW(223,108)=1;LW(223,109)=1;LW(223,110)=1;LW(223,111)=1;LW(223,112)=1;
    LW(223,113)=1;LW(223,114)=1;LW(223,115)=1;LW(223,116)=1;LW(223,117)=1;LW(223,118)=1;LW(223,119)=1;LW(223,120)=1;LW(223,121)=1;LW(223,122)=1;
    LW(223,123)=1;LW(223,124)=1;LW(223,125)=1;LW(223,126)=1;LW(223,127)=1;LW(223,128)=1;LW(223,129)=1;LW(223,130)=1;LW(223,131)=1;LW(223,132)=1;
    LW(223,133)=1;LW(223,134)=1;LW(223,135)=1;LW(223,136)=1;LW(223,137)=1;LW(223,138)=1;LW(223,139)=1;LW(223,140)=1;LW(223,141)=1;LW(223,142)=1;
    LW(223,143)=1;LW(223,144)=1;LW(223,145)=1;LW(223,146)=1;LW(223,147)=1;LW(223,148)=1;LW(223,149)=1;LW(223,150)=1;LW(223,151)=1;LW(223,152)=1;
    LW(223,153)=1;LW(223,154)=1;LW(223,155)=1;LW(223,156)=1;LW(223,157)=1;LW(223,158)=1;LW(223,159)=1;LW(223,160)=1;LW(223,161)=1;LW(223,162)=1;
    LW(223,163)=1;LW(223,164)=1;LW(223,165)=1;LW(223,166)=1;LW(223,167)=1;LW(223,168)=1;LW(223,169)=1;LW(223,170)=1;LW(223,171)=1;LW(223,172)=1;
    LW(223,173)=1;LW(223,174)=1;LW(223,175)=1;LW(223,176)=1;LW(223,177)=1;LW(223,178)=1;LW(223,179)=1;LW(223,180)=1;LW(223,181)=1;LW(223,182)=1;
    LW(223,183)=1;LW(223,184)=1;LW(223,185)=1;LW(223,186)=1;LW(223,187)=1;LW(223,188)=1;LW(223,189)=1;LW(223,190)=1;LW(223,191)=1;LW(223,192)=1;
    LW(223,193)=1;LW(223,194)=1;LW(223,195)=1;LW(223,196)=1;LW(223,197)=1;LW(223,198)=1;LW(223,199)=1;LW(223,200)=1;LW(223,201)=1;LW(223,202)=1;
    LW(223,203)=1;LW(223,204)=1;LW(223,205)=1;LW(223,206)=1;LW(223,207)=1;LW(223,208)=1;LW(223,209)=1;LW(223,210)=1;LW(223,211)=1;LW(223,212)=1;
    LW(223,213)=1;LW(223,214)=1;LW(223,215)=1;LW(224,13)=1;LW(224,14)=1;LW(224,15)=1;LW(224,16)=1;LW(224,17)=1;LW(224,18)=1;LW(224,19)=1;
    LW(224,20)=1;LW(224,21)=1;LW(224,22)=1;LW(224,23)=1;LW(224,24)=1;LW(224,25)=1;LW(224,26)=1;LW(224,27)=1;LW(224,28)=1;LW(224,29)=1;
    LW(224,30)=1;LW(224,31)=1;LW(224,32)=1;LW(224,33)=1;LW(224,34)=1;LW(224,35)=1;LW(224,36)=1;LW(224,37)=1;LW(224,38)=1;LW(224,39)=1;
    LW(224,40)=1;LW(224,41)=1;LW(224,42)=1;LW(224,43)=1;LW(224,44)=1;LW(224,45)=1;LW(224,46)=1;LW(224,47)=1;LW(224,48)=1;LW(224,49)=1;
    LW(224,50)=1;LW(224,51)=1;LW(224,52)=1;LW(224,53)=1;LW(224,54)=1;LW(224,55)=1;LW(224,56)=1;LW(224,57)=1;LW(224,58)=1;LW(224,59)=1;
    LW(224,60)=1;LW(224,61)=1;LW(224,62)=1;LW(224,63)=1;LW(224,64)=1;LW(224,65)=1;LW(224,66)=1;LW(224,67)=1;LW(224,68)=1;LW(224,69)=1;
    LW(224,70)=1;LW(224,71)=1;LW(224,72)=1;LW(224,73)=1;LW(224,74)=1;LW(224,75)=1;LW(224,76)=1;LW(224,77)=1;LW(224,78)=1;LW(224,79)=1;
    LW(224,80)=1;LW(224,81)=1;LW(224,82)=1;LW(224,83)=1;LW(224,84)=1;LW(224,85)=1;LW(224,86)=1;LW(224,87)=1;LW(224,88)=1;LW(224,89)=1;
    LW(224,90)=1;LW(224,91)=1;LW(224,92)=1;LW(224,93)=1;LW(224,94)=1;LW(224,95)=1;LW(224,96)=1;LW(224,97)=1;LW(224,98)=1;LW(224,99)=1;
    LW(224,100)=1;LW(224,101)=1;LW(224,102)=1;LW(224,103)=1;LW(224,104)=1;LW(224,105)=1;LW(224,106)=1;LW(224,107)=1;LW(224,108)=1;LW(224,109)=1;
    LW(224,110)=1;LW(224,111)=1;LW(224,112)=1;LW(224,113)=1;LW(224,114)=1;LW(224,115)=1;LW(224,116)=1;LW(224,117)=1;LW(224,118)=1;LW(224,119)=1;
    LW(224,120)=1;LW(224,121)=1;LW(224,122)=1;LW(224,123)=1;LW(224,124)=1;LW(224,125)=1;LW(224,126)=1;LW(224,127)=1;LW(224,128)=1;LW(224,129)=1;
    LW(224,130)=1;LW(224,131)=1;LW(224,132)=1;LW(224,133)=1;LW(224,134)=1;LW(224,135)=1;LW(224,136)=1;LW(224,137)=1;LW(224,138)=1;LW(224,139)=1;
    LW(224,140)=1;LW(224,141)=1;LW(224,142)=1;LW(224,143)=1;LW(224,144)=1;LW(224,145)=1;LW(224,146)=1;LW(224,147)=1;LW(224,148)=1;LW(224,149)=1;
    LW(224,150)=1;LW(224,151)=1;LW(224,152)=1;LW(224,153)=1;LW(224,154)=1;LW(224,155)=1;LW(224,156)=1;LW(224,157)=1;LW(224,158)=1;LW(224,159)=1;
    LW(224,160)=1;LW(224,161)=1;LW(224,162)=1;LW(224,163)=1;LW(224,164)=1;LW(224,165)=1;LW(224,166)=1;LW(224,167)=1;LW(224,168)=1;LW(224,169)=1;
    LW(224,170)=1;LW(224,171)=1;LW(224,172)=1;LW(224,173)=1;LW(224,174)=1;LW(224,175)=1;LW(224,176)=1;LW(224,177)=1;LW(224,178)=1;LW(224,179)=1;
    LW(224,180)=1;LW(224,181)=1;LW(224,182)=1;LW(224,183)=1;LW(224,184)=1;LW(224,185)=1;LW(224,186)=1;LW(224,187)=1;LW(224,188)=1;LW(224,189)=1;
    LW(224,190)=1;LW(224,191)=1;LW(224,192)=1;LW(224,193)=1;LW(224,194)=1;LW(224,195)=1;LW(224,196)=1;LW(224,197)=1;LW(224,198)=1;LW(224,199)=1;
    LW(224,200)=1;LW(224,201)=1;LW(224,202)=1;LW(224,203)=1;LW(224,204)=1;LW(224,205)=1;LW(224,206)=1;LW(224,207)=1;LW(224,208)=1;LW(224,209)=1;
    LW(224,210)=1;LW(224,211)=1;LW(224,212)=1;LW(224,213)=1;LW(224,214)=1;LW(224,215)=1;LW(224,216)=1;LW(224,220)=1;LW(224,221)=1;LW(224,222)=1;
    LW(225,6)=1;LW(225,7)=1;LW(225,8)=1;LW(225,12)=1;LW(225,13)=1;LW(225,14)=1;LW(225,15)=1;LW(225,16)=1;LW(225,17)=1;LW(225,18)=1;
    LW(225,19)=1;LW(225,20)=1;LW(225,21)=1;LW(225,22)=1;LW(225,23)=1;LW(225,24)=1;LW(225,25)=1;LW(225,26)=1;LW(225,27)=1;LW(225,28)=1;
    LW(225,29)=1;LW(225,30)=1;LW(225,31)=1;LW(225,32)=1;LW(225,33)=1;LW(225,34)=1;LW(225,35)=1;LW(225,36)=1;LW(225,37)=1;LW(225,38)=1;
    LW(225,39)=1;LW(225,40)=1;LW(225,41)=1;LW(225,42)=1;LW(225,43)=1;LW(225,44)=1;LW(225,45)=1;LW(225,46)=1;LW(225,47)=1;LW(225,48)=1;
    LW(225,49)=1;LW(225,50)=1;LW(225,51)=1;LW(225,52)=1;LW(225,53)=1;LW(225,54)=1;LW(225,55)=1;LW(225,56)=1;LW(225,57)=1;LW(225,58)=1;
    LW(225,59)=1;LW(225,60)=1;LW(225,61)=1;LW(225,62)=1;LW(225,63)=1;LW(225,64)=1;LW(225,65)=1;LW(225,66)=1;LW(225,67)=1;LW(225,68)=1;
    LW(225,69)=1;LW(225,70)=1;LW(225,71)=1;LW(225,72)=1;LW(225,73)=1;LW(225,74)=1;LW(225,75)=1;LW(225,76)=1;LW(225,77)=1;LW(225,78)=1;
    LW(225,79)=1;LW(225,80)=1;LW(225,81)=1;LW(225,82)=1;LW(225,83)=1;LW(225,84)=1;LW(225,85)=1;LW(225,86)=1;LW(225,87)=1;LW(225,88)=1;
    LW(225,89)=1;LW(225,90)=1;LW(225,91)=1;LW(225,92)=1;LW(225,93)=1;LW(225,94)=1;LW(225,95)=1;LW(225,96)=1;LW(225,97)=1;LW(225,98)=1;
    LW(225,99)=1;LW(225,100)=1;LW(225,101)=1;LW(225,102)=1;LW(225,103)=1;LW(225,104)=1;LW(225,105)=1;LW(225,106)=1;LW(225,107)=1;LW(225,108)=1;
    LW(225,109)=1;LW(225,110)=1;LW(225,111)=1;LW(225,112)=1;LW(225,113)=1;LW(225,114)=1;LW(225,115)=1;LW(225,116)=1;LW(225,117)=1;LW(225,118)=1;
    LW(225,119)=1;LW(225,120)=1;LW(225,121)=1;LW(225,122)=1;LW(225,123)=1;LW(225,124)=1;LW(225,125)=1;LW(225,126)=1;LW(225,127)=1;LW(225,128)=1;
    LW(225,129)=1;LW(225,130)=1;LW(225,131)=1;LW(225,132)=1;LW(225,133)=1;LW(225,134)=1;LW(225,135)=1;LW(225,136)=1;LW(225,137)=1;LW(225,138)=1;
    LW(225,139)=1;LW(225,140)=1;LW(225,141)=1;LW(225,142)=1;LW(225,143)=1;LW(225,144)=1;LW(225,145)=1;LW(225,146)=1;LW(225,147)=1;LW(225,148)=1;
    LW(225,149)=1;LW(225,150)=1;LW(225,151)=1;LW(225,152)=1;LW(225,153)=1;LW(225,154)=1;LW(225,155)=1;LW(225,156)=1;LW(225,157)=1;LW(225,158)=1;
    LW(225,159)=1;LW(225,160)=1;LW(225,161)=1;LW(225,162)=1;LW(225,163)=1;LW(225,164)=1;LW(225,165)=1;LW(225,166)=1;LW(225,167)=1;LW(225,168)=1;
    LW(225,169)=1;LW(225,170)=1;LW(225,171)=1;LW(225,172)=1;LW(225,173)=1;LW(225,174)=1;LW(225,175)=1;LW(225,176)=1;LW(225,177)=1;LW(225,178)=1;
    LW(225,179)=1;LW(225,180)=1;LW(225,181)=1;LW(225,182)=1;LW(225,183)=1;LW(225,184)=1;LW(225,185)=1;LW(225,186)=1;LW(225,187)=1;LW(225,188)=1;
    LW(225,189)=1;LW(225,190)=1;LW(225,191)=1;LW(225,192)=1;LW(225,193)=1;LW(225,194)=1;LW(225,195)=1;LW(225,196)=1;LW(225,197)=1;LW(225,198)=1;
    LW(225,199)=1;LW(225,200)=1;LW(225,201)=1;LW(225,202)=1;LW(225,203)=1;LW(225,204)=1;LW(225,205)=1;LW(225,206)=1;LW(225,207)=1;LW(225,208)=1;
    LW(225,209)=1;LW(225,210)=1;LW(225,211)=1;LW(225,212)=1;LW(225,213)=1;LW(225,214)=1;LW(225,215)=1;LW(225,216)=1;LW(225,217)=1;LW(225,219)=1;
    LW(225,220)=1;LW(225,221)=1;LW(225,222)=1;LW(226,5)=1;LW(226,6)=1;LW(226,7)=1;LW(226,8)=1;LW(226,9)=1;LW(226,10)=1;LW(226,11)=1;
    LW(226,12)=1;LW(226,13)=1;LW(226,14)=1;LW(226,15)=1;LW(226,16)=1;LW(226,17)=1;LW(226,18)=1;LW(226,19)=1;LW(226,20)=1;LW(226,21)=1;
    LW(226,22)=1;LW(226,23)=1;LW(226,24)=1;LW(226,25)=1;LW(226,26)=1;LW(226,27)=1;LW(226,28)=1;LW(226,29)=1;LW(226,30)=1;LW(226,31)=1;
    LW(226,32)=1;LW(226,33)=1;LW(226,34)=1;LW(226,35)=1;LW(226,36)=1;LW(226,37)=1;LW(226,38)=1;LW(226,39)=1;LW(226,40)=1;LW(226,41)=1;
    LW(226,42)=1;LW(226,43)=1;LW(226,44)=1;LW(226,45)=1;LW(226,46)=1;LW(226,47)=1;LW(226,48)=1;LW(226,49)=1;LW(226,50)=1;LW(226,51)=1;
    LW(226,52)=1;LW(226,53)=1;LW(226,54)=1;LW(226,55)=1;LW(226,56)=1;LW(226,57)=1;LW(226,58)=1;LW(226,59)=1;LW(226,60)=1;LW(226,61)=1;
    LW(226,62)=1;LW(226,63)=1;LW(226,64)=1;LW(226,65)=1;LW(226,66)=1;LW(226,67)=1;LW(226,68)=1;LW(226,69)=1;LW(226,70)=1;LW(226,71)=1;
    LW(226,72)=1;LW(226,73)=1;LW(226,74)=1;LW(226,75)=1;LW(226,76)=1;LW(226,77)=1;LW(226,78)=1;LW(226,79)=1;LW(226,80)=1;LW(226,81)=1;
    LW(226,82)=1;LW(226,83)=1;LW(226,84)=1;LW(226,85)=1;LW(226,86)=1;LW(226,87)=1;LW(226,88)=1;LW(226,89)=1;LW(226,90)=1;LW(226,91)=1;
    LW(226,92)=1;LW(226,93)=1;LW(226,94)=1;LW(226,95)=1;LW(226,96)=1;LW(226,97)=1;LW(226,98)=1;LW(226,99)=1;LW(226,100)=1;LW(226,101)=1;
    LW(226,102)=1;LW(226,103)=1;LW(226,104)=1;LW(226,105)=1;LW(226,106)=1;LW(226,107)=1;LW(226,108)=1;LW(226,109)=1;LW(226,110)=1;LW(226,111)=1;
    LW(226,112)=1;LW(226,113)=1;LW(226,114)=1;LW(226,115)=1;LW(226,116)=1;LW(226,117)=1;LW(226,118)=1;LW(226,119)=1;LW(226,120)=1;LW(226,121)=1;
    LW(226,122)=1;LW(226,123)=1;LW(226,124)=1;LW(226,125)=1;LW(226,126)=1;LW(226,127)=1;LW(226,128)=1;LW(226,129)=1;LW(226,130)=1;LW(226,131)=1;
    LW(226,132)=1;LW(226,133)=1;LW(226,134)=1;LW(226,135)=1;LW(226,136)=1;LW(226,137)=1;LW(226,138)=1;LW(226,139)=1;LW(226,140)=1;LW(226,141)=1;
    LW(226,142)=1;LW(226,143)=1;LW(226,144)=1;LW(226,145)=1;LW(226,146)=1;LW(226,147)=1;LW(226,148)=1;LW(226,149)=1;LW(226,150)=1;LW(226,151)=1;
    LW(226,152)=1;LW(226,153)=1;LW(226,154)=1;LW(226,155)=1;LW(226,156)=1;LW(226,157)=1;LW(226,158)=1;LW(226,159)=1;LW(226,160)=1;LW(226,161)=1;
    LW(226,162)=1;LW(226,163)=1;LW(226,164)=1;LW(226,165)=1;LW(226,166)=1;LW(226,167)=1;LW(226,168)=1;LW(226,169)=1;LW(226,170)=1;LW(226,171)=1;
    LW(226,172)=1;LW(226,173)=1;LW(226,174)=1;LW(226,175)=1;LW(226,176)=1;LW(226,177)=1;LW(226,178)=1;LW(226,179)=1;LW(226,180)=1;LW(226,181)=1;
    LW(226,182)=1;LW(226,183)=1;LW(226,184)=1;LW(226,185)=1;LW(226,186)=1;LW(226,187)=1;LW(226,188)=1;LW(226,189)=1;LW(226,190)=1;LW(226,191)=1;
    LW(226,192)=1;LW(226,193)=1;LW(226,194)=1;LW(226,195)=1;LW(226,196)=1;LW(226,197)=1;LW(226,198)=1;LW(226,199)=1;LW(226,200)=1;LW(226,201)=1;
    LW(226,202)=1;LW(226,203)=1;LW(226,204)=1;LW(226,205)=1;LW(226,206)=1;LW(226,207)=1;LW(226,208)=1;LW(226,209)=1;LW(226,210)=1;LW(226,211)=1;
    LW(226,212)=1;LW(226,213)=1;LW(226,214)=1;LW(226,215)=1;LW(226,216)=1;LW(226,217)=1;LW(226,218)=1;LW(226,219)=1;LW(226,220)=1;LW(226,221)=1;
    LW(226,222)=1;LW(226,223)=1;LW(227,4)=1;LW(227,5)=1;LW(227,6)=1;LW(227,7)=1;LW(227,8)=1;LW(227,9)=1;LW(227,10)=1;LW(227,11)=1;
    LW(227,12)=1;LW(227,13)=1;LW(227,14)=1;LW(227,15)=1;LW(227,16)=1;LW(227,17)=1;LW(227,18)=1;LW(227,19)=1;LW(227,20)=1;LW(227,21)=1;
    LW(227,22)=1;LW(227,23)=1;LW(227,24)=1;LW(227,25)=1;LW(227,26)=1;LW(227,27)=1;LW(227,28)=1;LW(227,29)=1;LW(227,30)=1;LW(227,31)=1;
    LW(227,32)=1;LW(227,33)=1;LW(227,34)=1;LW(227,35)=1;LW(227,36)=1;LW(227,37)=1;LW(227,38)=1;LW(227,39)=1;LW(227,40)=1;LW(227,41)=1;
    LW(227,42)=1;LW(227,43)=1;LW(227,44)=1;LW(227,45)=1;LW(227,46)=1;LW(227,47)=1;LW(227,48)=1;LW(227,49)=1;LW(227,50)=1;LW(227,51)=1;
    LW(227,52)=1;LW(227,53)=1;LW(227,54)=1;LW(227,55)=1;LW(227,56)=1;LW(227,57)=1;LW(227,58)=1;LW(227,59)=1;LW(227,60)=1;LW(227,61)=1;
    LW(227,62)=1;LW(227,63)=1;LW(227,64)=1;LW(227,65)=1;LW(227,66)=1;LW(227,67)=1;LW(227,68)=1;LW(227,69)=1;LW(227,70)=1;LW(227,71)=1;
    LW(227,72)=1;LW(227,73)=1;LW(227,74)=1;LW(227,75)=1;LW(227,76)=1;LW(227,77)=1;LW(227,78)=1;LW(227,79)=1;LW(227,80)=1;LW(227,81)=1;
    LW(227,82)=1;LW(227,83)=1;LW(227,84)=1;LW(227,85)=1;LW(227,86)=1;LW(227,87)=1;LW(227,88)=1;LW(227,89)=1;LW(227,90)=1;LW(227,91)=1;
    LW(227,92)=1;LW(227,93)=1;LW(227,94)=1;LW(227,95)=1;LW(227,96)=1;LW(227,97)=1;LW(227,98)=1;LW(227,99)=1;LW(227,100)=1;LW(227,101)=1;
    LW(227,102)=1;LW(227,103)=1;LW(227,104)=1;LW(227,105)=1;LW(227,106)=1;LW(227,107)=1;LW(227,108)=1;LW(227,109)=1;LW(227,110)=1;LW(227,111)=1;
    LW(227,112)=1;LW(227,113)=1;LW(227,114)=1;LW(227,115)=1;LW(227,116)=1;LW(227,117)=1;LW(227,118)=1;LW(227,119)=1;LW(227,120)=1;LW(227,121)=1;
    LW(227,122)=1;LW(227,123)=1;LW(227,124)=1;LW(227,125)=1;LW(227,126)=1;LW(227,127)=1;LW(227,128)=1;LW(227,129)=1;LW(227,130)=1;LW(227,131)=1;
    LW(227,132)=1;LW(227,133)=1;LW(227,134)=1;LW(227,135)=1;LW(227,136)=1;LW(227,137)=1;LW(227,138)=1;LW(227,139)=1;LW(227,140)=1;LW(227,141)=1;
    LW(227,142)=1;LW(227,143)=1;LW(227,144)=1;LW(227,145)=1;LW(227,146)=1;LW(227,147)=1;LW(227,148)=1;LW(227,149)=1;LW(227,150)=1;LW(227,151)=1;
    LW(227,152)=1;LW(227,153)=1;LW(227,154)=1;LW(227,155)=1;LW(227,156)=1;LW(227,157)=1;LW(227,158)=1;LW(227,159)=1;LW(227,160)=1;LW(227,161)=1;
    LW(227,162)=1;LW(227,163)=1;LW(227,164)=1;LW(227,165)=1;LW(227,166)=1;LW(227,167)=1;LW(227,168)=1;LW(227,169)=1;LW(227,170)=1;LW(227,171)=1;
    LW(227,172)=1;LW(227,173)=1;LW(227,174)=1;LW(227,175)=1;LW(227,176)=1;LW(227,177)=1;LW(227,178)=1;LW(227,179)=1;LW(227,180)=1;LW(227,181)=1;
    LW(227,182)=1;LW(227,183)=1;LW(227,184)=1;LW(227,185)=1;LW(227,186)=1;LW(227,187)=1;LW(227,188)=1;LW(227,189)=1;LW(227,190)=1;LW(227,191)=1;
    LW(227,192)=1;LW(227,193)=1;LW(227,194)=1;LW(227,195)=1;LW(227,196)=1;LW(227,197)=1;LW(227,198)=1;LW(227,199)=1;LW(227,200)=1;LW(227,201)=1;
    LW(227,202)=1;LW(227,203)=1;LW(227,204)=1;LW(227,205)=1;LW(227,206)=1;LW(227,207)=1;LW(227,208)=1;LW(227,209)=1;LW(227,210)=1;LW(227,211)=1;
    LW(227,212)=1;LW(227,213)=1;LW(227,214)=1;LW(227,215)=1;LW(227,216)=1;LW(227,217)=1;LW(227,218)=1;LW(227,219)=1;LW(227,220)=1;LW(227,221)=1;
    LW(227,222)=1;LW(227,223)=1;LW(227,224)=1;LW(227,225)=1;LW(227,226)=1;LW(227,227)=1;LW(227,228)=1;LW(227,229)=1;LW(228,1)=1;LW(228,2)=1;
    LW(228,3)=1;LW(228,4)=1;LW(228,5)=1;LW(228,6)=1;LW(228,7)=1;LW(228,8)=1;LW(228,9)=1;LW(228,10)=1;LW(228,11)=1;LW(228,12)=1;
    LW(228,13)=1;LW(228,14)=1;LW(228,15)=1;LW(228,16)=1;LW(228,17)=1;LW(228,18)=1;LW(228,19)=1;LW(228,20)=1;LW(228,21)=1;LW(228,22)=1;
    LW(228,23)=1;LW(228,24)=1;LW(228,25)=1;LW(228,26)=1;LW(228,27)=1;LW(228,28)=1;LW(228,29)=1;LW(228,30)=1;LW(228,31)=1;LW(228,32)=1;
    LW(228,33)=1;LW(228,34)=1;LW(228,35)=1;LW(228,36)=1;LW(228,37)=1;LW(228,38)=1;LW(228,39)=1;LW(228,40)=1;LW(228,41)=1;LW(228,42)=1;
    LW(228,43)=1;LW(228,44)=1;LW(228,45)=1;LW(228,46)=1;LW(228,47)=1;LW(228,48)=1;LW(228,49)=1;LW(228,50)=1;LW(228,51)=1;LW(228,52)=1;
    LW(228,53)=1;LW(228,54)=1;LW(228,55)=1;LW(228,56)=1;LW(228,57)=1;LW(228,58)=1;LW(228,59)=1;LW(228,60)=1;LW(228,61)=1;LW(228,62)=1;
    LW(228,63)=1;LW(228,64)=1;LW(228,65)=1;LW(228,66)=1;LW(228,67)=1;LW(228,68)=1;LW(228,69)=1;LW(228,70)=1;LW(228,71)=1;LW(228,72)=1;
    LW(228,73)=1;LW(228,74)=1;LW(228,75)=1;LW(228,76)=1;LW(228,77)=1;LW(228,78)=1;LW(228,79)=1;LW(228,80)=1;LW(228,81)=1;LW(228,82)=1;
    LW(228,83)=1;LW(228,84)=1;LW(228,85)=1;LW(228,86)=1;LW(228,87)=1;LW(228,88)=1;LW(228,89)=1;LW(228,90)=1;LW(228,91)=1;LW(228,92)=1;
    LW(228,93)=1;LW(228,94)=1;LW(228,95)=1;LW(228,96)=1;LW(228,97)=1;LW(228,98)=1;LW(228,99)=1;LW(228,100)=1;LW(228,101)=1;LW(228,102)=1;
    LW(228,114)=1;LW(228,115)=1;LW(228,116)=1;LW(228,119)=1;LW(228,120)=1;LW(228,121)=1;LW(228,122)=1;LW(228,123)=1;LW(228,124)=1;LW(228,125)=1;
    LW(228,126)=1;LW(228,127)=1;LW(228,128)=1;LW(228,129)=1;LW(228,130)=1;LW(228,132)=1;LW(228,133)=1;LW(228,134)=1;LW(228,135)=1;LW(228,136)=1;
    LW(228,137)=1;LW(228,138)=1;LW(228,139)=1;LW(228,140)=1;LW(228,141)=1;LW(228,142)=1;LW(228,143)=1;LW(228,144)=1;LW(228,145)=1;LW(228,146)=1;
    LW(228,147)=1;LW(228,148)=1;LW(228,149)=1;LW(228,150)=1;LW(228,151)=1;LW(228,152)=1;LW(228,153)=1;LW(228,154)=1;LW(228,155)=1;LW(228,156)=1;
    LW(228,157)=1;LW(228,158)=1;LW(228,159)=1;LW(228,160)=1;LW(228,161)=1;LW(228,162)=1;LW(228,163)=1;LW(228,164)=1;LW(228,165)=1;LW(228,166)=1;
    LW(228,167)=1;LW(228,168)=1;LW(228,169)=1;LW(228,170)=1;LW(228,171)=1;LW(228,172)=1;LW(228,173)=1;LW(228,174)=1;LW(228,175)=1;LW(228,176)=1;
    LW(228,177)=1;LW(228,178)=1;LW(228,179)=1;LW(228,180)=1;LW(228,181)=1;LW(228,182)=1;LW(228,183)=1;LW(228,184)=1;LW(228,185)=1;LW(228,186)=1;
    LW(228,187)=1;LW(228,188)=1;LW(228,189)=1;LW(228,190)=1;LW(228,191)=1;LW(228,192)=1;LW(228,193)=1;LW(228,194)=1;LW(228,195)=1;LW(228,196)=1;
    LW(228,197)=1;LW(228,198)=1;LW(228,199)=1;LW(228,200)=1;LW(228,201)=1;LW(228,202)=1;LW(228,203)=1;LW(228,204)=1;LW(228,205)=1;LW(228,206)=1;
    LW(228,207)=1;LW(228,208)=1;LW(228,209)=1;LW(228,210)=1;LW(228,211)=1;LW(228,212)=1;LW(228,213)=1;LW(228,214)=1;LW(228,215)=1;LW(228,216)=1;
    LW(228,217)=1;LW(228,218)=1;LW(228,219)=1;LW(228,220)=1;LW(228,221)=1;LW(228,222)=1;LW(228,223)=1;LW(228,224)=1;LW(228,225)=1;LW(228,226)=1;
    LW(228,227)=1;LW(228,228)=1;LW(228,229)=1;LW(228,230)=1;LW(228,231)=1;LW(228,234)=1;LW(228,235)=1;LW(228,236)=1;LW(229,1)=1;LW(229,2)=1;
    LW(229,3)=1;LW(229,4)=1;LW(229,5)=1;LW(229,6)=1;LW(229,7)=1;LW(229,8)=1;LW(229,9)=1;LW(229,10)=1;LW(229,11)=1;LW(229,12)=1;
    LW(229,13)=1;LW(229,14)=1;LW(229,15)=1;LW(229,16)=1;LW(229,17)=1;LW(229,18)=1;LW(229,19)=1;LW(229,20)=1;LW(229,21)=1;LW(229,22)=1;
    LW(229,23)=1;LW(229,24)=1;LW(229,25)=1;LW(229,26)=1;LW(229,27)=1;LW(229,28)=1;LW(229,29)=1;LW(229,30)=1;LW(229,31)=1;LW(229,32)=1;
    LW(229,33)=1;LW(229,34)=1;LW(229,35)=1;LW(229,36)=1;LW(229,37)=1;LW(229,38)=1;LW(229,39)=1;LW(229,40)=1;LW(229,41)=1;LW(229,42)=1;
    LW(229,43)=1;LW(229,44)=1;LW(229,45)=1;LW(229,46)=1;LW(229,47)=1;LW(229,48)=1;LW(229,49)=1;LW(229,50)=1;LW(229,51)=1;LW(229,52)=1;
    LW(229,53)=1;LW(229,54)=1;LW(229,55)=1;LW(229,56)=1;LW(229,57)=1;LW(229,58)=1;LW(229,59)=1;LW(229,60)=1;LW(229,61)=1;LW(229,62)=1;
    LW(229,63)=1;LW(229,64)=1;LW(229,65)=1;LW(229,66)=1;LW(229,67)=1;LW(229,68)=1;LW(229,69)=1;LW(229,70)=1;LW(229,71)=1;LW(229,72)=1;
    LW(229,73)=1;LW(229,74)=1;LW(229,75)=1;LW(229,76)=1;LW(229,77)=1;LW(229,78)=1;LW(229,79)=1;LW(229,80)=1;LW(229,91)=1;LW(229,92)=1;
    LW(229,93)=1;LW(229,94)=1;LW(229,126)=1;LW(229,127)=1;LW(229,128)=1;LW(229,129)=1;LW(229,141)=1;LW(229,142)=1;LW(229,152)=1;LW(229,153)=1;
    LW(229,154)=1;LW(229,155)=1;LW(229,156)=1;LW(229,168)=1;LW(229,169)=1;LW(229,170)=1;LW(229,176)=1;LW(229,177)=1;LW(229,179)=1;LW(229,180)=1;
    LW(229,181)=1;LW(229,182)=1;LW(229,183)=1;LW(229,184)=1;LW(229,185)=1;LW(229,186)=1;LW(229,187)=1;LW(229,188)=1;LW(229,189)=1;LW(229,190)=1;
    LW(229,191)=1;LW(229,192)=1;LW(229,193)=1;LW(229,194)=1;LW(229,195)=1;LW(229,196)=1;LW(229,197)=1;LW(229,198)=1;LW(229,199)=1;LW(229,200)=1;
    LW(229,201)=1;LW(229,202)=1;LW(229,203)=1;LW(229,204)=1;LW(229,205)=1;LW(229,206)=1;LW(229,207)=1;LW(229,208)=1;LW(229,209)=1;LW(229,210)=1;
    LW(229,211)=1;LW(229,212)=1;LW(229,213)=1;LW(229,214)=1;LW(229,215)=1;LW(229,216)=1;LW(229,217)=1;LW(229,218)=1;LW(229,219)=1;LW(229,220)=1;
    LW(229,221)=1;LW(229,222)=1;LW(229,223)=1;LW(229,224)=1;LW(229,225)=1;LW(229,226)=1;LW(229,227)=1;LW(229,228)=1;LW(229,229)=1;LW(229,230)=1;
    LW(229,231)=1;LW(229,232)=1;LW(229,233)=1;LW(229,234)=1;LW(229,235)=1;LW(229,236)=1;LW(229,237)=1;LW(229,238)=1;LW(229,239)=1;LW(229,240)=1;
    LW(229,241)=1;LW(229,242)=1;LW(229,246)=1;LW(229,247)=1;LW(230,1)=1;LW(230,2)=1;LW(230,3)=1;LW(230,4)=1;LW(230,5)=1;LW(230,6)=1;
    LW(230,7)=1;LW(230,8)=1;LW(230,9)=1;LW(230,10)=1;LW(230,11)=1;LW(230,12)=1;LW(230,13)=1;LW(230,14)=1;LW(230,15)=1;LW(230,16)=1;
    LW(230,17)=1;LW(230,18)=1;LW(230,19)=1;LW(230,20)=1;LW(230,21)=1;LW(230,22)=1;LW(230,23)=1;LW(230,24)=1;LW(230,25)=1;LW(230,26)=1;
    LW(230,27)=1;LW(230,28)=1;LW(230,29)=1;LW(230,30)=1;LW(230,31)=1;LW(230,32)=1;LW(230,33)=1;LW(230,34)=1;LW(230,35)=1;LW(230,36)=1;
    LW(230,37)=1;LW(230,38)=1;LW(230,39)=1;LW(230,40)=1;LW(230,41)=1;LW(230,42)=1;LW(230,43)=1;LW(230,44)=1;LW(230,45)=1;LW(230,46)=1;
    LW(230,47)=1;LW(230,48)=1;LW(230,49)=1;LW(230,50)=1;LW(230,51)=1;LW(230,52)=1;LW(230,53)=1;LW(230,54)=1;LW(230,55)=1;LW(230,56)=1;
    LW(230,57)=1;LW(230,58)=1;LW(230,59)=1;LW(230,60)=1;LW(230,61)=1;LW(230,62)=1;LW(230,63)=1;LW(230,64)=1;LW(230,65)=1;LW(230,66)=1;
    LW(230,67)=1;LW(230,68)=1;LW(230,69)=1;LW(230,70)=1;LW(230,71)=1;LW(230,72)=1;LW(230,73)=1;LW(230,74)=1;LW(230,75)=1;LW(230,76)=1;
    LW(230,77)=1;LW(230,127)=1;LW(230,128)=1;LW(230,153)=1;LW(230,154)=1;LW(230,155)=1;LW(230,180)=1;LW(230,181)=1;LW(230,182)=1;LW(230,183)=1;
    LW(230,184)=1;LW(230,188)=1;LW(230,189)=1;LW(230,190)=1;LW(230,191)=1;LW(230,192)=1;LW(230,193)=1;LW(230,194)=1;LW(230,195)=1;LW(230,196)=1;
    LW(230,197)=1;LW(230,198)=1;LW(230,199)=1;LW(230,200)=1;LW(230,201)=1;LW(230,202)=1;LW(230,203)=1;LW(230,204)=1;LW(230,205)=1;LW(230,206)=1;
    LW(230,207)=1;LW(230,208)=1;LW(230,209)=1;LW(230,210)=1;LW(230,211)=1;LW(230,212)=1;LW(230,213)=1;LW(230,214)=1;LW(230,215)=1;LW(230,216)=1;
    LW(230,217)=1;LW(230,218)=1;LW(230,219)=1;LW(230,220)=1;LW(230,221)=1;LW(230,222)=1;LW(230,223)=1;LW(230,224)=1;LW(230,225)=1;LW(230,226)=1;
    LW(230,227)=1;LW(230,228)=1;LW(230,229)=1;LW(230,230)=1;LW(230,231)=1;LW(230,232)=1;LW(230,233)=1;LW(230,234)=1;LW(230,235)=1;LW(230,236)=1;
    LW(230,237)=1;LW(230,238)=1;LW(230,239)=1;LW(230,240)=1;LW(230,241)=1;LW(230,242)=1;LW(230,243)=1;LW(230,244)=1;LW(230,245)=1;LW(230,246)=1;
    LW(230,247)=1;LW(230,248)=1;LW(230,249)=1;LW(231,1)=1;LW(231,2)=1;LW(231,3)=1;LW(231,4)=1;LW(231,5)=1;LW(231,6)=1;LW(231,7)=1;
    LW(231,8)=1;LW(231,9)=1;LW(231,10)=1;LW(231,11)=1;LW(231,12)=1;LW(231,13)=1;LW(231,14)=1;LW(231,15)=1;LW(231,16)=1;LW(231,17)=1;
    LW(231,18)=1;LW(231,19)=1;LW(231,20)=1;LW(231,21)=1;LW(231,22)=1;LW(231,23)=1;LW(231,24)=1;LW(231,25)=1;LW(231,26)=1;LW(231,27)=1;
    LW(231,28)=1;LW(231,29)=1;LW(231,30)=1;LW(231,31)=1;LW(231,32)=1;LW(231,33)=1;LW(231,34)=1;LW(231,35)=1;LW(231,36)=1;LW(231,37)=1;
    LW(231,38)=1;LW(231,39)=1;LW(231,40)=1;LW(231,41)=1;LW(231,42)=1;LW(231,43)=1;LW(231,44)=1;LW(231,45)=1;LW(231,46)=1;LW(231,47)=1;
    LW(231,51)=1;LW(231,52)=1;LW(231,53)=1;LW(231,54)=1;LW(231,55)=1;LW(231,57)=1;LW(231,58)=1;LW(231,59)=1;LW(231,71)=1;LW(231,72)=1;
    LW(231,73)=1;LW(231,74)=1;LW(231,180)=1;LW(231,181)=1;LW(231,182)=1;LW(231,196)=1;LW(231,197)=1;LW(231,198)=1;LW(231,205)=1;LW(231,206)=1;
    LW(231,207)=1;LW(231,208)=1;LW(231,209)=1;LW(231,210)=1;LW(231,211)=1;LW(231,212)=1;LW(231,213)=1;LW(231,214)=1;LW(231,215)=1;LW(231,216)=1;
    LW(231,217)=1;LW(231,218)=1;LW(231,219)=1;LW(231,220)=1;LW(231,221)=1;LW(231,222)=1;LW(231,223)=1;LW(231,224)=1;LW(231,225)=1;LW(231,226)=1;
    LW(231,227)=1;LW(231,228)=1;LW(231,229)=1;LW(231,230)=1;LW(231,231)=1;LW(231,232)=1;LW(231,233)=1;LW(231,234)=1;LW(231,235)=1;LW(231,236)=1;
    LW(231,237)=1;LW(231,238)=1;LW(231,239)=1;LW(231,240)=1;LW(231,241)=1;LW(231,242)=1;LW(231,243)=1;LW(231,244)=1;LW(231,245)=1;LW(231,246)=1;
    LW(231,247)=1;LW(231,248)=1;LW(231,249)=1;LW(231,250)=1;LW(231,251)=1;LW(231,252)=1;LW(231,253)=1;LW(231,254)=1;LW(231,255)=1;LW(232,1)=1;
    LW(232,2)=1;LW(232,3)=1;LW(232,4)=1;LW(232,5)=1;LW(232,6)=1;LW(232,7)=1;LW(232,8)=1;LW(232,9)=1;LW(232,10)=1;LW(232,11)=1;
    LW(232,12)=1;LW(232,13)=1;LW(232,14)=1;LW(232,15)=1;LW(232,16)=1;LW(232,17)=1;LW(232,18)=1;LW(232,19)=1;LW(232,20)=1;LW(232,21)=1;
    LW(232,22)=1;LW(232,23)=1;LW(232,24)=1;LW(232,25)=1;LW(232,26)=1;LW(232,27)=1;LW(232,28)=1;LW(232,29)=1;LW(232,30)=1;LW(232,31)=1;
    LW(232,32)=1;LW(232,33)=1;LW(232,34)=1;LW(232,35)=1;LW(232,36)=1;LW(232,37)=1;LW(232,38)=1;LW(232,39)=1;LW(232,40)=1;LW(232,41)=1;
    LW(232,42)=1;LW(232,43)=1;LW(232,44)=1;LW(232,45)=1;LW(232,46)=1;LW(232,47)=1;LW(232,53)=1;LW(232,54)=1;LW(232,71)=1;LW(232,72)=1;
    LW(232,197)=1;LW(232,207)=1;LW(232,208)=1;LW(232,209)=1;LW(232,210)=1;LW(232,211)=1;LW(232,212)=1;LW(232,213)=1;LW(232,214)=1;LW(232,215)=1;
    LW(232,216)=1;LW(232,217)=1;LW(232,218)=1;LW(232,219)=1;LW(232,220)=1;LW(232,221)=1;LW(232,222)=1;LW(232,223)=1;LW(232,224)=1;LW(232,225)=1;
    LW(232,226)=1;LW(232,227)=1;LW(232,228)=1;LW(232,229)=1;LW(232,230)=1;LW(232,231)=1;LW(232,232)=1;LW(232,233)=1;LW(232,234)=1;LW(232,235)=1;
    LW(232,236)=1;LW(232,237)=1;LW(232,238)=1;LW(232,239)=1;LW(232,240)=1;LW(232,241)=1;LW(232,242)=1;LW(232,243)=1;LW(232,244)=1;LW(232,245)=1;
    LW(232,246)=1;LW(232,247)=1;LW(232,248)=1;LW(232,249)=1;LW(232,250)=1;LW(232,251)=1;LW(232,252)=1;LW(232,253)=1;LW(232,254)=1;LW(232,255)=1;
    LW(232,256)=1;LW(233,1)=1;LW(233,2)=1;LW(233,3)=1;LW(233,4)=1;LW(233,5)=1;LW(233,6)=1;LW(233,7)=1;LW(233,8)=1;LW(233,9)=1;
    LW(233,10)=1;LW(233,11)=1;LW(233,12)=1;LW(233,13)=1;LW(233,14)=1;LW(233,15)=1;LW(233,16)=1;LW(233,17)=1;LW(233,18)=1;LW(233,19)=1;
    LW(233,20)=1;LW(233,21)=1;LW(233,22)=1;LW(233,23)=1;LW(233,24)=1;LW(233,25)=1;LW(233,26)=1;LW(233,27)=1;LW(233,28)=1;LW(233,29)=1;
    LW(233,30)=1;LW(233,31)=1;LW(233,32)=1;LW(233,33)=1;LW(233,34)=1;LW(233,35)=1;LW(233,36)=1;LW(233,37)=1;LW(233,38)=1;LW(233,39)=1;
    LW(233,40)=1;LW(233,41)=1;LW(233,43)=1;LW(233,44)=1;LW(233,45)=1;LW(233,46)=1;LW(233,71)=1;LW(233,211)=1;LW(233,212)=1;LW(233,213)=1;
    LW(233,214)=1;LW(233,216)=1;LW(233,217)=1;LW(233,218)=1;LW(233,219)=1;LW(233,220)=1;LW(233,221)=1;LW(233,222)=1;LW(233,223)=1;LW(233,224)=1;
    LW(233,225)=1;LW(233,226)=1;LW(233,227)=1;LW(233,228)=1;LW(233,229)=1;LW(233,230)=1;LW(233,231)=1;LW(233,232)=1;LW(233,233)=1;LW(233,234)=1;
    LW(233,235)=1;LW(233,236)=1;LW(233,237)=1;LW(233,238)=1;LW(233,239)=1;LW(233,240)=1;LW(233,241)=1;LW(233,242)=1;LW(233,243)=1;LW(233,244)=1;
    LW(233,245)=1;LW(233,246)=1;LW(233,247)=1;LW(233,248)=1;LW(233,249)=1;LW(233,250)=1;LW(233,251)=1;LW(233,252)=1;LW(233,253)=1;LW(233,254)=1;
    LW(233,255)=1;LW(233,256)=1;LW(233,257)=1;LW(233,258)=1;LW(233,259)=1;LW(233,260)=1;LW(233,261)=1;LW(233,262)=1;LW(234,1)=1;LW(234,2)=1;
    LW(234,3)=1;LW(234,4)=1;LW(234,5)=1;LW(234,6)=1;LW(234,7)=1;LW(234,8)=1;LW(234,9)=1;LW(234,10)=1;LW(234,11)=1;LW(234,12)=1;
    LW(234,13)=1;LW(234,14)=1;LW(234,15)=1;LW(234,16)=1;LW(234,17)=1;LW(234,18)=1;LW(234,19)=1;LW(234,20)=1;LW(234,21)=1;LW(234,22)=1;
    LW(234,23)=1;LW(234,24)=1;LW(234,25)=1;LW(234,26)=1;LW(234,27)=1;LW(234,29)=1;LW(234,30)=1;LW(234,31)=1;LW(234,32)=1;LW(234,33)=1;
    LW(234,34)=1;LW(234,35)=1;LW(234,36)=1;LW(234,37)=1;LW(234,38)=1;LW(234,39)=1;LW(234,40)=1;LW(234,217)=1;LW(234,218)=1;LW(234,219)=1;
    LW(234,220)=1;LW(234,221)=1;LW(234,222)=1;LW(234,223)=1;LW(234,224)=1;LW(234,225)=1;LW(234,226)=1;LW(234,227)=1;LW(234,228)=1;LW(234,229)=1;
    LW(234,230)=1;LW(234,231)=1;LW(234,232)=1;LW(234,233)=1;LW(234,234)=1;LW(234,235)=1;LW(234,236)=1;LW(234,237)=1;LW(234,238)=1;LW(234,239)=1;
    LW(234,240)=1;LW(234,241)=1;LW(234,242)=1;LW(234,243)=1;LW(234,244)=1;LW(234,245)=1;LW(234,246)=1;LW(234,247)=1;LW(234,248)=1;LW(234,249)=1;
    LW(234,250)=1;LW(234,251)=1;LW(234,252)=1;LW(234,253)=1;LW(234,254)=1;LW(234,255)=1;LW(234,256)=1;LW(234,257)=1;LW(234,258)=1;LW(234,259)=1;
    LW(234,260)=1;LW(234,261)=1;LW(234,262)=1;LW(234,263)=1;LW(234,264)=1;LW(234,265)=1;LW(234,266)=1;LW(234,267)=1;LW(234,268)=1;LW(234,269)=1;
    LW(235,1)=1;LW(235,2)=1;LW(235,3)=1;LW(235,4)=1;LW(235,5)=1;LW(235,6)=1;LW(235,7)=1;LW(235,8)=1;LW(235,9)=1;LW(235,10)=1;
    LW(235,11)=1;LW(235,12)=1;LW(235,13)=1;LW(235,14)=1;LW(235,15)=1;LW(235,16)=1;LW(235,17)=1;LW(235,18)=1;LW(235,19)=1;LW(235,20)=1;
    LW(235,21)=1;LW(235,22)=1;LW(235,23)=1;LW(235,24)=1;LW(235,25)=1;LW(235,26)=1;LW(235,223)=1;LW(235,224)=1;LW(235,225)=1;LW(235,226)=1;
    LW(235,227)=1;LW(235,228)=1;LW(235,229)=1;LW(235,230)=1;LW(235,231)=1;LW(235,232)=1;LW(235,233)=1;LW(235,234)=1;LW(235,235)=1;LW(235,236)=1;
    LW(235,237)=1;LW(235,238)=1;LW(235,239)=1;LW(235,240)=1;LW(235,241)=1;LW(235,242)=1;LW(235,243)=1;LW(235,244)=1;LW(235,245)=1;LW(235,246)=1;
    LW(235,247)=1;LW(235,248)=1;LW(235,249)=1;LW(235,250)=1;LW(235,251)=1;LW(235,252)=1;LW(235,253)=1;LW(235,254)=1;LW(235,255)=1;LW(235,256)=1;
    LW(235,257)=1;LW(235,258)=1;LW(235,259)=1;LW(235,260)=1;LW(235,261)=1;LW(235,262)=1;LW(235,263)=1;LW(235,264)=1;LW(235,265)=1;LW(235,266)=1;
    LW(235,267)=1;LW(235,268)=1;LW(235,269)=1;LW(235,270)=1;LW(236,1)=1;LW(236,2)=1;LW(236,3)=1;LW(236,4)=1;LW(236,5)=1;LW(236,6)=1;
    LW(236,7)=1;LW(236,8)=1;LW(236,9)=1;LW(236,10)=1;LW(236,11)=1;LW(236,12)=1;LW(236,13)=1;LW(236,14)=1;LW(236,15)=1;LW(236,16)=1;
    LW(236,17)=1;LW(236,18)=1;LW(236,19)=1;LW(236,20)=1;LW(236,21)=1;LW(236,22)=1;LW(236,23)=1;LW(236,24)=1;LW(236,25)=1;LW(236,224)=1;
    LW(236,225)=1;LW(236,226)=1;LW(236,227)=1;LW(236,228)=1;LW(236,229)=1;LW(236,230)=1;LW(236,231)=1;LW(236,232)=1;LW(236,233)=1;LW(236,234)=1;
    LW(236,235)=1;LW(236,236)=1;LW(236,237)=1;LW(236,238)=1;LW(236,239)=1;LW(236,240)=1;LW(236,241)=1;LW(236,242)=1;LW(236,243)=1;LW(236,244)=1;
    LW(236,245)=1;LW(236,246)=1;LW(236,247)=1;LW(236,248)=1;LW(236,249)=1;LW(236,250)=1;LW(236,251)=1;LW(236,252)=1;LW(236,253)=1;LW(236,254)=1;
    LW(236,255)=1;LW(236,256)=1;LW(236,257)=1;LW(236,258)=1;LW(236,259)=1;LW(236,260)=1;LW(236,261)=1;LW(236,262)=1;LW(236,263)=1;LW(236,264)=1;
    LW(236,265)=1;LW(236,266)=1;LW(236,267)=1;LW(236,268)=1;LW(236,269)=1;LW(236,270)=1;LW(237,1)=1;LW(237,2)=1;LW(237,3)=1;LW(237,4)=1;
    LW(237,5)=1;LW(237,6)=1;LW(237,7)=1;LW(237,8)=1;LW(237,9)=1;LW(237,10)=1;LW(237,11)=1;LW(237,12)=1;LW(237,13)=1;LW(237,16)=1;
    LW(237,17)=1;LW(237,18)=1;LW(237,19)=1;LW(237,231)=1;LW(237,232)=1;LW(237,233)=1;LW(237,234)=1;LW(237,235)=1;LW(237,236)=1;LW(237,237)=1;
    LW(237,238)=1;LW(237,239)=1;LW(237,240)=1;LW(237,241)=1;LW(237,242)=1;LW(237,243)=1;LW(237,244)=1;LW(237,245)=1;LW(237,246)=1;LW(237,247)=1;
    LW(237,248)=1;LW(237,249)=1;LW(237,250)=1;LW(237,251)=1;LW(237,252)=1;LW(237,253)=1;LW(237,254)=1;LW(237,255)=1;LW(237,256)=1;LW(237,257)=1;
    LW(237,258)=1;LW(237,259)=1;LW(237,260)=1;LW(237,261)=1;LW(237,262)=1;LW(237,263)=1;LW(237,264)=1;LW(237,265)=1;LW(237,266)=1;LW(237,267)=1;
    LW(237,268)=1;LW(237,269)=1;LW(237,270)=1;LW(238,1)=1;LW(238,2)=1;LW(238,3)=1;LW(238,4)=1;LW(238,5)=1;LW(238,6)=1;LW(238,7)=1;
    LW(238,8)=1;LW(238,9)=1;LW(238,10)=1;LW(238,11)=1;LW(238,12)=1;LW(238,13)=1;LW(238,17)=1;LW(238,18)=1;LW(238,233)=1;LW(238,237)=1;
    LW(238,238)=1;LW(238,239)=1;LW(238,240)=1;LW(238,241)=1;LW(238,242)=1;LW(238,243)=1;LW(238,244)=1;LW(238,245)=1;LW(238,246)=1;LW(238,247)=1;
    LW(238,248)=1;LW(238,249)=1;LW(238,250)=1;LW(238,251)=1;LW(238,252)=1;LW(238,253)=1;LW(238,254)=1;LW(238,255)=1;LW(238,256)=1;LW(238,257)=1;
    LW(238,258)=1;LW(238,259)=1;LW(238,260)=1;LW(238,261)=1;LW(238,262)=1;LW(238,263)=1;LW(238,264)=1;LW(238,265)=1;LW(238,266)=1;LW(238,267)=1;
    LW(238,268)=1;LW(238,269)=1;LW(238,270)=1;LW(239,1)=1;LW(239,2)=1;LW(239,3)=1;LW(239,4)=1;LW(239,5)=1;LW(239,10)=1;LW(239,11)=1;
    LW(239,12)=1;LW(239,244)=1;LW(239,245)=1;LW(239,249)=1;LW(239,250)=1;LW(239,251)=1;LW(239,252)=1;LW(239,253)=1;LW(239,254)=1;LW(239,255)=1;
    LW(239,256)=1;LW(239,257)=1;LW(239,258)=1;LW(239,259)=1;LW(239,260)=1;LW(239,261)=1;LW(239,262)=1;LW(239,263)=1;LW(239,264)=1;LW(239,265)=1;
    LW(239,266)=1;LW(239,267)=1;LW(239,268)=1;LW(239,269)=1;LW(239,270)=1;LW(240,1)=1;LW(240,2)=1;LW(240,3)=1;LW(240,4)=1;LW(240,249)=1;
    LW(240,250)=1;LW(240,251)=1;LW(240,252)=1;LW(240,253)=1;LW(240,254)=1;LW(240,255)=1;LW(240,256)=1;LW(240,257)=1;LW(240,258)=1;LW(240,259)=1;
    LW(240,260)=1;LW(240,261)=1;LW(240,262)=1;LW(240,263)=1;LW(240,264)=1;LW(240,265)=1;LW(240,266)=1;LW(240,267)=1;LW(240,268)=1;LW(240,269)=1;
    LW(240,270)=1;LW(241,1)=1;LW(241,2)=1;LW(241,3)=1;LW(241,251)=1;LW(241,252)=1;LW(241,253)=1;LW(241,254)=1;LW(241,255)=1;LW(241,256)=1;
    LW(241,257)=1;LW(241,258)=1;LW(241,259)=1;LW(241,260)=1;LW(241,261)=1;LW(241,262)=1;LW(241,263)=1;LW(241,264)=1;LW(241,265)=1;LW(241,266)=1;
    LW(241,267)=1;LW(241,268)=1;LW(241,269)=1;LW(241,270)=1;LW(242,1)=1;LW(242,2)=1;LW(242,257)=1;LW(242,258)=1;LW(242,259)=1;LW(242,260)=1;
    LW(242,261)=1;LW(242,262)=1;LW(242,263)=1;LW(242,264)=1;LW(242,265)=1;LW(242,266)=1;LW(242,267)=1;LW(242,268)=1;LW(242,269)=1;LW(242,270)=1;
    LW(243,1)=1;LW(243,262)=1;LW(243,263)=1;LW(243,264)=1;LW(243,265)=1;LW(243,266)=1;LW(243,267)=1;LW(243,268)=1;LW(243,269)=1;LW(243,270)=1;
    LW(244,263)=1;LW(244,264)=1;LW(244,265)=1;LW(244,266)=1;LW(244,267)=1;LW(244,268)=1;LW(244,269)=1;LW(244,270)=1;LW(245,266)=1;LW(245,267)=1;
    LW(245,268)=1;LW(245,269)=1;LW(245,270)=1;LW(246,266)=1;LW(246,267)=1;LW(246,268)=1;LW(246,269)=1;LW(246,270)=1;LW(247,269)=1;LW(247,270)=1;
    LW(248,270)=1;LW(268,90)=1;LW(269,56)=1;LW(269,66)=1;LW(269,67)=1;LW(269,68)=1;LW(269,89)=1;LW(269,90)=1;LW(269,91)=1;LW(269,92)=1;
    LW(269,103)=1;LW(269,111)=1;LW(269,112)=1;LW(269,113)=1;LW(269,124)=1;LW(269,125)=1;LW(269,138)=1;LW(269,139)=1;LW(270,55)=1;LW(270,56)=1;
    LW(270,57)=1;LW(270,59)=1;LW(270,60)=1;LW(270,61)=1;LW(270,62)=1;LW(270,63)=1;LW(270,64)=1;LW(270,65)=1;LW(270,66)=1;LW(270,67)=1;
    LW(270,68)=1;LW(270,69)=1;LW(270,70)=1;LW(270,74)=1;LW(270,75)=1;LW(270,76)=1;LW(270,88)=1;LW(270,89)=1;LW(270,90)=1;LW(270,91)=1;
    LW(270,92)=1;LW(270,95)=1;LW(270,96)=1;LW(270,97)=1;LW(270,98)=1;LW(270,101)=1;LW(270,102)=1;LW(270,103)=1;LW(270,104)=1;LW(270,105)=1;
    LW(270,106)=1;LW(270,109)=1;LW(270,110)=1;LW(270,111)=1;LW(270,112)=1;LW(270,113)=1;LW(270,117)=1;LW(270,118)=1;LW(270,124)=1;LW(270,125)=1;
    LW(270,126)=1;LW(270,127)=1;LW(270,130)=1;LW(270,131)=1;LW(270,132)=1;LW(270,138)=1;LW(270,139)=1;LW(270,140)=1;LW(271,54)=1;LW(271,55)=1;
    LW(271,56)=1;LW(271,57)=1;LW(271,58)=1;LW(271,59)=1;LW(271,60)=1;LW(271,61)=1;LW(271,62)=1;LW(271,63)=1;LW(271,64)=1;LW(271,65)=1;
    LW(271,66)=1;LW(271,67)=1;LW(271,68)=1;LW(271,69)=1;LW(271,70)=1;LW(271,71)=1;LW(271,72)=1;LW(271,73)=1;LW(271,74)=1;LW(271,75)=1;
    LW(271,76)=1;LW(271,77)=1;LW(271,81)=1;LW(271,82)=1;LW(271,83)=1;LW(271,84)=1;LW(271,85)=1;LW(271,86)=1;LW(271,87)=1;LW(271,88)=1;
    LW(271,89)=1;LW(271,90)=1;LW(271,91)=1;LW(271,92)=1;LW(271,93)=1;LW(271,94)=1;LW(271,95)=1;LW(271,96)=1;LW(271,97)=1;LW(271,98)=1;
    LW(271,99)=1;LW(271,100)=1;LW(271,101)=1;LW(271,102)=1;LW(271,103)=1;LW(271,104)=1;LW(271,105)=1;LW(271,106)=1;LW(271,107)=1;LW(271,108)=1;
    LW(271,109)=1;LW(271,110)=1;LW(271,111)=1;LW(271,112)=1;LW(271,113)=1;LW(271,114)=1;LW(271,115)=1;LW(271,116)=1;LW(271,117)=1;LW(271,118)=1;
    LW(271,119)=1;LW(271,120)=1;LW(271,121)=1;LW(271,123)=1;LW(271,124)=1;LW(271,125)=1;LW(271,126)=1;LW(271,127)=1;LW(271,128)=1;LW(271,129)=1;
    LW(271,130)=1;LW(271,131)=1;LW(271,132)=1;LW(271,133)=1;LW(271,134)=1;LW(271,135)=1;LW(271,136)=1;LW(271,137)=1;LW(271,138)=1;LW(271,139)=1;
    LW(271,140)=1;LW(271,141)=1;LW(271,150)=1;LW(271,171)=1;LW(271,172)=1;LW(271,173)=1;LW(272,42)=1;LW(272,43)=1;LW(272,47)=1;LW(272,48)=1;
    LW(272,49)=1;LW(272,50)=1;LW(272,51)=1;LW(272,52)=1;LW(272,53)=1;LW(272,54)=1;LW(272,55)=1;LW(272,56)=1;LW(272,57)=1;LW(272,58)=1;
    LW(272,59)=1;LW(272,60)=1;LW(272,61)=1;LW(272,62)=1;LW(272,63)=1;LW(272,64)=1;LW(272,65)=1;LW(272,66)=1;LW(272,67)=1;LW(272,68)=1;
    LW(272,69)=1;LW(272,70)=1;LW(272,71)=1;LW(272,72)=1;LW(272,73)=1;LW(272,74)=1;LW(272,75)=1;LW(272,76)=1;LW(272,77)=1;LW(272,78)=1;
    LW(272,79)=1;LW(272,80)=1;LW(272,81)=1;LW(272,82)=1;LW(272,83)=1;LW(272,84)=1;LW(272,85)=1;LW(272,86)=1;LW(272,87)=1;LW(272,88)=1;
    LW(272,89)=1;LW(272,90)=1;LW(272,91)=1;LW(272,92)=1;LW(272,93)=1;LW(272,94)=1;LW(272,95)=1;LW(272,96)=1;LW(272,97)=1;LW(272,98)=1;
    LW(272,99)=1;LW(272,100)=1;LW(272,101)=1;LW(272,102)=1;LW(272,103)=1;LW(272,104)=1;LW(272,105)=1;LW(272,106)=1;LW(272,107)=1;LW(272,108)=1;
    LW(272,109)=1;LW(272,110)=1;LW(272,111)=1;LW(272,112)=1;LW(272,113)=1;LW(272,114)=1;LW(272,115)=1;LW(272,116)=1;LW(272,117)=1;LW(272,118)=1;
    LW(272,119)=1;LW(272,120)=1;LW(272,121)=1;LW(272,122)=1;LW(272,123)=1;LW(272,124)=1;LW(272,125)=1;LW(272,126)=1;LW(272,127)=1;LW(272,128)=1;
    LW(272,129)=1;LW(272,130)=1;LW(272,131)=1;LW(272,132)=1;LW(272,133)=1;LW(272,134)=1;LW(272,135)=1;LW(272,136)=1;LW(272,137)=1;LW(272,138)=1;
    LW(272,139)=1;LW(272,140)=1;LW(272,141)=1;LW(272,142)=1;LW(272,143)=1;LW(272,144)=1;LW(272,145)=1;LW(272,146)=1;LW(272,149)=1;LW(272,150)=1;
    LW(272,151)=1;LW(272,152)=1;LW(272,157)=1;LW(272,158)=1;LW(272,159)=1;LW(272,163)=1;LW(272,164)=1;LW(272,165)=1;LW(272,166)=1;LW(272,170)=1;
    LW(272,171)=1;LW(272,172)=1;LW(272,173)=1;LW(272,174)=1;LW(273,41)=1;LW(273,42)=1;LW(273,43)=1;LW(273,44)=1;LW(273,45)=1;LW(273,46)=1;
    LW(273,47)=1;LW(273,48)=1;LW(273,49)=1;LW(273,50)=1;LW(273,51)=1;LW(273,52)=1;LW(273,53)=1;LW(273,54)=1;LW(273,55)=1;LW(273,56)=1;
    LW(273,57)=1;LW(273,58)=1;LW(273,59)=1;LW(273,60)=1;LW(273,61)=1;LW(273,62)=1;LW(273,63)=1;LW(273,64)=1;LW(273,65)=1;LW(273,66)=1;
    LW(273,67)=1;LW(273,68)=1;LW(273,69)=1;LW(273,70)=1;LW(273,71)=1;LW(273,72)=1;LW(273,73)=1;LW(273,74)=1;LW(273,75)=1;LW(273,76)=1;
    LW(273,77)=1;LW(273,78)=1;LW(273,79)=1;LW(273,80)=1;LW(273,81)=1;LW(273,82)=1;LW(273,83)=1;LW(273,84)=1;LW(273,85)=1;LW(273,86)=1;
    LW(273,87)=1;LW(273,88)=1;LW(273,89)=1;LW(273,90)=1;LW(273,91)=1;LW(273,92)=1;LW(273,93)=1;LW(273,94)=1;LW(273,95)=1;LW(273,96)=1;
    LW(273,97)=1;LW(273,98)=1;LW(273,99)=1;LW(273,100)=1;LW(273,101)=1;LW(273,102)=1;LW(273,103)=1;LW(273,104)=1;LW(273,105)=1;LW(273,106)=1;
    LW(273,107)=1;LW(273,108)=1;LW(273,109)=1;LW(273,110)=1;LW(273,111)=1;LW(273,112)=1;LW(273,113)=1;LW(273,114)=1;LW(273,115)=1;LW(273,116)=1;
    LW(273,117)=1;LW(273,118)=1;LW(273,119)=1;LW(273,120)=1;LW(273,121)=1;LW(273,122)=1;LW(273,123)=1;LW(273,124)=1;LW(273,125)=1;LW(273,126)=1;
    LW(273,127)=1;LW(273,128)=1;LW(273,129)=1;LW(273,130)=1;LW(273,131)=1;LW(273,132)=1;LW(273,133)=1;LW(273,134)=1;LW(273,135)=1;LW(273,136)=1;
    LW(273,137)=1;LW(273,138)=1;LW(273,139)=1;LW(273,140)=1;LW(273,141)=1;LW(273,142)=1;LW(273,143)=1;LW(273,144)=1;LW(273,145)=1;LW(273,146)=1;
    LW(273,147)=1;LW(273,148)=1;LW(273,149)=1;LW(273,150)=1;LW(273,151)=1;LW(273,152)=1;LW(273,153)=1;LW(273,154)=1;LW(273,155)=1;LW(273,156)=1;
    LW(273,157)=1;LW(273,158)=1;LW(273,159)=1;LW(273,160)=1;LW(273,161)=1;LW(273,162)=1;LW(273,163)=1;LW(273,164)=1;LW(273,165)=1;LW(273,166)=1;
    LW(273,167)=1;LW(273,168)=1;LW(273,169)=1;LW(273,170)=1;LW(273,171)=1;LW(273,172)=1;LW(273,173)=1;LW(273,174)=1;LW(273,175)=1;LW(273,184)=1;
    LW(273,185)=1;LW(273,186)=1;LW(273,187)=1;LW(273,191)=1;LW(273,192)=1;LW(273,193)=1;LW(273,194)=1;LW(273,195)=1;LW(274,34)=1;LW(274,35)=1;
    LW(274,36)=1;LW(274,37)=1;LW(274,38)=1;LW(274,39)=1;LW(274,40)=1;LW(274,41)=1;LW(274,42)=1;LW(274,43)=1;LW(274,44)=1;LW(274,45)=1;
    LW(274,46)=1;LW(274,47)=1;LW(274,48)=1;LW(274,49)=1;LW(274,50)=1;LW(274,51)=1;LW(274,52)=1;LW(274,53)=1;LW(274,54)=1;LW(274,55)=1;
    LW(274,56)=1;LW(274,57)=1;LW(274,58)=1;LW(274,59)=1;LW(274,60)=1;LW(274,61)=1;LW(274,62)=1;LW(274,63)=1;LW(274,64)=1;LW(274,65)=1;
    LW(274,66)=1;LW(274,67)=1;LW(274,68)=1;LW(274,69)=1;LW(274,70)=1;LW(274,71)=1;LW(274,72)=1;LW(274,73)=1;LW(274,74)=1;LW(274,75)=1;
    LW(274,76)=1;LW(274,77)=1;LW(274,78)=1;LW(274,79)=1;LW(274,80)=1;LW(274,81)=1;LW(274,82)=1;LW(274,83)=1;LW(274,84)=1;LW(274,85)=1;
    LW(274,86)=1;LW(274,87)=1;LW(274,88)=1;LW(274,89)=1;LW(274,90)=1;LW(274,91)=1;LW(274,92)=1;LW(274,93)=1;LW(274,94)=1;LW(274,95)=1;
    LW(274,96)=1;LW(274,97)=1;LW(274,98)=1;LW(274,99)=1;LW(274,100)=1;LW(274,101)=1;LW(274,102)=1;LW(274,103)=1;LW(274,104)=1;LW(274,105)=1;
    LW(274,106)=1;LW(274,107)=1;LW(274,108)=1;LW(274,109)=1;LW(274,110)=1;LW(274,111)=1;LW(274,112)=1;LW(274,113)=1;LW(274,114)=1;LW(274,115)=1;
    LW(274,116)=1;LW(274,117)=1;LW(274,118)=1;LW(274,119)=1;LW(274,120)=1;LW(274,121)=1;LW(274,122)=1;LW(274,123)=1;LW(274,124)=1;LW(274,125)=1;
    LW(274,126)=1;LW(274,127)=1;LW(274,128)=1;LW(274,129)=1;LW(274,130)=1;LW(274,131)=1;LW(274,132)=1;LW(274,133)=1;LW(274,134)=1;LW(274,135)=1;
    LW(274,136)=1;LW(274,137)=1;LW(274,138)=1;LW(274,139)=1;LW(274,140)=1;LW(274,141)=1;LW(274,142)=1;LW(274,143)=1;LW(274,144)=1;LW(274,145)=1;
    LW(274,146)=1;LW(274,147)=1;LW(274,148)=1;LW(274,149)=1;LW(274,150)=1;LW(274,151)=1;LW(274,152)=1;LW(274,153)=1;LW(274,154)=1;LW(274,155)=1;
    LW(274,156)=1;LW(274,157)=1;LW(274,158)=1;LW(274,159)=1;LW(274,160)=1;LW(274,161)=1;LW(274,162)=1;LW(274,163)=1;LW(274,164)=1;LW(274,165)=1;
    LW(274,166)=1;LW(274,167)=1;LW(274,168)=1;LW(274,169)=1;LW(274,170)=1;LW(274,171)=1;LW(274,172)=1;LW(274,173)=1;LW(274,174)=1;LW(274,175)=1;
    LW(274,176)=1;LW(274,177)=1;LW(274,178)=1;LW(274,179)=1;LW(274,180)=1;LW(274,181)=1;LW(274,182)=1;LW(274,183)=1;LW(274,184)=1;LW(274,185)=1;
    LW(274,186)=1;LW(274,187)=1;LW(274,188)=1;LW(274,189)=1;LW(274,190)=1;LW(274,191)=1;LW(274,192)=1;LW(274,193)=1;LW(274,194)=1;LW(274,195)=1;
    LW(274,196)=1;LW(274,197)=1;LW(274,198)=1;LW(274,199)=1;LW(274,200)=1;LW(274,201)=1;LW(274,202)=1;LW(274,203)=1;LW(274,204)=1;LW(274,205)=1;
    LW(274,206)=1;LW(274,207)=1;LW(274,208)=1;LW(274,209)=1;LW(274,213)=1;LW(274,214)=1;LW(274,215)=1;LW(275,20)=1;LW(275,21)=1;LW(275,22)=1;
    LW(275,27)=1;LW(275,28)=1;LW(275,29)=1;LW(275,30)=1;LW(275,32)=1;LW(275,33)=1;LW(275,34)=1;LW(275,35)=1;LW(275,36)=1;LW(275,37)=1;
    LW(275,38)=1;LW(275,39)=1;LW(275,40)=1;LW(275,41)=1;LW(275,42)=1;LW(275,43)=1;LW(275,44)=1;LW(275,45)=1;LW(275,46)=1;LW(275,47)=1;
    LW(275,48)=1;LW(275,49)=1;LW(275,50)=1;LW(275,51)=1;LW(275,52)=1;LW(275,53)=1;LW(275,54)=1;LW(275,55)=1;LW(275,56)=1;LW(275,57)=1;
    LW(275,58)=1;LW(275,59)=1;LW(275,60)=1;LW(275,61)=1;LW(275,62)=1;LW(275,63)=1;LW(275,64)=1;LW(275,65)=1;LW(275,66)=1;LW(275,67)=1;
    LW(275,68)=1;LW(275,69)=1;LW(275,70)=1;LW(275,71)=1;LW(275,72)=1;LW(275,73)=1;LW(275,74)=1;LW(275,75)=1;LW(275,76)=1;LW(275,77)=1;
    LW(275,78)=1;LW(275,79)=1;LW(275,80)=1;LW(275,81)=1;LW(275,82)=1;LW(275,83)=1;LW(275,84)=1;LW(275,85)=1;LW(275,86)=1;LW(275,87)=1;
    LW(275,88)=1;LW(275,89)=1;LW(275,90)=1;LW(275,91)=1;LW(275,92)=1;LW(275,93)=1;LW(275,94)=1;LW(275,95)=1;LW(275,96)=1;LW(275,97)=1;
    LW(275,98)=1;LW(275,99)=1;LW(275,100)=1;LW(275,101)=1;LW(275,102)=1;LW(275,103)=1;LW(275,104)=1;LW(275,105)=1;LW(275,106)=1;LW(275,107)=1;
    LW(275,108)=1;LW(275,109)=1;LW(275,110)=1;LW(275,111)=1;LW(275,112)=1;LW(275,113)=1;LW(275,114)=1;LW(275,115)=1;LW(275,116)=1;LW(275,117)=1;
    LW(275,118)=1;LW(275,119)=1;LW(275,120)=1;LW(275,121)=1;LW(275,122)=1;LW(275,123)=1;LW(275,124)=1;LW(275,125)=1;LW(275,126)=1;LW(275,127)=1;
    LW(275,128)=1;LW(275,129)=1;LW(275,130)=1;LW(275,131)=1;LW(275,132)=1;LW(275,133)=1;LW(275,134)=1;LW(275,135)=1;LW(275,136)=1;LW(275,137)=1;
    LW(275,138)=1;LW(275,139)=1;LW(275,140)=1;LW(275,141)=1;LW(275,142)=1;LW(275,143)=1;LW(275,144)=1;LW(275,145)=1;LW(275,146)=1;LW(275,147)=1;
    LW(275,148)=1;LW(275,149)=1;LW(275,150)=1;LW(275,151)=1;LW(275,152)=1;LW(275,153)=1;LW(275,154)=1;LW(275,155)=1;LW(275,156)=1;LW(275,157)=1;
    LW(275,158)=1;LW(275,159)=1;LW(275,160)=1;LW(275,161)=1;LW(275,162)=1;LW(275,163)=1;LW(275,164)=1;LW(275,165)=1;LW(275,166)=1;LW(275,167)=1;
    LW(275,168)=1;LW(275,169)=1;LW(275,170)=1;LW(275,171)=1;LW(275,172)=1;LW(275,173)=1;LW(275,174)=1;LW(275,175)=1;LW(275,176)=1;LW(275,177)=1;
    LW(275,178)=1;LW(275,179)=1;LW(275,180)=1;LW(275,181)=1;LW(275,182)=1;LW(275,183)=1;LW(275,184)=1;LW(275,185)=1;LW(275,186)=1;LW(275,187)=1;
    LW(275,188)=1;LW(275,189)=1;LW(275,190)=1;LW(275,191)=1;LW(275,192)=1;LW(275,193)=1;LW(275,194)=1;LW(275,195)=1;LW(275,196)=1;LW(275,197)=1;
    LW(275,198)=1;LW(275,199)=1;LW(275,200)=1;LW(275,201)=1;LW(275,202)=1;LW(275,203)=1;LW(275,204)=1;LW(275,205)=1;LW(275,206)=1;LW(275,207)=1;
    LW(275,208)=1;LW(275,209)=1;LW(275,210)=1;LW(275,211)=1;LW(275,212)=1;LW(275,213)=1;LW(275,214)=1;LW(275,215)=1;LW(275,216)=1;LW(275,217)=1;
    LW(276,19)=1;LW(276,20)=1;LW(276,21)=1;LW(276,22)=1;LW(276,23)=1;LW(276,24)=1;LW(276,25)=1;LW(276,26)=1;LW(276,27)=1;LW(276,28)=1;
    LW(276,29)=1;LW(276,30)=1;LW(276,31)=1;LW(276,32)=1;LW(276,33)=1;LW(276,34)=1;LW(276,35)=1;LW(276,36)=1;LW(276,37)=1;LW(276,38)=1;
    LW(276,39)=1;LW(276,40)=1;LW(276,41)=1;LW(276,42)=1;LW(276,43)=1;LW(276,44)=1;LW(276,45)=1;LW(276,46)=1;LW(276,47)=1;LW(276,48)=1;
    LW(276,49)=1;LW(276,50)=1;LW(276,51)=1;LW(276,52)=1;LW(276,53)=1;LW(276,54)=1;LW(276,55)=1;LW(276,56)=1;LW(276,57)=1;LW(276,58)=1;
    LW(276,59)=1;LW(276,60)=1;LW(276,61)=1;LW(276,62)=1;LW(276,63)=1;LW(276,64)=1;LW(276,65)=1;LW(276,66)=1;LW(276,67)=1;LW(276,68)=1;
    LW(276,69)=1;LW(276,70)=1;LW(276,71)=1;LW(276,72)=1;LW(276,73)=1;LW(276,74)=1;LW(276,75)=1;LW(276,76)=1;LW(276,77)=1;LW(276,78)=1;
    LW(276,79)=1;LW(276,80)=1;LW(276,81)=1;LW(276,82)=1;LW(276,83)=1;LW(276,84)=1;LW(276,85)=1;LW(276,86)=1;LW(276,87)=1;LW(276,88)=1;
    LW(276,89)=1;LW(276,90)=1;LW(276,91)=1;LW(276,92)=1;LW(276,93)=1;LW(276,94)=1;LW(276,95)=1;LW(276,96)=1;LW(276,97)=1;LW(276,98)=1;
    LW(276,99)=1;LW(276,100)=1;LW(276,101)=1;LW(276,102)=1;LW(276,103)=1;LW(276,104)=1;LW(276,105)=1;LW(276,106)=1;LW(276,107)=1;LW(276,108)=1;
    LW(276,109)=1;LW(276,110)=1;LW(276,111)=1;LW(276,112)=1;LW(276,113)=1;LW(276,114)=1;LW(276,115)=1;LW(276,116)=1;LW(276,117)=1;LW(276,118)=1;
    LW(276,119)=1;LW(276,120)=1;LW(276,121)=1;LW(276,122)=1;LW(276,123)=1;LW(276,124)=1;LW(276,125)=1;LW(276,126)=1;LW(276,127)=1;LW(276,128)=1;
    LW(276,129)=1;LW(276,130)=1;LW(276,131)=1;LW(276,132)=1;LW(276,133)=1;LW(276,134)=1;LW(276,135)=1;LW(276,136)=1;LW(276,137)=1;LW(276,138)=1;
    LW(276,139)=1;LW(276,140)=1;LW(276,141)=1;LW(276,142)=1;LW(276,143)=1;LW(276,144)=1;LW(276,145)=1;LW(276,146)=1;LW(276,147)=1;LW(276,148)=1;
    LW(276,149)=1;LW(276,150)=1;LW(276,151)=1;LW(276,152)=1;LW(276,153)=1;LW(276,154)=1;LW(276,155)=1;LW(276,156)=1;LW(276,157)=1;LW(276,158)=1;
    LW(276,159)=1;LW(276,160)=1;LW(276,161)=1;LW(276,162)=1;LW(276,163)=1;LW(276,164)=1;LW(276,165)=1;LW(276,166)=1;LW(276,167)=1;LW(276,168)=1;
    LW(276,169)=1;LW(276,170)=1;LW(276,171)=1;LW(276,172)=1;LW(276,173)=1;LW(276,174)=1;LW(276,175)=1;LW(276,176)=1;LW(276,177)=1;LW(276,178)=1;
    LW(276,179)=1;LW(276,180)=1;LW(276,181)=1;LW(276,182)=1;LW(276,183)=1;LW(276,184)=1;LW(276,185)=1;LW(276,186)=1;LW(276,187)=1;LW(276,188)=1;
    LW(276,189)=1;LW(276,190)=1;LW(276,191)=1;LW(276,192)=1;LW(276,193)=1;LW(276,194)=1;LW(276,195)=1;LW(276,196)=1;LW(276,197)=1;LW(276,198)=1;
    LW(276,199)=1;LW(276,200)=1;LW(276,201)=1;LW(276,202)=1;LW(276,203)=1;LW(276,204)=1;LW(276,205)=1;LW(276,206)=1;LW(276,207)=1;LW(276,208)=1;
    LW(276,209)=1;LW(276,210)=1;LW(276,211)=1;LW(276,212)=1;LW(276,213)=1;LW(276,214)=1;LW(276,215)=1;LW(276,216)=1;LW(276,217)=1;LW(276,218)=1;
    LW(276,221)=1;LW(276,222)=1;LW(276,223)=1;LW(276,227)=1;LW(276,228)=1;LW(277,13)=1;LW(277,14)=1;LW(277,17)=1;LW(277,18)=1;LW(277,19)=1;
    LW(277,20)=1;LW(277,21)=1;LW(277,22)=1;LW(277,23)=1;LW(277,24)=1;LW(277,25)=1;LW(277,26)=1;LW(277,27)=1;LW(277,28)=1;LW(277,29)=1;
    LW(277,30)=1;LW(277,31)=1;LW(277,32)=1;LW(277,33)=1;LW(277,34)=1;LW(277,35)=1;LW(277,36)=1;LW(277,37)=1;LW(277,38)=1;LW(277,39)=1;
    LW(277,40)=1;LW(277,41)=1;LW(277,42)=1;LW(277,43)=1;LW(277,44)=1;LW(277,45)=1;LW(277,46)=1;LW(277,47)=1;LW(277,48)=1;LW(277,49)=1;
    LW(277,50)=1;LW(277,51)=1;LW(277,52)=1;LW(277,53)=1;LW(277,54)=1;LW(277,55)=1;LW(277,56)=1;LW(277,57)=1;LW(277,58)=1;LW(277,59)=1;
    LW(277,60)=1;LW(277,61)=1;LW(277,62)=1;LW(277,63)=1;LW(277,64)=1;LW(277,65)=1;LW(277,66)=1;LW(277,67)=1;LW(277,68)=1;LW(277,69)=1;
    LW(277,70)=1;LW(277,71)=1;LW(277,72)=1;LW(277,73)=1;LW(277,74)=1;LW(277,75)=1;LW(277,76)=1;LW(277,77)=1;LW(277,78)=1;LW(277,79)=1;
    LW(277,80)=1;LW(277,81)=1;LW(277,82)=1;LW(277,83)=1;LW(277,84)=1;LW(277,85)=1;LW(277,86)=1;LW(277,87)=1;LW(277,88)=1;LW(277,89)=1;
    LW(277,90)=1;LW(277,91)=1;LW(277,92)=1;LW(277,93)=1;LW(277,94)=1;LW(277,95)=1;LW(277,96)=1;LW(277,97)=1;LW(277,98)=1;LW(277,99)=1;
    LW(277,100)=1;LW(277,101)=1;LW(277,102)=1;LW(277,103)=1;LW(277,104)=1;LW(277,105)=1;LW(277,106)=1;LW(277,107)=1;LW(277,108)=1;LW(277,109)=1;
    LW(277,110)=1;LW(277,111)=1;LW(277,112)=1;LW(277,113)=1;LW(277,114)=1;LW(277,115)=1;LW(277,116)=1;LW(277,117)=1;LW(277,118)=1;LW(277,119)=1;
    LW(277,120)=1;LW(277,121)=1;LW(277,122)=1;LW(277,123)=1;LW(277,124)=1;LW(277,125)=1;LW(277,126)=1;LW(277,127)=1;LW(277,128)=1;LW(277,129)=1;
    LW(277,130)=1;LW(277,131)=1;LW(277,132)=1;LW(277,133)=1;LW(277,134)=1;LW(277,135)=1;LW(277,136)=1;LW(277,137)=1;LW(277,138)=1;LW(277,139)=1;
    LW(277,140)=1;LW(277,141)=1;LW(277,142)=1;LW(277,143)=1;LW(277,144)=1;LW(277,145)=1;LW(277,146)=1;LW(277,147)=1;LW(277,148)=1;LW(277,149)=1;
    LW(277,150)=1;LW(277,151)=1;LW(277,152)=1;LW(277,153)=1;LW(277,154)=1;LW(277,155)=1;LW(277,156)=1;LW(277,157)=1;LW(277,158)=1;LW(277,159)=1;
    LW(277,160)=1;LW(277,161)=1;LW(277,162)=1;LW(277,163)=1;LW(277,164)=1;LW(277,165)=1;LW(277,166)=1;LW(277,167)=1;LW(277,168)=1;LW(277,169)=1;
    LW(277,170)=1;LW(277,171)=1;LW(277,172)=1;LW(277,173)=1;LW(277,174)=1;LW(277,175)=1;LW(277,176)=1;LW(277,177)=1;LW(277,178)=1;LW(277,179)=1;
    LW(277,180)=1;LW(277,181)=1;LW(277,182)=1;LW(277,183)=1;LW(277,184)=1;LW(277,185)=1;LW(277,186)=1;LW(277,187)=1;LW(277,188)=1;LW(277,189)=1;
    LW(277,190)=1;LW(277,191)=1;LW(277,192)=1;LW(277,193)=1;LW(277,194)=1;LW(277,195)=1;LW(277,196)=1;LW(277,197)=1;LW(277,198)=1;LW(277,199)=1;
    LW(277,200)=1;LW(277,201)=1;LW(277,202)=1;LW(277,203)=1;LW(277,204)=1;LW(277,205)=1;LW(277,206)=1;LW(277,207)=1;LW(277,208)=1;LW(277,209)=1;
    LW(277,210)=1;LW(277,211)=1;LW(277,212)=1;LW(277,213)=1;LW(277,214)=1;LW(277,215)=1;LW(277,216)=1;LW(277,217)=1;LW(277,218)=1;LW(277,219)=1;
    LW(277,220)=1;LW(277,221)=1;LW(277,222)=1;LW(277,223)=1;LW(277,224)=1;LW(277,225)=1;LW(277,226)=1;LW(277,227)=1;LW(277,228)=1;LW(277,229)=1;
    LW(277,230)=1;LW(277,235)=1;LW(278,6)=1;LW(278,7)=1;LW(278,8)=1;LW(278,9)=1;LW(278,10)=1;LW(278,11)=1;LW(278,12)=1;LW(278,13)=1;
    LW(278,14)=1;LW(278,15)=1;LW(278,16)=1;LW(278,17)=1;LW(278,18)=1;LW(278,19)=1;LW(278,20)=1;LW(278,21)=1;LW(278,22)=1;LW(278,23)=1;
    LW(278,24)=1;LW(278,25)=1;LW(278,26)=1;LW(278,27)=1;LW(278,28)=1;LW(278,29)=1;LW(278,30)=1;LW(278,31)=1;LW(278,32)=1;LW(278,33)=1;
    LW(278,34)=1;LW(278,35)=1;LW(278,36)=1;LW(278,37)=1;LW(278,38)=1;LW(278,39)=1;LW(278,40)=1;LW(278,41)=1;LW(278,42)=1;LW(278,43)=1;
    LW(278,44)=1;LW(278,45)=1;LW(278,46)=1;LW(278,47)=1;LW(278,48)=1;LW(278,49)=1;LW(278,50)=1;LW(278,51)=1;LW(278,52)=1;LW(278,53)=1;
    LW(278,54)=1;LW(278,55)=1;LW(278,56)=1;LW(278,57)=1;LW(278,58)=1;LW(278,59)=1;LW(278,60)=1;LW(278,61)=1;LW(278,62)=1;LW(278,63)=1;
    LW(278,64)=1;LW(278,65)=1;LW(278,66)=1;LW(278,67)=1;LW(278,68)=1;LW(278,69)=1;LW(278,70)=1;LW(278,71)=1;LW(278,72)=1;LW(278,73)=1;
    LW(278,74)=1;LW(278,75)=1;LW(278,76)=1;LW(278,77)=1;LW(278,78)=1;LW(278,79)=1;LW(278,80)=1;LW(278,81)=1;LW(278,82)=1;LW(278,83)=1;
    LW(278,84)=1;LW(278,85)=1;LW(278,86)=1;LW(278,87)=1;LW(278,88)=1;LW(278,89)=1;LW(278,90)=1;LW(278,91)=1;LW(278,92)=1;LW(278,93)=1;
    LW(278,94)=1;LW(278,95)=1;LW(278,96)=1;LW(278,97)=1;LW(278,98)=1;LW(278,99)=1;LW(278,100)=1;LW(278,101)=1;LW(278,102)=1;LW(278,103)=1;
    LW(278,104)=1;LW(278,105)=1;LW(278,106)=1;LW(278,107)=1;LW(278,108)=1;LW(278,109)=1;LW(278,110)=1;LW(278,111)=1;LW(278,112)=1;LW(278,113)=1;
    LW(278,114)=1;LW(278,115)=1;LW(278,116)=1;LW(278,117)=1;LW(278,118)=1;LW(278,119)=1;LW(278,120)=1;LW(278,121)=1;LW(278,122)=1;LW(278,123)=1;
    LW(278,124)=1;LW(278,125)=1;LW(278,126)=1;LW(278,127)=1;LW(278,128)=1;LW(278,129)=1;LW(278,130)=1;LW(278,131)=1;LW(278,132)=1;LW(278,133)=1;
    LW(278,134)=1;LW(278,135)=1;LW(278,136)=1;LW(278,137)=1;LW(278,138)=1;LW(278,139)=1;LW(278,140)=1;LW(278,141)=1;LW(278,142)=1;LW(278,143)=1;
    LW(278,144)=1;LW(278,145)=1;LW(278,146)=1;LW(278,147)=1;LW(278,148)=1;LW(278,149)=1;LW(278,150)=1;LW(278,151)=1;LW(278,152)=1;LW(278,153)=1;
    LW(278,154)=1;LW(278,155)=1;LW(278,156)=1;LW(278,157)=1;LW(278,158)=1;LW(278,159)=1;LW(278,160)=1;LW(278,161)=1;LW(278,162)=1;LW(278,163)=1;
    LW(278,164)=1;LW(278,165)=1;LW(278,166)=1;LW(278,167)=1;LW(278,168)=1;LW(278,169)=1;LW(278,170)=1;LW(278,171)=1;LW(278,172)=1;LW(278,173)=1;
    LW(278,174)=1;LW(278,175)=1;LW(278,176)=1;LW(278,177)=1;LW(278,178)=1;LW(278,179)=1;LW(278,180)=1;LW(278,181)=1;LW(278,182)=1;LW(278,183)=1;
    LW(278,184)=1;LW(278,185)=1;LW(278,186)=1;LW(278,187)=1;LW(278,188)=1;LW(278,189)=1;LW(278,190)=1;LW(278,191)=1;LW(278,192)=1;LW(278,193)=1;
    LW(278,194)=1;LW(278,195)=1;LW(278,196)=1;LW(278,197)=1;LW(278,198)=1;LW(278,199)=1;LW(278,200)=1;LW(278,201)=1;LW(278,202)=1;LW(278,203)=1;
    LW(278,204)=1;LW(278,205)=1;LW(278,206)=1;LW(278,207)=1;LW(278,208)=1;LW(278,209)=1;LW(278,210)=1;LW(278,211)=1;LW(278,212)=1;LW(278,213)=1;
    LW(278,214)=1;LW(278,215)=1;LW(278,216)=1;LW(278,217)=1;LW(278,218)=1;LW(278,219)=1;LW(278,220)=1;LW(278,221)=1;LW(278,222)=1;LW(278,223)=1;
    LW(278,224)=1;LW(278,225)=1;LW(278,226)=1;LW(278,227)=1;LW(278,228)=1;LW(278,229)=1;LW(278,230)=1;LW(278,231)=1;LW(278,234)=1;LW(278,235)=1;
    LW(278,236)=1;LW(278,237)=1;LW(278,238)=1;LW(278,239)=1;LW(278,240)=1;LW(278,241)=1;LW(278,242)=1;LW(279,5)=1;LW(279,6)=1;LW(279,7)=1;
    LW(279,8)=1;LW(279,9)=1;LW(279,10)=1;LW(279,11)=1;LW(279,12)=1;LW(279,13)=1;LW(279,14)=1;LW(279,15)=1;LW(279,16)=1;LW(279,17)=1;
    LW(279,18)=1;LW(279,19)=1;LW(279,20)=1;LW(279,21)=1;LW(279,22)=1;LW(279,23)=1;LW(279,24)=1;LW(279,25)=1;LW(279,26)=1;LW(279,27)=1;
    LW(279,28)=1;LW(279,29)=1;LW(279,30)=1;LW(279,31)=1;LW(279,32)=1;LW(279,33)=1;LW(279,34)=1;LW(279,35)=1;LW(279,36)=1;LW(279,37)=1;
    LW(279,38)=1;LW(279,39)=1;LW(279,40)=1;LW(279,41)=1;LW(279,42)=1;LW(279,43)=1;LW(279,44)=1;LW(279,45)=1;LW(279,46)=1;LW(279,47)=1;
    LW(279,48)=1;LW(279,49)=1;LW(279,50)=1;LW(279,51)=1;LW(279,52)=1;LW(279,53)=1;LW(279,54)=1;LW(279,55)=1;LW(279,56)=1;LW(279,57)=1;
    LW(279,58)=1;LW(279,59)=1;LW(279,60)=1;LW(279,61)=1;LW(279,62)=1;LW(279,63)=1;LW(279,64)=1;LW(279,65)=1;LW(279,66)=1;LW(279,67)=1;
    LW(279,68)=1;LW(279,69)=1;LW(279,70)=1;LW(279,71)=1;LW(279,72)=1;LW(279,73)=1;LW(279,74)=1;LW(279,75)=1;LW(279,76)=1;LW(279,77)=1;
    LW(279,78)=1;LW(279,79)=1;LW(279,80)=1;LW(279,81)=1;LW(279,82)=1;LW(279,83)=1;LW(279,84)=1;LW(279,85)=1;LW(279,86)=1;LW(279,87)=1;
    LW(279,88)=1;LW(279,89)=1;LW(279,90)=1;LW(279,91)=1;LW(279,92)=1;LW(279,93)=1;LW(279,94)=1;LW(279,95)=1;LW(279,96)=1;LW(279,97)=1;
    LW(279,98)=1;LW(279,99)=1;LW(279,100)=1;LW(279,101)=1;LW(279,102)=1;LW(279,103)=1;LW(279,104)=1;LW(279,105)=1;LW(279,106)=1;LW(279,107)=1;
    LW(279,108)=1;LW(279,109)=1;LW(279,110)=1;LW(279,111)=1;LW(279,112)=1;LW(279,113)=1;LW(279,114)=1;LW(279,115)=1;LW(279,116)=1;LW(279,117)=1;
    LW(279,118)=1;LW(279,119)=1;LW(279,120)=1;LW(279,121)=1;LW(279,122)=1;LW(279,123)=1;LW(279,124)=1;LW(279,125)=1;LW(279,126)=1;LW(279,127)=1;
    LW(279,128)=1;LW(279,129)=1;LW(279,130)=1;LW(279,131)=1;LW(279,132)=1;LW(279,133)=1;LW(279,134)=1;LW(279,135)=1;LW(279,136)=1;LW(279,137)=1;
    LW(279,138)=1;LW(279,139)=1;LW(279,140)=1;LW(279,141)=1;LW(279,142)=1;LW(279,143)=1;LW(279,144)=1;LW(279,145)=1;LW(279,146)=1;LW(279,147)=1;
    LW(279,148)=1;LW(279,149)=1;LW(279,150)=1;LW(279,151)=1;LW(279,152)=1;LW(279,153)=1;LW(279,154)=1;LW(279,155)=1;LW(279,156)=1;LW(279,157)=1;
    LW(279,158)=1;LW(279,159)=1;LW(279,160)=1;LW(279,161)=1;LW(279,162)=1;LW(279,163)=1;LW(279,164)=1;LW(279,165)=1;LW(279,166)=1;LW(279,167)=1;
    LW(279,168)=1;LW(279,169)=1;LW(279,170)=1;LW(279,171)=1;LW(279,172)=1;LW(279,173)=1;LW(279,174)=1;LW(279,175)=1;LW(279,176)=1;LW(279,177)=1;
    LW(279,178)=1;LW(279,179)=1;LW(279,180)=1;LW(279,181)=1;LW(279,182)=1;LW(279,183)=1;LW(279,184)=1;LW(279,185)=1;LW(279,186)=1;LW(279,187)=1;
    LW(279,188)=1;LW(279,189)=1;LW(279,190)=1;LW(279,191)=1;LW(279,192)=1;LW(279,193)=1;LW(279,194)=1;LW(279,195)=1;LW(279,196)=1;LW(279,197)=1;
    LW(279,198)=1;LW(279,199)=1;LW(279,200)=1;LW(279,201)=1;LW(279,202)=1;LW(279,203)=1;LW(279,204)=1;LW(279,205)=1;LW(279,206)=1;LW(279,207)=1;
    LW(279,208)=1;LW(279,209)=1;LW(279,210)=1;LW(279,211)=1;LW(279,212)=1;LW(279,213)=1;LW(279,214)=1;LW(279,215)=1;LW(279,216)=1;LW(279,217)=1;
    LW(279,218)=1;LW(279,219)=1;LW(279,220)=1;LW(279,221)=1;LW(279,222)=1;LW(279,223)=1;LW(279,224)=1;LW(279,225)=1;LW(279,226)=1;LW(279,227)=1;
    LW(279,228)=1;LW(279,229)=1;LW(279,230)=1;LW(279,231)=1;LW(279,232)=1;LW(279,233)=1;LW(279,234)=1;LW(279,235)=1;LW(279,236)=1;LW(279,237)=1;
    LW(279,238)=1;LW(279,239)=1;LW(279,240)=1;LW(279,241)=1;LW(279,242)=1;LW(279,243)=1;LW(279,245)=1;LW(279,246)=1;LW(280,4)=1;LW(280,5)=1;
    LW(280,6)=1;LW(280,7)=1;LW(280,8)=1;LW(280,9)=1;LW(280,10)=1;LW(280,11)=1;LW(280,12)=1;LW(280,13)=1;LW(280,14)=1;LW(280,15)=1;
    LW(280,16)=1;LW(280,17)=1;LW(280,18)=1;LW(280,19)=1;LW(280,20)=1;LW(280,21)=1;LW(280,22)=1;LW(280,23)=1;LW(280,24)=1;LW(280,25)=1;
    LW(280,26)=1;LW(280,27)=1;LW(280,28)=1;LW(280,29)=1;LW(280,30)=1;LW(280,31)=1;LW(280,32)=1;LW(280,33)=1;LW(280,34)=1;LW(280,35)=1;
    LW(280,36)=1;LW(280,37)=1;LW(280,38)=1;LW(280,39)=1;LW(280,40)=1;LW(280,41)=1;LW(280,42)=1;LW(280,43)=1;LW(280,44)=1;LW(280,45)=1;
    LW(280,46)=1;LW(280,47)=1;LW(280,48)=1;LW(280,49)=1;LW(280,50)=1;LW(280,51)=1;LW(280,52)=1;LW(280,53)=1;LW(280,54)=1;LW(280,55)=1;
    LW(280,56)=1;LW(280,57)=1;LW(280,58)=1;LW(280,59)=1;LW(280,60)=1;LW(280,61)=1;LW(280,62)=1;LW(280,63)=1;LW(280,64)=1;LW(280,65)=1;
    LW(280,66)=1;LW(280,67)=1;LW(280,68)=1;LW(280,69)=1;LW(280,70)=1;LW(280,71)=1;LW(280,72)=1;LW(280,73)=1;LW(280,74)=1;LW(280,75)=1;
    LW(280,76)=1;LW(280,77)=1;LW(280,78)=1;LW(280,79)=1;LW(280,80)=1;LW(280,81)=1;LW(280,82)=1;LW(280,83)=1;LW(280,84)=1;LW(280,85)=1;
    LW(280,86)=1;LW(280,87)=1;LW(280,88)=1;LW(280,89)=1;LW(280,90)=1;LW(280,91)=1;LW(280,92)=1;LW(280,93)=1;LW(280,94)=1;LW(280,95)=1;
    LW(280,96)=1;LW(280,97)=1;LW(280,98)=1;LW(280,99)=1;LW(280,100)=1;LW(280,101)=1;LW(280,102)=1;LW(280,103)=1;LW(280,104)=1;LW(280,105)=1;
    LW(280,106)=1;LW(280,107)=1;LW(280,108)=1;LW(280,109)=1;LW(280,110)=1;LW(280,111)=1;LW(280,112)=1;LW(280,113)=1;LW(280,114)=1;LW(280,115)=1;
    LW(280,116)=1;LW(280,117)=1;LW(280,118)=1;LW(280,119)=1;LW(280,120)=1;LW(280,121)=1;LW(280,122)=1;LW(280,123)=1;LW(280,124)=1;LW(280,125)=1;
    LW(280,126)=1;LW(280,127)=1;LW(280,128)=1;LW(280,129)=1;LW(280,130)=1;LW(280,131)=1;LW(280,132)=1;LW(280,133)=1;LW(280,134)=1;LW(280,135)=1;
    LW(280,136)=1;LW(280,137)=1;LW(280,138)=1;LW(280,139)=1;LW(280,140)=1;LW(280,141)=1;LW(280,142)=1;LW(280,143)=1;LW(280,144)=1;LW(280,145)=1;
    LW(280,146)=1;LW(280,147)=1;LW(280,148)=1;LW(280,149)=1;LW(280,150)=1;LW(280,151)=1;LW(280,152)=1;LW(280,153)=1;LW(280,154)=1;LW(280,155)=1;
    LW(280,156)=1;LW(280,157)=1;LW(280,158)=1;LW(280,159)=1;LW(280,160)=1;LW(280,161)=1;LW(280,162)=1;LW(280,163)=1;LW(280,164)=1;LW(280,165)=1;
    LW(280,166)=1;LW(280,167)=1;LW(280,168)=1;LW(280,169)=1;LW(280,170)=1;LW(280,171)=1;LW(280,172)=1;LW(280,173)=1;LW(280,174)=1;LW(280,175)=1;
    LW(280,176)=1;LW(280,177)=1;LW(280,178)=1;LW(280,179)=1;LW(280,180)=1;LW(280,181)=1;LW(280,182)=1;LW(280,183)=1;LW(280,184)=1;LW(280,185)=1;
    LW(280,186)=1;LW(280,187)=1;LW(280,188)=1;LW(280,189)=1;LW(280,190)=1;LW(280,191)=1;LW(280,192)=1;LW(280,193)=1;LW(280,194)=1;LW(280,195)=1;
    LW(280,196)=1;LW(280,197)=1;LW(280,198)=1;LW(280,199)=1;LW(280,200)=1;LW(280,201)=1;LW(280,202)=1;LW(280,203)=1;LW(280,204)=1;LW(280,205)=1;
    LW(280,206)=1;LW(280,207)=1;LW(280,208)=1;LW(280,209)=1;LW(280,210)=1;LW(280,211)=1;LW(280,212)=1;LW(280,213)=1;LW(280,214)=1;LW(280,215)=1;
    LW(280,216)=1;LW(280,217)=1;LW(280,218)=1;LW(280,219)=1;LW(280,220)=1;LW(280,221)=1;LW(280,222)=1;LW(280,223)=1;LW(280,224)=1;LW(280,225)=1;
    LW(280,226)=1;LW(280,227)=1;LW(280,228)=1;LW(280,229)=1;LW(280,230)=1;LW(280,231)=1;LW(280,232)=1;LW(280,233)=1;LW(280,234)=1;LW(280,235)=1;
    LW(280,236)=1;LW(280,237)=1;LW(280,238)=1;LW(280,239)=1;LW(280,240)=1;LW(280,241)=1;LW(280,242)=1;LW(280,243)=1;LW(280,244)=1;LW(280,245)=1;
    LW(280,246)=1;LW(280,247)=1;LW(281,1)=1;LW(281,2)=1;LW(281,3)=1;LW(281,4)=1;LW(281,5)=1;LW(281,6)=1;LW(281,7)=1;LW(281,8)=1;
    LW(281,9)=1;LW(281,10)=1;LW(281,11)=1;LW(281,12)=1;LW(281,13)=1;LW(281,14)=1;LW(281,15)=1;LW(281,16)=1;LW(281,17)=1;LW(281,18)=1;
    LW(281,19)=1;LW(281,20)=1;LW(281,21)=1;LW(281,22)=1;LW(281,23)=1;LW(281,24)=1;LW(281,25)=1;LW(281,26)=1;LW(281,27)=1;LW(281,28)=1;
    LW(281,29)=1;LW(281,30)=1;LW(281,31)=1;LW(281,32)=1;LW(281,33)=1;LW(281,34)=1;LW(281,35)=1;LW(281,36)=1;LW(281,37)=1;LW(281,38)=1;
    LW(281,39)=1;LW(281,40)=1;LW(281,41)=1;LW(281,42)=1;LW(281,43)=1;LW(281,44)=1;LW(281,45)=1;LW(281,46)=1;LW(281,47)=1;LW(281,48)=1;
    LW(281,49)=1;LW(281,50)=1;LW(281,51)=1;LW(281,52)=1;LW(281,53)=1;LW(281,54)=1;LW(281,55)=1;LW(281,56)=1;LW(281,57)=1;LW(281,58)=1;
    LW(281,59)=1;LW(281,60)=1;LW(281,61)=1;LW(281,62)=1;LW(281,63)=1;LW(281,64)=1;LW(281,65)=1;LW(281,66)=1;LW(281,67)=1;LW(281,68)=1;
    LW(281,69)=1;LW(281,70)=1;LW(281,71)=1;LW(281,72)=1;LW(281,73)=1;LW(281,74)=1;LW(281,75)=1;LW(281,76)=1;LW(281,77)=1;LW(281,78)=1;
    LW(281,79)=1;LW(281,80)=1;LW(281,81)=1;LW(281,82)=1;LW(281,83)=1;LW(281,84)=1;LW(281,85)=1;LW(281,86)=1;LW(281,87)=1;LW(281,88)=1;
    LW(281,89)=1;LW(281,90)=1;LW(281,91)=1;LW(281,92)=1;LW(281,93)=1;LW(281,94)=1;LW(281,95)=1;LW(281,96)=1;LW(281,97)=1;LW(281,98)=1;
    LW(281,99)=1;LW(281,100)=1;LW(281,101)=1;LW(281,102)=1;LW(281,103)=1;LW(281,104)=1;LW(281,105)=1;LW(281,106)=1;LW(281,107)=1;LW(281,108)=1;
    LW(281,109)=1;LW(281,110)=1;LW(281,111)=1;LW(281,112)=1;LW(281,113)=1;LW(281,114)=1;LW(281,115)=1;LW(281,116)=1;LW(281,117)=1;LW(281,118)=1;
    LW(281,119)=1;LW(281,120)=1;LW(281,121)=1;LW(281,122)=1;LW(281,123)=1;LW(281,124)=1;LW(281,125)=1;LW(281,126)=1;LW(281,127)=1;LW(281,128)=1;
    LW(281,129)=1;LW(281,130)=1;LW(281,131)=1;LW(281,132)=1;LW(281,133)=1;LW(281,134)=1;LW(281,135)=1;LW(281,136)=1;LW(281,137)=1;LW(281,138)=1;
    LW(281,139)=1;LW(281,140)=1;LW(281,141)=1;LW(281,142)=1;LW(281,143)=1;LW(281,144)=1;LW(281,145)=1;LW(281,146)=1;LW(281,147)=1;LW(281,148)=1;
    LW(281,149)=1;LW(281,150)=1;LW(281,151)=1;LW(281,152)=1;LW(281,153)=1;LW(281,154)=1;LW(281,155)=1;LW(281,156)=1;LW(281,157)=1;LW(281,158)=1;
    LW(281,159)=1;LW(281,160)=1;LW(281,161)=1;LW(281,162)=1;LW(281,163)=1;LW(281,164)=1;LW(281,165)=1;LW(281,166)=1;LW(281,167)=1;LW(281,168)=1;
    LW(281,169)=1;LW(281,170)=1;LW(281,171)=1;LW(281,172)=1;LW(281,173)=1;LW(281,174)=1;LW(281,175)=1;LW(281,176)=1;LW(281,177)=1;LW(281,178)=1;
    LW(281,179)=1;LW(281,180)=1;LW(281,181)=1;LW(281,182)=1;LW(281,183)=1;LW(281,184)=1;LW(281,185)=1;LW(281,186)=1;LW(281,187)=1;LW(281,188)=1;
    LW(281,189)=1;LW(281,190)=1;LW(281,191)=1;LW(281,192)=1;LW(281,193)=1;LW(281,194)=1;LW(281,195)=1;LW(281,196)=1;LW(281,197)=1;LW(281,198)=1;
    LW(281,199)=1;LW(281,200)=1;LW(281,201)=1;LW(281,202)=1;LW(281,203)=1;LW(281,204)=1;LW(281,205)=1;LW(281,206)=1;LW(281,207)=1;LW(281,208)=1;
    LW(281,209)=1;LW(281,210)=1;LW(281,211)=1;LW(281,212)=1;LW(281,213)=1;LW(281,214)=1;LW(281,215)=1;LW(281,216)=1;LW(281,217)=1;LW(281,218)=1;
    LW(281,219)=1;LW(281,220)=1;LW(281,221)=1;LW(281,222)=1;LW(281,223)=1;LW(281,224)=1;LW(281,225)=1;LW(281,226)=1;LW(281,227)=1;LW(281,228)=1;
    LW(281,229)=1;LW(281,230)=1;LW(281,231)=1;LW(281,232)=1;LW(281,233)=1;LW(281,234)=1;LW(281,235)=1;LW(281,236)=1;LW(281,237)=1;LW(281,238)=1;
    LW(281,239)=1;LW(281,240)=1;LW(281,241)=1;LW(281,242)=1;LW(281,243)=1;LW(281,244)=1;LW(281,245)=1;LW(281,246)=1;LW(281,247)=1;LW(281,248)=1;
    LW(282,1)=1;LW(282,2)=1;LW(282,3)=1;LW(282,4)=1;LW(282,5)=1;LW(282,6)=1;LW(282,7)=1;LW(282,8)=1;LW(282,9)=1;LW(282,10)=1;
    LW(282,11)=1;LW(282,12)=1;LW(282,13)=1;LW(282,14)=1;LW(282,15)=1;LW(282,16)=1;LW(282,17)=1;LW(282,18)=1;LW(282,19)=1;LW(282,20)=1;
    LW(282,21)=1;LW(282,22)=1;LW(282,23)=1;LW(282,24)=1;LW(282,25)=1;LW(282,26)=1;LW(282,27)=1;LW(282,28)=1;LW(282,29)=1;LW(282,30)=1;
    LW(282,31)=1;LW(282,32)=1;LW(282,33)=1;LW(282,34)=1;LW(282,35)=1;LW(282,36)=1;LW(282,37)=1;LW(282,38)=1;LW(282,39)=1;LW(282,40)=1;
    LW(282,41)=1;LW(282,42)=1;LW(282,43)=1;LW(282,44)=1;LW(282,45)=1;LW(282,46)=1;LW(282,47)=1;LW(282,48)=1;LW(282,49)=1;LW(282,50)=1;
    LW(282,51)=1;LW(282,52)=1;LW(282,53)=1;LW(282,54)=1;LW(282,55)=1;LW(282,56)=1;LW(282,57)=1;LW(282,58)=1;LW(282,59)=1;LW(282,60)=1;
    LW(282,61)=1;LW(282,62)=1;LW(282,63)=1;LW(282,64)=1;LW(282,65)=1;LW(282,66)=1;LW(282,67)=1;LW(282,68)=1;LW(282,69)=1;LW(282,70)=1;
    LW(282,71)=1;LW(282,72)=1;LW(282,73)=1;LW(282,74)=1;LW(282,75)=1;LW(282,76)=1;LW(282,77)=1;LW(282,78)=1;LW(282,79)=1;LW(282,80)=1;
    LW(282,81)=1;LW(282,82)=1;LW(282,83)=1;LW(282,84)=1;LW(282,85)=1;LW(282,86)=1;LW(282,87)=1;LW(282,88)=1;LW(282,89)=1;LW(282,90)=1;
    LW(282,91)=1;LW(282,92)=1;LW(282,93)=1;LW(282,94)=1;LW(282,95)=1;LW(282,96)=1;LW(282,97)=1;LW(282,98)=1;LW(282,99)=1;LW(282,100)=1;
    LW(282,101)=1;LW(282,102)=1;LW(282,103)=1;LW(282,104)=1;LW(282,105)=1;LW(282,106)=1;LW(282,107)=1;LW(282,108)=1;LW(282,109)=1;LW(282,110)=1;
    LW(282,111)=1;LW(282,112)=1;LW(282,113)=1;LW(282,114)=1;LW(282,115)=1;LW(282,116)=1;LW(282,117)=1;LW(282,118)=1;LW(282,119)=1;LW(282,120)=1;
    LW(282,121)=1;LW(282,122)=1;LW(282,123)=1;LW(282,124)=1;LW(282,125)=1;LW(282,126)=1;LW(282,127)=1;LW(282,128)=1;LW(282,129)=1;LW(282,130)=1;
    LW(282,131)=1;LW(282,132)=1;LW(282,133)=1;LW(282,134)=1;LW(282,135)=1;LW(282,136)=1;LW(282,137)=1;LW(282,138)=1;LW(282,139)=1;LW(282,140)=1;
    LW(282,141)=1;LW(282,142)=1;LW(282,143)=1;LW(282,144)=1;LW(282,145)=1;LW(282,146)=1;LW(282,147)=1;LW(282,148)=1;LW(282,149)=1;LW(282,150)=1;
    LW(282,151)=1;LW(282,152)=1;LW(282,153)=1;LW(282,154)=1;LW(282,155)=1;LW(282,156)=1;LW(282,157)=1;LW(282,158)=1;LW(282,159)=1;LW(282,160)=1;
    LW(282,161)=1;LW(282,162)=1;LW(282,163)=1;LW(282,164)=1;LW(282,165)=1;LW(282,166)=1;LW(282,167)=1;LW(282,168)=1;LW(282,169)=1;LW(282,170)=1;
    LW(282,171)=1;LW(282,172)=1;LW(282,173)=1;LW(282,174)=1;LW(282,175)=1;LW(282,176)=1;LW(282,177)=1;LW(282,178)=1;LW(282,179)=1;LW(282,180)=1;
    LW(282,181)=1;LW(282,182)=1;LW(282,183)=1;LW(282,184)=1;LW(282,185)=1;LW(282,186)=1;LW(282,187)=1;LW(282,188)=1;LW(282,189)=1;LW(282,190)=1;
    LW(282,191)=1;LW(282,192)=1;LW(282,193)=1;LW(282,194)=1;LW(282,195)=1;LW(282,196)=1;LW(282,197)=1;LW(282,198)=1;LW(282,199)=1;LW(282,200)=1;
    LW(282,201)=1;LW(282,202)=1;LW(282,203)=1;LW(282,204)=1;LW(282,205)=1;LW(282,206)=1;LW(282,207)=1;LW(282,208)=1;LW(282,209)=1;LW(282,210)=1;
    LW(282,211)=1;LW(282,212)=1;LW(282,213)=1;LW(282,214)=1;LW(282,215)=1;LW(282,216)=1;LW(282,217)=1;LW(282,218)=1;LW(282,219)=1;LW(282,220)=1;
    LW(282,221)=1;LW(282,222)=1;LW(282,223)=1;LW(282,224)=1;LW(282,225)=1;LW(282,226)=1;LW(282,227)=1;LW(282,228)=1;LW(282,229)=1;LW(282,230)=1;
    LW(282,231)=1;LW(282,232)=1;LW(282,233)=1;LW(282,234)=1;LW(282,235)=1;LW(282,236)=1;LW(282,237)=1;LW(282,238)=1;LW(282,239)=1;LW(282,240)=1;
    LW(282,241)=1;LW(282,242)=1;LW(282,243)=1;LW(282,244)=1;LW(282,245)=1;LW(282,246)=1;LW(282,247)=1;LW(282,248)=1;LW(282,249)=1;LW(282,250)=1;
    LW(282,251)=1;LW(282,252)=1;LW(282,253)=1;LW(282,254)=1;LW(282,255)=1;LW(283,1)=1;LW(283,2)=1;LW(283,3)=1;LW(283,4)=1;LW(283,5)=1;
    LW(283,6)=1;LW(283,7)=1;LW(283,8)=1;LW(283,9)=1;LW(283,10)=1;LW(283,11)=1;LW(283,12)=1;LW(283,13)=1;LW(283,14)=1;LW(283,15)=1;
    LW(283,16)=1;LW(283,17)=1;LW(283,18)=1;LW(283,19)=1;LW(283,20)=1;LW(283,21)=1;LW(283,22)=1;LW(283,23)=1;LW(283,24)=1;LW(283,25)=1;
    LW(283,26)=1;LW(283,27)=1;LW(283,28)=1;LW(283,29)=1;LW(283,30)=1;LW(283,31)=1;LW(283,32)=1;LW(283,33)=1;LW(283,34)=1;LW(283,35)=1;
    LW(283,36)=1;LW(283,37)=1;LW(283,38)=1;LW(283,39)=1;LW(283,40)=1;LW(283,41)=1;LW(283,42)=1;LW(283,43)=1;LW(283,44)=1;LW(283,45)=1;
    LW(283,46)=1;LW(283,47)=1;LW(283,48)=1;LW(283,49)=1;LW(283,50)=1;LW(283,51)=1;LW(283,52)=1;LW(283,53)=1;LW(283,54)=1;LW(283,55)=1;
    LW(283,56)=1;LW(283,57)=1;LW(283,58)=1;LW(283,59)=1;LW(283,60)=1;LW(283,61)=1;LW(283,62)=1;LW(283,63)=1;LW(283,64)=1;LW(283,65)=1;
    LW(283,66)=1;LW(283,67)=1;LW(283,68)=1;LW(283,69)=1;LW(283,70)=1;LW(283,71)=1;LW(283,72)=1;LW(283,73)=1;LW(283,74)=1;LW(283,75)=1;
    LW(283,76)=1;LW(283,77)=1;LW(283,78)=1;LW(283,79)=1;LW(283,80)=1;LW(283,81)=1;LW(283,82)=1;LW(283,83)=1;LW(283,84)=1;LW(283,85)=1;
    LW(283,86)=1;LW(283,87)=1;LW(283,88)=1;LW(283,89)=1;LW(283,90)=1;LW(283,91)=1;LW(283,92)=1;LW(283,93)=1;LW(283,94)=1;LW(283,95)=1;
    LW(283,96)=1;LW(283,97)=1;LW(283,98)=1;LW(283,99)=1;LW(283,100)=1;LW(283,101)=1;LW(283,102)=1;LW(283,103)=1;LW(283,104)=1;LW(283,105)=1;
    LW(283,106)=1;LW(283,107)=1;LW(283,108)=1;LW(283,109)=1;LW(283,110)=1;LW(283,111)=1;LW(283,112)=1;LW(283,113)=1;LW(283,114)=1;LW(283,115)=1;
    LW(283,116)=1;LW(283,117)=1;LW(283,118)=1;LW(283,119)=1;LW(283,120)=1;LW(283,121)=1;LW(283,122)=1;LW(283,123)=1;LW(283,124)=1;LW(283,125)=1;
    LW(283,126)=1;LW(283,127)=1;LW(283,128)=1;LW(283,129)=1;LW(283,130)=1;LW(283,131)=1;LW(283,132)=1;LW(283,133)=1;LW(283,134)=1;LW(283,135)=1;
    LW(283,136)=1;LW(283,137)=1;LW(283,138)=1;LW(283,139)=1;LW(283,140)=1;LW(283,141)=1;LW(283,142)=1;LW(283,143)=1;LW(283,144)=1;LW(283,145)=1;
    LW(283,146)=1;LW(283,147)=1;LW(283,148)=1;LW(283,149)=1;LW(283,150)=1;LW(283,151)=1;LW(283,152)=1;LW(283,153)=1;LW(283,154)=1;LW(283,155)=1;
    LW(283,156)=1;LW(283,157)=1;LW(283,158)=1;LW(283,159)=1;LW(283,160)=1;LW(283,161)=1;LW(283,162)=1;LW(283,163)=1;LW(283,164)=1;LW(283,165)=1;
    LW(283,166)=1;LW(283,167)=1;LW(283,168)=1;LW(283,169)=1;LW(283,170)=1;LW(283,171)=1;LW(283,172)=1;LW(283,173)=1;LW(283,174)=1;LW(283,175)=1;
    LW(283,176)=1;LW(283,177)=1;LW(283,178)=1;LW(283,179)=1;LW(283,180)=1;LW(283,181)=1;LW(283,182)=1;LW(283,183)=1;LW(283,184)=1;LW(283,185)=1;
    LW(283,186)=1;LW(283,187)=1;LW(283,188)=1;LW(283,189)=1;LW(283,190)=1;LW(283,191)=1;LW(283,192)=1;LW(283,193)=1;LW(283,194)=1;LW(283,195)=1;
    LW(283,196)=1;LW(283,197)=1;LW(283,198)=1;LW(283,199)=1;LW(283,200)=1;LW(283,201)=1;LW(283,202)=1;LW(283,203)=1;LW(283,204)=1;LW(283,205)=1;
    LW(283,206)=1;LW(283,207)=1;LW(283,208)=1;LW(283,209)=1;LW(283,210)=1;LW(283,211)=1;LW(283,212)=1;LW(283,213)=1;LW(283,214)=1;LW(283,215)=1;
    LW(283,216)=1;LW(283,217)=1;LW(283,218)=1;LW(283,219)=1;LW(283,220)=1;LW(283,221)=1;LW(283,222)=1;LW(283,223)=1;LW(283,224)=1;LW(283,225)=1;
    LW(283,226)=1;LW(283,227)=1;LW(283,228)=1;LW(283,229)=1;LW(283,230)=1;LW(283,231)=1;LW(283,232)=1;LW(283,233)=1;LW(283,234)=1;LW(283,235)=1;
    LW(283,236)=1;LW(283,237)=1;LW(283,238)=1;LW(283,239)=1;LW(283,240)=1;LW(283,241)=1;LW(283,242)=1;LW(283,243)=1;LW(283,244)=1;LW(283,245)=1;
    LW(283,246)=1;LW(283,247)=1;LW(283,248)=1;LW(283,249)=1;LW(283,250)=1;LW(283,251)=1;LW(283,252)=1;LW(283,253)=1;LW(283,254)=1;LW(283,255)=1;
    LW(283,256)=1;LW(283,257)=1;LW(284,1)=1;LW(284,2)=1;LW(284,3)=1;LW(284,4)=1;LW(284,5)=1;LW(284,6)=1;LW(284,7)=1;LW(284,8)=1;
    LW(284,9)=1;LW(284,10)=1;LW(284,11)=1;LW(284,12)=1;LW(284,13)=1;LW(284,14)=1;LW(284,15)=1;LW(284,16)=1;LW(284,17)=1;LW(284,18)=1;
    LW(284,19)=1;LW(284,20)=1;LW(284,21)=1;LW(284,22)=1;LW(284,23)=1;LW(284,24)=1;LW(284,25)=1;LW(284,26)=1;LW(284,27)=1;LW(284,28)=1;
    LW(284,29)=1;LW(284,30)=1;LW(284,31)=1;LW(284,32)=1;LW(284,33)=1;LW(284,34)=1;LW(284,35)=1;LW(284,36)=1;LW(284,37)=1;LW(284,38)=1;
    LW(284,39)=1;LW(284,40)=1;LW(284,41)=1;LW(284,42)=1;LW(284,43)=1;LW(284,44)=1;LW(284,45)=1;LW(284,46)=1;LW(284,47)=1;LW(284,48)=1;
    LW(284,49)=1;LW(284,50)=1;LW(284,51)=1;LW(284,52)=1;LW(284,53)=1;LW(284,54)=1;LW(284,55)=1;LW(284,56)=1;LW(284,57)=1;LW(284,58)=1;
    LW(284,59)=1;LW(284,60)=1;LW(284,61)=1;LW(284,62)=1;LW(284,63)=1;LW(284,64)=1;LW(284,65)=1;LW(284,66)=1;LW(284,67)=1;LW(284,68)=1;
    LW(284,69)=1;LW(284,70)=1;LW(284,71)=1;LW(284,72)=1;LW(284,73)=1;LW(284,74)=1;LW(284,75)=1;LW(284,76)=1;LW(284,77)=1;LW(284,78)=1;
    LW(284,79)=1;LW(284,80)=1;LW(284,81)=1;LW(284,89)=1;LW(284,90)=1;LW(284,91)=1;LW(284,92)=1;LW(284,93)=1;LW(284,94)=1;LW(284,95)=1;
    LW(284,96)=1;LW(284,97)=1;LW(284,98)=1;LW(284,99)=1;LW(284,100)=1;LW(284,101)=1;LW(284,102)=1;LW(284,103)=1;LW(284,104)=1;LW(284,105)=1;
    LW(284,106)=1;LW(284,107)=1;LW(284,108)=1;LW(284,109)=1;LW(284,110)=1;LW(284,111)=1;LW(284,112)=1;LW(284,113)=1;LW(284,114)=1;LW(284,115)=1;
    LW(284,116)=1;LW(284,117)=1;LW(284,118)=1;LW(284,119)=1;LW(284,120)=1;LW(284,121)=1;LW(284,122)=1;LW(284,123)=1;LW(284,124)=1;LW(284,125)=1;
    LW(284,126)=1;LW(284,127)=1;LW(284,128)=1;LW(284,129)=1;LW(284,130)=1;LW(284,131)=1;LW(284,132)=1;LW(284,133)=1;LW(284,134)=1;LW(284,135)=1;
    LW(284,136)=1;LW(284,137)=1;LW(284,138)=1;LW(284,139)=1;LW(284,140)=1;LW(284,141)=1;LW(284,142)=1;LW(284,143)=1;LW(284,144)=1;LW(284,145)=1;
    LW(284,146)=1;LW(284,147)=1;LW(284,148)=1;LW(284,149)=1;LW(284,150)=1;LW(284,151)=1;LW(284,152)=1;LW(284,153)=1;LW(284,154)=1;LW(284,155)=1;
    LW(284,156)=1;LW(284,157)=1;LW(284,158)=1;LW(284,159)=1;LW(284,160)=1;LW(284,161)=1;LW(284,162)=1;LW(284,163)=1;LW(284,164)=1;LW(284,165)=1;
    LW(284,166)=1;LW(284,167)=1;LW(284,168)=1;LW(284,169)=1;LW(284,170)=1;LW(284,171)=1;LW(284,172)=1;LW(284,173)=1;LW(284,174)=1;LW(284,175)=1;
    LW(284,176)=1;LW(284,177)=1;LW(284,178)=1;LW(284,179)=1;LW(284,180)=1;LW(284,181)=1;LW(284,182)=1;LW(284,183)=1;LW(284,184)=1;LW(284,185)=1;
    LW(284,186)=1;LW(284,187)=1;LW(284,188)=1;LW(284,189)=1;LW(284,190)=1;LW(284,191)=1;LW(284,192)=1;LW(284,193)=1;LW(284,194)=1;LW(284,195)=1;
    LW(284,196)=1;LW(284,197)=1;LW(284,198)=1;LW(284,199)=1;LW(284,200)=1;LW(284,201)=1;LW(284,202)=1;LW(284,203)=1;LW(284,204)=1;LW(284,205)=1;
    LW(284,206)=1;LW(284,207)=1;LW(284,208)=1;LW(284,209)=1;LW(284,210)=1;LW(284,211)=1;LW(284,212)=1;LW(284,213)=1;LW(284,214)=1;LW(284,215)=1;
    LW(284,216)=1;LW(284,217)=1;LW(284,218)=1;LW(284,219)=1;LW(284,220)=1;LW(284,221)=1;LW(284,222)=1;LW(284,223)=1;LW(284,224)=1;LW(284,225)=1;
    LW(284,226)=1;LW(284,227)=1;LW(284,228)=1;LW(284,229)=1;LW(284,230)=1;LW(284,231)=1;LW(284,232)=1;LW(284,233)=1;LW(284,234)=1;LW(284,235)=1;
    LW(284,236)=1;LW(284,237)=1;LW(284,238)=1;LW(284,239)=1;LW(284,240)=1;LW(284,241)=1;LW(284,242)=1;LW(284,243)=1;LW(284,244)=1;LW(284,245)=1;
    LW(284,246)=1;LW(284,247)=1;LW(284,248)=1;LW(284,249)=1;LW(284,250)=1;LW(284,251)=1;LW(284,252)=1;LW(284,253)=1;LW(284,254)=1;LW(284,255)=1;
    LW(284,256)=1;LW(284,257)=1;LW(284,258)=1;LW(284,259)=1;LW(284,260)=1;LW(284,261)=1;LW(285,1)=1;LW(285,2)=1;LW(285,3)=1;LW(285,4)=1;
    LW(285,5)=1;LW(285,6)=1;LW(285,7)=1;LW(285,8)=1;LW(285,9)=1;LW(285,10)=1;LW(285,11)=1;LW(285,12)=1;LW(285,13)=1;LW(285,14)=1;
    LW(285,15)=1;LW(285,16)=1;LW(285,17)=1;LW(285,18)=1;LW(285,19)=1;LW(285,20)=1;LW(285,21)=1;LW(285,22)=1;LW(285,23)=1;LW(285,24)=1;
    LW(285,25)=1;LW(285,26)=1;LW(285,27)=1;LW(285,28)=1;LW(285,29)=1;LW(285,30)=1;LW(285,31)=1;LW(285,32)=1;LW(285,33)=1;LW(285,34)=1;
    LW(285,35)=1;LW(285,36)=1;LW(285,37)=1;LW(285,38)=1;LW(285,39)=1;LW(285,40)=1;LW(285,41)=1;LW(285,42)=1;LW(285,43)=1;LW(285,44)=1;
    LW(285,45)=1;LW(285,46)=1;LW(285,47)=1;LW(285,48)=1;LW(285,49)=1;LW(285,50)=1;LW(285,51)=1;LW(285,52)=1;LW(285,53)=1;LW(285,54)=1;
    LW(285,57)=1;LW(285,58)=1;LW(285,59)=1;LW(285,60)=1;LW(285,61)=1;LW(285,62)=1;LW(285,63)=1;LW(285,64)=1;LW(285,65)=1;LW(285,66)=1;
    LW(285,70)=1;LW(285,71)=1;LW(285,72)=1;LW(285,73)=1;LW(285,74)=1;LW(285,75)=1;LW(285,76)=1;LW(285,77)=1;LW(285,78)=1;LW(285,79)=1;
    LW(285,80)=1;LW(285,89)=1;LW(285,90)=1;LW(285,91)=1;LW(285,92)=1;LW(285,93)=1;LW(285,94)=1;LW(285,95)=1;LW(285,96)=1;LW(285,97)=1;
    LW(285,98)=1;LW(285,99)=1;LW(285,100)=1;LW(285,101)=1;LW(285,102)=1;LW(285,103)=1;LW(285,104)=1;LW(285,105)=1;LW(285,106)=1;LW(285,107)=1;
    LW(285,108)=1;LW(285,109)=1;LW(285,110)=1;LW(285,111)=1;LW(285,112)=1;LW(285,113)=1;LW(285,114)=1;LW(285,115)=1;LW(285,116)=1;LW(285,117)=1;
    LW(285,119)=1;LW(285,120)=1;LW(285,121)=1;LW(285,122)=1;LW(285,123)=1;LW(285,124)=1;LW(285,125)=1;LW(285,126)=1;LW(285,127)=1;LW(285,128)=1;
    LW(285,129)=1;LW(285,136)=1;LW(285,137)=1;LW(285,140)=1;LW(285,141)=1;LW(285,142)=1;LW(285,149)=1;LW(285,150)=1;LW(285,151)=1;LW(285,152)=1;
    LW(285,153)=1;LW(285,154)=1;LW(285,155)=1;LW(285,156)=1;LW(285,157)=1;LW(285,158)=1;LW(285,159)=1;LW(285,160)=1;LW(285,161)=1;LW(285,162)=1;
    LW(285,163)=1;LW(285,164)=1;LW(285,165)=1;LW(285,166)=1;LW(285,167)=1;LW(285,168)=1;LW(285,169)=1;LW(285,170)=1;LW(285,176)=1;LW(285,177)=1;
    LW(285,179)=1;LW(285,180)=1;LW(285,181)=1;LW(285,182)=1;LW(285,183)=1;LW(285,184)=1;LW(285,185)=1;LW(285,186)=1;LW(285,187)=1;LW(285,188)=1;
    LW(285,189)=1;LW(285,190)=1;LW(285,191)=1;LW(285,192)=1;LW(285,193)=1;LW(285,194)=1;LW(285,195)=1;LW(285,196)=1;LW(285,197)=1;LW(285,198)=1;
    LW(285,199)=1;LW(285,200)=1;LW(285,201)=1;LW(285,202)=1;LW(285,203)=1;LW(285,204)=1;LW(285,205)=1;LW(285,206)=1;LW(285,207)=1;LW(285,208)=1;
    LW(285,209)=1;LW(285,210)=1;LW(285,211)=1;LW(285,212)=1;LW(285,213)=1;LW(285,214)=1;LW(285,215)=1;LW(285,216)=1;LW(285,217)=1;LW(285,218)=1;
    LW(285,219)=1;LW(285,220)=1;LW(285,221)=1;LW(285,222)=1;LW(285,223)=1;LW(285,224)=1;LW(285,225)=1;LW(285,226)=1;LW(285,227)=1;LW(285,228)=1;
    LW(285,229)=1;LW(285,230)=1;LW(285,231)=1;LW(285,232)=1;LW(285,233)=1;LW(285,234)=1;LW(285,235)=1;LW(285,236)=1;LW(285,237)=1;LW(285,238)=1;
    LW(285,239)=1;LW(285,240)=1;LW(285,241)=1;LW(285,242)=1;LW(285,243)=1;LW(285,244)=1;LW(285,245)=1;LW(285,246)=1;LW(285,247)=1;LW(285,248)=1;
    LW(285,249)=1;LW(285,250)=1;LW(285,251)=1;LW(285,252)=1;LW(285,253)=1;LW(285,254)=1;LW(285,255)=1;LW(285,256)=1;LW(285,257)=1;LW(285,258)=1;
    LW(285,259)=1;LW(285,260)=1;LW(285,261)=1;LW(285,262)=1;LW(285,263)=1;LW(285,264)=1;LW(285,265)=1;LW(285,266)=1;LW(285,267)=1;LW(285,268)=1;
    LW(286,1)=1;LW(286,2)=1;LW(286,3)=1;LW(286,4)=1;LW(286,5)=1;LW(286,6)=1;LW(286,7)=1;LW(286,8)=1;LW(286,9)=1;LW(286,10)=1;
    LW(286,11)=1;LW(286,12)=1;LW(286,13)=1;LW(286,14)=1;LW(286,15)=1;LW(286,16)=1;LW(286,17)=1;LW(286,18)=1;LW(286,19)=1;LW(286,20)=1;
    LW(286,21)=1;LW(286,22)=1;LW(286,23)=1;LW(286,24)=1;LW(286,25)=1;LW(286,26)=1;LW(286,27)=1;LW(286,28)=1;LW(286,29)=1;LW(286,30)=1;
    LW(286,31)=1;LW(286,32)=1;LW(286,33)=1;LW(286,34)=1;LW(286,35)=1;LW(286,36)=1;LW(286,37)=1;LW(286,38)=1;LW(286,39)=1;LW(286,40)=1;
    LW(286,41)=1;LW(286,42)=1;LW(286,43)=1;LW(286,44)=1;LW(286,45)=1;LW(286,46)=1;LW(286,47)=1;LW(286,50)=1;LW(286,51)=1;LW(286,52)=1;
    LW(286,53)=1;LW(286,58)=1;LW(286,63)=1;LW(286,64)=1;LW(286,65)=1;LW(286,71)=1;LW(286,72)=1;LW(286,73)=1;LW(286,78)=1;LW(286,79)=1;
    LW(286,80)=1;LW(286,88)=1;LW(286,89)=1;LW(286,90)=1;LW(286,91)=1;LW(286,92)=1;LW(286,93)=1;LW(286,94)=1;LW(286,95)=1;LW(286,96)=1;
    LW(286,97)=1;LW(286,98)=1;LW(286,99)=1;LW(286,100)=1;LW(286,101)=1;LW(286,102)=1;LW(286,104)=1;LW(286,105)=1;LW(286,106)=1;LW(286,107)=1;
    LW(286,108)=1;LW(286,109)=1;LW(286,113)=1;LW(286,114)=1;LW(286,115)=1;LW(286,116)=1;LW(286,120)=1;LW(286,121)=1;LW(286,122)=1;LW(286,123)=1;
    LW(286,124)=1;LW(286,150)=1;LW(286,151)=1;LW(286,152)=1;LW(286,153)=1;LW(286,154)=1;LW(286,155)=1;LW(286,156)=1;LW(286,157)=1;LW(286,158)=1;
    LW(286,159)=1;LW(286,160)=1;LW(286,161)=1;LW(286,162)=1;LW(286,163)=1;LW(286,164)=1;LW(286,165)=1;LW(286,166)=1;LW(286,167)=1;LW(286,168)=1;
    LW(286,169)=1;LW(286,182)=1;LW(286,183)=1;LW(286,184)=1;LW(286,185)=1;LW(286,186)=1;LW(286,187)=1;LW(286,188)=1;LW(286,189)=1;LW(286,190)=1;
    LW(286,191)=1;LW(286,192)=1;LW(286,193)=1;LW(286,194)=1;LW(286,195)=1;LW(286,196)=1;LW(286,197)=1;LW(286,198)=1;LW(286,199)=1;LW(286,200)=1;
    LW(286,201)=1;LW(286,202)=1;LW(286,203)=1;LW(286,204)=1;LW(286,205)=1;LW(286,206)=1;LW(286,207)=1;LW(286,208)=1;LW(286,209)=1;LW(286,210)=1;
    LW(286,211)=1;LW(286,212)=1;LW(286,213)=1;LW(286,214)=1;LW(286,215)=1;LW(286,216)=1;LW(286,217)=1;LW(286,218)=1;LW(286,219)=1;LW(286,220)=1;
    LW(286,221)=1;LW(286,222)=1;LW(286,223)=1;LW(286,224)=1;LW(286,225)=1;LW(286,226)=1;LW(286,227)=1;LW(286,228)=1;LW(286,229)=1;LW(286,230)=1;
    LW(286,231)=1;LW(286,232)=1;LW(286,233)=1;LW(286,234)=1;LW(286,235)=1;LW(286,236)=1;LW(286,237)=1;LW(286,238)=1;LW(286,239)=1;LW(286,240)=1;
    LW(286,241)=1;LW(286,242)=1;LW(286,243)=1;LW(286,244)=1;LW(286,245)=1;LW(286,246)=1;LW(286,247)=1;LW(286,248)=1;LW(286,249)=1;LW(286,250)=1;
    LW(286,251)=1;LW(286,252)=1;LW(286,253)=1;LW(286,254)=1;LW(286,255)=1;LW(286,256)=1;LW(286,257)=1;LW(286,258)=1;LW(286,259)=1;LW(286,260)=1;
    LW(286,261)=1;LW(286,262)=1;LW(286,263)=1;LW(286,264)=1;LW(286,265)=1;LW(286,266)=1;LW(286,267)=1;LW(286,268)=1;LW(286,269)=1;LW(287,1)=1;
    LW(287,2)=1;LW(287,3)=1;LW(287,4)=1;LW(287,5)=1;LW(287,6)=1;LW(287,7)=1;LW(287,8)=1;LW(287,9)=1;LW(287,10)=1;LW(287,11)=1;
    LW(287,12)=1;LW(287,13)=1;LW(287,14)=1;LW(287,15)=1;LW(287,16)=1;LW(287,17)=1;LW(287,18)=1;LW(287,19)=1;LW(287,20)=1;LW(287,21)=1;
    LW(287,22)=1;LW(287,23)=1;LW(287,24)=1;LW(287,25)=1;LW(287,26)=1;LW(287,27)=1;LW(287,28)=1;LW(287,29)=1;LW(287,30)=1;LW(287,31)=1;
    LW(287,32)=1;LW(287,33)=1;LW(287,34)=1;LW(287,35)=1;LW(287,36)=1;LW(287,37)=1;LW(287,38)=1;LW(287,39)=1;LW(287,40)=1;LW(287,41)=1;
    LW(287,42)=1;LW(287,43)=1;LW(287,44)=1;LW(287,45)=1;LW(287,46)=1;LW(287,63)=1;LW(287,64)=1;LW(287,65)=1;LW(287,79)=1;LW(287,80)=1;
    LW(287,88)=1;LW(287,89)=1;LW(287,90)=1;LW(287,91)=1;LW(287,92)=1;LW(287,95)=1;LW(287,96)=1;LW(287,97)=1;LW(287,98)=1;LW(287,99)=1;
    LW(287,100)=1;LW(287,101)=1;LW(287,102)=1;LW(287,106)=1;LW(287,107)=1;LW(287,108)=1;LW(287,114)=1;LW(287,115)=1;LW(287,120)=1;LW(287,121)=1;
    LW(287,122)=1;LW(287,123)=1;LW(287,151)=1;LW(287,152)=1;LW(287,153)=1;LW(287,154)=1;LW(287,155)=1;LW(287,156)=1;LW(287,157)=1;LW(287,160)=1;
    LW(287,161)=1;LW(287,162)=1;LW(287,163)=1;LW(287,164)=1;LW(287,165)=1;LW(287,166)=1;LW(287,167)=1;LW(287,168)=1;LW(287,183)=1;LW(287,184)=1;
    LW(287,185)=1;LW(287,186)=1;LW(287,187)=1;LW(287,188)=1;LW(287,189)=1;LW(287,190)=1;LW(287,191)=1;LW(287,192)=1;LW(287,193)=1;LW(287,195)=1;
    LW(287,196)=1;LW(287,197)=1;LW(287,198)=1;LW(287,199)=1;LW(287,200)=1;LW(287,201)=1;LW(287,202)=1;LW(287,203)=1;LW(287,204)=1;LW(287,205)=1;
    LW(287,206)=1;LW(287,207)=1;LW(287,208)=1;LW(287,209)=1;LW(287,210)=1;LW(287,211)=1;LW(287,212)=1;LW(287,213)=1;LW(287,214)=1;LW(287,215)=1;
    LW(287,216)=1;LW(287,217)=1;LW(287,218)=1;LW(287,219)=1;LW(287,220)=1;LW(287,221)=1;LW(287,222)=1;LW(287,223)=1;LW(287,224)=1;LW(287,225)=1;
    LW(287,226)=1;LW(287,227)=1;LW(287,228)=1;LW(287,229)=1;LW(287,230)=1;LW(287,231)=1;LW(287,232)=1;LW(287,233)=1;LW(287,234)=1;LW(287,235)=1;
    LW(287,236)=1;LW(287,237)=1;LW(287,238)=1;LW(287,239)=1;LW(287,240)=1;LW(287,241)=1;LW(287,242)=1;LW(287,243)=1;LW(287,244)=1;LW(287,245)=1;
    LW(287,246)=1;LW(287,247)=1;LW(287,248)=1;LW(287,249)=1;LW(287,250)=1;LW(287,251)=1;LW(287,252)=1;LW(287,253)=1;LW(287,254)=1;LW(287,255)=1;
    LW(287,256)=1;LW(287,257)=1;LW(287,258)=1;LW(287,259)=1;LW(287,260)=1;LW(287,261)=1;LW(287,262)=1;LW(287,263)=1;LW(287,264)=1;LW(287,265)=1;
    LW(287,266)=1;LW(287,267)=1;LW(287,268)=1;LW(287,269)=1;LW(287,270)=1;LW(288,1)=1;LW(288,2)=1;LW(288,3)=1;LW(288,4)=1;LW(288,5)=1;
    LW(288,6)=1;LW(288,7)=1;LW(288,8)=1;LW(288,9)=1;LW(288,10)=1;LW(288,11)=1;LW(288,12)=1;LW(288,13)=1;LW(288,14)=1;LW(288,15)=1;
    LW(288,16)=1;LW(288,17)=1;LW(288,18)=1;LW(288,19)=1;LW(288,20)=1;LW(288,21)=1;LW(288,22)=1;LW(288,23)=1;LW(288,24)=1;LW(288,25)=1;
    LW(288,26)=1;LW(288,27)=1;LW(288,28)=1;LW(288,29)=1;LW(288,30)=1;LW(288,31)=1;LW(288,32)=1;LW(288,33)=1;LW(288,34)=1;LW(288,35)=1;
    LW(288,36)=1;LW(288,37)=1;LW(288,38)=1;LW(288,39)=1;LW(288,40)=1;LW(288,41)=1;LW(288,44)=1;LW(288,45)=1;LW(288,46)=1;LW(288,64)=1;
    LW(288,65)=1;LW(288,66)=1;LW(288,79)=1;LW(288,80)=1;LW(288,89)=1;LW(288,90)=1;LW(288,91)=1;LW(288,95)=1;LW(288,96)=1;LW(288,97)=1;
    LW(288,98)=1;LW(288,99)=1;LW(288,100)=1;LW(288,101)=1;LW(288,102)=1;LW(288,115)=1;LW(288,121)=1;LW(288,122)=1;LW(288,123)=1;LW(288,151)=1;
    LW(288,152)=1;LW(288,153)=1;LW(288,154)=1;LW(288,155)=1;LW(288,156)=1;LW(288,162)=1;LW(288,163)=1;LW(288,164)=1;LW(288,165)=1;LW(288,166)=1;
    LW(288,167)=1;LW(288,168)=1;LW(288,184)=1;LW(288,185)=1;LW(288,189)=1;LW(288,196)=1;LW(288,197)=1;LW(288,198)=1;LW(288,199)=1;LW(288,200)=1;
    LW(288,201)=1;LW(288,202)=1;LW(288,203)=1;LW(288,204)=1;LW(288,205)=1;LW(288,206)=1;LW(288,207)=1;LW(288,208)=1;LW(288,209)=1;LW(288,210)=1;
    LW(288,211)=1;LW(288,212)=1;LW(288,213)=1;LW(288,214)=1;LW(288,215)=1;LW(288,216)=1;LW(288,217)=1;LW(288,218)=1;LW(288,219)=1;LW(288,220)=1;
    LW(288,221)=1;LW(288,222)=1;LW(288,223)=1;LW(288,224)=1;LW(288,225)=1;LW(288,226)=1;LW(288,227)=1;LW(288,228)=1;LW(288,229)=1;LW(288,230)=1;
    LW(288,231)=1;LW(288,232)=1;LW(288,233)=1;LW(288,234)=1;LW(288,235)=1;LW(288,236)=1;LW(288,237)=1;LW(288,238)=1;LW(288,239)=1;LW(288,240)=1;
    LW(288,241)=1;LW(288,242)=1;LW(288,243)=1;LW(288,244)=1;LW(288,245)=1;LW(288,246)=1;LW(288,247)=1;LW(288,248)=1;LW(288,249)=1;LW(288,250)=1;
    LW(288,251)=1;LW(288,252)=1;LW(288,253)=1;LW(288,254)=1;LW(288,255)=1;LW(288,256)=1;LW(288,257)=1;LW(288,258)=1;LW(288,259)=1;LW(288,260)=1;
    LW(288,261)=1;LW(288,262)=1;LW(288,263)=1;LW(288,264)=1;LW(288,265)=1;LW(288,266)=1;LW(288,267)=1;LW(288,268)=1;LW(288,269)=1;LW(288,270)=1;
    LW(289,1)=1;LW(289,2)=1;LW(289,3)=1;LW(289,4)=1;LW(289,5)=1;LW(289,6)=1;LW(289,7)=1;LW(289,8)=1;LW(289,9)=1;LW(289,10)=1;
    LW(289,11)=1;LW(289,12)=1;LW(289,13)=1;LW(289,14)=1;LW(289,15)=1;LW(289,16)=1;LW(289,17)=1;LW(289,18)=1;LW(289,19)=1;LW(289,20)=1;
    LW(289,21)=1;LW(289,22)=1;LW(289,23)=1;LW(289,24)=1;LW(289,25)=1;LW(289,26)=1;LW(289,27)=1;LW(289,28)=1;LW(289,29)=1;LW(289,30)=1;
    LW(289,31)=1;LW(289,32)=1;LW(289,33)=1;LW(289,34)=1;LW(289,35)=1;LW(289,36)=1;LW(289,37)=1;LW(289,38)=1;LW(289,39)=1;LW(289,40)=1;
    LW(289,44)=1;LW(289,45)=1;LW(289,46)=1;LW(289,64)=1;LW(289,65)=1;LW(289,66)=1;LW(289,67)=1;LW(289,79)=1;LW(289,80)=1;LW(289,89)=1;
    LW(289,90)=1;LW(289,91)=1;LW(289,92)=1;LW(289,96)=1;LW(289,97)=1;LW(289,98)=1;LW(289,99)=1;LW(289,100)=1;LW(289,101)=1;LW(289,153)=1;
    LW(289,154)=1;LW(289,155)=1;LW(289,163)=1;LW(289,164)=1;LW(289,165)=1;LW(289,166)=1;LW(289,167)=1;LW(289,168)=1;LW(289,169)=1;LW(289,203)=1;
    LW(289,204)=1;LW(289,205)=1;LW(289,206)=1;LW(289,209)=1;LW(289,210)=1;LW(289,211)=1;LW(289,212)=1;LW(289,213)=1;LW(289,216)=1;LW(289,217)=1;
    LW(289,218)=1;LW(289,219)=1;LW(289,222)=1;LW(289,223)=1;LW(289,224)=1;LW(289,225)=1;LW(289,226)=1;LW(289,227)=1;LW(289,228)=1;LW(289,229)=1;
    LW(289,230)=1;LW(289,231)=1;LW(289,232)=1;LW(289,233)=1;LW(289,234)=1;LW(289,235)=1;LW(289,236)=1;LW(289,237)=1;LW(289,238)=1;LW(289,239)=1;
    LW(289,240)=1;LW(289,241)=1;LW(289,242)=1;LW(289,243)=1;LW(289,244)=1;LW(289,245)=1;LW(289,246)=1;LW(289,247)=1;LW(289,248)=1;LW(289,249)=1;
    LW(289,250)=1;LW(289,251)=1;LW(289,252)=1;LW(289,253)=1;LW(289,254)=1;LW(289,255)=1;LW(289,256)=1;LW(289,257)=1;LW(289,258)=1;LW(289,259)=1;
    LW(289,260)=1;LW(289,261)=1;LW(289,262)=1;LW(289,263)=1;LW(289,264)=1;LW(289,265)=1;LW(289,266)=1;LW(289,267)=1;LW(289,268)=1;LW(289,269)=1;
    LW(289,270)=1;LW(290,1)=1;LW(290,2)=1;LW(290,3)=1;LW(290,4)=1;LW(290,5)=1;LW(290,6)=1;LW(290,7)=1;LW(290,8)=1;LW(290,9)=1;
    LW(290,10)=1;LW(290,11)=1;LW(290,12)=1;LW(290,13)=1;LW(290,14)=1;LW(290,15)=1;LW(290,16)=1;LW(290,17)=1;LW(290,18)=1;LW(290,19)=1;
    LW(290,29)=1;LW(290,30)=1;LW(290,31)=1;LW(290,32)=1;LW(290,33)=1;LW(290,34)=1;LW(290,38)=1;LW(290,44)=1;LW(290,45)=1;LW(290,46)=1;
    LW(290,65)=1;LW(290,66)=1;LW(290,67)=1;LW(290,79)=1;LW(290,89)=1;LW(290,90)=1;LW(290,91)=1;LW(290,92)=1;LW(290,97)=1;LW(290,98)=1;
    LW(290,99)=1;LW(290,100)=1;LW(290,164)=1;LW(290,165)=1;LW(290,166)=1;LW(290,167)=1;LW(290,168)=1;LW(290,169)=1;LW(290,224)=1;LW(290,225)=1;
    LW(290,226)=1;LW(290,227)=1;LW(290,228)=1;LW(290,231)=1;LW(290,232)=1;LW(290,233)=1;LW(290,234)=1;LW(290,235)=1;LW(290,236)=1;LW(290,237)=1;
    LW(290,238)=1;LW(290,239)=1;LW(290,240)=1;LW(290,241)=1;LW(290,242)=1;LW(290,243)=1;LW(290,244)=1;LW(290,245)=1;LW(290,246)=1;LW(290,247)=1;
    LW(290,248)=1;LW(290,249)=1;LW(290,250)=1;LW(290,251)=1;LW(290,252)=1;LW(290,253)=1;LW(290,254)=1;LW(290,255)=1;LW(290,256)=1;LW(290,257)=1;
    LW(290,258)=1;LW(290,259)=1;LW(290,260)=1;LW(290,261)=1;LW(290,262)=1;LW(290,263)=1;LW(290,264)=1;LW(290,265)=1;LW(290,266)=1;LW(290,267)=1;
    LW(290,268)=1;LW(290,269)=1;LW(290,270)=1;LW(291,1)=1;LW(291,2)=1;LW(291,3)=1;LW(291,4)=1;LW(291,5)=1;LW(291,6)=1;LW(291,7)=1;
    LW(291,8)=1;LW(291,9)=1;LW(291,10)=1;LW(291,11)=1;LW(291,12)=1;LW(291,13)=1;LW(291,14)=1;LW(291,15)=1;LW(291,16)=1;LW(291,17)=1;
    LW(291,18)=1;LW(291,29)=1;LW(291,30)=1;LW(291,31)=1;LW(291,32)=1;LW(291,33)=1;LW(291,45)=1;LW(291,89)=1;LW(291,90)=1;LW(291,91)=1;
    LW(291,98)=1;LW(291,99)=1;LW(291,164)=1;LW(291,165)=1;LW(291,166)=1;LW(291,167)=1;LW(291,168)=1;LW(291,225)=1;LW(291,232)=1;LW(291,233)=1;
    LW(291,234)=1;LW(291,235)=1;LW(291,236)=1;LW(291,237)=1;LW(291,238)=1;LW(291,239)=1;LW(291,240)=1;LW(291,241)=1;LW(291,242)=1;LW(291,243)=1;
    LW(291,244)=1;LW(291,245)=1;LW(291,246)=1;LW(291,247)=1;LW(291,248)=1;LW(291,249)=1;LW(291,250)=1;LW(291,251)=1;LW(291,252)=1;LW(291,253)=1;
    LW(291,254)=1;LW(291,255)=1;LW(291,256)=1;LW(291,257)=1;LW(291,258)=1;LW(291,259)=1;LW(291,260)=1;LW(291,261)=1;LW(291,262)=1;LW(291,263)=1;
    LW(291,264)=1;LW(291,265)=1;LW(291,266)=1;LW(291,267)=1;LW(291,268)=1;LW(291,269)=1;LW(291,270)=1;LW(292,1)=1;LW(292,2)=1;LW(292,3)=1;
    LW(292,4)=1;LW(292,5)=1;LW(292,6)=1;LW(292,9)=1;LW(292,10)=1;LW(292,11)=1;LW(292,12)=1;LW(292,13)=1;LW(292,89)=1;LW(292,90)=1;
    LW(292,91)=1;LW(292,97)=1;LW(292,98)=1;LW(292,99)=1;LW(292,166)=1;LW(292,232)=1;LW(292,233)=1;LW(292,242)=1;LW(292,243)=1;LW(292,244)=1;
    LW(292,245)=1;LW(292,246)=1;LW(292,247)=1;LW(292,248)=1;LW(292,249)=1;LW(292,250)=1;LW(292,251)=1;LW(292,252)=1;LW(292,253)=1;LW(292,254)=1;
    LW(292,255)=1;LW(292,256)=1;LW(292,257)=1;LW(292,258)=1;LW(292,259)=1;LW(292,260)=1;LW(292,261)=1;LW(292,262)=1;LW(292,263)=1;LW(292,264)=1;
    LW(292,265)=1;LW(292,266)=1;LW(292,267)=1;LW(292,268)=1;LW(292,269)=1;LW(292,270)=1;LW(293,1)=1;LW(293,2)=1;LW(293,3)=1;LW(293,4)=1;
    LW(293,5)=1;LW(293,6)=1;LW(293,9)=1;LW(293,10)=1;LW(293,11)=1;LW(293,12)=1;LW(293,13)=1;LW(293,89)=1;LW(293,90)=1;LW(293,91)=1;
    LW(293,97)=1;LW(293,98)=1;LW(293,166)=1;LW(293,232)=1;LW(293,233)=1;LW(293,242)=1;LW(293,243)=1;LW(293,244)=1;LW(293,245)=1;LW(293,246)=1;
    LW(293,247)=1;LW(293,248)=1;LW(293,249)=1;LW(293,250)=1;LW(293,251)=1;LW(293,252)=1;LW(293,253)=1;LW(293,254)=1;LW(293,255)=1;LW(293,256)=1;
    LW(293,257)=1;LW(293,258)=1;LW(293,259)=1;LW(293,260)=1;LW(293,261)=1;LW(293,262)=1;LW(293,263)=1;LW(293,264)=1;LW(293,265)=1;LW(293,266)=1;
    LW(293,267)=1;LW(293,268)=1;LW(293,269)=1;LW(293,270)=1;LW(294,1)=1;LW(294,2)=1;LW(294,3)=1;LW(294,4)=1;LW(294,5)=1;LW(294,6)=1;
    LW(294,9)=1;LW(294,10)=1;LW(294,11)=1;LW(294,12)=1;LW(294,13)=1;LW(294,89)=1;LW(294,90)=1;LW(294,91)=1;LW(294,97)=1;LW(294,98)=1;
    LW(294,99)=1;LW(294,233)=1;LW(294,242)=1;LW(294,243)=1;LW(294,244)=1;LW(294,245)=1;LW(294,246)=1;LW(294,247)=1;LW(294,248)=1;LW(294,249)=1;
    LW(294,250)=1;LW(294,251)=1;LW(294,252)=1;LW(294,253)=1;LW(294,254)=1;LW(294,255)=1;LW(294,256)=1;LW(294,257)=1;LW(294,258)=1;LW(294,259)=1;
    LW(294,260)=1;LW(294,261)=1;LW(294,262)=1;LW(294,263)=1;LW(294,264)=1;LW(294,265)=1;LW(294,266)=1;LW(294,267)=1;LW(294,268)=1;LW(294,269)=1;
    LW(294,270)=1;LW(295,1)=1;LW(295,2)=1;LW(295,3)=1;LW(295,4)=1;LW(295,5)=1;LW(295,6)=1;LW(295,10)=1;LW(295,11)=1;LW(295,12)=1;
    LW(295,90)=1;LW(295,91)=1;LW(295,243)=1;LW(295,244)=1;LW(295,245)=1;LW(295,246)=1;LW(295,247)=1;LW(295,248)=1;LW(295,249)=1;LW(295,250)=1;
    LW(295,251)=1;LW(295,252)=1;LW(295,253)=1;LW(295,254)=1;LW(295,255)=1;LW(295,256)=1;LW(295,257)=1;LW(295,258)=1;LW(295,259)=1;LW(295,260)=1;
    LW(295,261)=1;LW(295,262)=1;LW(295,263)=1;LW(295,264)=1;LW(295,265)=1;LW(295,266)=1;LW(295,267)=1;LW(295,268)=1;LW(295,269)=1;LW(295,270)=1;
    LW(296,1)=1;LW(296,2)=1;LW(296,3)=1;LW(296,4)=1;LW(296,5)=1;LW(296,249)=1;LW(296,250)=1;LW(296,251)=1;LW(296,252)=1;LW(296,253)=1;
    LW(296,254)=1;LW(296,255)=1;LW(296,256)=1;LW(296,257)=1;LW(296,258)=1;LW(296,259)=1;LW(296,260)=1;LW(296,261)=1;LW(296,262)=1;LW(296,263)=1;
    LW(296,264)=1;LW(296,265)=1;LW(296,266)=1;LW(296,267)=1;LW(296,268)=1;LW(296,269)=1;LW(296,270)=1;LW(297,251)=1;LW(297,252)=1;LW(297,253)=1;
    LW(297,254)=1;LW(297,255)=1;LW(297,256)=1;LW(297,257)=1;LW(297,258)=1;LW(297,259)=1;LW(297,260)=1;LW(297,261)=1;LW(297,262)=1;LW(297,263)=1;
    LW(297,264)=1;LW(297,265)=1;LW(297,266)=1;LW(297,267)=1;LW(297,268)=1;LW(297,269)=1;LW(297,270)=1;LW(298,256)=1;LW(298,257)=1;LW(298,258)=1;
    LW(298,259)=1;LW(298,260)=1;LW(298,261)=1;LW(298,262)=1;LW(298,263)=1;LW(298,264)=1;LW(298,265)=1;LW(298,266)=1;LW(298,267)=1;LW(298,268)=1;
    LW(298,269)=1;LW(298,270)=1;LW(299,256)=1;LW(299,257)=1;LW(299,258)=1;LW(299,261)=1;LW(299,262)=1;LW(299,263)=1;LW(299,264)=1;LW(299,265)=1;
    LW(299,266)=1;LW(299,267)=1;LW(299,268)=1;LW(299,269)=1;LW(299,270)=1;LW(300,256)=1;LW(300,257)=1;LW(300,258)=1;LW(300,261)=1;LW(300,262)=1;
    LW(300,263)=1;LW(300,264)=1;LW(300,265)=1;LW(300,266)=1;LW(300,267)=1;LW(300,268)=1;LW(300,269)=1;LW(300,270)=1;LW(301,152)=1;LW(301,153)=1;
    LW(301,255)=1;LW(301,256)=1;LW(301,257)=1;LW(301,261)=1;LW(301,262)=1;LW(301,263)=1;LW(301,264)=1;LW(301,265)=1;LW(301,266)=1;LW(301,267)=1;
    LW(301,268)=1;LW(301,269)=1;LW(301,270)=1;LW(302,152)=1;LW(302,153)=1;LW(302,256)=1;LW(302,257)=1;LW(302,261)=1;LW(302,262)=1;LW(302,263)=1;
    LW(302,264)=1;LW(302,265)=1;LW(302,266)=1;LW(302,267)=1;LW(302,268)=1;LW(302,269)=1;LW(302,270)=1;LW(303,152)=1;LW(303,153)=1;LW(303,154)=1;
    LW(303,262)=1;LW(303,263)=1;LW(303,264)=1;LW(303,265)=1;LW(303,266)=1;LW(303,267)=1;LW(303,268)=1;LW(303,269)=1;LW(303,270)=1;LW(304,152)=1;
    LW(304,153)=1;LW(304,154)=1;LW(304,155)=1;LW(304,263)=1;LW(304,264)=1;LW(304,265)=1;LW(304,266)=1;LW(304,267)=1;LW(304,268)=1;LW(304,269)=1;
    LW(304,270)=1;LW(305,152)=1;LW(305,153)=1;LW(305,154)=1;LW(305,155)=1;LW(305,263)=1;LW(305,264)=1;LW(305,265)=1;LW(305,266)=1;LW(305,267)=1;
    LW(305,268)=1;LW(305,269)=1;LW(305,270)=1;LW(306,152)=1;LW(306,153)=1;LW(306,154)=1;LW(306,155)=1;LW(306,262)=1;LW(306,263)=1;LW(306,264)=1;
    LW(306,265)=1;LW(306,266)=1;LW(306,267)=1;LW(306,268)=1;LW(306,269)=1;LW(306,270)=1;LW(307,151)=1;LW(307,152)=1;LW(307,153)=1;LW(307,154)=1;
    LW(307,261)=1;LW(307,262)=1;LW(307,263)=1;LW(307,264)=1;LW(307,265)=1;LW(307,266)=1;LW(307,267)=1;LW(308,151)=1;LW(308,152)=1;LW(308,153)=1;
    LW(308,154)=1;LW(308,259)=1;LW(308,260)=1;LW(308,261)=1;LW(308,262)=1;LW(308,263)=1;LW(308,264)=1;LW(308,265)=1;LW(308,266)=1;LW(309,258)=1;
    LW(309,259)=1;LW(309,260)=1;LW(309,261)=1;LW(309,262)=1;LW(309,263)=1;LW(309,264)=1;LW(309,265)=1;LW(310,258)=1;LW(310,259)=1;LW(310,260)=1;
    LW(310,261)=1;LW(310,262)=1;LW(310,263)=1;LW(310,264)=1;LW(310,265)=1;LW(311,101)=1;LW(311,102)=1;LW(311,258)=1;LW(311,259)=1;LW(311,260)=1;
    LW(311,261)=1;LW(311,262)=1;LW(311,263)=1;LW(311,264)=1;LW(312,100)=1;LW(312,101)=1;LW(312,102)=1;LW(312,103)=1;LW(312,258)=1;LW(312,259)=1;
    LW(312,260)=1;LW(312,261)=1;LW(312,262)=1;LW(313,100)=1;LW(313,101)=1;LW(313,102)=1;LW(313,258)=1;LW(313,259)=1;LW(313,260)=1;LW(313,261)=1;
    LW(313,262)=1;LW(314,100)=1;LW(314,101)=1;LW(314,102)=1;LW(314,258)=1;LW(314,259)=1;LW(314,260)=1;LW(314,261)=1;LW(315,100)=1;LW(315,101)=1;
    LW(315,102)=1;LW(315,258)=1;LW(315,259)=1;LW(315,260)=1;LW(315,261)=1;LW(316,100)=1;LW(316,101)=1;LW(316,102)=1;LW(316,259)=1;LW(316,260)=1;
    LW(317,101)=1;LW(317,102)=1;LW(317,103)=1;LW(318,101)=1;LW(318,102)=1;LW(318,103)=1;LW(318,104)=1;LW(319,101)=1;LW(319,102)=1;LW(319,103)=1;
    LW(319,104)=1;LW(320,101)=1;LW(320,102)=1;LW(320,103)=1;LW(321,100)=1;LW(321,101)=1;LW(321,102)=1;LW(322,99)=1;LW(322,100)=1;LW(322,101)=1;
    LW(322,102)=1;LW(323,100)=1;LW(323,101)=1;LW(323,102)=1;LW(323,103)=1;LW(324,100)=1;LW(324,101)=1;LW(324,102)=1;LW(324,103)=1;LW(324,104)=1;
    LW(325,101)=1;LW(325,102)=1;LW(325,103)=1;LW(325,104)=1;LW(326,101)=1;LW(326,102)=1;LW(326,103)=1;LW(326,104)=1;LW(327,101)=1;LW(327,102)=1;
    LW(327,103)=1;LW(327,104)=1;LW(328,101)=1;LW(328,102)=1;LW(328,103)=1;LW(329,102)=1;LW(329,103)=1;
    
    idotx=ceil((x_request-x_min)/(x_max-x_min)*ndotx);
    if idotx==0
        idotx=1;
    end
    idoty=ceil((y_request-y_min)/(y_max-y_min)*ndoty);
    if idoty==0
        idoty=1;
    end
    
    LWOut=LW(idotx,idoty);
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [xy W]=GaussQuadCircle(diameter)
	xyW_standard=[	0.002826114	0.002826069	0.000110742	;
					0.036715186	0.002818485	0.000685881	;
					0.142478702	0.002708944	0.001461138	;
					0.309741132	0.00221853	0.001446592	;
					0.457879042	0.001135335	0.000440357	;
					0.002826114	0.036714599	0.000687727	;
					0.036715186	0.036616068	0.004259454	;
					0.142478702	0.035192981	0.009073948	;
					0.309741132	0.028821812	0.008983611	;
					0.457879042	0.014749598	0.002734699	;
					0.002826114	0.142476426	0.001524313	;
					0.036715186	0.142094059	0.009440868	;
					0.142478702	0.136571561	0.020111952	;
					0.309741132	0.111847299	0.019911726	;
					0.457879042	0.057237994	0.006061324	;
					0.002826114	0.309736184	0.001842738	;
					0.036715186	0.308904938	0.011413041	;
					0.142478702	0.296899321	0.024313287	;
					0.309741132	0.243150088	0.024071235	;
					0.457879042	0.124432359	0.007327519	;
					0.002826114	0.457871727	0.001096133	;
					0.036715186	0.456642927	0.006788925	;
					0.142478702	0.438895459	0.014462499	;
					0.309741132	0.359439925	0.014318516	;
					0.457879042	0.183943827	0.004358696	];
	
	nPointsStd=size(xyW_standard,1);
	nPointsAll=4*nPointsStd;
	xy=zeros(nPointsAll,2);
	W=zeros(nPointsAll);
	xymultiplier=[1 1];
	for iRep=1:4
		if iRep==1
			xymultiplier=[1 1];
		elseif iRep==2
			xymultiplier=[1 -1];
		elseif iRep==3
			xymultiplier=[-1 1];
		elseif iRep==4
			xymultiplier=[-1 -1];
		end
		for iPointsStd=1:nPointsStd
			for dim=1:2
				xy(nPointsStd*(iRep-1)+iPointsStd,dim)=xyW_standard(iPointsStd,dim)*xymultiplier(dim)*diameter;
                %disp(['xy(' num2str(nPointsStd*(iRep-1)+iPointsStd) ',' num2str(dim) ')=' num2str(xy(4*(iRep-1)+iPointsStd,dim))]);
                %1;
			end
			W(nPointsStd*(iRep-1)+iPointsStd)=xyW_standard(iPointsStd,3)*diameter^2;
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

%{
tt=loadsinglelong([TimeStampedName '-Slave-' 'tt' '-' int2txt(tt) '.txt']);
t_time=loadsinglefloat([TimeStampedName '-Slave-' 't_time' '-' int2txt(tt) '.txt']);
v_ssp=loadmatrixfloat([TimeStampedName '-Slave-' 'v_ssp' '-' int2txt(tt) '.txt']);
x_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'x_sp' '-' int2txt(tt) '.txt']);
F_sp=loadcellmatrixfloat([TimeStampedName '-Slave-' 'F_sp' '-' int2txt(tt) '.txt']);
A_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'A_sp' '-' int2txt(tt) '.txt']);
t_sp=loadmatrixfloat([TimeStampedName '-Slave-' 't_sp' '-' int2txt(tt) '.txt']);
s_sp=loadmatrixfloat([TimeStampedName '-Slave-' 's_sp' '-' int2txt(tt) '.txt']);
p_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'p_sp' '-' int2txt(tt) '.txt']);
r1_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r1_sp' '-' int2txt(tt) '.txt']);
r2_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'r2_sp' '-' int2txt(tt) '.txt']);
F_rollerX=loadmatrixfloat([TimeStampedName '-Slave-' 'F_rollerX' '-' int2txt(tt) '.txt']);
F_rollerY=loadmatrixfloat([TimeStampedName '-Slave-' 'F_rollerY' '-' int2txt(tt) '.txt']);
E_acc=loadmatrixfloat([TimeStampedName '-Slave-' 'E_acc' '-' int2txt(tt) '.txt']);
e_pl_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'e_pl_sp' '-' int2txt(tt) '.txt']);
sigma_global_big=loadmatrixfloat([TimeStampedName '-Slave-' 'sigma_global_big' '-' int2txt(tt) '.txt']);
e_t_global_big=loadmatrixfloat([TimeStampedName '-Slave-' 'e_t_global_big' '-' int2txt(tt) '.txt']);
e_pl_global_big=loadmatrixfloat([TimeStampedName '-Slave-' 'e_pl_global_big' '-' int2txt(tt) '.txt']);
alphahp=loadmatrixfloat([TimeStampedName '-Slave-' 'alphahp' '-' int2txt(tt) '.txt']);
f_final_vect=loadmatrixfloat([TimeStampedName '-Slave-' 'f_final_vect' '-' int2txt(tt) '.txt']);
surfacewithfmax=loadmatrixfloat([TimeStampedName '-Slave-' 'surfacewithfmax' '-' int2txt(tt) '.txt']);
sigma_local_big=loadmatrixfloat([TimeStampedName '-Slave-' 'sigma_local_big' '-' int2txt(tt) '.txt']);
DispPump=loadsinglefloat([TimeStampedName '-Slave-' 'DispPump' '-' int2txt(tt) '.txt']);
evaltimes=loadmatrixfloat([TimeStampedName '-Slave-' 'evaltimes' '-' int2txt(tt) '.txt']);
stackvars=loadmatrixfloat([TimeStampedName '-Slave-' 'stackvars' '-' int2txt(tt) '.txt']);
duration=loadmatrixfloat([TimeStampedName '-Slave-' 'duration' '-' int2txt(tt) '.txt']);
x_crack=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crack' '-' int2txt(tt) '.txt']);
x_cracktop=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_cracktop' '-' int2txt(tt) '.txt']);
x_crackbot=loadcellmatrixfloat([TimeStampedName '-Slave-' 'x_crackbot' '-' int2txt(tt) '.txt']);
dudx_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'dudx_sp' '-' int2txt(tt) '.txt']);
W_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'W_sp' '-' int2txt(tt) '.txt']);
thetacrackrtl=loadmatrixfloat([TimeStampedName '-Slave-' 'thetacrackrtl' '-' int2txt(tt) '.txt']);
thetacrack=loadmatrixfloat([TimeStampedName '-Slave-' 'thetacrack' '-' int2txt(tt) '.txt']);
pforce_sp=loadmatrixfloat([TimeStampedName '-Slave-' 'pforce_sp' '-' int2txt(tt) '.txt']);
sigmainf=loadsinglefloat([TimeStampedName '-Slave-' 'sigmainf' '-' int2txt(tt) '.txt']);
G=loadsinglefloat([TimeStampedName '-Slave-' 'G' '-' int2txt(tt) '.txt']);
Ga=loadsinglefloat([TimeStampedName '-Slave-' 'Ga' '-' int2txt(tt) '.txt']);
Grelativeerror=loadsinglefloat([TimeStampedName '-Slave-' 'Grelativeerror' '-' int2txt(tt) '.txt']);
ntforce_si=loadmatrixfloat([TimeStampedName '-Slave-' 'ntforce_si' '-' int2txt(tt) '.txt']);
%asdf=loadmatrixfloat([TimeStampedName '-Slave-' 'asdf' '-' int2txt(tt) '.txt']);
%asdf=loadmatrixfloat([TimeStampedName char(47) 'asdf' '-' int2txt(tt) '.txt']);
%}

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%------------------------------------------------------------------------ START - ALTMANY EXPORT FIG - START ---------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%{
%switchable1
function [imageData, alpha] = export_fig(varargin) %#ok<*STRCL1>
%EXPORT_FIG  Exports figures in a publication-quality format
%
% Examples:
%   imageData = export_fig
%   [imageData, alpha] = export_fig
%   export_fig filename
%   export_fig filename -format1 -format2
%   export_fig ... -nocrop
%   export_fig ... -c[<val>,<val>,<val>,<val>]
%   export_fig ... -transparent
%   export_fig ... -native
%   export_fig ... -m<val>
%   export_fig ... -r<val>
%   export_fig ... -a<val>
%   export_fig ... -q<val>
%   export_fig ... -p<val>
%   export_fig ... -d<gs_option>
%   export_fig ... -depsc
%   export_fig ... -<renderer>
%   export_fig ... -<colorspace>
%   export_fig ... -append
%   export_fig ... -bookmark
%   export_fig ... -clipboard
%   export_fig ... -update
%   export_fig ... -nofontswap
%   export_fig ... -font_space <char>
%   export_fig ... -linecaps
%   export_fig ... -noinvert
%   export_fig(..., handle)
%
% This function saves a figure or single axes to one or more vector and/or
% bitmap file formats, and/or outputs a rasterized version to the workspace,
% with the following properties:
%   - Figure/axes reproduced as it appears on screen
%   - Cropped borders (optional)
%   - Embedded fonts (vector formats)
%   - Improved line and grid line styles
%   - Anti-aliased graphics (bitmap formats)
%   - Render images at native resolution (optional for bitmap formats)
%   - Transparent background supported (pdf, eps, png, tiff)
%   - Semi-transparent patch objects supported (png, tiff)
%   - RGB, CMYK or grayscale output (CMYK only with pdf, eps, tiff)
%   - Variable image compression, including lossless (pdf, eps, jpg)
%   - Optional rounded line-caps (pdf, eps)
%   - Optionally append to file (pdf, tiff)
%   - Vector formats: pdf, eps
%   - Bitmap formats: png, tiff, jpg, bmp, export to workspace
%
% This function is especially suited to exporting figures for use in
% publications and presentations, because of the high quality and
% portability of media produced.
%
% Note that the background color and figure dimensions are reproduced
% (the latter approximately, and ignoring cropping & magnification) in the
% output file. For transparent background (and semi-transparent patch
% objects), use the -transparent option or set the figure 'Color' property
% to 'none'. To make axes transparent set the axes 'Color' property to
% 'none'. PDF, EPS, TIF & PNG are the only formats that support a transparent
% background; only TIF & PNG formats support transparency of patch objects.
%
% The choice of renderer (opengl, zbuffer or painters) has a large impact
% on the quality of output. The default value (opengl for bitmaps, painters
% for vector formats) generally gives good results, but if you aren't
% satisfied then try another renderer.  Notes: 1) For vector formats (EPS,
% PDF), only painters generates vector graphics. 2) For bitmaps, only
% opengl can render transparent patch objects correctly. 3) For bitmaps,
% only painters will correctly scale line dash and dot lengths when
% magnifying or anti-aliasing. 4) Fonts may be substitued with Courier when
% using painters.
%
% When exporting to vector format (PDF & EPS) and bitmap format using the
% painters renderer, this function requires that ghostscript is installed
% on your system. You can download this from:
%   http://www.ghostscript.com
% When exporting to eps it additionally requires pdftops, from the Xpdf
% suite of functions. You can download this from: http://xpdfreader.com
%
% Inputs:
%   filename - string containing the name (optionally including full or
%              relative path) of the file the figure is to be saved as. If
%              a path is not specified, the figure is saved in the current
%              directory. If no name and no output arguments are specified,
%              the default name, 'export_fig_out', is used. If neither a
%              file extension nor a format are specified, a ".png" is added
%              and the figure saved in that format.
%   -format1, -format2, etc. - strings containing the extensions of the
%                              file formats the figure is to be saved as.
%                              Valid options are: '-pdf', '-eps', '-png',
%                              '-tif', '-jpg' and '-bmp'. All combinations
%                              of formats are valid.
%   -nocrop - option indicating that the borders of the output are not to
%             be cropped.
%   -c[<val>,<val>,<val>,<val>] - option indicating crop amounts. Must be
%             a 4-element vector of numeric values: [top,right,bottom,left]
%             where NaN/Inf indicate auto-cropping, 0 means no cropping,
%             and any other value mean cropping in pixel amounts.
%   -transparent - option indicating that the figure background is to be
%                  made transparent (png, pdf, tif and eps output only).
%   -m<val> - option where val indicates the factor to magnify the
%             on-screen figure pixel dimensions by when generating bitmap
%             outputs (does not affect vector formats). Default: '-m1'.
%   -r<val> - option val indicates the resolution (in pixels per inch) to
%             export bitmap and vector outputs at, keeping the dimensions
%             of the on-screen figure. Default: '-r864' (for vector output
%             only). Note that the -m option overides the -r option for
%             bitmap outputs only.
%   -native - option indicating that the output resolution (when outputting
%             a bitmap format) should be such that the vertical resolution
%             of the first suitable image found in the figure is at the
%             native resolution of that image. To specify a particular
%             image to use, give it the tag 'export_fig_native'. Notes:
%             This overrides any value set with the -m and -r options. It
%             also assumes that the image is displayed front-to-parallel
%             with the screen. The output resolution is approximate and
%             should not be relied upon. Anti-aliasing can have adverse
%             effects on image quality (disable with the -a1 option).
%   -a1, -a2, -a3, -a4 - option indicating the amount of anti-aliasing to
%                        use for bitmap outputs. '-a1' means no anti-
%                        aliasing; '-a4' is the maximum amount (default).
%   -<renderer> - option to force a particular renderer (painters, opengl or
%                 zbuffer). Default value: opengl for bitmap formats or
%                 figures with patches and/or transparent annotations;
%                 painters for vector formats without patches/transparencies.
%   -<colorspace> - option indicating which colorspace color figures should
%                   be saved in: RGB (default), CMYK or gray. CMYK is only
%                   supported in pdf, eps and tiff output.
%   -q<val> - option to vary bitmap image quality (in pdf, eps and jpg
%             files only).  Larger val, in the range 0-100, gives higher
%             quality/lower compression. val > 100 gives lossless
%             compression. Default: '-q95' for jpg, ghostscript prepress
%             default for pdf & eps. Note: lossless compression can
%             sometimes give a smaller file size than the default lossy
%             compression, depending on the type of images.
%   -p<val> - option to pad a border of width val to exported files, where
%             val is either a relative size with respect to cropped image
%             size (i.e. p=0.01 adds a 1% border). For EPS & PDF formats,
%             val can also be integer in units of 1/72" points (abs(val)>1).
%             val can be positive (padding) or negative (extra cropping).
%             If used, the -nocrop flag will be ignored, i.e. the image will
%             always be cropped and then padded. Default: 0 (i.e. no padding).
%   -append - option indicating that if the file (pdfs only) already
%             exists, the figure is to be appended as a new page, instead
%             of being overwritten (default).
%   -bookmark - option to indicate that a bookmark with the name of the
%               figure is to be created in the output file (pdf only).
%   -clipboard - option to save output as an image on the system clipboard.
%                Note: background transparency is not preserved in clipboard
%   -d<gs_option> - option to indicate a ghostscript setting. For example,
%                   -dMaxBitmap=0 or -dNoOutputFonts (Ghostscript 9.15+).
%   -depsc -  option to use EPS level-3 rather than the default level-2 print
%             device. This solves some bugs with Matlab's default -depsc2 device
%             such as discolored subplot lines on images (vector formats only).
%   -update - option to download and install the latest version of export_fig
%   -nofontswap - option to avoid font swapping. Font swapping is automatically
%             done in vector formats (only): 11 standard Matlab fonts are
%             replaced by the original figure fonts. This option prevents this.
%   -font_space <char> - option to set a spacer character for font-names that
%             contain spaces, used by EPS/PDF. Default: ''
%   -linecaps - option to create rounded line-caps (vector formats only).
%   -noinvert - option to avoid setting figure's InvertHardcopy property to
%             'off' during output (this solves some problems of empty outputs).
%   handle -  The handle of the figure, axes or uipanels (can be an array of
%             handles, but the objects must be in the same figure) to be
%             saved. Default: gcf.
%
% Outputs:
%   imageData - MxNxC uint8 image array of the exported image.
%   alpha     - MxN single array of alphamatte values in the range [0,1],
%               for the case when the background is transparent.
%
%   Some helpful examples and tips can be found at:
%      https://github.com/altmany/export_fig
%
%   See also PRINT, SAVEAS, ScreenCapture (on the Matlab File Exchange)

%{
% Copyright (C) Oliver Woodford 2008-2014, Yair Altman 2015-

% The idea of using ghostscript is inspired by Peder Axensten's SAVEFIG
% (fex id: 10889) which is itself inspired by EPS2PDF (fex id: 5782).
% The idea for using pdftops came from the MATLAB newsgroup (id: 168171).
% The idea of editing the EPS file to change line styles comes from Jiro
% Doke's FIXPSLINESTYLE (fex id: 17928).
% The idea of changing dash length with line width came from comments on
% fex id: 5743, but the implementation is mine :)
% The idea of anti-aliasing bitmaps came from Anders Brun's MYAA (fex id:
% 20979).
% The idea of appending figures in pdfs came from Matt C in comments on the
% FEX (id: 23629)

% Thanks to Roland Martin for pointing out the colour MATLAB
% bug/feature with colorbar axes and transparent backgrounds.
% Thanks also to Andrew Matthews for describing a bug to do with the figure
% size changing in -nodisplay mode. I couldn't reproduce it, but included a
% fix anyway.
% Thanks to Tammy Threadgill for reporting a bug where an axes is not
% isolated from gui objects.
%}
%{
% 23/02/12: Ensure that axes limits don't change during printing
% 14/03/12: Fix bug in fixing the axes limits (thanks to Tobias Lamour for reporting it).
% 02/05/12: Incorporate patch of Petr Nechaev (many thanks), enabling bookmarking of figures in pdf files.
% 09/05/12: Incorporate patch of Arcelia Arrieta (many thanks), to keep tick marks fixed.
% 12/12/12: Add support for isolating uipanels. Thanks to michael for suggesting it.
% 25/09/13: Add support for changing resolution in vector formats. Thanks to Jan Jaap Meijer for suggesting it.
% 07/05/14: Add support for '~' at start of path. Thanks to Sally Warner for suggesting it.
% 24/02/15: Fix Matlab R2014b bug (issue #34): plot markers are not displayed when ZLimMode='manual'
% 25/02/15: Fix issue #4 (using HG2 on R2014a and earlier)
% 25/02/15: Fix issue #21 (bold TeX axes labels/titles in R2014b)
% 26/02/15: If temp dir is not writable, use the user-specified folder for temporary EPS/PDF files (Javier Paredes)
% 27/02/15: Modified repository URL from github.com/ojwoodford to /altmany
%           Indented main function
%           Added top-level try-catch block to display useful workarounds
% 28/02/15: Enable users to specify optional ghostscript options (issue #36)
% 06/03/15: Improved image padding & cropping thanks to Oscar Hartogensis
% 26/03/15: Fixed issue #49 (bug with transparent grayscale images); fixed out-of-memory issue
% 26/03/15: Fixed issue #42: non-normalized annotations on HG1
% 26/03/15: Fixed issue #46: Ghostscript crash if figure units <> pixels
% 27/03/15: Fixed issue #39: bad export of transparent annotations/patches
% 28/03/15: Fixed issue #50: error on some Matlab versions with the fix for issue #42
% 29/03/15: Fixed issue #33: bugs in Matlab's print() function with -cmyk
% 29/03/15: Improved processing of input args (accept space between param name & value, related to issue #51)
% 30/03/15: When exporting *.fig files, then saveas *.fig if figure is open, otherwise export the specified fig file
% 30/03/15: Fixed edge case bug introduced yesterday (commit #ae1755bd2e11dc4e99b95a7681f6e211b3fa9358)
% 09/04/15: Consolidated header comment sections; initialize output vars only if requested (nargout>0)
% 14/04/15: Workaround for issue #45: lines in image subplots are exported in invalid color
% 15/04/15: Fixed edge-case in parsing input parameters; fixed help section to show the -depsc option (issue #45)
% 21/04/15: Bug fix: Ghostscript croaks on % chars in output PDF file (reported by Sven on FEX page, 15-Jul-2014)
% 22/04/15: Bug fix: Pdftops croaks on relative paths (reported by Tintin Milou on FEX page, 19-Jan-2015)
% 04/05/15: Merged fix #63 (Kevin Mattheus Moerman): prevent tick-label changes during export
% 07/05/15: Partial fix for issue #65: PDF export used painters rather than opengl renderer (thanks Nguyenr)
% 08/05/15: Fixed issue #65: bad PDF append since commit #e9f3cdf 21/04/15 (thanks Robert Nguyen)
% 12/05/15: Fixed issue #67: exponent labels cropped in export, since fix #63 (04/05/15)
% 28/05/15: Fixed issue #69: set non-bold label font only if the string contains symbols (\beta etc.), followup to issue #21
% 29/05/15: Added informative error message in case user requested SVG output (issue #72)
% 09/06/15: Fixed issue #58: -transparent removed anti-aliasing when exporting to PNG
% 19/06/15: Added -update option to download and install the latest version of export_fig
% 07/07/15: Added -nofontswap option to avoid font-swapping in EPS/PDF
% 16/07/15: Fixed problem with anti-aliasing on old Matlab releases
% 11/09/15: Fixed issue #103: magnification must never become negative; also fixed reported error msg in parsing input params
% 26/09/15: Alert if trying to export transparent patches/areas to non-PNG outputs (issue #108)
% 04/10/15: Do not suggest workarounds for certain errors that have already been handled previously
% 01/11/15: Fixed issue #112: use same renderer in print2eps as export_fig (thanks to Jes?estana Puerta)
% 10/11/15: Custom GS installation webpage for MacOS. Thanks to Andy Hueni via FEX
% 19/11/15: Fixed clipboard export in R2015b (thanks to Dan K via FEX)
% 21/02/16: Added -c option for indicating specific crop amounts (idea by Cedric Noordam on FEX)
% 08/05/16: Added message about possible error reason when groot.Units~=pixels (issue #149)
% 17/05/16: Fixed case of image YData containing more than 2 elements (issue #151)
% 08/08/16: Enabled exporting transparency to TIF, in addition to PNG/PDF (issue #168)
% 11/12/16: Added alert in case of error creating output PDF/EPS file (issue #179)
% 13/12/16: Minor fix to the commit for issue #179 from 2 days ago
% 22/03/17: Fixed issue #187: only set manual ticks when no exponent is present
% 09/04/17: Added -linecaps option (idea by Baron Finer, issue #192)
% 15/09/17: Fixed issue #205: incorrect tick-labels when Ticks number don't match the TickLabels number
% 15/09/17: Fixed issue #210: initialize alpha map to ones instead of zeros when -transparent is not used
% 18/09/17: Added -font_space option to replace font-name spaces in EPS/PDF (workaround for issue #194)
% 18/09/17: Added -noinvert option to solve some export problems with some graphic cards (workaround for issue #197)
% 08/11/17: Fixed issue #220: axes exponent is removed in HG1 when TickMode is 'manual' (internal Matlab bug)
% 08/11/17: Fixed issue #221: alert if the requested folder does not exist
% 19/11/17: Workaround for issue #207: alert when trying to use transparent bgcolor with -opengl
% 29/11/17: Workaround for issue #206: warn if exporting PDF/EPS for a figure that contains an image
% 11/12/17: Fixed issue #230: use OpenGL renderer when exported image contains transparency (also see issue #206)
% 30/01/18: Updated SVG message to point to https://github.com/kupiqu/plot2svg and display user-selected filename if available
% 27/02/18: Fixed issue #236: axes exponent cropped from output if on right-hand axes
% 29/05/18: Fixed issue #245: process "string" inputs just like 'char' inputs
% 13/08/18: Fixed issue #249: correct black axes color to off-black to avoid extra cropping with -transparent
% 27/08/18: Added a possible file-open reason in EPS/PDF write-error message (suggested by "craq" on FEX page)
% 22/09/18: Xpdf website changed to xpdfreader.com
% 23/09/18: Fixed issue #243: only set non-bold font (workaround for issue #69) in R2015b or earlier; warn if changing font
% 23/09/18: Workaround for issue #241: don't use -r864 in EPS/PDF outputs when -native is requested (solves black lines problem)
% 18/11/18: Issue #261: Added informative alert when trying to export a uifigure (which is not currently supported)
% 13/12/18: Issue #261: Fixed last commit for cases of specifying axes/panel handle as input, rather than a figure handle
%}

    if nargout
        [imageData, alpha] = deal([]);
    end
    hadError = false;
    displaySuggestedWorkarounds = true;

    % Ensure the figure is rendered correctly _now_ so that properties like axes limits are up-to-date
    drawnow;
    pause(0.05);  % this solves timing issues with Java Swing's EDT (http://undocumentedmatlab.com/blog/solving-a-matlab-hang-problem)

    % Parse the input arguments
    fig = get(0, 'CurrentFigure');
    [fig, options] = parse_args(nargout, fig, varargin{:});

    % Ensure that we have a figure handle
    if isequal(fig,-1)
        return;  % silent bail-out
    elseif isempty(fig)
        error('No figure found');
    else
        oldWarn = warning('off','MATLAB:HandleGraphics:ObsoletedProperty:JavaFrame');
        try jf = get(handle(ancestor(fig,'figure')),'JavaFrame'); catch, jf=1; end
        warning(oldWarn);
        if isempty(jf)
            error('Figures created using the uifigure command or App Designer are not supported by export_fig. See <a href="https://github.com/altmany/export_fig/issues/261">issue #261</a> for details.');
        end
    end

    % Isolate the subplot, if it is one
    cls = all(ismember(get(fig, 'Type'), {'axes', 'uipanel'}));
    if cls
        % Given handles of one or more axes, so isolate them from the rest
        fig = isolate_axes(fig);
    else
        % Check we have a figure
        if ~isequal(get(fig, 'Type'), 'figure')
            error('Handle must be that of a figure, axes or uipanel');
        end
        % Get the old InvertHardcopy mode
        old_mode = get(fig, 'InvertHardcopy');
    end

    % Hack the font units where necessary (due to a font rendering bug in print?).
    % This may not work perfectly in all cases.
    % Also it can change the figure layout if reverted, so use a copy.
    magnify = options.magnify * options.aa_factor;
    if isbitmap(options) && magnify ~= 1
        fontu = findall(fig, 'FontUnits', 'normalized');
        if ~isempty(fontu)
            % Some normalized font units found
            if ~cls
                fig = copyfig(fig);
                set(fig, 'Visible', 'off');
                fontu = findall(fig, 'FontUnits', 'normalized');
                cls = true;
            end
            set(fontu, 'FontUnits', 'points');
        end
    end

    try
        % MATLAB "feature": axes limits and tick marks can change when printing
        Hlims = findall(fig, 'Type', 'axes');
        if ~cls
            % Record the old axes limit and tick modes
            Xlims = make_cell(get(Hlims, 'XLimMode'));
            Ylims = make_cell(get(Hlims, 'YLimMode'));
            Zlims = make_cell(get(Hlims, 'ZLimMode'));
            Xtick = make_cell(get(Hlims, 'XTickMode'));
            Ytick = make_cell(get(Hlims, 'YTickMode'));
            Ztick = make_cell(get(Hlims, 'ZTickMode'));
            Xlabel = make_cell(get(Hlims, 'XTickLabelMode')); 
            Ylabel = make_cell(get(Hlims, 'YTickLabelMode')); 
            Zlabel = make_cell(get(Hlims, 'ZTickLabelMode')); 
        end

        % Set all axes limit and tick modes to manual, so the limits and ticks can't change
        % Fix Matlab R2014b bug (issue #34): plot markers are not displayed when ZLimMode='manual'
        set(Hlims, 'XLimMode', 'manual', 'YLimMode', 'manual');
        set_tick_mode(Hlims, 'X');
        set_tick_mode(Hlims, 'Y');
        if ~using_hg2(fig)
            set(Hlims,'ZLimMode', 'manual');
            set_tick_mode(Hlims, 'Z');
        end
    catch
        % ignore - fix issue #4 (using HG2 on R2014a and earlier)
    end

    % Fix issue #21 (bold TeX axes labels/titles in R2014b when exporting to EPS/PDF)
    try
        if using_hg2(fig) && isvector(options)
            % Set the FontWeight of axes labels/titles to 'normal'
            % Fix issue #69: set non-bold font only if the string contains symbols (\beta etc.)
            % Issue #243: only set non-bold font (workaround for issue #69) in R2015b or earlier
            try isPreR2016a = verLessThan('matlab','8.7'); catch, isPreR2016a = true; end
            if isPreR2016a
                texLabels = findall(fig, 'type','text', 'FontWeight','bold');
                symbolIdx = ~cellfun('isempty',strfind({texLabels.String},'\'));
                if ~isempty(symbolIdx)
                    set(texLabels(symbolIdx), 'FontWeight','normal');
                    warning('export_fig:BoldTexLabels', 'Bold labels with Tex symbols converted into non-bold in export_fig (fix for issue #69)');
                end
            end
        end
    catch
        % ignore
    end

    % Fix issue #42: non-normalized annotations on HG1 (internal Matlab bug)
    annotationHandles = [];
    try
        if ~using_hg2(fig)
            annotationHandles = findall(fig,'Type','hggroup','-and','-property','Units','-and','-not','Units','norm');
            try  % suggested by Jes?estana Puerta (jespestana) 30/9/2015
                originalUnits = get(annotationHandles,'Units');
                set(annotationHandles,'Units','norm');
            catch
            end
        end
    catch
        % should never happen, but ignore in any case - issue #50
    end

    % Fix issue #46: Ghostscript crash if figure units <> pixels
    oldFigUnits = get(fig,'Units');
    set(fig,'Units','pixels');

    % Set to print exactly what is there
    if options.invert_hardcopy
        try set(fig, 'InvertHardcopy', 'off'); catch, end  % fail silently in uifigures
    end

    % Set the renderer
    switch options.renderer
        case 1
            renderer = '-opengl';
        case 2
            renderer = '-zbuffer';
        case 3
            renderer = '-painters';
        otherwise
            renderer = '-opengl'; % Default for bitmaps
    end

    hImages = findall(fig,'type','image');

    % Handle transparent patches
    hasTransparency = ~isempty(findall(fig,'-property','FaceAlpha','-and','-not','FaceAlpha',1));
    hasPatches      = ~isempty(findall(fig,'type','patch'));
    if hasTransparency
        % Alert if trying to export transparent patches/areas to non-supported outputs (issue #108)
        % http://www.mathworks.com/matlabcentral/answers/265265-can-export_fig-or-else-draw-vector-graphics-with-transparent-surfaces
        % TODO - use transparency when exporting to PDF by not passing via print2eps
        msg = 'export_fig currently supports transparent patches/areas only in PNG output. ';
        if options.pdf
            warning('export_fig:transparency', '%s\nTo export transparent patches/areas to PDF, use the print command:\n print(gcf, ''-dpdf'', ''%s.pdf'');', msg, options.name);
        elseif ~options.png && ~options.tif  % issue #168
            warning('export_fig:transparency', '%s\nTo export the transparency correctly, try using the ScreenCapture utility on the Matlab File Exchange: http://bit.ly/1QFrBip', msg);
        end
    elseif ~isempty(hImages)
        % Fix for issue #230: use OpenGL renderer when exported image contains transparency
        for idx = 1 : numel(hImages)
            cdata = get(hImages(idx),'CData');
            if any(isnan(cdata(:)))
                hasTransparency = true;
                break
            end
        end
    end

    try
        % Do the bitmap formats first
        if isbitmap(options)
            if abs(options.bb_padding) > 1
                displaySuggestedWorkarounds = false;
                error('For bitmap output (png,jpg,tif,bmp) the padding value (-p) must be between -1<p<1')
            end
            % Get the background colour
            if options.transparent && (options.png || options.alpha)
                % Get out an alpha channel
                % MATLAB "feature": black colorbar axes can change to white and vice versa!
                hCB = findall(fig, 'Type','axes', 'Tag','Colorbar');
                if isempty(hCB)
                    yCol = [];
                    xCol = [];
                else
                    yCol = get(hCB, 'YColor');
                    xCol = get(hCB, 'XColor');
                    if iscell(yCol)
                        yCol = cell2mat(yCol);
                        xCol = cell2mat(xCol);
                    end
                    yCol = sum(yCol, 2);
                    xCol = sum(xCol, 2);
                end
                % MATLAB "feature": apparently figure size can change when changing
                % colour in -nodisplay mode
                pos = get(fig, 'Position');
                % Set the background colour to black, and set size in case it was
                % changed internally
                tcol = get(fig, 'Color');
                set(fig, 'Color', 'k', 'Position', pos);
                % Correct the colorbar axes colours
                set(hCB(yCol==0), 'YColor', [0 0 0]);
                set(hCB(xCol==0), 'XColor', [0 0 0]);
                % Correct black axes color to off-black (issue #249)
                hAxes = findall(fig, 'Type','axes');
                hXs = fixBlackAxle(hAxes, 'XColor');
                hYs = fixBlackAxle(hAxes, 'YColor');
                hZs = fixBlackAxle(hAxes, 'ZColor');

                % The following code might cause out-of-memory errors
                try
                    % Print large version to array
                    B = print2array(fig, magnify, renderer);
                    % Downscale the image
                    B = downsize(single(B), options.aa_factor);
                catch
                    % This is more conservative in memory, but kills transparency (issue #58)
                    B = single(print2array(fig, magnify/options.aa_factor, renderer));
                end

                % Set background to white (and set size)
                set(fig, 'Color', 'w', 'Position', pos);
                % Correct the colorbar axes colours
                set(hCB(yCol==3), 'YColor', [1 1 1]);
                set(hCB(xCol==3), 'XColor', [1 1 1]);
                % Revert the black axes colors
                set(hXs, 'XColor', [0,0,0]);
                set(hYs, 'YColor', [0,0,0]);
                set(hZs, 'ZColor', [0,0,0]);

                % The following code might cause out-of-memory errors
                try
                    % Print large version to array
                    A = print2array(fig, magnify, renderer);
                    % Downscale the image
                    A = downsize(single(A), options.aa_factor);
                catch
                    % This is more conservative in memory, but kills transparency (issue #58)
                    A = single(print2array(fig, magnify/options.aa_factor, renderer));
                end

                % Set the background colour (and size) back to normal
                set(fig, 'Color', tcol, 'Position', pos);
                % Compute the alpha map
                alpha = round(sum(B - A, 3)) / (255 * 3) + 1;
                A = alpha;
                A(A==0) = 1;
                A = B ./ A(:,:,[1 1 1]);
                clear B
                % Convert to greyscale
                if options.colourspace == 2
                    A = rgb2grey(A);
                end
                A = uint8(A);
                % Crop the background
                if options.crop
                    %[alpha, v] = crop_borders(alpha, 0, 1, options.crop_amounts);
                    %A = A(v(1):v(2),v(3):v(4),:);
                    [alpha, vA, vB] = crop_borders(alpha, 0, options.bb_padding, options.crop_amounts);
                    if ~any(isnan(vB)) % positive padding
                        B = repmat(uint8(zeros(1,1,size(A,3))),size(alpha));
                        B(vB(1):vB(2), vB(3):vB(4), :) = A(vA(1):vA(2), vA(3):vA(4), :); % ADDED BY OH
                        A = B;
                    else  % negative padding
                        A = A(vA(1):vA(2), vA(3):vA(4), :);
                    end
                end
                if options.png
                    % Compute the resolution
                    res = options.magnify * get(0, 'ScreenPixelsPerInch') / 25.4e-3;
                    % Save the png
                    imwrite(A, [options.name '.png'], 'Alpha', double(alpha), 'ResolutionUnit', 'meter', 'XResolution', res, 'YResolution', res);
                    % Clear the png bit
                    options.png = false;
                end
                % Return only one channel for greyscale
                if isbitmap(options)
                    A = check_greyscale(A);
                end
                if options.alpha
                    % Store the image
                    imageData = A;
                    % Clear the alpha bit
                    options.alpha = false;
                end
                % Get the non-alpha image
                if isbitmap(options)
                    alph = alpha(:,:,ones(1, size(A, 3)));
                    A = uint8(single(A) .* alph + 255 * (1 - alph));
                    clear alph
                end
                if options.im
                    % Store the new image
                    imageData = A;
                end
            else
                % Print large version to array
                if options.transparent
                    % MATLAB "feature": apparently figure size can change when changing
                    % colour in -nodisplay mode
                    pos = get(fig, 'Position');
                    tcol = get(fig, 'Color');
                    set(fig, 'Color', 'w', 'Position', pos);
                    A = print2array(fig, magnify, renderer);
                    set(fig, 'Color', tcol, 'Position', pos);
                    tcol = 255;
                else
                    [A, tcol] = print2array(fig, magnify, renderer);
                end
                % Crop the background
                if options.crop
                    A = crop_borders(A, tcol, options.bb_padding, options.crop_amounts);
                end
                % Downscale the image
                A = downsize(A, options.aa_factor);
                if options.colourspace == 2
                    % Convert to greyscale
                    A = rgb2grey(A);
                else
                    % Return only one channel for greyscale
                    A = check_greyscale(A);
                end
                % Outputs
                if options.im
                    imageData = A;
                end
                if options.alpha
                    imageData = A;
                    alpha = ones(size(A, 1), size(A, 2), 'single');
                end
            end
            % Save the images
            if options.png
                res = options.magnify * get(0, 'ScreenPixelsPerInch') / 25.4e-3;
                imwrite(A, [options.name '.png'], 'ResolutionUnit', 'meter', 'XResolution', res, 'YResolution', res);
            end
            if options.bmp
                imwrite(A, [options.name '.bmp']);
            end
            % Save jpeg with given quality
            if options.jpg
                quality = options.quality;
                if isempty(quality)
                    quality = 95;
                end
                if quality > 100
                    imwrite(A, [options.name '.jpg'], 'Mode', 'lossless');
                else
                    imwrite(A, [options.name '.jpg'], 'Quality', quality);
                end
            end
            % Save tif images in cmyk if wanted (and possible)
            if options.tif
                if options.colourspace == 1 && size(A, 3) == 3
                    A = double(255 - A);
                    K = min(A, [], 3);
                    K_ = 255 ./ max(255 - K, 1);
                    C = (A(:,:,1) - K) .* K_;
                    M = (A(:,:,2) - K) .* K_;
                    Y = (A(:,:,3) - K) .* K_;
                    A = uint8(cat(3, C, M, Y, K));
                    clear C M Y K K_
                end
                append_mode = {'overwrite', 'append'};
                imwrite(A, [options.name '.tif'], 'Resolution', options.magnify*get(0, 'ScreenPixelsPerInch'), 'WriteMode', append_mode{options.append+1});
            end
        end

        % Now do the vector formats
        if isvector(options)
            % Set the default renderer to painters
            if ~options.renderer
                if hasTransparency || hasPatches
                    % This is *MUCH* slower, but more accurate for patches and transparent annotations (issue #39)
                    renderer = '-opengl';
                else
                    renderer = '-painters';
                end
            end
            options.rendererStr = renderer;  % fix for issue #112
            % Generate some filenames
            tmp_nam = [tempname '.eps'];
            try
                % Ensure that the temp dir is writable (Javier Paredes 30/1/15)
                fid = fopen(tmp_nam,'w');
                fwrite(fid,1);
                fclose(fid);
                delete(tmp_nam);
                isTempDirOk = true;
            catch
                % Temp dir is not writable, so use the user-specified folder
                [dummy,fname,fext] = fileparts(tmp_nam); %#ok<ASGLU>
                fpath = fileparts(options.name);
                tmp_nam = fullfile(fpath,[fname fext]);
                isTempDirOk = false;
            end
            if isTempDirOk
                pdf_nam_tmp = [tempname '.pdf'];
            else
                pdf_nam_tmp = fullfile(fpath,[fname '.pdf']);
            end
            if options.pdf
                pdf_nam = [options.name '.pdf'];
                try copyfile(pdf_nam, pdf_nam_tmp, 'f'); catch, end  % fix for issue #65
            else
                pdf_nam = pdf_nam_tmp;
            end
            % Generate the options for print
            p2eArgs = {renderer};
            if ~isempty(options.resolution)  % issue #241
                p2eArgs{end+1} = sprintf('-r%d', options.resolution);
            end
            if options.colourspace == 1  % CMYK
                % Issue #33: due to internal bugs in Matlab's print() function, we can't use its -cmyk option
                %p2eArgs{end+1} = '-cmyk';
            end
            if ~options.crop
                % Issue #56: due to internal bugs in Matlab's print() function, we can't use its internal cropping mechanism,
                % therefore we always use '-loose' (in print2eps.m) and do our own cropping (in crop_borders)
                %p2eArgs{end+1} = '-loose';
            end
            if any(strcmpi(varargin,'-depsc'))
                % Issue #45: lines in image subplots are exported in invalid color.
                % The workaround is to use the -depsc parameter instead of the default -depsc2
                p2eArgs{end+1} = '-depsc';
            end
            try
                % Remove background if requested (issue #207)
                [hXs, hYs, hZs] = deal([]);
                if options.transparent %&& ~isequal(get(fig, 'Color'), 'none')
                    if options.renderer == 1  % OpenGL
                        warning('export_fig:openglTransparentBG', '-opengl sometimes fails to produce transparent backgrounds; try -painters instead');
                    else
                        originalBgColor = get(fig, 'Color');
                        set(fig,'Color','none');

                        % Correct black axes color to off-black (issue #249)
                        hAxes = findall(fig, 'Type','axes');
                        hXs = fixBlackAxle(hAxes, 'XColor');
                        hYs = fixBlackAxle(hAxes, 'YColor');
                        hZs = fixBlackAxle(hAxes, 'ZColor');
                    end
                end
                % Generate an eps
                print2eps(tmp_nam, fig, options, p2eArgs{:});
                %{
                % Remove the background, if desired
                if options.transparent %&& ~isequal(get(fig, 'Color'), 'none')
                    eps_remove_background(tmp_nam, 1 + using_hg2(fig));

                    % Revert the black axes colors
                    set(hXs, 'XColor', [0,0,0]);
                    set(hYs, 'YColor', [0,0,0]);
                    set(hZs, 'ZColor', [0,0,0]);
                end
                %}
                % Restore the figure's previous background color (if modified)
                try set(fig,'Color',originalBgColor); drawnow; catch, end
                % Fix colorspace to CMYK, if requested (workaround for issue #33)
                if options.colourspace == 1  % CMYK
                    % Issue #33: due to internal bugs in Matlab's print() function, we can't use its -cmyk option
                    change_rgb_to_cmyk(tmp_nam);
                end
                % Add a bookmark to the PDF if desired
                if options.bookmark
                    fig_nam = get(fig, 'Name');
                    if isempty(fig_nam)
                        warning('export_fig:EmptyBookmark', 'Bookmark requested for figure with no name. Bookmark will be empty.');
                    end
                    add_bookmark(tmp_nam, fig_nam);
                end
                % Generate a pdf
                eps2pdf(tmp_nam, pdf_nam_tmp, 1, options.append, options.colourspace==2, options.quality, options.gs_options);
                % Ghostscript croaks on % chars in the output PDF file, so use tempname and then rename the file
                try
                    % Rename the file (except if it is already the same)
                    % Abbie K's comment on the commit for issue #179 (#commitcomment-20173476)
                    if ~isequal(pdf_nam_tmp, pdf_nam)
                        movefile(pdf_nam_tmp, pdf_nam, 'f');
                    end
                catch
                    % Alert in case of error creating output PDF/EPS file (issue #179)
                    if exist(pdf_nam_tmp, 'file')
                        errMsg = ['Could not create ' pdf_nam ' - perhaps the folder does not exist, or you do not have write permissions, or the file is open in another application'];
                        error(errMsg);
                    else
                        error('Could not generate the intermediary EPS file.');
                    end
                end
            catch ex
                % Delete the eps
                delete(tmp_nam);
                rethrow(ex);
            end
            % Delete the eps
            delete(tmp_nam);
            if options.eps || options.linecaps
                try
                    % Generate an eps from the pdf
                    % since pdftops can't handle relative paths (e.g., '..\'), use a temp file
                    eps_nam_tmp = strrep(pdf_nam_tmp,'.pdf','.eps');
                    pdf2eps(pdf_nam, eps_nam_tmp);

                    % Issue #192: enable rounded line-caps
                    if options.linecaps
                        fstrm = read_write_entire_textfile(eps_nam_tmp);
                        fstrm = regexprep(fstrm, '[02] J', '1 J');
                        read_write_entire_textfile(eps_nam_tmp, fstrm);
                        if options.pdf
                            eps2pdf(eps_nam_tmp, pdf_nam, 1, options.append, options.colourspace==2, options.quality, options.gs_options);
                        end
                    end

                    if options.eps
                        movefile(eps_nam_tmp, [options.name '.eps'], 'f');
                    else  % if options.pdf
                        try delete(eps_nam_tmp); catch, end
                    end
                catch ex
                    if ~options.pdf
                        % Delete the pdf
                        delete(pdf_nam);
                    end
                    try delete(eps_nam_tmp); catch, end
                    rethrow(ex);
                end
                if ~options.pdf
                    % Delete the pdf
                    delete(pdf_nam);
                end
            end
            % Issue #206: warn if the figure contains an image
            if ~isempty(hImages) && strcmpi(renderer,'-opengl')  % see addendum to issue #206
                warnMsg = ['exporting images to PDF/EPS may result in blurry images on some viewers. ' ...
                           'If so, try to change viewer, or increase the image''s CData resolution, or use -opengl renderer, or export via the print function. ' ...
                           'See <a href="matlab:web(''https://github.com/altmany/export_fig/issues/206'',''-browser'');">issue #206</a> for details.'];
                warning('export_fig:pdf_eps:blurry_image', warnMsg);
            end
        end

        % Revert the figure or close it (if requested)
        if cls || options.closeFig
            % Close the created figure
            close(fig);
        else
            % Reset the hardcopy mode
            try set(fig, 'InvertHardcopy', old_mode); catch, end  % fail silently in uifigures
            % Reset the axes limit and tick modes
            for a = 1:numel(Hlims)
                try
                    set(Hlims(a), 'XLimMode', Xlims{a}, 'YLimMode', Ylims{a}, 'ZLimMode', Zlims{a},... 
                                  'XTickMode', Xtick{a}, 'YTickMode', Ytick{a}, 'ZTickMode', Ztick{a},...
                                  'XTickLabelMode', Xlabel{a}, 'YTickLabelMode', Ylabel{a}, 'ZTickLabelMode', Zlabel{a}); 
                catch
                    % ignore - fix issue #4 (using HG2 on R2014a and earlier)
                end
            end
            % Revert the tex-labels font weights
            try set(texLabels, 'FontWeight','bold'); catch, end
            % Revert annotation units
            for handleIdx = 1 : numel(annotationHandles)
                try
                    oldUnits = originalUnits{handleIdx};
                catch
                    oldUnits = originalUnits;
                end
                try set(annotationHandles(handleIdx),'Units',oldUnits); catch, end
            end
            % Revert figure units
            set(fig,'Units',oldFigUnits);
        end

        % Output to clipboard (if requested)
        if options.clipboard
            % Delete the output file if unchanged from the default name ('export_fig_out.png')
            if strcmpi(options.name,'export_fig_out')
                try
                    fileInfo = dir('export_fig_out.png');
                    if ~isempty(fileInfo)
                        timediff = now - fileInfo.datenum;
                        ONE_SEC = 1/24/60/60;
                        if timediff < ONE_SEC
                            delete('export_fig_out.png');
                        end
                    end
                catch
                    % never mind...
                end
            end

            % Save the image in the system clipboard
            % credit: Jiro Doke's IMCLIPBOARD: http://www.mathworks.com/matlabcentral/fileexchange/28708-imclipboard
            try
                error(javachk('awt', 'export_fig -clipboard output'));
            catch
                warning('export_fig:clipboardJava', 'export_fig -clipboard output failed: requires Java to work');
                return;
            end
            try
                % Import necessary Java classes
                import java.awt.Toolkit
                import java.awt.image.BufferedImage
                import java.awt.datatransfer.DataFlavor

                % Get System Clipboard object (java.awt.Toolkit)
                cb = Toolkit.getDefaultToolkit.getSystemClipboard();

                % Add java class (ImageSelection) to the path
                if ~exist('ImageSelection', 'class')
                    javaaddpath(fileparts(which(mfilename)), '-end');
                end

                % Get image size
                ht = size(imageData, 1);
                wd = size(imageData, 2);

                % Convert to Blue-Green-Red format
                try
                    imageData2 = imageData(:, :, [3 2 1]);
                catch
                    % Probably gray-scaled image (2D, without the 3rd [RGB] dimension)
                    imageData2 = imageData(:, :, [1 1 1]);
                end

                % Convert to 3xWxH format
                imageData2 = permute(imageData2, [3, 2, 1]);

                % Append Alpha data (unused - transparency is not supported in clipboard copy)
                alphaData2 = uint8(permute(255*alpha,[3,2,1])); %=255*ones(1,wd,ht,'uint8')
                imageData2 = cat(1, imageData2, alphaData2);

                % Create image buffer
                imBuffer = BufferedImage(wd, ht, BufferedImage.TYPE_INT_RGB);
                imBuffer.setRGB(0, 0, wd, ht, typecast(imageData2(:), 'int32'), 0, wd);

                % Create ImageSelection object from the image buffer
                imSelection = ImageSelection(imBuffer);

                % Set clipboard content to the image
                cb.setContents(imSelection, []);
            catch
                warning('export_fig:clipboardFailed', 'export_fig -clipboard output failed: %s', lasterr); %#ok<LERR>
            end
        end

        % Don't output the data to console unless requested
        if ~nargout
            clear imageData alpha
        end
    catch err
        % Display possible workarounds before the error message
        if displaySuggestedWorkarounds && ~strcmpi(err.message,'export_fig error')
            if ~hadError,  fprintf(2, 'export_fig error. ');  end
            fprintf(2, 'Please ensure:\n');
            fprintf(2, '  that you are using the <a href="https://github.com/altmany/export_fig/archive/master.zip">latest version</a> of export_fig\n');
            if ismac
                fprintf(2, '  and that you have <a href="http://pages.uoregon.edu/koch">Ghostscript</a> installed\n');
            else
                fprintf(2, '  and that you have <a href="http://www.ghostscript.com">Ghostscript</a> installed\n');
            end
            try
                if options.eps
                    fprintf(2, '  and that you have <a href="http://xpdfreader.com/download.html">pdftops</a> installed\n');
                end
            catch
                % ignore - probably an error in parse_args
            end
            fprintf(2, '  and that you do not have <a href="matlab:which export_fig -all">multiple versions</a> of export_fig installed by mistake\n');
            fprintf(2, '  and that you did not made a mistake in the <a href="matlab:help export_fig">expected input arguments</a>\n');
            try
                % Alert per issue #149
                if ~strncmpi(get(0,'Units'),'pixel',5)
                    fprintf(2, '  or try to set groot''s Units property back to its default value of ''pixels'' (<a href="matlab:web(''https://github.com/altmany/export_fig/issues/149'',''-browser'');">details</a>)\n');
                end
            catch
                % ignore - maybe an old MAtlab release
            end
            fprintf(2, '\nIf the problem persists, then please <a href="https://github.com/altmany/export_fig/issues">report a new issue</a>.\n\n');
        end
        rethrow(err)
    end
end

function options = default_options()
    % Default options used by export_fig
    options = struct(...
        'name',         'export_fig_out', ...
        'crop',         true, ...
        'crop_amounts', nan(1,4), ...  % auto-crop all 4 image sides
        'transparent',  false, ...
        'renderer',     0, ...         % 0: default, 1: OpenGL, 2: ZBuffer, 3: Painters
        'pdf',          false, ...
        'eps',          false, ...
        'png',          false, ...
        'tif',          false, ...
        'jpg',          false, ...
        'bmp',          false, ...
        'clipboard',    false, ...
        'colourspace',  0, ...         % 0: RGB/gray, 1: CMYK, 2: gray
        'append',       false, ...
        'im',           false, ...
        'alpha',        false, ...
        'aa_factor',    0, ...
        'bb_padding',   0, ...
        'magnify',      [], ...
        'resolution',   [], ...
        'bookmark',     false, ...
        'closeFig',     false, ...
        'quality',      [], ...
        'update',       false, ...
        'fontswap',     true, ...
        'font_space',   '', ...
        'linecaps',     false, ...
        'invert_hardcopy', true, ...
        'gs_options',   {{}});
end

function [fig, options] = parse_args(nout, fig, varargin)
    % Parse the input arguments

    % Convert strings => chars
    varargin = cellfun(@str2char,varargin,'un',false);

    % Set the defaults
    native = false; % Set resolution to native of an image
    options = default_options();
    options.im =    (nout == 1);  % user requested imageData output
    options.alpha = (nout == 2);  % user requested alpha output

    % Go through the other arguments
    skipNext = false;
    for a = 1:nargin-2
        if skipNext
            skipNext = false;
            continue;
        end
        if all(ishandle(varargin{a}))
            fig = varargin{a};
        elseif ischar(varargin{a}) && ~isempty(varargin{a})
            if varargin{a}(1) == '-'
                switch lower(varargin{a}(2:end))
                    case 'nocrop'
                        options.crop = false;
                        options.crop_amounts = [0,0,0,0];
                    case {'trans', 'transparent'}
                        options.transparent = true;
                    case 'opengl'
                        options.renderer = 1;
                    case 'zbuffer'
                        options.renderer = 2;
                    case 'painters'
                        options.renderer = 3;
                    case 'pdf'
                        options.pdf = true;
                    case 'eps'
                        options.eps = true;
                    case 'png'
                        options.png = true;
                    case {'tif', 'tiff'}
                        options.tif = true;
                    case {'jpg', 'jpeg'}
                        options.jpg = true;
                    case 'bmp'
                        options.bmp = true;
                    case 'rgb'
                        options.colourspace = 0;
                    case 'cmyk'
                        options.colourspace = 1;
                    case {'gray', 'grey'}
                        options.colourspace = 2;
                    case {'a1', 'a2', 'a3', 'a4'}
                        options.aa_factor = str2double(varargin{a}(3));
                    case 'append'
                        options.append = true;
                    case 'bookmark'
                        options.bookmark = true;
                    case 'native'
                        native = true;
                    case 'clipboard'
                        options.clipboard = true;
                        options.im = true;
                        options.alpha = true;
                    case 'svg'
                        filename = strrep(options.name,'export_fig_out','filename');
                        msg = ['SVG output is not supported by export_fig. Use one of the following alternatives:\n' ...
                               '  1. saveas(gcf,''' filename '.svg'')\n' ...
                               '  2. plot2svg utility: https://github.com/kupiqu/plot2svg\n' ...  % Note: replaced defunct https://github.com/jschwizer99/plot2svg with up-to-date fork on https://github.com/kupiqu/plot2svg
                               '  3. export_fig to EPS/PDF, then convert to SVG using generic (non-Matlab) tools\n'];
                        error(sprintf(msg)); %#ok<SPERR>
                    case 'update'
                        % Download the latest version of export_fig into the export_fig folder
                        try
                            zipFileName = 'https://github.com/altmany/export_fig/archive/master.zip';
                            folderName = fileparts(which(mfilename('fullpath')));
                            targetFileName = fullfile(folderName, datestr(now,'yyyy-mm-dd.zip'));
                            urlwrite(zipFileName,targetFileName);
                        catch
                            error('Could not download %s into %s\n',zipFileName,targetFileName);
                        end

                        % Unzip the downloaded zip file in the export_fig folder
                        try
                            unzip(targetFileName,folderName);
                        catch
                            error('Could not unzip %s\n',targetFileName);
                        end
                    case 'nofontswap'
                        options.fontswap = false;
                    case 'font_space'
                        options.font_space = varargin{a+1};
                        skipNext = true;
                    case 'linecaps'
                        options.linecaps = true;
                    case 'noinvert'
                        options.invert_hardcopy = false;
                    otherwise
                        try
                            wasError = false;
                            if strcmpi(varargin{a}(1:2),'-d')
                                varargin{a}(2) = 'd';  % ensure lowercase 'd'
                                options.gs_options{end+1} = varargin{a};
                            elseif strcmpi(varargin{a}(1:2),'-c')
                                if numel(varargin{a})==2
                                    skipNext = true;
                                    vals = str2num(varargin{a+1}); %#ok<ST2NM>
                                else
                                    vals = str2num(varargin{a}(3:end)); %#ok<ST2NM>
                                end
                                if numel(vals)~=4
                                    wasError = true;
                                    error('option -c cannot be parsed: must be a 4-element numeric vector');
                                end
                                options.crop_amounts = vals;
                                options.crop = true;
                            else  % scalar parameter value
                                val = str2double(regexp(varargin{a}, '(?<=-(m|M|r|R|q|Q|p|P))-?\d*.?\d+', 'match'));
                                if isempty(val) || isnan(val)
                                    % Issue #51: improved processing of input args (accept space between param name & value)
                                    val = str2double(varargin{a+1});
                                    if isscalar(val) && ~isnan(val)
                                        skipNext = true;
                                    end
                                end
                                if ~isscalar(val) || isnan(val)
                                    wasError = true;
                                    error('option %s is not recognised or cannot be parsed', varargin{a});
                                end
                                switch lower(varargin{a}(2))
                                    case 'm'
                                        % Magnification may never be negative
                                        if val <= 0
                                            wasError = true;
                                            error('Bad magnification value: %g (must be positive)', val);
                                        end
                                        options.magnify = val;
                                    case 'r'
                                        options.resolution = val;
                                    case 'q'
                                        options.quality = max(val, 0);
                                    case 'p'
                                        options.bb_padding = val;
                                end
                            end
                        catch err
                            % We might have reached here by raising an intentional error
                            if wasError  % intentional raise
                                rethrow(err)
                            else  % unintentional
                                error(['Unrecognized export_fig input option: ''' varargin{a} '''']);
                            end
                        end
                end
            else
                [p, options.name, ext] = fileparts(varargin{a});
                if ~isempty(p)
                    % Issue #221: alert if the requested folder does not exist
                    if ~exist(p,'dir'),  error(['Folder ' p ' does not exist!']);  end
                    options.name = [p filesep options.name];
                end
                switch lower(ext)
                    case {'.tif', '.tiff'}
                        options.tif = true;
                    case {'.jpg', '.jpeg'}
                        options.jpg = true;
                    case '.png'
                        options.png = true;
                    case '.bmp'
                        options.bmp = true;
                    case '.eps'
                        options.eps = true;
                    case '.pdf'
                        options.pdf = true;
                    case '.fig'
                        % If no open figure, then load the specified .fig file and continue
                        if isempty(fig)
                            fig = openfig(varargin{a},'invisible');
                            varargin{a} = fig;
                            options.closeFig = true;
                        else
                            % save the current figure as the specified .fig file and exit
                            saveas(fig(1),varargin{a});
                            fig = -1;
                            return
                        end
                    case '.svg'
                        filename = strrep(options.name,'export_fig_out','filename');
                        msg = ['SVG output is not supported by export_fig. Use one of the following alternatives:\n' ...
                               '  1. saveas(gcf,''' filename '.svg'')\n' ...
                               '  2. plot2svg utility: https://github.com/kupiqu/plot2svg\n' ...  % Note: replaced defunct https://github.com/jschwizer99/plot2svg with up-to-date fork on https://github.com/kupiqu/plot2svg
                               '  3. export_fig to EPS/PDF, then convert to SVG using generic (non-Matlab) tools\n'];
                        error(sprintf(msg)); %#ok<SPERR>
                    otherwise
                        options.name = varargin{a};
                end
            end
        end
    end

    % Quick bail-out if no figure found
    if isempty(fig),  return;  end

    % Do border padding with repsect to a cropped image
    if options.bb_padding
        options.crop = true;
    end

    % Set default anti-aliasing now we know the renderer
    if options.aa_factor == 0
        try isAA = strcmp(get(ancestor(fig, 'figure'), 'GraphicsSmoothing'), 'on'); catch, isAA = false; end
        options.aa_factor = 1 + 2 * (~(using_hg2(fig) && isAA) | (options.renderer == 3));
    end

    % Convert user dir '~' to full path
    if numel(options.name) > 2 && options.name(1) == '~' && (options.name(2) == '/' || options.name(2) == '\')
        options.name = fullfile(char(java.lang.System.getProperty('user.home')), options.name(2:end));
    end

    % Compute the magnification and resolution
    if isempty(options.magnify)
        if isempty(options.resolution)
            options.magnify = 1;
            options.resolution = 864;
        else
            options.magnify = options.resolution ./ get(0, 'ScreenPixelsPerInch');
        end
    elseif isempty(options.resolution)
        options.resolution = 864;
    end

    % Set the default format
    if ~isvector(options) && ~isbitmap(options)
        options.png = true;
    end

    % Check whether transparent background is wanted (old way)
    if isequal(get(ancestor(fig(1), 'figure'), 'Color'), 'none')
        options.transparent = true;
    end

    % If requested, set the resolution to the native vertical resolution of the
    % first suitable image found
    if native
        if isbitmap(options)
            % Find a suitable image
            list = findall(fig, 'Type','image', 'Tag','export_fig_native');
            if isempty(list)
                list = findall(fig, 'Type','image', 'Visible','on');
            end
            for hIm = list(:)'
                % Check height is >= 2
                height = size(get(hIm, 'CData'), 1);
                if height < 2
                    continue
                end
                % Account for the image filling only part of the axes, or vice versa
                yl = get(hIm, 'YData');
                if isscalar(yl)
                    yl = [yl(1)-0.5 yl(1)+height+0.5];
                else
                    yl = [min(yl), max(yl)];  % fix issue #151 (case of yl containing more than 2 elements)
                    if ~diff(yl)
                        continue
                    end
                    yl = yl + [-0.5 0.5] * (diff(yl) / (height - 1));
                end
                hAx = get(hIm, 'Parent');
                yl2 = get(hAx, 'YLim');
                % Find the pixel height of the axes
                oldUnits = get(hAx, 'Units');
                set(hAx, 'Units', 'pixels');
                pos = get(hAx, 'Position');
                set(hAx, 'Units', oldUnits);
                if ~pos(4)
                    continue
                end
                % Found a suitable image
                % Account for stretch-to-fill being disabled
                pbar = get(hAx, 'PlotBoxAspectRatio');
                pos = min(pos(4), pbar(2)*pos(3)/pbar(1));
                % Set the magnification to give native resolution
                options.magnify = abs((height * diff(yl2)) / (pos * diff(yl)));  % magnification must never be negative: issue #103
                break
            end
        elseif options.resolution == 864  % don't use -r864 in vector mode if user asked for -native
            options.resolution = []; % issue #241 (internal Matlab bug produces black lines with -r864)
        end
    end
end

% Convert a possible string => char (issue #245)
function value = str2char(value)
    if isa(value,'string')
        value = char(value);
    end
end

function A = downsize(A, factor)
    % Downsample an image
    if factor == 1
        % Nothing to do
        return
    end
    try
        % Faster, but requires image processing toolbox
        A = imresize(A, 1/factor, 'bilinear');
    catch
        % No image processing toolbox - resize manually
        % Lowpass filter - use Gaussian as is separable, so faster
        % Compute the 1d Gaussian filter
        filt = (-factor-1:factor+1) / (factor * 0.6);
        filt = exp(-filt .* filt);
        % Normalize the filter
        filt = single(filt / sum(filt));
        % Filter the image
        padding = floor(numel(filt) / 2);
        for a = 1:size(A, 3)
            A(:,:,a) = conv2(filt, filt', single(A([ones(1, padding) 1:end repmat(end, 1, padding)],[ones(1, padding) 1:end repmat(end, 1, padding)],a)), 'valid');
        end
        % Subsample
        A = A(1+floor(mod(end-1, factor)/2):factor:end,1+floor(mod(end-1, factor)/2):factor:end,:);
    end
end

function A = rgb2grey(A)
    A = cast(reshape(reshape(single(A), [], 3) * single([0.299; 0.587; 0.114]), size(A, 1), size(A, 2)), class(A)); % #ok<ZEROLIKE>
end

function A = check_greyscale(A)
    % Check if the image is greyscale
    if size(A, 3) == 3 && ...
            all(reshape(A(:,:,1) == A(:,:,2), [], 1)) && ...
            all(reshape(A(:,:,2) == A(:,:,3), [], 1))
        A = A(:,:,1); % Save only one channel for 8-bit output
    end
end

function eps_remove_background(fname, count)
    % Remove the background of an eps file
    % Open the file
    fh = fopen(fname, 'r+');
    if fh == -1
        error('Not able to open file %s.', fname);
    end
    % Read the file line by line
    while count
        % Get the next line
        l = fgets(fh);
        if isequal(l, -1)
            break; % Quit, no rectangle found
        end
        % Check if the line contains the background rectangle
        if isequal(regexp(l, ' *0 +0 +\d+ +\d+ +r[fe] *[\n\r]+', 'start'), 1)
            % Set the line to whitespace and quit
            l(1:regexp(l, '[\n\r]', 'start', 'once')-1) = ' ';
            fseek(fh, -numel(l), 0);
            fprintf(fh, l);
            % Reduce the count
            count = count - 1;
        end
    end
    % Close the file
    fclose(fh);
end

function b = isvector(options)
    b = options.pdf || options.eps;
end

function b = isbitmap(options)
    b = options.png || options.tif || options.jpg || options.bmp || options.im || options.alpha;
end

% Helper function
function A = make_cell(A)
    if ~iscell(A)
        A = {A};
    end
end

function add_bookmark(fname, bookmark_text)
    % Adds a bookmark to the temporary EPS file after %%EndPageSetup
    % Read in the file
    fh = fopen(fname, 'r');
    if fh == -1
        error('File %s not found.', fname);
    end
    try
        fstrm = fread(fh, '*char')';
    catch ex
        fclose(fh);
        rethrow(ex);
    end
    fclose(fh);

    % Include standard pdfmark prolog to maximize compatibility
    fstrm = strrep(fstrm, '%%BeginProlog', sprintf('%%%%BeginProlog\n/pdfmark where {pop} {userdict /pdfmark /cleartomark load put} ifelse'));
    % Add page bookmark
    fstrm = strrep(fstrm, '%%EndPageSetup', sprintf('%%%%EndPageSetup\n[ /Title (%s) /OUT pdfmark',bookmark_text));

    % Write out the updated file
    fh = fopen(fname, 'w');
    if fh == -1
        error('Unable to open %s for writing.', fname);
    end
    try
        fwrite(fh, fstrm, 'char*1');
    catch ex
        fclose(fh);
        rethrow(ex);
    end
    fclose(fh);
end

function set_tick_mode(Hlims, ax)
    % Set the tick mode of linear axes to manual
    % Leave log axes alone as these are tricky
    M = get(Hlims, [ax 'Scale']);
    if ~iscell(M)
        M = {M};
    end
    %idx = cellfun(@(c) strcmp(c, 'linear'), M);
    idx = find(strcmp(M,'linear'));
    %set(Hlims(idx), [ax 'TickMode'], 'manual');  % issue #187
    %set(Hlims(idx), [ax 'TickLabelMode'], 'manual');  % this hides exponent label in HG2!
    for idx2 = 1 : numel(idx)
        try
            % Fix for issue #187 - only set manual ticks when no exponent is present
            hAxes = Hlims(idx(idx2));
            props = {[ax 'TickMode'],'manual', [ax 'TickLabelMode'],'manual'};
            tickVals = get(hAxes,[ax 'Tick']);
            tickStrs = get(hAxes,[ax 'TickLabel']);
            try % Fix issue #236
                exponents = [hAxes.([ax 'Axis']).SecondaryLabel];
            catch
                exponents = [hAxes.([ax 'Ruler']).SecondaryLabel];
            end
            if isempty([exponents.String])
                % Fix for issue #205 - only set manual ticks when the Ticks number match the TickLabels number
                if numel(tickVals) == numel(tickStrs)
                    set(hAxes, props{:});  % no exponent and matching ticks, so update both ticks and tick labels to manual
                end
            end
        catch  % probably HG1
            % Fix for issue #220 - exponent is removed in HG1 when TickMode is 'manual' (internal Matlab bug)
            if isequal(tickVals, str2num(tickStrs)') %#ok<ST2NM>
                set(hAxes, props{:});  % revert back to old behavior
            end
        end
    end
end

function change_rgb_to_cmyk(fname)  % convert RGB => CMYK within an EPS file
    % Do post-processing on the eps file
    try
        % Read the EPS file into memory
        fstrm = read_write_entire_textfile(fname);

        % Replace all gray-scale colors
        fstrm = regexprep(fstrm, '\n([\d.]+) +GC\n', '\n0 0 0 ${num2str(1-str2num($1))} CC\n');
        
        % Replace all RGB colors
        fstrm = regexprep(fstrm, '\n[0.]+ +[0.]+ +[0.]+ +RC\n', '\n0 0 0 1 CC\n');  % pure black
        fstrm = regexprep(fstrm, '\n([\d.]+) +([\d.]+) +([\d.]+) +RC\n', '\n${sprintf(''%.4g '',[1-[str2num($1),str2num($2),str2num($3)]/max([str2num($1),str2num($2),str2num($3)]),1-max([str2num($1),str2num($2),str2num($3)])])} CC\n');

        % Overwrite the file with the modified contents
        read_write_entire_textfile(fname, fstrm);
    catch
        % never mind - leave as is...
    end
end

function hBlackAxles = fixBlackAxle(hAxes, axleName)
    hBlackAxles = [];
    for idx = 1 : numel(hAxes)
        ax = hAxes(idx);
        axleColor = get(ax, axleName);
        if isequal(axleColor,[0,0,0]) || isequal(axleColor,'k')
            hBlackAxles(end+1) = ax; %#ok<AGROW>
        end
    end
    set(hBlackAxles, axleName, [0,0,0.01]);  % off-black
end

%APPEND_PDFS Appends/concatenates multiple PDF files
%
% Example:
%   append_pdfs(output, input1, input2, ...)
%   append_pdfs(output, input_list{:})
%   append_pdfs test.pdf temp1.pdf temp2.pdf
%
% This function appends multiple PDF files to an existing PDF file, or
% concatenates them into a PDF file if the output file doesn't yet exist.
%
% This function requires that you have ghostscript installed on your
% system. Ghostscript can be downloaded from: http://www.ghostscript.com
%
% IN:
%    output - string of output file name (including the extension, .pdf).
%             If it exists it is appended to; if not, it is created.
%    input1 - string of an input file name (including the extension, .pdf).
%             All input files are appended in order.
%    input_list - cell array list of input file name strings. All input
%                 files are appended in order.

% Copyright: Oliver Woodford, 2011

% Thanks to Reinhard Knoll for pointing out that appending multiple pdfs in
% one go is much faster than appending them one at a time.

% Thanks to Michael Teo for reporting the issue of a too long command line.
% Issue resolved on 5/5/2011, by passing gs a command file.

% Thanks to Martin Wittmann for pointing out the quality issue when
% appending multiple bitmaps.
% Issue resolved (to best of my ability) 1/6/2011, using the prepress
% setting

% 26/02/15: If temp dir is not writable, use the output folder for temp
%           files when appending (Javier Paredes); sanity check of inputs
% 24/01/18: Fixed error in case of existing output file (append mode)
% 24/01/18: Fixed issue #213: non-ASCII characters in folder names on Windows
% 06/12/18: Avoid an "invalid escape-char" warning upon error

function append_pdfs(varargin)

    if nargin < 2,  return;  end  % sanity check

    % Are we appending or creating a new file
    append = exist(varargin{1}, 'file') == 2;
    output = [tempname '.pdf'];
    try
        % Ensure that the temp dir is writable (Javier Paredes 26/2/15)
        fid = fopen(output,'w');
        fwrite(fid,1);
        fclose(fid);
        delete(output);
        isTempDirOk = true;
    catch
        % Temp dir is not writable, so use the output folder
        [dummy,fname,fext] = fileparts(output); %#ok<ASGLU>
        fpath = fileparts(varargin{1});
        output = fullfile(fpath,[fname fext]);
        isTempDirOk = false;
    end
    if ~append
        output = varargin{1};
        varargin = varargin(2:end);
    end

    % Create the command file
    if isTempDirOk
        cmdfile = [tempname '.txt'];
    else
        cmdfile = fullfile(fpath,[fname '.txt']);
    end
    prepareCmdFile(cmdfile, output, varargin{:});

    % Call ghostscript
    [status, errMsg] = ghostscript(['@"' cmdfile '"']);

    % Check for ghostscript execution errors
    if status && ~isempty(strfind(errMsg,'undefinedfile')) && ispc %#ok<STREMP>
        % Fix issue #213: non-ASCII characters in folder names on Windows
        for fileIdx = 2 : numel(varargin)
            [fpath,fname,fext] = fileparts(varargin{fileIdx});
            varargin{fileIdx} = fullfile(normalizePath(fpath),[fname fext]);
        end
        % Rerun ghostscript with the normalized folder names
        prepareCmdFile(cmdfile, output, varargin{:});
        [status, errMsg] = ghostscript(['@"' cmdfile '"']);
    end

    % Delete the command file
    delete(cmdfile);

    % Check for ghostscript execution errors
    if status
        errMsg = strrep(errMsg,'\','\\');  % Avoid an "invalid escape-char" warning
        error('YMA:export_fig:append_pdf',errMsg);
    end

    % Rename the file if needed
    if append
        movefile(output, varargin{1}, 'f');
    end
end

% Prepare a text file with ghostscript directives
function prepareCmdFile(cmdfile, output, varargin)
    fh = fopen(cmdfile, 'w');
    fprintf(fh, '-q -dNOPAUSE -dBATCH -sDEVICE=pdfwrite -dPDFSETTINGS=/prepress -sOutputFile="%s" -f', output);
    fprintf(fh, ' "%s"', varargin{:});
    fclose(fh);
end

% Convert long/non-ASCII folder names into their short ASCII equivalents
function pathStr = normalizePath(pathStr)
    [fpath,fname,fext] = fileparts(pathStr);
    if isempty(fpath) || strcmpi(fpath,pathStr), return, end
    dirOutput = evalc(['system(''dir /X /AD "' pathStr '*"'')']);
    shortName = strtrim(regexprep(dirOutput,{'.*> *',[fname fext '.*']},''));
    if isempty(shortName)
        shortName = [fname fext];
    end
    fpath = normalizePath(fpath);  %recursive until entire fpath is processed
    pathStr = fullfile(fpath, shortName);
end

function fh = copyfig(fh)
%COPYFIG Create a copy of a figure, without changing the figure
%
% Examples:
%   fh_new = copyfig(fh_old)
%
% This function will create a copy of a figure, but not change the figure,
% as copyobj sometimes does, e.g. by changing legends.
%
% IN:
%    fh_old - The handle of the figure to be copied. Default: gcf.
%
% OUT:
%    fh_new - The handle of the created figure.

% Copyright (C) Oliver Woodford 2012, Yair Altman 2015

% 26/02/15: If temp dir is not writable, use the dest folder for temp
%           destination files (Javier Paredes)
% 15/04/15: Suppress warnings during copyobj (Dun Kirk comment on FEX page 2013-10-02)
% 09/09/18: Fix issue #252: Workaround for cases where copyobj() fails for any reason

    % Set the default
    if nargin == 0
        fh = gcf;
    end
    % Is there a legend?
    useCopyobj = isempty(findall(fh, 'Type', 'axes', 'Tag', 'legend'));
    if useCopyobj
        % Safe to copy using copyobj
        oldWarn = warning('off'); %Suppress warnings during copyobj (Dun Kirk comment on FEX page 2013-10-02)
        try
            fh = copyobj(fh, 0);
        catch
            % Fix issue #252: Workaround for cases where copyobj() fails for any reason
            useCopyobj = false;  % if copyobj() croaks, use file save/load below
        end
        warning(oldWarn);
    end
    if ~useCopyobj
        % copyobj will change the figure, so save and then load it instead
        tmp_nam = [tempname '.fig'];
        try
            % Ensure that the temp dir is writable (Javier Paredes 26/2/15)
            fid = fopen(tmp_nam,'w');
            fwrite(fid,1);
            fclose(fid);
            delete(tmp_nam);  % cleanup
        catch
            % Temp dir is not writable, so use the current folder
            [dummy,fname,fext] = fileparts(tmp_nam); %#ok<ASGLU>
            fpath = pwd;
            tmp_nam = fullfile(fpath,[fname fext]);
        end
        hgsave(fh, tmp_nam);
        fh = hgload(tmp_nam);
        delete(tmp_nam);
    end
end

function [A, vA, vB, bb_rel] = crop_borders(A, bcol, padding, crop_amounts)
%CROP_BORDERS Crop the borders of an image or stack of images
%
%   [B, vA, vB, bb_rel] = crop_borders(A, bcol, [padding])
%
%IN:
%   A - HxWxCxN stack of images.
%   bcol - Cx1 background colour vector.
%   padding - scalar indicating how much padding to have in relation to
%             the cropped-image-size (0<=padding<=1). Default: 0
%   crop_amounts - 4-element vector of crop amounts: [top,right,bottom,left]
%             where NaN/Inf indicate auto-cropping, 0 means no cropping,
%             and any other value mean cropping in pixel amounts.
%
%OUT:
%   B - JxKxCxN cropped stack of images.
%   vA     - coordinates in A that contain the cropped image
%   vB     - coordinates in B where the cropped version of A is placed
%   bb_rel - relative bounding box (used for eps-cropping)

%{
% 06/03/15: Improved image cropping thanks to Oscar Hartogensis
% 08/06/15: Fixed issue #76: case of transparent figure bgcolor
% 21/02/16: Enabled specifying non-automated crop amounts
% 04/04/16: Fix per Luiz Carvalho for old Matlab releases
% 23/10/16: Fixed issue #175: there used to be a 1px minimal padding in case of crop, now removed
%}

    if nargin < 3
        padding = 0;
    end
    if nargin < 4
        crop_amounts = nan(1,4);  % =auto-cropping
    end
    crop_amounts(end+1:4) = NaN;  % fill missing values with NaN

    [h, w, c, n] = size(A);
    if isempty(bcol)  % case of transparent bgcolor
        bcol = A(ceil(end/2),1,:,1);
    end
    if isscalar(bcol)
        bcol = bcol(ones(c, 1));
    end

    % Crop margin from left
    if ~isfinite(crop_amounts(4))
        bail = false;
        for l = 1:w
            for a = 1:c
                if ~all(col(A(:,l,a,:)) == bcol(a))
                    bail = true;
                    break;
                end
            end
            if bail
                break;
            end
        end
    else
        l = 1 + abs(crop_amounts(4));
    end

    % Crop margin from right
    if ~isfinite(crop_amounts(2))
        bcol = A(ceil(end/2),w,:,1);
        bail = false;
        for r = w:-1:l
            for a = 1:c
                if ~all(col(A(:,r,a,:)) == bcol(a))
                    bail = true;
                    break;
                end
            end
            if bail
                break;
            end
        end
    else
        r = w - abs(crop_amounts(2));
    end

    % Crop margin from top
    if ~isfinite(crop_amounts(1))
        bcol = A(1,ceil(end/2),:,1);
        bail = false;
        for t = 1:h
            for a = 1:c
                if ~all(col(A(t,:,a,:)) == bcol(a))
                    bail = true;
                    break;
                end
            end
            if bail
                break;
            end
        end
    else
        t = 1 + abs(crop_amounts(1));
    end

    % Crop margin from bottom
    bcol = A(h,ceil(end/2),:,1);
    if ~isfinite(crop_amounts(3))
        bail = false;
        for b = h:-1:t
            for a = 1:c
                if ~all(col(A(b,:,a,:)) == bcol(a))
                    bail = true;
                    break;
                end
            end
            if bail
                break;
            end
        end
    else
        b = h - abs(crop_amounts(3));
    end

    if padding == 0  % no padding
        % Issue #175: there used to be a 1px minimal padding in case of crop, now removed
        %{
        if ~isequal([t b l r], [1 h 1 w]) % Check if we're actually croppping
            padding = 1; % Leave one boundary pixel to avoid bleeding on resize
            bcol(:) = nan;  % make the 1px padding transparent
        end
        %}
    elseif abs(padding) < 1  % pad value is a relative fraction of image size
        padding = sign(padding)*round(mean([b-t r-l])*abs(padding)); % ADJUST PADDING
    else  % pad value is in units of 1/72" points
        padding = round(padding);  % fix cases of non-integer pad value
    end

    if padding > 0  % extra padding
        % Create an empty image, containing the background color, that has the
        % cropped image size plus the padded border
        B = repmat(bcol,[(b-t)+1+padding*2,(r-l)+1+padding*2,1,n]);  % Fix per Luiz Carvalho
        % vA - coordinates in A that contain the cropped image
        vA = [t b l r];
        % vB - coordinates in B where the cropped version of A will be placed
        vB = [padding+1, (b-t)+1+padding, padding+1, (r-l)+1+padding];
        % Place the original image in the empty image
        B(vB(1):vB(2), vB(3):vB(4), :, :) = A(vA(1):vA(2), vA(3):vA(4), :, :);
        A = B;
    else  % extra cropping
        vA = [t-padding b+padding l-padding r+padding];
        A = A(vA(1):vA(2), vA(3):vA(4), :, :);
        vB = [NaN NaN NaN NaN];
    end

    % For EPS cropping, determine the relative BoundingBox - bb_rel
    bb_rel = [l-1 h-b-1 r+1 h-t+1]./[w h w h];
end

function A = col(A)
    A = A(:);
end

function eps2pdf(source, dest, crop, append, gray, quality, gs_options)
%EPS2PDF  Convert an eps file to pdf format using ghostscript
%
% Examples:
%   eps2pdf source dest
%   eps2pdf(source, dest, crop)
%   eps2pdf(source, dest, crop, append)
%   eps2pdf(source, dest, crop, append, gray)
%   eps2pdf(source, dest, crop, append, gray, quality)
%   eps2pdf(source, dest, crop, append, gray, quality, gs_options)
%
% This function converts an eps file to pdf format. The output can be
% optionally cropped and also converted to grayscale. If the output pdf
% file already exists then the eps file can optionally be appended as a new
% page on the end of the eps file. The level of bitmap compression can also
% optionally be set.
%
% This function requires that you have ghostscript installed on your
% system. Ghostscript can be downloaded from: http://www.ghostscript.com
%
% Inputs:
%   source  - filename of the source eps file to convert. The filename is
%             assumed to already have the extension ".eps".
%   dest    - filename of the destination pdf file. The filename is assumed
%             to already have the extension ".pdf".
%   crop    - boolean indicating whether to crop the borders off the pdf.
%             Default: true.
%   append  - boolean indicating whether the eps should be appended to the
%             end of the pdf as a new page (if the pdf exists already).
%             Default: false.
%   gray    - boolean indicating whether the output pdf should be grayscale
%             or not. Default: false.
%   quality - scalar indicating the level of image bitmap quality to
%             output. A larger value gives a higher quality. quality > 100
%             gives lossless output. Default: ghostscript prepress default.
%   gs_options - optional ghostscript options (e.g.: '-dNoOutputFonts'). If
%                multiple options are needed, enclose in call array: {'-a','-b'}

% Copyright (C) Oliver Woodford 2009-2014, Yair Altman 2015-

% Suggestion of appending pdf files provided by Matt C at:
% http://www.mathworks.com/matlabcentral/fileexchange/23629

% Thank you to Fabio Viola for pointing out compression artifacts, leading
% to the quality setting.
% Thank you to Scott for pointing out the subsampling of very small images,
% which was fixed for lossless compression settings.

% 09/12/11: Pass font path to ghostscript
% 26/02/15: If temp dir is not writable, use the dest folder for temp
%           destination files (Javier Paredes)
% 28/02/15: Enable users to specify optional ghostscript options (issue #36)
% 01/03/15: Upon GS error, retry without the -sFONTPATH= option (this might solve
%           some /findfont errors according to James Rankin, FEX Comment 23/01/15)
% 23/06/15: Added extra debug info in case of ghostscript error; code indentation
% 04/10/15: Suggest a workaround for issue #41 (missing font path; thanks Mariia Fedotenkova)
% 22/02/16: Bug fix from latest release of this file (workaround for issue #41)
% 20/03/17: Added informational message in case of GS croak (issue #186)
% 16/01/18: Improved appending of multiple EPS files into single PDF (issue #233; thanks @shartjen)

    % Intialise the options string for ghostscript
    options = ['-q -dNOPAUSE -dBATCH -sDEVICE=pdfwrite -dPDFSETTINGS=/prepress -sOutputFile="' dest '"'];
    % Set crop option
    if nargin < 3 || crop
        options = [options ' -dEPSCrop'];
    end
    % Set the font path
    fp = font_path();
    if ~isempty(fp)
        options = [options ' -sFONTPATH="' fp '"'];
    end
    % Set the grayscale option
    if nargin > 4 && gray
        options = [options ' -sColorConversionStrategy=Gray -dProcessColorModel=/DeviceGray'];
    end
    % Set the bitmap quality
    if nargin > 5 && ~isempty(quality)
        options = [options ' -dAutoFilterColorImages=false -dAutoFilterGrayImages=false'];
        if quality > 100
            options = [options ' -dColorImageFilter=/FlateEncode -dGrayImageFilter=/FlateEncode -c ".setpdfwrite << /ColorImageDownsampleThreshold 10 /GrayImageDownsampleThreshold 10 >> setdistillerparams"'];
        else
            options = [options ' -dColorImageFilter=/DCTEncode -dGrayImageFilter=/DCTEncode'];
            v = 1 + (quality < 80);
            quality = 1 - quality / 100;
            s = sprintf('<< /QFactor %.2f /Blend 1 /HSample [%d 1 1 %d] /VSample [%d 1 1 %d] >>', quality, v, v, v, v);
            options = sprintf('%s -c ".setpdfwrite << /ColorImageDict %s /GrayImageDict %s >> setdistillerparams"', options, s, s);
        end
    end
    % Enable users to specify optional ghostscript options (issue #36)
    if nargin > 6 && ~isempty(gs_options)
        if iscell(gs_options)
            gs_options = sprintf(' %s',gs_options{:});
        elseif ~ischar(gs_options)
            error('gs_options input argument must be a string or cell-array of strings');
        else
            gs_options = [' ' gs_options];
        end
        options = [options gs_options];
    end
    % Check if the output file exists
    if nargin > 3 && append && exist(dest, 'file') == 2
        % File exists - append current figure to the end
        tmp_nam = [tempname '.pdf'];
        [fpath,fname,fext] = fileparts(tmp_nam);
        try
            % Ensure that the temp dir is writable (Javier Paredes 26/2/15)
            fid = fopen(tmp_nam,'w');
            fwrite(fid,1);
            fclose(fid);
            delete(tmp_nam);
        catch
            % Temp dir is not writable, so use the dest folder
            fpath = fileparts(dest);
            tmp_nam = fullfile(fpath,[fname fext]);
        end
        % Copy the existing (dest) pdf file to temporary folder
        copyfile(dest, tmp_nam);
        % Produce an interim pdf of the source eps, rather than adding the eps directly (issue #233)
        ghostscript([options ' -f "' source '"']);
        [~,fname] = fileparts(tempname);
        tmp_nam2 = fullfile(fpath,[fname fext]); % ensure using a writable folder (not necessarily tempdir)
        copyfile(dest, tmp_nam2);
        % Add the existing pdf and interim pdf as inputs to ghostscript
        %options = [options ' -f "' tmp_nam '" "' source '"'];  % append the source eps to dest pdf
        options = [options ' -f "' tmp_nam '" "' tmp_nam2 '"']; % append the interim pdf to dest pdf
        try
            % Convert to pdf using ghostscript
            [status, message] = ghostscript(options);
        catch me
            % Delete the intermediate files and rethrow the error
            delete(tmp_nam);
            delete(tmp_nam2);
            rethrow(me);
        end
        % Delete the intermediate (temporary) files
        delete(tmp_nam);
        delete(tmp_nam2);
    else
        % File doesn't exist or should be over-written
        % Add the source eps file as input to ghostscript
        options = [options ' -f "' source '"'];
        % Convert to pdf using ghostscript
        [status, message] = ghostscript(options);
    end
    % Check for error
    if status
        % Retry without the -sFONTPATH= option (this might solve some GS
        % /findfont errors according to James Rankin, FEX Comment 23/01/15)
        orig_options = options;
        if ~isempty(fp)
            options = regexprep(options, ' -sFONTPATH=[^ ]+ ',' ');
            status = ghostscript(options);
            if ~status, return; end  % hurray! (no error)
        end
        % Report error
        if isempty(message)
            error('Unable to generate pdf. Check destination directory is writable.');
        elseif ~isempty(strfind(message,'/typecheck in /findfont'))
            % Suggest a workaround for issue #41 (missing font path)
            font_name = strtrim(regexprep(message,'.*Operand stack:\s*(.*)\s*Execution.*','$1'));
            fprintf(2, 'Ghostscript error: could not find the following font(s): %s\n', font_name);
            fpath = fileparts(mfilename('fullpath'));
            gs_fonts_file = fullfile(fpath, '.ignore', 'gs_font_path.txt');
            fprintf(2, '  try to add the font''s folder to your %s file\n\n', gs_fonts_file);
            error('export_fig error');
        else
            fprintf(2, '\nGhostscript error: perhaps %s is open by another application\n', dest);
            if ~isempty(gs_options)
                fprintf(2, '  or maybe the%s option(s) are not accepted by your GS version\n', gs_options);
            end
            fprintf(2, '  or maybe you have another gs executable in your system''s path\n');
            fprintf(2, 'Ghostscript options: %s\n\n', orig_options);
            error(message);
        end
    end
end

% Function to return (and create, where necessary) the font path
function fp = font_path()
    fp = user_string('gs_font_path');
    if ~isempty(fp)
        return
    end
    % Create the path
    % Start with the default path
    fp = getenv('GS_FONTPATH');
    % Add on the typical directories for a given OS
    if ispc
        if ~isempty(fp)
            fp = [fp ';'];
        end
        fp = [fp getenv('WINDIR') filesep 'Fonts'];
    else
        if ~isempty(fp)
            fp = [fp ':'];
        end
        fp = [fp '/usr/share/fonts:/usr/local/share/fonts:/usr/share/fonts/X11:/usr/local/share/fonts/X11:/usr/share/fonts/truetype:/usr/local/share/fonts/truetype'];
    end
    user_string('gs_font_path', fp);
end

%FIX_LINES  Improves the line style of eps files generated by print
%
% Examples:
%   fix_lines fname
%   fix_lines fname fname2
%   fstrm_out = fixlines(fstrm_in)
%
% This function improves the style of lines in eps files generated by
% MATLAB's print function, making them more similar to those seen on
% screen. Grid lines are also changed from a dashed style to a dotted
% style, for greater differentiation from dashed lines.
% 
% The function also places embedded fonts after the postscript header, in
% versions of MATLAB which place the fonts first (R2006b and earlier), in
% order to allow programs such as Ghostscript to find the bounding box
% information.
%
%IN:
%   fname - Name or path of source eps file.
%   fname2 - Name or path of destination eps file. Default: same as fname.
%   fstrm_in - File contents of a MATLAB-generated eps file.
%
%OUT:
%   fstrm_out - Contents of the eps file with line styles fixed.

% Copyright: (C) Oliver Woodford, 2008-2014

% The idea of editing the EPS file to change line styles comes from Jiro
% Doke's FIXPSLINESTYLE (fex id: 17928)
% The idea of changing dash length with line width came from comments on
% fex id: 5743, but the implementation is mine :)

% Thank you to Sylvain Favrot for bringing the embedded font/bounding box
% interaction in older versions of MATLAB to my attention.
% Thank you to D Ko for bringing an error with eps files with tiff previews
% to my attention.
% Thank you to Laurence K for suggesting the check to see if the file was
% opened.

% 01/03/15: Issue #20: warn users if using this function in HG2 (R2014b+)
% 27/03/15: Fixed out of memory issue with enormous EPS files (generated by print() with OpenGL renderer), related to issue #39

function fstrm = fix_lines(fstrm, fname2)

% Issue #20: warn users if using this function in HG2 (R2014b+)
if using_hg2
    warning('export_fig:hg2','The fix_lines function should not be used in this Matlab version.');
end
    
if nargout == 0 || nargin > 1
    if nargin < 2
        % Overwrite the input file
        fname2 = fstrm;
    end
    % Read in the file
    fstrm = read_write_entire_textfile(fstrm);
end

% Move any embedded fonts after the postscript header
if strcmp(fstrm(1:15), '%!PS-AdobeFont-')
    % Find the start and end of the header
    ind = regexp(fstrm, '[\n\r]%!PS-Adobe-');
    [ind2, ind2] = regexp(fstrm, '[\n\r]%%EndComments[\n\r]+');
    % Put the header first
    if ~isempty(ind) && ~isempty(ind2) && ind(1) < ind2(1)
        fstrm = fstrm([ind(1)+1:ind2(1) 1:ind(1) ind2(1)+1:end]);
    end
end

% Make sure all line width commands come before the line style definitions,
% so that dash lengths can be based on the correct widths
% Find all line style sections
ind = [regexp(fstrm, '[\n\r]SO[\n\r]'),... % This needs to be here even though it doesn't have dots/dashes!
       regexp(fstrm, '[\n\r]DO[\n\r]'),...
       regexp(fstrm, '[\n\r]DA[\n\r]'),...
       regexp(fstrm, '[\n\r]DD[\n\r]')];
ind = sort(ind);
% Find line width commands
[ind2, ind3] = regexp(fstrm, '[\n\r]\d* w[\n\r]');
% Go through each line style section and swap with any line width commands
% near by
b = 1;
m = numel(ind);
n = numel(ind2);
for a = 1:m
    % Go forwards width commands until we pass the current line style
    while b <= n && ind2(b) < ind(a)
        b = b + 1;
    end
    if b > n
        % No more width commands
        break;
    end
    % Check we haven't gone past another line style (including SO!)
    if a < m && ind2(b) > ind(a+1)
        continue;
    end
    % Are the commands close enough to be confident we can swap them?
    if (ind2(b) - ind(a)) > 8
        continue;
    end
    % Move the line style command below the line width command
    fstrm(ind(a)+1:ind3(b)) = [fstrm(ind(a)+4:ind3(b)) fstrm(ind(a)+1:ind(a)+3)];
    b = b + 1;
end

% Find any grid line definitions and change to GR format
% Find the DO sections again as they may have moved
ind = int32(regexp(fstrm, '[\n\r]DO[\n\r]'));
if ~isempty(ind)
    % Find all occurrences of what are believed to be axes and grid lines
    ind2 = int32(regexp(fstrm, '[\n\r] *\d* *\d* *mt *\d* *\d* *L[\n\r]'));
    if ~isempty(ind2)
        % Now see which DO sections come just before axes and grid lines
        ind2 = repmat(ind2', [1 numel(ind)]) - repmat(ind, [numel(ind2) 1]);
        ind2 = any(ind2 > 0 & ind2 < 12); % 12 chars seems about right
        ind = ind(ind2);
        % Change any regions we believe to be grid lines to GR
        fstrm(ind+1) = 'G';
        fstrm(ind+2) = 'R';
    end
end

% Define the new styles, including the new GR format
% Dot and dash lengths have two parts: a constant amount plus a line width
% variable amount. The constant amount comes after dpi2point, and the
% variable amount comes after currentlinewidth. If you want to change
% dot/dash lengths for a one particular line style only, edit the numbers
% in the /DO (dotted lines), /DA (dashed lines), /DD (dot dash lines) and
% /GR (grid lines) lines for the style you want to change.
new_style = {'/dom { dpi2point 1 currentlinewidth 0.08 mul add mul mul } bdef',... % Dot length macro based on line width
             '/dam { dpi2point 2 currentlinewidth 0.04 mul add mul mul } bdef',... % Dash length macro based on line width
             '/SO { [] 0 setdash 0 setlinecap } bdef',... % Solid lines
             '/DO { [1 dom 1.2 dom] 0 setdash 0 setlinecap } bdef',... % Dotted lines
             '/DA { [4 dam 1.5 dam] 0 setdash 0 setlinecap } bdef',... % Dashed lines
             '/DD { [1 dom 1.2 dom 4 dam 1.2 dom] 0 setdash 0 setlinecap } bdef',... % Dot dash lines
             '/GR { [0 dpi2point mul 4 dpi2point mul] 0 setdash 1 setlinecap } bdef'}; % Grid lines - dot spacing remains constant

% Construct the output
% This is the original (memory-intensive) code:
%first_sec = strfind(fstrm, '% line types:'); % Isolate line style definition section
%[second_sec, remaining] = strtok(fstrm(first_sec+1:end), '/');
%[remaining, remaining] = strtok(remaining, '%');
%fstrm = [fstrm(1:first_sec) second_sec sprintf('%s\r', new_style{:}) remaining];
fstrm = regexprep(fstrm,'(% line types:.+?)/.+?%',['$1',sprintf('%s\r',new_style{:}),'%']);

% Write the output file
if nargout == 0 || nargin > 1
    read_write_entire_textfile(fname2, fstrm);
end
end

function varargout = ghostscript(cmd)
%GHOSTSCRIPT  Calls a local GhostScript executable with the input command
%
% Example:
%   [status result] = ghostscript(cmd)
%
% Attempts to locate a ghostscript executable, finally asking the user to
% specify the directory ghostcript was installed into. The resulting path
% is stored for future reference.
% 
% Once found, the executable is called with the input command string.
%
% This function requires that you have Ghostscript installed on your
% system. You can download this from: http://www.ghostscript.com
%
% IN:
%   cmd - Command string to be passed into ghostscript.
%
% OUT:
%   status - 0 iff command ran without problem.
%   result - Output from ghostscript.

% Copyright: Oliver Woodford, 2009-2015, Yair Altman 2015-
%{
% Thanks to Jonas Dorn for the fix for the title of the uigetdir window on Mac OS.
% Thanks to Nathan Childress for the fix to default location on 64-bit Windows systems.
% 27/04/11 - Find 64-bit Ghostscript on Windows. Thanks to Paul Durack and
%            Shaun Kline for pointing out the issue
% 04/05/11 - Thanks to David Chorlian for pointing out an alternative
%            location for gs on linux.
% 12/12/12 - Add extra executable name on Windows. Thanks to Ratish
%            Punnoose for highlighting the issue.
% 28/06/13 - Fix error using GS 9.07 in Linux. Many thanks to Jannick
%            Steinbring for proposing the fix.
% 24/10/13 - Fix error using GS 9.07 in Linux. Many thanks to Johannes 
%            for the fix.
% 23/01/14 - Add full path to ghostscript.txt in warning. Thanks to Koen
%            Vermeer for raising the issue.
% 27/02/15 - If Ghostscript croaks, display suggested workarounds
% 30/03/15 - Improved performance by caching status of GS path check, if ok
% 14/05/15 - Clarified warning message in case GS path could not be saved
% 29/05/15 - Avoid cryptic error in case the ghostscipt path cannot be saved (issue #74)
% 10/11/15 - Custom GS installation webpage for MacOS. Thanks to Andy Hueni via FEX
%}

    try
        % Call ghostscript
        [varargout{1:nargout}] = system([gs_command(gs_path()) cmd]);
    catch err
        % Display possible workarounds for Ghostscript croaks
        url1 = 'https://github.com/altmany/export_fig/issues/12#issuecomment-61467998';  % issue #12
        url2 = 'https://github.com/altmany/export_fig/issues/20#issuecomment-63826270';  % issue #20
        hg2_str = ''; if using_hg2, hg2_str = ' or Matlab R2014a'; end
        fprintf(2, 'Ghostscript error. Rolling back to GS 9.10%s may possibly solve this:\n * <a href="%s">%s</a> ',hg2_str,url1,url1);
        if using_hg2
            fprintf(2, '(GS 9.10)\n * <a href="%s">%s</a> (R2014a)',url2,url2);
        end
        fprintf('\n\n');
        if ismac || isunix
            url3 = 'https://github.com/altmany/export_fig/issues/27';  % issue #27
            fprintf(2, 'Alternatively, this may possibly be due to a font path issue:\n * <a href="%s">%s</a>\n\n',url3,url3);
            % issue #20
            fpath = which(mfilename);
            if isempty(fpath), fpath = [mfilename('fullpath') '.m']; end
            fprintf(2, 'Alternatively, if you are using csh, modify shell_cmd from "export..." to "setenv ..."\nat the bottom of <a href="matlab:opentoline(''%s'',174)">%s</a>\n\n',fpath,fpath);
        end
        rethrow(err);
    end
end

function path_ = gs_path
    % Return a valid path
    % Start with the currently set path
    path_ = user_string('ghostscript');
    % Check the path works
    if check_gs_path(path_)
        return
    end
    % Check whether the binary is on the path
    if ispc
        bin = {'gswin32c.exe', 'gswin64c.exe', 'gs'};
    else
        bin = {'gs'};
    end
    for a = 1:numel(bin)
        path_ = bin{a};
        if check_store_gs_path(path_)
            return
        end
    end
    % Search the obvious places
    if ispc
        default_location = 'C:\Program Files\gs\';
        dir_list = dir(default_location);
        if isempty(dir_list)
            default_location = 'C:\Program Files (x86)\gs\'; % Possible location on 64-bit systems
            dir_list = dir(default_location);
        end
        executable = {'\bin\gswin32c.exe', '\bin\gswin64c.exe'};
        ver_num = 0;
        % If there are multiple versions, use the newest
        for a = 1:numel(dir_list)
            ver_num2 = sscanf(dir_list(a).name, 'gs%g');
            if ~isempty(ver_num2) && ver_num2 > ver_num
                for b = 1:numel(executable)
                    path2 = [default_location dir_list(a).name executable{b}];
                    if exist(path2, 'file') == 2
                        path_ = path2;
                        ver_num = ver_num2;
                    end
                end
            end
        end
        if check_store_gs_path(path_)
            return
        end
    else
        executable = {'/usr/bin/gs', '/usr/local/bin/gs'};
        for a = 1:numel(executable)
            path_ = executable{a};
            if check_store_gs_path(path_)
                return
            end
        end
    end
    % Ask the user to enter the path
    while true
        if strncmp(computer, 'MAC', 3) % Is a Mac
            % Give separate warning as the uigetdir dialogue box doesn't have a
            % title
            uiwait(warndlg('Ghostscript not found. Please locate the program.'))
        end
        base = uigetdir('/', 'Ghostcript not found. Please locate the program.');
        if isequal(base, 0)
            % User hit cancel or closed window
            break;
        end
        base = [base filesep]; %#ok<AGROW>
        bin_dir = {'', ['bin' filesep], ['lib' filesep]};
        for a = 1:numel(bin_dir)
            for b = 1:numel(bin)
                path_ = [base bin_dir{a} bin{b}];
                if exist(path_, 'file') == 2
                    if check_store_gs_path(path_)
                        return
                    end
                end
            end
        end
    end
    if ismac
        error('Ghostscript not found. Have you installed it (http://pages.uoregon.edu/koch)?');
    else
        error('Ghostscript not found. Have you installed it from www.ghostscript.com?');
    end
end

function good = check_store_gs_path(path_)
    % Check the path is valid
    good = check_gs_path(path_);
    if ~good
        return
    end
    % Update the current default path to the path found
    if ~user_string('ghostscript', path_)
        filename = fullfile(fileparts(which('user_string.m')), '.ignore', 'ghostscript.txt');
        warning('Path to ghostscript installation could not be saved in %s (perhaps a permissions issue). You can manually create this file and set its contents to %s, to improve performance in future invocations (this warning is safe to ignore).', filename, path_);
        return
    end
end

function good = check_gs_path(path_)
    persistent isOk
    if isempty(path_)
        isOk = false;
    elseif ~isequal(isOk,true)
        % Check whether the path is valid
        [status, message] = system([gs_command(path_) '-h']); %#ok<ASGLU>
        isOk = status == 0;
    end
    good = isOk;
end

function cmd = gs_command(path_)
    % Initialize any required system calls before calling ghostscript
    % TODO: in Unix/Mac, find a way to determine whether to use "export" (bash) or "setenv" (csh/tcsh)
    shell_cmd = '';
    if isunix
        shell_cmd = 'export LD_LIBRARY_PATH=""; '; % Avoids an error on Linux with GS 9.07
    end
    if ismac
        shell_cmd = 'export DYLD_LIBRARY_PATH=""; ';  % Avoids an error on Mac with GS 9.07
    end
    % Construct the command string
    cmd = sprintf('%s"%s" ', shell_cmd, path_);
end

%IM2GIF Convert a multiframe image to an animated GIF file
%
% Examples:
%   im2gif infile
%   im2gif infile outfile
%   im2gif(A, outfile)
%   im2gif(..., '-nocrop')
%   im2gif(..., '-nodither')
%   im2gif(..., '-ncolors', n)
%   im2gif(..., '-loops', n)
%   im2gif(..., '-delay', n) 
%   
% This function converts a multiframe image to an animated GIF.
%
% To create an animation from a series of figures, export to a multiframe
% TIFF file using export_fig, then convert to a GIF, as follows:
%
%    for a = 2 .^ (3:6)
%       peaks(a);
%       export_fig test.tif -nocrop -append
%    end
%    im2gif('test.tif', '-delay', 0.5);
%
%IN:
%   infile - string containing the name of the input image.
%   outfile - string containing the name of the output image (must have the
%             .gif extension). Default: infile, with .gif extension.
%   A - HxWxCxN array of input images, stacked along fourth dimension, to
%       be converted to gif.
%   -nocrop - option indicating that the borders of the output are not to
%             be cropped.
%   -nodither - option indicating that dithering is not to be used when
%               converting the image.
%   -ncolors - option pair, the value of which indicates the maximum number
%              of colors the GIF can have. This can also be a quantization
%              tolerance, between 0 and 1. Default/maximum: 256.
%   -loops - option pair, the value of which gives the number of times the
%            animation is to be looped. Default: 65535.
%   -delay - option pair, the value of which gives the time, in seconds,
%            between frames. Default: 1/15.

% Copyright (C) Oliver Woodford 2011

%{
% 14/02/18: Merged issue #235: reduced memory usage, improved performance (thanks to @numb7rs)
%}

function im2gif(A, varargin)

% Parse the input arguments
[A, options] = parse_args_im2gif(A, varargin{:});

if options.crop ~= 0
    % Crop
    A = crop_borders(A, A(ceil(end/2),1,:,1));
end

% Convert to indexed image
[h, w, c, n] = size(A);

% Issue #235: Using unique(A,'rows') on the whole image stack at once causes
% massive memory usage when dealing with large images (at least on Matlab 2017b).
% Running unique(...) on individual frames, then again on the results drastically
% reduces the memory usage & slightly improves the execution time (@numb7rs).
uns = cell(1,size(A,4));
for nn=1:size(A,4)
    uns{nn}=unique(reshape(A(:,:,:,nn), h*w, c),'rows');
end
map=unique(cell2mat(uns'),'rows');

A = reshape(permute(A, [1 2 4 3]), h, w*n, c);

if size(map, 1) > 256
    dither_str = {'dither', 'nodither'};
    dither_str = dither_str{1+(options.dither==0)};
    if options.ncolors <= 1
        [B, map] = rgb2ind(A, options.ncolors, dither_str);
        if size(map, 1) > 256
            [B, map] = rgb2ind(A, 256, dither_str);
        end
    else
        [B, map] = rgb2ind(A, min(round(options.ncolors), 256), dither_str);
    end
else
    if max(map(:)) > 1
        map = double(map) / 255;
        A = double(A) / 255;
    end
    B = rgb2ind(im2double(A), map);
end
B = reshape(B, h, w, 1, n);

% Bug fix to rgb2ind
map(B(1)+1,:) = im2double(A(1,1,:));

% Save as a gif
imwrite(B, map, options.outfile, 'LoopCount', round(options.loops(1)), 'DelayTime', options.delay);
end

%% Parse the input arguments
function [A, options] = parse_args_im2gif(A, varargin)
% Set the defaults
options = struct('outfile', '', ...
                 'dither', true, ...
                 'crop', true, ...
                 'ncolors', 256, ...
                 'loops', 65535, ...
                 'delay', 1/15);

% Go through the arguments
a = 0;
n = numel(varargin);
while a < n
    a = a + 1;
    if ischar(varargin{a}) && ~isempty(varargin{a})
        if varargin{a}(1) == '-'
            opt = lower(varargin{a}(2:end));
            switch opt
                case 'nocrop'
                    options.crop = false;
                case 'nodither'
                    options.dither = false;
                otherwise
                    if ~isfield(options, opt)
                        error('Option %s not recognized', varargin{a});
                    end
                    a = a + 1;
                    if ischar(varargin{a}) && ~ischar(options.(opt))
                        options.(opt) = str2double(varargin{a});
                    else
                        options.(opt) = varargin{a};
                    end
            end
        else
            options.outfile = varargin{a};
        end
    end
end

if isempty(options.outfile)
    if ~ischar(A)
        error('No output filename given.');
    end
    % Generate the output filename from the input filename
    [path, outfile] = fileparts(A);
    options.outfile = fullfile(path, [outfile '.gif']);
end

if ischar(A)
    % Read in the image
    A = imread_rgb(A);
end
end

%% Read image to uint8 rgb array
function [A, alpha] = imread_rgb(name)
% Get file info
info = imfinfo(name);
% Special case formats
switch lower(info(1).Format)
    case 'gif'
        [A, map] = imread(name, 'frames', 'all');
        if ~isempty(map)
            map = uint8(map * 256 - 0.5); % Convert to uint8 for storage
            A = reshape(map(uint32(A)+1,:), [size(A) size(map, 2)]); % Assume indexed from 0
            A = permute(A, [1 2 5 4 3]);
        end
    case {'tif', 'tiff'}
        A = cell(numel(info), 1);
        for a = 1:numel(A)
            [A{a}, map] = imread(name, 'Index', a, 'Info', info);
            if ~isempty(map)
                map = uint8(map * 256 - 0.5); % Convert to uint8 for storage
                A{a} = reshape(map(uint32(A{a})+1,:), [size(A) size(map, 2)]); % Assume indexed from 0
            end
            if size(A{a}, 3) == 4
                % TIFF in CMYK colourspace - convert to RGB
                if isfloat(A{a})
                    A{a} = A{a} * 255;
                else
                    A{a} = single(A{a});
                end
                A{a} = 255 - A{a};
                A{a}(:,:,4) = A{a}(:,:,4) / 255;
                A{a} = uint8(A(:,:,1:3) .* A{a}(:,:,[4 4 4]));
            end
        end
        A = cat(4, A{:});
    otherwise
        [A, map, alpha] = imread(name);
        A = A(:,:,:,1); % Keep only first frame of multi-frame files
        if ~isempty(map)
            map = uint8(map * 256 - 0.5); % Convert to uint8 for storage
            A = reshape(map(uint32(A)+1,:), [size(A) size(map, 2)]); % Assume indexed from 0
        elseif size(A, 3) == 4
            % Assume 4th channel is an alpha matte
            alpha = A(:,:,4);
            A = A(:,:,1:3);
        end
end
end

function fh = isolate_axes(ah, vis)
%ISOLATE_AXES Isolate the specified axes in a figure on their own
%
% Examples:
%   fh = isolate_axes(ah)
%   fh = isolate_axes(ah, vis)
%
% This function will create a new figure containing the axes/uipanels
% specified, and also their associated legends and colorbars. The objects
% specified must all be in the same figure, but they will generally only be
% a subset of the objects in the figure.
%
% IN:
%    ah - An array of axes and uipanel handles, which must come from the
%         same figure.
%    vis - A boolean indicating whether the new figure should be visible.
%          Default: false.
%
% OUT:
%    fh - The handle of the created figure.

% Copyright (C) Oliver Woodford 2011-2013

% Thank you to Rosella Blatt for reporting a bug to do with axes in GUIs
% 16/03/12: Moved copyfig to its own function. Thanks to Bob Fratantonio
%           for pointing out that the function is also used in export_fig.m
% 12/12/12: Add support for isolating uipanels. Thanks to michael for suggesting it
% 08/10/13: Bug fix to allchildren suggested by Will Grant (many thanks!)
% 05/12/13: Bug fix to axes having different units. Thanks to Remington Reid for reporting
% 21/04/15: Bug fix for exporting uipanels with legend/colorbar on HG1 (reported by Alvaro
%           on FEX page as a comment on 24-Apr-2014); standardized indentation & help section
% 22/04/15: Bug fix: legends and colorbars were not exported when exporting axes handle in HG2

    % Make sure we have an array of handles
    if ~all(ishandle(ah))
        error('ah must be an array of handles');
    end
    % Check that the handles are all for axes or uipanels, and are all in the same figure
    fh = ancestor(ah(1), 'figure');
    nAx = numel(ah);
    for a = 1:nAx
        if ~ismember(get(ah(a), 'Type'), {'axes', 'uipanel'})
            error('All handles must be axes or uipanel handles.');
        end
        if ~isequal(ancestor(ah(a), 'figure'), fh)
            error('Axes must all come from the same figure.');
        end
    end
    % Tag the objects so we can find them in the copy
    old_tag = get(ah, 'Tag');
    if nAx == 1
        old_tag = {old_tag};
    end
    set(ah, 'Tag', 'ObjectToCopy');
    % Create a new figure exactly the same as the old one
    fh = copyfig(fh); %copyobj(fh, 0);
    if nargin < 2 || ~vis
        set(fh, 'Visible', 'off');
    end
    % Reset the object tags
    for a = 1:nAx
        set(ah(a), 'Tag', old_tag{a});
    end
    % Find the objects to save
    ah = findall(fh, 'Tag', 'ObjectToCopy');
    if numel(ah) ~= nAx
        close(fh);
        error('Incorrect number of objects found.');
    end
    % Set the axes tags to what they should be
    for a = 1:nAx
        set(ah(a), 'Tag', old_tag{a});
    end
    % Keep any legends and colorbars which overlap the subplots
    % Note: in HG1 these are axes objects; in HG2 they are separate objects, therefore we
    %       don't test for the type, only the tag (hopefully nobody but Matlab uses them!)
    lh = findall(fh, 'Tag', 'legend', '-or', 'Tag', 'Colorbar');
    nLeg = numel(lh);
    if nLeg > 0
        set([ah(:); lh(:)], 'Units', 'normalized');
        try
            ax_pos = get(ah, 'OuterPosition'); % axes and figures have the OuterPosition property
        catch
            ax_pos = get(ah, 'Position'); % uipanels only have Position, not OuterPosition
        end
        if nAx > 1
            ax_pos = cell2mat(ax_pos(:));
        end
        ax_pos(:,3:4) = ax_pos(:,3:4) + ax_pos(:,1:2);
        try
            leg_pos = get(lh, 'OuterPosition');
        catch
            leg_pos = get(lh, 'Position');  % No OuterPosition in HG2, only in HG1
        end
        if nLeg > 1;
            leg_pos = cell2mat(leg_pos);
        end
        leg_pos(:,3:4) = leg_pos(:,3:4) + leg_pos(:,1:2);
        ax_pos = shiftdim(ax_pos, -1);
        % Overlap test
        M = bsxfun(@lt, leg_pos(:,1), ax_pos(:,:,3)) & ...
            bsxfun(@lt, leg_pos(:,2), ax_pos(:,:,4)) & ...
            bsxfun(@gt, leg_pos(:,3), ax_pos(:,:,1)) & ...
            bsxfun(@gt, leg_pos(:,4), ax_pos(:,:,2));
        ah = [ah; lh(any(M, 2))];
    end
    % Get all the objects in the figure
    axs = findall(fh);
    % Delete everything except for the input objects and associated items
    delete(axs(~ismember(axs, [ah; allchildren(ah); allancestors(ah)])));
end

function ah = allchildren(ah)
    ah = findall(ah);
    if iscell(ah)
        ah = cell2mat(ah);
    end
    ah = ah(:);
end

function ph = allancestors(ah)
    ph = [];
    for a = 1:numel(ah)
        h = get(ah(a), 'parent');
        while h ~= 0
            ph = [ph; h];
            h = get(h, 'parent');
        end
    end
end

%PDF2EPS  Convert a pdf file to eps format using pdftops
%
% Examples:
%   pdf2eps source dest
%
% This function converts a pdf file to eps format.
%
% This function requires that you have pdftops, from the Xpdf suite of
% functions, installed on your system. This can be downloaded from:
% http://xpdfreader.com
%
% Inputs:
%   source - filename of the source pdf file to convert. The filename is
%            assumed to already have the extension ".pdf".
%   dest - filename of the destination eps file. The filename is assumed to
%          already have the extension ".eps".

% Copyright (C) Oliver Woodford 2009-2010, Yair Altman 2015-

% Thanks to Aldebaro Klautau for reporting a bug when saving to
% non-existant directories.

% 22/09/2018 - Xpdf website changed to xpdfreader.com

function pdf2eps(source, dest)
    % Construct the options string for pdftops
    options = ['-q -paper match -eps -level2 "' source '" "' dest '"'];

    % Convert to eps using pdftops
    [status, message] = pdftops(options);

    % Check for error
    if status
        % Report error
        if isempty(message)
            error('Unable to generate eps. Check destination directory is writable.');
        else
            error(message);
        end
    end

    % Fix the DSC error created by pdftops
    fid = fopen(dest, 'r+');
    if fid == -1
        % Cannot open the file
        return
    end
    fgetl(fid); % Get the first line
    str = fgetl(fid); % Get the second line
    if strcmp(str(1:min(13, end)), '% Produced by')
        fseek(fid, -numel(str)-1, 'cof');
        fwrite(fid, '%'); % Turn ' ' into '%'
    end
    fclose(fid);
end

function varargout = pdftops(cmd)
%PDFTOPS  Calls a local pdftops executable with the input command
%
% Example:
%   [status result] = pdftops(cmd)
%
% Attempts to locate a pdftops executable, finally asking the user to
% specify the directory pdftops was installed into. The resulting path is
% stored for future reference.
% 
% Once found, the executable is called with the input command string.
%
% This function requires that you have pdftops (from the Xpdf package)
% installed on your system. You can download this from: http://xpdfreader.com
%
% IN:
%   cmd - Command string to be passed into pdftops (e.g. '-help').
%
% OUT:
%   status - 0 iff command ran without problem.
%   result - Output from pdftops.

% Copyright: Oliver Woodford, 2009-2010

% Thanks to Jonas Dorn for the fix for the title of the uigetdir window on Mac OS.
% Thanks to Christoph Hertel for pointing out a bug in check_xpdf_path under linux.
% 23/01/2014 - Add full path to pdftops.txt in warning.
% 27/05/2015 - Fixed alert in case of missing pdftops; fixed code indentation
% 02/05/2016 - Added possible error explanation suggested by Michael Pacer (issue #137)
% 02/05/2016 - Search additional possible paths suggested by Jonas Stein (issue #147)
% 03/05/2016 - Display the specific error message if pdftops fails for some reason (issue #148)
% 22/09/2018 - Xpdf website changed to xpdfreader.com; improved popup logic

    % Call pdftops
    [varargout{1:nargout}] = system([xpdf_command(xpdf_path()) cmd]);
end

function path_ = xpdf_path
    % Return a valid path
    % Start with the currently set path
    path_ = user_string('pdftops');
    % Check the path works
    if check_xpdf_path(path_)
        return
    end
    % Check whether the binary is on the path
    if ispc
        bin = 'pdftops.exe';
    else
        bin = 'pdftops';
    end
    if check_store_xpdf_path(bin)
        path_ = bin;
        return
    end
    % Search the obvious places
    if ispc
        paths = {'C:\Program Files\xpdf\pdftops.exe', 'C:\Program Files (x86)\xpdf\pdftops.exe'};
    else
        paths = {'/usr/bin/pdftops', '/usr/local/bin/pdftops'};
    end
    for a = 1:numel(paths)
        path_ = paths{a};
        if check_store_xpdf_path(path_)
            return
        end
    end

    % Ask the user to enter the path
    errMsg1 = 'Pdftops not found. Please locate the program, or install xpdf-tools from ';
    url1 = 'http://xpdfreader.com/download.html'; %='http://foolabs.com/xpdf';
    fprintf(2, '%s\n', [errMsg1 '<a href="matlab:web(''-browser'',''' url1 ''');">' url1 '</a>']);
    errMsg1 = [errMsg1 url1];
    %if strncmp(computer,'MAC',3) % Is a Mac
    %    % Give separate warning as the MacOS uigetdir dialogue box doesn't have a title
    %    uiwait(warndlg(errMsg1))
    %end

    % Provide an alternative possible explanation as per issue #137
    errMsg2 = 'If you have pdftops installed, perhaps Matlab is shaddowing it as described in ';
    url2 = 'https://github.com/altmany/export_fig/issues/137';
    fprintf(2, '%s\n', [errMsg2 '<a href="matlab:web(''-browser'',''' url2 ''');">issue #137</a>']);
    errMsg2 = [errMsg2 url1];

    state = 1;
    while 1
        if state
            option1 = 'Install pdftops';
        else
            option1 = 'Issue #137';
        end
        answer = questdlg({errMsg1,'',errMsg2},'Pdftops error',option1,'Locate pdftops','Cancel','Cancel');
        drawnow;  % prevent a Matlab hang: http://undocumentedmatlab.com/blog/solving-a-matlab-hang-problem
        switch answer
            case 'Install pdftops'
                web('-browser',url1);
                state = 0;
            case 'Issue #137'
                web('-browser',url2);
                state = 1;
            case 'Locate pdftops'
                base = uigetdir('/', errMsg1);
                if isequal(base, 0)
                    % User hit cancel or closed window
                    break
                end
                base = [base filesep]; %#ok<AGROW>
                bin_dir = {'', ['bin' filesep], ['lib' filesep]};
                for a = 1:numel(bin_dir)
                    path_ = [base bin_dir{a} bin];
                    if exist(path_, 'file') == 2
                        break
                    end
                end
                if check_store_xpdf_path(path_)
                    return
                end

            otherwise  % User hit Cancel or closed window
                break
        end
    end
    error('pdftops executable not found.');
end

function good = check_store_xpdf_path(path_)
    % Check the path is valid
    good = check_xpdf_path(path_);
    if ~good
        return
    end
    % Update the current default path to the path found
    if ~user_string('pdftops', path_)
        warning('Path to pdftops executable could not be saved. Enter it manually in %s.', fullfile(fileparts(which('user_string.m')), '.ignore', 'pdftops.txt'));
        return
    end
end

function good = check_xpdf_path(path_)
    % Check the path is valid
    [good, message] = system([xpdf_command(path_) '-h']); %#ok<ASGLU>
    % system returns good = 1 even when the command runs
    % Look for something distinct in the help text
    good = ~isempty(strfind(message, 'PostScript')); %#ok<STREMP>

    % Display the error message if the pdftops executable exists but fails for some reason
    if ~good && exist(path_,'file')  % file exists but generates an error
        fprintf('Error running %s:\n', path_);
        fprintf(2,'%s\n\n',message);
    end
end

function cmd = xpdf_command(path_)
    % Initialize any required system calls before calling ghostscript
    % TODO: in Unix/Mac, find a way to determine whether to use "export" (bash) or "setenv" (csh/tcsh)
    shell_cmd = '';
    if isunix
        % Avoids an error on Linux with outdated MATLAB lib files
        % R20XXa/bin/glnxa64/libtiff.so.X
        % R20XXa/sys/os/glnxa64/libstdc++.so.X
        shell_cmd = 'export LD_LIBRARY_PATH=""; ';
    end
    if ismac
        shell_cmd = 'export DYLD_LIBRARY_PATH=""; ';
    end
    % Construct the command string
    cmd = sprintf('%s"%s" ', shell_cmd, path_);
end

function [A, bcol] = print2array(fig, res, renderer, gs_options)
%PRINT2ARRAY  Exports a figure to an image array
%
% Examples:
%   A = print2array
%   A = print2array(figure_handle)
%   A = print2array(figure_handle, resolution)
%   A = print2array(figure_handle, resolution, renderer)
%   A = print2array(figure_handle, resolution, renderer, gs_options)
%   [A bcol] = print2array(...)
%
% This function outputs a bitmap image of the given figure, at the desired
% resolution.
%
% If renderer is '-painters' then ghostcript needs to be installed. This
% can be downloaded from: http://www.ghostscript.com
%
% IN:
%   figure_handle - The handle of the figure to be exported. Default: gcf.
%   resolution - Resolution of the output, as a factor of screen
%                resolution. Default: 1.
%   renderer - string containing the renderer paramater to be passed to
%              print. Default: '-opengl'.
%   gs_options - optional ghostscript options (e.g.: '-dNoOutputFonts'). If
%                multiple options are needed, enclose in call array: {'-a','-b'}
%
% OUT:
%   A - MxNx3 uint8 image of the figure.
%   bcol - 1x3 uint8 vector of the background color

% Copyright (C) Oliver Woodford 2008-2014, Yair Altman 2015-
%{
% 05/09/11: Set EraseModes to normal when using opengl or zbuffer
%           renderers. Thanks to Pawel Kocieniewski for reporting the issue.
% 21/09/11: Bug fix: unit8 -> uint8! Thanks to Tobias Lamour for reporting it.
% 14/11/11: Bug fix: stop using hardcopy(), as it interfered with figure size
%           and erasemode settings. Makes it a bit slower, but more reliable.
%           Thanks to Phil Trinh and Meelis Lootus for reporting the issues.
% 09/12/11: Pass font path to ghostscript.
% 27/01/12: Bug fix affecting painters rendering tall figures. Thanks to
%           Ken Campbell for reporting it.
% 03/04/12: Bug fix to median input. Thanks to Andy Matthews for reporting it.
% 26/10/12: Set PaperOrientation to portrait. Thanks to Michael Watts for
%           reporting the issue.
% 26/02/15: If temp dir is not writable, use the current folder for temp
%           EPS/TIF files (Javier Paredes)
% 27/02/15: Display suggested workarounds to internal print() error (issue #16)
% 28/02/15: Enable users to specify optional ghostscript options (issue #36)
% 10/03/15: Fixed minor warning reported by Paul Soderlind; fixed code indentation
% 28/05/15: Fixed issue #69: patches with LineWidth==0.75 appear wide (internal bug in Matlab's print() func)
% 07/07/15: Fixed issue #83: use numeric handles in HG1
% 11/12/16: Fixed cropping issue reported by Harry D.
% 29/09/18: Fixed issue #254: error in print2array>read_tif_img
%}

    % Generate default input arguments, if needed
    if nargin < 2
        res = 1;
        if nargin < 1
            fig = gcf;
        end
    end
    % Warn if output is large
    old_mode = get(fig, 'Units');
    set(fig, 'Units', 'pixels');
    px = get(fig, 'Position');
    set(fig, 'Units', old_mode);
    npx = prod(px(3:4)*res)/1e6;
    if npx > 30
        % 30M pixels or larger!
        warning('MATLAB:LargeImage', 'print2array generating a %.1fM pixel image. This could be slow and might also cause memory problems.', npx);
    end
    % Retrieve the background colour
    bcol = get(fig, 'Color');
    % Set the resolution parameter
    res_str = ['-r' num2str(ceil(get(0, 'ScreenPixelsPerInch')*res))];
    % Generate temporary file name
    tmp_nam = [tempname '.tif'];
    try
        % Ensure that the temp dir is writable (Javier Paredes 26/2/15)
        fid = fopen(tmp_nam,'w');
        fwrite(fid,1);
        fclose(fid);
        delete(tmp_nam);  % cleanup
        isTempDirOk = true;
    catch
        % Temp dir is not writable, so use the current folder
        [dummy,fname,fext] = fileparts(tmp_nam); %#ok<ASGLU>
        fpath = pwd;
        tmp_nam = fullfile(fpath,[fname fext]);
        isTempDirOk = false;
    end
    % Enable users to specify optional ghostscript options (issue #36)
    if nargin > 3 && ~isempty(gs_options)
        if iscell(gs_options)
            gs_options = sprintf(' %s',gs_options{:});
        elseif ~ischar(gs_options)
            error('gs_options input argument must be a string or cell-array of strings');
        else
            gs_options = [' ' gs_options];
        end
    else
        gs_options = '';
    end
    if nargin > 2 && strcmp(renderer, '-painters')
        % First try to print directly to tif file
        try
            % Print the file into a temporary TIF file and read it into array A
            [A, err, ex] = read_tif_img(fig, res_str, renderer, tmp_nam);
            if err, rethrow(ex); end
        catch  % error - try to print to EPS and then using Ghostscript to TIF
            % Print to eps file
            if isTempDirOk
                tmp_eps = [tempname '.eps'];
            else
                tmp_eps = fullfile(fpath,[fname '.eps']);
            end
            print2eps(tmp_eps, fig, 0, renderer, '-loose');
            try
                % Initialize the command to export to tiff using ghostscript
                cmd_str = ['-dEPSCrop -q -dNOPAUSE -dBATCH ' res_str ' -sDEVICE=tiff24nc'];
                % Set the font path
                fp = font_path_print2array();
                if ~isempty(fp)
                    cmd_str = [cmd_str ' -sFONTPATH="' fp '"'];
                end
                % Add the filenames
                cmd_str = [cmd_str ' -sOutputFile="' tmp_nam '" "' tmp_eps '"' gs_options];
                % Execute the ghostscript command
                ghostscript(cmd_str);
            catch me
                % Delete the intermediate file
                delete(tmp_eps);
                rethrow(me);
            end
            % Delete the intermediate file
            delete(tmp_eps);
            % Read in the generated bitmap
            A = imread(tmp_nam);
            % Delete the temporary bitmap file
            delete(tmp_nam);
        end
        % Set border pixels to the correct colour
        if isequal(bcol, 'none')
            bcol = [];
        elseif isequal(bcol, [1 1 1])
            bcol = uint8([255 255 255]);
        else
            for l = 1:size(A, 2)
                if ~all(reshape(A(:,l,:) == 255, [], 1))
                    break;
                end
            end
            for r = size(A, 2):-1:l
                if ~all(reshape(A(:,r,:) == 255, [], 1))
                    break;
                end
            end
            for t = 1:size(A, 1)
                if ~all(reshape(A(t,:,:) == 255, [], 1))
                    break;
                end
            end
            for b = size(A, 1):-1:t
                if ~all(reshape(A(b,:,:) == 255, [], 1))
                    break;
                end
            end
            bcol = uint8(median(single([reshape(A(:,[l r],:), [], size(A, 3)); reshape(A([t b],:,:), [], size(A, 3))]), 1));
            for c = 1:size(A, 3)
                A(:,[1:l-1, r+1:end],c) = bcol(c);
                A([1:t-1, b+1:end],:,c) = bcol(c);
            end
        end
    else
        if nargin < 3
            renderer = '-opengl';
        end
        % Print the file into a temporary TIF file and read it into array A
        [A, err, ex] = read_tif_img(fig, res_str, renderer, tmp_nam);
        % Throw any error that occurred
        if err
            % Display suggested workarounds to internal print() error (issue #16)
            fprintf(2, 'An error occured with Matlab''s builtin print function.\nTry setting the figure Renderer to ''painters'' or use opengl(''software'').\n\n');
            rethrow(ex);
        end
        % Set the background color
        if isequal(bcol, 'none')
            bcol = [];
        else
            bcol = bcol * 255;
            if isequal(bcol, round(bcol))
                bcol = uint8(bcol);
            else
                bcol = squeeze(A(1,1,:));
            end
        end
    end
    % Check the output size is correct
    if isequal(res, round(res))
        px = round([px([4 3])*res 3]);  % round() to avoid an indexing warning below
        if ~isequal(size(A), px)
            % Correct the output size
            A = A(1:min(end,px(1)),1:min(end,px(2)),:);
        end
    end
end

% Function to create a TIF image of the figure and read it into an array
function [A, err, ex] = read_tif_img(fig, res_str, renderer, tmp_nam)
    A =  [];  % fix for issue #254
    err = false;
    ex = [];
    % Temporarily set the paper size
    old_pos_mode    = get(fig, 'PaperPositionMode');
    old_orientation = get(fig, 'PaperOrientation');
    set(fig, 'PaperPositionMode','auto', 'PaperOrientation','portrait');
    try
        % Workaround for issue #69: patches with LineWidth==0.75 appear wide (internal bug in Matlab's print() function)
        fp = [];  % in case we get an error below
        fp = findall(fig, 'Type','patch', 'LineWidth',0.75);
        set(fp, 'LineWidth',0.5);
        % Fix issue #83: use numeric handles in HG1
        if ~using_hg2(fig),  fig = double(fig);  end
        % Print to tiff file
        print(fig, renderer, res_str, '-dtiff', tmp_nam);
        % Read in the printed file
        A = imread(tmp_nam);
        % Delete the temporary file
        delete(tmp_nam);
    catch ex
        err = true;
    end
    set(fp, 'LineWidth',0.75);  % restore original figure appearance
    % Reset the paper size
    set(fig, 'PaperPositionMode',old_pos_mode, 'PaperOrientation',old_orientation);
end

% Function to return (and create, where necessary) the font path
function fp = font_path_print2array()
    fp = user_string('gs_font_path');
    if ~isempty(fp)
        return
    end
    % Create the path
    % Start with the default path
    fp = getenv('GS_FONTPATH');
    % Add on the typical directories for a given OS
    if ispc
        if ~isempty(fp)
            fp = [fp ';'];
        end
        fp = [fp getenv('WINDIR') filesep 'Fonts'];
    else
        if ~isempty(fp)
            fp = [fp ':'];
        end
        fp = [fp '/usr/share/fonts:/usr/local/share/fonts:/usr/share/fonts/X11:/usr/local/share/fonts/X11:/usr/share/fonts/truetype:/usr/local/share/fonts/truetype'];
    end
    user_string('gs_font_path', fp);
end

function print2eps(name, fig, export_options, varargin)
%PRINT2EPS  Prints figures to eps with improved line styles
%
% Examples:
%   print2eps filename
%   print2eps(filename, fig_handle)
%   print2eps(filename, fig_handle, export_options)
%   print2eps(filename, fig_handle, export_options, print_options)
%
% This function saves a figure as an eps file, with two improvements over
% MATLAB's print command. First, it improves the line style, making dashed
% lines more like those on screen and giving grid lines a dotted line style.
% Secondly, it substitutes original font names back into the eps file,
% where these have been changed by MATLAB, for up to 11 different fonts.
%
%IN:
%   filename - string containing the name (optionally including full or
%              relative path) of the file the figure is to be saved as. A
%              ".eps" extension is added if not there already. If a path is
%              not specified, the figure is saved in the current directory.
%   fig_handle - The handle of the figure to be saved. Default: gcf().
%   export_options - array or struct of optional scalar values:
%       bb_padding - Scalar value of amount of padding to add to border around
%                    the cropped image, in points (if >1) or percent (if <1).
%                    Can be negative as well as positive; Default: 0
%       crop       - Cropping flag. Deafult: 0
%       fontswap   - Whether to swap non-default fonts in figure. Default: true
%       font_space - Character used to separate font-name terms in the EPS output
%                    e.g. "Courier New" => "Courier-New". Default: ''
%                    (available only via the struct alternative)
%       renderer   - Renderer used to generate bounding-box. Default: 'opengl'
%                    (available only via the struct alternative)
%       crop_amounts - 4-element vector of crop amounts: [top,right,bottom,left]
%                    (available only via the struct alternative)
%   print_options - Additional parameter strings to be passed to the print command

%{
% Copyright (C) Oliver Woodford 2008-2014, Yair Altman 2015-

% The idea of editing the EPS file to change line styles comes from Jiro
% Doke's FIXPSLINESTYLE (fex id: 17928)
% The idea of changing dash length with line width came from comments on
% fex id: 5743, but the implementation is mine :)
%}
%{
% 14/11/11: Fix a MATLAB bug rendering black or white text incorrectly.
%           Thanks to Mathieu Morlighem for reporting the issue and
%           obtaining a fix from TMW.
% 08/12/11: Added ability to correct fonts. Several people have requested
%           this at one time or another, and also pointed me to printeps
%           (fex id: 7501), so thank you to them. My implementation (which
%           was not inspired by printeps - I'd already had the idea for my
%           approach) goes slightly further in that it allows multiple
%           fonts to be swapped.
% 14/12/11: Fix bug affecting font names containing spaces. Thanks to David
%           Szwer for reporting the issue.
% 25/01/12: Add a font not to be swapped. Thanks to Anna Rafferty and Adam
%           Jackson for reporting the issue. Also fix a bug whereby using a
%           font alias can lead to another font being swapped in.
% 10/04/12: Make the font swapping case insensitive.
% 26/10/12: Set PaperOrientation to portrait. Thanks to Michael Watts for
%           reporting the issue.
% 26/10/12: Fix issue to do with swapping fonts changing other fonts and
%           sizes we don't want, due to listeners. Thanks to Malcolm Hudson
%           for reporting the issue.
% 22/03/13: Extend font swapping to axes labels. Thanks to Rasmus Ischebeck
%           for reporting the issue.
% 23/07/13: Bug fix to font swapping. Thanks to George for reporting the
%           issue.
% 13/08/13: Fix MATLAB feature of not exporting white lines correctly.
%           Thanks to Sebastian Hesslinger for reporting it.
% 24/02/15: Fix for Matlab R2014b bug (issue #31): LineWidths<0.75 are not
%           set in the EPS (default line width is used)
% 25/02/15: Fixed issue #32: BoundingBox problem caused uncropped EPS/PDF files
% 05/03/15: Fixed issue #43: Inability to perform EPS file post-processing
% 06/03/15: Improved image padding & cropping thanks to Oscar Hartogensis
% 21/03/15: Fixed edge-case of missing handles having a 'FontName' property
% 26/03/15: Attempt to fix issue #45: white lines in subplots do not print correctly
% 27/03/15: Attempt to fix issue #44: white artifact lines appearing in patch exports
% 30/03/15: Fixed issue #52: improved performance on HG2 (R2014b+)
% 09/04/15: Comment blocks consolidation and minor code cleanup (no real code change)
% 12/04/15: Fixed issue #56: bad cropping
% 14/04/15: Workaround for issue #45: lines in image subplots are exported in invalid color
% 07/07/15: Added option to avoid font-swapping in EPS/PDF
% 07/07/15: Fixed issue #83: use numeric handles in HG1
% 22/07/15: Fixed issue #91 (thanks to Carlos Moffat)
% 28/09/15: Fixed issue #108 (thanks to JacobD10)
% 01/11/15: Fixed issue #112: optional renderer for bounding-box computation (thanks to Jes?estana Puerta)
% 21/02/16: Enabled specifying non-automated crop amounts
% 22/02/16: Better support + backward compatibility for transparency (issue #108)
% 10/06/16: Fixed issue #159: text handles get cleared by Matlab in the print() command
% 12/06/16: Improved the fix for issue #159 (in the previous commit)
% 12/06/16: Fixed issue #158: transparent patch color in PDF/EPS
% 18/09/17: Fixed issue #194: incorrect fonts in EPS/PDF output
% 18/09/17: Fixed issue #195: relaxed too-tight cropping in EPS/PDF
% 14/11/17: Workaround for issue #211: dashed/dotted lines in 3D axes appear solid
% 15/11/17: Updated issue #211: only set SortMethod='ChildOrder' in HG2, and when it looks the same onscreen; support multiple figure axes
% 18/11/17: Fixed issue #225: transparent/translucent dashed/dotted lines appear solid in EPS/PDF
% 24/03/18: Fixed issue #239: black title meshes with temporary black background figure bgcolor, causing bad cropping
%}

    options = {'-loose'};
    if nargin > 3
        options = [options varargin];
    elseif nargin < 3
        export_options = 0;
        if nargin < 2
            fig = gcf();
        end
    end

    % Retrieve padding, crop & font-swap values
    crop_amounts = nan(1,4);  % auto-crop all 4 sides by default
    if isstruct(export_options)
        try fontswap     = export_options.fontswap;     catch, fontswap = true;     end
        try font_space   = export_options.font_space;   catch, font_space = '';     end
        font_space(2:end) = '';
        try bb_crop      = export_options.crop;         catch, bb_crop = 0;         end
        try crop_amounts = export_options.crop_amounts; catch,                      end
        try bb_padding   = export_options.bb_padding;   catch, bb_padding = 0;      end
        try renderer     = export_options.rendererStr;  catch, renderer = 'opengl'; end  % fix for issue #110
        if renderer(1)~='-',  renderer = ['-' renderer];  end
    else
        if numel(export_options) > 2  % font-swapping
            fontswap = export_options(3);
        else
            fontswap = true;
        end
        if numel(export_options) > 1  % cropping
            bb_crop = export_options(2);
        else
            bb_crop = 0;  % scalar value, so use default bb_crop value of 0
        end
        if numel(export_options) > 0  % padding
            bb_padding = export_options(1);
        else
            bb_padding = 0;
        end
        renderer = '-opengl';
        font_space = '';
    end

    % Construct the filename
    if numel(name) < 5 || ~strcmpi(name(end-3:end), '.eps')
        name = [name '.eps']; % Add the missing extension
    end

    % Set paper size
    old_pos_mode = get(fig, 'PaperPositionMode');
    old_orientation = get(fig, 'PaperOrientation');
    set(fig, 'PaperPositionMode', 'auto', 'PaperOrientation', 'portrait');

    % Find all the used fonts in the figure
    font_handles = findall(fig, '-property', 'FontName');
    fonts = get(font_handles, 'FontName');
    if isempty(fonts)
        fonts = {};
    elseif ~iscell(fonts)
        fonts = {fonts};
    end

    % Map supported font aliases onto the correct name
    fontsl = lower(fonts);
    for a = 1:numel(fonts)
        f = fontsl{a};
        f(f==' ') = [];
        switch f
            case {'times', 'timesnewroman', 'times-roman'}
                fontsl{a} = 'times-roman';
            case {'arial', 'helvetica'}
                fontsl{a} = 'helvetica';
            case {'newcenturyschoolbook', 'newcenturyschlbk'}
                fontsl{a} = 'newcenturyschlbk';
            otherwise
        end
    end
    fontslu = unique(fontsl);

    % Determine the font swap table
    if fontswap
        matlab_fonts = {'Helvetica', 'Times-Roman', 'Palatino', 'Bookman', 'Helvetica-Narrow', 'Symbol', ...
                        'AvantGarde', 'NewCenturySchlbk', 'Courier', 'ZapfChancery', 'ZapfDingbats'};
        matlab_fontsl = lower(matlab_fonts);
        require_swap = find(~ismember(fontslu, matlab_fontsl));
        unused_fonts = find(~ismember(matlab_fontsl, fontslu));
        font_swap = cell(3, min(numel(require_swap), numel(unused_fonts)));
        fonts_new = fonts;
        for a = 1:size(font_swap, 2)
            font_swap{1,a} = find(strcmp(fontslu{require_swap(a)}, fontsl));
            font_swap{2,a} = matlab_fonts{unused_fonts(a)};
            font_swap{3,a} = fonts{font_swap{1,a}(1)};
            fonts_new(font_swap{1,a}) = font_swap(2,a);
        end
    else
        font_swap = [];
    end

    % Swap the fonts
    if ~isempty(font_swap)
        fonts_size = get(font_handles, 'FontSize');
        if iscell(fonts_size)
            fonts_size = cell2mat(fonts_size);
        end
        M = false(size(font_handles));

        % Loop because some changes may not stick first time, due to listeners
        c = 0;
        update = zeros(1000, 1);
        for b = 1:10 % Limit number of loops to avoid infinite loop case
            for a = 1:numel(M)
                M(a) = ~isequal(get(font_handles(a), 'FontName'), fonts_new{a}) || ~isequal(get(font_handles(a), 'FontSize'), fonts_size(a));
                if M(a)
                    set(font_handles(a), 'FontName', fonts_new{a}, 'FontSize', fonts_size(a));
                    c = c + 1;
                    update(c) = a;
                end
            end
            if ~any(M)
                break;
            end
        end

        % Compute the order to revert fonts later, without the need of a loop
        [update, M] = unique(update(1:c));
        [dummy, M] = sort(M); %#ok<ASGLU>
        update = reshape(update(M), 1, []);
    end

    % MATLAB bug fix - black and white text can come out inverted sometimes
    % Find the white and black text
    black_text_handles = findall(fig, 'Type', 'text', 'Color', [0 0 0]);
    white_text_handles = findall(fig, 'Type', 'text', 'Color', [1 1 1]);
    % Set the font colors slightly off their correct values
    set(black_text_handles, 'Color', [0 0 0] + eps);
    set(white_text_handles, 'Color', [1 1 1] - eps);

    % MATLAB bug fix - white lines can come out funny sometimes
    % Find the white lines
    white_line_handles = findall(fig, 'Type', 'line', 'Color', [1 1 1]);
    % Set the line color slightly off white
    set(white_line_handles, 'Color', [1 1 1] - 0.00001);

    % MATLAB bug fix (issue #211): dashed/dotted lines in 3D axes appear solid
    % Note: this "may limit other functionality in plotting such as hidden line/surface removal"
    % reference: Technical Support Case #02838114, https://mail.google.com/mail/u/0/#inbox/15fb7659f70e7bd8
    hAxes = findall(fig, 'Type', 'axes');
    if using_hg2 && ~isempty(hAxes)  % issue #211 presumably happens only in HG2, not HG1
        try
            % If there are any axes using SortMethod~='ChildOrder'
            oldSortMethods = get(hAxes,{'SortMethod'});  % use {'SortMethod'} to ensure we get a cell array, even for single axes
            if any(~strcmpi('ChildOrder',oldSortMethods))  % i.e., any oldSortMethods=='depth'
                % Check if the axes look visually different onscreen when SortMethod='ChildOrder'
                imgBefore = print2array(fig);
                set(hAxes,'SortMethod','ChildOrder');
                imgAfter  = print2array(fig);
                if isequal(imgBefore, imgAfter)
                    % They look the same, so use SortMethod='ChildOrder' when generating the EPS
                else
                    % They look different, so revert SortMethod and issue a warning message
                    warning('YMA:export_fig:issue211', ...
                            ['You seem to be using axes that have overlapping/hidden graphic elements. ' 10 ...
                             'Setting axes.SortMethod=''ChildOrder'' may solve potential problems in EPS/PDF export. ' 10 ...
                             'Additional info: https://github.com/altmany/export_fig/issues/211'])
                    set(hAxes,{'SortMethod'},oldSortMethods);
                end
            end
        catch err
            % ignore
            a=err;  %#ok<NASGU> % debug breakpoint
        end
    end

    % Workaround for issue #45: lines in image subplots are exported in invalid color
    % In this case the -depsc driver solves the problem, but then all the other workarounds
    % below (for all the other issues) will fail, so it's better to let the user decide by
    % just issuing a warning and accepting the '-depsc' input parameter
    epsLevel2 = ~any(strcmpi(options,'-depsc'));
    if epsLevel2
        % Use -depsc2 (EPS color level-2) if -depsc (EPS color level-3) was not specifically requested
        options{end+1} = '-depsc2';
        % Issue a warning if multiple images & lines were found in the figure, and HG1 with painters renderer is used
        isPainters = any(strcmpi(options,'-painters'));
        if isPainters && ~using_hg2 && numel(findall(fig,'Type','image'))>1 && ~isempty(findall(fig,'Type','line'))
            warning('YMA:export_fig:issue45', ...
                    ['Multiple images & lines detected. In such cases, the lines might \n' ...
                     'appear with an invalid color due to an internal MATLAB bug (fixed in R2014b). \n' ...
                     'Possible workaround: add a ''-depsc'' or ''-opengl'' parameter to the export_fig command.']);
        end
    end

    % Fix issue #83: use numeric handles in HG1
    if ~using_hg2(fig),  fig = double(fig);  end

    % Workaround for when transparency is lost through conversion fig>EPS>PDF (issue #108)
    % Replace transparent patch RGB values with an ID value (rare chance that ID color is being used already)
    if using_hg2
        origAlphaColors = eps_maintainAlpha(fig);
    end

    % Print to eps file
    print(fig, options{:}, name);

    % Restore the original axes SortMethods (if updated)
    try set(hAxes,{'SortMethod'},oldSortMethods); catch, end

    % Do post-processing on the eps file
    try
        % Read the EPS file into memory
        fstrm = read_write_entire_textfile(name);
    catch
        fstrm = '';
    end

    % Restore colors for transparent patches/lines and apply the
    % setopacityalpha setting in the EPS file (issue #108)
    if using_hg2
        [~,fstrm,foundFlags] = eps_maintainAlpha(fig, fstrm, origAlphaColors);

        % If some of the transparencies were not found in the EPS file, then rerun the
        % export with only the found transparencies modified (backward compatibility)
        if ~isempty(fstrm) && ~all(foundFlags)
            foundIdx = find(foundFlags);
            for objIdx = 1 : sum(foundFlags)
                colorsIdx = foundIdx(objIdx);
                colorsData = origAlphaColors{colorsIdx};
                hObj     = colorsData{1};
                propName = colorsData{2};
                newColor = colorsData{4};
                hObj.(propName).ColorData = newColor;
            end
            delete(name);
            print(fig, options{:}, name);
            fstrm = read_write_entire_textfile(name);
            [~,fstrm] = eps_maintainAlpha(fig, fstrm, origAlphaColors(foundFlags));
        end
    end

    % Fix for Matlab R2014b bug (issue #31): LineWidths<0.75 are not set in the EPS (default line width is used)
    try
        if ~isempty(fstrm) && using_hg2(fig)
            % Convert miter joins to line joins
            %fstrm = regexprep(fstrm, '\n10.0 ML\n', '\n1 LJ\n');
            % This is faster (the original regexprep could take many seconds when the axes contains many lines):
            fstrm = strrep(fstrm, sprintf('\n10.0 ML\n'), sprintf('\n1 LJ\n'));

            % In HG2, grid lines and axes Ruler Axles have a default LineWidth of 0.5 => replace en-bulk (assume that 1.0 LineWidth = 1.333 LW)
            %   hAxes=gca; hAxes.YGridHandle.LineWidth, hAxes.YRuler.Axle.LineWidth
            %fstrm = regexprep(fstrm, '(GC\n2 setlinecap\n1 LJ)\nN', '$1\n0.667 LW\nN');
            % This is faster:
            fstrm = strrep(fstrm, sprintf('GC\n2 setlinecap\n1 LJ\nN'), sprintf('GC\n2 setlinecap\n1 LJ\n0.667 LW\nN'));

            % This is more accurate but *MUCH* slower (issue #52)
            %{
            % Modify all thin lines in the figure to have 10x LineWidths
            hLines = findall(fig,'Type','line');
            hThinLines = [];
            for lineIdx = 1 : numel(hLines)
                thisLine = hLines(lineIdx);
                if thisLine.LineWidth < 0.75 && strcmpi(thisLine.Visible,'on')
                    hThinLines(end+1) = thisLine; %#ok<AGROW>
                    thisLine.LineWidth = thisLine.LineWidth * 10;
                end
            end

            % If any thin lines were found
            if ~isempty(hThinLines)
                % Prepare an EPS with large-enough line widths
                print(fig, options{:}, name);
                % Restore the original LineWidths in the figure
                for lineIdx = 1 : numel(hThinLines)
                    thisLine = handle(hThinLines(lineIdx));
                    thisLine.LineWidth = thisLine.LineWidth / 10;
                end

                % Compare the original and the new EPS files and correct the original stream's LineWidths
                fstrm_new = read_write_entire_textfile(name);
                idx = 500;  % skip heading with its possibly-different timestamp
                markerStr = sprintf('10.0 ML\nN');
                markerLen = length(markerStr);
                while ~isempty(idx) && idx < length(fstrm)
                    lastIdx = min(length(fstrm), length(fstrm_new));
                    delta = fstrm(idx+1:lastIdx) - fstrm_new(idx+1:lastIdx);
                    idx = idx + find(delta,1);
                    if ~isempty(idx) && ...
                            isequal(fstrm(idx-markerLen+1:idx), markerStr) && ...
                            ~isempty(regexp(fstrm_new(idx-markerLen+1:idx+12),'10.0 ML\n[\d\.]+ LW\nN')) %#ok<RGXP1>
                        value = str2double(regexprep(fstrm_new(idx:idx+12),' .*',''));
                        if isnan(value), break; end  % something's wrong... - bail out
                        newStr = sprintf('%0.3f LW\n',value/10);
                        fstrm = [fstrm(1:idx-1) newStr fstrm(idx:end)];
                        idx = idx + 12;
                    else
                        break;
                    end
                end
            end
            %}

            % This is much faster although less accurate: fix all non-gray lines to have a LineWidth of 0.75 (=1 LW)
            % Note: This will give incorrect LineWidth of 075 for lines having LineWidth<0.75, as well as for non-gray grid-lines (if present)
            %       However, in practice these edge-cases are very rare indeed, and the difference in LineWidth should not be noticeable
            %fstrm = regexprep(fstrm, '([CR]C\n2 setlinecap\n1 LJ)\nN', '$1\n1 LW\nN');
            % This is faster (the original regexprep could take many seconds when the axes contains many lines):
            fstrm = strrep(fstrm, sprintf('\n2 setlinecap\n1 LJ\nN'), sprintf('\n2 setlinecap\n1 LJ\n1 LW\nN'));
        end
    catch err
        fprintf(2, 'Error fixing LineWidths in EPS file: %s\n at %s:%d\n', err.message, err.stack(1).file, err.stack(1).line);
    end

    % Reset the font and line colors
    try
        set(black_text_handles, 'Color', [0 0 0]);
        set(white_text_handles, 'Color', [1 1 1]);
    catch
        % Fix issue #159: redo findall() '*text_handles'
        black_text_handles = findall(fig, 'Type', 'text', 'Color', [0 0 0]+eps);
        white_text_handles = findall(fig, 'Type', 'text', 'Color', [1 1 1]-eps);
        set(black_text_handles, 'Color', [0 0 0]);
        set(white_text_handles, 'Color', [1 1 1]);
    end
    set(white_line_handles, 'Color', [1 1 1]);

    % Reset paper size
    set(fig, 'PaperPositionMode', old_pos_mode, 'PaperOrientation', old_orientation);

    % Reset the font names in the figure
    if ~isempty(font_swap)
        for a = update
            set(font_handles(a), 'FontName', fonts{a}, 'FontSize', fonts_size(a));
        end
    end

    % Bail out if EPS post-processing is not possible
    if isempty(fstrm)
        warning('Loading EPS file failed, so unable to perform post-processing. This is usually because the figure contains a large number of patch objects. Consider exporting to a bitmap format in this case.');
        return
    end

    % Replace the font names
    if ~isempty(font_swap)
        for a = 1:size(font_swap, 2)
            fontName = font_swap{3,a};
            %fontName = fontName(~isspace(font_swap{3,a}));
            if length(fontName) > 29
                warning('YMA:export_fig:font_name','Font name ''%s'' is longer than 29 characters. This might cause problems in some EPS/PDF readers. Consider using a different font.',fontName);
            end
            if isempty(font_space)
                fontName(fontName==' ') = '';
            else
                fontName(fontName==' ') = char(font_space);
            end
            %fstrm = regexprep(fstrm, [font_swap{1,a} '-?[a-zA-Z]*\>'], fontName);
            fstrm = regexprep(fstrm, font_swap{2,a}, fontName);
        end
    end

    % Move the bounding box to the top of the file (HG2 only), or fix the line styles (HG1 only)
    if using_hg2(fig)
        % Move the bounding box to the top of the file (HG2 only)
        [s, e] = regexp(fstrm, '%%BoundingBox: [^%]*%%');
        if numel(s) == 2
            fstrm = fstrm([1:s(1)-1 s(2):e(2)-2 e(1)-1:s(2)-1 e(2)-1:end]);
        end
    else
        % Fix the line styles (HG1 only)
        fstrm = fix_lines(fstrm);
    end

    % Apply the bounding box padding & cropping, replacing Matlab's print()'s bounding box
    if bb_crop
        % Calculate a new bounding box based on a bitmap print using crop_border.m
        % 1. Determine the Matlab BoundingBox and PageBoundingBox
        [s,e] = regexp(fstrm, '%%BoundingBox: [^%]*%%'); % location BB in eps file
        if numel(s)==2, s=s(2); e=e(2); end
        aa = fstrm(s+15:e-3); % dimensions bb - STEP1
        bb_matlab = cell2mat(textscan(aa,'%f32%f32%f32%f32'));  % dimensions bb - STEP2

        [s,e] = regexp(fstrm, '%%PageBoundingBox: [^%]*%%'); % location bb in eps file
        if numel(s)==2, s=s(2); e=e(2); end
        aa = fstrm(s+19:e-3); % dimensions bb - STEP1
        pagebb_matlab = cell2mat(textscan(aa,'%f32%f32%f32%f32'));  % dimensions bb - STEP2

        % 1b. Fix issue #239: black title meshes with temporary black background figure bgcolor, causing bad cropping
        hTitles = [];
        if isequal(get(fig,'Color'),'none')
            hAxes = findall(fig,'type','axes');
            for idx = 1 : numel(hAxes)
                hAx = hAxes(idx);
                try
                    hTitle = hAx.Title;
                    oldColor = hTitle.Color;
                    if all(oldColor < 5*eps) || (ischar(oldColor) && lower(oldColor(1))=='k')
                        hTitles(end+1) = hTitle; %#ok<AGROW>
                        hTitle.Color = [0,0,.01];
                    end
                catch
                end
            end
        end

        % 2. Create a bitmap image and use crop_borders to create the relative
        %    bb with respect to the PageBoundingBox
        [A, bcol] = print2array(fig, 1, renderer);
        [aa, aa, aa, bb_rel] = crop_borders(A, bcol, bb_padding, crop_amounts); %#ok<ASGLU>

        try set(hTitles,'Color','k'); catch, end

        % 3. Calculate the new Bounding Box
        pagew = pagebb_matlab(3)-pagebb_matlab(1);
        pageh = pagebb_matlab(4)-pagebb_matlab(2);
        %bb_new = [pagebb_matlab(1)+pagew*bb_rel(1) pagebb_matlab(2)+pageh*bb_rel(2) ...
        %          pagebb_matlab(1)+pagew*bb_rel(3) pagebb_matlab(2)+pageh*bb_rel(4)];
        bb_new = pagebb_matlab([1,2,1,2]) + [pagew,pageh,pagew,pageh].*bb_rel;  % clearer
        bb_offset = (bb_new-bb_matlab) + [-2,-2,2,2];  % 2px margin so that cropping is not TOO tight (issue #195)

        % Apply the bounding box padding
        if bb_padding
            if abs(bb_padding)<1
                bb_padding = round((mean([bb_new(3)-bb_new(1) bb_new(4)-bb_new(2)])*bb_padding)/0.5)*0.5; % ADJUST BB_PADDING
            end
            add_padding = @(n1, n2, n3, n4) sprintf(' %.0f', str2double({n1, n2, n3, n4}) + bb_offset + bb_padding*[-1,-1,1,1]); %#ok<NASGU>
        else
            add_padding = @(n1, n2, n3, n4) sprintf(' %.0f', str2double({n1, n2, n3, n4}) + bb_offset); %#ok<NASGU> % fix small but noticeable bounding box shift
        end
        fstrm = regexprep(fstrm, '%%BoundingBox:[ ]+([-]?\d+)[ ]+([-]?\d+)[ ]+([-]?\d+)[ ]+([-]?\d+)', '%%BoundingBox:${add_padding($1, $2, $3, $4)}');
    end

    % Fix issue #44: white artifact lines appearing in patch exports
    % Note: the problem is due to the fact that Matlab's print() function exports patches
    %       as a combination of filled triangles, and a white line appears where the triangles touch
    % In the workaround below, we will modify such dual-triangles into a filled rectangle.
    % We are careful to only modify regexps that exactly match specific patterns - it's better to not
    % correct some white-line artifacts than to change the geometry of a patch, or to corrupt the EPS.
    %   e.g.: '0 -450 937 0 0 450 3 MP PP 937 0 0 -450 0 450 3 MP PP' => '0 -450 937 0 0 450 0 0 4 MP'
    fstrm = regexprep(fstrm, '\n([-\d.]+ [-\d.]+) ([-\d.]+ [-\d.]+) ([-\d.]+ [-\d.]+) 3 MP\nPP\n\2 \1 \3 3 MP\nPP\n','\n$1 $2 $3 0 0 4 MP\nPP\n');
    fstrm = regexprep(fstrm, '\n([-\d.]+ [-\d.]+) ([-\d.]+ [-\d.]+) ([-\d.]+ [-\d.]+) 3 MP\nPP\n\2 \3 \1 3 MP\nPP\n','\n$1 $2 $3 0 0 4 MP\nPP\n');
    fstrm = regexprep(fstrm, '\n([-\d.]+ [-\d.]+) ([-\d.]+ [-\d.]+) ([-\d.]+ [-\d.]+) 3 MP\nPP\n\3 \1 \2 3 MP\nPP\n','\n$1 $2 $3 0 0 4 MP\nPP\n');
    fstrm = regexprep(fstrm, '\n([-\d.]+ [-\d.]+) ([-\d.]+ [-\d.]+) ([-\d.]+ [-\d.]+) 3 MP\nPP\n\3 \2 \1 3 MP\nPP\n','\n$1 $2 $3 0 0 4 MP\nPP\n');

    % Write out the fixed eps file
    read_write_entire_textfile(name, fstrm);
end

function [StoredColors, fstrm, foundFlags] = eps_maintainAlpha(fig, fstrm, StoredColors)
    if nargin == 1  % in: convert transparency in Matlab figure into unique RGB colors
        hObjs = findall(fig); %findobj(fig,'Type','Area');
        StoredColors = {};
        propNames = {'Face','Edge'};
        for objIdx = 1:length(hObjs)
            hObj = hObjs(objIdx);
            for propIdx = 1 : numel(propNames)
                try
                    propName = propNames{propIdx};
                    if strcmp(hObj.(propName).ColorType, 'truecoloralpha')
                        nColors = length(StoredColors);
                        oldColor = hObj.(propName).ColorData;
                        newColor = uint8([101; 102+floor(nColors/255); mod(nColors,255); 255]);
                        StoredColors{end+1} = {hObj, propName, oldColor, newColor}; %#ok<AGROW>
                        hObj.(propName).ColorData = newColor;
                    end
                catch
                    % Never mind - ignore (either doesn't have the property or cannot change it)
                end
            end
        end
    else  % restore transparency in Matlab figure by converting back from the unique RGBs
        %Find the transparent patches
        wasError = false;
        nColors = length(StoredColors);
        foundFlags = false(1,nColors);
        for objIdx = 1 : nColors
            colorsData = StoredColors{objIdx};
            hObj      = colorsData{1};
            propName  = colorsData{2};
            origColor = colorsData{3};
            newColor  = colorsData{4};
            try
                %Restore the EPS files patch color
                colorID   = num2str(round(double(newColor(1:3)') /255,3),'%.3g %.3g %.3g'); %ID for searching
                origRGB   = num2str(round(double(origColor(1:3)')/255,3),'%.3g %.3g %.3g'); %Replace with original color
                origAlpha = num2str(round(double(origColor(end)) /255,3),'%.3g'); %Convert alpha value for EPS

                %Find and replace the RGBA values within the EPS text fstrm
                if strcmpi(propName,'Face')
                    oldStr = sprintf(['\n' colorID ' RC\n']);  % ...N\n (removed to fix issue #225)
                    newStr = sprintf(['\n' origRGB ' RC\n' origAlpha ' .setopacityalpha true\n']);  % ...N\n
                else  %'Edge'
                    oldStr = sprintf(['\n' colorID ' RC\n']);  % ...1 LJ\n (removed to fix issue #225)
                    newStr = sprintf(['\n' origRGB ' RC\n' origAlpha ' .setopacityalpha true\n']);
                end
                foundFlags(objIdx) = ~isempty(strfind(fstrm, oldStr)); %#ok<STREMP>
                fstrm = strrep(fstrm, oldStr, newStr);

                %Restore the figure object's original color
                hObj.(propName).ColorData = origColor;
            catch err
                % something is wrong - cannot restore transparent color...
                if ~wasError
                    fprintf(2, 'Error maintaining transparency in EPS file: %s\n at %s:%d\n', err.message, err.stack(1).file, err.stack(1).line);
                    wasError = true;
                end
            end
        end
    end
end

%READ_WRITE_ENTIRE_TEXTFILE Read or write a whole text file to/from memory
%
% Read or write an entire text file to/from memory, without leaving the
% file open if an error occurs.
%
% Reading:
%   fstrm = read_write_entire_textfile(fname)
% Writing:
%   read_write_entire_textfile(fname, fstrm)
%
%IN:
%   fname - Pathname of text file to be read in.
%   fstrm - String to be written to the file, including carriage returns.
%
%OUT:
%   fstrm - String read from the file. If an fstrm input is given the
%           output is the same as that input. 

function fstrm = read_write_entire_textfile(fname, fstrm)
modes = {'rt', 'wt'};
writing = nargin > 1;
fh = fopen(fname, modes{1+writing});
if fh == -1
    error('Unable to open file %s.', fname);
end
try
    if writing
        fwrite(fh, fstrm, 'char*1');
    else
        fstrm = fread(fh, '*char')';
    end
catch ex
    fclose(fh);
    rethrow(ex);
end
fclose(fh);
end

function string = user_string(string_name, string)
%USER_STRING  Get/set a user specific string
%
% Examples:
%   string  = user_string(string_name)
%   isSaved = user_string(string_name, new_string)
%
% Function to get and set a string in a system or user specific file. This
% enables, for example, system specific paths to binaries to be saved.
%
% The specified string will be saved in a file named <string_name>.txt,
% either in a subfolder named .ignore under this file's folder, or in the
% user's prefdir folder (in case this file's folder is non-writable).
%
% IN:
%   string_name - String containing the name of the string required, which
%                 sets the filename storing the string: <string_name>.txt
%   new_string  - The new string to be saved in the <string_name>.txt file
%
% OUT:
%   string  - The currently saved string. Default: ''
%   isSaved - Boolean indicating whether the save was succesful

% Copyright (C) Oliver Woodford 2011-2014, Yair Altman 2015-

% This method of saving paths avoids changing .m files which might be in a
% version control system. Instead it saves the user dependent paths in
% separate files with a .txt extension, which need not be checked in to
% the version control system. Thank you to Jonas Dorn for suggesting this
% approach.

% 10/01/2013 - Access files in text, not binary mode, as latter can cause
%              errors. Thanks to Christian for pointing this out.
% 29/05/2015 - Save file in prefdir if current folder is non-writable (issue #74)
% 09/01/2018 - Fix issue #232: if the string looks like a file/folder path, ensure it actually exists

    if ~ischar(string_name)
        error('string_name must be a string.');
    end
    % Create the full filename
    fname = [string_name '.txt'];
    dname = fullfile(fileparts(mfilename('fullpath')), '.ignore');
    file_name = fullfile(dname, fname);
    if nargin > 1
        % Set string
        if ~ischar(string)
            error('new_string must be a string.');
        end
        % Make sure the save directory exists
        %dname = fileparts(file_name);
        if ~exist(dname, 'dir')
            % Create the directory
            try
                if ~mkdir(dname)
                    string = false;
                    return
                end
            catch
                string = false;
                return
            end
            % Make it hidden
            try
                fileattrib(dname, '+h');
            catch
            end
        end
        % Write the file
        fid = fopen(file_name, 'wt');
        if fid == -1
            % file cannot be created/updated - use prefdir if file does not already exist
            % (if file exists but is simply not writable, don't create a duplicate in prefdir)
            if ~exist(file_name,'file')
                file_name = fullfile(prefdir, fname);
                fid = fopen(file_name, 'wt');
            end
            if fid == -1
                string = false;
                return;
            end
        end
        try
            fprintf(fid, '%s', string);
        catch
            fclose(fid);
            string = false;
            return
        end
        fclose(fid);
        string = true;
    else
        % Get string
        fid = fopen(file_name, 'rt');
        if fid == -1
            % file cannot be read, try to read the file in prefdir
            file_name = fullfile(prefdir, fname);
            fid = fopen(file_name, 'rt');
            if fid == -1
                string = '';
                return
            end
        end
        string = fgetl(fid);
        fclose(fid);

        % Fix issue #232: if the string looks like a file/folder path, ensure it actually exists
        if ~isempty(string) && any(string=='\' | string=='/') && ~exist(string) %#ok<EXIST>
            string = '';
        end
    end
end

%USING_HG2 Determine if the HG2 graphics engine is used
%
%   tf = using_hg2(fig)
%
%IN:
%   fig - handle to the figure in question.
%
%OUT:
%   tf - boolean indicating whether the HG2 graphics engine is being used
%        (true) or not (false).

% 19/06/2015 - Suppress warning in R2015b; cache result for improved performance
% 06/06/2016 - Fixed issue #156 (bad return value in R2016b)

function tf = using_hg2(fig)
    persistent tf_cached
    if isempty(tf_cached)
        try
            if nargin < 1,  fig = figure('visible','off');  end
            oldWarn = warning('off','MATLAB:graphicsversion:GraphicsVersionRemoval');
            try
                % This generates a [supressed] warning in R2015b:
                tf = ~graphicsversion(fig, 'handlegraphics');
            catch
                tf = ~verLessThan('matlab','8.4');  % =R2014b
            end
            warning(oldWarn);
        catch
            tf = false;
        end
        if nargin < 1,  delete(fig);  end
        tf_cached = tf;
    else
        tf = tf_cached;
    end
end
%}
%switchable1

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------- END - ALTMANY EXPORT FIG - END -----------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------



%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- UNUSED MAINS BELOW -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


%{
% LambertW Investigation
function gettingfandthetat()
    syms xtrial
    syms knot_x
    syms knot_theta
    syms ytrial
    syms knot_y
    syms knot_rx
    syms knot_theta
    syms knot_ry

    f=((xtrial-knot_x)*cos(knot_theta)+(ytrial-knot_y)*sin(knot_theta))^2/knot_rx^2+((xtrial-knot_x)*sin(knot_theta)-(ytrial-knot_y)*cos(knot_theta))^2/knot_ry^2-1;
    df_x=diff(f,xtrial);
    df_y=diff(f,ytrial);
    tanthetar=simplify(df_y/df_x);
    thetar=atan(tanthetar);
    thetat=thetar+pi/2;
    thetat=mod(thetat,pi)

    %{
    syms knot_x knot_x(knotnum)
    syms knot_theta knot_theta(knotnum)
    syms knot_y knot_y(knotnum)
    syms knot_rx knot_rx(knotnum)
    syms knot_theta knot_theta(knotnum)
    syms knot_ry knot_ry(knotnum)
    %}

    f=char(f);
    f=strrep(f,'knot_x','knot_x(knotnum)');
    f=strrep(f,'knot_theta','knot_theta(knotnum)');
    f=strrep(f,'knot_y','knot_y(knotnum)');
    f=strrep(f,'knot_rx','knot_rx(knotnum)');
    f=strrep(f,'knot_theta','knot_theta(knotnum)');
    f=strrep(f,'knot_ry','knot_ry(knotnum)');
    f=strrep(f,'xtrial','xtrial_global');
    f=strrep(f,'ytrial','ytrial_global');
    disp(['f=' f ';']);

    thetat=char(thetat);
    thetat=strrep(thetat,'knot_x','knot_x(knotnum)');
    thetat=strrep(thetat,'knot_theta','knot_theta(knotnum)');
    thetat=strrep(thetat,'knot_y','knot_y(knotnum)');
    thetat=strrep(thetat,'knot_rx','knot_rx(knotnum)');
    thetat=strrep(thetat,'knot_theta','knot_theta(knotnum)');
    thetat=strrep(thetat,'knot_ry','knot_ry(knotnum)');
    thetat=strrep(thetat,'xtrial','xtrial_global');
    thetat=strrep(thetat,'ytrial','ytrial_global');
    disp(['thetat=' thetat ';']);
end

function LambertWInvestigate()
    ftl=65.5;
    ftr=3.75;
    ftt=2.79;
    fcl=-50.3;
    fcr=-6;
    fct=-6;
    fvrt=1.83/20; %replacereplacereplace
    fvrl=6.34/20; %replacereplacereplace
    fvtl=5.34/20; %replacereplacereplace
    Er=820/1; %replacereplacereplace
    Et=430/1; %replacereplacereplace
    El=13200/1; %replacereplacereplace

    kappa1=0.00001;
    kappa2=1.2;
    kappa3=0.00001;
    kappa4=1.2;
    kappa5=0.00001;
    kappa6=0.7;
    kappa7=1.2;

    Gftl=1650/1000;
    Gfcl=50000/1000;
    Gftr=300/1000;
    Gftt=Gftr;
    Gfcr=Gftr/Gftl*Gfcl;
    Gfct=Gfcr;
    GII=300/1000;

    Hld=15;
    Hrd=2;
    Htd=Hrd;

    %{
    beta0tl=65;
    beta0cl=49.9;
    beta0tr=4.5;
    beta0cr=beta0tr/beta0tl*beta0cl;
    beta0tt=beta0tr;
    beta0ct=beta0cr;
    %}

    beta0tl=abs(ftl);
    beta0cl=abs(fcl);
    beta0tr=abs(ftr);
    beta0cr=abs(fcr);
    beta0tt=abs(ftt);
    beta0ct=abs(fct);

    lccrit=El*Gftl/beta0tl^2;
    lc(1)=0.8*lccrit;
    lc(2)=lccrit;
    lc(3)=1.25*lccrit;

    zeta2=Hrd/beta0cr^2;
    zeta4=Htd/beta0ct^2;
    zeta6=Hld/beta0cl^2;
    zeta7=zeta2;

    alpha2d=0.1*abs(fcr);
    alpha2max=0.75*abs(fcr);
    alpha4d=0.1*abs(fct);
    alpha4max=0.75*abs(fct);
    alpha6d=0.5*abs(fcl);
    alpha6max=0.75*abs(fcl);
    alpha7d=0.1*abs(1/3*(fvrt+fvrl+fvtl));
    alpha7max=0.75*abs(1/3*(fvrt+fvrl+fvtl));
    
    f=ftl;
    E=El;
    epsilon=linspace(f/E-1e-3,f/E+4e-3,1001);
    for j=1:3
        eta=lc(j)/Gftl;
        for i=1:length(epsilon)
            alphahp{1}{j}(i)=f*epsilon(i)+Gftl/lc(j)*(lambertw(0,-f^2*lc(j)/(E*Gftl)*exp(-f*lc(j)*epsilon(i)/Gftl)));
            alphahp{2}{j}(i)=f*epsilon(i)+Gftl/lc(j)*(lambertw(-1,-f^2*lc(j)/(E*Gftl)*exp(-f*lc(j)*epsilon(i)/Gftl)));
            epsilonminusepsilony(i)=epsilon(i)-f/E;
        end
    end
    plot(epsilonminusepsilony,alphahp{1}{1},'DisplayName','l_c=0.8*l_{c,crit},0');
    hold on
    plot(epsilonminusepsilony,alphahp{2}{1},'DisplayName','l_c=0.8*l_{c,crit},-1');
    plot(epsilonminusepsilony,alphahp{1}{2},'DisplayName','l_c=1.0*l_{c,crit},0');
    plot(epsilonminusepsilony,alphahp{2}{2},'DisplayName','l_c=1.0*l_{c,crit},-1');
    plot(epsilonminusepsilony,alphahp{1}{3},'DisplayName','l_c=1.25*l_{c,crit},0');
    plot(epsilonminusepsilony,alphahp{2}{3},'DisplayName','l_c=1.25*l_{c,crit},-1');
    ylabel('\alphahp (MPa)','FontSize',15);
    xlabel('\epsilon - \epsilon_y','FontSize',15)
    grid on
    legend show
    hold off
    %{
    alphahp=linspace(-0.006*f*3/4,0.01*f*3/4,1001);
    for j=1:3
        eta=lc(j)/Gftl;
        for i=1:length(alphahp)
            epsilonminusepsilony{j}(i)=alphahp(i)/f+f/E*exp(-eta*alphahp(i))-f/E;
            depsilondalpha{j}(i)=1/f-eta*f/E*exp(-eta*alphahp(i));
            dalphadepsilon{j}(i)=1/depsilondalpha{j}(i);
        end
    end
    plot(epsilonminusepsilony{1},alphahp,'DisplayName','l_c=0.8*l_{c,crit}');
    hold on
    plot(epsilonminusepsilony{2},alphahp,'DisplayName','l_c=1.0*l_{c,crit}');
    plot(epsilonminusepsilony{3},alphahp,'DisplayName','l_c=1.25*l_{c,crit}');
    ylabel('\alphahp (MPa)','FontSize',15);
    xlabel('\epsilon - \epsilon_y','FontSize',15)
    grid on
    legend show
    hold off
    
    
    %{
    pause
    plot(epsilonminusepsilony,dalphadepsilon);
    hold on
    ylabel('d\alphahp/d(\epsilon - \epsilony) (MPa)','FontSize',15);
    xlabel('\epsilon - \epsilon_y','FontSize',15)
    grid on
    hold off
    %}
    lc=linspace(0.5*lccrit,1.75*lccrit,1001);
    for i=1:length(lc)
        insidelambert(i)=-f^2*lc(i)/(E*Gftl)*exp(-f*lc(i)*(f/E)/Gftl);
    end
    plot(lc/lccrit,insidelambert)
    hold on
    xlabel('l_c/l_{c,crit}');
    ylabel('LambertW Input');
    grid on
    hold off
    %}
end


function OnePointTens3()
    TimeStampedName=['OnePointTens3' datestr(now,'yymmdd-HH.MM.SS')];
    theta=linspace(0,360,36001); %degrees
    sigmaRplot12=zeros(1,length(theta));
    sigmaTplot12=zeros(1,length(theta));
    sigmaRplot34=zeros(1,length(theta));
    sigmaTplot34=zeros(1,length(theta));
    parfor angleiter=1:length(theta)
        [sigmaRplot12(angleiter) sigmaTplot12(angleiter)]=OnePointTens3Ronly(theta(angleiter));
        [sigmaRplot34(angleiter) sigmaTplot34(angleiter)]=OnePointTens3Tonly(theta(angleiter));
    end
    save([TimeStampedName '.mat'])
    
    plot(sigmaRplot12,sigmaTplot12,'DisplayName','Surface 1 & 2','Color','blue');
    hold on;
    plot(sigmaRplot34,sigmaTplot34,'DisplayName','Surface 3 & 4','Color','red');
    xlabel('\sigma_R','FontSize',15);
    ylabel('\sigma_T','FontSize',15);
    legend('show');
    set(gca,'color','none');
    set(legend,'color','none');
    hold off
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [sigmaR sigmaT]=OnePointTens3Ronly(theta)
        sigmabase(1)=2.79/2;
        for i=1:9999
            sigmaR=sigmabase(i)*cos(theta/180*pi);
            sigmaT=sigmabase(i)*sin(theta/180*pi);
            sigmatrial=[sigmaR;sigmaT;0;0;0;0];
            F=Wood_Schmidt_EvalSigmaEff(sigmatrial,[0 0 0 0 0 0 0],[1 2 3 4 5 6 7],[1 0 0 0 0 0]);
            F{3}=-inf;
            F{4}=-inf;
            Fmax=CellMax(F);
            if Fmax<=0
                sigmabase(i+1)=sigmabase(i)*2;
            else
                sigmaminus=sigmabase(i-1);
                sigmaplus=sigmabase(i);
                break;
            end
        end
        for i=i+1:999999
            sigmabase(i)=0.5*(sigmaminus+sigmaplus);
            sigmaR=sigmabase(i)*cos(theta/180*pi);
            sigmaT=sigmabase(i)*sin(theta/180*pi);
            sigmatrial=[sigmaR;sigmaT;0;0;0;0];
            F=Wood_Schmidt_EvalSigmaEff(sigmatrial,[0 0 0 0 0 0 0],[1 2 3 4 5 6 7],[1 0 0 0 0 0]);
            F{3}=-inf;
            F{4}=-inf;
            Fmax=CellMax(F);
            if abs(Fmax)<1e-6
                break;
            end
            if Fmax>0
                sigmaplus=sigmabase(i);
            else
                sigmaminus=sigmabase(i);
            end
        end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [sigmaR sigmaT]=OnePointTens3Tonly(theta)
        sigmabase(1)=2.79/2;
        for i=1:9999
            sigmaR=sigmabase(i)*cos(theta/180*pi);
            sigmaT=sigmabase(i)*sin(theta/180*pi);
            sigmatrial=[sigmaR;sigmaT;0;0;0;0];
            F=Wood_Schmidt_EvalSigmaEff(sigmatrial,[0 0 0 0 0 0 0],[1 2 3 4 5 6 7],[1 0 0 0 0 0]);
            F{1}=-inf;
            F{2}=-inf;
            Fmax=CellMax(F);
            if Fmax<=0
                sigmabase(i+1)=sigmabase(i)*2;
            else
                sigmaminus=sigmabase(i-1);
                sigmaplus=sigmabase(i);
                break;
            end
        end
        for i=i+1:999999
            sigmabase(i)=0.5*(sigmaminus+sigmaplus);
            sigmaR=sigmabase(i)*cos(theta/180*pi);
            sigmaT=sigmabase(i)*sin(theta/180*pi);
            sigmatrial=[sigmaR;sigmaT;0;0;0;0];
            F=Wood_Schmidt_EvalSigmaEff(sigmatrial,[0 0 0 0 0 0 0],[1 2 3 4 5 6 7],[1 0 0 0 0 0]);
            F{1}=-inf;
            F{2}=-inf;
            Fmax=CellMax(F);
            if abs(Fmax)<1e-6
                break;
            end
            if Fmax>0
                sigmaplus=sigmabase(i);
            else
                sigmaminus=sigmabase(i);
            end
        end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function OnePointTens2()
    ftl=65.5;
    ftr=3.75;
    ftt=2.79;
    fcl=-50.3;
    fcr=-6;
    fct=-6;
    fvrt=1.83/20; %replacereplacereplace
    fvrl=6.34/20; %replacereplacereplace
    fvtl=5.34/20; %replacereplacereplace
    
    TimeStampedName=['OnePointTens2' datestr(now,'yymmdd-HH.MM.SS')];
    theta=linspace(0,90,9001); %degrees
    sigmaouttens=zeros(1,length(theta));
    parfor angleiter=1:length(theta)
        [sigmaouttens(angleiter)]=OnePointTens2InsideParfor(theta(angleiter),1);
        [sigmaoutcomp(angleiter)]=OnePointTens2InsideParfor(theta(angleiter),-1);
    end
    save([TimeStampedName '.mat'])
    
    plot(theta,sigmaouttens/abs(ftl),'LineWidth',1.5,'Color','red');
    hold on;
    title('Tension Loading')
    xlabel('Angle (degrees)','FontSize',15);
    ylabel('\sigma_{load,tens}/f_{t_time,L}','FontSize',15);
    set(gca,'color','none')
    hold off;
    pause;
    
    plot(theta,sigmaoutcomp/fcl,'LineWidth',1.5,'Color','red');
    hold on;
    title('Compression Loading')
    xlabel('Angle (degrees)','FontSize',15);
    ylabel('\sigma_{load,comp}/f_{c,L}','FontSize',15);
    set(gca,'color','none')
    hold off;
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [sigmaout]=OnePointTens2InsideParfor(theta,sign)
	sigmabase(1)=sign*2.79/2;
	for i=1:9999
		sigmaL=sigmabase(i)/2+sigmabase(i)/2*cos(2*theta/180*pi);
		sigmaR=sigmabase(i)/2-sigmabase(i)/2*cos(2*theta/180*pi);
		sigmaRL=-(sigmabase(i)/2)*sin(2*theta/180*pi);
		sigmatrial=[sigmaR;0;sigmaL;0;0;sigmaRL];
		F=Wood_Schmidt_EvalSigmaEff(sigmatrial,[0 0 0 0 0 0 0],[1 2 3 4 5 6 7],[1 0 0 0 0 0]);
		Fmax=CellMax(F);
		if Fmax<=0
			sigmabase(i+1)=sigmabase(i)*2;
		else
			sigmaminus=sigmabase(i-1);
			sigmaplus=sigmabase(i);
			break;
		end
	end
	for i=i+1:999999
		sigmabase(i)=0.5*(sigmaminus+sigmaplus);
		sigmaL=sigmabase(i)/2+sigmabase(i)/2*cos(2*theta/180*pi);
		sigmaR=sigmabase(i)/2-sigmabase(i)/2*cos(2*theta/180*pi);
		sigmaRL=-(sigmabase(i)/2)*sin(2*theta/180*pi);
		sigmatrial=[sigmaR;0;sigmaL;0;0;sigmaRL];
		F=Wood_Schmidt_EvalSigmaEff(sigmatrial,[0 0 0 0 0 0 0],[1 2 3 4 5 6 7],[1 0 0 0 0 0]);
		Fmax=CellMax(F);
		if abs(Fmax)<1e-6
			break;
		end
		if Fmax>0
			sigmaplus=sigmabase(i);
		else
			sigmaminus=sigmabase(i);
		end
	end
	sigmaout=sigmabase(i);
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function OnePointTens1()
    TimeStampedName=['OnePointTens1' datestr(now,'yymmdd-HH.MM.SS')];
    theta=linspace(0,360,36001); %degrees
    sigmaLplot=zeros(1,length(theta));
    sigmaRplot=zeros(1,length(theta));
    parfor angleiter=1:length(theta)
        [sigmaLplot(angleiter) sigmaRplot(angleiter)]=OnePointTens1InsideParfor(theta(angleiter));
    end
    plot(sigmaLplot,sigmaRplot,'LineWidth',2,'Color','red');
    hold on;
    xlabel('\sigma_L','FontSize',15);
    ylabel('\sigma_R','FontSize',15);
    set(gca,'color','none')
    hold off
    save([TimeStampedName '.mat'])
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [sigmaL sigmaR]=OnePointTens1InsideParfor(theta)
	sigmabase(1)=2.79/2;
	for i=1:9999
		sigmaL=sigmabase(i)*cos(theta/180*pi);
		sigmaR=sigmabase(i)*sin(theta/180*pi);
		sigmatrial=[sigmaR;0;sigmaL;0;0;0];
		F=Wood_Schmidt_EvalSigmaEff(sigmatrial,[0 0 0 0 0 0 0],[1 2 3 4 5 6 7],[1 0 0 0 0 0]);
		Fmax=CellMax(F);
		if Fmax<=0
			sigmabase(i+1)=sigmabase(i)*2;
		else
			sigmaminus=sigmabase(i-1);
			sigmaplus=sigmabase(i);
			break;
		end
	end
	for i=i+1:999999
		sigmabase(i)=0.5*(sigmaminus+sigmaplus);
		sigmaL=sigmabase(i)*cos(theta/180*pi);
		sigmaR=sigmabase(i)*sin(theta/180*pi);
		sigmatrial=[sigmaR;0;sigmaL;0;0;0];
		F=Wood_Schmidt_EvalSigmaEff(sigmatrial,[0 0 0 0 0 0 0],[1 2 3 4 5 6 7],[1 0 0 0 0 0]);
		Fmax=CellMax(F);
		if abs(Fmax)<1e-6
			break;
		end
		if Fmax>0
			sigmaplus=sigmabase(i);
		else
			sigmaminus=sigmabase(i);
		end
	end
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function OnePointPull()
    TimeStampedName=['MatModelTestbed' datestr(now,'yymmdd-HH.MM.SS')];
    ftl=65.5;
    ftr=3.75;
    ftt=2.79;
    fcl=-50.3;
    fcr=-6;
    fct=-6;
    fvrt=1.83/20; %replacereplacereplace
    fvrl=6.34/20; %replacereplacereplace
    fvtl=5.34/20; %replacereplacereplace
    Er=820/1; %replacereplacereplace
    Et=430/1; %replacereplacereplace
    El=13200/1; %replacereplacereplace
    Grt=40/1; %replacereplacereplace
    Gtl=730/1; %replacereplacereplace
    Grl=660/1; %replacereplacereplace
    nurt=0.24;
    nutl=0.45;
    nurl=0.45;


    Comp=[1/Er -nurt/Et -nurl/El 0 0 0;
         -nurt/Et 1/Et -nutl/El 0 0 0;
         -nurl/El -nutl/El 1/El 0 0 0;
         0 0 0 1/Grt 0 0;
         0 0 0 0 1/Gtl 0;
         0 0 0 0 0 1/Grl];
     
    xdir=RTLtranslator('r');
    ydir=RTLtranslator('t');
    zdir=RTLtranslator('l');
    xydir=RTLtranslator('rt');
    yzdir=RTLtranslator('tl');
    xzdir=RTLtranslator('rl');
    
    Comp=MatReorder(Comp,[xdir ydir zdir xydir yzdir xzdir]);
    C=Comp^-1;
    
    %sigma_global_big=transpose([3.75 2.79 0 0 0 0]);

    %for surface 1&3
    %sigma_global_big=transpose([3.4687600422317030890440037182998,2.3237485210648975986202913190937,0,0,0,0])*0.9999;

    %for surface 1 only
    sigma_global_big=transpose([0 0 0 0 0 0]);

    %for surface 2 and 4
    %sigma_global_big=transpose([ -4.593386622447824585435682820389 -4.593386622447824585435682820389 0 0 0 0]);

    %sigma_global_big=transpose([0 0 0 0 0 0]);
    e_t_global_big=Comp*sigma_global_big;
    e_pl_global_big=transpose([0 0 0 0 0 0]);
    alphahp=[0 0 0 0 0 0 0];
    [sigmaplot2 epsilonplot2]=AnalyticalLoadDisplacementPlot;
    for i=1:9999999
        if i==1
            dESP=[0 0;0 0];
        else
            dESP=[-0.0001 0;0 0.000];
        end
        if i>2
            if alphaplot(i-1)<alphaplot(i-2)
                disp('hey!')
            end
        end

        [s_sp,e_pl,sigma_global_big,e_t_global_big,e_pl_global_big,alphahp,f_final_vect,surfacewithfmax]=Wood_Schmidt17(dESP,sigma_global_big,e_t_global_big,e_pl_global_big,alphahp);
        s_sp_trace{i}=s_sp;
        e_pl_trace{i}=e_pl;
        sigma_global_big_trace{i}=sigma_global_big;
        e_t_global_big_trace{i}=e_t_global_big;
        e_pl_global_big_trace{i}=e_pl_global_big;
        alpha_trace{i}=alphahp;
        f_final_vect_trace{i}=f_final_vect;
        surfacewithfmax_trace{i}=surfacewithfmax;
        
        epsilonplot(i)=e_t_global_big(1);
        sigmaplot(i)=sigma_global_big(1);
        alphaplot(i)=alphahp(2);
        if abs(e_t_global_big(1))>=1
            break;
        end
    end
    save([TimeStampedName '.mat'])
    
    
    plot(epsilonplot2,sigmaplot2,'DisplayName','Analytical','LineWidth',2,'Color','cyan');
    hold on;
    plot(-epsilonplot,-sigmaplot,'DisplayName','Numerical','color','black');
    title('R compression');
    xlabel('\epsilon','FontSize',15);
    ylabel('\sigma','FontSize',15);
    legend('show');
    hold off
    pause

    plot(-epsilonplot,alphaplot);
    
    %printvector(sigma_global_big,'sigma_global_big')
end

%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------- FUNCTION SEPARATOR -----------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function [sigma epsilon]=AnalyticalLoadDisplacementPlot()
    ftl=65.5;
    ftr=3.75;
    ftt=2.79;
    fcl=-50.3;
    fcr=-6;
    fct=-6;
    fvrt=1.83/20; %replacereplacereplace
    fvrl=6.34/20; %replacereplacereplace
    fvtl=5.34/20; %replacereplacereplace
    Er=820/1; %replacereplacereplace
    Et=430/1; %replacereplacereplace
    El=13200/1; %replacereplacereplace

    kappa1=0.00001;
    kappa2=1.2;
    kappa3=0.00001;
    kappa4=1.2;
    kappa5=0.00001;
    kappa6=0.7;
    kappa7=1.2;

    Gftl=1650/1000;
    Gfcl=50000/1000;
    Gftr=300/1000;
    Gftt=Gftr;
    Gfcr=Gftr/Gftl*Gfcl;
    Gfct=Gfcr;
    GII=300/1000;

    Hld=15;
    Hrd=2;
    Htd=Hrd;

    %{
    beta0tl=65;
    beta0cl=49.9;
    beta0tr=4.5;
    beta0cr=beta0tr/beta0tl*beta0cl;
    beta0tt=beta0tr;
    beta0ct=beta0cr;
    %}

    beta0tl=abs(ftl);
    beta0cl=abs(fcl);
    beta0tr=abs(ftr);
    beta0cr=abs(fcr);
    beta0tt=abs(ftt);
    beta0ct=abs(fct);

    lccrit=El*Gftl/beta0tl;
    lc=lccrit/100;
    lc=4;

    zeta2=Hrd/beta0cr^2;
    zeta4=Htd/beta0ct^2;
    zeta6=Hld/beta0cl^2;
    zeta7=zeta2;

    alpha2d=0.1*abs(fcr);
    alpha2max=0.75*abs(fcr);
    alpha4d=0.1*abs(fct);
    alpha4max=0.75*abs(fct);
    alpha6d=0.5*abs(fcl);
    alpha6max=0.75*abs(fcl);
    alpha7d=0.1*abs(1/3*(fvrt+fvrl+fvtl));
    alpha7max=0.75*abs(1/3*(fvrt+fvrl+fvtl));

    f=abs(fcr)
    E=Er
    eta=abs(lc)/abs(Gfcr)
    kappa=kappa2
    alphad=alpha2d
    alphainf=alpha2max
    zeta=zeta2

    % before yielding
    epsilon1=linspace(0,f/E,11);
    sigma1=E.*epsilon1;

    % after yielding before densification
    epsilond=alphad/f+f/E*(1-kappa)*(exp(-eta*alphad)-1)+f/E;
    %epsilond=0.3;
    epsilon2=linspace(f/E,epsilond,101);
    for i=1:length(epsilon2)
        sigma2(i)=f*(kappa+(1-kappa)*exp(eta*(kappa*f^2/E-f*epsilon2(i))-lambertw((kappa-1)*(eta*f^2/E)*exp(eta*(kappa*f^2/E-f*epsilon2(i))))));
    end

    % after densification
    %{{
    alphahp=linspace(alphad,0.99*alphainf,101);
    for i=1:length(alphahp)
        q=(1-kappa)*(1-exp(-eta*alphahp(i)))-zeta*((alphahp(i)-alphad)^2/(alphainf-alphahp(i)));
        sigma3(i)=f*(1-q);
        epsilon3(i)=epsilond+(alphahp(i)-alphad)/f-f*((kappa-1)*(exp(-eta*alphahp(i))-exp(-eta*alphad))-zeta*(alphahp(i)-alphad)^2/(alphainf-alphahp(i)))/E;
    end
    %}}
    sigma=[sigma1 sigma2 sigma3];
    %sigma=[sigma1 sigma2];
    epsilon=[epsilon1 epsilon2 epsilon3];
    %epsilon=[epsilon1 epsilon2];
end

if CasetoRun==1 || CasetoRun==2 || CasetoRun==3 || CasetoRun==33 || CasetoRun==34 || CasetoRun==40 || CasetoRun==52 || CasetoRun==54 || CasetoRun==48 || CasetoRun==42 || CasetoRun==45 || CasetoRun==39 || CasetoRun==28 || CasetoRun==29 || CasetoRun==30 || CasetoRun==31 || CasetoRun==27 || CasetoRun==26 || CasetoRun==22 || CasetoRun==24 || CasetoRun==19 || CasetoRun==21 || CasetoRun==17
elseif CasetoRun==4
elseif CasetoRun==5 || CasetoRun==6
elseif CasetoRun==7
elseif CasetoRun==8 || CasetoRun==9
end

%}















%{
filename history:
A201808080131_radialcomp.m
A201808081235_radialcomp.m
A201808081253_surfaceswitchcheck.m
A201808081431_surfaceswitchcheck.m
A201808081443_surfaceswitchcheck.m
A201808091000_radialwithcheck.m
A201808091206_implicitintervention.m
A201808101237_implicitintervention.m
A201808101237r_implicitintervention.m
A201808131129_energyabsorbingtestbed.m
A201808141202_energyabsorbingtestbed.m
A201808141353_energyabsorbingtestbed.m
A201808141528_addingBCdamping.m
A201808161121_addingBCdamping.m
A201808161209_highdamping.m
A201808161302_negateloadweight.m
A201808161532_variablesize.m
A201808171611_lvarnotdone.m
A201808171612_lvarnotdone.m
A201808211557.m
A201808182107.m
A201808212240.m
A201808221012.m
A201808222034.m
A201808222100.m
A201808222226.m
A201808222243.m
A201808222354.m
A201808230152.m
A201808230353.m
A201808271153.m
A201808271529.m
A201808271534_prototype.m
A201808271656.m
A201808281513r.m
A201808291226.m
A201808291608.m
A201808311706.m
A201808311824.m
A201808311837.m
A201809031006.m
A201809031615.m
A201809031627.m
A201809032217.m
A201809041034.m
A201809041319.m
A201809041432.m
A201809041828.m
A201809042049.m
A201809050037.m
A201809051048.m
A201809051117.m
A201809051358.m
A201809051638.m
A201809051638r.m
A201809060946.m
A201809061129.m
A201809061228.m
A201809061533.m
A201809071154.m
A201809071234.m
A201809071300.m
A201809100120.m
A201809101209.m
A201809101224.m
A201809110935.m
A201809110959.m
A201809111400.m
A201809121500.m
A201809121519.m
A201809121708.m
A201809131706.m
A201809131722.m
A201809131726.m
A201809141041.m
A201809141214.m
A201809141319.m
A201809141634.m
A201809151714.m
A201809151902.m
A201809151902test.m
A201809151902test2.m
A201809181043errtrack.m
A201809181053.m
A201809181103.m
A201809182008.m
A201809182039.m
A201809182102.m
A201809191329.m
A201809191408.m
A201809191520.m
A201809191612.m double knots
A201809201734.m
A201809210941.m MPM beef up
A201809211059.m MPM beef up
A201809211556.m less aggressive alpha widening
A201809240925.m substepped implicit multisurface
A201809251447.m MPM beefed up max, less disp
A201809251504.m CPDI multiknot fine
A201809260947.m
A201809261239.m
A201809261253.m
A201809261323test.m
A201809261357test.m
A201809261402test.m
A201809261453test.m
A201809261512test.m
A201809261556.m
A201809261627.m
A201809261707.m
A201809261723.m
A201809261723r.m
A201809261825.m
A201809261929.m
A201809262145.m
A201809270017.m
A201809271053.m
A201809271245.m
A201809271328.m
A201809281319.m
A201809281530.m
A201809281619.m
A201810011356.m
A201810011554.m
A201810021303.m
A201810021351.m
A201810021626.m
A201810022107.m
A201810022112.m
A201810022112s.m
A201810030928.m
A201810031010.m
A201810031343.m
A201810031343r.m
A201810031419.m
A201810031602.m
A201810031602r.m
A201810031732.m
A201810031542.m
A201810051542.m
A201810051634.m
A201810081106.m
A201810081505.m
A201810081555.m
A201810081628.m
A201810081705.m
A201810080952.m
A201810081009.m
A201810091050.m
A201810091056.m
A201810091512.m
A201810101007.m
A201810101436.m
A201810101510.m
A201810101702.m
A201810111247.m
A201810121045.m
A201810142323.m
A201810151157.m
A201810151222_stacktest.m
A201810151637.m
A201810152136.m
A201810152146.m
A201810161435.m
A201810161849.m
A201810201837.m
A201810220946.m
A201810221000.m
A201810221017.m
A201810221039.m
A201810221039d.m
A201810231005a.m
A201810261503.m
A201810282119.m
A201810291550.m
A201810300950.m
A201810301007.m
A201810301254.m
A201810311918.m
A201810311918b.m
A201810312112.m
A201811011101.m
A201811011152.m
A201811011205.m
A201811011618.m
A201811011643.m
A201811012016.m
A201811020717.m
A201811042146.m
A201811042314.m
A201811051929.m
A201811061124.m
A201811062004.m
A201811062035.m
A201811062100.m
A201811070924.m
A201811071424.m
A201811071424b.m
A201811071424c.m
A201811071528.m
A201811071528b.m
A201811071953.m
A201811072003.m
A201811072003b.m
A201811072142.m
A201811081015.m
A201811081440.m
A201811081623.m
A201811091407.m
A201811091407b.m
A201811131153.m
A201811132228.m
A201811140929.m
A201811140929b.m
A201811140929c.m
A201811150053.m
A201811150938.m
A201811161454.m
A201811231516.m
A201811231516r.m
A201811231517.m
A201811262259.m
A201811270836.m
A201811301927.m
A201811301927sp.m
A201812031254.m
A201812031450.m
A201812040909.m
A201812040909r.m
A201812041055.m
A201812041219r.m
A201812041350.m
A201812041406.m
A201812041412.m
A201812041419.m
A201812041706.m
A201812041930.m
A201812042222.m
A201812050718.m
A201812051001.m
A201812051347.m
A201812071009.m
A201812071100.m
A201812091848.m
A201812091930.m
A201812092308.m
A201812092318.m
A201812100017.m
A201812101339.m
A201812101339u.m
A201812131734.m
A201812211723.m
A201812211723b.m
A201812211723c.m
A201812211723d.m
A201812311458.m
A201812311720.m
A201901020929.m
A201901021709.m
A201901032044.m
A201901041406.m
A201901041409.m
A201901041434.m
A201901082234.m
A201901082234b.m
A201901091054.m
A201901101121.m
A201901171748.m
A201901281623.m
A201901291500.m
A201901292050.m
A201901292112.m
A201901292120.m
zz1902022104.m
zz1902022104b.m
zz1902022155.m
zz1902041658.m
zz1902041931.m
zz1902050956.m
zz1902051009.m
zz1902051013.m
zz1902051022.m
zz1902051047.m
zz1902051105.m
zz1902051106.m
zz1902051116.m
zz1902051125.m
zz1902051232.m
zz1902051624.m
zz1902051851.m
zz1902051951.m
zz1902052132.m
zz1902052221.m
zz1902061151.m
zz1902061443.m
zz1902061506.m
zz1902061613.m
zz1902061935.m
zz1902061950.m successful one crack crackparticles only
zz1902062058.m start trying tracking crack surfaces
zz1902062104.m
zz1902062218.m
zz1902062247.m
zz1902111654.m
zz1902112016.m
zz1902112217.m
zz1902121052.m
zz1902121216.m
zz1902121751.m
zz1902122004.m
zz1902122103.m
zz1902122213.m
zz1902122223.m
zz1902122254.m
zz1902122304.m
zz1902130721.m
zz1902130816.m
zz1902192203.m
zz1902201635.m
zz1902201732.m
zz1902211108.m
zz1902211220.m
zz1902211232.m
zz1902211237.m
zz1902211246.m
zz1902211508.m
zz1902211610.m
zz1902211621.m
zz1902211628.m
zz1902211723.m
zz1902211734.m
zz1902211738.m
zz1902221308.m
zz1902221720.m
zz1902232223.m
zz1902232223b.m
zz1902232231.m
zz1902232329.m
zz1902251139.m
zz1902251230.m
zz1902251627.m
zz1902251724.m
zz1902251808.m
zz1902251835.m
zz1902251848.m
zz1902252014.m
zz1902252026.m
zz1902252111.m
zz1902252121.m
zz1902252322.m
zz1902252326.m
zz1902260108.m - open for 90 degs, shrink all directions
zz1902261208.m - open for 90 degs, shrink x only
zz1902261235.m - ramp shrink xy
zz1892261256.m - ramp shrink x only
zz1902261657.m - ramp shrink xy small initial (case 71)
zz1902261936.m - J central adjustable
zz1902261952.m - J central adjustable 1.4 shorter
zz1902262324.m - J central adjustable shrink xy very small initial
zz1902271135.m - field split error investigation
zz1902271233.m - field split error handled, bottom still roller, plot both with/without crack
zz1902271301.m - field split error handled, bottom fixed, plot both with/without crack (wrong bottom fixing)
zz1902271432.m - bottom fixed properly
zz1903031617.m - crack initiation stress roller bottom
zz1903031714.m - crack initiation stress roller bottom create x_crack
zz1903041235.m - fixing things up
zz1903041241.m
zz1903041253.m
zz1903041336.m
zz1903061744.m
zz1903061758.m
zz1903071256.m
zz1903071452.m
zz1903071722.m
zz1903071858.m
zz1903081146.m
zz1903081214.m
zz1903081239.m
zz1903081531.m
zz1903081755.m
zz1903081807.m
zz1903081817.m
zz1903081904.m
zz1903081930.m
zz1903111237.m - trying 9 particles
zz1903111301.m - outputting f_final_vect for cracked particles
zz1903111441.m - diagonal crack investigation (code gutted)
zz1903111747.m - proper direction identification
zz1903120006.m - retrying ParticlePull with proper h
zz1903121027.m - extracting inputs for particlepull
zz1903121056.m - extracting inputs for particlepull
zz1903121118.m - retrying ParticlePull from faulty input
zz1903121551.m - angled, it's just how it is, plot sx and sy please
zz1903121604.m - tt start simulation and tt start plotting
zz1903121618.m - investigate spurious with point pull again
zz1903121805.m - 2 particles per cell, plane stress
zz1903121825.m - plane strain, no damping
zz1903131252.m - initial discrete crack, Q propagation
zz1903131704.m - particle just cracked list
zz1903131842.m - averaging and propagating
zz1903131843.m - averaging and propagating
zz1903131844.m - averaging and propagating
zz1903150109.m - running from start again
zz1903150110.m - running from start again
zz1903150111.m
zz1903150112.m
zz1903150337.m
zz1903181513.m
zz1903181759.m
zz1903181842.m
zz1903181843.m
zz1903181844.m
zz1903181845.m
zz1903191659.m
zz1903191818.m
zz1903221549.m
zz1903221550.m
zz1903251803.m
zz1903251830.m
zz1903252115.m
zz1903252302.m
zz1903271338.m
zz1903271407.m
zz1893271700.m
zz1903271700.m
zz1903271725.m
zz1903271849.m
zz1903271954.m
zz1903272005.m
zz1903272035.m
zz1903272053.m
zz1903281506.m
zz1903281644.m
zz1903281659.m
zz1903281723.m
zz1903281731.m
zz1903281901.m
zz1903281905.m
zz1903281945.m
zz1903281945b.m - field split investigation
zz1903281945c.m - field split investigation
zz1903282057.m
zz1904011223.m
zz1904022301.m
zz1904081354.m
zz1904081718.m
zz1904081734.m
zz1904081846.m
zz1904091154.m
zz1904091344.m
zz1904091443.m
zz1904091527.m
zz1904091902.m
zz1904091908.m
zz1904091910.m
zz1904092008.m
zz1904092120.m
zz1904092203.m
zz1904092215.m
zz1904101330.m
zz1904101635.m
zz1904101705.m
zz1904101713.m
zz1904101733.m
zz1904101737.m
zz1904101807.m
zz1904101939.m
zz1904101939b.m
zz19041012002.m
zz19041012038.m
zz19041012038b.m
zz1904102104.m
zz1904102134.m
zz1904102208.m
zz1904102234.m
zz1904102347.m
zz1904111257.m
zz1904111652.m
zz1904111704.m
zz1904111735.m
zz1904111747.m
zz1904112005.m
zz1904112132.m
zz1904112132b.m
zz1904112236.m
zz1904112314.m
zz1904112315.m
zz1904121053.m
zz1904121618.m
zz1904121647.m
zz1904121926.m
zz1904122012.m
zz1904131822.m
zz1904151212.m
zz1904151212b.m
zz1904151212c.m
zz1904151212d.m
zz1904151212e.m
zz1904151614.m
zz1904151615.m
zz1904151616.m
zz1904151617.m
zz1904151618.m
zz1904151619.m
zz1904151620.m
zz1904160051.m
zz1904160112.m
zz1904160112b.m
zz1904161308.m
zz1904161309.m
zz1904161310.m
zz1904161311.m
zz1904161312.m
zz1904161313.m
zz1904161314.m
zz1904161314b.m
zz1904161314c.m
zz1904161314d.m
zz1904171323.m
zz1904171324.m
zz1904171325.m
zz1904171651.m
zz1904171652.m
zz1904171653.m
zz1904171654.m
zz1904171655.m
zz1904171656.m
zz1904172242.m
zz1904172242b.m
zz1904181331.m
zz1904181649.m
zz1904182007.m
zz1904182233.m
zz1904190010.m
zz1904191228.m
zz1904191748.m
zz1904191749.m
zz1904191750.m
zz1904191751.m
zz1904231852.m
zz1904231853.m
zz1904231854.m
zz1904231855.m
zz1904241226.m
zz1904241227.m
zz1904241227p.m
zz1904251505.m
zz1904251516.m
zz1904251700.m
zz1904251714.m
zz1904251715.m
zz1904252212.m
zz1904252318.m
zz1904252319.m
zz1904252320.m
zz1904252321.m
zz1904252322.m
zz1904252323.m
zz1904252324.m
zz1904291659.m
zz1904301319.m
zz1904302107.m
zz1905021642.m
zz1905021713.m
zz1905021756.m
zz1905021758.m
zz1905021817.m
zz1905022102.m
zz1905061348.m
zz1905061714.m
zz1905061743.m
zz1905071307.m
zz1905071308.m
zz1905071309.m %retrieving sigmainf
zz1905071310.m %retrieving sigmainf
zz1905071634.m
zz1905080010.m
zz1905080011.m
zz1905080012.m
zz1905080013.m
zz1905080014.m
zz1905080015.m
zz1905101323.m
zz1905101324.m
zz1905101325.m
zz1905101326.m
zz1905132236.m
zz1905132300.m
zz1905141832.m
zz1905141832main.m
zz1905151711.m
zz1905151712.m
zz1905161805.m
zz1905202214.m
zz1905221125.m
zz1905221151.m
zz1905221221.m %applying traction on grid
zz1905261941.m
zz1905261941b.m
zz2905271010.m
zz1906030211.m
zz1906030211c.m
zz1906030259c.m
zz1906030259.m
zz1906030306.m
zz1906261012.m
zz1906201039.m - angled crack for infinite plane added
zz1906261234.m
zz1906261337.m - main handler 122 test run
zz1906261337print.m
zz1906281235.m
zz1906281739.m
zz1906281739Coder.m
zz1906281824.m
zz1907011004.m
zz1907021736.m
zz1907041207.m
zz1907041840.m
zz1907042011.m
zz1907050925.m
zz1907051108.m
zz1907051229.m
zz1907051655.m
zz1907052055.m
zz1907080941.m
zz1907080941Coder.m
zz1907081342.m
zz1907081342Coder.m
zz1907081407.m
zz1907081634.m
zz1907081759.m
zz1907090927.m
zz1907091032.m
zz1907091056.m
zz1907091535.m
zz1907091535c.m
zz1907091853.m
zz1907101150.m
zz1907101150c.m
zz1907101610.m
zz1907101650.m
zz1907101914.m
zz1907101914b.m
zz1907102139.m
zz1907102143.m
zz1907102144.m
zz1907111327.m - working normally again
zz1907111334.m
zz1907111501.m
zz1907112014.m
zz1907112024.m
zz1907112026.m
zz1907112233.m
zz1907112321.m
zz1907121741.m
zz1907122219.m
zz1907132321.m
zz1907140138.m
zz1907141140.m
zz1907141171.m
zz1907171539.m
zz1907241133.m
zz1907241138.m
zz1908041706.m - TheFieldSplitBase3 Regular Array
zz1908051003.m - from 1001 fixed cell declaration
zz1908230916 - paralellized, back to 16
%}

%{
xyW=[	0.002826114	0.002826069	0.000110742	;
		0.036715186	0.002818485	0.000685881	;
		0.142478702	0.002708944	0.001461138	;
		0.309741132	0.00221853	0.001446592	;
		0.457879042	0.001135335	0.000440357	;
		0.002826114	0.036714599	0.000687727	;
		0.036715186	0.036616068	0.004259454	;
		0.142478702	0.035192981	0.009073948	;
		0.309741132	0.028821812	0.008983611	;
		0.457879042	0.014749598	0.002734699	;
		0.002826114	0.142476426	0.001524313	;
		0.036715186	0.142094059	0.009440868	;
		0.142478702	0.136571561	0.020111952	;
		0.309741132	0.111847299	0.019911726	;
		0.457879042	0.057237994	0.006061324	;
		0.002826114	0.309736184	0.001842738	;
		0.036715186	0.308904938	0.011413041	;
		0.142478702	0.296899321	0.024313287	;
		0.309741132	0.243150088	0.024071235	;
		0.457879042	0.124432359	0.007327519	;
		0.002826114	0.457871727	0.001096133	;
		0.036715186	0.456642927	0.006788925	;
		0.142478702	0.438895459	0.014462499	;
		0.309741132	0.359439925	0.014318516	;
		0.457879042	0.183943827	0.004358696	];

%}

%{
function outputanalysis()
	TimeStampedName='Out-zz1912181981-Case_154-Vortex';
	tt=loadsinglelong([TimeStampedName '-Master-' 'tt' '.txt']);
    tt=tt-1;
    anerror.u_sp(:,:,1)=loadmatrixfloat([TimeStampedName '-Slave-' 'anerror.u_sp' '-' int2txt(1) '.txt']);
    spCount=size(anerror.u_sp,1);
    anerror.u_sp=zeros(spCount,2,tt);
    anerror.u_sp_an=zeros(spCount,2,tt);
    anerror.u_srsserror=zeros(1,tt);
    anerror.u_srssan=zeros(1,tt);
    anerror.u_err_relative=zeros(1,tt);
    anerror.u_srss=zeros(1,tt);
    t_time=zeros(1,tt);
    tt_list=zeros(1,tt);
	for i=1:tt
		anerror.u_sp(:,:,i)=loadmatrixfloat([TimeStampedName '-Slave-' 'anerror.u_sp' '-' int2txt(i) '.txt']);
		anerror.u_sp_an(:,:,i)=loadmatrixfloat([TimeStampedName '-Slave-' 'anerror.u_sp_an' '-' int2txt(i) '.txt']);
		anerror.u_srsserror(i)=loadsinglefloat([TimeStampedName '-Slave-' 'anerror.u_srsserror' '-' int2txt(i) '.txt']);
		anerror.u_srssan(i)=loadsinglefloat([TimeStampedName '-Slave-' 'anerror.u_srssan' '-' int2txt(i) '.txt']);
		anerror.u_err_relative(i)=loadsinglefloat([TimeStampedName '-Slave-' 'anerror.u_err_relative' '-' int2txt(i) '.txt']);
        anerror.u_srss(i)=sqrt(dot(anerror.u_sp(:,1,i),anerror.u_sp(:,1,i))+dot(anerror.u_sp(:,2,i),anerror.u_sp(:,2,i)));
		t_time(i)=loadsinglefloat([TimeStampedName '-Slave-' 't_time' '-' int2txt(i) '.txt']);
		tt_list(i)=i;
	end
	close all
	hold on
	%plot(tt_list,anerror.u_err_relative,'DisplayName','anerror.u_err_relative');
	plot(tt_list,anerror.u_srss,'DisplayName','SRSS MPM');
	plot(tt_list,anerror.u_srssan,'DisplayName','SRSS Analytical');
	plot(tt_list,anerror.u_srsserror,'DisplayName','SRSS Error');
	legend show;
	xlabel('tt_list');
	ylabel('value');
	uisave;
end

function outputanalysis161()
	clear all;
	close all;
	maxpower=4;
	anerror.t_deviation=zeros(1,maxpower+1);
	anerror.u_err_relative=zeros(1,maxpower+1);
	anerror.gridsize=zeros(1,maxpower+1);
	for ipower=0:maxpower
		anerror.t_deviation(ipower+1)=loadsinglefloat(['anerror.t_deviation' '-' int2txt(2^ipower) '.txt']);
		anerror.u_err_relative(ipower+1)=loadsinglefloat(['anerror.u_err_relative' '-' int2txt(2^ipower) '.txt']);
		anerror.gridsize(ipower+1)=loadsinglefloat(['anerror.gridsize' '-' int2txt(2^ipower) '.txt']);
    end
    
    %CPDI convergence papers square, ring, vortex(Quan)
    %start of: numbers are from graph measurements
    CPDI.square.cellsize=[0.01549214 0.030821796 0.062012481 0.124367677];
    CPDI.square.error=[1.68523E-08 2.01937E-07 2.2138E-06 2.77341E-05];
    CPDI.ring.cellsize=[0.101113835 0.049491197 0.024835285 0.012393816];
    CPDI.ring.error=[6.28092E-05 1.6521E-05 2.8851E-06 3.62748E-07];
    CPDI.vortex.cellsize=[0.125448936 0.062431094 0.03132367 0.01560976];
    CPDI.vortex.error=[0.268401913 0.055415108 0.013317962 0.01299999];
    %end of: numbers are from graph measurements
    
    %start of: infinite plane
    %source: D:\Users\Tito\Documents\Combined_2019-02-21\zz1905101323-119_InfinitePlate2x2Norms-MainHandler.mat
    CPDI.infinite.cellsize=[2.50000000000000,1.25000000000000,0.833333333333333,0.625000000000000,0.500000000000000,0.416666666666667,0.357142857142857,0.312500000000000,0.277777777777778,0.250000000000000,0.227272727272727,0.208333333333333];
    CPDI.infinite.Grelativeerror=[0.484040996167281,0.220838232255940,0.144315153519236,0.107387692586272,0.0852596700200254,0.0706326123868621,0.0602351837422849,0.0524839662956033,0.0464772398132144,0.0416927673396901,0.0377901155112371,0.0345436264261088];
    CPDI.infinite.stressnormpersigmainf=[0.274829181897473,0.175609407301199,0.126731664714007,0.0993195849476160,0.0817527492467626,0.0695176624219848,0.0605018889150845,0.0535751109323679,0.0480836951457544,0.0436222548011954,0.0399252650677765,0.0368125711633320];
    %end of: infinite plane
    
    
    
    figure1=figure;
    loglog(CPDI.square.cellsize,CPDI.square.error,'-o','DisplayName','Axis-Aligned');
    hold on
    loglog(CPDI.ring.cellsize,CPDI.ring.error,'-o','DisplayName','Ring Expansion');
    loglog(CPDI.vortex.cellsize,CPDI.vortex.error,'-o','DisplayName','Vortex: QA');
    loglog(anerror.gridsize,anerror.u_err_relative,'-o','DisplayName','Vortex: This Paper');
    loglog(CPDI.infinite.cellsize,CPDI.infinite.Grelativeerror,'-o','DisplayName','Infinite: G error');
    loglog(CPDI.infinite.cellsize,CPDI.infinite.stressnormpersigmainf,'-o','DisplayName','Infinite: stress error');
	%title('Vortex Convergence');
	ylabel('Relative Error Norm [-]');
	xlabel('Grid Size [m]');
    legend show
    %set(gca,'Xdir','reverse');
    set(figure1,'Position',[0 0 350 250]);
	uisave;
    
end
%}

function resp = input_codegen(prompt)
    %#codegen
    coder.extrinsic('input');
    if coder.target('MEX') || coder.target('MATLAB') || coder.target('Sfun')
        resp = input(prompt, 's');
    else
        coder.cinclude('<stdio.h>');
        fprintf('%s',prompt);
        cresp = char(zeros(1,1024));
        coder.ceval('fgets',coder.ref(cresp(1)), 1023, coder.opaque('FILE*','stdin'));
        % Call strlen in C and trim output
        slen = int32(1);
        slen = coder.ceval('strlen',coder.rref(cresp(1)));
        resp = cresp(1:slen);
    end
end
